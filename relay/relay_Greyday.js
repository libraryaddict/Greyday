/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ 762:
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

/******/(function () {// webpackBootstrap
  /******/"use strict";
  /******/var __webpack_modules__ = {

    /***/447:
    /***/function _(module) {

      module.exports = "data:application/javascript;base64,KGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHsKCWlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0JykKCQltb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTsKCWVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKQoJCWRlZmluZShbXSwgZmFjdG9yeSk7CgllbHNlIHsKCQl2YXIgYSA9IGZhY3RvcnkoKTsKCQlmb3IodmFyIGkgaW4gYSkgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyA/IGV4cG9ydHMgOiByb290KVtpXSA9IGFbaV07Cgl9Cn0pKHNlbGYsICgpID0+IHsKcmV0dXJuIC8qKioqKiovICgoKSA9PiB7IC8vIHdlYnBhY2tCb290c3RyYXAKLyoqKioqKi8gCSJ1c2Ugc3RyaWN0IjsKLyoqKioqKi8gCXZhciBfX3dlYnBhY2tfbW9kdWxlc19fID0gKHsKCi8qKiovIDg4NzoKLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX193ZWJwYWNrX2V4cG9ydHNfXywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCi8vIEVYUE9SVFMKX193ZWJwYWNrX3JlcXVpcmVfXy5kKF9fd2VicGFja19leHBvcnRzX18sIHsKICAiWiI6ICgpID0+ICgvKiBiaW5kaW5nICovIHJlbGF5X0FwcCkKfSk7Cgo7Ly8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvQHJlbWl4LXJ1bi9yb3V0ZXIvZGlzdC9yb3V0ZXIuanMKLyoqCiAqIEByZW1peC1ydW4vcm91dGVyIHYxLjAuMwogKgogKiBDb3B5cmlnaHQgKGMpIFJlbWl4IFNvZnR3YXJlIEluYy4KICoKICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAqIExJQ0VOU0UubWQgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4KICoKICogQGxpY2Vuc2UgTUlUCiAqLwpmdW5jdGlvbiBfZXh0ZW5kcygpIHsKICBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gPyBPYmplY3QuYXNzaWduLmJpbmQoKSA6IGZ1bmN0aW9uICh0YXJnZXQpIHsKICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07CgogICAgICBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7CiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsKICAgICAgICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRhcmdldDsKICB9OwogIHJldHVybiBfZXh0ZW5kcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLyNyZWdpb24gVHlwZXMgYW5kIENvbnN0YW50cwovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKLyoqCiAqIEFjdGlvbnMgcmVwcmVzZW50IHRoZSB0eXBlIG9mIGNoYW5nZSB0byBhIGxvY2F0aW9uIHZhbHVlLgogKi8KdmFyIEFjdGlvbjsKCihmdW5jdGlvbiAoQWN0aW9uKSB7CiAgLyoqCiAgICogQSBQT1AgaW5kaWNhdGVzIGEgY2hhbmdlIHRvIGFuIGFyYml0cmFyeSBpbmRleCBpbiB0aGUgaGlzdG9yeSBzdGFjaywgc3VjaAogICAqIGFzIGEgYmFjayBvciBmb3J3YXJkIG5hdmlnYXRpb24uIEl0IGRvZXMgbm90IGRlc2NyaWJlIHRoZSBkaXJlY3Rpb24gb2YgdGhlCiAgICogbmF2aWdhdGlvbiwgb25seSB0aGF0IHRoZSBjdXJyZW50IGluZGV4IGNoYW5nZWQuCiAgICoKICAgKiBOb3RlOiBUaGlzIGlzIHRoZSBkZWZhdWx0IGFjdGlvbiBmb3IgbmV3bHkgY3JlYXRlZCBoaXN0b3J5IG9iamVjdHMuCiAgICovCiAgQWN0aW9uWyJQb3AiXSA9ICJQT1AiOwogIC8qKgogICAqIEEgUFVTSCBpbmRpY2F0ZXMgYSBuZXcgZW50cnkgYmVpbmcgYWRkZWQgdG8gdGhlIGhpc3Rvcnkgc3RhY2ssIHN1Y2ggYXMgd2hlbgogICAqIGEgbGluayBpcyBjbGlja2VkIGFuZCBhIG5ldyBwYWdlIGxvYWRzLiBXaGVuIHRoaXMgaGFwcGVucywgYWxsIHN1YnNlcXVlbnQKICAgKiBlbnRyaWVzIGluIHRoZSBzdGFjayBhcmUgbG9zdC4KICAgKi8KCiAgQWN0aW9uWyJQdXNoIl0gPSAiUFVTSCI7CiAgLyoqCiAgICogQSBSRVBMQUNFIGluZGljYXRlcyB0aGUgZW50cnkgYXQgdGhlIGN1cnJlbnQgaW5kZXggaW4gdGhlIGhpc3Rvcnkgc3RhY2sKICAgKiBiZWluZyByZXBsYWNlZCBieSBhIG5ldyBvbmUuCiAgICovCgogIEFjdGlvblsiUmVwbGFjZSJdID0gIlJFUExBQ0UiOwp9KShBY3Rpb24gfHwgKEFjdGlvbiA9IHt9KSk7Cgpjb25zdCBQb3BTdGF0ZUV2ZW50VHlwZSA9ICJwb3BzdGF0ZSI7Ci8qKgogKiBNZW1vcnkgaGlzdG9yeSBzdG9yZXMgdGhlIGN1cnJlbnQgbG9jYXRpb24gaW4gbWVtb3J5LiBJdCBpcyBkZXNpZ25lZCBmb3IgdXNlCiAqIGluIHN0YXRlZnVsIG5vbi1icm93c2VyIGVudmlyb25tZW50cyBsaWtlIHRlc3RzIGFuZCBSZWFjdCBOYXRpdmUuCiAqLwoKZnVuY3Rpb24gcm91dGVyX2NyZWF0ZU1lbW9yeUhpc3Rvcnkob3B0aW9ucykgewogIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgIG9wdGlvbnMgPSB7fTsKICB9CgogIGxldCB7CiAgICBpbml0aWFsRW50cmllcyA9IFsiLyJdLAogICAgaW5pdGlhbEluZGV4LAogICAgdjVDb21wYXQgPSBmYWxzZQogIH0gPSBvcHRpb25zOwogIGxldCBlbnRyaWVzOyAvLyBEZWNsYXJlIHNvIHdlIGNhbiBhY2Nlc3MgZnJvbSBjcmVhdGVNZW1vcnlMb2NhdGlvbgoKICBlbnRyaWVzID0gaW5pdGlhbEVudHJpZXMubWFwKChlbnRyeSwgaW5kZXgpID0+IGNyZWF0ZU1lbW9yeUxvY2F0aW9uKGVudHJ5LCB0eXBlb2YgZW50cnkgPT09ICJzdHJpbmciID8gbnVsbCA6IGVudHJ5LnN0YXRlLCBpbmRleCA9PT0gMCA/ICJkZWZhdWx0IiA6IHVuZGVmaW5lZCkpOwogIGxldCBpbmRleCA9IGNsYW1wSW5kZXgoaW5pdGlhbEluZGV4ID09IG51bGwgPyBlbnRyaWVzLmxlbmd0aCAtIDEgOiBpbml0aWFsSW5kZXgpOwogIGxldCBhY3Rpb24gPSBBY3Rpb24uUG9wOwogIGxldCBsaXN0ZW5lciA9IG51bGw7CgogIGZ1bmN0aW9uIGNsYW1wSW5kZXgobikgewogICAgcmV0dXJuIE1hdGgubWluKE1hdGgubWF4KG4sIDApLCBlbnRyaWVzLmxlbmd0aCAtIDEpOwogIH0KCiAgZnVuY3Rpb24gZ2V0Q3VycmVudExvY2F0aW9uKCkgewogICAgcmV0dXJuIGVudHJpZXNbaW5kZXhdOwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlTWVtb3J5TG9jYXRpb24odG8sIHN0YXRlLCBrZXkpIHsKICAgIGlmIChzdGF0ZSA9PT0gdm9pZCAwKSB7CiAgICAgIHN0YXRlID0gbnVsbDsKICAgIH0KCiAgICBsZXQgbG9jYXRpb24gPSBjcmVhdGVMb2NhdGlvbihlbnRyaWVzID8gZ2V0Q3VycmVudExvY2F0aW9uKCkucGF0aG5hbWUgOiAiLyIsIHRvLCBzdGF0ZSwga2V5KTsKICAgIHdhcm5pbmckMShsb2NhdGlvbi5wYXRobmFtZS5jaGFyQXQoMCkgPT09ICIvIiwgInJlbGF0aXZlIHBhdGhuYW1lcyBhcmUgbm90IHN1cHBvcnRlZCBpbiBtZW1vcnkgaGlzdG9yeTogIiArIEpTT04uc3RyaW5naWZ5KHRvKSk7CiAgICByZXR1cm4gbG9jYXRpb247CiAgfQoKICBsZXQgaGlzdG9yeSA9IHsKICAgIGdldCBpbmRleCgpIHsKICAgICAgcmV0dXJuIGluZGV4OwogICAgfSwKCiAgICBnZXQgYWN0aW9uKCkgewogICAgICByZXR1cm4gYWN0aW9uOwogICAgfSwKCiAgICBnZXQgbG9jYXRpb24oKSB7CiAgICAgIHJldHVybiBnZXRDdXJyZW50TG9jYXRpb24oKTsKICAgIH0sCgogICAgY3JlYXRlSHJlZih0bykgewogICAgICByZXR1cm4gdHlwZW9mIHRvID09PSAic3RyaW5nIiA/IHRvIDogcm91dGVyX2NyZWF0ZVBhdGgodG8pOwogICAgfSwKCiAgICBlbmNvZGVMb2NhdGlvbihsb2NhdGlvbikgewogICAgICByZXR1cm4gbG9jYXRpb247CiAgICB9LAoKICAgIHB1c2godG8sIHN0YXRlKSB7CiAgICAgIGFjdGlvbiA9IEFjdGlvbi5QdXNoOwogICAgICBsZXQgbmV4dExvY2F0aW9uID0gY3JlYXRlTWVtb3J5TG9jYXRpb24odG8sIHN0YXRlKTsKICAgICAgaW5kZXggKz0gMTsKICAgICAgZW50cmllcy5zcGxpY2UoaW5kZXgsIGVudHJpZXMubGVuZ3RoLCBuZXh0TG9jYXRpb24pOwoKICAgICAgaWYgKHY1Q29tcGF0ICYmIGxpc3RlbmVyKSB7CiAgICAgICAgbGlzdGVuZXIoewogICAgICAgICAgYWN0aW9uLAogICAgICAgICAgbG9jYXRpb246IG5leHRMb2NhdGlvbgogICAgICAgIH0pOwogICAgICB9CiAgICB9LAoKICAgIHJlcGxhY2UodG8sIHN0YXRlKSB7CiAgICAgIGFjdGlvbiA9IEFjdGlvbi5SZXBsYWNlOwogICAgICBsZXQgbmV4dExvY2F0aW9uID0gY3JlYXRlTWVtb3J5TG9jYXRpb24odG8sIHN0YXRlKTsKICAgICAgZW50cmllc1tpbmRleF0gPSBuZXh0TG9jYXRpb247CgogICAgICBpZiAodjVDb21wYXQgJiYgbGlzdGVuZXIpIHsKICAgICAgICBsaXN0ZW5lcih7CiAgICAgICAgICBhY3Rpb24sCiAgICAgICAgICBsb2NhdGlvbjogbmV4dExvY2F0aW9uCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCgogICAgZ28oZGVsdGEpIHsKICAgICAgYWN0aW9uID0gQWN0aW9uLlBvcDsKICAgICAgaW5kZXggPSBjbGFtcEluZGV4KGluZGV4ICsgZGVsdGEpOwoKICAgICAgaWYgKGxpc3RlbmVyKSB7CiAgICAgICAgbGlzdGVuZXIoewogICAgICAgICAgYWN0aW9uLAogICAgICAgICAgbG9jYXRpb246IGdldEN1cnJlbnRMb2NhdGlvbigpCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCgogICAgbGlzdGVuKGZuKSB7CiAgICAgIGxpc3RlbmVyID0gZm47CiAgICAgIHJldHVybiAoKSA9PiB7CiAgICAgICAgbGlzdGVuZXIgPSBudWxsOwogICAgICB9OwogICAgfQoKICB9OwogIHJldHVybiBoaXN0b3J5Owp9Ci8qKgogKiBCcm93c2VyIGhpc3Rvcnkgc3RvcmVzIHRoZSBsb2NhdGlvbiBpbiByZWd1bGFyIFVSTHMuIFRoaXMgaXMgdGhlIHN0YW5kYXJkIGZvcgogKiBtb3N0IHdlYiBhcHBzLCBidXQgaXQgcmVxdWlyZXMgc29tZSBjb25maWd1cmF0aW9uIG9uIHRoZSBzZXJ2ZXIgdG8gZW5zdXJlIHlvdQogKiBzZXJ2ZSB0aGUgc2FtZSBhcHAgYXQgbXVsdGlwbGUgVVJMcy4KICoKICogQHNlZSBodHRwczovL2dpdGh1Yi5jb20vcmVtaXgtcnVuL2hpc3RvcnkvdHJlZS9tYWluL2RvY3MvYXBpLXJlZmVyZW5jZS5tZCNjcmVhdGVicm93c2VyaGlzdG9yeQogKi8KCmZ1bmN0aW9uIHJvdXRlcl9jcmVhdGVCcm93c2VySGlzdG9yeShvcHRpb25zKSB7CiAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgb3B0aW9ucyA9IHt9OwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlQnJvd3NlckxvY2F0aW9uKHdpbmRvdywgZ2xvYmFsSGlzdG9yeSkgewogICAgbGV0IHsKICAgICAgcGF0aG5hbWUsCiAgICAgIHNlYXJjaCwKICAgICAgaGFzaAogICAgfSA9IHdpbmRvdy5sb2NhdGlvbjsKICAgIHJldHVybiBjcmVhdGVMb2NhdGlvbigiIiwgewogICAgICBwYXRobmFtZSwKICAgICAgc2VhcmNoLAogICAgICBoYXNoCiAgICB9LCAvLyBzdGF0ZSBkZWZhdWx0cyB0byBgbnVsbGAgYmVjYXVzZSBgd2luZG93Lmhpc3Rvcnkuc3RhdGVgIGRvZXMKICAgIGdsb2JhbEhpc3Rvcnkuc3RhdGUgJiYgZ2xvYmFsSGlzdG9yeS5zdGF0ZS51c3IgfHwgbnVsbCwgZ2xvYmFsSGlzdG9yeS5zdGF0ZSAmJiBnbG9iYWxIaXN0b3J5LnN0YXRlLmtleSB8fCAiZGVmYXVsdCIpOwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlQnJvd3NlckhyZWYod2luZG93LCB0bykgewogICAgcmV0dXJuIHR5cGVvZiB0byA9PT0gInN0cmluZyIgPyB0byA6IHJvdXRlcl9jcmVhdGVQYXRoKHRvKTsKICB9CgogIHJldHVybiBnZXRVcmxCYXNlZEhpc3RvcnkoY3JlYXRlQnJvd3NlckxvY2F0aW9uLCBjcmVhdGVCcm93c2VySHJlZiwgbnVsbCwgb3B0aW9ucyk7Cn0KLyoqCiAqIEhhc2ggaGlzdG9yeSBzdG9yZXMgdGhlIGxvY2F0aW9uIGluIHdpbmRvdy5sb2NhdGlvbi5oYXNoLiBUaGlzIG1ha2VzIGl0IGlkZWFsCiAqIGZvciBzaXR1YXRpb25zIHdoZXJlIHlvdSBkb24ndCB3YW50IHRvIHNlbmQgdGhlIGxvY2F0aW9uIHRvIHRoZSBzZXJ2ZXIgZm9yCiAqIHNvbWUgcmVhc29uLCBlaXRoZXIgYmVjYXVzZSB5b3UgZG8gY2Fubm90IGNvbmZpZ3VyZSBpdCBvciB0aGUgVVJMIHNwYWNlIGlzCiAqIHJlc2VydmVkIGZvciBzb21ldGhpbmcgZWxzZS4KICoKICogQHNlZSBodHRwczovL2dpdGh1Yi5jb20vcmVtaXgtcnVuL2hpc3RvcnkvdHJlZS9tYWluL2RvY3MvYXBpLXJlZmVyZW5jZS5tZCNjcmVhdGVoYXNoaGlzdG9yeQogKi8KCmZ1bmN0aW9uIHJvdXRlcl9jcmVhdGVIYXNoSGlzdG9yeShvcHRpb25zKSB7CiAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgb3B0aW9ucyA9IHt9OwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlSGFzaExvY2F0aW9uKHdpbmRvdywgZ2xvYmFsSGlzdG9yeSkgewogICAgbGV0IHsKICAgICAgcGF0aG5hbWUgPSAiLyIsCiAgICAgIHNlYXJjaCA9ICIiLAogICAgICBoYXNoID0gIiIKICAgIH0gPSBwYXJzZVBhdGgod2luZG93LmxvY2F0aW9uLmhhc2guc3Vic3RyKDEpKTsKICAgIHJldHVybiBjcmVhdGVMb2NhdGlvbigiIiwgewogICAgICBwYXRobmFtZSwKICAgICAgc2VhcmNoLAogICAgICBoYXNoCiAgICB9LCAvLyBzdGF0ZSBkZWZhdWx0cyB0byBgbnVsbGAgYmVjYXVzZSBgd2luZG93Lmhpc3Rvcnkuc3RhdGVgIGRvZXMKICAgIGdsb2JhbEhpc3Rvcnkuc3RhdGUgJiYgZ2xvYmFsSGlzdG9yeS5zdGF0ZS51c3IgfHwgbnVsbCwgZ2xvYmFsSGlzdG9yeS5zdGF0ZSAmJiBnbG9iYWxIaXN0b3J5LnN0YXRlLmtleSB8fCAiZGVmYXVsdCIpOwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlSGFzaEhyZWYod2luZG93LCB0bykgewogICAgbGV0IGJhc2UgPSB3aW5kb3cuZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiYmFzZSIpOwogICAgbGV0IGhyZWYgPSAiIjsKCiAgICBpZiAoYmFzZSAmJiBiYXNlLmdldEF0dHJpYnV0ZSgiaHJlZiIpKSB7CiAgICAgIGxldCB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjsKICAgICAgbGV0IGhhc2hJbmRleCA9IHVybC5pbmRleE9mKCIjIik7CiAgICAgIGhyZWYgPSBoYXNoSW5kZXggPT09IC0xID8gdXJsIDogdXJsLnNsaWNlKDAsIGhhc2hJbmRleCk7CiAgICB9CgogICAgcmV0dXJuIGhyZWYgKyAiIyIgKyAodHlwZW9mIHRvID09PSAic3RyaW5nIiA/IHRvIDogcm91dGVyX2NyZWF0ZVBhdGgodG8pKTsKICB9CgogIGZ1bmN0aW9uIHZhbGlkYXRlSGFzaExvY2F0aW9uKGxvY2F0aW9uLCB0bykgewogICAgd2FybmluZyQxKGxvY2F0aW9uLnBhdGhuYW1lLmNoYXJBdCgwKSA9PT0gIi8iLCAicmVsYXRpdmUgcGF0aG5hbWVzIGFyZSBub3Qgc3VwcG9ydGVkIGluIGhhc2ggaGlzdG9yeS5wdXNoKCIgKyBKU09OLnN0cmluZ2lmeSh0bykgKyAiKSIpOwogIH0KCiAgcmV0dXJuIGdldFVybEJhc2VkSGlzdG9yeShjcmVhdGVIYXNoTG9jYXRpb24sIGNyZWF0ZUhhc2hIcmVmLCB2YWxpZGF0ZUhhc2hMb2NhdGlvbiwgb3B0aW9ucyk7Cn0gLy8jZW5kcmVnaW9uCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vI3JlZ2lvbiBVVElMUwovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKZnVuY3Rpb24gd2FybmluZyQxKGNvbmQsIG1lc3NhZ2UpIHsKICBpZiAoIWNvbmQpIHsKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlCiAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICJ1bmRlZmluZWQiKSBjb25zb2xlLndhcm4obWVzc2FnZSk7CgogICAgdHJ5IHsKICAgICAgLy8gV2VsY29tZSB0byBkZWJ1Z2dpbmcgaGlzdG9yeSEKICAgICAgLy8KICAgICAgLy8gVGhpcyBlcnJvciBpcyB0aHJvd24gYXMgYSBjb252ZW5pZW5jZSBzbyB5b3UgY2FuIG1vcmUgZWFzaWx5CiAgICAgIC8vIGZpbmQgdGhlIHNvdXJjZSBmb3IgYSB3YXJuaW5nIHRoYXQgYXBwZWFycyBpbiB0aGUgY29uc29sZSBieQogICAgICAvLyBlbmFibGluZyAicGF1c2Ugb24gZXhjZXB0aW9ucyIgaW4geW91ciBKYXZhU2NyaXB0IGRlYnVnZ2VyLgogICAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1lbXB0eQogICAgfSBjYXRjaCAoZSkge30KICB9Cn0KCmZ1bmN0aW9uIGNyZWF0ZUtleSgpIHsKICByZXR1cm4gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDgpOwp9Ci8qKgogKiBGb3IgYnJvd3Nlci1iYXNlZCBoaXN0b3JpZXMsIHdlIGNvbWJpbmUgdGhlIHN0YXRlIGFuZCBrZXkgaW50byBhbiBvYmplY3QKICovCgoKZnVuY3Rpb24gZ2V0SGlzdG9yeVN0YXRlKGxvY2F0aW9uKSB7CiAgcmV0dXJuIHsKICAgIHVzcjogbG9jYXRpb24uc3RhdGUsCiAgICBrZXk6IGxvY2F0aW9uLmtleQogIH07Cn0KLyoqCiAqIENyZWF0ZXMgYSBMb2NhdGlvbiBvYmplY3Qgd2l0aCBhIHVuaXF1ZSBrZXkgZnJvbSB0aGUgZ2l2ZW4gUGF0aAogKi8KCgpmdW5jdGlvbiBjcmVhdGVMb2NhdGlvbihjdXJyZW50LCB0bywgc3RhdGUsIGtleSkgewogIGlmIChzdGF0ZSA9PT0gdm9pZCAwKSB7CiAgICBzdGF0ZSA9IG51bGw7CiAgfQoKICBsZXQgbG9jYXRpb24gPSBfZXh0ZW5kcyh7CiAgICBwYXRobmFtZTogdHlwZW9mIGN1cnJlbnQgPT09ICJzdHJpbmciID8gY3VycmVudCA6IGN1cnJlbnQucGF0aG5hbWUsCiAgICBzZWFyY2g6ICIiLAogICAgaGFzaDogIiIKICB9LCB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gcGFyc2VQYXRoKHRvKSA6IHRvLCB7CiAgICBzdGF0ZSwKICAgIC8vIFRPRE86IFRoaXMgY291bGQgYmUgY2xlYW5lZCB1cC4gIHB1c2gvcmVwbGFjZSBzaG91bGQgcHJvYmFibHkganVzdCB0YWtlCiAgICAvLyBmdWxsIExvY2F0aW9ucyBub3cgYW5kIGF2b2lkIHRoZSBuZWVkIHRvIHJ1biB0aHJvdWdoIHRoaXMgZmxvdyBhdCBhbGwKICAgIC8vIEJ1dCB0aGF0J3MgYSBwcmV0dHkgYmlnIHJlZmFjdG9yIHRvIHRoZSBjdXJyZW50IHRlc3Qgc3VpdGUgc28gZ29pbmcgdG8KICAgIC8vIGtlZXAgYXMgaXMgZm9yIHRoZSB0aW1lIGJlaW5nIGFuZCBqdXN0IGxldCBhbnkgaW5jb21pbmcga2V5cyB0YWtlIHByZWNlZGVuY2UKICAgIGtleTogdG8gJiYgdG8ua2V5IHx8IGtleSB8fCBjcmVhdGVLZXkoKQogIH0pOwoKICByZXR1cm4gbG9jYXRpb247Cn0KLyoqCiAqIENyZWF0ZXMgYSBzdHJpbmcgVVJMIHBhdGggZnJvbSB0aGUgZ2l2ZW4gcGF0aG5hbWUsIHNlYXJjaCwgYW5kIGhhc2ggY29tcG9uZW50cy4KICovCgpmdW5jdGlvbiByb3V0ZXJfY3JlYXRlUGF0aChfcmVmKSB7CiAgbGV0IHsKICAgIHBhdGhuYW1lID0gIi8iLAogICAgc2VhcmNoID0gIiIsCiAgICBoYXNoID0gIiIKICB9ID0gX3JlZjsKICBpZiAoc2VhcmNoICYmIHNlYXJjaCAhPT0gIj8iKSBwYXRobmFtZSArPSBzZWFyY2guY2hhckF0KDApID09PSAiPyIgPyBzZWFyY2ggOiAiPyIgKyBzZWFyY2g7CiAgaWYgKGhhc2ggJiYgaGFzaCAhPT0gIiMiKSBwYXRobmFtZSArPSBoYXNoLmNoYXJBdCgwKSA9PT0gIiMiID8gaGFzaCA6ICIjIiArIGhhc2g7CiAgcmV0dXJuIHBhdGhuYW1lOwp9Ci8qKgogKiBQYXJzZXMgYSBzdHJpbmcgVVJMIHBhdGggaW50byBpdHMgc2VwYXJhdGUgcGF0aG5hbWUsIHNlYXJjaCwgYW5kIGhhc2ggY29tcG9uZW50cy4KICovCgpmdW5jdGlvbiBwYXJzZVBhdGgocGF0aCkgewogIGxldCBwYXJzZWRQYXRoID0ge307CgogIGlmIChwYXRoKSB7CiAgICBsZXQgaGFzaEluZGV4ID0gcGF0aC5pbmRleE9mKCIjIik7CgogICAgaWYgKGhhc2hJbmRleCA+PSAwKSB7CiAgICAgIHBhcnNlZFBhdGguaGFzaCA9IHBhdGguc3Vic3RyKGhhc2hJbmRleCk7CiAgICAgIHBhdGggPSBwYXRoLnN1YnN0cigwLCBoYXNoSW5kZXgpOwogICAgfQoKICAgIGxldCBzZWFyY2hJbmRleCA9IHBhdGguaW5kZXhPZigiPyIpOwoKICAgIGlmIChzZWFyY2hJbmRleCA+PSAwKSB7CiAgICAgIHBhcnNlZFBhdGguc2VhcmNoID0gcGF0aC5zdWJzdHIoc2VhcmNoSW5kZXgpOwogICAgICBwYXRoID0gcGF0aC5zdWJzdHIoMCwgc2VhcmNoSW5kZXgpOwogICAgfQoKICAgIGlmIChwYXRoKSB7CiAgICAgIHBhcnNlZFBhdGgucGF0aG5hbWUgPSBwYXRoOwogICAgfQogIH0KCiAgcmV0dXJuIHBhcnNlZFBhdGg7Cn0KZnVuY3Rpb24gY3JlYXRlVVJMKGxvY2F0aW9uKSB7CiAgLy8gd2luZG93LmxvY2F0aW9uLm9yaWdpbiBpcyAibnVsbCIgKHRoZSBsaXRlcmFsIHN0cmluZyB2YWx1ZSkgaW4gRmlyZWZveAogIC8vIHVuZGVyIGNlcnRhaW4gY29uZGl0aW9ucywgbm90YWJseSB3aGVuIHNlcnZpbmcgZnJvbSBhIGxvY2FsIEhUTUwgZmlsZQogIC8vIFNlZSBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD04NzgyOTcKICBsZXQgYmFzZSA9IHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiB3aW5kb3cubG9jYXRpb24gIT09ICJ1bmRlZmluZWQiICYmIHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gIT09ICJudWxsIiA/IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gOiAidW5rbm93bjovL3Vua25vd24iOwogIGxldCBocmVmID0gdHlwZW9mIGxvY2F0aW9uID09PSAic3RyaW5nIiA/IGxvY2F0aW9uIDogcm91dGVyX2NyZWF0ZVBhdGgobG9jYXRpb24pOwogIHJldHVybiBuZXcgVVJMKGhyZWYsIGJhc2UpOwp9CgpmdW5jdGlvbiBnZXRVcmxCYXNlZEhpc3RvcnkoZ2V0TG9jYXRpb24sIGNyZWF0ZUhyZWYsIHZhbGlkYXRlTG9jYXRpb24sIG9wdGlvbnMpIHsKICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICBvcHRpb25zID0ge307CiAgfQoKICBsZXQgewogICAgd2luZG93ID0gZG9jdW1lbnQuZGVmYXVsdFZpZXcsCiAgICB2NUNvbXBhdCA9IGZhbHNlCiAgfSA9IG9wdGlvbnM7CiAgbGV0IGdsb2JhbEhpc3RvcnkgPSB3aW5kb3cuaGlzdG9yeTsKICBsZXQgYWN0aW9uID0gQWN0aW9uLlBvcDsKICBsZXQgbGlzdGVuZXIgPSBudWxsOwoKICBmdW5jdGlvbiBoYW5kbGVQb3AoKSB7CiAgICBhY3Rpb24gPSBBY3Rpb24uUG9wOwoKICAgIGlmIChsaXN0ZW5lcikgewogICAgICBsaXN0ZW5lcih7CiAgICAgICAgYWN0aW9uLAogICAgICAgIGxvY2F0aW9uOiBoaXN0b3J5LmxvY2F0aW9uCiAgICAgIH0pOwogICAgfQogIH0KCiAgZnVuY3Rpb24gcHVzaCh0bywgc3RhdGUpIHsKICAgIGFjdGlvbiA9IEFjdGlvbi5QdXNoOwogICAgbGV0IGxvY2F0aW9uID0gY3JlYXRlTG9jYXRpb24oaGlzdG9yeS5sb2NhdGlvbiwgdG8sIHN0YXRlKTsKICAgIGlmICh2YWxpZGF0ZUxvY2F0aW9uKSB2YWxpZGF0ZUxvY2F0aW9uKGxvY2F0aW9uLCB0byk7CiAgICBsZXQgaGlzdG9yeVN0YXRlID0gZ2V0SGlzdG9yeVN0YXRlKGxvY2F0aW9uKTsKICAgIGxldCB1cmwgPSBoaXN0b3J5LmNyZWF0ZUhyZWYobG9jYXRpb24pOyAvLyB0cnkuLi5jYXRjaCBiZWNhdXNlIGlPUyBsaW1pdHMgdXMgdG8gMTAwIHB1c2hTdGF0ZSBjYWxscyA6LwoKICAgIHRyeSB7CiAgICAgIGdsb2JhbEhpc3RvcnkucHVzaFN0YXRlKGhpc3RvcnlTdGF0ZSwgIiIsIHVybCk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAvLyBUaGV5IGFyZSBnb2luZyB0byBsb3NlIHN0YXRlIGhlcmUsIGJ1dCB0aGVyZSBpcyBubyByZWFsCiAgICAgIC8vIHdheSB0byB3YXJuIHRoZW0gYWJvdXQgaXQgc2luY2UgdGhlIHBhZ2Ugd2lsbCByZWZyZXNoLi4uCiAgICAgIHdpbmRvdy5sb2NhdGlvbi5hc3NpZ24odXJsKTsKICAgIH0KCiAgICBpZiAodjVDb21wYXQgJiYgbGlzdGVuZXIpIHsKICAgICAgbGlzdGVuZXIoewogICAgICAgIGFjdGlvbiwKICAgICAgICBsb2NhdGlvbjogaGlzdG9yeS5sb2NhdGlvbgogICAgICB9KTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHJlcGxhY2UodG8sIHN0YXRlKSB7CiAgICBhY3Rpb24gPSBBY3Rpb24uUmVwbGFjZTsKICAgIGxldCBsb2NhdGlvbiA9IGNyZWF0ZUxvY2F0aW9uKGhpc3RvcnkubG9jYXRpb24sIHRvLCBzdGF0ZSk7CiAgICBpZiAodmFsaWRhdGVMb2NhdGlvbikgdmFsaWRhdGVMb2NhdGlvbihsb2NhdGlvbiwgdG8pOwogICAgbGV0IGhpc3RvcnlTdGF0ZSA9IGdldEhpc3RvcnlTdGF0ZShsb2NhdGlvbik7CiAgICBsZXQgdXJsID0gaGlzdG9yeS5jcmVhdGVIcmVmKGxvY2F0aW9uKTsKICAgIGdsb2JhbEhpc3RvcnkucmVwbGFjZVN0YXRlKGhpc3RvcnlTdGF0ZSwgIiIsIHVybCk7CgogICAgaWYgKHY1Q29tcGF0ICYmIGxpc3RlbmVyKSB7CiAgICAgIGxpc3RlbmVyKHsKICAgICAgICBhY3Rpb24sCiAgICAgICAgbG9jYXRpb246IGhpc3RvcnkubG9jYXRpb24KICAgICAgfSk7CiAgICB9CiAgfQoKICBsZXQgaGlzdG9yeSA9IHsKICAgIGdldCBhY3Rpb24oKSB7CiAgICAgIHJldHVybiBhY3Rpb247CiAgICB9LAoKICAgIGdldCBsb2NhdGlvbigpIHsKICAgICAgcmV0dXJuIGdldExvY2F0aW9uKHdpbmRvdywgZ2xvYmFsSGlzdG9yeSk7CiAgICB9LAoKICAgIGxpc3RlbihmbikgewogICAgICBpZiAobGlzdGVuZXIpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkEgaGlzdG9yeSBvbmx5IGFjY2VwdHMgb25lIGFjdGl2ZSBsaXN0ZW5lciIpOwogICAgICB9CgogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihQb3BTdGF0ZUV2ZW50VHlwZSwgaGFuZGxlUG9wKTsKICAgICAgbGlzdGVuZXIgPSBmbjsKICAgICAgcmV0dXJuICgpID0+IHsKICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihQb3BTdGF0ZUV2ZW50VHlwZSwgaGFuZGxlUG9wKTsKICAgICAgICBsaXN0ZW5lciA9IG51bGw7CiAgICAgIH07CiAgICB9LAoKICAgIGNyZWF0ZUhyZWYodG8pIHsKICAgICAgcmV0dXJuIGNyZWF0ZUhyZWYod2luZG93LCB0byk7CiAgICB9LAoKICAgIGVuY29kZUxvY2F0aW9uKGxvY2F0aW9uKSB7CiAgICAgIC8vIEVuY29kZSBhIExvY2F0aW9uIHRoZSBzYW1lIHdheSB3aW5kb3cubG9jYXRpb24gd291bGQKICAgICAgbGV0IHVybCA9IGNyZWF0ZVVSTChyb3V0ZXJfY3JlYXRlUGF0aChsb2NhdGlvbikpOwogICAgICByZXR1cm4gX2V4dGVuZHMoe30sIGxvY2F0aW9uLCB7CiAgICAgICAgcGF0aG5hbWU6IHVybC5wYXRobmFtZSwKICAgICAgICBzZWFyY2g6IHVybC5zZWFyY2gsCiAgICAgICAgaGFzaDogdXJsLmhhc2gKICAgICAgfSk7CiAgICB9LAoKICAgIHB1c2gsCiAgICByZXBsYWNlLAoKICAgIGdvKG4pIHsKICAgICAgcmV0dXJuIGdsb2JhbEhpc3RvcnkuZ28obik7CiAgICB9CgogIH07CiAgcmV0dXJuIGhpc3Rvcnk7Cn0gLy8jZW5kcmVnaW9uCgp2YXIgUmVzdWx0VHlwZTsKCihmdW5jdGlvbiAoUmVzdWx0VHlwZSkgewogIFJlc3VsdFR5cGVbImRhdGEiXSA9ICJkYXRhIjsKICBSZXN1bHRUeXBlWyJkZWZlcnJlZCJdID0gImRlZmVycmVkIjsKICBSZXN1bHRUeXBlWyJyZWRpcmVjdCJdID0gInJlZGlyZWN0IjsKICBSZXN1bHRUeXBlWyJlcnJvciJdID0gImVycm9yIjsKfSkoUmVzdWx0VHlwZSB8fCAoUmVzdWx0VHlwZSA9IHt9KSk7CgpmdW5jdGlvbiBpc0luZGV4Um91dGUocm91dGUpIHsKICByZXR1cm4gcm91dGUuaW5kZXggPT09IHRydWU7Cn0gLy8gV2FsayB0aGUgcm91dGUgdHJlZSBnZW5lcmF0aW5nIHVuaXF1ZSBJRHMgd2hlcmUgbmVjZXNzYXJ5IHNvIHdlIGFyZSB3b3JraW5nCi8vIHNvbGVseSB3aXRoIEFnbm9zdGljRGF0YVJvdXRlT2JqZWN0J3Mgd2l0aGluIHRoZSBSb3V0ZXIKCgpmdW5jdGlvbiBjb252ZXJ0Um91dGVzVG9EYXRhUm91dGVzKHJvdXRlcywgcGFyZW50UGF0aCwgYWxsSWRzKSB7CiAgaWYgKHBhcmVudFBhdGggPT09IHZvaWQgMCkgewogICAgcGFyZW50UGF0aCA9IFtdOwogIH0KCiAgaWYgKGFsbElkcyA9PT0gdm9pZCAwKSB7CiAgICBhbGxJZHMgPSBuZXcgU2V0KCk7CiAgfQoKICByZXR1cm4gcm91dGVzLm1hcCgocm91dGUsIGluZGV4KSA9PiB7CiAgICBsZXQgdHJlZVBhdGggPSBbLi4ucGFyZW50UGF0aCwgaW5kZXhdOwogICAgbGV0IGlkID0gdHlwZW9mIHJvdXRlLmlkID09PSAic3RyaW5nIiA/IHJvdXRlLmlkIDogdHJlZVBhdGguam9pbigiLSIpOwogICAgcm91dGVyX2ludmFyaWFudChyb3V0ZS5pbmRleCAhPT0gdHJ1ZSB8fCAhcm91dGUuY2hpbGRyZW4sICJDYW5ub3Qgc3BlY2lmeSBjaGlsZHJlbiBvbiBhbiBpbmRleCByb3V0ZSIpOwogICAgcm91dGVyX2ludmFyaWFudCghYWxsSWRzLmhhcyhpZCksICJGb3VuZCBhIHJvdXRlIGlkIGNvbGxpc2lvbiBvbiBpZCBcIiIgKyBpZCArICJcIi4gIFJvdXRlICIgKyAiaWQncyBtdXN0IGJlIGdsb2JhbGx5IHVuaXF1ZSB3aXRoaW4gRGF0YSBSb3V0ZXIgdXNhZ2VzIik7CiAgICBhbGxJZHMuYWRkKGlkKTsKCiAgICBpZiAoaXNJbmRleFJvdXRlKHJvdXRlKSkgewogICAgICBsZXQgaW5kZXhSb3V0ZSA9IF9leHRlbmRzKHt9LCByb3V0ZSwgewogICAgICAgIGlkCiAgICAgIH0pOwoKICAgICAgcmV0dXJuIGluZGV4Um91dGU7CiAgICB9IGVsc2UgewogICAgICBsZXQgcGF0aE9yTGF5b3V0Um91dGUgPSBfZXh0ZW5kcyh7fSwgcm91dGUsIHsKICAgICAgICBpZCwKICAgICAgICBjaGlsZHJlbjogcm91dGUuY2hpbGRyZW4gPyBjb252ZXJ0Um91dGVzVG9EYXRhUm91dGVzKHJvdXRlLmNoaWxkcmVuLCB0cmVlUGF0aCwgYWxsSWRzKSA6IHVuZGVmaW5lZAogICAgICB9KTsKCiAgICAgIHJldHVybiBwYXRoT3JMYXlvdXRSb3V0ZTsKICAgIH0KICB9KTsKfQovKioKICogTWF0Y2hlcyB0aGUgZ2l2ZW4gcm91dGVzIHRvIGEgbG9jYXRpb24gYW5kIHJldHVybnMgdGhlIG1hdGNoIGRhdGEuCiAqCiAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni91dGlscy9tYXRjaC1yb3V0ZXMKICovCgpmdW5jdGlvbiBtYXRjaFJvdXRlcyhyb3V0ZXMsIGxvY2F0aW9uQXJnLCBiYXNlbmFtZSkgewogIGlmIChiYXNlbmFtZSA9PT0gdm9pZCAwKSB7CiAgICBiYXNlbmFtZSA9ICIvIjsKICB9CgogIGxldCBsb2NhdGlvbiA9IHR5cGVvZiBsb2NhdGlvbkFyZyA9PT0gInN0cmluZyIgPyBwYXJzZVBhdGgobG9jYXRpb25BcmcpIDogbG9jYXRpb25Bcmc7CiAgbGV0IHBhdGhuYW1lID0gc3RyaXBCYXNlbmFtZShsb2NhdGlvbi5wYXRobmFtZSB8fCAiLyIsIGJhc2VuYW1lKTsKCiAgaWYgKHBhdGhuYW1lID09IG51bGwpIHsKICAgIHJldHVybiBudWxsOwogIH0KCiAgbGV0IGJyYW5jaGVzID0gZmxhdHRlblJvdXRlcyhyb3V0ZXMpOwogIHJhbmtSb3V0ZUJyYW5jaGVzKGJyYW5jaGVzKTsKICBsZXQgbWF0Y2hlcyA9IG51bGw7CgogIGZvciAobGV0IGkgPSAwOyBtYXRjaGVzID09IG51bGwgJiYgaSA8IGJyYW5jaGVzLmxlbmd0aDsgKytpKSB7CiAgICBtYXRjaGVzID0gbWF0Y2hSb3V0ZUJyYW5jaChicmFuY2hlc1tpXSwgLy8gSW5jb21pbmcgcGF0aG5hbWVzIGFyZSBnZW5lcmFsbHkgZW5jb2RlZCBmcm9tIGVpdGhlciB3aW5kb3cubG9jYXRpb24KICAgIC8vIG9yIGZyb20gcm91dGVyLm5hdmlnYXRlLCBidXQgd2Ugd2FudCB0byBtYXRjaCBhZ2FpbnN0IHRoZSB1bmVuY29kZWQKICAgIC8vIHBhdGhzIGluIHRoZSByb3V0ZSBkZWZpbml0aW9ucy4gIE1lbW9yeSByb3V0ZXIgbG9jYXRpb25zIHdvbid0IGJlCiAgICAvLyBlbmNvZGVkIGhlcmUgYnV0IHRoZXJlIGFsc28gc2hvdWxkbid0IGJlIGFueXRoaW5nIHRvIGRlY29kZSBzbyB0aGlzCiAgICAvLyBzaG91bGQgYmUgYSBzYWZlIG9wZXJhdGlvbi4gIFRoaXMgYXZvaWRzIG5lZWRpbmcgbWF0Y2hSb3V0ZXMgdG8gYmUKICAgIC8vIGhpc3RvcnktYXdhcmUuCiAgICBzYWZlbHlEZWNvZGVVUkkocGF0aG5hbWUpKTsKICB9CgogIHJldHVybiBtYXRjaGVzOwp9CgpmdW5jdGlvbiBmbGF0dGVuUm91dGVzKHJvdXRlcywgYnJhbmNoZXMsIHBhcmVudHNNZXRhLCBwYXJlbnRQYXRoKSB7CiAgaWYgKGJyYW5jaGVzID09PSB2b2lkIDApIHsKICAgIGJyYW5jaGVzID0gW107CiAgfQoKICBpZiAocGFyZW50c01ldGEgPT09IHZvaWQgMCkgewogICAgcGFyZW50c01ldGEgPSBbXTsKICB9CgogIGlmIChwYXJlbnRQYXRoID09PSB2b2lkIDApIHsKICAgIHBhcmVudFBhdGggPSAiIjsKICB9CgogIHJvdXRlcy5mb3JFYWNoKChyb3V0ZSwgaW5kZXgpID0+IHsKICAgIGxldCBtZXRhID0gewogICAgICByZWxhdGl2ZVBhdGg6IHJvdXRlLnBhdGggfHwgIiIsCiAgICAgIGNhc2VTZW5zaXRpdmU6IHJvdXRlLmNhc2VTZW5zaXRpdmUgPT09IHRydWUsCiAgICAgIGNoaWxkcmVuSW5kZXg6IGluZGV4LAogICAgICByb3V0ZQogICAgfTsKCiAgICBpZiAobWV0YS5yZWxhdGl2ZVBhdGguc3RhcnRzV2l0aCgiLyIpKSB7CiAgICAgIHJvdXRlcl9pbnZhcmlhbnQobWV0YS5yZWxhdGl2ZVBhdGguc3RhcnRzV2l0aChwYXJlbnRQYXRoKSwgIkFic29sdXRlIHJvdXRlIHBhdGggXCIiICsgbWV0YS5yZWxhdGl2ZVBhdGggKyAiXCIgbmVzdGVkIHVuZGVyIHBhdGggIiArICgiXCIiICsgcGFyZW50UGF0aCArICJcIiBpcyBub3QgdmFsaWQuIEFuIGFic29sdXRlIGNoaWxkIHJvdXRlIHBhdGggIikgKyAibXVzdCBzdGFydCB3aXRoIHRoZSBjb21iaW5lZCBwYXRoIG9mIGFsbCBpdHMgcGFyZW50IHJvdXRlcy4iKTsKICAgICAgbWV0YS5yZWxhdGl2ZVBhdGggPSBtZXRhLnJlbGF0aXZlUGF0aC5zbGljZShwYXJlbnRQYXRoLmxlbmd0aCk7CiAgICB9CgogICAgbGV0IHBhdGggPSByb3V0ZXJfam9pblBhdGhzKFtwYXJlbnRQYXRoLCBtZXRhLnJlbGF0aXZlUGF0aF0pOwogICAgbGV0IHJvdXRlc01ldGEgPSBwYXJlbnRzTWV0YS5jb25jYXQobWV0YSk7IC8vIEFkZCB0aGUgY2hpbGRyZW4gYmVmb3JlIGFkZGluZyB0aGlzIHJvdXRlIHRvIHRoZSBhcnJheSBzbyB3ZSB0cmF2ZXJzZSB0aGUKICAgIC8vIHJvdXRlIHRyZWUgZGVwdGgtZmlyc3QgYW5kIGNoaWxkIHJvdXRlcyBhcHBlYXIgYmVmb3JlIHRoZWlyIHBhcmVudHMgaW4KICAgIC8vIHRoZSAiZmxhdHRlbmVkIiB2ZXJzaW9uLgoKICAgIGlmIChyb3V0ZS5jaGlsZHJlbiAmJiByb3V0ZS5jaGlsZHJlbi5sZW5ndGggPiAwKSB7CiAgICAgIHJvdXRlcl9pbnZhcmlhbnQoIC8vIE91ciB0eXBlcyBrbm93IGJldHRlciwgYnV0IHJ1bnRpbWUgSlMgbWF5IG5vdCEKICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvcgogICAgICByb3V0ZS5pbmRleCAhPT0gdHJ1ZSwgIkluZGV4IHJvdXRlcyBtdXN0IG5vdCBoYXZlIGNoaWxkIHJvdXRlcy4gUGxlYXNlIHJlbW92ZSAiICsgKCJhbGwgY2hpbGQgcm91dGVzIGZyb20gcm91dGUgcGF0aCBcIiIgKyBwYXRoICsgIlwiLiIpKTsKICAgICAgZmxhdHRlblJvdXRlcyhyb3V0ZS5jaGlsZHJlbiwgYnJhbmNoZXMsIHJvdXRlc01ldGEsIHBhdGgpOwogICAgfSAvLyBSb3V0ZXMgd2l0aG91dCBhIHBhdGggc2hvdWxkbid0IGV2ZXIgbWF0Y2ggYnkgdGhlbXNlbHZlcyB1bmxlc3MgdGhleSBhcmUKICAgIC8vIGluZGV4IHJvdXRlcywgc28gZG9uJ3QgYWRkIHRoZW0gdG8gdGhlIGxpc3Qgb2YgcG9zc2libGUgYnJhbmNoZXMuCgoKICAgIGlmIChyb3V0ZS5wYXRoID09IG51bGwgJiYgIXJvdXRlLmluZGV4KSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBicmFuY2hlcy5wdXNoKHsKICAgICAgcGF0aCwKICAgICAgc2NvcmU6IGNvbXB1dGVTY29yZShwYXRoLCByb3V0ZS5pbmRleCksCiAgICAgIHJvdXRlc01ldGEKICAgIH0pOwogIH0pOwogIHJldHVybiBicmFuY2hlczsKfQoKZnVuY3Rpb24gcmFua1JvdXRlQnJhbmNoZXMoYnJhbmNoZXMpIHsKICBicmFuY2hlcy5zb3J0KChhLCBiKSA9PiBhLnNjb3JlICE9PSBiLnNjb3JlID8gYi5zY29yZSAtIGEuc2NvcmUgLy8gSGlnaGVyIHNjb3JlIGZpcnN0CiAgOiBjb21wYXJlSW5kZXhlcyhhLnJvdXRlc01ldGEubWFwKG1ldGEgPT4gbWV0YS5jaGlsZHJlbkluZGV4KSwgYi5yb3V0ZXNNZXRhLm1hcChtZXRhID0+IG1ldGEuY2hpbGRyZW5JbmRleCkpKTsKfQoKY29uc3QgcGFyYW1SZSA9IC9eOlx3KyQvOwpjb25zdCBkeW5hbWljU2VnbWVudFZhbHVlID0gMzsKY29uc3QgaW5kZXhSb3V0ZVZhbHVlID0gMjsKY29uc3QgZW1wdHlTZWdtZW50VmFsdWUgPSAxOwpjb25zdCBzdGF0aWNTZWdtZW50VmFsdWUgPSAxMDsKY29uc3Qgc3BsYXRQZW5hbHR5ID0gLTI7Cgpjb25zdCBpc1NwbGF0ID0gcyA9PiBzID09PSAiKiI7CgpmdW5jdGlvbiBjb21wdXRlU2NvcmUocGF0aCwgaW5kZXgpIHsKICBsZXQgc2VnbWVudHMgPSBwYXRoLnNwbGl0KCIvIik7CiAgbGV0IGluaXRpYWxTY29yZSA9IHNlZ21lbnRzLmxlbmd0aDsKCiAgaWYgKHNlZ21lbnRzLnNvbWUoaXNTcGxhdCkpIHsKICAgIGluaXRpYWxTY29yZSArPSBzcGxhdFBlbmFsdHk7CiAgfQoKICBpZiAoaW5kZXgpIHsKICAgIGluaXRpYWxTY29yZSArPSBpbmRleFJvdXRlVmFsdWU7CiAgfQoKICByZXR1cm4gc2VnbWVudHMuZmlsdGVyKHMgPT4gIWlzU3BsYXQocykpLnJlZHVjZSgoc2NvcmUsIHNlZ21lbnQpID0+IHNjb3JlICsgKHBhcmFtUmUudGVzdChzZWdtZW50KSA/IGR5bmFtaWNTZWdtZW50VmFsdWUgOiBzZWdtZW50ID09PSAiIiA/IGVtcHR5U2VnbWVudFZhbHVlIDogc3RhdGljU2VnbWVudFZhbHVlKSwgaW5pdGlhbFNjb3JlKTsKfQoKZnVuY3Rpb24gY29tcGFyZUluZGV4ZXMoYSwgYikgewogIGxldCBzaWJsaW5ncyA9IGEubGVuZ3RoID09PSBiLmxlbmd0aCAmJiBhLnNsaWNlKDAsIC0xKS5ldmVyeSgobiwgaSkgPT4gbiA9PT0gYltpXSk7CiAgcmV0dXJuIHNpYmxpbmdzID8gLy8gSWYgdHdvIHJvdXRlcyBhcmUgc2libGluZ3MsIHdlIHNob3VsZCB0cnkgdG8gbWF0Y2ggdGhlIGVhcmxpZXIgc2libGluZwogIC8vIGZpcnN0LiBUaGlzIGFsbG93cyBwZW9wbGUgdG8gaGF2ZSBmaW5lLWdyYWluZWQgY29udHJvbCBvdmVyIHRoZSBtYXRjaGluZwogIC8vIGJlaGF2aW9yIGJ5IHNpbXBseSBwdXR0aW5nIHJvdXRlcyB3aXRoIGlkZW50aWNhbCBwYXRocyBpbiB0aGUgb3JkZXIgdGhleQogIC8vIHdhbnQgdGhlbSB0cmllZC4KICBhW2EubGVuZ3RoIC0gMV0gLSBiW2IubGVuZ3RoIC0gMV0gOiAvLyBPdGhlcndpc2UsIGl0IGRvZXNuJ3QgcmVhbGx5IG1ha2Ugc2Vuc2UgdG8gcmFuayBub24tc2libGluZ3MgYnkgaW5kZXgsCiAgLy8gc28gdGhleSBzb3J0IGVxdWFsbHkuCiAgMDsKfQoKZnVuY3Rpb24gbWF0Y2hSb3V0ZUJyYW5jaChicmFuY2gsIHBhdGhuYW1lKSB7CiAgbGV0IHsKICAgIHJvdXRlc01ldGEKICB9ID0gYnJhbmNoOwogIGxldCBtYXRjaGVkUGFyYW1zID0ge307CiAgbGV0IG1hdGNoZWRQYXRobmFtZSA9ICIvIjsKICBsZXQgbWF0Y2hlcyA9IFtdOwoKICBmb3IgKGxldCBpID0gMDsgaSA8IHJvdXRlc01ldGEubGVuZ3RoOyArK2kpIHsKICAgIGxldCBtZXRhID0gcm91dGVzTWV0YVtpXTsKICAgIGxldCBlbmQgPSBpID09PSByb3V0ZXNNZXRhLmxlbmd0aCAtIDE7CiAgICBsZXQgcmVtYWluaW5nUGF0aG5hbWUgPSBtYXRjaGVkUGF0aG5hbWUgPT09ICIvIiA/IHBhdGhuYW1lIDogcGF0aG5hbWUuc2xpY2UobWF0Y2hlZFBhdGhuYW1lLmxlbmd0aCkgfHwgIi8iOwogICAgbGV0IG1hdGNoID0gcm91dGVyX21hdGNoUGF0aCh7CiAgICAgIHBhdGg6IG1ldGEucmVsYXRpdmVQYXRoLAogICAgICBjYXNlU2Vuc2l0aXZlOiBtZXRhLmNhc2VTZW5zaXRpdmUsCiAgICAgIGVuZAogICAgfSwgcmVtYWluaW5nUGF0aG5hbWUpOwogICAgaWYgKCFtYXRjaCkgcmV0dXJuIG51bGw7CiAgICBPYmplY3QuYXNzaWduKG1hdGNoZWRQYXJhbXMsIG1hdGNoLnBhcmFtcyk7CiAgICBsZXQgcm91dGUgPSBtZXRhLnJvdXRlOwogICAgbWF0Y2hlcy5wdXNoKHsKICAgICAgLy8gVE9ETzogQ2FuIHRoaXMgYXMgYmUgYXZvaWRlZD8KICAgICAgcGFyYW1zOiBtYXRjaGVkUGFyYW1zLAogICAgICBwYXRobmFtZTogcm91dGVyX2pvaW5QYXRocyhbbWF0Y2hlZFBhdGhuYW1lLCBtYXRjaC5wYXRobmFtZV0pLAogICAgICBwYXRobmFtZUJhc2U6IG5vcm1hbGl6ZVBhdGhuYW1lKHJvdXRlcl9qb2luUGF0aHMoW21hdGNoZWRQYXRobmFtZSwgbWF0Y2gucGF0aG5hbWVCYXNlXSkpLAogICAgICByb3V0ZQogICAgfSk7CgogICAgaWYgKG1hdGNoLnBhdGhuYW1lQmFzZSAhPT0gIi8iKSB7CiAgICAgIG1hdGNoZWRQYXRobmFtZSA9IHJvdXRlcl9qb2luUGF0aHMoW21hdGNoZWRQYXRobmFtZSwgbWF0Y2gucGF0aG5hbWVCYXNlXSk7CiAgICB9CiAgfQoKICByZXR1cm4gbWF0Y2hlczsKfQovKioKICogUmV0dXJucyBhIHBhdGggd2l0aCBwYXJhbXMgaW50ZXJwb2xhdGVkLgogKgogKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvdXRpbHMvZ2VuZXJhdGUtcGF0aAogKi8KCgpmdW5jdGlvbiBnZW5lcmF0ZVBhdGgocGF0aCwgcGFyYW1zKSB7CiAgaWYgKHBhcmFtcyA9PT0gdm9pZCAwKSB7CiAgICBwYXJhbXMgPSB7fTsKICB9CgogIHJldHVybiBwYXRoLnJlcGxhY2UoLzooXHcrKS9nLCAoXywga2V5KSA9PiB7CiAgICByb3V0ZXJfaW52YXJpYW50KHBhcmFtc1trZXldICE9IG51bGwsICJNaXNzaW5nIFwiOiIgKyBrZXkgKyAiXCIgcGFyYW0iKTsKICAgIHJldHVybiBwYXJhbXNba2V5XTsKICB9KS5yZXBsYWNlKC8oXC8/KVwqLywgKF8sIHByZWZpeCwgX18sIHN0cikgPT4gewogICAgY29uc3Qgc3RhciA9ICIqIjsKCiAgICBpZiAocGFyYW1zW3N0YXJdID09IG51bGwpIHsKICAgICAgLy8gSWYgbm8gc3BsYXQgd2FzIHByb3ZpZGVkLCB0cmltIHRoZSB0cmFpbGluZyBzbGFzaCBfdW5sZXNzXyBpdCdzCiAgICAgIC8vIHRoZSBlbnRpcmUgcGF0aAogICAgICByZXR1cm4gc3RyID09PSAiLyoiID8gIi8iIDogIiI7CiAgICB9IC8vIEFwcGx5IHRoZSBzcGxhdAoKCiAgICByZXR1cm4gIiIgKyBwcmVmaXggKyBwYXJhbXNbc3Rhcl07CiAgfSk7Cn0KLyoqCiAqIFBlcmZvcm1zIHBhdHRlcm4gbWF0Y2hpbmcgb24gYSBVUkwgcGF0aG5hbWUgYW5kIHJldHVybnMgaW5mb3JtYXRpb24gYWJvdXQKICogdGhlIG1hdGNoLgogKgogKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvdXRpbHMvbWF0Y2gtcGF0aAogKi8KCmZ1bmN0aW9uIHJvdXRlcl9tYXRjaFBhdGgocGF0dGVybiwgcGF0aG5hbWUpIHsKICBpZiAodHlwZW9mIHBhdHRlcm4gPT09ICJzdHJpbmciKSB7CiAgICBwYXR0ZXJuID0gewogICAgICBwYXRoOiBwYXR0ZXJuLAogICAgICBjYXNlU2Vuc2l0aXZlOiBmYWxzZSwKICAgICAgZW5kOiB0cnVlCiAgICB9OwogIH0KCiAgbGV0IFttYXRjaGVyLCBwYXJhbU5hbWVzXSA9IGNvbXBpbGVQYXRoKHBhdHRlcm4ucGF0aCwgcGF0dGVybi5jYXNlU2Vuc2l0aXZlLCBwYXR0ZXJuLmVuZCk7CiAgbGV0IG1hdGNoID0gcGF0aG5hbWUubWF0Y2gobWF0Y2hlcik7CiAgaWYgKCFtYXRjaCkgcmV0dXJuIG51bGw7CiAgbGV0IG1hdGNoZWRQYXRobmFtZSA9IG1hdGNoWzBdOwogIGxldCBwYXRobmFtZUJhc2UgPSBtYXRjaGVkUGF0aG5hbWUucmVwbGFjZSgvKC4pXC8rJC8sICIkMSIpOwogIGxldCBjYXB0dXJlR3JvdXBzID0gbWF0Y2guc2xpY2UoMSk7CiAgbGV0IHBhcmFtcyA9IHBhcmFtTmFtZXMucmVkdWNlKChtZW1vLCBwYXJhbU5hbWUsIGluZGV4KSA9PiB7CiAgICAvLyBXZSBuZWVkIHRvIGNvbXB1dGUgdGhlIHBhdGhuYW1lQmFzZSBoZXJlIHVzaW5nIHRoZSByYXcgc3BsYXQgdmFsdWUKICAgIC8vIGluc3RlYWQgb2YgdXNpbmcgcGFyYW1zWyIqIl0gbGF0ZXIgYmVjYXVzZSBpdCB3aWxsIGJlIGRlY29kZWQgdGhlbgogICAgaWYgKHBhcmFtTmFtZSA9PT0gIioiKSB7CiAgICAgIGxldCBzcGxhdFZhbHVlID0gY2FwdHVyZUdyb3Vwc1tpbmRleF0gfHwgIiI7CiAgICAgIHBhdGhuYW1lQmFzZSA9IG1hdGNoZWRQYXRobmFtZS5zbGljZSgwLCBtYXRjaGVkUGF0aG5hbWUubGVuZ3RoIC0gc3BsYXRWYWx1ZS5sZW5ndGgpLnJlcGxhY2UoLyguKVwvKyQvLCAiJDEiKTsKICAgIH0KCiAgICBtZW1vW3BhcmFtTmFtZV0gPSBzYWZlbHlEZWNvZGVVUklDb21wb25lbnQoY2FwdHVyZUdyb3Vwc1tpbmRleF0gfHwgIiIsIHBhcmFtTmFtZSk7CiAgICByZXR1cm4gbWVtbzsKICB9LCB7fSk7CiAgcmV0dXJuIHsKICAgIHBhcmFtcywKICAgIHBhdGhuYW1lOiBtYXRjaGVkUGF0aG5hbWUsCiAgICBwYXRobmFtZUJhc2UsCiAgICBwYXR0ZXJuCiAgfTsKfQoKZnVuY3Rpb24gY29tcGlsZVBhdGgocGF0aCwgY2FzZVNlbnNpdGl2ZSwgZW5kKSB7CiAgaWYgKGNhc2VTZW5zaXRpdmUgPT09IHZvaWQgMCkgewogICAgY2FzZVNlbnNpdGl2ZSA9IGZhbHNlOwogIH0KCiAgaWYgKGVuZCA9PT0gdm9pZCAwKSB7CiAgICBlbmQgPSB0cnVlOwogIH0KCiAgd2FybmluZyhwYXRoID09PSAiKiIgfHwgIXBhdGguZW5kc1dpdGgoIioiKSB8fCBwYXRoLmVuZHNXaXRoKCIvKiIpLCAiUm91dGUgcGF0aCBcIiIgKyBwYXRoICsgIlwiIHdpbGwgYmUgdHJlYXRlZCBhcyBpZiBpdCB3ZXJlICIgKyAoIlwiIiArIHBhdGgucmVwbGFjZSgvXCokLywgIi8qIikgKyAiXCIgYmVjYXVzZSB0aGUgYCpgIGNoYXJhY3RlciBtdXN0ICIpICsgImFsd2F5cyBmb2xsb3cgYSBgL2AgaW4gdGhlIHBhdHRlcm4uIFRvIGdldCByaWQgb2YgdGhpcyB3YXJuaW5nLCAiICsgKCJwbGVhc2UgY2hhbmdlIHRoZSByb3V0ZSBwYXRoIHRvIFwiIiArIHBhdGgucmVwbGFjZSgvXCokLywgIi8qIikgKyAiXCIuIikpOwogIGxldCBwYXJhbU5hbWVzID0gW107CiAgbGV0IHJlZ2V4cFNvdXJjZSA9ICJeIiArIHBhdGgucmVwbGFjZSgvXC8qXCo/JC8sICIiKSAvLyBJZ25vcmUgdHJhaWxpbmcgLyBhbmQgLyosIHdlJ2xsIGhhbmRsZSBpdCBiZWxvdwogIC5yZXBsYWNlKC9eXC8qLywgIi8iKSAvLyBNYWtlIHN1cmUgaXQgaGFzIGEgbGVhZGluZyAvCiAgLnJlcGxhY2UoL1tcXC4qK14kP3t9fCgpW1xdXS9nLCAiXFwkJiIpIC8vIEVzY2FwZSBzcGVjaWFsIHJlZ2V4IGNoYXJzCiAgLnJlcGxhY2UoLzooXHcrKS9nLCAoXywgcGFyYW1OYW1lKSA9PiB7CiAgICBwYXJhbU5hbWVzLnB1c2gocGFyYW1OYW1lKTsKICAgIHJldHVybiAiKFteXFwvXSspIjsKICB9KTsKCiAgaWYgKHBhdGguZW5kc1dpdGgoIioiKSkgewogICAgcGFyYW1OYW1lcy5wdXNoKCIqIik7CiAgICByZWdleHBTb3VyY2UgKz0gcGF0aCA9PT0gIioiIHx8IHBhdGggPT09ICIvKiIgPyAiKC4qKSQiIC8vIEFscmVhZHkgbWF0Y2hlZCB0aGUgaW5pdGlhbCAvLCBqdXN0IG1hdGNoIHRoZSByZXN0CiAgICA6ICIoPzpcXC8oLispfFxcLyopJCI7IC8vIERvbid0IGluY2x1ZGUgdGhlIC8gaW4gcGFyYW1zWyIqIl0KICB9IGVsc2UgaWYgKGVuZCkgewogICAgLy8gV2hlbiBtYXRjaGluZyB0byB0aGUgZW5kLCBpZ25vcmUgdHJhaWxpbmcgc2xhc2hlcwogICAgcmVnZXhwU291cmNlICs9ICJcXC8qJCI7CiAgfSBlbHNlIGlmIChwYXRoICE9PSAiIiAmJiBwYXRoICE9PSAiLyIpIHsKICAgIC8vIElmIG91ciBwYXRoIGlzIG5vbi1lbXB0eSBhbmQgY29udGFpbnMgYW55dGhpbmcgYmV5b25kIGFuIGluaXRpYWwgc2xhc2gsCiAgICAvLyB0aGVuIHdlIGhhdmUgX3NvbWVfIGZvcm0gb2YgcGF0aCBpbiBvdXIgcmVnZXggc28gd2Ugc2hvdWxkIGV4cGVjdCB0bwogICAgLy8gbWF0Y2ggb25seSBpZiB3ZSBmaW5kIHRoZSBlbmQgb2YgdGhpcyBwYXRoIHNlZ21lbnQuICBMb29rIGZvciBhbiBvcHRpb25hbAogICAgLy8gbm9uLWNhcHR1cmVkIHRyYWlsaW5nIHNsYXNoICh0byBtYXRjaCBhIHBvcnRpb24gb2YgdGhlIFVSTCkgb3IgdGhlIGVuZAogICAgLy8gb2YgdGhlIHBhdGggKGlmIHdlJ3ZlIG1hdGNoZWQgdG8gdGhlIGVuZCkuICBXZSB1c2VkIHRvIGRvIHRoaXMgd2l0aCBhCiAgICAvLyB3b3JkIGJvdW5kYXJ5IGJ1dCB0aGF0IGdpdmVzIGZhbHNlIHBvc2l0aXZlcyBvbiByb3V0ZXMgbGlrZQogICAgLy8gL3VzZXItcHJlZmVyZW5jZXMgc2luY2UgYC1gIGNvdW50cyBhcyBhIHdvcmQgYm91bmRhcnkuCiAgICByZWdleHBTb3VyY2UgKz0gIig/Oig/PVxcL3wkKSkiOwogIH0gZWxzZSA7CgogIGxldCBtYXRjaGVyID0gbmV3IFJlZ0V4cChyZWdleHBTb3VyY2UsIGNhc2VTZW5zaXRpdmUgPyB1bmRlZmluZWQgOiAiaSIpOwogIHJldHVybiBbbWF0Y2hlciwgcGFyYW1OYW1lc107Cn0KCmZ1bmN0aW9uIHNhZmVseURlY29kZVVSSSh2YWx1ZSkgewogIHRyeSB7CiAgICByZXR1cm4gZGVjb2RlVVJJKHZhbHVlKTsKICB9IGNhdGNoIChlcnJvcikgewogICAgd2FybmluZyhmYWxzZSwgIlRoZSBVUkwgcGF0aCBcIiIgKyB2YWx1ZSArICJcIiBjb3VsZCBub3QgYmUgZGVjb2RlZCBiZWNhdXNlIGl0IGlzIGlzIGEgIiArICJtYWxmb3JtZWQgVVJMIHNlZ21lbnQuIFRoaXMgaXMgcHJvYmFibHkgZHVlIHRvIGEgYmFkIHBlcmNlbnQgIiArICgiZW5jb2RpbmcgKCIgKyBlcnJvciArICIpLiIpKTsKICAgIHJldHVybiB2YWx1ZTsKICB9Cn0KCmZ1bmN0aW9uIHNhZmVseURlY29kZVVSSUNvbXBvbmVudCh2YWx1ZSwgcGFyYW1OYW1lKSB7CiAgdHJ5IHsKICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQodmFsdWUpOwogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICB3YXJuaW5nKGZhbHNlLCAiVGhlIHZhbHVlIGZvciB0aGUgVVJMIHBhcmFtIFwiIiArIHBhcmFtTmFtZSArICJcIiB3aWxsIG5vdCBiZSBkZWNvZGVkIGJlY2F1c2UiICsgKCIgdGhlIHN0cmluZyBcIiIgKyB2YWx1ZSArICJcIiBpcyBhIG1hbGZvcm1lZCBVUkwgc2VnbWVudC4gVGhpcyBpcyBwcm9iYWJseSIpICsgKCIgZHVlIHRvIGEgYmFkIHBlcmNlbnQgZW5jb2RpbmcgKCIgKyBlcnJvciArICIpLiIpKTsKICAgIHJldHVybiB2YWx1ZTsKICB9Cn0KLyoqCiAqIEBwcml2YXRlCiAqLwoKCmZ1bmN0aW9uIHN0cmlwQmFzZW5hbWUocGF0aG5hbWUsIGJhc2VuYW1lKSB7CiAgaWYgKGJhc2VuYW1lID09PSAiLyIpIHJldHVybiBwYXRobmFtZTsKCiAgaWYgKCFwYXRobmFtZS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgoYmFzZW5hbWUudG9Mb3dlckNhc2UoKSkpIHsKICAgIHJldHVybiBudWxsOwogIH0gLy8gV2Ugd2FudCB0byBsZWF2ZSB0cmFpbGluZyBzbGFzaCBiZWhhdmlvciBpbiB0aGUgdXNlcidzIGNvbnRyb2wsIHNvIGlmIHRoZXkKICAvLyBzcGVjaWZ5IGEgYmFzZW5hbWUgd2l0aCBhIHRyYWlsaW5nIHNsYXNoLCB3ZSBzaG91bGQgc3VwcG9ydCBpdAoKCiAgbGV0IHN0YXJ0SW5kZXggPSBiYXNlbmFtZS5lbmRzV2l0aCgiLyIpID8gYmFzZW5hbWUubGVuZ3RoIC0gMSA6IGJhc2VuYW1lLmxlbmd0aDsKICBsZXQgbmV4dENoYXIgPSBwYXRobmFtZS5jaGFyQXQoc3RhcnRJbmRleCk7CgogIGlmIChuZXh0Q2hhciAmJiBuZXh0Q2hhciAhPT0gIi8iKSB7CiAgICAvLyBwYXRobmFtZSBkb2VzIG5vdCBzdGFydCB3aXRoIGJhc2VuYW1lLwogICAgcmV0dXJuIG51bGw7CiAgfQoKICByZXR1cm4gcGF0aG5hbWUuc2xpY2Uoc3RhcnRJbmRleCkgfHwgIi8iOwp9CmZ1bmN0aW9uIHJvdXRlcl9pbnZhcmlhbnQodmFsdWUsIG1lc3NhZ2UpIHsKICBpZiAodmFsdWUgPT09IGZhbHNlIHx8IHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gInVuZGVmaW5lZCIpIHsKICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTsKICB9Cn0KLyoqCiAqIEBwcml2YXRlCiAqLwoKZnVuY3Rpb24gd2FybmluZyhjb25kLCBtZXNzYWdlKSB7CiAgaWYgKCFjb25kKSB7CiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZQogICAgaWYgKHR5cGVvZiBjb25zb2xlICE9PSAidW5kZWZpbmVkIikgY29uc29sZS53YXJuKG1lc3NhZ2UpOwoKICAgIHRyeSB7CiAgICAgIC8vIFdlbGNvbWUgdG8gZGVidWdnaW5nIFJlYWN0IFJvdXRlciEKICAgICAgLy8KICAgICAgLy8gVGhpcyBlcnJvciBpcyB0aHJvd24gYXMgYSBjb252ZW5pZW5jZSBzbyB5b3UgY2FuIG1vcmUgZWFzaWx5CiAgICAgIC8vIGZpbmQgdGhlIHNvdXJjZSBmb3IgYSB3YXJuaW5nIHRoYXQgYXBwZWFycyBpbiB0aGUgY29uc29sZSBieQogICAgICAvLyBlbmFibGluZyAicGF1c2Ugb24gZXhjZXB0aW9ucyIgaW4geW91ciBKYXZhU2NyaXB0IGRlYnVnZ2VyLgogICAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1lbXB0eQogICAgfSBjYXRjaCAoZSkge30KICB9Cn0KLyoqCiAqIFJldHVybnMgYSByZXNvbHZlZCBwYXRoIG9iamVjdCByZWxhdGl2ZSB0byB0aGUgZ2l2ZW4gcGF0aG5hbWUuCiAqCiAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni91dGlscy9yZXNvbHZlLXBhdGgKICovCgpmdW5jdGlvbiByZXNvbHZlUGF0aCh0bywgZnJvbVBhdGhuYW1lKSB7CiAgaWYgKGZyb21QYXRobmFtZSA9PT0gdm9pZCAwKSB7CiAgICBmcm9tUGF0aG5hbWUgPSAiLyI7CiAgfQoKICBsZXQgewogICAgcGF0aG5hbWU6IHRvUGF0aG5hbWUsCiAgICBzZWFyY2ggPSAiIiwKICAgIGhhc2ggPSAiIgogIH0gPSB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gcGFyc2VQYXRoKHRvKSA6IHRvOwogIGxldCBwYXRobmFtZSA9IHRvUGF0aG5hbWUgPyB0b1BhdGhuYW1lLnN0YXJ0c1dpdGgoIi8iKSA/IHRvUGF0aG5hbWUgOiByZXNvbHZlUGF0aG5hbWUodG9QYXRobmFtZSwgZnJvbVBhdGhuYW1lKSA6IGZyb21QYXRobmFtZTsKICByZXR1cm4gewogICAgcGF0aG5hbWUsCiAgICBzZWFyY2g6IG5vcm1hbGl6ZVNlYXJjaChzZWFyY2gpLAogICAgaGFzaDogbm9ybWFsaXplSGFzaChoYXNoKQogIH07Cn0KCmZ1bmN0aW9uIHJlc29sdmVQYXRobmFtZShyZWxhdGl2ZVBhdGgsIGZyb21QYXRobmFtZSkgewogIGxldCBzZWdtZW50cyA9IGZyb21QYXRobmFtZS5yZXBsYWNlKC9cLyskLywgIiIpLnNwbGl0KCIvIik7CiAgbGV0IHJlbGF0aXZlU2VnbWVudHMgPSByZWxhdGl2ZVBhdGguc3BsaXQoIi8iKTsKICByZWxhdGl2ZVNlZ21lbnRzLmZvckVhY2goc2VnbWVudCA9PiB7CiAgICBpZiAoc2VnbWVudCA9PT0gIi4uIikgewogICAgICAvLyBLZWVwIHRoZSByb290ICIiIHNlZ21lbnQgc28gdGhlIHBhdGhuYW1lIHN0YXJ0cyBhdCAvCiAgICAgIGlmIChzZWdtZW50cy5sZW5ndGggPiAxKSBzZWdtZW50cy5wb3AoKTsKICAgIH0gZWxzZSBpZiAoc2VnbWVudCAhPT0gIi4iKSB7CiAgICAgIHNlZ21lbnRzLnB1c2goc2VnbWVudCk7CiAgICB9CiAgfSk7CiAgcmV0dXJuIHNlZ21lbnRzLmxlbmd0aCA+IDEgPyBzZWdtZW50cy5qb2luKCIvIikgOiAiLyI7Cn0KCmZ1bmN0aW9uIGdldEludmFsaWRQYXRoRXJyb3IoY2hhciwgZmllbGQsIGRlc3QsIHBhdGgpIHsKICByZXR1cm4gIkNhbm5vdCBpbmNsdWRlIGEgJyIgKyBjaGFyICsgIicgY2hhcmFjdGVyIGluIGEgbWFudWFsbHkgc3BlY2lmaWVkICIgKyAoImB0by4iICsgZmllbGQgKyAiYCBmaWVsZCBbIiArIEpTT04uc3RyaW5naWZ5KHBhdGgpICsgIl0uICBQbGVhc2Ugc2VwYXJhdGUgaXQgb3V0IHRvIHRoZSAiKSArICgiYHRvLiIgKyBkZXN0ICsgImAgZmllbGQuIEFsdGVybmF0aXZlbHkgeW91IG1heSBwcm92aWRlIHRoZSBmdWxsIHBhdGggYXMgIikgKyAiYSBzdHJpbmcgaW4gPExpbmsgdG89XCIuLi5cIj4gYW5kIHRoZSByb3V0ZXIgd2lsbCBwYXJzZSBpdCBmb3IgeW91LiI7Cn0KLyoqCiAqIEBwcml2YXRlCiAqCiAqIFdoZW4gcHJvY2Vzc2luZyByZWxhdGl2ZSBuYXZpZ2F0aW9uIHdlIHdhbnQgdG8gaWdub3JlIGFuY2VzdG9yIHJvdXRlcyB0aGF0CiAqIGRvIG5vdCBjb250cmlidXRlIHRvIHRoZSBwYXRoLCBzdWNoIHRoYXQgaW5kZXgvcGF0aGxlc3MgbGF5b3V0IHJvdXRlcyBkb24ndAogKiBpbnRlcmZlcmUuCiAqCiAqIEZvciBleGFtcGxlLCB3aGVuIG1vdmluZyBhIHJvdXRlIGVsZW1lbnQgaW50byBhbiBpbmRleCByb3V0ZSBhbmQvb3IgYQogKiBwYXRobGVzcyBsYXlvdXQgcm91dGUsIHJlbGF0aXZlIGxpbmsgYmVoYXZpb3IgY29udGFpbmVkIHdpdGhpbiBzaG91bGQgc3RheQogKiB0aGUgc2FtZS4gIEJvdGggb2YgdGhlIGZvbGxvd2luZyBleGFtcGxlcyBzaG91bGQgbGluayBiYWNrIHRvIHRoZSByb290OgogKgogKiAgIDxSb3V0ZSBwYXRoPSIvIj4KICogICAgIDxSb3V0ZSBwYXRoPSJhY2NvdW50cyIgZWxlbWVudD17PExpbmsgdG89Ii4uIn0+CiAqICAgPC9Sb3V0ZT4KICoKICogICA8Um91dGUgcGF0aD0iLyI+CiAqICAgICA8Um91dGUgcGF0aD0iYWNjb3VudHMiPgogKiAgICAgICA8Um91dGUgZWxlbWVudD17PEFjY291bnRzTGF5b3V0IC8+fT4gICAgICAgLy8gPC0tIERvZXMgbm90IGNvbnRyaWJ1dGUKICogICAgICAgICA8Um91dGUgaW5kZXggZWxlbWVudD17PExpbmsgdG89Ii4uIn0gLz4gIC8vIDwtLSBEb2VzIG5vdCBjb250cmlidXRlCiAqICAgICAgIDwvUm91dGUKICogICAgIDwvUm91dGU+CiAqICAgPC9Sb3V0ZT4KICovCgoKZnVuY3Rpb24gZ2V0UGF0aENvbnRyaWJ1dGluZ01hdGNoZXMobWF0Y2hlcykgewogIHJldHVybiBtYXRjaGVzLmZpbHRlcigobWF0Y2gsIGluZGV4KSA9PiBpbmRleCA9PT0gMCB8fCBtYXRjaC5yb3V0ZS5wYXRoICYmIG1hdGNoLnJvdXRlLnBhdGgubGVuZ3RoID4gMCk7Cn0KLyoqCiAqIEBwcml2YXRlCiAqLwoKZnVuY3Rpb24gcmVzb2x2ZVRvKHRvQXJnLCByb3V0ZVBhdGhuYW1lcywgbG9jYXRpb25QYXRobmFtZSwgaXNQYXRoUmVsYXRpdmUpIHsKICBpZiAoaXNQYXRoUmVsYXRpdmUgPT09IHZvaWQgMCkgewogICAgaXNQYXRoUmVsYXRpdmUgPSBmYWxzZTsKICB9CgogIGxldCB0bzsKCiAgaWYgKHR5cGVvZiB0b0FyZyA9PT0gInN0cmluZyIpIHsKICAgIHRvID0gcGFyc2VQYXRoKHRvQXJnKTsKICB9IGVsc2UgewogICAgdG8gPSBfZXh0ZW5kcyh7fSwgdG9BcmcpOwogICAgcm91dGVyX2ludmFyaWFudCghdG8ucGF0aG5hbWUgfHwgIXRvLnBhdGhuYW1lLmluY2x1ZGVzKCI/IiksIGdldEludmFsaWRQYXRoRXJyb3IoIj8iLCAicGF0aG5hbWUiLCAic2VhcmNoIiwgdG8pKTsKICAgIHJvdXRlcl9pbnZhcmlhbnQoIXRvLnBhdGhuYW1lIHx8ICF0by5wYXRobmFtZS5pbmNsdWRlcygiIyIpLCBnZXRJbnZhbGlkUGF0aEVycm9yKCIjIiwgInBhdGhuYW1lIiwgImhhc2giLCB0bykpOwogICAgcm91dGVyX2ludmFyaWFudCghdG8uc2VhcmNoIHx8ICF0by5zZWFyY2guaW5jbHVkZXMoIiMiKSwgZ2V0SW52YWxpZFBhdGhFcnJvcigiIyIsICJzZWFyY2giLCAiaGFzaCIsIHRvKSk7CiAgfQoKICBsZXQgaXNFbXB0eVBhdGggPSB0b0FyZyA9PT0gIiIgfHwgdG8ucGF0aG5hbWUgPT09ICIiOwogIGxldCB0b1BhdGhuYW1lID0gaXNFbXB0eVBhdGggPyAiLyIgOiB0by5wYXRobmFtZTsKICBsZXQgZnJvbTsgLy8gUm91dGluZyBpcyByZWxhdGl2ZSB0byB0aGUgY3VycmVudCBwYXRobmFtZSBpZiBleHBsaWNpdGx5IHJlcXVlc3RlZC4KICAvLwogIC8vIElmIGEgcGF0aG5hbWUgaXMgZXhwbGljaXRseSBwcm92aWRlZCBpbiBgdG9gLCBpdCBzaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlCiAgLy8gcm91dGUgY29udGV4dC4gVGhpcyBpcyBleHBsYWluZWQgaW4gYE5vdGUgb24gYDxMaW5rIHRvPmAgdmFsdWVzYCBpbiBvdXIKICAvLyBtaWdyYXRpb24gZ3VpZGUgZnJvbSB2NSBhcyBhIG1lYW5zIG9mIGRpc2FtYmlndWF0aW9uIGJldHdlZW4gYHRvYCB2YWx1ZXMKICAvLyB0aGF0IGJlZ2luIHdpdGggYC9gIGFuZCB0aG9zZSB0aGF0IGRvIG5vdC4gSG93ZXZlciwgdGhpcyBpcyBwcm9ibGVtYXRpYyBmb3IKICAvLyBgdG9gIHZhbHVlcyB0aGF0IGRvIG5vdCBwcm92aWRlIGEgcGF0aG5hbWUuIGB0b2AgY2FuIHNpbXBseSBiZSBhIHNlYXJjaCBvcgogIC8vIGhhc2ggc3RyaW5nLCBpbiB3aGljaCBjYXNlIHdlIHNob3VsZCBhc3N1bWUgdGhhdCB0aGUgbmF2aWdhdGlvbiBpcyByZWxhdGl2ZQogIC8vIHRvIHRoZSBjdXJyZW50IGxvY2F0aW9uJ3MgcGF0aG5hbWUgYW5kICpub3QqIHRoZSByb3V0ZSBwYXRobmFtZS4KCiAgaWYgKGlzUGF0aFJlbGF0aXZlIHx8IHRvUGF0aG5hbWUgPT0gbnVsbCkgewogICAgZnJvbSA9IGxvY2F0aW9uUGF0aG5hbWU7CiAgfSBlbHNlIHsKICAgIGxldCByb3V0ZVBhdGhuYW1lSW5kZXggPSByb3V0ZVBhdGhuYW1lcy5sZW5ndGggLSAxOwoKICAgIGlmICh0b1BhdGhuYW1lLnN0YXJ0c1dpdGgoIi4uIikpIHsKICAgICAgbGV0IHRvU2VnbWVudHMgPSB0b1BhdGhuYW1lLnNwbGl0KCIvIik7IC8vIEVhY2ggbGVhZGluZyAuLiBzZWdtZW50IG1lYW5zICJnbyB1cCBvbmUgcm91dGUiIGluc3RlYWQgb2YgImdvIHVwIG9uZQogICAgICAvLyBVUkwgc2VnbWVudCIuICBUaGlzIGlzIGEga2V5IGRpZmZlcmVuY2UgZnJvbSBob3cgPGEgaHJlZj4gd29ya3MgYW5kIGEKICAgICAgLy8gbWFqb3IgcmVhc29uIHdlIGNhbGwgdGhpcyBhICJ0byIgdmFsdWUgaW5zdGVhZCBvZiBhICJocmVmIi4KCiAgICAgIHdoaWxlICh0b1NlZ21lbnRzWzBdID09PSAiLi4iKSB7CiAgICAgICAgdG9TZWdtZW50cy5zaGlmdCgpOwogICAgICAgIHJvdXRlUGF0aG5hbWVJbmRleCAtPSAxOwogICAgICB9CgogICAgICB0by5wYXRobmFtZSA9IHRvU2VnbWVudHMuam9pbigiLyIpOwogICAgfSAvLyBJZiB0aGVyZSBhcmUgbW9yZSAiLi4iIHNlZ21lbnRzIHRoYW4gcGFyZW50IHJvdXRlcywgcmVzb2x2ZSByZWxhdGl2ZSB0bwogICAgLy8gdGhlIHJvb3QgLyBVUkwuCgoKICAgIGZyb20gPSByb3V0ZVBhdGhuYW1lSW5kZXggPj0gMCA/IHJvdXRlUGF0aG5hbWVzW3JvdXRlUGF0aG5hbWVJbmRleF0gOiAiLyI7CiAgfQoKICBsZXQgcGF0aCA9IHJlc29sdmVQYXRoKHRvLCBmcm9tKTsgLy8gRW5zdXJlIHRoZSBwYXRobmFtZSBoYXMgYSB0cmFpbGluZyBzbGFzaCBpZiB0aGUgb3JpZ2luYWwgInRvIiBoYWQgb25lCgogIGxldCBoYXNFeHBsaWNpdFRyYWlsaW5nU2xhc2ggPSB0b1BhdGhuYW1lICYmIHRvUGF0aG5hbWUgIT09ICIvIiAmJiB0b1BhdGhuYW1lLmVuZHNXaXRoKCIvIik7IC8vIE9yIGlmIHRoaXMgd2FzIGEgbGluayB0byB0aGUgY3VycmVudCBwYXRoIHdoaWNoIGhhcyBhIHRyYWlsaW5nIHNsYXNoCgogIGxldCBoYXNDdXJyZW50VHJhaWxpbmdTbGFzaCA9IChpc0VtcHR5UGF0aCB8fCB0b1BhdGhuYW1lID09PSAiLiIpICYmIGxvY2F0aW9uUGF0aG5hbWUuZW5kc1dpdGgoIi8iKTsKCiAgaWYgKCFwYXRoLnBhdGhuYW1lLmVuZHNXaXRoKCIvIikgJiYgKGhhc0V4cGxpY2l0VHJhaWxpbmdTbGFzaCB8fCBoYXNDdXJyZW50VHJhaWxpbmdTbGFzaCkpIHsKICAgIHBhdGgucGF0aG5hbWUgKz0gIi8iOwogIH0KCiAgcmV0dXJuIHBhdGg7Cn0KLyoqCiAqIEBwcml2YXRlCiAqLwoKZnVuY3Rpb24gZ2V0VG9QYXRobmFtZSh0bykgewogIC8vIEVtcHR5IHN0cmluZ3Mgc2hvdWxkIGJlIHRyZWF0ZWQgdGhlIHNhbWUgYXMgLyBwYXRocwogIHJldHVybiB0byA9PT0gIiIgfHwgdG8ucGF0aG5hbWUgPT09ICIiID8gIi8iIDogdHlwZW9mIHRvID09PSAic3RyaW5nIiA/IHBhcnNlUGF0aCh0bykucGF0aG5hbWUgOiB0by5wYXRobmFtZTsKfQovKioKICogQHByaXZhdGUKICovCgpjb25zdCByb3V0ZXJfam9pblBhdGhzID0gcGF0aHMgPT4gcGF0aHMuam9pbigiLyIpLnJlcGxhY2UoL1wvXC8rL2csICIvIik7Ci8qKgogKiBAcHJpdmF0ZQogKi8KCmNvbnN0IG5vcm1hbGl6ZVBhdGhuYW1lID0gcGF0aG5hbWUgPT4gcGF0aG5hbWUucmVwbGFjZSgvXC8rJC8sICIiKS5yZXBsYWNlKC9eXC8qLywgIi8iKTsKLyoqCiAqIEBwcml2YXRlCiAqLwoKY29uc3Qgbm9ybWFsaXplU2VhcmNoID0gc2VhcmNoID0+ICFzZWFyY2ggfHwgc2VhcmNoID09PSAiPyIgPyAiIiA6IHNlYXJjaC5zdGFydHNXaXRoKCI/IikgPyBzZWFyY2ggOiAiPyIgKyBzZWFyY2g7Ci8qKgogKiBAcHJpdmF0ZQogKi8KCmNvbnN0IG5vcm1hbGl6ZUhhc2ggPSBoYXNoID0+ICFoYXNoIHx8IGhhc2ggPT09ICIjIiA/ICIiIDogaGFzaC5zdGFydHNXaXRoKCIjIikgPyBoYXNoIDogIiMiICsgaGFzaDsKLyoqCiAqIFRoaXMgaXMgYSBzaG9ydGN1dCBmb3IgY3JlYXRpbmcgYGFwcGxpY2F0aW9uL2pzb25gIHJlc3BvbnNlcy4gQ29udmVydHMgYGRhdGFgCiAqIHRvIEpTT04gYW5kIHNldHMgdGhlIGBDb250ZW50LVR5cGVgIGhlYWRlci4KICovCgpjb25zdCBqc29uID0gZnVuY3Rpb24ganNvbihkYXRhLCBpbml0KSB7CiAgaWYgKGluaXQgPT09IHZvaWQgMCkgewogICAgaW5pdCA9IHt9OwogIH0KCiAgbGV0IHJlc3BvbnNlSW5pdCA9IHR5cGVvZiBpbml0ID09PSAibnVtYmVyIiA/IHsKICAgIHN0YXR1czogaW5pdAogIH0gOiBpbml0OwogIGxldCBoZWFkZXJzID0gbmV3IEhlYWRlcnMocmVzcG9uc2VJbml0LmhlYWRlcnMpOwoKICBpZiAoIWhlYWRlcnMuaGFzKCJDb250ZW50LVR5cGUiKSkgewogICAgaGVhZGVycy5zZXQoIkNvbnRlbnQtVHlwZSIsICJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04Iik7CiAgfQoKICByZXR1cm4gbmV3IFJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpLCBfZXh0ZW5kcyh7fSwgcmVzcG9uc2VJbml0LCB7CiAgICBoZWFkZXJzCiAgfSkpOwp9OwpjbGFzcyByb3V0ZXJfQWJvcnRlZERlZmVycmVkRXJyb3IgZXh0ZW5kcyBFcnJvciB7fQpjbGFzcyBEZWZlcnJlZERhdGEgewogIGNvbnN0cnVjdG9yKGRhdGEpIHsKICAgIHRoaXMucGVuZGluZ0tleXMgPSBuZXcgU2V0KCk7CiAgICB0aGlzLnN1YnNjcmliZXIgPSB1bmRlZmluZWQ7CiAgICByb3V0ZXJfaW52YXJpYW50KGRhdGEgJiYgdHlwZW9mIGRhdGEgPT09ICJvYmplY3QiICYmICFBcnJheS5pc0FycmF5KGRhdGEpLCAiZGVmZXIoKSBvbmx5IGFjY2VwdHMgcGxhaW4gb2JqZWN0cyIpOyAvLyBTZXQgdXAgYW4gQWJvcnRDb250cm9sbGVyICsgUHJvbWlzZSB3ZSBjYW4gcmFjZSBhZ2FpbnN0IHRvIGV4aXQgZWFybHkKICAgIC8vIGNhbmNlbGxhdGlvbgoKICAgIGxldCByZWplY3Q7CiAgICB0aGlzLmFib3J0UHJvbWlzZSA9IG5ldyBQcm9taXNlKChfLCByKSA9PiByZWplY3QgPSByKTsKICAgIHRoaXMuY29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKCiAgICBsZXQgb25BYm9ydCA9ICgpID0+IHJlamVjdChuZXcgcm91dGVyX0Fib3J0ZWREZWZlcnJlZEVycm9yKCJEZWZlcnJlZCBkYXRhIGFib3J0ZWQiKSk7CgogICAgdGhpcy51bmxpc3RlbkFib3J0U2lnbmFsID0gKCkgPT4gdGhpcy5jb250cm9sbGVyLnNpZ25hbC5yZW1vdmVFdmVudExpc3RlbmVyKCJhYm9ydCIsIG9uQWJvcnQpOwoKICAgIHRoaXMuY29udHJvbGxlci5zaWduYWwuYWRkRXZlbnRMaXN0ZW5lcigiYWJvcnQiLCBvbkFib3J0KTsKICAgIHRoaXMuZGF0YSA9IE9iamVjdC5lbnRyaWVzKGRhdGEpLnJlZHVjZSgoYWNjLCBfcmVmKSA9PiB7CiAgICAgIGxldCBba2V5LCB2YWx1ZV0gPSBfcmVmOwogICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihhY2MsIHsKICAgICAgICBba2V5XTogdGhpcy50cmFja1Byb21pc2Uoa2V5LCB2YWx1ZSkKICAgICAgfSk7CiAgICB9LCB7fSk7CiAgfQoKICB0cmFja1Byb21pc2Uoa2V5LCB2YWx1ZSkgewogICAgaWYgKCEodmFsdWUgaW5zdGFuY2VvZiBQcm9taXNlKSkgewogICAgICByZXR1cm4gdmFsdWU7CiAgICB9CgogICAgdGhpcy5wZW5kaW5nS2V5cy5hZGQoa2V5KTsgLy8gV2Ugc3RvcmUgYSBsaXR0bGUgd3JhcHBlciBwcm9taXNlIHRoYXQgd2lsbCBiZSBleHRlbmRlZCB3aXRoCiAgICAvLyBfZGF0YS9fZXJyb3IgcHJvcHMgdXBvbiByZXNvbHZlL3JlamVjdAoKICAgIGxldCBwcm9taXNlID0gUHJvbWlzZS5yYWNlKFt2YWx1ZSwgdGhpcy5hYm9ydFByb21pc2VdKS50aGVuKGRhdGEgPT4gdGhpcy5vblNldHRsZShwcm9taXNlLCBrZXksIG51bGwsIGRhdGEpLCBlcnJvciA9PiB0aGlzLm9uU2V0dGxlKHByb21pc2UsIGtleSwgZXJyb3IpKTsgLy8gUmVnaXN0ZXIgcmVqZWN0aW9uIGxpc3RlbmVycyB0byBhdm9pZCB1bmNhdWdodCBwcm9taXNlIHJlamVjdGlvbnMgb24KICAgIC8vIGVycm9ycyBvciBhYm9ydGVkIGRlZmVycmVkIHZhbHVlcwoKICAgIHByb21pc2UuY2F0Y2goKCkgPT4ge30pOwogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb21pc2UsICJfdHJhY2tlZCIsIHsKICAgICAgZ2V0OiAoKSA9PiB0cnVlCiAgICB9KTsKICAgIHJldHVybiBwcm9taXNlOwogIH0KCiAgb25TZXR0bGUocHJvbWlzZSwga2V5LCBlcnJvciwgZGF0YSkgewogICAgaWYgKHRoaXMuY29udHJvbGxlci5zaWduYWwuYWJvcnRlZCAmJiBlcnJvciBpbnN0YW5jZW9mIHJvdXRlcl9BYm9ydGVkRGVmZXJyZWRFcnJvcikgewogICAgICB0aGlzLnVubGlzdGVuQWJvcnRTaWduYWwoKTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb21pc2UsICJfZXJyb3IiLCB7CiAgICAgICAgZ2V0OiAoKSA9PiBlcnJvcgogICAgICB9KTsKICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKICAgIH0KCiAgICB0aGlzLnBlbmRpbmdLZXlzLmRlbGV0ZShrZXkpOwoKICAgIGlmICh0aGlzLmRvbmUpIHsKICAgICAgLy8gTm90aGluZyBsZWZ0IHRvIGFib3J0IQogICAgICB0aGlzLnVubGlzdGVuQWJvcnRTaWduYWwoKTsKICAgIH0KCiAgICBjb25zdCBzdWJzY3JpYmVyID0gdGhpcy5zdWJzY3JpYmVyOwoKICAgIGlmIChlcnJvcikgewogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvbWlzZSwgIl9lcnJvciIsIHsKICAgICAgICBnZXQ6ICgpID0+IGVycm9yCiAgICAgIH0pOwogICAgICBzdWJzY3JpYmVyICYmIHN1YnNjcmliZXIoZmFsc2UpOwogICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpOwogICAgfQoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9taXNlLCAiX2RhdGEiLCB7CiAgICAgIGdldDogKCkgPT4gZGF0YQogICAgfSk7CiAgICBzdWJzY3JpYmVyICYmIHN1YnNjcmliZXIoZmFsc2UpOwogICAgcmV0dXJuIGRhdGE7CiAgfQoKICBzdWJzY3JpYmUoZm4pIHsKICAgIHRoaXMuc3Vic2NyaWJlciA9IGZuOwogIH0KCiAgY2FuY2VsKCkgewogICAgdGhpcy5jb250cm9sbGVyLmFib3J0KCk7CiAgICB0aGlzLnBlbmRpbmdLZXlzLmZvckVhY2goKHYsIGspID0+IHRoaXMucGVuZGluZ0tleXMuZGVsZXRlKGspKTsKICAgIGxldCBzdWJzY3JpYmVyID0gdGhpcy5zdWJzY3JpYmVyOwogICAgc3Vic2NyaWJlciAmJiBzdWJzY3JpYmVyKHRydWUpOwogIH0KCiAgYXN5bmMgcmVzb2x2ZURhdGEoc2lnbmFsKSB7CiAgICBsZXQgYWJvcnRlZCA9IGZhbHNlOwoKICAgIGlmICghdGhpcy5kb25lKSB7CiAgICAgIGxldCBvbkFib3J0ID0gKCkgPT4gdGhpcy5jYW5jZWwoKTsKCiAgICAgIHNpZ25hbC5hZGRFdmVudExpc3RlbmVyKCJhYm9ydCIsIG9uQWJvcnQpOwogICAgICBhYm9ydGVkID0gYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7CiAgICAgICAgdGhpcy5zdWJzY3JpYmUoYWJvcnRlZCA9PiB7CiAgICAgICAgICBzaWduYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYWJvcnQiLCBvbkFib3J0KTsKCiAgICAgICAgICBpZiAoYWJvcnRlZCB8fCB0aGlzLmRvbmUpIHsKICAgICAgICAgICAgcmVzb2x2ZShhYm9ydGVkKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgcmV0dXJuIGFib3J0ZWQ7CiAgfQoKICBnZXQgZG9uZSgpIHsKICAgIHJldHVybiB0aGlzLnBlbmRpbmdLZXlzLnNpemUgPT09IDA7CiAgfQoKICBnZXQgdW53cmFwcGVkRGF0YSgpIHsKICAgIHJvdXRlcl9pbnZhcmlhbnQodGhpcy5kYXRhICE9PSBudWxsICYmIHRoaXMuZG9uZSwgIkNhbiBvbmx5IHVud3JhcCBkYXRhIG9uIGluaXRpYWxpemVkIGFuZCBzZXR0bGVkIGRlZmVycmVkcyIpOwogICAgcmV0dXJuIE9iamVjdC5lbnRyaWVzKHRoaXMuZGF0YSkucmVkdWNlKChhY2MsIF9yZWYyKSA9PiB7CiAgICAgIGxldCBba2V5LCB2YWx1ZV0gPSBfcmVmMjsKICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oYWNjLCB7CiAgICAgICAgW2tleV06IHVud3JhcFRyYWNrZWRQcm9taXNlKHZhbHVlKQogICAgICB9KTsKICAgIH0sIHt9KTsKICB9Cgp9CgpmdW5jdGlvbiBpc1RyYWNrZWRQcm9taXNlKHZhbHVlKSB7CiAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUHJvbWlzZSAmJiB2YWx1ZS5fdHJhY2tlZCA9PT0gdHJ1ZTsKfQoKZnVuY3Rpb24gdW53cmFwVHJhY2tlZFByb21pc2UodmFsdWUpIHsKICBpZiAoIWlzVHJhY2tlZFByb21pc2UodmFsdWUpKSB7CiAgICByZXR1cm4gdmFsdWU7CiAgfQoKICBpZiAodmFsdWUuX2Vycm9yKSB7CiAgICB0aHJvdyB2YWx1ZS5fZXJyb3I7CiAgfQoKICByZXR1cm4gdmFsdWUuX2RhdGE7Cn0KCmZ1bmN0aW9uIGRlZmVyKGRhdGEpIHsKICByZXR1cm4gbmV3IERlZmVycmVkRGF0YShkYXRhKTsKfQovKioKICogQSByZWRpcmVjdCByZXNwb25zZS4gU2V0cyB0aGUgc3RhdHVzIGNvZGUgYW5kIHRoZSBgTG9jYXRpb25gIGhlYWRlci4KICogRGVmYXVsdHMgdG8gIjMwMiBGb3VuZCIuCiAqLwoKY29uc3QgcmVkaXJlY3QgPSBmdW5jdGlvbiByZWRpcmVjdCh1cmwsIGluaXQpIHsKICBpZiAoaW5pdCA9PT0gdm9pZCAwKSB7CiAgICBpbml0ID0gMzAyOwogIH0KCiAgbGV0IHJlc3BvbnNlSW5pdCA9IGluaXQ7CgogIGlmICh0eXBlb2YgcmVzcG9uc2VJbml0ID09PSAibnVtYmVyIikgewogICAgcmVzcG9uc2VJbml0ID0gewogICAgICBzdGF0dXM6IHJlc3BvbnNlSW5pdAogICAgfTsKICB9IGVsc2UgaWYgKHR5cGVvZiByZXNwb25zZUluaXQuc3RhdHVzID09PSAidW5kZWZpbmVkIikgewogICAgcmVzcG9uc2VJbml0LnN0YXR1cyA9IDMwMjsKICB9CgogIGxldCBoZWFkZXJzID0gbmV3IEhlYWRlcnMocmVzcG9uc2VJbml0LmhlYWRlcnMpOwogIGhlYWRlcnMuc2V0KCJMb2NhdGlvbiIsIHVybCk7CiAgcmV0dXJuIG5ldyBSZXNwb25zZShudWxsLCBfZXh0ZW5kcyh7fSwgcmVzcG9uc2VJbml0LCB7CiAgICBoZWFkZXJzCiAgfSkpOwp9OwovKioKICogQHByaXZhdGUKICogVXRpbGl0eSBjbGFzcyB3ZSB1c2UgdG8gaG9sZCBhdXRvLXVud3JhcHBlZCA0eHgvNXh4IFJlc3BvbnNlIGJvZGllcwogKi8KCmNsYXNzIEVycm9yUmVzcG9uc2UgewogIGNvbnN0cnVjdG9yKHN0YXR1cywgc3RhdHVzVGV4dCwgZGF0YSkgewogICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7CiAgICB0aGlzLnN0YXR1c1RleHQgPSBzdGF0dXNUZXh0IHx8ICIiOwogICAgdGhpcy5kYXRhID0gZGF0YTsKICB9Cgp9Ci8qKgogKiBDaGVjayBpZiB0aGUgZ2l2ZW4gZXJyb3IgaXMgYW4gRXJyb3JSZXNwb25zZSBnZW5lcmF0ZWQgZnJvbSBhIDR4eC81eHgKICogUmVzcG9uc2UgdGhyb3cgZnJvbSBhbiBhY3Rpb24vbG9hZGVyCiAqLwoKZnVuY3Rpb24gaXNSb3V0ZUVycm9yUmVzcG9uc2UoZSkgewogIHJldHVybiBlIGluc3RhbmNlb2YgRXJyb3JSZXNwb25zZTsKfQoKY29uc3QgSURMRV9OQVZJR0FUSU9OID0gewogIHN0YXRlOiAiaWRsZSIsCiAgbG9jYXRpb246IHVuZGVmaW5lZCwKICBmb3JtTWV0aG9kOiB1bmRlZmluZWQsCiAgZm9ybUFjdGlvbjogdW5kZWZpbmVkLAogIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsCiAgZm9ybURhdGE6IHVuZGVmaW5lZAp9Owpjb25zdCBJRExFX0ZFVENIRVIgPSB7CiAgc3RhdGU6ICJpZGxlIiwKICBkYXRhOiB1bmRlZmluZWQsCiAgZm9ybU1ldGhvZDogdW5kZWZpbmVkLAogIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwKICBmb3JtRW5jVHlwZTogdW5kZWZpbmVkLAogIGZvcm1EYXRhOiB1bmRlZmluZWQKfTsKY29uc3QgaXNCcm93c2VyID0gdHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mIHdpbmRvdy5kb2N1bWVudCAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mIHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50ICE9PSAidW5kZWZpbmVkIjsKY29uc3QgaXNTZXJ2ZXIgPSAhaXNCcm93c2VyOyAvLyNlbmRyZWdpb24KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8jcmVnaW9uIGNyZWF0ZVJvdXRlcgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKLyoqCiAqIENyZWF0ZSBhIHJvdXRlciBhbmQgbGlzdGVuIHRvIGhpc3RvcnkgUE9QIG5hdmlnYXRpb25zCiAqLwoKZnVuY3Rpb24gcm91dGVyX2NyZWF0ZVJvdXRlcihpbml0KSB7CiAgcm91dGVyX2ludmFyaWFudChpbml0LnJvdXRlcy5sZW5ndGggPiAwLCAiWW91IG11c3QgcHJvdmlkZSBhIG5vbi1lbXB0eSByb3V0ZXMgYXJyYXkgdG8gY3JlYXRlUm91dGVyIik7CiAgbGV0IGRhdGFSb3V0ZXMgPSBjb252ZXJ0Um91dGVzVG9EYXRhUm91dGVzKGluaXQucm91dGVzKTsgLy8gQ2xlYW51cCBmdW5jdGlvbiBmb3IgaGlzdG9yeQoKICBsZXQgdW5saXN0ZW5IaXN0b3J5ID0gbnVsbDsgLy8gRXh0ZXJuYWxseS1wcm92aWRlZCBmdW5jdGlvbnMgdG8gY2FsbCBvbiBhbGwgc3RhdGUgY2hhbmdlcwoKICBsZXQgc3Vic2NyaWJlcnMgPSBuZXcgU2V0KCk7IC8vIEV4dGVybmFsbHktcHJvdmlkZWQgb2JqZWN0IHRvIGhvbGQgc2Nyb2xsIHJlc3RvcmF0aW9uIGxvY2F0aW9ucyBkdXJpbmcgcm91dGluZwoKICBsZXQgc2F2ZWRTY3JvbGxQb3NpdGlvbnMgPSBudWxsOyAvLyBFeHRlcm5hbGx5LXByb3ZpZGVkIGZ1bmN0aW9uIHRvIGdldCBzY3JvbGwgcmVzdG9yYXRpb24ga2V5cwoKICBsZXQgZ2V0U2Nyb2xsUmVzdG9yYXRpb25LZXkgPSBudWxsOyAvLyBFeHRlcm5hbGx5LXByb3ZpZGVkIGZ1bmN0aW9uIHRvIGdldCBjdXJyZW50IHNjcm9sbCBwb3NpdGlvbgoKICBsZXQgZ2V0U2Nyb2xsUG9zaXRpb24gPSBudWxsOyAvLyBPbmUtdGltZSBmbGFnIHRvIGNvbnRyb2wgdGhlIGluaXRpYWwgaHlkcmF0aW9uIHNjcm9sbCByZXN0b3JhdGlvbi4gIEJlY2F1c2UKICAvLyB3ZSBkb24ndCBnZXQgdGhlIHNhdmVkIHBvc2l0aW9ucyBmcm9tIDxTY3JvbGxSZXN0b3JhdGlvbiAvPiB1bnRpbCBfYWZ0ZXJfCiAgLy8gdGhlIGluaXRpYWwgcmVuZGVyLCB3ZSBuZWVkIHRvIG1hbnVhbGx5IHRyaWdnZXIgYSBzZXBhcmF0ZSB1cGRhdGVTdGF0ZSB0bwogIC8vIHNlbmQgYWxvbmcgdGhlIHJlc3RvcmVTY3JvbGxQb3NpdGlvbgoKICBsZXQgaW5pdGlhbFNjcm9sbFJlc3RvcmVkID0gZmFsc2U7CiAgbGV0IGluaXRpYWxNYXRjaGVzID0gbWF0Y2hSb3V0ZXMoZGF0YVJvdXRlcywgaW5pdC5oaXN0b3J5LmxvY2F0aW9uLCBpbml0LmJhc2VuYW1lKTsKICBsZXQgaW5pdGlhbEVycm9ycyA9IG51bGw7CgogIGlmIChpbml0aWFsTWF0Y2hlcyA9PSBudWxsKSB7CiAgICAvLyBJZiB3ZSBkbyBub3QgbWF0Y2ggYSB1c2VyLXByb3ZpZGVkLXJvdXRlLCBmYWxsIGJhY2sgdG8gdGhlIHJvb3QKICAgIC8vIHRvIGFsbG93IHRoZSBlcnJvciBib3VuZGFyeSB0byB0YWtlIG92ZXIKICAgIGxldCB7CiAgICAgIG1hdGNoZXMsCiAgICAgIHJvdXRlLAogICAgICBlcnJvcgogICAgfSA9IGdldE5vdEZvdW5kTWF0Y2hlcyhkYXRhUm91dGVzKTsKICAgIGluaXRpYWxNYXRjaGVzID0gbWF0Y2hlczsKICAgIGluaXRpYWxFcnJvcnMgPSB7CiAgICAgIFtyb3V0ZS5pZF06IGVycm9yCiAgICB9OwogIH0KCiAgbGV0IGluaXRpYWxpemVkID0gIWluaXRpYWxNYXRjaGVzLnNvbWUobSA9PiBtLnJvdXRlLmxvYWRlcikgfHwgaW5pdC5oeWRyYXRpb25EYXRhICE9IG51bGw7CiAgbGV0IHJvdXRlcjsKICBsZXQgc3RhdGUgPSB7CiAgICBoaXN0b3J5QWN0aW9uOiBpbml0Lmhpc3RvcnkuYWN0aW9uLAogICAgbG9jYXRpb246IGluaXQuaGlzdG9yeS5sb2NhdGlvbiwKICAgIG1hdGNoZXM6IGluaXRpYWxNYXRjaGVzLAogICAgaW5pdGlhbGl6ZWQsCiAgICBuYXZpZ2F0aW9uOiBJRExFX05BVklHQVRJT04sCiAgICByZXN0b3JlU2Nyb2xsUG9zaXRpb246IG51bGwsCiAgICBwcmV2ZW50U2Nyb2xsUmVzZXQ6IGZhbHNlLAogICAgcmV2YWxpZGF0aW9uOiAiaWRsZSIsCiAgICBsb2FkZXJEYXRhOiBpbml0Lmh5ZHJhdGlvbkRhdGEgJiYgaW5pdC5oeWRyYXRpb25EYXRhLmxvYWRlckRhdGEgfHwge30sCiAgICBhY3Rpb25EYXRhOiBpbml0Lmh5ZHJhdGlvbkRhdGEgJiYgaW5pdC5oeWRyYXRpb25EYXRhLmFjdGlvbkRhdGEgfHwgbnVsbCwKICAgIGVycm9yczogaW5pdC5oeWRyYXRpb25EYXRhICYmIGluaXQuaHlkcmF0aW9uRGF0YS5lcnJvcnMgfHwgaW5pdGlhbEVycm9ycywKICAgIGZldGNoZXJzOiBuZXcgTWFwKCkKICB9OyAvLyAtLSBTdGF0ZWZ1bCBpbnRlcm5hbCB2YXJpYWJsZXMgdG8gbWFuYWdlIG5hdmlnYXRpb25zIC0tCiAgLy8gQ3VycmVudCBuYXZpZ2F0aW9uIGluIHByb2dyZXNzICh0byBiZSBjb21taXR0ZWQgaW4gY29tcGxldGVOYXZpZ2F0aW9uKQoKICBsZXQgcGVuZGluZ0FjdGlvbiA9IEFjdGlvbi5Qb3A7IC8vIFNob3VsZCB0aGUgY3VycmVudCBuYXZpZ2F0aW9uIHByZXZlbnQgdGhlIHNjcm9sbCByZXNldCBpZiBzY3JvbGwgY2Fubm90CiAgLy8gYmUgcmVzdG9yZWQ/CgogIGxldCBwZW5kaW5nUHJldmVudFNjcm9sbFJlc2V0ID0gZmFsc2U7IC8vIEFib3J0Q29udHJvbGxlciBmb3IgdGhlIGFjdGl2ZSBuYXZpZ2F0aW9uCgogIGxldCBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXI7IC8vIFdlIHVzZSB0aGlzIHRvIGF2b2lkIHRvdWNoaW5nIGhpc3RvcnkgaW4gY29tcGxldGVOYXZpZ2F0aW9uIGlmIGEKICAvLyByZXZhbGlkYXRpb24gaXMgZW50aXJlbHkgdW5pbnRlcnJ1cHRlZAoKICBsZXQgaXNVbmludGVycnVwdGVkUmV2YWxpZGF0aW9uID0gZmFsc2U7IC8vIFVzZSB0aGlzIGludGVybmFsIGZsYWcgdG8gZm9yY2UgcmV2YWxpZGF0aW9uIG9mIGFsbCBsb2FkZXJzOgogIC8vICAtIHN1Ym1pc3Npb25zIChjb21wbGV0ZWQgb3IgaW50ZXJydXB0ZWQpCiAgLy8gIC0gdXNlUmV2YWxpZGF0ZSgpCiAgLy8gIC0gWC1SZW1peC1SZXZhbGlkYXRlIChmcm9tIHJlZGlyZWN0KQoKICBsZXQgaXNSZXZhbGlkYXRpb25SZXF1aXJlZCA9IGZhbHNlOyAvLyBVc2UgdGhpcyBpbnRlcm5hbCBhcnJheSB0byBjYXB0dXJlIHJvdXRlcyB0aGF0IHJlcXVpcmUgcmV2YWxpZGF0aW9uIGR1ZQogIC8vIHRvIGEgY2FuY2VsbGVkIGRlZmVycmVkIG9uIGFjdGlvbiBzdWJtaXNzaW9uCgogIGxldCBjYW5jZWxsZWREZWZlcnJlZFJvdXRlcyA9IFtdOyAvLyBVc2UgdGhpcyBpbnRlcm5hbCBhcnJheSB0byBjYXB0dXJlIGZldGNoZXIgbG9hZHMgdGhhdCB3ZXJlIGNhbmNlbGxlZCBieSBhbgogIC8vIGFjdGlvbiBuYXZpZ2F0aW9uIGFuZCByZXF1aXJlIHJldmFsaWRhdGlvbgoKICBsZXQgY2FuY2VsbGVkRmV0Y2hlckxvYWRzID0gW107IC8vIEFib3J0Q29udHJvbGxlcnMgZm9yIGFueSBpbi1mbGlnaHQgZmV0Y2hlcnMKCiAgbGV0IGZldGNoQ29udHJvbGxlcnMgPSBuZXcgTWFwKCk7IC8vIFRyYWNrIGxvYWRzIGJhc2VkIG9uIHRoZSBvcmRlciBpbiB3aGljaCB0aGV5IHN0YXJ0ZWQKCiAgbGV0IGluY3JlbWVudGluZ0xvYWRJZCA9IDA7IC8vIFRyYWNrIHRoZSBvdXRzdGFuZGluZyBwZW5kaW5nIG5hdmlnYXRpb24gZGF0YSBsb2FkIHRvIGJlIGNvbXBhcmVkIGFnYWluc3QKICAvLyB0aGUgZ2xvYmFsbHkgaW5jcmVtZW50aW5nIGxvYWQgd2hlbiBhIGZldGNoZXIgbG9hZCBsYW5kcyBhZnRlciBhIGNvbXBsZXRlZAogIC8vIG5hdmlnYXRpb24KCiAgbGV0IHBlbmRpbmdOYXZpZ2F0aW9uTG9hZElkID0gLTE7IC8vIEZldGNoZXJzIHRoYXQgdHJpZ2dlcmVkIGRhdGEgcmVsb2FkcyBhcyBhIHJlc3VsdCBvZiB0aGVpciBhY3Rpb25zCgogIGxldCBmZXRjaFJlbG9hZElkcyA9IG5ldyBNYXAoKTsgLy8gRmV0Y2hlcnMgdGhhdCB0cmlnZ2VyZWQgcmVkaXJlY3QgbmF2aWdhdGlvbnMgZnJvbSB0aGVpciBhY3Rpb25zCgogIGxldCBmZXRjaFJlZGlyZWN0SWRzID0gbmV3IFNldCgpOyAvLyBNb3N0IHJlY2VudCBocmVmL21hdGNoIGZvciBmZXRjaGVyLmxvYWQgY2FsbHMgZm9yIGZldGNoZXJzCgogIGxldCBmZXRjaExvYWRNYXRjaGVzID0gbmV3IE1hcCgpOyAvLyBTdG9yZSBEZWZlcnJlZERhdGEgaW5zdGFuY2VzIGZvciBhY3RpdmUgcm91dGUgbWF0Y2hlcy4gIFdoZW4gYQogIC8vIHJvdXRlIGxvYWRlciByZXR1cm5zIGRlZmVyKCkgd2Ugc3RpY2sgb25lIGluIGhlcmUuICBUaGVuLCB3aGVuIGEgbmVzdGVkCiAgLy8gcHJvbWlzZSByZXNvbHZlcyB3ZSB1cGRhdGUgbG9hZGVyRGF0YS4gIElmIGEgbmV3IG5hdmlnYXRpb24gc3RhcnRzIHdlCiAgLy8gY2FuY2VsIGFjdGl2ZSBkZWZlcnJlZHMgZm9yIGVsaW1pbmF0ZWQgcm91dGVzLgoKICBsZXQgYWN0aXZlRGVmZXJyZWRzID0gbmV3IE1hcCgpOyAvLyBJbml0aWFsaXplIHRoZSByb3V0ZXIsIGFsbCBzaWRlIGVmZmVjdHMgc2hvdWxkIGJlIGtpY2tlZCBvZmYgZnJvbSBoZXJlLgogIC8vIEltcGxlbWVudGVkIGFzIGEgRmx1ZW50IEFQSSBmb3IgZWFzZSBvZjoKICAvLyAgIGxldCByb3V0ZXIgPSBjcmVhdGVSb3V0ZXIoaW5pdCkuaW5pdGlhbGl6ZSgpOwoKICBmdW5jdGlvbiBpbml0aWFsaXplKCkgewogICAgLy8gSWYgaGlzdG9yeSBpbmZvcm1zIHVzIG9mIGEgUE9QIG5hdmlnYXRpb24sIHN0YXJ0IHRoZSBuYXZpZ2F0aW9uIGJ1dCBkbyBub3QgdXBkYXRlCiAgICAvLyBzdGF0ZS4gIFdlJ2xsIHVwZGF0ZSBvdXIgb3duIHN0YXRlIG9uY2UgdGhlIG5hdmlnYXRpb24gY29tcGxldGVzCiAgICB1bmxpc3Rlbkhpc3RvcnkgPSBpbml0Lmhpc3RvcnkubGlzdGVuKF9yZWYgPT4gewogICAgICBsZXQgewogICAgICAgIGFjdGlvbjogaGlzdG9yeUFjdGlvbiwKICAgICAgICBsb2NhdGlvbgogICAgICB9ID0gX3JlZjsKICAgICAgcmV0dXJuIHN0YXJ0TmF2aWdhdGlvbihoaXN0b3J5QWN0aW9uLCBsb2NhdGlvbik7CiAgICB9KTsgLy8gS2ljayBvZmYgaW5pdGlhbCBkYXRhIGxvYWQgaWYgbmVlZGVkLiAgVXNlIFBvcCB0byBhdm9pZCBtb2RpZnlpbmcgaGlzdG9yeQoKICAgIGlmICghc3RhdGUuaW5pdGlhbGl6ZWQpIHsKICAgICAgc3RhcnROYXZpZ2F0aW9uKEFjdGlvbi5Qb3AsIHN0YXRlLmxvY2F0aW9uKTsKICAgIH0KCiAgICByZXR1cm4gcm91dGVyOwogIH0gLy8gQ2xlYW4gdXAgYSByb3V0ZXIgYW5kIGl0J3Mgc2lkZSBlZmZlY3RzCgoKICBmdW5jdGlvbiBkaXNwb3NlKCkgewogICAgaWYgKHVubGlzdGVuSGlzdG9yeSkgewogICAgICB1bmxpc3Rlbkhpc3RvcnkoKTsKICAgIH0KCiAgICBzdWJzY3JpYmVycy5jbGVhcigpOwogICAgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyICYmIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlci5hYm9ydCgpOwogICAgc3RhdGUuZmV0Y2hlcnMuZm9yRWFjaCgoXywga2V5KSA9PiBkZWxldGVGZXRjaGVyKGtleSkpOwogIH0gLy8gU3Vic2NyaWJlIHRvIHN0YXRlIHVwZGF0ZXMgZm9yIHRoZSByb3V0ZXIKCgogIGZ1bmN0aW9uIHN1YnNjcmliZShmbikgewogICAgc3Vic2NyaWJlcnMuYWRkKGZuKTsKICAgIHJldHVybiAoKSA9PiBzdWJzY3JpYmVycy5kZWxldGUoZm4pOwogIH0gLy8gVXBkYXRlIG91ciBzdGF0ZSBhbmQgbm90aWZ5IHRoZSBjYWxsaW5nIGNvbnRleHQgb2YgdGhlIGNoYW5nZQoKCiAgZnVuY3Rpb24gdXBkYXRlU3RhdGUobmV3U3RhdGUpIHsKICAgIHN0YXRlID0gX2V4dGVuZHMoe30sIHN0YXRlLCBuZXdTdGF0ZSk7CiAgICBzdWJzY3JpYmVycy5mb3JFYWNoKHN1YnNjcmliZXIgPT4gc3Vic2NyaWJlcihzdGF0ZSkpOwogIH0gLy8gQ29tcGxldGUgYSBuYXZpZ2F0aW9uIHJldHVybmluZyB0aGUgc3RhdGUubmF2aWdhdGlvbiBiYWNrIHRvIHRoZSBJRExFX05BVklHQVRJT04KICAvLyBhbmQgc2V0dGluZyBzdGF0ZS5baGlzdG9yeUFjdGlvbi9sb2NhdGlvbi9tYXRjaGVzXSB0byB0aGUgbmV3IHJvdXRlLgogIC8vIC0gTG9jYXRpb24gaXMgYSByZXF1aXJlZCBwYXJhbQogIC8vIC0gTmF2aWdhdGlvbiB3aWxsIGFsd2F5cyBiZSBzZXQgdG8gSURMRV9OQVZJR0FUSU9OCiAgLy8gLSBDYW4gcGFzcyBhbnkgb3RoZXIgc3RhdGUgaW4gbmV3U3RhdGUKCgogIGZ1bmN0aW9uIGNvbXBsZXRlTmF2aWdhdGlvbihsb2NhdGlvbiwgbmV3U3RhdGUpIHsKICAgIHZhciBfc3RhdGUkbmF2aWdhdGlvbiRmb3I7CgogICAgLy8gRGVkdWNlIGlmIHdlJ3JlIGluIGEgbG9hZGluZy9hY3Rpb25SZWxvYWQgc3RhdGU6CiAgICAvLyAtIFdlIGhhdmUgY29tbWl0dGVkIGFjdGlvbkRhdGEgaW4gdGhlIHN0b3JlCiAgICAvLyAtIFRoZSBjdXJyZW50IG5hdmlnYXRpb24gd2FzIGEgc3VibWlzc2lvbgogICAgLy8gLSBXZSdyZSBwYXN0IHRoZSBzdWJtaXR0aW5nIHN0YXRlIGFuZCBpbnRvIHRoZSBsb2FkaW5nIHN0YXRlCiAgICAvLyAtIFRoZSBsb2NhdGlvbiB3ZSd2ZSBmaW5pc2hlZCBsb2FkaW5nIGlzIGRpZmZlcmVudCBmcm9tIHRoZSBzdWJtaXNzaW9uCiAgICAvLyAgIGxvY2F0aW9uLCBpbmRpY2F0aW5nIHdlIHJlZGlyZWN0ZWQgZnJvbSB0aGUgYWN0aW9uIChhdm9pZHMgZmFsc2UKICAgIC8vICAgcG9zaXRpdmVzIGZvciBsb2FkaW5nL3N1Ym1pc3Npb25SZWRpcmVjdCB3aGVuIGFjdGlvbkRhdGEgcmV0dXJuZWQKICAgIC8vICAgb24gYSBwcmlvciBzdWJtaXNzaW9uKQogICAgbGV0IGlzQWN0aW9uUmVsb2FkID0gc3RhdGUuYWN0aW9uRGF0YSAhPSBudWxsICYmIHN0YXRlLm5hdmlnYXRpb24uZm9ybU1ldGhvZCAhPSBudWxsICYmIHN0YXRlLm5hdmlnYXRpb24uc3RhdGUgPT09ICJsb2FkaW5nIiAmJiAoKF9zdGF0ZSRuYXZpZ2F0aW9uJGZvciA9IHN0YXRlLm5hdmlnYXRpb24uZm9ybUFjdGlvbikgPT0gbnVsbCA/IHZvaWQgMCA6IF9zdGF0ZSRuYXZpZ2F0aW9uJGZvci5zcGxpdCgiPyIpWzBdKSA9PT0gbG9jYXRpb24ucGF0aG5hbWU7IC8vIEFsd2F5cyBwcmVzZXJ2ZSBhbnkgZXhpc3RpbmcgbG9hZGVyRGF0YSBmcm9tIHJlLXVzZWQgcm91dGVzCgogICAgbGV0IG5ld0xvYWRlckRhdGEgPSBuZXdTdGF0ZS5sb2FkZXJEYXRhID8gewogICAgICBsb2FkZXJEYXRhOiBtZXJnZUxvYWRlckRhdGEoc3RhdGUubG9hZGVyRGF0YSwgbmV3U3RhdGUubG9hZGVyRGF0YSwgbmV3U3RhdGUubWF0Y2hlcyB8fCBbXSkKICAgIH0gOiB7fTsKICAgIHVwZGF0ZVN0YXRlKF9leHRlbmRzKHt9LCBpc0FjdGlvblJlbG9hZCA/IHt9IDogewogICAgICBhY3Rpb25EYXRhOiBudWxsCiAgICB9LCBuZXdTdGF0ZSwgbmV3TG9hZGVyRGF0YSwgewogICAgICBoaXN0b3J5QWN0aW9uOiBwZW5kaW5nQWN0aW9uLAogICAgICBsb2NhdGlvbiwKICAgICAgaW5pdGlhbGl6ZWQ6IHRydWUsCiAgICAgIG5hdmlnYXRpb246IElETEVfTkFWSUdBVElPTiwKICAgICAgcmV2YWxpZGF0aW9uOiAiaWRsZSIsCiAgICAgIC8vIERvbid0IHJlc3RvcmUgb24gc3VibWlzc2lvbiBuYXZpZ2F0aW9ucwogICAgICByZXN0b3JlU2Nyb2xsUG9zaXRpb246IHN0YXRlLm5hdmlnYXRpb24uZm9ybURhdGEgPyBmYWxzZSA6IGdldFNhdmVkU2Nyb2xsUG9zaXRpb24obG9jYXRpb24sIG5ld1N0YXRlLm1hdGNoZXMgfHwgc3RhdGUubWF0Y2hlcyksCiAgICAgIHByZXZlbnRTY3JvbGxSZXNldDogcGVuZGluZ1ByZXZlbnRTY3JvbGxSZXNldAogICAgfSkpOwoKICAgIGlmIChpc1VuaW50ZXJydXB0ZWRSZXZhbGlkYXRpb24pIDsgZWxzZSBpZiAocGVuZGluZ0FjdGlvbiA9PT0gQWN0aW9uLlBvcCkgOyBlbHNlIGlmIChwZW5kaW5nQWN0aW9uID09PSBBY3Rpb24uUHVzaCkgewogICAgICBpbml0Lmhpc3RvcnkucHVzaChsb2NhdGlvbiwgbG9jYXRpb24uc3RhdGUpOwogICAgfSBlbHNlIGlmIChwZW5kaW5nQWN0aW9uID09PSBBY3Rpb24uUmVwbGFjZSkgewogICAgICBpbml0Lmhpc3RvcnkucmVwbGFjZShsb2NhdGlvbiwgbG9jYXRpb24uc3RhdGUpOwogICAgfSAvLyBSZXNldCBzdGF0ZWZ1bCBuYXZpZ2F0aW9uIHZhcnMKCgogICAgcGVuZGluZ0FjdGlvbiA9IEFjdGlvbi5Qb3A7CiAgICBwZW5kaW5nUHJldmVudFNjcm9sbFJlc2V0ID0gZmFsc2U7CiAgICBpc1VuaW50ZXJydXB0ZWRSZXZhbGlkYXRpb24gPSBmYWxzZTsKICAgIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQgPSBmYWxzZTsKICAgIGNhbmNlbGxlZERlZmVycmVkUm91dGVzID0gW107CiAgICBjYW5jZWxsZWRGZXRjaGVyTG9hZHMgPSBbXTsKICB9IC8vIFRyaWdnZXIgYSBuYXZpZ2F0aW9uIGV2ZW50LCB3aGljaCBjYW4gZWl0aGVyIGJlIGEgbnVtZXJpY2FsIFBPUCBvciBhIFBVU0gKICAvLyByZXBsYWNlIHdpdGggYW4gb3B0aW9uYWwgc3VibWlzc2lvbgoKCiAgYXN5bmMgZnVuY3Rpb24gbmF2aWdhdGUodG8sIG9wdHMpIHsKICAgIGlmICh0eXBlb2YgdG8gPT09ICJudW1iZXIiKSB7CiAgICAgIGluaXQuaGlzdG9yeS5nbyh0byk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBsZXQgewogICAgICBwYXRoLAogICAgICBzdWJtaXNzaW9uLAogICAgICBlcnJvcgogICAgfSA9IG5vcm1hbGl6ZU5hdmlnYXRlT3B0aW9ucyh0bywgb3B0cyk7CiAgICBsZXQgbG9jYXRpb24gPSBjcmVhdGVMb2NhdGlvbihzdGF0ZS5sb2NhdGlvbiwgcGF0aCwgb3B0cyAmJiBvcHRzLnN0YXRlKTsgLy8gV2hlbiB1c2luZyBuYXZpZ2F0ZSBhcyBhIFBVU0gvUkVQTEFDRSB3ZSBhcmVuJ3QgcmVhZGluZyBhbiBhbHJlYWR5LWVuY29kZWQKICAgIC8vIFVSTCBmcm9tIHdpbmRvdy5sb2NhdGlvbiwgc28gd2UgbmVlZCB0byBlbmNvZGUgaXQgaGVyZSBzbyB0aGUgYmVoYXZpb3IKICAgIC8vIHJlbWFpbnMgdGhlIHNhbWUgYXMgUE9QIGFuZCBub24tZGF0YS1yb3V0ZXIgdXNhZ2VzLiAgbmV3IFVSTCgpIGRvZXMgYWxsCiAgICAvLyB0aGUgc2FtZSBlbmNvZGluZyB3ZSdkIGdldCBmcm9tIGEgaGlzdG9yeS5wdXNoU3RhdGUvd2luZG93LmxvY2F0aW9uIHJlYWQKICAgIC8vIHdpdGhvdXQgaGF2aW5nIHRvIHRvdWNoIGhpc3RvcnkKCiAgICBsb2NhdGlvbiA9IGluaXQuaGlzdG9yeS5lbmNvZGVMb2NhdGlvbihsb2NhdGlvbik7CiAgICBsZXQgaGlzdG9yeUFjdGlvbiA9IChvcHRzICYmIG9wdHMucmVwbGFjZSkgPT09IHRydWUgfHwgc3VibWlzc2lvbiAhPSBudWxsID8gQWN0aW9uLlJlcGxhY2UgOiBBY3Rpb24uUHVzaDsKICAgIGxldCBwcmV2ZW50U2Nyb2xsUmVzZXQgPSBvcHRzICYmICJwcmV2ZW50U2Nyb2xsUmVzZXQiIGluIG9wdHMgPyBvcHRzLnByZXZlbnRTY3JvbGxSZXNldCA9PT0gdHJ1ZSA6IHVuZGVmaW5lZDsKICAgIHJldHVybiBhd2FpdCBzdGFydE5hdmlnYXRpb24oaGlzdG9yeUFjdGlvbiwgbG9jYXRpb24sIHsKICAgICAgc3VibWlzc2lvbiwKICAgICAgLy8gU2VuZCB0aHJvdWdoIHRoZSBmb3JtRGF0YSBzZXJpYWxpemF0aW9uIGVycm9yIGlmIHdlIGhhdmUgb25lIHNvIHdlIGNhbgogICAgICAvLyByZW5kZXIgYXQgdGhlIHJpZ2h0IGVycm9yIGJvdW5kYXJ5IGFmdGVyIHdlIG1hdGNoIHJvdXRlcwogICAgICBwZW5kaW5nRXJyb3I6IGVycm9yLAogICAgICBwcmV2ZW50U2Nyb2xsUmVzZXQsCiAgICAgIHJlcGxhY2U6IG9wdHMgJiYgb3B0cy5yZXBsYWNlCiAgICB9KTsKICB9IC8vIFJldmFsaWRhdGUgYWxsIGN1cnJlbnQgbG9hZGVycy4gIElmIGEgbmF2aWdhdGlvbiBpcyBpbiBwcm9ncmVzcyBvciBpZiB0aGlzCiAgLy8gaXMgaW50ZXJydXB0ZWQgYnkgYSBuYXZpZ2F0aW9uLCBhbGxvdyB0aGlzIHRvICJzdWNjZWVkIiBieSBjYWxsaW5nIGFsbAogIC8vIGxvYWRlcnMgZHVyaW5nIHRoZSBuZXh0IGxvYWRlciByb3VuZAoKCiAgZnVuY3Rpb24gcmV2YWxpZGF0ZSgpIHsKICAgIGludGVycnVwdEFjdGl2ZUxvYWRzKCk7CiAgICB1cGRhdGVTdGF0ZSh7CiAgICAgIHJldmFsaWRhdGlvbjogImxvYWRpbmciCiAgICB9KTsgLy8gSWYgd2UncmUgY3VycmVudGx5IHN1Ym1pdHRpbmcgYW4gYWN0aW9uLCB3ZSBkb24ndCBuZWVkIHRvIHN0YXJ0IGEgbmV3CiAgICAvLyBuYXZpZ2F0aW9uLCB3ZSdsbCBqdXN0IGxldCB0aGUgZm9sbG93IHVwIGxvYWRlciBleGVjdXRpb24gY2FsbCBhbGwgbG9hZGVycwoKICAgIGlmIChzdGF0ZS5uYXZpZ2F0aW9uLnN0YXRlID09PSAic3VibWl0dGluZyIpIHsKICAgICAgcmV0dXJuOwogICAgfSAvLyBJZiB3ZSdyZSBjdXJyZW50bHkgaW4gYW4gaWRsZSBzdGF0ZSwgc3RhcnQgYSBuZXcgbmF2aWdhdGlvbiBmb3IgdGhlIGN1cnJlbnQKICAgIC8vIGFjdGlvbi9sb2NhdGlvbiBhbmQgbWFyayBpdCBhcyB1bmludGVycnVwdGVkLCB3aGljaCB3aWxsIHNraXAgdGhlIGhpc3RvcnkKICAgIC8vIHVwZGF0ZSBpbiBjb21wbGV0ZU5hdmlnYXRpb24KCgogICAgaWYgKHN0YXRlLm5hdmlnYXRpb24uc3RhdGUgPT09ICJpZGxlIikgewogICAgICBzdGFydE5hdmlnYXRpb24oc3RhdGUuaGlzdG9yeUFjdGlvbiwgc3RhdGUubG9jYXRpb24sIHsKICAgICAgICBzdGFydFVuaW50ZXJydXB0ZWRSZXZhbGlkYXRpb246IHRydWUKICAgICAgfSk7CiAgICAgIHJldHVybjsKICAgIH0gLy8gT3RoZXJ3aXNlLCBpZiB3ZSdyZSBjdXJyZW50bHkgaW4gYSBsb2FkaW5nIHN0YXRlLCBqdXN0IHN0YXJ0IGEgbmV3CiAgICAvLyBuYXZpZ2F0aW9uIHRvIHRoZSBuYXZpZ2F0aW9uLmxvY2F0aW9uIGJ1dCBkbyBub3QgdHJpZ2dlciBhbiB1bmludGVycnVwdGVkCiAgICAvLyByZXZhbGlkYXRpb24gc28gdGhhdCBoaXN0b3J5IGNvcnJlY3RseSB1cGRhdGVzIG9uY2UgdGhlIG5hdmlnYXRpb24gY29tcGxldGVzCgoKICAgIHN0YXJ0TmF2aWdhdGlvbihwZW5kaW5nQWN0aW9uIHx8IHN0YXRlLmhpc3RvcnlBY3Rpb24sIHN0YXRlLm5hdmlnYXRpb24ubG9jYXRpb24sIHsKICAgICAgb3ZlcnJpZGVOYXZpZ2F0aW9uOiBzdGF0ZS5uYXZpZ2F0aW9uCiAgICB9KTsKICB9IC8vIFN0YXJ0IGEgbmF2aWdhdGlvbiB0byB0aGUgZ2l2ZW4gYWN0aW9uL2xvY2F0aW9uLiAgQ2FuIG9wdGlvbmFsbHkgcHJvdmlkZSBhCiAgLy8gb3ZlcnJpZGVOYXZpZ2F0aW9uIHdoaWNoIHdpbGwgb3ZlcnJpZGUgdGhlIG5vcm1hbExvYWQgaW4gdGhlIGNhc2Ugb2YgYSByZWRpcmVjdAogIC8vIG5hdmlnYXRpb24KCgogIGFzeW5jIGZ1bmN0aW9uIHN0YXJ0TmF2aWdhdGlvbihoaXN0b3J5QWN0aW9uLCBsb2NhdGlvbiwgb3B0cykgewogICAgLy8gQWJvcnQgYW55IGluLXByb2dyZXNzIG5hdmlnYXRpb25zIGFuZCBzdGFydCBhIG5ldyBvbmUuIFVuc2V0IGFueSBvbmdvaW5nCiAgICAvLyB1bmludGVycnVwdGVkIHJldmFsaWRhdGlvbnMgdW5sZXNzIHRvbGQgb3RoZXJ3aXNlLCBzaW5jZSB3ZSB3YW50IHRoaXMKICAgIC8vIG5ldyBuYXZpZ2F0aW9uIHRvIHVwZGF0ZSBoaXN0b3J5IG5vcm1hbGx5CiAgICBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIgJiYgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyLmFib3J0KCk7CiAgICBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIgPSBudWxsOwogICAgcGVuZGluZ0FjdGlvbiA9IGhpc3RvcnlBY3Rpb247CiAgICBpc1VuaW50ZXJydXB0ZWRSZXZhbGlkYXRpb24gPSAob3B0cyAmJiBvcHRzLnN0YXJ0VW5pbnRlcnJ1cHRlZFJldmFsaWRhdGlvbikgPT09IHRydWU7IC8vIFNhdmUgdGhlIGN1cnJlbnQgc2Nyb2xsIHBvc2l0aW9uIGV2ZXJ5IHRpbWUgd2Ugc3RhcnQgYSBuZXcgbmF2aWdhdGlvbiwKICAgIC8vIGFuZCB0cmFjayB3aGV0aGVyIHdlIHNob3VsZCByZXNldCBzY3JvbGwgb24gY29tcGxldGlvbgoKICAgIHNhdmVTY3JvbGxQb3NpdGlvbihzdGF0ZS5sb2NhdGlvbiwgc3RhdGUubWF0Y2hlcyk7CiAgICBwZW5kaW5nUHJldmVudFNjcm9sbFJlc2V0ID0gKG9wdHMgJiYgb3B0cy5wcmV2ZW50U2Nyb2xsUmVzZXQpID09PSB0cnVlOwogICAgbGV0IGxvYWRpbmdOYXZpZ2F0aW9uID0gb3B0cyAmJiBvcHRzLm92ZXJyaWRlTmF2aWdhdGlvbjsKICAgIGxldCBtYXRjaGVzID0gbWF0Y2hSb3V0ZXMoZGF0YVJvdXRlcywgbG9jYXRpb24sIGluaXQuYmFzZW5hbWUpOyAvLyBTaG9ydCBjaXJjdWl0IHdpdGggYSA0MDQgb24gdGhlIHJvb3QgZXJyb3IgYm91bmRhcnkgaWYgd2UgbWF0Y2ggbm90aGluZwoKICAgIGlmICghbWF0Y2hlcykgewogICAgICBsZXQgewogICAgICAgIG1hdGNoZXM6IG5vdEZvdW5kTWF0Y2hlcywKICAgICAgICByb3V0ZSwKICAgICAgICBlcnJvcgogICAgICB9ID0gZ2V0Tm90Rm91bmRNYXRjaGVzKGRhdGFSb3V0ZXMpOyAvLyBDYW5jZWwgYWxsIHBlbmRpbmcgZGVmZXJyZWQgb24gNDA0cyBzaW5jZSB3ZSBkb24ndCBrZWVwIGFueSByb3V0ZXMKCiAgICAgIGNhbmNlbEFjdGl2ZURlZmVycmVkcygpOwogICAgICBjb21wbGV0ZU5hdmlnYXRpb24obG9jYXRpb24sIHsKICAgICAgICBtYXRjaGVzOiBub3RGb3VuZE1hdGNoZXMsCiAgICAgICAgbG9hZGVyRGF0YToge30sCiAgICAgICAgZXJyb3JzOiB7CiAgICAgICAgICBbcm91dGUuaWRdOiBlcnJvcgogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybjsKICAgIH0gLy8gU2hvcnQgY2lyY3VpdCBpZiBpdCdzIG9ubHkgYSBoYXNoIGNoYW5nZQoKCiAgICBpZiAoaXNIYXNoQ2hhbmdlT25seShzdGF0ZS5sb2NhdGlvbiwgbG9jYXRpb24pKSB7CiAgICAgIGNvbXBsZXRlTmF2aWdhdGlvbihsb2NhdGlvbiwgewogICAgICAgIG1hdGNoZXMKICAgICAgfSk7CiAgICAgIHJldHVybjsKICAgIH0gLy8gQ3JlYXRlIGEgY29udHJvbGxlci9SZXF1ZXN0IGZvciB0aGlzIG5hdmlnYXRpb24KCgogICAgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwogICAgbGV0IHJlcXVlc3QgPSBjcmVhdGVSZXF1ZXN0KGxvY2F0aW9uLCBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIuc2lnbmFsLCBvcHRzICYmIG9wdHMuc3VibWlzc2lvbik7CiAgICBsZXQgcGVuZGluZ0FjdGlvbkRhdGE7CiAgICBsZXQgcGVuZGluZ0Vycm9yOwoKICAgIGlmIChvcHRzICYmIG9wdHMucGVuZGluZ0Vycm9yKSB7CiAgICAgIC8vIElmIHdlIGhhdmUgYSBwZW5kaW5nRXJyb3IsIGl0IG1lYW5zIHRoZSB1c2VyIGF0dGVtcHRlZCBhIEdFVCBzdWJtaXNzaW9uCiAgICAgIC8vIHdpdGggYmluYXJ5IEZvcm1EYXRhIHNvIGFzc2lnbiBoZXJlIGFuZCBza2lwIHRvIGhhbmRsZUxvYWRlcnMuICBUaGF0CiAgICAgIC8vIHdheSB3ZSBoYW5kbGUgY2FsbGluZyBsb2FkZXJzIGFib3ZlIHRoZSBib3VuZGFyeSBldGMuICBJdCdzIG5vdCByZWFsbHkKICAgICAgLy8gZGlmZmVyZW50IGZyb20gYW4gYWN0aW9uRXJyb3IgaW4gdGhhdCBzZW5zZS4KICAgICAgcGVuZGluZ0Vycm9yID0gewogICAgICAgIFtmaW5kTmVhcmVzdEJvdW5kYXJ5KG1hdGNoZXMpLnJvdXRlLmlkXTogb3B0cy5wZW5kaW5nRXJyb3IKICAgICAgfTsKICAgIH0gZWxzZSBpZiAob3B0cyAmJiBvcHRzLnN1Ym1pc3Npb24pIHsKICAgICAgLy8gQ2FsbCBhY3Rpb24gaWYgd2UgcmVjZWl2ZWQgYW4gYWN0aW9uIHN1Ym1pc3Npb24KICAgICAgbGV0IGFjdGlvbk91dHB1dCA9IGF3YWl0IGhhbmRsZUFjdGlvbihyZXF1ZXN0LCBsb2NhdGlvbiwgb3B0cy5zdWJtaXNzaW9uLCBtYXRjaGVzLCB7CiAgICAgICAgcmVwbGFjZTogb3B0cy5yZXBsYWNlCiAgICAgIH0pOwoKICAgICAgaWYgKGFjdGlvbk91dHB1dC5zaG9ydENpcmN1aXRlZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgcGVuZGluZ0FjdGlvbkRhdGEgPSBhY3Rpb25PdXRwdXQucGVuZGluZ0FjdGlvbkRhdGE7CiAgICAgIHBlbmRpbmdFcnJvciA9IGFjdGlvbk91dHB1dC5wZW5kaW5nQWN0aW9uRXJyb3I7CgogICAgICBsZXQgbmF2aWdhdGlvbiA9IF9leHRlbmRzKHsKICAgICAgICBzdGF0ZTogImxvYWRpbmciLAogICAgICAgIGxvY2F0aW9uCiAgICAgIH0sIG9wdHMuc3VibWlzc2lvbik7CgogICAgICBsb2FkaW5nTmF2aWdhdGlvbiA9IG5hdmlnYXRpb247CiAgICB9IC8vIENhbGwgbG9hZGVycwoKCiAgICBsZXQgewogICAgICBzaG9ydENpcmN1aXRlZCwKICAgICAgbG9hZGVyRGF0YSwKICAgICAgZXJyb3JzCiAgICB9ID0gYXdhaXQgaGFuZGxlTG9hZGVycyhyZXF1ZXN0LCBsb2NhdGlvbiwgbWF0Y2hlcywgbG9hZGluZ05hdmlnYXRpb24sIG9wdHMgJiYgb3B0cy5zdWJtaXNzaW9uLCBvcHRzICYmIG9wdHMucmVwbGFjZSwgcGVuZGluZ0FjdGlvbkRhdGEsIHBlbmRpbmdFcnJvcik7CgogICAgaWYgKHNob3J0Q2lyY3VpdGVkKSB7CiAgICAgIHJldHVybjsKICAgIH0gLy8gQ2xlYW4gdXAgbm93IHRoYXQgdGhlIGFjdGlvbi9sb2FkZXJzIGhhdmUgY29tcGxldGVkLiAgRG9uJ3QgY2xlYW4gdXAgaWYKICAgIC8vIHdlIHNob3J0IGNpcmN1aXRlZCBiZWNhdXNlIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlciB3aWxsIGhhdmUgYWxyZWFkeQogICAgLy8gYmVlbiBhc3NpZ25lZCB0byBhIG5ldyBjb250cm9sbGVyIGZvciB0aGUgbmV4dCBuYXZpZ2F0aW9uCgoKICAgIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlciA9IG51bGw7CiAgICBjb21wbGV0ZU5hdmlnYXRpb24obG9jYXRpb24sIHsKICAgICAgbWF0Y2hlcywKICAgICAgbG9hZGVyRGF0YSwKICAgICAgZXJyb3JzCiAgICB9KTsKICB9IC8vIENhbGwgdGhlIGFjdGlvbiBtYXRjaGVkIGJ5IHRoZSBsZWFmIHJvdXRlIGZvciB0aGlzIG5hdmlnYXRpb24gYW5kIGhhbmRsZQogIC8vIHJlZGlyZWN0cy9lcnJvcnMKCgogIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUFjdGlvbihyZXF1ZXN0LCBsb2NhdGlvbiwgc3VibWlzc2lvbiwgbWF0Y2hlcywgb3B0cykgewogICAgaW50ZXJydXB0QWN0aXZlTG9hZHMoKTsgLy8gUHV0IHVzIGluIGEgc3VibWl0dGluZyBzdGF0ZQoKICAgIGxldCBuYXZpZ2F0aW9uID0gX2V4dGVuZHMoewogICAgICBzdGF0ZTogInN1Ym1pdHRpbmciLAogICAgICBsb2NhdGlvbgogICAgfSwgc3VibWlzc2lvbik7CgogICAgdXBkYXRlU3RhdGUoewogICAgICBuYXZpZ2F0aW9uCiAgICB9KTsgLy8gQ2FsbCBvdXIgYWN0aW9uIGFuZCBnZXQgdGhlIHJlc3VsdAoKICAgIGxldCByZXN1bHQ7CiAgICBsZXQgYWN0aW9uTWF0Y2ggPSBnZXRUYXJnZXRNYXRjaChtYXRjaGVzLCBsb2NhdGlvbik7CgogICAgaWYgKCFhY3Rpb25NYXRjaC5yb3V0ZS5hY3Rpb24pIHsKICAgICAgcmVzdWx0ID0gZ2V0TWV0aG9kTm90QWxsb3dlZFJlc3VsdChsb2NhdGlvbik7CiAgICB9IGVsc2UgewogICAgICByZXN1bHQgPSBhd2FpdCBjYWxsTG9hZGVyT3JBY3Rpb24oImFjdGlvbiIsIHJlcXVlc3QsIGFjdGlvbk1hdGNoLCBtYXRjaGVzLCByb3V0ZXIuYmFzZW5hbWUpOwoKICAgICAgaWYgKHJlcXVlc3Quc2lnbmFsLmFib3J0ZWQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgc2hvcnRDaXJjdWl0ZWQ6IHRydWUKICAgICAgICB9OwogICAgICB9CiAgICB9CgogICAgaWYgKGlzUmVkaXJlY3RSZXN1bHQocmVzdWx0KSkgewogICAgICBsZXQgcmVkaXJlY3ROYXZpZ2F0aW9uID0gX2V4dGVuZHMoewogICAgICAgIHN0YXRlOiAibG9hZGluZyIsCiAgICAgICAgbG9jYXRpb246IGNyZWF0ZUxvY2F0aW9uKHN0YXRlLmxvY2F0aW9uLCByZXN1bHQubG9jYXRpb24pCiAgICAgIH0sIHN1Ym1pc3Npb24pOwoKICAgICAgYXdhaXQgc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24ocmVzdWx0LCByZWRpcmVjdE5hdmlnYXRpb24sIG9wdHMgJiYgb3B0cy5yZXBsYWNlKTsKICAgICAgcmV0dXJuIHsKICAgICAgICBzaG9ydENpcmN1aXRlZDogdHJ1ZQogICAgICB9OwogICAgfQoKICAgIGlmIChpc0Vycm9yUmVzdWx0KHJlc3VsdCkpIHsKICAgICAgLy8gU3RvcmUgb2ZmIHRoZSBwZW5kaW5nIGVycm9yIC0gd2UgdXNlIGl0IHRvIGRldGVybWluZSB3aGljaCBsb2FkZXJzCiAgICAgIC8vIHRvIGNhbGwgYW5kIHdpbGwgY29tbWl0IGl0IHdoZW4gd2UgY29tcGxldGUgdGhlIG5hdmlnYXRpb24KICAgICAgbGV0IGJvdW5kYXJ5TWF0Y2ggPSBmaW5kTmVhcmVzdEJvdW5kYXJ5KG1hdGNoZXMsIGFjdGlvbk1hdGNoLnJvdXRlLmlkKTsgLy8gQnkgZGVmYXVsdCwgYWxsIHN1Ym1pc3Npb25zIGFyZSBSRVBMQUNFIG5hdmlnYXRpb25zLCBidXQgaWYgdGhlCiAgICAgIC8vIGFjdGlvbiB0aHJldyBhbiBlcnJvciB0aGF0J2xsIGJlIHJlbmRlcmVkIGluIGFuIGVycm9yRWxlbWVudCwgd2UgZmFsbAogICAgICAvLyBiYWNrIHRvIFBVU0ggc28gdGhhdCB0aGUgdXNlciBjYW4gdXNlIHRoZSBiYWNrIGJ1dHRvbiB0byBnZXQgYmFjayB0bwogICAgICAvLyB0aGUgcHJlLXN1Ym1pc3Npb24gZm9ybSBsb2NhdGlvbiB0byB0cnkgYWdhaW4KCiAgICAgIGlmICgob3B0cyAmJiBvcHRzLnJlcGxhY2UpICE9PSB0cnVlKSB7CiAgICAgICAgcGVuZGluZ0FjdGlvbiA9IEFjdGlvbi5QdXNoOwogICAgICB9CgogICAgICByZXR1cm4gewogICAgICAgIHBlbmRpbmdBY3Rpb25FcnJvcjogewogICAgICAgICAgW2JvdW5kYXJ5TWF0Y2gucm91dGUuaWRdOiByZXN1bHQuZXJyb3IKICAgICAgICB9CiAgICAgIH07CiAgICB9CgogICAgaWYgKGlzRGVmZXJyZWRSZXN1bHQocmVzdWx0KSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoImRlZmVyKCkgaXMgbm90IHN1cHBvcnRlZCBpbiBhY3Rpb25zIik7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgcGVuZGluZ0FjdGlvbkRhdGE6IHsKICAgICAgICBbYWN0aW9uTWF0Y2gucm91dGUuaWRdOiByZXN1bHQuZGF0YQogICAgICB9CiAgICB9OwogIH0gLy8gQ2FsbCBhbGwgYXBwbGljYWJsZSBsb2FkZXJzIGZvciB0aGUgZ2l2ZW4gbWF0Y2hlcywgaGFuZGxpbmcgcmVkaXJlY3RzLAogIC8vIGVycm9ycywgZXRjLgoKCiAgYXN5bmMgZnVuY3Rpb24gaGFuZGxlTG9hZGVycyhyZXF1ZXN0LCBsb2NhdGlvbiwgbWF0Y2hlcywgb3ZlcnJpZGVOYXZpZ2F0aW9uLCBzdWJtaXNzaW9uLCByZXBsYWNlLCBwZW5kaW5nQWN0aW9uRGF0YSwgcGVuZGluZ0Vycm9yKSB7CiAgICAvLyBGaWd1cmUgb3V0IHRoZSByaWdodCBuYXZpZ2F0aW9uIHdlIHdhbnQgdG8gdXNlIGZvciBkYXRhIGxvYWRpbmcKICAgIGxldCBsb2FkaW5nTmF2aWdhdGlvbiA9IG92ZXJyaWRlTmF2aWdhdGlvbjsKCiAgICBpZiAoIWxvYWRpbmdOYXZpZ2F0aW9uKSB7CiAgICAgIGxldCBuYXZpZ2F0aW9uID0gewogICAgICAgIHN0YXRlOiAibG9hZGluZyIsCiAgICAgICAgbG9jYXRpb24sCiAgICAgICAgZm9ybU1ldGhvZDogdW5kZWZpbmVkLAogICAgICAgIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwKICAgICAgICBmb3JtRW5jVHlwZTogdW5kZWZpbmVkLAogICAgICAgIGZvcm1EYXRhOiB1bmRlZmluZWQKICAgICAgfTsKICAgICAgbG9hZGluZ05hdmlnYXRpb24gPSBuYXZpZ2F0aW9uOwogICAgfQoKICAgIGxldCBbbWF0Y2hlc1RvTG9hZCwgcmV2YWxpZGF0aW5nRmV0Y2hlcnNdID0gZ2V0TWF0Y2hlc1RvTG9hZChzdGF0ZSwgbWF0Y2hlcywgc3VibWlzc2lvbiwgbG9jYXRpb24sIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQsIGNhbmNlbGxlZERlZmVycmVkUm91dGVzLCBjYW5jZWxsZWRGZXRjaGVyTG9hZHMsIHBlbmRpbmdBY3Rpb25EYXRhLCBwZW5kaW5nRXJyb3IsIGZldGNoTG9hZE1hdGNoZXMpOyAvLyBDYW5jZWwgcGVuZGluZyBkZWZlcnJlZHMgZm9yIG5vLWxvbmdlci1tYXRjaGVkIHJvdXRlcyBvciByb3V0ZXMgd2UncmUKICAgIC8vIGFib3V0IHRvIHJlbG9hZC4gIE5vdGUgdGhhdCBpZiB0aGlzIGlzIGFuIGFjdGlvbiByZWxvYWQgd2Ugd291bGQgaGF2ZQogICAgLy8gYWxyZWFkeSBjYW5jZWxsZWQgYWxsIHBlbmRpbmcgZGVmZXJyZWRzIHNvIHRoaXMgd291bGQgYmUgYSBuby1vcAoKICAgIGNhbmNlbEFjdGl2ZURlZmVycmVkcyhyb3V0ZUlkID0+ICEobWF0Y2hlcyAmJiBtYXRjaGVzLnNvbWUobSA9PiBtLnJvdXRlLmlkID09PSByb3V0ZUlkKSkgfHwgbWF0Y2hlc1RvTG9hZCAmJiBtYXRjaGVzVG9Mb2FkLnNvbWUobSA9PiBtLnJvdXRlLmlkID09PSByb3V0ZUlkKSk7IC8vIFNob3J0IGNpcmN1aXQgaWYgd2UgaGF2ZSBubyBsb2FkZXJzIHRvIHJ1bgoKICAgIGlmIChtYXRjaGVzVG9Mb2FkLmxlbmd0aCA9PT0gMCAmJiByZXZhbGlkYXRpbmdGZXRjaGVycy5sZW5ndGggPT09IDApIHsKICAgICAgY29tcGxldGVOYXZpZ2F0aW9uKGxvY2F0aW9uLCB7CiAgICAgICAgbWF0Y2hlcywKICAgICAgICBsb2FkZXJEYXRhOiBtZXJnZUxvYWRlckRhdGEoc3RhdGUubG9hZGVyRGF0YSwge30sIG1hdGNoZXMpLAogICAgICAgIC8vIENvbW1pdCBwZW5kaW5nIGVycm9yIGlmIHdlJ3JlIHNob3J0IGNpcmN1aXRpbmcKICAgICAgICBlcnJvcnM6IHBlbmRpbmdFcnJvciB8fCBudWxsLAogICAgICAgIGFjdGlvbkRhdGE6IHBlbmRpbmdBY3Rpb25EYXRhIHx8IG51bGwKICAgICAgfSk7CiAgICAgIHJldHVybiB7CiAgICAgICAgc2hvcnRDaXJjdWl0ZWQ6IHRydWUKICAgICAgfTsKICAgIH0gLy8gSWYgdGhpcyBpcyBhbiB1bmludGVycnVwdGVkIHJldmFsaWRhdGlvbiwgd2UgcmVtYWluIGluIG91ciBjdXJyZW50IGlkbGUKICAgIC8vIHN0YXRlLiAgSWYgbm90LCB3ZSBuZWVkIHRvIHN3aXRjaCB0byBvdXIgbG9hZGluZyBzdGF0ZSBhbmQgbG9hZCBkYXRhLAogICAgLy8gcHJlc2VydmluZyBhbnkgbmV3IGFjdGlvbiBkYXRhIG9yIGV4aXN0aW5nIGFjdGlvbiBkYXRhIChpbiB0aGUgY2FzZSBvZgogICAgLy8gYSByZXZhbGlkYXRpb24gaW50ZXJydXB0aW5nIGFuIGFjdGlvblJlbG9hZCkKCgogICAgaWYgKCFpc1VuaW50ZXJydXB0ZWRSZXZhbGlkYXRpb24pIHsKICAgICAgcmV2YWxpZGF0aW5nRmV0Y2hlcnMuZm9yRWFjaChfcmVmMiA9PiB7CiAgICAgICAgbGV0IFtrZXldID0gX3JlZjI7CiAgICAgICAgbGV0IGZldGNoZXIgPSBzdGF0ZS5mZXRjaGVycy5nZXQoa2V5KTsKICAgICAgICBsZXQgcmV2YWxpZGF0aW5nRmV0Y2hlciA9IHsKICAgICAgICAgIHN0YXRlOiAibG9hZGluZyIsCiAgICAgICAgICBkYXRhOiBmZXRjaGVyICYmIGZldGNoZXIuZGF0YSwKICAgICAgICAgIGZvcm1NZXRob2Q6IHVuZGVmaW5lZCwKICAgICAgICAgIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwKICAgICAgICAgIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsCiAgICAgICAgICBmb3JtRGF0YTogdW5kZWZpbmVkCiAgICAgICAgfTsKICAgICAgICBzdGF0ZS5mZXRjaGVycy5zZXQoa2V5LCByZXZhbGlkYXRpbmdGZXRjaGVyKTsKICAgICAgfSk7CiAgICAgIHVwZGF0ZVN0YXRlKF9leHRlbmRzKHsKICAgICAgICBuYXZpZ2F0aW9uOiBsb2FkaW5nTmF2aWdhdGlvbiwKICAgICAgICBhY3Rpb25EYXRhOiBwZW5kaW5nQWN0aW9uRGF0YSB8fCBzdGF0ZS5hY3Rpb25EYXRhIHx8IG51bGwKICAgICAgfSwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMubGVuZ3RoID4gMCA/IHsKICAgICAgICBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykKICAgICAgfSA6IHt9KSk7CiAgICB9CgogICAgcGVuZGluZ05hdmlnYXRpb25Mb2FkSWQgPSArK2luY3JlbWVudGluZ0xvYWRJZDsKICAgIHJldmFsaWRhdGluZ0ZldGNoZXJzLmZvckVhY2goX3JlZjMgPT4gewogICAgICBsZXQgW2tleV0gPSBfcmVmMzsKICAgICAgcmV0dXJuIGZldGNoQ29udHJvbGxlcnMuc2V0KGtleSwgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyKTsKICAgIH0pOwogICAgbGV0IHsKICAgICAgcmVzdWx0cywKICAgICAgbG9hZGVyUmVzdWx0cywKICAgICAgZmV0Y2hlclJlc3VsdHMKICAgIH0gPSBhd2FpdCBjYWxsTG9hZGVyc0FuZE1heWJlUmVzb2x2ZURhdGEoc3RhdGUubWF0Y2hlcywgbWF0Y2hlcywgbWF0Y2hlc1RvTG9hZCwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMsIHJlcXVlc3QpOwoKICAgIGlmIChyZXF1ZXN0LnNpZ25hbC5hYm9ydGVkKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgc2hvcnRDaXJjdWl0ZWQ6IHRydWUKICAgICAgfTsKICAgIH0gLy8gQ2xlYW4gdXAgX2FmdGVyXyBsb2FkZXJzIGhhdmUgY29tcGxldGVkLiAgRG9uJ3QgY2xlYW4gdXAgaWYgd2Ugc2hvcnQKICAgIC8vIGNpcmN1aXRlZCBiZWNhdXNlIGZldGNoQ29udHJvbGxlcnMgd291bGQgaGF2ZSBiZWVuIGFib3J0ZWQgYW5kCiAgICAvLyByZWFzc2lnbmVkIHRvIG5ldyBjb250cm9sbGVycyBmb3IgdGhlIG5leHQgbmF2aWdhdGlvbgoKCiAgICByZXZhbGlkYXRpbmdGZXRjaGVycy5mb3JFYWNoKF9yZWY0ID0+IHsKICAgICAgbGV0IFtrZXldID0gX3JlZjQ7CiAgICAgIHJldHVybiBmZXRjaENvbnRyb2xsZXJzLmRlbGV0ZShrZXkpOwogICAgfSk7IC8vIElmIGFueSBsb2FkZXJzIHJldHVybmVkIGEgcmVkaXJlY3QgUmVzcG9uc2UsIHN0YXJ0IGEgbmV3IFJFUExBQ0UgbmF2aWdhdGlvbgoKICAgIGxldCByZWRpcmVjdCA9IGZpbmRSZWRpcmVjdChyZXN1bHRzKTsKCiAgICBpZiAocmVkaXJlY3QpIHsKICAgICAgbGV0IHJlZGlyZWN0TmF2aWdhdGlvbiA9IGdldExvYWRlclJlZGlyZWN0KHN0YXRlLCByZWRpcmVjdCk7CiAgICAgIGF3YWl0IHN0YXJ0UmVkaXJlY3ROYXZpZ2F0aW9uKHJlZGlyZWN0LCByZWRpcmVjdE5hdmlnYXRpb24sIHJlcGxhY2UpOwogICAgICByZXR1cm4gewogICAgICAgIHNob3J0Q2lyY3VpdGVkOiB0cnVlCiAgICAgIH07CiAgICB9IC8vIFByb2Nlc3MgYW5kIGNvbW1pdCBvdXRwdXQgZnJvbSBsb2FkZXJzCgoKICAgIGxldCB7CiAgICAgIGxvYWRlckRhdGEsCiAgICAgIGVycm9ycwogICAgfSA9IHByb2Nlc3NMb2FkZXJEYXRhKHN0YXRlLCBtYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCBsb2FkZXJSZXN1bHRzLCBwZW5kaW5nRXJyb3IsIHJldmFsaWRhdGluZ0ZldGNoZXJzLCBmZXRjaGVyUmVzdWx0cywgYWN0aXZlRGVmZXJyZWRzKTsgLy8gV2lyZSB1cCBzdWJzY3JpYmVycyB0byB1cGRhdGUgbG9hZGVyRGF0YSBhcyBwcm9taXNlcyBzZXR0bGUKCiAgICBhY3RpdmVEZWZlcnJlZHMuZm9yRWFjaCgoZGVmZXJyZWREYXRhLCByb3V0ZUlkKSA9PiB7CiAgICAgIGRlZmVycmVkRGF0YS5zdWJzY3JpYmUoYWJvcnRlZCA9PiB7CiAgICAgICAgLy8gTm90ZTogTm8gbmVlZCB0byB1cGRhdGVTdGF0ZSBoZXJlIHNpbmNlIHRoZSBUcmFja2VkUHJvbWlzZSBvbgogICAgICAgIC8vIGxvYWRlckRhdGEgaXMgc3RhYmxlIGFjcm9zcyByZXNvbHZlL3JlamVjdAogICAgICAgIC8vIFJlbW92ZSB0aGlzIGluc3RhbmNlIGlmIHdlIHdlcmUgYWJvcnRlZCBvciBpZiBwcm9taXNlcyBoYXZlIHNldHRsZWQKICAgICAgICBpZiAoYWJvcnRlZCB8fCBkZWZlcnJlZERhdGEuZG9uZSkgewogICAgICAgICAgYWN0aXZlRGVmZXJyZWRzLmRlbGV0ZShyb3V0ZUlkKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CiAgICBtYXJrRmV0Y2hSZWRpcmVjdHNEb25lKCk7CiAgICBsZXQgZGlkQWJvcnRGZXRjaExvYWRzID0gYWJvcnRTdGFsZUZldGNoTG9hZHMocGVuZGluZ05hdmlnYXRpb25Mb2FkSWQpOwogICAgcmV0dXJuIF9leHRlbmRzKHsKICAgICAgbG9hZGVyRGF0YSwKICAgICAgZXJyb3JzCiAgICB9LCBkaWRBYm9ydEZldGNoTG9hZHMgfHwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMubGVuZ3RoID4gMCA/IHsKICAgICAgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpCiAgICB9IDoge30pOwogIH0KCiAgZnVuY3Rpb24gZ2V0RmV0Y2hlcihrZXkpIHsKICAgIHJldHVybiBzdGF0ZS5mZXRjaGVycy5nZXQoa2V5KSB8fCBJRExFX0ZFVENIRVI7CiAgfSAvLyBUcmlnZ2VyIGEgZmV0Y2hlciBsb2FkL3N1Ym1pdCBmb3IgdGhlIGdpdmVuIGZldGNoZXIga2V5CgoKICBmdW5jdGlvbiBmZXRjaChrZXksIHJvdXRlSWQsIGhyZWYsIG9wdHMpIHsKICAgIGlmIChpc1NlcnZlcikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoInJvdXRlci5mZXRjaCgpIHdhcyBjYWxsZWQgZHVyaW5nIHRoZSBzZXJ2ZXIgcmVuZGVyLCBidXQgaXQgc2hvdWxkbid0IGJlLiAiICsgIllvdSBhcmUgbGlrZWx5IGNhbGxpbmcgYSB1c2VGZXRjaGVyKCkgbWV0aG9kIGluIHRoZSBib2R5IG9mIHlvdXIgY29tcG9uZW50LiAiICsgIlRyeSBtb3ZpbmcgaXQgdG8gYSB1c2VFZmZlY3Qgb3IgYSBjYWxsYmFjay4iKTsKICAgIH0KCiAgICBpZiAoZmV0Y2hDb250cm9sbGVycy5oYXMoa2V5KSkgYWJvcnRGZXRjaGVyKGtleSk7CiAgICBsZXQgbWF0Y2hlcyA9IG1hdGNoUm91dGVzKGRhdGFSb3V0ZXMsIGhyZWYsIGluaXQuYmFzZW5hbWUpOwoKICAgIGlmICghbWF0Y2hlcykgewogICAgICBzZXRGZXRjaGVyRXJyb3Ioa2V5LCByb3V0ZUlkLCBuZXcgRXJyb3JSZXNwb25zZSg0MDQsICJOb3QgRm91bmQiLCBudWxsKSk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBsZXQgewogICAgICBwYXRoLAogICAgICBzdWJtaXNzaW9uCiAgICB9ID0gbm9ybWFsaXplTmF2aWdhdGVPcHRpb25zKGhyZWYsIG9wdHMsIHRydWUpOwogICAgbGV0IG1hdGNoID0gZ2V0VGFyZ2V0TWF0Y2gobWF0Y2hlcywgcGF0aCk7CgogICAgaWYgKHN1Ym1pc3Npb24pIHsKICAgICAgaGFuZGxlRmV0Y2hlckFjdGlvbihrZXksIHJvdXRlSWQsIHBhdGgsIG1hdGNoLCBtYXRjaGVzLCBzdWJtaXNzaW9uKTsKICAgICAgcmV0dXJuOwogICAgfSAvLyBTdG9yZSBvZmYgdGhlIG1hdGNoIHNvIHdlIGNhbiBjYWxsIGl0J3Mgc2hvdWxkUmV2YWxpZGF0ZSBvbiBzdWJzZXF1ZW50CiAgICAvLyByZXZhbGlkYXRpb25zCgoKICAgIGZldGNoTG9hZE1hdGNoZXMuc2V0KGtleSwgW3BhdGgsIG1hdGNoLCBtYXRjaGVzXSk7CiAgICBoYW5kbGVGZXRjaGVyTG9hZGVyKGtleSwgcm91dGVJZCwgcGF0aCwgbWF0Y2gsIG1hdGNoZXMpOwogIH0gLy8gQ2FsbCB0aGUgYWN0aW9uIGZvciB0aGUgbWF0Y2hlZCBmZXRjaGVyLnN1Ym1pdCgpLCBhbmQgdGhlbiBoYW5kbGUgcmVkaXJlY3RzLAogIC8vIGVycm9ycywgYW5kIHJldmFsaWRhdGlvbgoKCiAgYXN5bmMgZnVuY3Rpb24gaGFuZGxlRmV0Y2hlckFjdGlvbihrZXksIHJvdXRlSWQsIHBhdGgsIG1hdGNoLCByZXF1ZXN0TWF0Y2hlcywgc3VibWlzc2lvbikgewogICAgaW50ZXJydXB0QWN0aXZlTG9hZHMoKTsKICAgIGZldGNoTG9hZE1hdGNoZXMuZGVsZXRlKGtleSk7CgogICAgaWYgKCFtYXRjaC5yb3V0ZS5hY3Rpb24pIHsKICAgICAgbGV0IHsKICAgICAgICBlcnJvcgogICAgICB9ID0gZ2V0TWV0aG9kTm90QWxsb3dlZFJlc3VsdChwYXRoKTsKICAgICAgc2V0RmV0Y2hlckVycm9yKGtleSwgcm91dGVJZCwgZXJyb3IpOwogICAgICByZXR1cm47CiAgICB9IC8vIFB1dCB0aGlzIGZldGNoZXIgaW50byBpdCdzIHN1Ym1pdHRpbmcgc3RhdGUKCgogICAgbGV0IGV4aXN0aW5nRmV0Y2hlciA9IHN0YXRlLmZldGNoZXJzLmdldChrZXkpOwoKICAgIGxldCBmZXRjaGVyID0gX2V4dGVuZHMoewogICAgICBzdGF0ZTogInN1Ym1pdHRpbmciCiAgICB9LCBzdWJtaXNzaW9uLCB7CiAgICAgIGRhdGE6IGV4aXN0aW5nRmV0Y2hlciAmJiBleGlzdGluZ0ZldGNoZXIuZGF0YQogICAgfSk7CgogICAgc3RhdGUuZmV0Y2hlcnMuc2V0KGtleSwgZmV0Y2hlcik7CiAgICB1cGRhdGVTdGF0ZSh7CiAgICAgIGZldGNoZXJzOiBuZXcgTWFwKHN0YXRlLmZldGNoZXJzKQogICAgfSk7IC8vIENhbGwgdGhlIGFjdGlvbiBmb3IgdGhlIGZldGNoZXIKCiAgICBsZXQgYWJvcnRDb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwogICAgbGV0IGZldGNoUmVxdWVzdCA9IGNyZWF0ZVJlcXVlc3QocGF0aCwgYWJvcnRDb250cm9sbGVyLnNpZ25hbCwgc3VibWlzc2lvbik7CiAgICBmZXRjaENvbnRyb2xsZXJzLnNldChrZXksIGFib3J0Q29udHJvbGxlcik7CiAgICBsZXQgYWN0aW9uUmVzdWx0ID0gYXdhaXQgY2FsbExvYWRlck9yQWN0aW9uKCJhY3Rpb24iLCBmZXRjaFJlcXVlc3QsIG1hdGNoLCByZXF1ZXN0TWF0Y2hlcywgcm91dGVyLmJhc2VuYW1lKTsKCiAgICBpZiAoZmV0Y2hSZXF1ZXN0LnNpZ25hbC5hYm9ydGVkKSB7CiAgICAgIC8vIFdlIGNhbiBkZWxldGUgdGhpcyBzbyBsb25nIGFzIHdlIHdlcmVuJ3QgYWJvcnRlZCBieSBvdSBvdXIgb3duIGZldGNoZXIKICAgICAgLy8gcmUtc3VibWl0IHdoaWNoIHdvdWxkIGhhdmUgcHV0IF9uZXdfIGNvbnRyb2xsZXIgaXMgaW4gZmV0Y2hDb250cm9sbGVycwogICAgICBpZiAoZmV0Y2hDb250cm9sbGVycy5nZXQoa2V5KSA9PT0gYWJvcnRDb250cm9sbGVyKSB7CiAgICAgICAgZmV0Y2hDb250cm9sbGVycy5kZWxldGUoa2V5KTsKICAgICAgfQoKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmIChpc1JlZGlyZWN0UmVzdWx0KGFjdGlvblJlc3VsdCkpIHsKICAgICAgZmV0Y2hDb250cm9sbGVycy5kZWxldGUoa2V5KTsKICAgICAgZmV0Y2hSZWRpcmVjdElkcy5hZGQoa2V5KTsKCiAgICAgIGxldCBsb2FkaW5nRmV0Y2hlciA9IF9leHRlbmRzKHsKICAgICAgICBzdGF0ZTogImxvYWRpbmciCiAgICAgIH0sIHN1Ym1pc3Npb24sIHsKICAgICAgICBkYXRhOiB1bmRlZmluZWQKICAgICAgfSk7CgogICAgICBzdGF0ZS5mZXRjaGVycy5zZXQoa2V5LCBsb2FkaW5nRmV0Y2hlcik7CiAgICAgIHVwZGF0ZVN0YXRlKHsKICAgICAgICBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykKICAgICAgfSk7CgogICAgICBsZXQgcmVkaXJlY3ROYXZpZ2F0aW9uID0gX2V4dGVuZHMoewogICAgICAgIHN0YXRlOiAibG9hZGluZyIsCiAgICAgICAgbG9jYXRpb246IGNyZWF0ZUxvY2F0aW9uKHN0YXRlLmxvY2F0aW9uLCBhY3Rpb25SZXN1bHQubG9jYXRpb24pCiAgICAgIH0sIHN1Ym1pc3Npb24pOwoKICAgICAgYXdhaXQgc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24oYWN0aW9uUmVzdWx0LCByZWRpcmVjdE5hdmlnYXRpb24pOwogICAgICByZXR1cm47CiAgICB9IC8vIFByb2Nlc3MgYW55IG5vbi1yZWRpcmVjdCBlcnJvcnMgdGhyb3duCgoKICAgIGlmIChpc0Vycm9yUmVzdWx0KGFjdGlvblJlc3VsdCkpIHsKICAgICAgc2V0RmV0Y2hlckVycm9yKGtleSwgcm91dGVJZCwgYWN0aW9uUmVzdWx0LmVycm9yKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmIChpc0RlZmVycmVkUmVzdWx0KGFjdGlvblJlc3VsdCkpIHsKICAgICAgcm91dGVyX2ludmFyaWFudChmYWxzZSwgImRlZmVyKCkgaXMgbm90IHN1cHBvcnRlZCBpbiBhY3Rpb25zIik7CiAgICB9IC8vIFN0YXJ0IHRoZSBkYXRhIGxvYWQgZm9yIGN1cnJlbnQgbWF0Y2hlcywgb3IgdGhlIG5leHQgbG9jYXRpb24gaWYgd2UncmUKICAgIC8vIGluIHRoZSBtaWRkbGUgb2YgYSBuYXZpZ2F0aW9uCgoKICAgIGxldCBuZXh0TG9jYXRpb24gPSBzdGF0ZS5uYXZpZ2F0aW9uLmxvY2F0aW9uIHx8IHN0YXRlLmxvY2F0aW9uOwogICAgbGV0IHJldmFsaWRhdGlvblJlcXVlc3QgPSBjcmVhdGVSZXF1ZXN0KG5leHRMb2NhdGlvbiwgYWJvcnRDb250cm9sbGVyLnNpZ25hbCk7CiAgICBsZXQgbWF0Y2hlcyA9IHN0YXRlLm5hdmlnYXRpb24uc3RhdGUgIT09ICJpZGxlIiA/IG1hdGNoUm91dGVzKGRhdGFSb3V0ZXMsIHN0YXRlLm5hdmlnYXRpb24ubG9jYXRpb24sIGluaXQuYmFzZW5hbWUpIDogc3RhdGUubWF0Y2hlczsKICAgIHJvdXRlcl9pbnZhcmlhbnQobWF0Y2hlcywgIkRpZG4ndCBmaW5kIGFueSBtYXRjaGVzIGFmdGVyIGZldGNoZXIgYWN0aW9uIik7CiAgICBsZXQgbG9hZElkID0gKytpbmNyZW1lbnRpbmdMb2FkSWQ7CiAgICBmZXRjaFJlbG9hZElkcy5zZXQoa2V5LCBsb2FkSWQpOwoKICAgIGxldCBsb2FkRmV0Y2hlciA9IF9leHRlbmRzKHsKICAgICAgc3RhdGU6ICJsb2FkaW5nIiwKICAgICAgZGF0YTogYWN0aW9uUmVzdWx0LmRhdGEKICAgIH0sIHN1Ym1pc3Npb24pOwoKICAgIHN0YXRlLmZldGNoZXJzLnNldChrZXksIGxvYWRGZXRjaGVyKTsKICAgIGxldCBbbWF0Y2hlc1RvTG9hZCwgcmV2YWxpZGF0aW5nRmV0Y2hlcnNdID0gZ2V0TWF0Y2hlc1RvTG9hZChzdGF0ZSwgbWF0Y2hlcywgc3VibWlzc2lvbiwgbmV4dExvY2F0aW9uLCBpc1JldmFsaWRhdGlvblJlcXVpcmVkLCBjYW5jZWxsZWREZWZlcnJlZFJvdXRlcywgY2FuY2VsbGVkRmV0Y2hlckxvYWRzLCB7CiAgICAgIFttYXRjaC5yb3V0ZS5pZF06IGFjdGlvblJlc3VsdC5kYXRhCiAgICB9LCB1bmRlZmluZWQsIC8vIE5vIG5lZWQgdG8gc2VuZCB0aHJvdWdoIGVycm9ycyBzaW5jZSB3ZSBzaG9ydCBjaXJjdWl0IGFib3ZlCiAgICBmZXRjaExvYWRNYXRjaGVzKTsgLy8gUHV0IGFsbCByZXZhbGlkYXRpbmcgZmV0Y2hlcnMgaW50byB0aGUgbG9hZGluZyBzdGF0ZSwgZXhjZXB0IGZvciB0aGUKICAgIC8vIGN1cnJlbnQgZmV0Y2hlciB3aGljaCB3ZSB3YW50IHRvIGtlZXAgaW4gaXQncyBjdXJyZW50IGxvYWRpbmcgc3RhdGUgd2hpY2gKICAgIC8vIGNvbnRhaW5zIGl0J3MgYWN0aW9uIHN1Ym1pc3Npb24gaW5mbyArIGFjdGlvbiBkYXRhCgogICAgcmV2YWxpZGF0aW5nRmV0Y2hlcnMuZmlsdGVyKF9yZWY1ID0+IHsKICAgICAgbGV0IFtzdGFsZUtleV0gPSBfcmVmNTsKICAgICAgcmV0dXJuIHN0YWxlS2V5ICE9PSBrZXk7CiAgICB9KS5mb3JFYWNoKF9yZWY2ID0+IHsKICAgICAgbGV0IFtzdGFsZUtleV0gPSBfcmVmNjsKICAgICAgbGV0IGV4aXN0aW5nRmV0Y2hlciA9IHN0YXRlLmZldGNoZXJzLmdldChzdGFsZUtleSk7CiAgICAgIGxldCByZXZhbGlkYXRpbmdGZXRjaGVyID0gewogICAgICAgIHN0YXRlOiAibG9hZGluZyIsCiAgICAgICAgZGF0YTogZXhpc3RpbmdGZXRjaGVyICYmIGV4aXN0aW5nRmV0Y2hlci5kYXRhLAogICAgICAgIGZvcm1NZXRob2Q6IHVuZGVmaW5lZCwKICAgICAgICBmb3JtQWN0aW9uOiB1bmRlZmluZWQsCiAgICAgICAgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwKICAgICAgICBmb3JtRGF0YTogdW5kZWZpbmVkCiAgICAgIH07CiAgICAgIHN0YXRlLmZldGNoZXJzLnNldChzdGFsZUtleSwgcmV2YWxpZGF0aW5nRmV0Y2hlcik7CiAgICAgIGZldGNoQ29udHJvbGxlcnMuc2V0KHN0YWxlS2V5LCBhYm9ydENvbnRyb2xsZXIpOwogICAgfSk7CiAgICB1cGRhdGVTdGF0ZSh7CiAgICAgIGZldGNoZXJzOiBuZXcgTWFwKHN0YXRlLmZldGNoZXJzKQogICAgfSk7CiAgICBsZXQgewogICAgICByZXN1bHRzLAogICAgICBsb2FkZXJSZXN1bHRzLAogICAgICBmZXRjaGVyUmVzdWx0cwogICAgfSA9IGF3YWl0IGNhbGxMb2FkZXJzQW5kTWF5YmVSZXNvbHZlRGF0YShzdGF0ZS5tYXRjaGVzLCBtYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCByZXZhbGlkYXRpbmdGZXRjaGVycywgcmV2YWxpZGF0aW9uUmVxdWVzdCk7CgogICAgaWYgKGFib3J0Q29udHJvbGxlci5zaWduYWwuYWJvcnRlZCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgZmV0Y2hSZWxvYWRJZHMuZGVsZXRlKGtleSk7CiAgICBmZXRjaENvbnRyb2xsZXJzLmRlbGV0ZShrZXkpOwogICAgcmV2YWxpZGF0aW5nRmV0Y2hlcnMuZm9yRWFjaChfcmVmNyA9PiB7CiAgICAgIGxldCBbc3RhbGVLZXldID0gX3JlZjc7CiAgICAgIHJldHVybiBmZXRjaENvbnRyb2xsZXJzLmRlbGV0ZShzdGFsZUtleSk7CiAgICB9KTsKICAgIGxldCByZWRpcmVjdCA9IGZpbmRSZWRpcmVjdChyZXN1bHRzKTsKCiAgICBpZiAocmVkaXJlY3QpIHsKICAgICAgbGV0IHJlZGlyZWN0TmF2aWdhdGlvbiA9IGdldExvYWRlclJlZGlyZWN0KHN0YXRlLCByZWRpcmVjdCk7CiAgICAgIGF3YWl0IHN0YXJ0UmVkaXJlY3ROYXZpZ2F0aW9uKHJlZGlyZWN0LCByZWRpcmVjdE5hdmlnYXRpb24pOwogICAgICByZXR1cm47CiAgICB9IC8vIFByb2Nlc3MgYW5kIGNvbW1pdCBvdXRwdXQgZnJvbSBsb2FkZXJzCgoKICAgIGxldCB7CiAgICAgIGxvYWRlckRhdGEsCiAgICAgIGVycm9ycwogICAgfSA9IHByb2Nlc3NMb2FkZXJEYXRhKHN0YXRlLCBzdGF0ZS5tYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCBsb2FkZXJSZXN1bHRzLCB1bmRlZmluZWQsIHJldmFsaWRhdGluZ0ZldGNoZXJzLCBmZXRjaGVyUmVzdWx0cywgYWN0aXZlRGVmZXJyZWRzKTsKICAgIGxldCBkb25lRmV0Y2hlciA9IHsKICAgICAgc3RhdGU6ICJpZGxlIiwKICAgICAgZGF0YTogYWN0aW9uUmVzdWx0LmRhdGEsCiAgICAgIGZvcm1NZXRob2Q6IHVuZGVmaW5lZCwKICAgICAgZm9ybUFjdGlvbjogdW5kZWZpbmVkLAogICAgICBmb3JtRW5jVHlwZTogdW5kZWZpbmVkLAogICAgICBmb3JtRGF0YTogdW5kZWZpbmVkCiAgICB9OwogICAgc3RhdGUuZmV0Y2hlcnMuc2V0KGtleSwgZG9uZUZldGNoZXIpOwogICAgbGV0IGRpZEFib3J0RmV0Y2hMb2FkcyA9IGFib3J0U3RhbGVGZXRjaExvYWRzKGxvYWRJZCk7IC8vIElmIHdlIGFyZSBjdXJyZW50bHkgaW4gYSBuYXZpZ2F0aW9uIGxvYWRpbmcgc3RhdGUgYW5kIHRoaXMgZmV0Y2hlciBpcwogICAgLy8gbW9yZSByZWNlbnQgdGhhbiB0aGUgbmF2aWdhdGlvbiwgd2Ugd2FudCB0aGUgbmV3ZXIgZGF0YSBzbyBhYm9ydCB0aGUKICAgIC8vIG5hdmlnYXRpb24gYW5kIGNvbXBsZXRlIGl0IHdpdGggdGhlIGZldGNoZXIgZGF0YQoKICAgIGlmIChzdGF0ZS5uYXZpZ2F0aW9uLnN0YXRlID09PSAibG9hZGluZyIgJiYgbG9hZElkID4gcGVuZGluZ05hdmlnYXRpb25Mb2FkSWQpIHsKICAgICAgcm91dGVyX2ludmFyaWFudChwZW5kaW5nQWN0aW9uLCAiRXhwZWN0ZWQgcGVuZGluZyBhY3Rpb24iKTsKICAgICAgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyICYmIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlci5hYm9ydCgpOwogICAgICBjb21wbGV0ZU5hdmlnYXRpb24oc3RhdGUubmF2aWdhdGlvbi5sb2NhdGlvbiwgewogICAgICAgIG1hdGNoZXMsCiAgICAgICAgbG9hZGVyRGF0YSwKICAgICAgICBlcnJvcnMsCiAgICAgICAgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpCiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgLy8gb3RoZXJ3aXNlIGp1c3QgdXBkYXRlIHdpdGggdGhlIGZldGNoZXIgZGF0YSwgcHJlc2VydmluZyBhbnkgZXhpc3RpbmcKICAgICAgLy8gbG9hZGVyRGF0YSBmb3IgbG9hZGVycyB0aGF0IGRpZCBub3QgbmVlZCB0byByZWxvYWQuICBXZSBoYXZlIHRvCiAgICAgIC8vIG1hbnVhbGx5IG1lcmdlIGhlcmUgc2luY2Ugd2UgYXJlbid0IGdvaW5nIHRocm91Z2ggY29tcGxldGVOYXZpZ2F0aW9uCiAgICAgIHVwZGF0ZVN0YXRlKF9leHRlbmRzKHsKICAgICAgICBlcnJvcnMsCiAgICAgICAgbG9hZGVyRGF0YTogbWVyZ2VMb2FkZXJEYXRhKHN0YXRlLmxvYWRlckRhdGEsIGxvYWRlckRhdGEsIG1hdGNoZXMpCiAgICAgIH0sIGRpZEFib3J0RmV0Y2hMb2FkcyA/IHsKICAgICAgICBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykKICAgICAgfSA6IHt9KSk7CiAgICAgIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQgPSBmYWxzZTsKICAgIH0KICB9IC8vIENhbGwgdGhlIG1hdGNoZWQgbG9hZGVyIGZvciBmZXRjaGVyLmxvYWQoKSwgaGFuZGxpbmcgcmVkaXJlY3RzLCBlcnJvcnMsIGV0Yy4KCgogIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUZldGNoZXJMb2FkZXIoa2V5LCByb3V0ZUlkLCBwYXRoLCBtYXRjaCwgbWF0Y2hlcykgewogICAgbGV0IGV4aXN0aW5nRmV0Y2hlciA9IHN0YXRlLmZldGNoZXJzLmdldChrZXkpOyAvLyBQdXQgdGhpcyBmZXRjaGVyIGludG8gaXQncyBsb2FkaW5nIHN0YXRlCgogICAgbGV0IGxvYWRpbmdGZXRjaGVyID0gewogICAgICBzdGF0ZTogImxvYWRpbmciLAogICAgICBmb3JtTWV0aG9kOiB1bmRlZmluZWQsCiAgICAgIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwKICAgICAgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwKICAgICAgZm9ybURhdGE6IHVuZGVmaW5lZCwKICAgICAgZGF0YTogZXhpc3RpbmdGZXRjaGVyICYmIGV4aXN0aW5nRmV0Y2hlci5kYXRhCiAgICB9OwogICAgc3RhdGUuZmV0Y2hlcnMuc2V0KGtleSwgbG9hZGluZ0ZldGNoZXIpOwogICAgdXBkYXRlU3RhdGUoewogICAgICBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykKICAgIH0pOyAvLyBDYWxsIHRoZSBsb2FkZXIgZm9yIHRoaXMgZmV0Y2hlciByb3V0ZSBtYXRjaAoKICAgIGxldCBhYm9ydENvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgICBsZXQgZmV0Y2hSZXF1ZXN0ID0gY3JlYXRlUmVxdWVzdChwYXRoLCBhYm9ydENvbnRyb2xsZXIuc2lnbmFsKTsKICAgIGZldGNoQ29udHJvbGxlcnMuc2V0KGtleSwgYWJvcnRDb250cm9sbGVyKTsKICAgIGxldCByZXN1bHQgPSBhd2FpdCBjYWxsTG9hZGVyT3JBY3Rpb24oImxvYWRlciIsIGZldGNoUmVxdWVzdCwgbWF0Y2gsIG1hdGNoZXMsIHJvdXRlci5iYXNlbmFtZSk7IC8vIERlZmVycmVkIGlzbid0IHN1cHBvcnRlZCBvciBmZXRjaGVyIGxvYWRzLCBhd2FpdCBldmVyeXRoaW5nIGFuZCB0cmVhdCBpdAogICAgLy8gYXMgYSBub3JtYWwgbG9hZC4gIHJlc29sdmVEZWZlcnJlZERhdGEgd2lsbCByZXR1cm4gdW5kZWZpbmVkIGlmIHRoaXMKICAgIC8vIGZldGNoZXIgZ2V0cyBhYm9ydGVkLCBzbyB3ZSBqdXN0IGxlYXZlIHJlc3VsdCB1bnRvdWNoZWQgYW5kIHNob3J0IGNpcmN1aXQKICAgIC8vIGJlbG93IGlmIHRoYXQgaGFwcGVucwoKICAgIGlmIChpc0RlZmVycmVkUmVzdWx0KHJlc3VsdCkpIHsKICAgICAgcmVzdWx0ID0gKGF3YWl0IHJlc29sdmVEZWZlcnJlZERhdGEocmVzdWx0LCBmZXRjaFJlcXVlc3Quc2lnbmFsLCB0cnVlKSkgfHwgcmVzdWx0OwogICAgfSAvLyBXZSBjYW4gZGVsZXRlIHRoaXMgc28gbG9uZyBhcyB3ZSB3ZXJlbid0IGFib3J0ZWQgYnkgb3Ugb3VyIG93biBmZXRjaGVyCiAgICAvLyByZS1sb2FkIHdoaWNoIHdvdWxkIGhhdmUgcHV0IF9uZXdfIGNvbnRyb2xsZXIgaXMgaW4gZmV0Y2hDb250cm9sbGVycwoKCiAgICBpZiAoZmV0Y2hDb250cm9sbGVycy5nZXQoa2V5KSA9PT0gYWJvcnRDb250cm9sbGVyKSB7CiAgICAgIGZldGNoQ29udHJvbGxlcnMuZGVsZXRlKGtleSk7CiAgICB9CgogICAgaWYgKGZldGNoUmVxdWVzdC5zaWduYWwuYWJvcnRlZCkgewogICAgICByZXR1cm47CiAgICB9IC8vIElmIHRoZSBsb2FkZXIgdGhyZXcgYSByZWRpcmVjdCBSZXNwb25zZSwgc3RhcnQgYSBuZXcgUkVQTEFDRSBuYXZpZ2F0aW9uCgoKICAgIGlmIChpc1JlZGlyZWN0UmVzdWx0KHJlc3VsdCkpIHsKICAgICAgbGV0IHJlZGlyZWN0TmF2aWdhdGlvbiA9IGdldExvYWRlclJlZGlyZWN0KHN0YXRlLCByZXN1bHQpOwogICAgICBhd2FpdCBzdGFydFJlZGlyZWN0TmF2aWdhdGlvbihyZXN1bHQsIHJlZGlyZWN0TmF2aWdhdGlvbik7CiAgICAgIHJldHVybjsKICAgIH0gLy8gUHJvY2VzcyBhbnkgbm9uLXJlZGlyZWN0IGVycm9ycyB0aHJvd24KCgogICAgaWYgKGlzRXJyb3JSZXN1bHQocmVzdWx0KSkgewogICAgICBsZXQgYm91bmRhcnlNYXRjaCA9IGZpbmROZWFyZXN0Qm91bmRhcnkoc3RhdGUubWF0Y2hlcywgcm91dGVJZCk7CiAgICAgIHN0YXRlLmZldGNoZXJzLmRlbGV0ZShrZXkpOyAvLyBUT0RPOiBJbiByZW1peCwgdGhpcyB3b3VsZCByZXNldCB0byBJRExFX05BVklHQVRJT04gaWYgaXQgd2FzIGEgY2F0Y2ggLQogICAgICAvLyBkbyB3ZSBuZWVkIHRvIGJlaGF2ZSBhbnkgZGlmZmVyZW50bHkgd2l0aCBvdXIgbm9uLXJlZGlyZWN0IGVycm9ycz8KICAgICAgLy8gV2hhdCBpZiBpdCB3YXMgYSBub24tcmVkaXJlY3QgUmVzcG9uc2U/CgogICAgICB1cGRhdGVTdGF0ZSh7CiAgICAgICAgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpLAogICAgICAgIGVycm9yczogewogICAgICAgICAgW2JvdW5kYXJ5TWF0Y2gucm91dGUuaWRdOiByZXN1bHQuZXJyb3IKICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm47CiAgICB9CgogICAgcm91dGVyX2ludmFyaWFudCghaXNEZWZlcnJlZFJlc3VsdChyZXN1bHQpLCAiVW5oYW5kbGVkIGZldGNoZXIgZGVmZXJyZWQgZGF0YSIpOyAvLyBQdXQgdGhlIGZldGNoZXIgYmFjayBpbnRvIGFuIGlkbGUgc3RhdGUKCiAgICBsZXQgZG9uZUZldGNoZXIgPSB7CiAgICAgIHN0YXRlOiAiaWRsZSIsCiAgICAgIGRhdGE6IHJlc3VsdC5kYXRhLAogICAgICBmb3JtTWV0aG9kOiB1bmRlZmluZWQsCiAgICAgIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwKICAgICAgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwKICAgICAgZm9ybURhdGE6IHVuZGVmaW5lZAogICAgfTsKICAgIHN0YXRlLmZldGNoZXJzLnNldChrZXksIGRvbmVGZXRjaGVyKTsKICAgIHVwZGF0ZVN0YXRlKHsKICAgICAgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpCiAgICB9KTsKICB9CiAgLyoqCiAgICogVXRpbGl0eSBmdW5jdGlvbiB0byBoYW5kbGUgcmVkaXJlY3RzIHJldHVybmVkIGZyb20gYW4gYWN0aW9uIG9yIGxvYWRlci4KICAgKiBOb3JtYWxseSwgYSByZWRpcmVjdCAicmVwbGFjZXMiIHRoZSBuYXZpZ2F0aW9uIHRoYXQgdHJpZ2dlcmVkIGl0LiAgU28sIGZvcgogICAqIGV4YW1wbGU6CiAgICoKICAgKiAgLSB1c2VyIGlzIG9uIC9hCiAgICogIC0gdXNlciBjbGlja3MgYSBsaW5rIHRvIC9iCiAgICogIC0gbG9hZGVyIGZvciAvYiByZWRpcmVjdHMgdG8gL2MKICAgKgogICAqIEluIGEgbm9uLUpTIGFwcCB0aGUgYnJvd3NlciB3b3VsZCB0cmFjayB0aGUgaW4tZmxpZ2h0IG5hdmlnYXRpb24gdG8gL2IgYW5kCiAgICogdGhlbiByZXBsYWNlIGl0IHdpdGggL2Mgd2hlbiBpdCBlbmNvdW50ZXJlZCB0aGUgcmVkaXJlY3QgcmVzcG9uc2UuICBJbgogICAqIHRoZSBlbmQgaXQgd291bGQgb25seSBldmVyIHVwZGF0ZSB0aGUgVVJMIGJhciB3aXRoIC9jLgogICAqCiAgICogSW4gY2xpZW50LXNpZGUgcm91dGluZyB1c2luZyBwdXNoU3RhdGUvcmVwbGFjZVN0YXRlLCB3ZSBhaW0gdG8gZW11bGF0ZQogICAqIHRoaXMgYmVoYXZpb3IgYW5kIHdlIGFsc28gZG8gbm90IHVwZGF0ZSBoaXN0b3J5IHVudGlsIHRoZSBlbmQgb2YgdGhlCiAgICogbmF2aWdhdGlvbiAoaW5jbHVkaW5nIHByb2Nlc3NlZCByZWRpcmVjdHMpLiAgVGhpcyBtZWFucyB0aGF0IHdlIG5ldmVyCiAgICogYWN0dWFsbHkgdG91Y2ggaGlzdG9yeSB1bnRpbCB3ZSd2ZSBwcm9jZXNzZWQgcmVkaXJlY3RzLCBzbyB3ZSBqdXN0IHVzZQogICAqIHRoZSBoaXN0b3J5IGFjdGlvbiBmcm9tIHRoZSBvcmlnaW5hbCBuYXZpZ2F0aW9uIChQVVNIIG9yIFJFUExBQ0UpLgogICAqLwoKCiAgYXN5bmMgZnVuY3Rpb24gc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24ocmVkaXJlY3QsIG5hdmlnYXRpb24sIHJlcGxhY2UpIHsKICAgIGlmIChyZWRpcmVjdC5yZXZhbGlkYXRlKSB7CiAgICAgIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQgPSB0cnVlOwogICAgfQoKICAgIHJvdXRlcl9pbnZhcmlhbnQobmF2aWdhdGlvbi5sb2NhdGlvbiwgIkV4cGVjdGVkIGEgbG9jYXRpb24gb24gdGhlIHJlZGlyZWN0IG5hdmlnYXRpb24iKTsgLy8gVGhlcmUncyBubyBuZWVkIHRvIGFib3J0IG9uIHJlZGlyZWN0cywgc2luY2Ugd2UgZG9uJ3QgZGV0ZWN0IHRoZQogICAgLy8gcmVkaXJlY3QgdW50aWwgdGhlIGFjdGlvbi9sb2FkZXJzIGhhdmUgc2V0dGxlZAoKICAgIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlciA9IG51bGw7CiAgICBsZXQgcmVkaXJlY3RIaXN0b3J5QWN0aW9uID0gcmVwbGFjZSA9PT0gdHJ1ZSA/IEFjdGlvbi5SZXBsYWNlIDogQWN0aW9uLlB1c2g7CiAgICBhd2FpdCBzdGFydE5hdmlnYXRpb24ocmVkaXJlY3RIaXN0b3J5QWN0aW9uLCBuYXZpZ2F0aW9uLmxvY2F0aW9uLCB7CiAgICAgIG92ZXJyaWRlTmF2aWdhdGlvbjogbmF2aWdhdGlvbgogICAgfSk7CiAgfQoKICBhc3luYyBmdW5jdGlvbiBjYWxsTG9hZGVyc0FuZE1heWJlUmVzb2x2ZURhdGEoY3VycmVudE1hdGNoZXMsIG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIGZldGNoZXJzVG9Mb2FkLCByZXF1ZXN0KSB7CiAgICAvLyBDYWxsIGFsbCBuYXZpZ2F0aW9uIGxvYWRlcnMgYW5kIHJldmFsaWRhdGluZyBmZXRjaGVyIGxvYWRlcnMgaW4gcGFyYWxsZWwsCiAgICAvLyB0aGVuIHNsaWNlIG9mZiB0aGUgcmVzdWx0cyBpbnRvIHNlcGFyYXRlIGFycmF5cyBzbyB3ZSBjYW4gaGFuZGxlIHRoZW0KICAgIC8vIGFjY29yZGluZ2x5CiAgICBsZXQgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKFsuLi5tYXRjaGVzVG9Mb2FkLm1hcChtYXRjaCA9PiBjYWxsTG9hZGVyT3JBY3Rpb24oImxvYWRlciIsIHJlcXVlc3QsIG1hdGNoLCBtYXRjaGVzLCByb3V0ZXIuYmFzZW5hbWUpKSwgLi4uZmV0Y2hlcnNUb0xvYWQubWFwKF9yZWY4ID0+IHsKICAgICAgbGV0IFssIGhyZWYsIG1hdGNoLCBmZXRjaE1hdGNoZXNdID0gX3JlZjg7CiAgICAgIHJldHVybiBjYWxsTG9hZGVyT3JBY3Rpb24oImxvYWRlciIsIGNyZWF0ZVJlcXVlc3QoaHJlZiwgcmVxdWVzdC5zaWduYWwpLCBtYXRjaCwgZmV0Y2hNYXRjaGVzLCByb3V0ZXIuYmFzZW5hbWUpOwogICAgfSldKTsKICAgIGxldCBsb2FkZXJSZXN1bHRzID0gcmVzdWx0cy5zbGljZSgwLCBtYXRjaGVzVG9Mb2FkLmxlbmd0aCk7CiAgICBsZXQgZmV0Y2hlclJlc3VsdHMgPSByZXN1bHRzLnNsaWNlKG1hdGNoZXNUb0xvYWQubGVuZ3RoKTsKICAgIGF3YWl0IFByb21pc2UuYWxsKFtyZXNvbHZlRGVmZXJyZWRSZXN1bHRzKGN1cnJlbnRNYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCBsb2FkZXJSZXN1bHRzLCByZXF1ZXN0LnNpZ25hbCwgZmFsc2UsIHN0YXRlLmxvYWRlckRhdGEpLCByZXNvbHZlRGVmZXJyZWRSZXN1bHRzKGN1cnJlbnRNYXRjaGVzLCBmZXRjaGVyc1RvTG9hZC5tYXAoX3JlZjkgPT4gewogICAgICBsZXQgWywsIG1hdGNoXSA9IF9yZWY5OwogICAgICByZXR1cm4gbWF0Y2g7CiAgICB9KSwgZmV0Y2hlclJlc3VsdHMsIHJlcXVlc3Quc2lnbmFsLCB0cnVlKV0pOwogICAgcmV0dXJuIHsKICAgICAgcmVzdWx0cywKICAgICAgbG9hZGVyUmVzdWx0cywKICAgICAgZmV0Y2hlclJlc3VsdHMKICAgIH07CiAgfQoKICBmdW5jdGlvbiBpbnRlcnJ1cHRBY3RpdmVMb2FkcygpIHsKICAgIC8vIEV2ZXJ5IGludGVycnVwdGlvbiB0cmlnZ2VycyBhIHJldmFsaWRhdGlvbgogICAgaXNSZXZhbGlkYXRpb25SZXF1aXJlZCA9IHRydWU7IC8vIENhbmNlbCBwZW5kaW5nIHJvdXRlLWxldmVsIGRlZmVycmVkcyBhbmQgbWFyayBjYW5jZWxsZWQgcm91dGVzIGZvcgogICAgLy8gcmV2YWxpZGF0aW9uCgogICAgY2FuY2VsbGVkRGVmZXJyZWRSb3V0ZXMucHVzaCguLi5jYW5jZWxBY3RpdmVEZWZlcnJlZHMoKSk7IC8vIEFib3J0IGluLWZsaWdodCBmZXRjaGVyIGxvYWRzCgogICAgZmV0Y2hMb2FkTWF0Y2hlcy5mb3JFYWNoKChfLCBrZXkpID0+IHsKICAgICAgaWYgKGZldGNoQ29udHJvbGxlcnMuaGFzKGtleSkpIHsKICAgICAgICBjYW5jZWxsZWRGZXRjaGVyTG9hZHMucHVzaChrZXkpOwogICAgICAgIGFib3J0RmV0Y2hlcihrZXkpOwogICAgICB9CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIHNldEZldGNoZXJFcnJvcihrZXksIHJvdXRlSWQsIGVycm9yKSB7CiAgICBsZXQgYm91bmRhcnlNYXRjaCA9IGZpbmROZWFyZXN0Qm91bmRhcnkoc3RhdGUubWF0Y2hlcywgcm91dGVJZCk7CiAgICBkZWxldGVGZXRjaGVyKGtleSk7CiAgICB1cGRhdGVTdGF0ZSh7CiAgICAgIGVycm9yczogewogICAgICAgIFtib3VuZGFyeU1hdGNoLnJvdXRlLmlkXTogZXJyb3IKICAgICAgfSwKICAgICAgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpCiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGRlbGV0ZUZldGNoZXIoa2V5KSB7CiAgICBpZiAoZmV0Y2hDb250cm9sbGVycy5oYXMoa2V5KSkgYWJvcnRGZXRjaGVyKGtleSk7CiAgICBmZXRjaExvYWRNYXRjaGVzLmRlbGV0ZShrZXkpOwogICAgZmV0Y2hSZWxvYWRJZHMuZGVsZXRlKGtleSk7CiAgICBmZXRjaFJlZGlyZWN0SWRzLmRlbGV0ZShrZXkpOwogICAgc3RhdGUuZmV0Y2hlcnMuZGVsZXRlKGtleSk7CiAgfQoKICBmdW5jdGlvbiBhYm9ydEZldGNoZXIoa2V5KSB7CiAgICBsZXQgY29udHJvbGxlciA9IGZldGNoQ29udHJvbGxlcnMuZ2V0KGtleSk7CiAgICByb3V0ZXJfaW52YXJpYW50KGNvbnRyb2xsZXIsICJFeHBlY3RlZCBmZXRjaCBjb250cm9sbGVyOiAiICsga2V5KTsKICAgIGNvbnRyb2xsZXIuYWJvcnQoKTsKICAgIGZldGNoQ29udHJvbGxlcnMuZGVsZXRlKGtleSk7CiAgfQoKICBmdW5jdGlvbiBtYXJrRmV0Y2hlcnNEb25lKGtleXMpIHsKICAgIGZvciAobGV0IGtleSBvZiBrZXlzKSB7CiAgICAgIGxldCBmZXRjaGVyID0gZ2V0RmV0Y2hlcihrZXkpOwogICAgICBsZXQgZG9uZUZldGNoZXIgPSB7CiAgICAgICAgc3RhdGU6ICJpZGxlIiwKICAgICAgICBkYXRhOiBmZXRjaGVyLmRhdGEsCiAgICAgICAgZm9ybU1ldGhvZDogdW5kZWZpbmVkLAogICAgICAgIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwKICAgICAgICBmb3JtRW5jVHlwZTogdW5kZWZpbmVkLAogICAgICAgIGZvcm1EYXRhOiB1bmRlZmluZWQKICAgICAgfTsKICAgICAgc3RhdGUuZmV0Y2hlcnMuc2V0KGtleSwgZG9uZUZldGNoZXIpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gbWFya0ZldGNoUmVkaXJlY3RzRG9uZSgpIHsKICAgIGxldCBkb25lS2V5cyA9IFtdOwoKICAgIGZvciAobGV0IGtleSBvZiBmZXRjaFJlZGlyZWN0SWRzKSB7CiAgICAgIGxldCBmZXRjaGVyID0gc3RhdGUuZmV0Y2hlcnMuZ2V0KGtleSk7CiAgICAgIHJvdXRlcl9pbnZhcmlhbnQoZmV0Y2hlciwgIkV4cGVjdGVkIGZldGNoZXI6ICIgKyBrZXkpOwoKICAgICAgaWYgKGZldGNoZXIuc3RhdGUgPT09ICJsb2FkaW5nIikgewogICAgICAgIGZldGNoUmVkaXJlY3RJZHMuZGVsZXRlKGtleSk7CiAgICAgICAgZG9uZUtleXMucHVzaChrZXkpOwogICAgICB9CiAgICB9CgogICAgbWFya0ZldGNoZXJzRG9uZShkb25lS2V5cyk7CiAgfQoKICBmdW5jdGlvbiBhYm9ydFN0YWxlRmV0Y2hMb2FkcyhsYW5kZWRJZCkgewogICAgbGV0IHllZXRlZEtleXMgPSBbXTsKCiAgICBmb3IgKGxldCBba2V5LCBpZF0gb2YgZmV0Y2hSZWxvYWRJZHMpIHsKICAgICAgaWYgKGlkIDwgbGFuZGVkSWQpIHsKICAgICAgICBsZXQgZmV0Y2hlciA9IHN0YXRlLmZldGNoZXJzLmdldChrZXkpOwogICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoZmV0Y2hlciwgIkV4cGVjdGVkIGZldGNoZXI6ICIgKyBrZXkpOwoKICAgICAgICBpZiAoZmV0Y2hlci5zdGF0ZSA9PT0gImxvYWRpbmciKSB7CiAgICAgICAgICBhYm9ydEZldGNoZXIoa2V5KTsKICAgICAgICAgIGZldGNoUmVsb2FkSWRzLmRlbGV0ZShrZXkpOwogICAgICAgICAgeWVldGVkS2V5cy5wdXNoKGtleSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgbWFya0ZldGNoZXJzRG9uZSh5ZWV0ZWRLZXlzKTsKICAgIHJldHVybiB5ZWV0ZWRLZXlzLmxlbmd0aCA+IDA7CiAgfQoKICBmdW5jdGlvbiBjYW5jZWxBY3RpdmVEZWZlcnJlZHMocHJlZGljYXRlKSB7CiAgICBsZXQgY2FuY2VsbGVkUm91dGVJZHMgPSBbXTsKICAgIGFjdGl2ZURlZmVycmVkcy5mb3JFYWNoKChkZmQsIHJvdXRlSWQpID0+IHsKICAgICAgaWYgKCFwcmVkaWNhdGUgfHwgcHJlZGljYXRlKHJvdXRlSWQpKSB7CiAgICAgICAgLy8gQ2FuY2VsIHRoZSBkZWZlcnJlZCAtIGJ1dCBkbyBub3QgcmVtb3ZlIGZyb20gYWN0aXZlRGVmZXJyZWRzIGhlcmUgLQogICAgICAgIC8vIHdlIHJlbHkgb24gdGhlIHN1YnNjcmliZXJzIHRvIGRvIHRoYXQgc28gb3VyIHRlc3RzIGNhbiBhc3NlcnQgcHJvcGVyCiAgICAgICAgLy8gY2xlYW51cCB2aWEgX2ludGVybmFsQWN0aXZlRGVmZXJyZWRzCiAgICAgICAgZGZkLmNhbmNlbCgpOwogICAgICAgIGNhbmNlbGxlZFJvdXRlSWRzLnB1c2gocm91dGVJZCk7CiAgICAgICAgYWN0aXZlRGVmZXJyZWRzLmRlbGV0ZShyb3V0ZUlkKTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gY2FuY2VsbGVkUm91dGVJZHM7CiAgfSAvLyBPcHQgaW4gdG8gY2FwdHVyaW5nIGFuZCByZXBvcnRpbmcgc2Nyb2xsIHBvc2l0aW9ucyBkdXJpbmcgbmF2aWdhdGlvbnMsCiAgLy8gdXNlZCBieSB0aGUgPFNjcm9sbFJlc3RvcmF0aW9uPiBjb21wb25lbnQKCgogIGZ1bmN0aW9uIGVuYWJsZVNjcm9sbFJlc3RvcmF0aW9uKHBvc2l0aW9ucywgZ2V0UG9zaXRpb24sIGdldEtleSkgewogICAgc2F2ZWRTY3JvbGxQb3NpdGlvbnMgPSBwb3NpdGlvbnM7CiAgICBnZXRTY3JvbGxQb3NpdGlvbiA9IGdldFBvc2l0aW9uOwoKICAgIGdldFNjcm9sbFJlc3RvcmF0aW9uS2V5ID0gZ2V0S2V5IHx8IChsb2NhdGlvbiA9PiBsb2NhdGlvbi5rZXkpOyAvLyBQZXJmb3JtIGluaXRpYWwgaHlkcmF0aW9uIHNjcm9sbCByZXN0b3JhdGlvbiwgc2luY2Ugd2UgbWlzcyB0aGUgYm9hdCBvbgogICAgLy8gdGhlIGluaXRpYWwgdXBkYXRlU3RhdGUoKSBiZWNhdXNlIHdlJ3ZlIG5vdCB5ZXQgcmVuZGVyZWQgPFNjcm9sbFJlc3RvcmF0aW9uLz4KICAgIC8vIGFuZCB0aGVyZWZvcmUgaGF2ZSBubyBzYXZlZFNjcm9sbFBvc2l0aW9ucyBhdmFpbGFibGUKCgogICAgaWYgKCFpbml0aWFsU2Nyb2xsUmVzdG9yZWQgJiYgc3RhdGUubmF2aWdhdGlvbiA9PT0gSURMRV9OQVZJR0FUSU9OKSB7CiAgICAgIGluaXRpYWxTY3JvbGxSZXN0b3JlZCA9IHRydWU7CiAgICAgIGxldCB5ID0gZ2V0U2F2ZWRTY3JvbGxQb3NpdGlvbihzdGF0ZS5sb2NhdGlvbiwgc3RhdGUubWF0Y2hlcyk7CgogICAgICBpZiAoeSAhPSBudWxsKSB7CiAgICAgICAgdXBkYXRlU3RhdGUoewogICAgICAgICAgcmVzdG9yZVNjcm9sbFBvc2l0aW9uOiB5CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gKCkgPT4gewogICAgICBzYXZlZFNjcm9sbFBvc2l0aW9ucyA9IG51bGw7CiAgICAgIGdldFNjcm9sbFBvc2l0aW9uID0gbnVsbDsKICAgICAgZ2V0U2Nyb2xsUmVzdG9yYXRpb25LZXkgPSBudWxsOwogICAgfTsKICB9CgogIGZ1bmN0aW9uIHNhdmVTY3JvbGxQb3NpdGlvbihsb2NhdGlvbiwgbWF0Y2hlcykgewogICAgaWYgKHNhdmVkU2Nyb2xsUG9zaXRpb25zICYmIGdldFNjcm9sbFJlc3RvcmF0aW9uS2V5ICYmIGdldFNjcm9sbFBvc2l0aW9uKSB7CiAgICAgIGxldCB1c2VyTWF0Y2hlcyA9IG1hdGNoZXMubWFwKG0gPT4gY3JlYXRlVXNlTWF0Y2hlc01hdGNoKG0sIHN0YXRlLmxvYWRlckRhdGEpKTsKICAgICAgbGV0IGtleSA9IGdldFNjcm9sbFJlc3RvcmF0aW9uS2V5KGxvY2F0aW9uLCB1c2VyTWF0Y2hlcykgfHwgbG9jYXRpb24ua2V5OwogICAgICBzYXZlZFNjcm9sbFBvc2l0aW9uc1trZXldID0gZ2V0U2Nyb2xsUG9zaXRpb24oKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdldFNhdmVkU2Nyb2xsUG9zaXRpb24obG9jYXRpb24sIG1hdGNoZXMpIHsKICAgIGlmIChzYXZlZFNjcm9sbFBvc2l0aW9ucyAmJiBnZXRTY3JvbGxSZXN0b3JhdGlvbktleSAmJiBnZXRTY3JvbGxQb3NpdGlvbikgewogICAgICBsZXQgdXNlck1hdGNoZXMgPSBtYXRjaGVzLm1hcChtID0+IGNyZWF0ZVVzZU1hdGNoZXNNYXRjaChtLCBzdGF0ZS5sb2FkZXJEYXRhKSk7CiAgICAgIGxldCBrZXkgPSBnZXRTY3JvbGxSZXN0b3JhdGlvbktleShsb2NhdGlvbiwgdXNlck1hdGNoZXMpIHx8IGxvY2F0aW9uLmtleTsKICAgICAgbGV0IHkgPSBzYXZlZFNjcm9sbFBvc2l0aW9uc1trZXldOwoKICAgICAgaWYgKHR5cGVvZiB5ID09PSAibnVtYmVyIikgewogICAgICAgIHJldHVybiB5OwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIG51bGw7CiAgfQoKICByb3V0ZXIgPSB7CiAgICBnZXQgYmFzZW5hbWUoKSB7CiAgICAgIHJldHVybiBpbml0LmJhc2VuYW1lOwogICAgfSwKCiAgICBnZXQgc3RhdGUoKSB7CiAgICAgIHJldHVybiBzdGF0ZTsKICAgIH0sCgogICAgZ2V0IHJvdXRlcygpIHsKICAgICAgcmV0dXJuIGRhdGFSb3V0ZXM7CiAgICB9LAoKICAgIGluaXRpYWxpemUsCiAgICBzdWJzY3JpYmUsCiAgICBlbmFibGVTY3JvbGxSZXN0b3JhdGlvbiwKICAgIG5hdmlnYXRlLAogICAgZmV0Y2gsCiAgICByZXZhbGlkYXRlLAogICAgLy8gUGFzc3Rocm91Z2ggdG8gaGlzdG9yeS1hd2FyZSBjcmVhdGVIcmVmIHVzZWQgYnkgdXNlSHJlZiBzbyB3ZSBnZXQgcHJvcGVyCiAgICAvLyBoYXNoLWF3YXJlIFVSTHMgaW4gRE9NIHBhdGhzCiAgICBjcmVhdGVIcmVmOiB0byA9PiBpbml0Lmhpc3RvcnkuY3JlYXRlSHJlZih0byksCiAgICBnZXRGZXRjaGVyLAogICAgZGVsZXRlRmV0Y2hlciwKICAgIGRpc3Bvc2UsCiAgICBfaW50ZXJuYWxGZXRjaENvbnRyb2xsZXJzOiBmZXRjaENvbnRyb2xsZXJzLAogICAgX2ludGVybmFsQWN0aXZlRGVmZXJyZWRzOiBhY3RpdmVEZWZlcnJlZHMKICB9OwogIHJldHVybiByb3V0ZXI7Cn0gLy8jZW5kcmVnaW9uCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vI3JlZ2lvbiBjcmVhdGVTdGF0aWNIYW5kbGVyCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgpjb25zdCB2YWxpZEFjdGlvbk1ldGhvZHMgPSBuZXcgU2V0KFsiUE9TVCIsICJQVVQiLCAiUEFUQ0giLCAiREVMRVRFIl0pOwpjb25zdCB2YWxpZFJlcXVlc3RNZXRob2RzID0gbmV3IFNldChbIkdFVCIsICJIRUFEIiwgLi4udmFsaWRBY3Rpb25NZXRob2RzXSk7CmZ1bmN0aW9uIHVuc3RhYmxlX2NyZWF0ZVN0YXRpY0hhbmRsZXIocm91dGVzKSB7CiAgcm91dGVyX2ludmFyaWFudChyb3V0ZXMubGVuZ3RoID4gMCwgIllvdSBtdXN0IHByb3ZpZGUgYSBub24tZW1wdHkgcm91dGVzIGFycmF5IHRvIHVuc3RhYmxlX2NyZWF0ZVN0YXRpY0hhbmRsZXIiKTsKICBsZXQgZGF0YVJvdXRlcyA9IGNvbnZlcnRSb3V0ZXNUb0RhdGFSb3V0ZXMocm91dGVzKTsKICAvKioKICAgKiBUaGUgcXVlcnkoKSBtZXRob2QgaXMgaW50ZW5kZWQgZm9yIGRvY3VtZW50IHJlcXVlc3RzLCBpbiB3aGljaCB3ZSB3YW50IHRvCiAgICogY2FsbCBhbiBvcHRpb25hbCBhY3Rpb24gYW5kIHBvdGVudGlhbGx5IG11bHRpcGxlIGxvYWRlcnMgZm9yIGFsbCBuZXN0ZWQKICAgKiByb3V0ZXMuICBJdCByZXR1cm5zIGEgU3RhdGljSGFuZGxlckNvbnRleHQgb2JqZWN0LCB3aGljaCBpcyB2ZXJ5IHNpbWlsYXIKICAgKiB0byB0aGUgcm91dGVyIHN0YXRlIChsb2NhdGlvbiwgbG9hZGVyRGF0YSwgYWN0aW9uRGF0YSwgZXJyb3JzLCBldGMuKSBhbmQKICAgKiBhbHNvIGFkZHMgU1NSLXNwZWNpZmljIGluZm9ybWF0aW9uIHN1Y2ggYXMgdGhlIHN0YXR1c0NvZGUgYW5kIGhlYWRlcnMKICAgKiBmcm9tIGFjdGlvbi9sb2FkZXJzIFJlc3BvbnNlcy4KICAgKgogICAqIEl0IF9zaG91bGRfIG5ldmVyIHRocm93IGFuZCBzaG91bGQgcmVwb3J0IGFsbCBlcnJvcnMgdGhyb3VnaCB0aGUKICAgKiByZXR1cm5lZCBjb250ZXh0LmVycm9ycyBvYmplY3QsIHByb3Blcmx5IGFzc29jaWF0aW5nIGVycm9ycyB0byB0aGVpciBlcnJvcgogICAqIGJvdW5kYXJ5LiAgQWRkaXRpb25hbGx5LCBpdCB0cmFja3MgX2RlZXBlc3RSZW5kZXJlZEJvdW5kYXJ5SWQgd2hpY2ggY2FuIGJlCiAgICogdXNlZCB0byBlbXVsYXRlIFJlYWN0IGVycm9yIGJvdW5kYXJpZXMgZHVyaW5nIFNTciBieSBwZXJmb3JtaW5nIGEgc2Vjb25kCiAgICogcGFzcyBvbmx5IGRvd24gdG8gdGhlIGJvdW5kYXJ5SWQuCiAgICoKICAgKiBUaGUgb25lIGV4Y2VwdGlvbiB3aGVyZSB3ZSBkbyBub3QgcmV0dXJuIGEgU3RhdGljSGFuZGxlckNvbnRleHQgaXMgd2hlbiBhCiAgICogcmVkaXJlY3QgcmVzcG9uc2UgaXMgcmV0dXJuZWQgb3IgdGhyb3duIGZyb20gYW55IGFjdGlvbi9sb2FkZXIuICBXZQogICAqIHByb3BhZ2F0ZSB0aGF0IG91dCBhbmQgcmV0dXJuIHRoZSByYXcgUmVzcG9uc2Ugc28gdGhlIEhUVFAgc2VydmVyIGNhbgogICAqIHJldHVybiBpdCBkaXJlY3RseS4KICAgKi8KCiAgYXN5bmMgZnVuY3Rpb24gcXVlcnkocmVxdWVzdCkgewogICAgbGV0IHVybCA9IG5ldyBVUkwocmVxdWVzdC51cmwpOwogICAgbGV0IGxvY2F0aW9uID0gY3JlYXRlTG9jYXRpb24oIiIsIHJvdXRlcl9jcmVhdGVQYXRoKHVybCksIG51bGwsICJkZWZhdWx0Iik7CiAgICBsZXQgbWF0Y2hlcyA9IG1hdGNoUm91dGVzKGRhdGFSb3V0ZXMsIGxvY2F0aW9uKTsKCiAgICBpZiAoIXZhbGlkUmVxdWVzdE1ldGhvZHMuaGFzKHJlcXVlc3QubWV0aG9kKSkgewogICAgICBsZXQgewogICAgICAgIG1hdGNoZXM6IG1ldGhvZE5vdEFsbG93ZWRNYXRjaGVzLAogICAgICAgIHJvdXRlLAogICAgICAgIGVycm9yCiAgICAgIH0gPSBnZXRNZXRob2ROb3RBbGxvd2VkTWF0Y2hlcyhkYXRhUm91dGVzKTsKICAgICAgcmV0dXJuIHsKICAgICAgICBsb2NhdGlvbiwKICAgICAgICBtYXRjaGVzOiBtZXRob2ROb3RBbGxvd2VkTWF0Y2hlcywKICAgICAgICBsb2FkZXJEYXRhOiB7fSwKICAgICAgICBhY3Rpb25EYXRhOiBudWxsLAogICAgICAgIGVycm9yczogewogICAgICAgICAgW3JvdXRlLmlkXTogZXJyb3IKICAgICAgICB9LAogICAgICAgIHN0YXR1c0NvZGU6IGVycm9yLnN0YXR1cywKICAgICAgICBsb2FkZXJIZWFkZXJzOiB7fSwKICAgICAgICBhY3Rpb25IZWFkZXJzOiB7fQogICAgICB9OwogICAgfSBlbHNlIGlmICghbWF0Y2hlcykgewogICAgICBsZXQgewogICAgICAgIG1hdGNoZXM6IG5vdEZvdW5kTWF0Y2hlcywKICAgICAgICByb3V0ZSwKICAgICAgICBlcnJvcgogICAgICB9ID0gZ2V0Tm90Rm91bmRNYXRjaGVzKGRhdGFSb3V0ZXMpOwogICAgICByZXR1cm4gewogICAgICAgIGxvY2F0aW9uLAogICAgICAgIG1hdGNoZXM6IG5vdEZvdW5kTWF0Y2hlcywKICAgICAgICBsb2FkZXJEYXRhOiB7fSwKICAgICAgICBhY3Rpb25EYXRhOiBudWxsLAogICAgICAgIGVycm9yczogewogICAgICAgICAgW3JvdXRlLmlkXTogZXJyb3IKICAgICAgICB9LAogICAgICAgIHN0YXR1c0NvZGU6IGVycm9yLnN0YXR1cywKICAgICAgICBsb2FkZXJIZWFkZXJzOiB7fSwKICAgICAgICBhY3Rpb25IZWFkZXJzOiB7fQogICAgICB9OwogICAgfQoKICAgIGxldCByZXN1bHQgPSBhd2FpdCBxdWVyeUltcGwocmVxdWVzdCwgbG9jYXRpb24sIG1hdGNoZXMpOwoKICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBSZXNwb25zZSkgewogICAgICByZXR1cm4gcmVzdWx0OwogICAgfSAvLyBXaGVuIHJldHVybmluZyBTdGF0aWNIYW5kbGVyQ29udGV4dCwgd2UgcGF0Y2ggYmFjayBpbiB0aGUgbG9jYXRpb24gaGVyZQogICAgLy8gc2luY2Ugd2UgbmVlZCBpdCBmb3IgUmVhY3QgQ29udGV4dC4gIEJ1dCB0aGlzIGhlbHBzIGtlZXAgb3VyIHN1Ym1pdCBhbmQKICAgIC8vIGxvYWRSb3V0ZURhdGEgb3BlcmF0aW5nIG9uIGEgUmVxdWVzdCBpbnN0ZWFkIG9mIGEgTG9jYXRpb24KCgogICAgcmV0dXJuIF9leHRlbmRzKHsKICAgICAgbG9jYXRpb24KICAgIH0sIHJlc3VsdCk7CiAgfQogIC8qKgogICAqIFRoZSBxdWVyeVJvdXRlKCkgbWV0aG9kIGlzIGludGVuZGVkIGZvciB0YXJnZXRlZCByb3V0ZSByZXF1ZXN0cywgZWl0aGVyCiAgICogZm9yIGZldGNoID9fZGF0YSByZXF1ZXN0cyBvciByZXNvdXJjZSByb3V0ZSByZXF1ZXN0cy4gIEluIHRoaXMgY2FzZSwgd2UKICAgKiBhcmUgb25seSBldmVyIGNhbGxpbmcgYSBzaW5nbGUgYWN0aW9uIG9yIGxvYWRlciwgYW5kIHdlIGFyZSByZXR1cm5pbmcgdGhlCiAgICogcmV0dXJuZWQgdmFsdWUgZGlyZWN0bHkuICBJbiBtb3N0IGNhc2VzLCB0aGlzIHdpbGwgYmUgYSBSZXNwb25zZSByZXR1cm5lZAogICAqIGZyb20gdGhlIGFjdGlvbi9sb2FkZXIsIGJ1dCBpdCBtYXkgYmUgYSBwcmltaXRpdmUgb3Igb3RoZXIgdmFsdWUgYXMgd2VsbCAtCiAgICogYW5kIGluIHN1Y2ggY2FzZXMgdGhlIGNhbGxpbmcgY29udGV4dCBzaG91bGQgaGFuZGxlIHRoYXQgYWNjb3JkaW5nbHkuCiAgICoKICAgKiBXZSBkbyByZXNwZWN0IHRoZSB0aHJvdy9yZXR1cm4gZGlmZmVyZW50aWF0aW9uLCBzbyBpZiBhbiBhY3Rpb24vbG9hZGVyCiAgICogdGhyb3dzLCB0aGVuIHRoaXMgbWV0aG9kIHdpbGwgdGhyb3cgdGhlIHZhbHVlLiAgVGhpcyBpcyBpbXBvcnRhbnQgc28gd2UKICAgKiBjYW4gZG8gcHJvcGVyIGJvdW5kYXJ5IGlkZW50aWZpY2F0aW9uIGluIFJlbWl4IHdoZXJlIGEgdGhyb3duIFJlc3BvbnNlCiAgICogbXVzdCBnbyB0byB0aGUgQ2F0Y2ggQm91bmRhcnkgYnV0IGEgcmV0dXJuZWQgUmVzcG9uc2UgaXMgaGFwcHktcGF0aC4KICAgKgogICAqIE9uZSB0aGluZyB0byBub3RlIGlzIHRoYXQgYW55IFJvdXRlci1pbml0aWF0ZWQgdGhyb3duIFJlc3BvbnNlIChzdWNoIGFzIGEKICAgKiA0MDQgb3IgNDA1KSB3aWxsIGhhdmUgYSBjdXN0b20gWC1SZW1peC1Sb3V0ZXItRXJyb3I6ICJ5ZXMiIGhlYWRlciBvbiBpdAogICAqIGluIG9yZGVyIHRvIGRpZmZlcmVudGlhdGUgZnJvbSByZXNwb25zZXMgdGhyb3duIGZyb20gdXNlciBhY3Rpb25zL2xvYWRlcnMuCiAgICovCgoKICBhc3luYyBmdW5jdGlvbiBxdWVyeVJvdXRlKHJlcXVlc3QsIHJvdXRlSWQpIHsKICAgIGxldCB1cmwgPSBuZXcgVVJMKHJlcXVlc3QudXJsKTsKICAgIGxldCBsb2NhdGlvbiA9IGNyZWF0ZUxvY2F0aW9uKCIiLCByb3V0ZXJfY3JlYXRlUGF0aCh1cmwpLCBudWxsLCAiZGVmYXVsdCIpOwogICAgbGV0IG1hdGNoZXMgPSBtYXRjaFJvdXRlcyhkYXRhUm91dGVzLCBsb2NhdGlvbik7CgogICAgaWYgKCF2YWxpZFJlcXVlc3RNZXRob2RzLmhhcyhyZXF1ZXN0Lm1ldGhvZCkpIHsKICAgICAgdGhyb3cgY3JlYXRlUm91dGVyRXJyb3JSZXNwb25zZShudWxsLCB7CiAgICAgICAgc3RhdHVzOiA0MDUsCiAgICAgICAgc3RhdHVzVGV4dDogIk1ldGhvZCBOb3QgQWxsb3dlZCIKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKCFtYXRjaGVzKSB7CiAgICAgIHRocm93IGNyZWF0ZVJvdXRlckVycm9yUmVzcG9uc2UobnVsbCwgewogICAgICAgIHN0YXR1czogNDA0LAogICAgICAgIHN0YXR1c1RleHQ6ICJOb3QgRm91bmQiCiAgICAgIH0pOwogICAgfQoKICAgIGxldCBtYXRjaCA9IHJvdXRlSWQgPyBtYXRjaGVzLmZpbmQobSA9PiBtLnJvdXRlLmlkID09PSByb3V0ZUlkKSA6IGdldFRhcmdldE1hdGNoKG1hdGNoZXMsIGxvY2F0aW9uKTsKCiAgICBpZiAoIW1hdGNoKSB7CiAgICAgIHRocm93IGNyZWF0ZVJvdXRlckVycm9yUmVzcG9uc2UobnVsbCwgewogICAgICAgIHN0YXR1czogNDA0LAogICAgICAgIHN0YXR1c1RleHQ6ICJOb3QgRm91bmQiCiAgICAgIH0pOwogICAgfQoKICAgIGxldCByZXN1bHQgPSBhd2FpdCBxdWVyeUltcGwocmVxdWVzdCwgbG9jYXRpb24sIG1hdGNoZXMsIG1hdGNoKTsKCiAgICBpZiAocmVzdWx0IGluc3RhbmNlb2YgUmVzcG9uc2UpIHsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICBsZXQgZXJyb3IgPSByZXN1bHQuZXJyb3JzID8gT2JqZWN0LnZhbHVlcyhyZXN1bHQuZXJyb3JzKVswXSA6IHVuZGVmaW5lZDsKCiAgICBpZiAoZXJyb3IgIT09IHVuZGVmaW5lZCkgewogICAgICAvLyBJZiB3ZSBnb3QgYmFjayByZXN1bHQuZXJyb3JzLCB0aGF0IG1lYW5zIHRoZSBsb2FkZXIvYWN0aW9uIHRocmV3CiAgICAgIC8vIF9zb21ldGhpbmdfIHRoYXQgd2Fzbid0IGEgUmVzcG9uc2UsIGJ1dCBpdCdzIG5vdCBndWFyYW50ZWVkL3JlcXVpcmVkCiAgICAgIC8vIHRvIGJlIGFuIGBpbnN0YW5jZW9mIEVycm9yYCBlaXRoZXIsIHNvIHdlIGhhdmUgdG8gdXNlIHRocm93IGhlcmUgdG8KICAgICAgLy8gcHJlc2VydmUgdGhlICJlcnJvciIgc3RhdGUgb3V0c2lkZSBvZiBxdWVyeUltcGwuCiAgICAgIHRocm93IGVycm9yOwogICAgfSAvLyBQaWNrIG9mZiB0aGUgcmlnaHQgc3RhdGUgdmFsdWUgdG8gcmV0dXJuCgoKICAgIGxldCByb3V0ZURhdGEgPSBbcmVzdWx0LmFjdGlvbkRhdGEsIHJlc3VsdC5sb2FkZXJEYXRhXS5maW5kKHYgPT4gdik7CiAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyhyb3V0ZURhdGEgfHwge30pWzBdOwogIH0KCiAgYXN5bmMgZnVuY3Rpb24gcXVlcnlJbXBsKHJlcXVlc3QsIGxvY2F0aW9uLCBtYXRjaGVzLCByb3V0ZU1hdGNoKSB7CiAgICByb3V0ZXJfaW52YXJpYW50KHJlcXVlc3Quc2lnbmFsLCAicXVlcnkoKS9xdWVyeVJvdXRlKCkgcmVxdWVzdHMgbXVzdCBjb250YWluIGFuIEFib3J0Q29udHJvbGxlciBzaWduYWwiKTsKCiAgICB0cnkgewogICAgICBpZiAodmFsaWRBY3Rpb25NZXRob2RzLmhhcyhyZXF1ZXN0Lm1ldGhvZCkpIHsKICAgICAgICBsZXQgcmVzdWx0ID0gYXdhaXQgc3VibWl0KHJlcXVlc3QsIG1hdGNoZXMsIHJvdXRlTWF0Y2ggfHwgZ2V0VGFyZ2V0TWF0Y2gobWF0Y2hlcywgbG9jYXRpb24pLCByb3V0ZU1hdGNoICE9IG51bGwpOwogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KCiAgICAgIGxldCByZXN1bHQgPSBhd2FpdCBsb2FkUm91dGVEYXRhKHJlcXVlc3QsIG1hdGNoZXMsIHJvdXRlTWF0Y2gpOwogICAgICByZXR1cm4gcmVzdWx0IGluc3RhbmNlb2YgUmVzcG9uc2UgPyByZXN1bHQgOiBfZXh0ZW5kcyh7fSwgcmVzdWx0LCB7CiAgICAgICAgYWN0aW9uRGF0YTogbnVsbCwKICAgICAgICBhY3Rpb25IZWFkZXJzOiB7fQogICAgICB9KTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgLy8gSWYgdGhlIHVzZXIgdGhyZXcvcmV0dXJuZWQgYSBSZXNwb25zZSBpbiBjYWxsTG9hZGVyT3JBY3Rpb24sIHdlIHRocm93CiAgICAgIC8vIGl0IHRvIGJhaWwgb3V0IGFuZCB0aGVuIHJldHVybiBvciB0aHJvdyBoZXJlIGJhc2VkIG9uIHdoZXRoZXIgdGhlIHVzZXIKICAgICAgLy8gcmV0dXJuZWQgb3IgdGhyZXcKICAgICAgaWYgKGlzUXVlcnlSb3V0ZVJlc3BvbnNlKGUpKSB7CiAgICAgICAgaWYgKGUudHlwZSA9PT0gUmVzdWx0VHlwZS5lcnJvciAmJiAhaXNSZWRpcmVjdFJlc3BvbnNlKGUucmVzcG9uc2UpKSB7CiAgICAgICAgICB0aHJvdyBlLnJlc3BvbnNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGUucmVzcG9uc2U7CiAgICAgIH0gLy8gUmVkaXJlY3RzIGFyZSBhbHdheXMgcmV0dXJuZWQgc2luY2UgdGhleSBkb24ndCBwcm9wYWdhdGUgdG8gY2F0Y2gKICAgICAgLy8gYm91bmRhcmllcwoKCiAgICAgIGlmIChpc1JlZGlyZWN0UmVzcG9uc2UoZSkpIHsKICAgICAgICByZXR1cm4gZTsKICAgICAgfQoKICAgICAgdGhyb3cgZTsKICAgIH0KICB9CgogIGFzeW5jIGZ1bmN0aW9uIHN1Ym1pdChyZXF1ZXN0LCBtYXRjaGVzLCBhY3Rpb25NYXRjaCwgaXNSb3V0ZVJlcXVlc3QpIHsKICAgIGxldCByZXN1bHQ7CgogICAgaWYgKCFhY3Rpb25NYXRjaC5yb3V0ZS5hY3Rpb24pIHsKICAgICAgaWYgKGlzUm91dGVSZXF1ZXN0KSB7CiAgICAgICAgdGhyb3cgY3JlYXRlUm91dGVyRXJyb3JSZXNwb25zZShudWxsLCB7CiAgICAgICAgICBzdGF0dXM6IDQwNSwKICAgICAgICAgIHN0YXR1c1RleHQ6ICJNZXRob2QgTm90IEFsbG93ZWQiCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHJlc3VsdCA9IGdldE1ldGhvZE5vdEFsbG93ZWRSZXN1bHQocmVxdWVzdC51cmwpOwogICAgfSBlbHNlIHsKICAgICAgcmVzdWx0ID0gYXdhaXQgY2FsbExvYWRlck9yQWN0aW9uKCJhY3Rpb24iLCByZXF1ZXN0LCBhY3Rpb25NYXRjaCwgbWF0Y2hlcywgdW5kZWZpbmVkLCAvLyBCYXNlbmFtZSBub3QgY3VycmVudGx5IHN1cHBvcnRlZCBpbiBzdGF0aWMgaGFuZGxlcnMKICAgICAgdHJ1ZSwgaXNSb3V0ZVJlcXVlc3QpOwoKICAgICAgaWYgKHJlcXVlc3Quc2lnbmFsLmFib3J0ZWQpIHsKICAgICAgICBsZXQgbWV0aG9kID0gaXNSb3V0ZVJlcXVlc3QgPyAicXVlcnlSb3V0ZSIgOiAicXVlcnkiOwogICAgICAgIHRocm93IG5ldyBFcnJvcihtZXRob2QgKyAiKCkgY2FsbCBhYm9ydGVkIik7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoaXNSZWRpcmVjdFJlc3VsdChyZXN1bHQpKSB7CiAgICAgIC8vIFVoaGhoIC0gdGhpcyBzaG91bGQgbmV2ZXIgaGFwcGVuLCB3ZSBzaG91bGQgYWx3YXlzIHRocm93IHRoZXNlIGZyb20KICAgICAgLy8gY2FsbExvYWRlck9yQWN0aW9uLCBidXQgdGhlIHR5cGUgbmFycm93aW5nIGhlcmUga2VlcHMgVFMgaGFwcHkgYW5kIHdlCiAgICAgIC8vIGNhbiBnZXQgYmFjayBvbiB0aGUgInRocm93IGFsbCByZWRpcmVjdCByZXNwb25zZXMiIHRyYWluIGhlcmUgc2hvdWxkCiAgICAgIC8vIHRoaXMgZXZlciBoYXBwZW4gOi8KICAgICAgdGhyb3cgbmV3IFJlc3BvbnNlKG51bGwsIHsKICAgICAgICBzdGF0dXM6IHJlc3VsdC5zdGF0dXMsCiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgTG9jYXRpb246IHJlc3VsdC5sb2NhdGlvbgogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgaWYgKGlzRGVmZXJyZWRSZXN1bHQocmVzdWx0KSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoImRlZmVyKCkgaXMgbm90IHN1cHBvcnRlZCBpbiBhY3Rpb25zIik7CiAgICB9CgogICAgaWYgKGlzUm91dGVSZXF1ZXN0KSB7CiAgICAgIC8vIE5vdGU6IFRoaXMgc2hvdWxkIG9ubHkgYmUgbm9uLVJlc3BvbnNlIHZhbHVlcyBpZiB3ZSBnZXQgaGVyZSwgc2luY2UKICAgICAgLy8gaXNSb3V0ZVJlcXVlc3Qgc2hvdWxkIHRocm93IGFueSBSZXNwb25zZSByZWNlaXZlZCBpbiBjYWxsTG9hZGVyT3JBY3Rpb24KICAgICAgaWYgKGlzRXJyb3JSZXN1bHQocmVzdWx0KSkgewogICAgICAgIGxldCBib3VuZGFyeU1hdGNoID0gZmluZE5lYXJlc3RCb3VuZGFyeShtYXRjaGVzLCBhY3Rpb25NYXRjaC5yb3V0ZS5pZCk7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIG1hdGNoZXM6IFthY3Rpb25NYXRjaF0sCiAgICAgICAgICBsb2FkZXJEYXRhOiB7fSwKICAgICAgICAgIGFjdGlvbkRhdGE6IG51bGwsCiAgICAgICAgICBlcnJvcnM6IHsKICAgICAgICAgICAgW2JvdW5kYXJ5TWF0Y2gucm91dGUuaWRdOiByZXN1bHQuZXJyb3IKICAgICAgICAgIH0sCiAgICAgICAgICAvLyBOb3RlOiBzdGF0dXNDb2RlICsgaGVhZGVycyBhcmUgdW51c2VkIGhlcmUgc2luY2UgcXVlcnlSb3V0ZSB3aWxsCiAgICAgICAgICAvLyByZXR1cm4gdGhlIHJhdyBSZXNwb25zZSBvciB2YWx1ZQogICAgICAgICAgc3RhdHVzQ29kZTogNTAwLAogICAgICAgICAgbG9hZGVySGVhZGVyczoge30sCiAgICAgICAgICBhY3Rpb25IZWFkZXJzOiB7fQogICAgICAgIH07CiAgICAgIH0KCiAgICAgIHJldHVybiB7CiAgICAgICAgbWF0Y2hlczogW2FjdGlvbk1hdGNoXSwKICAgICAgICBsb2FkZXJEYXRhOiB7fSwKICAgICAgICBhY3Rpb25EYXRhOiB7CiAgICAgICAgICBbYWN0aW9uTWF0Y2gucm91dGUuaWRdOiByZXN1bHQuZGF0YQogICAgICAgIH0sCiAgICAgICAgZXJyb3JzOiBudWxsLAogICAgICAgIC8vIE5vdGU6IHN0YXR1c0NvZGUgKyBoZWFkZXJzIGFyZSB1bnVzZWQgaGVyZSBzaW5jZSBxdWVyeVJvdXRlIHdpbGwKICAgICAgICAvLyByZXR1cm4gdGhlIHJhdyBSZXNwb25zZSBvciB2YWx1ZQogICAgICAgIHN0YXR1c0NvZGU6IDIwMCwKICAgICAgICBsb2FkZXJIZWFkZXJzOiB7fSwKICAgICAgICBhY3Rpb25IZWFkZXJzOiB7fQogICAgICB9OwogICAgfQoKICAgIGlmIChpc0Vycm9yUmVzdWx0KHJlc3VsdCkpIHsKICAgICAgLy8gU3RvcmUgb2ZmIHRoZSBwZW5kaW5nIGVycm9yIC0gd2UgdXNlIGl0IHRvIGRldGVybWluZSB3aGljaCBsb2FkZXJzCiAgICAgIC8vIHRvIGNhbGwgYW5kIHdpbGwgY29tbWl0IGl0IHdoZW4gd2UgY29tcGxldGUgdGhlIG5hdmlnYXRpb24KICAgICAgbGV0IGJvdW5kYXJ5TWF0Y2ggPSBmaW5kTmVhcmVzdEJvdW5kYXJ5KG1hdGNoZXMsIGFjdGlvbk1hdGNoLnJvdXRlLmlkKTsKICAgICAgbGV0IGNvbnRleHQgPSBhd2FpdCBsb2FkUm91dGVEYXRhKHJlcXVlc3QsIG1hdGNoZXMsIHVuZGVmaW5lZCwgewogICAgICAgIFtib3VuZGFyeU1hdGNoLnJvdXRlLmlkXTogcmVzdWx0LmVycm9yCiAgICAgIH0pOyAvLyBhY3Rpb24gc3RhdHVzIGNvZGVzIHRha2UgcHJlY2VkZW5jZSBvdmVyIGxvYWRlciBzdGF0dXMgY29kZXMKCiAgICAgIHJldHVybiBfZXh0ZW5kcyh7fSwgY29udGV4dCwgewogICAgICAgIHN0YXR1c0NvZGU6IGlzUm91dGVFcnJvclJlc3BvbnNlKHJlc3VsdC5lcnJvcikgPyByZXN1bHQuZXJyb3Iuc3RhdHVzIDogNTAwLAogICAgICAgIGFjdGlvbkRhdGE6IG51bGwsCiAgICAgICAgYWN0aW9uSGVhZGVyczogX2V4dGVuZHMoe30sIHJlc3VsdC5oZWFkZXJzID8gewogICAgICAgICAgW2FjdGlvbk1hdGNoLnJvdXRlLmlkXTogcmVzdWx0LmhlYWRlcnMKICAgICAgICB9IDoge30pCiAgICAgIH0pOwogICAgfQoKICAgIGxldCBjb250ZXh0ID0gYXdhaXQgbG9hZFJvdXRlRGF0YShyZXF1ZXN0LCBtYXRjaGVzKTsKICAgIHJldHVybiBfZXh0ZW5kcyh7fSwgY29udGV4dCwgcmVzdWx0LnN0YXR1c0NvZGUgPyB7CiAgICAgIHN0YXR1c0NvZGU6IHJlc3VsdC5zdGF0dXNDb2RlCiAgICB9IDoge30sIHsKICAgICAgYWN0aW9uRGF0YTogewogICAgICAgIFthY3Rpb25NYXRjaC5yb3V0ZS5pZF06IHJlc3VsdC5kYXRhCiAgICAgIH0sCiAgICAgIGFjdGlvbkhlYWRlcnM6IF9leHRlbmRzKHt9LCByZXN1bHQuaGVhZGVycyA/IHsKICAgICAgICBbYWN0aW9uTWF0Y2gucm91dGUuaWRdOiByZXN1bHQuaGVhZGVycwogICAgICB9IDoge30pCiAgICB9KTsKICB9CgogIGFzeW5jIGZ1bmN0aW9uIGxvYWRSb3V0ZURhdGEocmVxdWVzdCwgbWF0Y2hlcywgcm91dGVNYXRjaCwgcGVuZGluZ0FjdGlvbkVycm9yKSB7CiAgICBsZXQgaXNSb3V0ZVJlcXVlc3QgPSByb3V0ZU1hdGNoICE9IG51bGw7CiAgICBsZXQgcmVxdWVzdE1hdGNoZXMgPSByb3V0ZU1hdGNoID8gW3JvdXRlTWF0Y2hdIDogZ2V0TG9hZGVyTWF0Y2hlc1VudGlsQm91bmRhcnkobWF0Y2hlcywgT2JqZWN0LmtleXMocGVuZGluZ0FjdGlvbkVycm9yIHx8IHt9KVswXSk7CiAgICBsZXQgbWF0Y2hlc1RvTG9hZCA9IHJlcXVlc3RNYXRjaGVzLmZpbHRlcihtID0+IG0ucm91dGUubG9hZGVyKTsgLy8gU2hvcnQgY2lyY3VpdCBpZiB3ZSBoYXZlIG5vIGxvYWRlcnMgdG8gcnVuCgogICAgaWYgKG1hdGNoZXNUb0xvYWQubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgbWF0Y2hlcywKICAgICAgICBsb2FkZXJEYXRhOiB7fSwKICAgICAgICBlcnJvcnM6IHBlbmRpbmdBY3Rpb25FcnJvciB8fCBudWxsLAogICAgICAgIHN0YXR1c0NvZGU6IDIwMCwKICAgICAgICBsb2FkZXJIZWFkZXJzOiB7fQogICAgICB9OwogICAgfQoKICAgIGxldCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwoWy4uLm1hdGNoZXNUb0xvYWQubWFwKG1hdGNoID0+IGNhbGxMb2FkZXJPckFjdGlvbigibG9hZGVyIiwgcmVxdWVzdCwgbWF0Y2gsIG1hdGNoZXMsIHVuZGVmaW5lZCwgLy8gQmFzZW5hbWUgbm90IGN1cnJlbnRseSBzdXBwb3J0ZWQgaW4gc3RhdGljIGhhbmRsZXJzCiAgICB0cnVlLCBpc1JvdXRlUmVxdWVzdCkpXSk7CgogICAgaWYgKHJlcXVlc3Quc2lnbmFsLmFib3J0ZWQpIHsKICAgICAgbGV0IG1ldGhvZCA9IGlzUm91dGVSZXF1ZXN0ID8gInF1ZXJ5Um91dGUiIDogInF1ZXJ5IjsKICAgICAgdGhyb3cgbmV3IEVycm9yKG1ldGhvZCArICIoKSBjYWxsIGFib3J0ZWQiKTsKICAgIH0gLy8gQ2FuJ3QgZG8gYW55dGhpbmcgd2l0aCB0aGVzZSB3aXRob3V0IHRoZSBSZW1peCBzaWRlIG9mIHRoaW5ncywgc28ganVzdAogICAgLy8gY2FuY2VsIHRoZW0gZm9yIG5vdwoKCiAgICByZXN1bHRzLmZvckVhY2gocmVzdWx0ID0+IHsKICAgICAgaWYgKGlzRGVmZXJyZWRSZXN1bHQocmVzdWx0KSkgewogICAgICAgIHJlc3VsdC5kZWZlcnJlZERhdGEuY2FuY2VsKCk7CiAgICAgIH0KICAgIH0pOyAvLyBQcm9jZXNzIGFuZCBjb21taXQgb3V0cHV0IGZyb20gbG9hZGVycwoKICAgIGxldCBjb250ZXh0ID0gcHJvY2Vzc1JvdXRlTG9hZGVyRGF0YShtYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCByZXN1bHRzLCBwZW5kaW5nQWN0aW9uRXJyb3IpOwogICAgcmV0dXJuIF9leHRlbmRzKHt9LCBjb250ZXh0LCB7CiAgICAgIG1hdGNoZXMKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlUm91dGVyRXJyb3JSZXNwb25zZShib2R5LCBpbml0KSB7CiAgICByZXR1cm4gbmV3IFJlc3BvbnNlKGJvZHksIF9leHRlbmRzKHt9LCBpbml0LCB7CiAgICAgIGhlYWRlcnM6IF9leHRlbmRzKHt9LCBpbml0LmhlYWRlcnMsIHsKICAgICAgICAiWC1SZW1peC1Sb3V0ZXItRXJyb3IiOiAieWVzIgogICAgICB9KQogICAgfSkpOwogIH0KCiAgcmV0dXJuIHsKICAgIGRhdGFSb3V0ZXMsCiAgICBxdWVyeSwKICAgIHF1ZXJ5Um91dGUKICB9Owp9IC8vI2VuZHJlZ2lvbgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLyNyZWdpb24gSGVscGVycwovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKLyoqCiAqIEdpdmVuIGFuIGV4aXN0aW5nIFN0YXRpY0hhbmRsZXJDb250ZXh0IGFuZCBhbiBlcnJvciB0aHJvd24gYXQgcmVuZGVyIHRpbWUsCiAqIHByb3ZpZGUgYW4gdXBkYXRlZCBTdGF0aWNIYW5kbGVyQ29udGV4dCBzdWl0YWJsZSBmb3IgYSBzZWNvbmQgU1NSIHJlbmRlcgogKi8KCmZ1bmN0aW9uIGdldFN0YXRpY0NvbnRleHRGcm9tRXJyb3Iocm91dGVzLCBjb250ZXh0LCBlcnJvcikgewogIGxldCBuZXdDb250ZXh0ID0gX2V4dGVuZHMoe30sIGNvbnRleHQsIHsKICAgIHN0YXR1c0NvZGU6IDUwMCwKICAgIGVycm9yczogewogICAgICBbY29udGV4dC5fZGVlcGVzdFJlbmRlcmVkQm91bmRhcnlJZCB8fCByb3V0ZXNbMF0uaWRdOiBlcnJvcgogICAgfQogIH0pOwoKICByZXR1cm4gbmV3Q29udGV4dDsKfSAvLyBOb3JtYWxpemUgbmF2aWdhdGlvbiBvcHRpb25zIGJ5IGNvbnZlcnRpbmcgZm9ybU1ldGhvZD1HRVQgZm9ybURhdGEgb2JqZWN0cyB0bwovLyBVUkxTZWFyY2hQYXJhbXMgc28gdGhleSBiZWhhdmUgaWRlbnRpY2FsbHkgdG8gbGlua3Mgd2l0aCBxdWVyeSBwYXJhbXMKCmZ1bmN0aW9uIG5vcm1hbGl6ZU5hdmlnYXRlT3B0aW9ucyh0bywgb3B0cywgaXNGZXRjaGVyKSB7CiAgaWYgKGlzRmV0Y2hlciA9PT0gdm9pZCAwKSB7CiAgICBpc0ZldGNoZXIgPSBmYWxzZTsKICB9CgogIGxldCBwYXRoID0gdHlwZW9mIHRvID09PSAic3RyaW5nIiA/IHRvIDogcm91dGVyX2NyZWF0ZVBhdGgodG8pOyAvLyBSZXR1cm4gbG9jYXRpb24gdmVyYmF0aW0gb24gbm9uLXN1Ym1pc3Npb24gbmF2aWdhdGlvbnMKCiAgaWYgKCFvcHRzIHx8ICEoImZvcm1NZXRob2QiIGluIG9wdHMpICYmICEoImZvcm1EYXRhIiBpbiBvcHRzKSkgewogICAgcmV0dXJuIHsKICAgICAgcGF0aAogICAgfTsKICB9IC8vIENyZWF0ZSBhIFN1Ym1pc3Npb24gb24gbm9uLUdFVCBuYXZpZ2F0aW9ucwoKCiAgaWYgKG9wdHMuZm9ybU1ldGhvZCAhPSBudWxsICYmIG9wdHMuZm9ybU1ldGhvZCAhPT0gImdldCIpIHsKICAgIHJldHVybiB7CiAgICAgIHBhdGgsCiAgICAgIHN1Ym1pc3Npb246IHsKICAgICAgICBmb3JtTWV0aG9kOiBvcHRzLmZvcm1NZXRob2QsCiAgICAgICAgZm9ybUFjdGlvbjogc3RyaXBIYXNoRnJvbVBhdGgocGF0aCksCiAgICAgICAgZm9ybUVuY1R5cGU6IG9wdHMgJiYgb3B0cy5mb3JtRW5jVHlwZSB8fCAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIiwKICAgICAgICBmb3JtRGF0YTogb3B0cy5mb3JtRGF0YQogICAgICB9CiAgICB9OwogIH0gLy8gTm8gZm9ybURhdGEgdG8gZmxhdHRlbiBmb3IgR0VUIHN1Ym1pc3Npb24KCgogIGlmICghb3B0cy5mb3JtRGF0YSkgewogICAgcmV0dXJuIHsKICAgICAgcGF0aAogICAgfTsKICB9IC8vIEZsYXR0ZW4gc3VibWlzc2lvbiBvbnRvIFVSTFNlYXJjaFBhcmFtcyBmb3IgR0VUIHN1Ym1pc3Npb25zCgoKICBsZXQgcGFyc2VkUGF0aCA9IHBhcnNlUGF0aChwYXRoKTsKCiAgdHJ5IHsKICAgIGxldCBzZWFyY2hQYXJhbXMgPSBjb252ZXJ0Rm9ybURhdGFUb1NlYXJjaFBhcmFtcyhvcHRzLmZvcm1EYXRhKTsgLy8gU2luY2UgZmV0Y2hlciBHRVQgc3VibWlzc2lvbnMgb25seSBydW4gYSBzaW5nbGUgbG9hZGVyIChhcyBvcHBvc2VkIHRvCiAgICAvLyBuYXZpZ2F0aW9uIEdFVCBzdWJtaXNzaW9ucyB3aGljaCBydW4gYWxsIGxvYWRlcnMpLCB3ZSBuZWVkIHRvIHByZXNlcnZlCiAgICAvLyBhbnkgaW5jb21pbmcgP2luZGV4IHBhcmFtcwoKICAgIGlmIChpc0ZldGNoZXIgJiYgcGFyc2VkUGF0aC5zZWFyY2ggJiYgaGFzTmFrZWRJbmRleFF1ZXJ5KHBhcnNlZFBhdGguc2VhcmNoKSkgewogICAgICBzZWFyY2hQYXJhbXMuYXBwZW5kKCJpbmRleCIsICIiKTsKICAgIH0KCiAgICBwYXJzZWRQYXRoLnNlYXJjaCA9ICI/IiArIHNlYXJjaFBhcmFtczsKICB9IGNhdGNoIChlKSB7CiAgICByZXR1cm4gewogICAgICBwYXRoLAogICAgICBlcnJvcjogbmV3IEVycm9yUmVzcG9uc2UoNDAwLCAiQmFkIFJlcXVlc3QiLCAiQ2Fubm90IHN1Ym1pdCBiaW5hcnkgZm9ybSBkYXRhIHVzaW5nIEdFVCIpCiAgICB9OwogIH0KCiAgcmV0dXJuIHsKICAgIHBhdGg6IHJvdXRlcl9jcmVhdGVQYXRoKHBhcnNlZFBhdGgpCiAgfTsKfQoKZnVuY3Rpb24gZ2V0TG9hZGVyUmVkaXJlY3Qoc3RhdGUsIHJlZGlyZWN0KSB7CiAgbGV0IHsKICAgIGZvcm1NZXRob2QsCiAgICBmb3JtQWN0aW9uLAogICAgZm9ybUVuY1R5cGUsCiAgICBmb3JtRGF0YQogIH0gPSBzdGF0ZS5uYXZpZ2F0aW9uOwogIGxldCBuYXZpZ2F0aW9uID0gewogICAgc3RhdGU6ICJsb2FkaW5nIiwKICAgIGxvY2F0aW9uOiBjcmVhdGVMb2NhdGlvbihzdGF0ZS5sb2NhdGlvbiwgcmVkaXJlY3QubG9jYXRpb24pLAogICAgZm9ybU1ldGhvZDogZm9ybU1ldGhvZCB8fCB1bmRlZmluZWQsCiAgICBmb3JtQWN0aW9uOiBmb3JtQWN0aW9uIHx8IHVuZGVmaW5lZCwKICAgIGZvcm1FbmNUeXBlOiBmb3JtRW5jVHlwZSB8fCB1bmRlZmluZWQsCiAgICBmb3JtRGF0YTogZm9ybURhdGEgfHwgdW5kZWZpbmVkCiAgfTsKICByZXR1cm4gbmF2aWdhdGlvbjsKfSAvLyBGaWx0ZXIgb3V0IGFsbCByb3V0ZXMgYmVsb3cgYW55IGNhdWdodCBlcnJvciBhcyB0aGV5IGFyZW4ndCBnb2luZyB0bwovLyByZW5kZXIgc28gd2UgZG9uJ3QgbmVlZCB0byBsb2FkIHRoZW0KCgpmdW5jdGlvbiBnZXRMb2FkZXJNYXRjaGVzVW50aWxCb3VuZGFyeShtYXRjaGVzLCBib3VuZGFyeUlkKSB7CiAgbGV0IGJvdW5kYXJ5TWF0Y2hlcyA9IG1hdGNoZXM7CgogIGlmIChib3VuZGFyeUlkKSB7CiAgICBsZXQgaW5kZXggPSBtYXRjaGVzLmZpbmRJbmRleChtID0+IG0ucm91dGUuaWQgPT09IGJvdW5kYXJ5SWQpOwoKICAgIGlmIChpbmRleCA+PSAwKSB7CiAgICAgIGJvdW5kYXJ5TWF0Y2hlcyA9IG1hdGNoZXMuc2xpY2UoMCwgaW5kZXgpOwogICAgfQogIH0KCiAgcmV0dXJuIGJvdW5kYXJ5TWF0Y2hlczsKfQoKZnVuY3Rpb24gZ2V0TWF0Y2hlc1RvTG9hZChzdGF0ZSwgbWF0Y2hlcywgc3VibWlzc2lvbiwgbG9jYXRpb24sIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQsIGNhbmNlbGxlZERlZmVycmVkUm91dGVzLCBjYW5jZWxsZWRGZXRjaGVyTG9hZHMsIHBlbmRpbmdBY3Rpb25EYXRhLCBwZW5kaW5nRXJyb3IsIGZldGNoTG9hZE1hdGNoZXMpIHsKICBsZXQgYWN0aW9uUmVzdWx0ID0gcGVuZGluZ0Vycm9yID8gT2JqZWN0LnZhbHVlcyhwZW5kaW5nRXJyb3IpWzBdIDogcGVuZGluZ0FjdGlvbkRhdGEgPyBPYmplY3QudmFsdWVzKHBlbmRpbmdBY3Rpb25EYXRhKVswXSA6IG51bGw7IC8vIFBpY2sgbmF2aWdhdGlvbiBtYXRjaGVzIHRoYXQgYXJlIG5ldC1uZXcgb3IgcXVhbGlmeSBmb3IgcmV2YWxpZGF0aW9uCgogIGxldCBib3VuZGFyeUlkID0gcGVuZGluZ0Vycm9yID8gT2JqZWN0LmtleXMocGVuZGluZ0Vycm9yKVswXSA6IHVuZGVmaW5lZDsKICBsZXQgYm91bmRhcnlNYXRjaGVzID0gZ2V0TG9hZGVyTWF0Y2hlc1VudGlsQm91bmRhcnkobWF0Y2hlcywgYm91bmRhcnlJZCk7CiAgbGV0IG5hdmlnYXRpb25NYXRjaGVzID0gYm91bmRhcnlNYXRjaGVzLmZpbHRlcigobWF0Y2gsIGluZGV4KSA9PiBtYXRjaC5yb3V0ZS5sb2FkZXIgIT0gbnVsbCAmJiAoaXNOZXdMb2FkZXIoc3RhdGUubG9hZGVyRGF0YSwgc3RhdGUubWF0Y2hlc1tpbmRleF0sIG1hdGNoKSB8fCAvLyBJZiB0aGlzIHJvdXRlIGhhZCBhIHBlbmRpbmcgZGVmZXJyZWQgY2FuY2VsbGVkIGl0IG11c3QgYmUgcmV2YWxpZGF0ZWQKICBjYW5jZWxsZWREZWZlcnJlZFJvdXRlcy5zb21lKGlkID0+IGlkID09PSBtYXRjaC5yb3V0ZS5pZCkgfHwgc2hvdWxkUmV2YWxpZGF0ZUxvYWRlcihzdGF0ZS5sb2NhdGlvbiwgc3RhdGUubWF0Y2hlc1tpbmRleF0sIHN1Ym1pc3Npb24sIGxvY2F0aW9uLCBtYXRjaCwgaXNSZXZhbGlkYXRpb25SZXF1aXJlZCwgYWN0aW9uUmVzdWx0KSkpOyAvLyBQaWNrIGZldGNoZXIubG9hZHMgdGhhdCBuZWVkIHRvIGJlIHJldmFsaWRhdGVkCgogIGxldCByZXZhbGlkYXRpbmdGZXRjaGVycyA9IFtdOwogIGZldGNoTG9hZE1hdGNoZXMgJiYgZmV0Y2hMb2FkTWF0Y2hlcy5mb3JFYWNoKChfcmVmMTAsIGtleSkgPT4gewogICAgbGV0IFtocmVmLCBtYXRjaCwgZmV0Y2hNYXRjaGVzXSA9IF9yZWYxMDsKCiAgICAvLyBUaGlzIGZldGNoZXIgd2FzIGNhbmNlbGxlZCBmcm9tIGEgcHJpb3IgYWN0aW9uIHN1Ym1pc3Npb24gLSBmb3JjZSByZWxvYWQKICAgIGlmIChjYW5jZWxsZWRGZXRjaGVyTG9hZHMuaW5jbHVkZXMoa2V5KSkgewogICAgICByZXZhbGlkYXRpbmdGZXRjaGVycy5wdXNoKFtrZXksIGhyZWYsIG1hdGNoLCBmZXRjaE1hdGNoZXNdKTsKICAgIH0gZWxzZSBpZiAoaXNSZXZhbGlkYXRpb25SZXF1aXJlZCkgewogICAgICBsZXQgc2hvdWxkUmV2YWxpZGF0ZSA9IHNob3VsZFJldmFsaWRhdGVMb2FkZXIoaHJlZiwgbWF0Y2gsIHN1Ym1pc3Npb24sIGhyZWYsIG1hdGNoLCBpc1JldmFsaWRhdGlvblJlcXVpcmVkLCBhY3Rpb25SZXN1bHQpOwoKICAgICAgaWYgKHNob3VsZFJldmFsaWRhdGUpIHsKICAgICAgICByZXZhbGlkYXRpbmdGZXRjaGVycy5wdXNoKFtrZXksIGhyZWYsIG1hdGNoLCBmZXRjaE1hdGNoZXNdKTsKICAgICAgfQogICAgfQogIH0pOwogIHJldHVybiBbbmF2aWdhdGlvbk1hdGNoZXMsIHJldmFsaWRhdGluZ0ZldGNoZXJzXTsKfQoKZnVuY3Rpb24gaXNOZXdMb2FkZXIoY3VycmVudExvYWRlckRhdGEsIGN1cnJlbnRNYXRjaCwgbWF0Y2gpIHsKICBsZXQgaXNOZXcgPSAvLyBbYV0gLT4gW2EsIGJdCiAgIWN1cnJlbnRNYXRjaCB8fCAvLyBbYSwgYl0gLT4gW2EsIGNdCiAgbWF0Y2gucm91dGUuaWQgIT09IGN1cnJlbnRNYXRjaC5yb3V0ZS5pZDsgLy8gSGFuZGxlIHRoZSBjYXNlIHRoYXQgd2UgZG9uJ3QgaGF2ZSBkYXRhIGZvciBhIHJlLXVzZWQgcm91dGUsIHBvdGVudGlhbGx5CiAgLy8gZnJvbSBhIHByaW9yIGVycm9yIG9yIGZyb20gYSBjYW5jZWxsZWQgcGVuZGluZyBkZWZlcnJlZAoKICBsZXQgaXNNaXNzaW5nRGF0YSA9IGN1cnJlbnRMb2FkZXJEYXRhW21hdGNoLnJvdXRlLmlkXSA9PT0gdW5kZWZpbmVkOyAvLyBBbHdheXMgbG9hZCBpZiB0aGlzIGlzIGEgbmV0LW5ldyByb3V0ZSBvciB3ZSBkb24ndCB5ZXQgaGF2ZSBkYXRhCgogIHJldHVybiBpc05ldyB8fCBpc01pc3NpbmdEYXRhOwp9CgpmdW5jdGlvbiBpc05ld1JvdXRlSW5zdGFuY2UoY3VycmVudE1hdGNoLCBtYXRjaCkgewogIGxldCBjdXJyZW50UGF0aCA9IGN1cnJlbnRNYXRjaC5yb3V0ZS5wYXRoOwogIHJldHVybiAoLy8gcGFyYW0gY2hhbmdlIGZvciB0aGlzIG1hdGNoLCAvdXNlcnMvMTIzIC0+IC91c2Vycy80NTYKICAgIGN1cnJlbnRNYXRjaC5wYXRobmFtZSAhPT0gbWF0Y2gucGF0aG5hbWUgfHwgLy8gc3BsYXQgcGFyYW0gY2hhbmdlZCwgd2hpY2ggaXMgbm90IHByZXNlbnQgaW4gbWF0Y2gucGF0aAogICAgLy8gZS5nLiAvZmlsZXMvaW1hZ2VzL2F2YXRhci5qcGcgLT4gZmlsZXMvZmluYW5jZXMueGxzCiAgICBjdXJyZW50UGF0aCAmJiBjdXJyZW50UGF0aC5lbmRzV2l0aCgiKiIpICYmIGN1cnJlbnRNYXRjaC5wYXJhbXNbIioiXSAhPT0gbWF0Y2gucGFyYW1zWyIqIl0KICApOwp9CgpmdW5jdGlvbiBzaG91bGRSZXZhbGlkYXRlTG9hZGVyKGN1cnJlbnRMb2NhdGlvbiwgY3VycmVudE1hdGNoLCBzdWJtaXNzaW9uLCBsb2NhdGlvbiwgbWF0Y2gsIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQsIGFjdGlvblJlc3VsdCkgewogIGxldCBjdXJyZW50VXJsID0gY3JlYXRlVVJMKGN1cnJlbnRMb2NhdGlvbik7CiAgbGV0IGN1cnJlbnRQYXJhbXMgPSBjdXJyZW50TWF0Y2gucGFyYW1zOwogIGxldCBuZXh0VXJsID0gY3JlYXRlVVJMKGxvY2F0aW9uKTsKICBsZXQgbmV4dFBhcmFtcyA9IG1hdGNoLnBhcmFtczsgLy8gVGhpcyBpcyB0aGUgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBhcyB0byB3aGVuIHdlIHJldmFsaWRhdGUuICBJZiB0aGUgcm91dGUKICAvLyBwcm92aWRlcyBpdCdzIG93biBpbXBsZW1lbnRhdGlvbiwgdGhlbiB3ZSBnaXZlIHRoZW0gZnVsbCBjb250cm9sIGJ1dAogIC8vIHByb3ZpZGUgdGhpcyB2YWx1ZSBzbyB0aGV5IGNhbiBsZXZlcmFnZSBpdCBpZiBuZWVkZWQgYWZ0ZXIgdGhleSBjaGVjawogIC8vIHRoZWlyIG93biBzcGVjaWZpYyB1c2UgY2FzZXMKICAvLyBOb3RlIHRoYXQgZmV0Y2hlcnMgYWx3YXlzIHByb3ZpZGUgdGhlIHNhbWUgY3VycmVudC9uZXh0IGxvY2F0aW9ucyBzbyB0aGUKICAvLyBVUkwtYmFzZWQgY2hlY2tzIGhlcmUgZG9uJ3QgYXBwbHkgdG8gZmV0Y2hlciBzaG91bGRSZXZhbGlkYXRlIGNhbGxzCgogIGxldCBkZWZhdWx0U2hvdWxkUmV2YWxpZGF0ZSA9IGlzTmV3Um91dGVJbnN0YW5jZShjdXJyZW50TWF0Y2gsIG1hdGNoKSB8fCAvLyBDbGlja2VkIHRoZSBzYW1lIGxpbmssIHJlc3VibWl0dGVkIGEgR0VUIGZvcm0KICBjdXJyZW50VXJsLnRvU3RyaW5nKCkgPT09IG5leHRVcmwudG9TdHJpbmcoKSB8fCAvLyBTZWFyY2ggcGFyYW1zIGFmZmVjdCBhbGwgbG9hZGVycwogIGN1cnJlbnRVcmwuc2VhcmNoICE9PSBuZXh0VXJsLnNlYXJjaCB8fCAvLyBGb3JjZWQgcmV2YWxpZGF0aW9uIGR1ZSB0byBzdWJtaXNzaW9uLCB1c2VSZXZhbGlkYXRlLCBvciBYLVJlbWl4LVJldmFsaWRhdGUKICBpc1JldmFsaWRhdGlvblJlcXVpcmVkOwoKICBpZiAobWF0Y2gucm91dGUuc2hvdWxkUmV2YWxpZGF0ZSkgewogICAgbGV0IHJvdXRlQ2hvaWNlID0gbWF0Y2gucm91dGUuc2hvdWxkUmV2YWxpZGF0ZShfZXh0ZW5kcyh7CiAgICAgIGN1cnJlbnRVcmwsCiAgICAgIGN1cnJlbnRQYXJhbXMsCiAgICAgIG5leHRVcmwsCiAgICAgIG5leHRQYXJhbXMKICAgIH0sIHN1Ym1pc3Npb24sIHsKICAgICAgYWN0aW9uUmVzdWx0LAogICAgICBkZWZhdWx0U2hvdWxkUmV2YWxpZGF0ZQogICAgfSkpOwoKICAgIGlmICh0eXBlb2Ygcm91dGVDaG9pY2UgPT09ICJib29sZWFuIikgewogICAgICByZXR1cm4gcm91dGVDaG9pY2U7CiAgICB9CiAgfQoKICByZXR1cm4gZGVmYXVsdFNob3VsZFJldmFsaWRhdGU7Cn0KCmFzeW5jIGZ1bmN0aW9uIGNhbGxMb2FkZXJPckFjdGlvbih0eXBlLCByZXF1ZXN0LCBtYXRjaCwgbWF0Y2hlcywgYmFzZW5hbWUsIGlzU3RhdGljUmVxdWVzdCwgaXNSb3V0ZVJlcXVlc3QpIHsKICBpZiAoaXNTdGF0aWNSZXF1ZXN0ID09PSB2b2lkIDApIHsKICAgIGlzU3RhdGljUmVxdWVzdCA9IGZhbHNlOwogIH0KCiAgaWYgKGlzUm91dGVSZXF1ZXN0ID09PSB2b2lkIDApIHsKICAgIGlzUm91dGVSZXF1ZXN0ID0gZmFsc2U7CiAgfQoKICBsZXQgcmVzdWx0VHlwZTsKICBsZXQgcmVzdWx0OyAvLyBTZXR1cCBhIHByb21pc2Ugd2UgY2FuIHJhY2UgYWdhaW5zdCBzbyB0aGF0IGFib3J0IHNpZ25hbHMgc2hvcnQgY2lyY3VpdAoKICBsZXQgcmVqZWN0OwogIGxldCBhYm9ydFByb21pc2UgPSBuZXcgUHJvbWlzZSgoXywgcikgPT4gcmVqZWN0ID0gcik7CgogIGxldCBvblJlamVjdCA9ICgpID0+IHJlamVjdCgpOwoKICByZXF1ZXN0LnNpZ25hbC5hZGRFdmVudExpc3RlbmVyKCJhYm9ydCIsIG9uUmVqZWN0KTsKCiAgdHJ5IHsKICAgIGxldCBoYW5kbGVyID0gbWF0Y2gucm91dGVbdHlwZV07CiAgICByb3V0ZXJfaW52YXJpYW50KGhhbmRsZXIsICJDb3VsZCBub3QgZmluZCB0aGUgIiArIHR5cGUgKyAiIHRvIHJ1biBvbiB0aGUgXCIiICsgbWF0Y2gucm91dGUuaWQgKyAiXCIgcm91dGUiKTsKICAgIHJlc3VsdCA9IGF3YWl0IFByb21pc2UucmFjZShbaGFuZGxlcih7CiAgICAgIHJlcXVlc3QsCiAgICAgIHBhcmFtczogbWF0Y2gucGFyYW1zCiAgICB9KSwgYWJvcnRQcm9taXNlXSk7CiAgfSBjYXRjaCAoZSkgewogICAgcmVzdWx0VHlwZSA9IFJlc3VsdFR5cGUuZXJyb3I7CiAgICByZXN1bHQgPSBlOwogIH0gZmluYWxseSB7CiAgICByZXF1ZXN0LnNpZ25hbC5yZW1vdmVFdmVudExpc3RlbmVyKCJhYm9ydCIsIG9uUmVqZWN0KTsKICB9CgogIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBSZXNwb25zZSkgewogICAgbGV0IHN0YXR1cyA9IHJlc3VsdC5zdGF0dXM7IC8vIFByb2Nlc3MgcmVkaXJlY3RzCgogICAgaWYgKHN0YXR1cyA+PSAzMDAgJiYgc3RhdHVzIDw9IDM5OSkgewogICAgICBsZXQgbG9jYXRpb24gPSByZXN1bHQuaGVhZGVycy5nZXQoIkxvY2F0aW9uIik7CiAgICAgIHJvdXRlcl9pbnZhcmlhbnQobG9jYXRpb24sICJSZWRpcmVjdHMgcmV0dXJuZWQvdGhyb3duIGZyb20gbG9hZGVycy9hY3Rpb25zIG11c3QgaGF2ZSBhIExvY2F0aW9uIGhlYWRlciIpOyAvLyBTdXBwb3J0IHJlbGF0aXZlIHJvdXRpbmcgaW4gcmVkaXJlY3RzCgogICAgICBsZXQgYWN0aXZlTWF0Y2hlcyA9IG1hdGNoZXMuc2xpY2UoMCwgbWF0Y2hlcy5pbmRleE9mKG1hdGNoKSArIDEpOwogICAgICBsZXQgcm91dGVQYXRobmFtZXMgPSBnZXRQYXRoQ29udHJpYnV0aW5nTWF0Y2hlcyhhY3RpdmVNYXRjaGVzKS5tYXAobWF0Y2ggPT4gbWF0Y2gucGF0aG5hbWVCYXNlKTsKICAgICAgbGV0IHJlcXVlc3RQYXRoID0gY3JlYXRlVVJMKHJlcXVlc3QudXJsKS5wYXRobmFtZTsKICAgICAgbGV0IHJlc29sdmVkTG9jYXRpb24gPSByZXNvbHZlVG8obG9jYXRpb24sIHJvdXRlUGF0aG5hbWVzLCByZXF1ZXN0UGF0aCk7CiAgICAgIHJvdXRlcl9pbnZhcmlhbnQocm91dGVyX2NyZWF0ZVBhdGgocmVzb2x2ZWRMb2NhdGlvbiksICJVbmFibGUgdG8gcmVzb2x2ZSByZWRpcmVjdCBsb2NhdGlvbjogIiArIHJlc3VsdC5oZWFkZXJzLmdldCgiTG9jYXRpb24iKSk7IC8vIFByZXBlbmQgdGhlIGJhc2VuYW1lIHRvIHRoZSByZWRpcmVjdCBsb2NhdGlvbiBpZiB3ZSBoYXZlIG9uZQoKICAgICAgaWYgKGJhc2VuYW1lKSB7CiAgICAgICAgbGV0IHBhdGggPSByZXNvbHZlZExvY2F0aW9uLnBhdGhuYW1lOwogICAgICAgIHJlc29sdmVkTG9jYXRpb24ucGF0aG5hbWUgPSBwYXRoID09PSAiLyIgPyBiYXNlbmFtZSA6IHJvdXRlcl9qb2luUGF0aHMoW2Jhc2VuYW1lLCBwYXRoXSk7CiAgICAgIH0KCiAgICAgIGxvY2F0aW9uID0gcm91dGVyX2NyZWF0ZVBhdGgocmVzb2x2ZWRMb2NhdGlvbik7IC8vIERvbid0IHByb2Nlc3MgcmVkaXJlY3RzIGluIHRoZSByb3V0ZXIgZHVyaW5nIHN0YXRpYyByZXF1ZXN0cyByZXF1ZXN0cy4KICAgICAgLy8gSW5zdGVhZCwgdGhyb3cgdGhlIFJlc3BvbnNlIGFuZCBsZXQgdGhlIHNlcnZlciBoYW5kbGUgaXQgd2l0aCBhbiBIVFRQCiAgICAgIC8vIHJlZGlyZWN0LiAgV2UgYWxzbyB1cGRhdGUgdGhlIExvY2F0aW9uIGhlYWRlciBpbiBwbGFjZSBpbiB0aGlzIGZsb3cgc28KICAgICAgLy8gYmFzZW5hbWUgYW5kIHJlbGF0aXZlIHJvdXRpbmcgaXMgdGFrZW4gaW50byBhY2NvdW50CgogICAgICBpZiAoaXNTdGF0aWNSZXF1ZXN0KSB7CiAgICAgICAgcmVzdWx0LmhlYWRlcnMuc2V0KCJMb2NhdGlvbiIsIGxvY2F0aW9uKTsKICAgICAgICB0aHJvdyByZXN1bHQ7CiAgICAgIH0KCiAgICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogUmVzdWx0VHlwZS5yZWRpcmVjdCwKICAgICAgICBzdGF0dXMsCiAgICAgICAgbG9jYXRpb24sCiAgICAgICAgcmV2YWxpZGF0ZTogcmVzdWx0LmhlYWRlcnMuZ2V0KCJYLVJlbWl4LVJldmFsaWRhdGUiKSAhPT0gbnVsbAogICAgICB9OwogICAgfSAvLyBGb3IgU1NSIHNpbmdsZS1yb3V0ZSByZXF1ZXN0cywgd2Ugd2FudCB0byBoYW5kIFJlc3BvbnNlcyBiYWNrIGRpcmVjdGx5CiAgICAvLyB3aXRob3V0IHVud3JhcHBpbmcuICBXZSBkbyB0aGlzIHdpdGggdGhlIFF1ZXJ5Um91dGVSZXNwb25zZSB3cmFwcGVyCiAgICAvLyBpbnRlcmZhY2Ugc28gd2UgY2FuIGtub3cgd2hldGhlciBpdCB3YXMgcmV0dXJuZWQgb3IgdGhyb3duCgoKICAgIGlmIChpc1JvdXRlUmVxdWVzdCkgewogICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdGhyb3ctbGl0ZXJhbAogICAgICB0aHJvdyB7CiAgICAgICAgdHlwZTogcmVzdWx0VHlwZSB8fCBSZXN1bHRUeXBlLmRhdGEsCiAgICAgICAgcmVzcG9uc2U6IHJlc3VsdAogICAgICB9OwogICAgfQoKICAgIGxldCBkYXRhOwogICAgbGV0IGNvbnRlbnRUeXBlID0gcmVzdWx0LmhlYWRlcnMuZ2V0KCJDb250ZW50LVR5cGUiKTsKCiAgICBpZiAoY29udGVudFR5cGUgJiYgY29udGVudFR5cGUuc3RhcnRzV2l0aCgiYXBwbGljYXRpb24vanNvbiIpKSB7CiAgICAgIGRhdGEgPSBhd2FpdCByZXN1bHQuanNvbigpOwogICAgfSBlbHNlIHsKICAgICAgZGF0YSA9IGF3YWl0IHJlc3VsdC50ZXh0KCk7CiAgICB9CgogICAgaWYgKHJlc3VsdFR5cGUgPT09IFJlc3VsdFR5cGUuZXJyb3IpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiByZXN1bHRUeXBlLAogICAgICAgIGVycm9yOiBuZXcgRXJyb3JSZXNwb25zZShzdGF0dXMsIHJlc3VsdC5zdGF0dXNUZXh0LCBkYXRhKSwKICAgICAgICBoZWFkZXJzOiByZXN1bHQuaGVhZGVycwogICAgICB9OwogICAgfQoKICAgIHJldHVybiB7CiAgICAgIHR5cGU6IFJlc3VsdFR5cGUuZGF0YSwKICAgICAgZGF0YSwKICAgICAgc3RhdHVzQ29kZTogcmVzdWx0LnN0YXR1cywKICAgICAgaGVhZGVyczogcmVzdWx0LmhlYWRlcnMKICAgIH07CiAgfQoKICBpZiAocmVzdWx0VHlwZSA9PT0gUmVzdWx0VHlwZS5lcnJvcikgewogICAgcmV0dXJuIHsKICAgICAgdHlwZTogcmVzdWx0VHlwZSwKICAgICAgZXJyb3I6IHJlc3VsdAogICAgfTsKICB9CgogIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBEZWZlcnJlZERhdGEpIHsKICAgIHJldHVybiB7CiAgICAgIHR5cGU6IFJlc3VsdFR5cGUuZGVmZXJyZWQsCiAgICAgIGRlZmVycmVkRGF0YTogcmVzdWx0CiAgICB9OwogIH0KCiAgcmV0dXJuIHsKICAgIHR5cGU6IFJlc3VsdFR5cGUuZGF0YSwKICAgIGRhdGE6IHJlc3VsdAogIH07Cn0KCmZ1bmN0aW9uIGNyZWF0ZVJlcXVlc3QobG9jYXRpb24sIHNpZ25hbCwgc3VibWlzc2lvbikgewogIGxldCB1cmwgPSBjcmVhdGVVUkwoc3RyaXBIYXNoRnJvbVBhdGgobG9jYXRpb24pKS50b1N0cmluZygpOwogIGxldCBpbml0ID0gewogICAgc2lnbmFsCiAgfTsKCiAgaWYgKHN1Ym1pc3Npb24pIHsKICAgIGxldCB7CiAgICAgIGZvcm1NZXRob2QsCiAgICAgIGZvcm1FbmNUeXBlLAogICAgICBmb3JtRGF0YQogICAgfSA9IHN1Ym1pc3Npb247CiAgICBpbml0Lm1ldGhvZCA9IGZvcm1NZXRob2QudG9VcHBlckNhc2UoKTsKICAgIGluaXQuYm9keSA9IGZvcm1FbmNUeXBlID09PSAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIiA/IGNvbnZlcnRGb3JtRGF0YVRvU2VhcmNoUGFyYW1zKGZvcm1EYXRhKSA6IGZvcm1EYXRhOwogIH0gLy8gQ29udGVudC1UeXBlIGlzIGluZmVycmVkIChodHRwczovL2ZldGNoLnNwZWMud2hhdHdnLm9yZy8jZG9tLXJlcXVlc3QpCgoKICByZXR1cm4gbmV3IFJlcXVlc3QodXJsLCBpbml0KTsKfQoKZnVuY3Rpb24gY29udmVydEZvcm1EYXRhVG9TZWFyY2hQYXJhbXMoZm9ybURhdGEpIHsKICBsZXQgc2VhcmNoUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcygpOwoKICBmb3IgKGxldCBba2V5LCB2YWx1ZV0gb2YgZm9ybURhdGEuZW50cmllcygpKSB7CiAgICByb3V0ZXJfaW52YXJpYW50KHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIsICdGaWxlIGlucHV0cyBhcmUgbm90IHN1cHBvcnRlZCB3aXRoIGVuY1R5cGUgImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIsICcgKyAncGxlYXNlIHVzZSAibXVsdGlwYXJ0L2Zvcm0tZGF0YSIgaW5zdGVhZC4nKTsKICAgIHNlYXJjaFBhcmFtcy5hcHBlbmQoa2V5LCB2YWx1ZSk7CiAgfQoKICByZXR1cm4gc2VhcmNoUGFyYW1zOwp9CgpmdW5jdGlvbiBwcm9jZXNzUm91dGVMb2FkZXJEYXRhKG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIHJlc3VsdHMsIHBlbmRpbmdFcnJvciwgYWN0aXZlRGVmZXJyZWRzKSB7CiAgLy8gRmlsbCBpbiBsb2FkZXJEYXRhL2Vycm9ycyBmcm9tIG91ciBsb2FkZXJzCiAgbGV0IGxvYWRlckRhdGEgPSB7fTsKICBsZXQgZXJyb3JzID0gbnVsbDsKICBsZXQgc3RhdHVzQ29kZTsKICBsZXQgZm91bmRFcnJvciA9IGZhbHNlOwogIGxldCBsb2FkZXJIZWFkZXJzID0ge307IC8vIFByb2Nlc3MgbG9hZGVyIHJlc3VsdHMgaW50byBzdGF0ZS5sb2FkZXJEYXRhL3N0YXRlLmVycm9ycwoKICByZXN1bHRzLmZvckVhY2goKHJlc3VsdCwgaW5kZXgpID0+IHsKICAgIGxldCBpZCA9IG1hdGNoZXNUb0xvYWRbaW5kZXhdLnJvdXRlLmlkOwogICAgcm91dGVyX2ludmFyaWFudCghaXNSZWRpcmVjdFJlc3VsdChyZXN1bHQpLCAiQ2Fubm90IGhhbmRsZSByZWRpcmVjdCByZXN1bHRzIGluIHByb2Nlc3NMb2FkZXJEYXRhIik7CgogICAgaWYgKGlzRXJyb3JSZXN1bHQocmVzdWx0KSkgewogICAgICAvLyBMb29rIHVwd2FyZHMgZnJvbSB0aGUgbWF0Y2hlZCByb3V0ZSBmb3IgdGhlIGNsb3Nlc3QgYW5jZXN0b3IKICAgICAgLy8gZXJyb3IgYm91bmRhcnksIGRlZmF1bHRpbmcgdG8gdGhlIHJvb3QgbWF0Y2gKICAgICAgbGV0IGJvdW5kYXJ5TWF0Y2ggPSBmaW5kTmVhcmVzdEJvdW5kYXJ5KG1hdGNoZXMsIGlkKTsKICAgICAgbGV0IGVycm9yID0gcmVzdWx0LmVycm9yOyAvLyBJZiB3ZSBoYXZlIGEgcGVuZGluZyBhY3Rpb24gZXJyb3IsIHdlIHJlcG9ydCBpdCBhdCB0aGUgaGlnaGVzdC1yb3V0ZQogICAgICAvLyB0aGF0IHRocm93cyBhIGxvYWRlciBlcnJvciwgYW5kIHRoZW4gY2xlYXIgaXQgb3V0IHRvIGluZGljYXRlIHRoYXQKICAgICAgLy8gaXQgd2FzIGNvbnN1bWVkCgogICAgICBpZiAocGVuZGluZ0Vycm9yKSB7CiAgICAgICAgZXJyb3IgPSBPYmplY3QudmFsdWVzKHBlbmRpbmdFcnJvcilbMF07CiAgICAgICAgcGVuZGluZ0Vycm9yID0gdW5kZWZpbmVkOwogICAgICB9CgogICAgICBlcnJvcnMgPSBPYmplY3QuYXNzaWduKGVycm9ycyB8fCB7fSwgewogICAgICAgIFtib3VuZGFyeU1hdGNoLnJvdXRlLmlkXTogZXJyb3IKICAgICAgfSk7IC8vIE9uY2Ugd2UgZmluZCBvdXIgZmlyc3QgKGhpZ2hlc3QpIGVycm9yLCB3ZSBzZXQgdGhlIHN0YXR1cyBjb2RlIGFuZAogICAgICAvLyBwcmV2ZW50IGRlZXBlciBzdGF0dXMgY29kZXMgZnJvbSBvdmVycmlkaW5nCgogICAgICBpZiAoIWZvdW5kRXJyb3IpIHsKICAgICAgICBmb3VuZEVycm9yID0gdHJ1ZTsKICAgICAgICBzdGF0dXNDb2RlID0gaXNSb3V0ZUVycm9yUmVzcG9uc2UocmVzdWx0LmVycm9yKSA/IHJlc3VsdC5lcnJvci5zdGF0dXMgOiA1MDA7CiAgICAgIH0KCiAgICAgIGlmIChyZXN1bHQuaGVhZGVycykgewogICAgICAgIGxvYWRlckhlYWRlcnNbaWRdID0gcmVzdWx0LmhlYWRlcnM7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoaXNEZWZlcnJlZFJlc3VsdChyZXN1bHQpKSB7CiAgICAgIGFjdGl2ZURlZmVycmVkcyAmJiBhY3RpdmVEZWZlcnJlZHMuc2V0KGlkLCByZXN1bHQuZGVmZXJyZWREYXRhKTsKICAgICAgbG9hZGVyRGF0YVtpZF0gPSByZXN1bHQuZGVmZXJyZWREYXRhLmRhdGE7IC8vIFRPRE86IEFkZCBzdGF0dXNDb2RlL2hlYWRlcnMgb25jZSB3ZSB3aXJlIHVwIHN0cmVhbWluZyBpbiBSZW1peAogICAgfSBlbHNlIHsKICAgICAgbG9hZGVyRGF0YVtpZF0gPSByZXN1bHQuZGF0YTsgLy8gRXJyb3Igc3RhdHVzIGNvZGVzIGFsd2F5cyBvdmVycmlkZSBzdWNjZXNzIHN0YXR1cyBjb2RlcywgYnV0IGlmIGFsbAogICAgICAvLyBsb2FkZXJzIGFyZSBzdWNjZXNzZnVsIHdlIHRha2UgdGhlIGRlZXBlc3Qgc3RhdHVzIGNvZGUuCgogICAgICBpZiAocmVzdWx0LnN0YXR1c0NvZGUgIT0gbnVsbCAmJiByZXN1bHQuc3RhdHVzQ29kZSAhPT0gMjAwICYmICFmb3VuZEVycm9yKSB7CiAgICAgICAgc3RhdHVzQ29kZSA9IHJlc3VsdC5zdGF0dXNDb2RlOwogICAgICB9CgogICAgICBpZiAocmVzdWx0LmhlYWRlcnMpIHsKICAgICAgICBsb2FkZXJIZWFkZXJzW2lkXSA9IHJlc3VsdC5oZWFkZXJzOwogICAgICB9CiAgICB9CiAgfSk7IC8vIElmIHdlIGRpZG4ndCBjb25zdW1lIHRoZSBwZW5kaW5nIGFjdGlvbiBlcnJvciAoaS5lLiwgYWxsIGxvYWRlcnMKICAvLyByZXNvbHZlZCksIHRoZW4gY29uc3VtZSBpdCBoZXJlCgogIGlmIChwZW5kaW5nRXJyb3IpIHsKICAgIGVycm9ycyA9IHBlbmRpbmdFcnJvcjsKICB9CgogIHJldHVybiB7CiAgICBsb2FkZXJEYXRhLAogICAgZXJyb3JzLAogICAgc3RhdHVzQ29kZTogc3RhdHVzQ29kZSB8fCAyMDAsCiAgICBsb2FkZXJIZWFkZXJzCiAgfTsKfQoKZnVuY3Rpb24gcHJvY2Vzc0xvYWRlckRhdGEoc3RhdGUsIG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIHJlc3VsdHMsIHBlbmRpbmdFcnJvciwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMsIGZldGNoZXJSZXN1bHRzLCBhY3RpdmVEZWZlcnJlZHMpIHsKICBsZXQgewogICAgbG9hZGVyRGF0YSwKICAgIGVycm9ycwogIH0gPSBwcm9jZXNzUm91dGVMb2FkZXJEYXRhKG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIHJlc3VsdHMsIHBlbmRpbmdFcnJvciwgYWN0aXZlRGVmZXJyZWRzKTsgLy8gUHJvY2VzcyByZXN1bHRzIGZyb20gb3VyIHJldmFsaWRhdGluZyBmZXRjaGVycwoKICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMubGVuZ3RoOyBpbmRleCsrKSB7CiAgICBsZXQgW2tleSwsIG1hdGNoXSA9IHJldmFsaWRhdGluZ0ZldGNoZXJzW2luZGV4XTsKICAgIHJvdXRlcl9pbnZhcmlhbnQoZmV0Y2hlclJlc3VsdHMgIT09IHVuZGVmaW5lZCAmJiBmZXRjaGVyUmVzdWx0c1tpbmRleF0gIT09IHVuZGVmaW5lZCwgIkRpZCBub3QgZmluZCBjb3JyZXNwb25kaW5nIGZldGNoZXIgcmVzdWx0Iik7CiAgICBsZXQgcmVzdWx0ID0gZmV0Y2hlclJlc3VsdHNbaW5kZXhdOyAvLyBQcm9jZXNzIGZldGNoZXIgbm9uLXJlZGlyZWN0IGVycm9ycwoKICAgIGlmIChpc0Vycm9yUmVzdWx0KHJlc3VsdCkpIHsKICAgICAgbGV0IGJvdW5kYXJ5TWF0Y2ggPSBmaW5kTmVhcmVzdEJvdW5kYXJ5KHN0YXRlLm1hdGNoZXMsIG1hdGNoLnJvdXRlLmlkKTsKCiAgICAgIGlmICghKGVycm9ycyAmJiBlcnJvcnNbYm91bmRhcnlNYXRjaC5yb3V0ZS5pZF0pKSB7CiAgICAgICAgZXJyb3JzID0gX2V4dGVuZHMoe30sIGVycm9ycywgewogICAgICAgICAgW2JvdW5kYXJ5TWF0Y2gucm91dGUuaWRdOiByZXN1bHQuZXJyb3IKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgc3RhdGUuZmV0Y2hlcnMuZGVsZXRlKGtleSk7CiAgICB9IGVsc2UgaWYgKGlzUmVkaXJlY3RSZXN1bHQocmVzdWx0KSkgewogICAgICAvLyBTaG91bGQgbmV2ZXIgZ2V0IGhlcmUsIHJlZGlyZWN0cyBzaG91bGQgZ2V0IHByb2Nlc3NlZCBhYm92ZSwgYnV0IHdlCiAgICAgIC8vIGtlZXAgdGhpcyB0byB0eXBlIG5hcnJvdyB0byBhIHN1Y2Nlc3MgcmVzdWx0IGluIHRoZSBlbHNlCiAgICAgIHRocm93IG5ldyBFcnJvcigiVW5oYW5kbGVkIGZldGNoZXIgcmV2YWxpZGF0aW9uIHJlZGlyZWN0Iik7CiAgICB9IGVsc2UgaWYgKGlzRGVmZXJyZWRSZXN1bHQocmVzdWx0KSkgewogICAgICAvLyBTaG91bGQgbmV2ZXIgZ2V0IGhlcmUsIGRlZmVycmVkIGRhdGEgc2hvdWxkIGJlIGF3YWl0ZWQgZm9yIGZldGNoZXJzCiAgICAgIC8vIGluIHJlc29sdmVEZWZlcnJlZFJlc3VsdHMKICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmhhbmRsZWQgZmV0Y2hlciBkZWZlcnJlZCBkYXRhIik7CiAgICB9IGVsc2UgewogICAgICBsZXQgZG9uZUZldGNoZXIgPSB7CiAgICAgICAgc3RhdGU6ICJpZGxlIiwKICAgICAgICBkYXRhOiByZXN1bHQuZGF0YSwKICAgICAgICBmb3JtTWV0aG9kOiB1bmRlZmluZWQsCiAgICAgICAgZm9ybUFjdGlvbjogdW5kZWZpbmVkLAogICAgICAgIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsCiAgICAgICAgZm9ybURhdGE6IHVuZGVmaW5lZAogICAgICB9OwogICAgICBzdGF0ZS5mZXRjaGVycy5zZXQoa2V5LCBkb25lRmV0Y2hlcik7CiAgICB9CiAgfQoKICByZXR1cm4gewogICAgbG9hZGVyRGF0YSwKICAgIGVycm9ycwogIH07Cn0KCmZ1bmN0aW9uIG1lcmdlTG9hZGVyRGF0YShsb2FkZXJEYXRhLCBuZXdMb2FkZXJEYXRhLCBtYXRjaGVzKSB7CiAgbGV0IG1lcmdlZExvYWRlckRhdGEgPSBfZXh0ZW5kcyh7fSwgbmV3TG9hZGVyRGF0YSk7CgogIG1hdGNoZXMuZm9yRWFjaChtYXRjaCA9PiB7CiAgICBsZXQgaWQgPSBtYXRjaC5yb3V0ZS5pZDsKCiAgICBpZiAobmV3TG9hZGVyRGF0YVtpZF0gPT09IHVuZGVmaW5lZCAmJiBsb2FkZXJEYXRhW2lkXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIG1lcmdlZExvYWRlckRhdGFbaWRdID0gbG9hZGVyRGF0YVtpZF07CiAgICB9CiAgfSk7CiAgcmV0dXJuIG1lcmdlZExvYWRlckRhdGE7Cn0gLy8gRmluZCB0aGUgbmVhcmVzdCBlcnJvciBib3VuZGFyeSwgbG9va2luZyB1cHdhcmRzIGZyb20gdGhlIGxlYWYgcm91dGUgKG9yIHRoZQovLyByb3V0ZSBzcGVjaWZpZWQgYnkgcm91dGVJZCkgZm9yIHRoZSBjbG9zZXN0IGFuY2VzdG9yIGVycm9yIGJvdW5kYXJ5LAovLyBkZWZhdWx0aW5nIHRvIHRoZSByb290IG1hdGNoCgoKZnVuY3Rpb24gZmluZE5lYXJlc3RCb3VuZGFyeShtYXRjaGVzLCByb3V0ZUlkKSB7CiAgbGV0IGVsaWdpYmxlTWF0Y2hlcyA9IHJvdXRlSWQgPyBtYXRjaGVzLnNsaWNlKDAsIG1hdGNoZXMuZmluZEluZGV4KG0gPT4gbS5yb3V0ZS5pZCA9PT0gcm91dGVJZCkgKyAxKSA6IFsuLi5tYXRjaGVzXTsKICByZXR1cm4gZWxpZ2libGVNYXRjaGVzLnJldmVyc2UoKS5maW5kKG0gPT4gbS5yb3V0ZS5oYXNFcnJvckJvdW5kYXJ5ID09PSB0cnVlKSB8fCBtYXRjaGVzWzBdOwp9CgpmdW5jdGlvbiBnZXRTaG9ydENpcmN1aXRNYXRjaGVzKHJvdXRlcywgc3RhdHVzLCBzdGF0dXNUZXh0KSB7CiAgLy8gUHJlZmVyIGEgcm9vdCBsYXlvdXQgcm91dGUgaWYgcHJlc2VudCwgb3RoZXJ3aXNlIHNoaW0gaW4gYSByb3V0ZSBvYmplY3QKICBsZXQgcm91dGUgPSByb3V0ZXMuZmluZChyID0+IHIuaW5kZXggfHwgIXIucGF0aCB8fCByLnBhdGggPT09ICIvIikgfHwgewogICAgaWQ6ICJfX3NoaW0tIiArIHN0YXR1cyArICItcm91dGVfXyIKICB9OwogIHJldHVybiB7CiAgICBtYXRjaGVzOiBbewogICAgICBwYXJhbXM6IHt9LAogICAgICBwYXRobmFtZTogIiIsCiAgICAgIHBhdGhuYW1lQmFzZTogIiIsCiAgICAgIHJvdXRlCiAgICB9XSwKICAgIHJvdXRlLAogICAgZXJyb3I6IG5ldyBFcnJvclJlc3BvbnNlKHN0YXR1cywgc3RhdHVzVGV4dCwgbnVsbCkKICB9Owp9CgpmdW5jdGlvbiBnZXROb3RGb3VuZE1hdGNoZXMocm91dGVzKSB7CiAgcmV0dXJuIGdldFNob3J0Q2lyY3VpdE1hdGNoZXMocm91dGVzLCA0MDQsICJOb3QgRm91bmQiKTsKfQoKZnVuY3Rpb24gZ2V0TWV0aG9kTm90QWxsb3dlZE1hdGNoZXMocm91dGVzKSB7CiAgcmV0dXJuIGdldFNob3J0Q2lyY3VpdE1hdGNoZXMocm91dGVzLCA0MDUsICJNZXRob2QgTm90IEFsbG93ZWQiKTsKfQoKZnVuY3Rpb24gZ2V0TWV0aG9kTm90QWxsb3dlZFJlc3VsdChwYXRoKSB7CiAgbGV0IGhyZWYgPSB0eXBlb2YgcGF0aCA9PT0gInN0cmluZyIgPyBwYXRoIDogcm91dGVyX2NyZWF0ZVBhdGgocGF0aCk7CiAgY29uc29sZS53YXJuKCJZb3UncmUgdHJ5aW5nIHRvIHN1Ym1pdCB0byBhIHJvdXRlIHRoYXQgZG9lcyBub3QgaGF2ZSBhbiBhY3Rpb24uICBUbyAiICsgImZpeCB0aGlzLCBwbGVhc2UgYWRkIGFuIGBhY3Rpb25gIGZ1bmN0aW9uIHRvIHRoZSByb3V0ZSBmb3IgIiArICgiWyIgKyBocmVmICsgIl0iKSk7CiAgcmV0dXJuIHsKICAgIHR5cGU6IFJlc3VsdFR5cGUuZXJyb3IsCiAgICBlcnJvcjogbmV3IEVycm9yUmVzcG9uc2UoNDA1LCAiTWV0aG9kIE5vdCBBbGxvd2VkIiwgIiIpCiAgfTsKfSAvLyBGaW5kIGFueSByZXR1cm5lZCByZWRpcmVjdCBlcnJvcnMsIHN0YXJ0aW5nIGZyb20gdGhlIGxvd2VzdCBtYXRjaAoKCmZ1bmN0aW9uIGZpbmRSZWRpcmVjdChyZXN1bHRzKSB7CiAgZm9yIChsZXQgaSA9IHJlc3VsdHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgIGxldCByZXN1bHQgPSByZXN1bHRzW2ldOwoKICAgIGlmIChpc1JlZGlyZWN0UmVzdWx0KHJlc3VsdCkpIHsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIHN0cmlwSGFzaEZyb21QYXRoKHBhdGgpIHsKICBsZXQgcGFyc2VkUGF0aCA9IHR5cGVvZiBwYXRoID09PSAic3RyaW5nIiA/IHBhcnNlUGF0aChwYXRoKSA6IHBhdGg7CiAgcmV0dXJuIHJvdXRlcl9jcmVhdGVQYXRoKF9leHRlbmRzKHt9LCBwYXJzZWRQYXRoLCB7CiAgICBoYXNoOiAiIgogIH0pKTsKfQoKZnVuY3Rpb24gaXNIYXNoQ2hhbmdlT25seShhLCBiKSB7CiAgcmV0dXJuIGEucGF0aG5hbWUgPT09IGIucGF0aG5hbWUgJiYgYS5zZWFyY2ggPT09IGIuc2VhcmNoICYmIGEuaGFzaCAhPT0gYi5oYXNoOwp9CgpmdW5jdGlvbiBpc0RlZmVycmVkUmVzdWx0KHJlc3VsdCkgewogIHJldHVybiByZXN1bHQudHlwZSA9PT0gUmVzdWx0VHlwZS5kZWZlcnJlZDsKfQoKZnVuY3Rpb24gaXNFcnJvclJlc3VsdChyZXN1bHQpIHsKICByZXR1cm4gcmVzdWx0LnR5cGUgPT09IFJlc3VsdFR5cGUuZXJyb3I7Cn0KCmZ1bmN0aW9uIGlzUmVkaXJlY3RSZXN1bHQocmVzdWx0KSB7CiAgcmV0dXJuIChyZXN1bHQgJiYgcmVzdWx0LnR5cGUpID09PSBSZXN1bHRUeXBlLnJlZGlyZWN0Owp9CgpmdW5jdGlvbiBpc1JlZGlyZWN0UmVzcG9uc2UocmVzdWx0KSB7CiAgaWYgKCEocmVzdWx0IGluc3RhbmNlb2YgUmVzcG9uc2UpKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICBsZXQgc3RhdHVzID0gcmVzdWx0LnN0YXR1czsKICBsZXQgbG9jYXRpb24gPSByZXN1bHQuaGVhZGVycy5nZXQoIkxvY2F0aW9uIik7CiAgcmV0dXJuIHN0YXR1cyA+PSAzMDAgJiYgc3RhdHVzIDw9IDM5OSAmJiBsb2NhdGlvbiAhPSBudWxsOwp9CgpmdW5jdGlvbiBpc1F1ZXJ5Um91dGVSZXNwb25zZShvYmopIHsKICByZXR1cm4gb2JqICYmIG9iai5yZXNwb25zZSBpbnN0YW5jZW9mIFJlc3BvbnNlICYmIChvYmoudHlwZSA9PT0gUmVzdWx0VHlwZS5kYXRhIHx8IFJlc3VsdFR5cGUuZXJyb3IpOwp9Cgphc3luYyBmdW5jdGlvbiByZXNvbHZlRGVmZXJyZWRSZXN1bHRzKGN1cnJlbnRNYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCByZXN1bHRzLCBzaWduYWwsIGlzRmV0Y2hlciwgY3VycmVudExvYWRlckRhdGEpIHsKICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgcmVzdWx0cy5sZW5ndGg7IGluZGV4KyspIHsKICAgIGxldCByZXN1bHQgPSByZXN1bHRzW2luZGV4XTsKICAgIGxldCBtYXRjaCA9IG1hdGNoZXNUb0xvYWRbaW5kZXhdOwogICAgbGV0IGN1cnJlbnRNYXRjaCA9IGN1cnJlbnRNYXRjaGVzLmZpbmQobSA9PiBtLnJvdXRlLmlkID09PSBtYXRjaC5yb3V0ZS5pZCk7CiAgICBsZXQgaXNSZXZhbGlkYXRpbmdMb2FkZXIgPSBjdXJyZW50TWF0Y2ggIT0gbnVsbCAmJiAhaXNOZXdSb3V0ZUluc3RhbmNlKGN1cnJlbnRNYXRjaCwgbWF0Y2gpICYmIChjdXJyZW50TG9hZGVyRGF0YSAmJiBjdXJyZW50TG9hZGVyRGF0YVttYXRjaC5yb3V0ZS5pZF0pICE9PSB1bmRlZmluZWQ7CgogICAgaWYgKGlzRGVmZXJyZWRSZXN1bHQocmVzdWx0KSAmJiAoaXNGZXRjaGVyIHx8IGlzUmV2YWxpZGF0aW5nTG9hZGVyKSkgewogICAgICAvLyBOb3RlOiB3ZSBkbyBub3QgaGF2ZSB0byB0b3VjaCBhY3RpdmVEZWZlcnJlZHMgaGVyZSBzaW5jZSB3ZSByYWNlIHRoZW0KICAgICAgLy8gYWdhaW5zdCB0aGUgc2lnbmFsIGluIHJlc29sdmVEZWZlcnJlZERhdGEgYW5kIHRoZXknbGwgZ2V0IGFib3J0ZWQKICAgICAgLy8gdGhlcmUgaWYgbmVlZGVkCiAgICAgIGF3YWl0IHJlc29sdmVEZWZlcnJlZERhdGEocmVzdWx0LCBzaWduYWwsIGlzRmV0Y2hlcikudGhlbihyZXN1bHQgPT4gewogICAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICAgIHJlc3VsdHNbaW5kZXhdID0gcmVzdWx0IHx8IHJlc3VsdHNbaW5kZXhdOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfQp9Cgphc3luYyBmdW5jdGlvbiByZXNvbHZlRGVmZXJyZWREYXRhKHJlc3VsdCwgc2lnbmFsLCB1bndyYXApIHsKICBpZiAodW53cmFwID09PSB2b2lkIDApIHsKICAgIHVud3JhcCA9IGZhbHNlOwogIH0KCiAgbGV0IGFib3J0ZWQgPSBhd2FpdCByZXN1bHQuZGVmZXJyZWREYXRhLnJlc29sdmVEYXRhKHNpZ25hbCk7CgogIGlmIChhYm9ydGVkKSB7CiAgICByZXR1cm47CiAgfQoKICBpZiAodW53cmFwKSB7CiAgICB0cnkgewogICAgICByZXR1cm4gewogICAgICAgIHR5cGU6IFJlc3VsdFR5cGUuZGF0YSwKICAgICAgICBkYXRhOiByZXN1bHQuZGVmZXJyZWREYXRhLnVud3JhcHBlZERhdGEKICAgICAgfTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgLy8gSGFuZGxlIGFueSBUcmFja2VkUHJvbWlzZS5fZXJyb3IgdmFsdWVzIGVuY291bnRlcmVkIHdoaWxlIHVud3JhcHBpbmcKICAgICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiBSZXN1bHRUeXBlLmVycm9yLAogICAgICAgIGVycm9yOiBlCiAgICAgIH07CiAgICB9CiAgfQoKICByZXR1cm4gewogICAgdHlwZTogUmVzdWx0VHlwZS5kYXRhLAogICAgZGF0YTogcmVzdWx0LmRlZmVycmVkRGF0YS5kYXRhCiAgfTsKfQoKZnVuY3Rpb24gaGFzTmFrZWRJbmRleFF1ZXJ5KHNlYXJjaCkgewogIHJldHVybiBuZXcgVVJMU2VhcmNoUGFyYW1zKHNlYXJjaCkuZ2V0QWxsKCJpbmRleCIpLnNvbWUodiA9PiB2ID09PSAiIik7Cn0gLy8gTm90ZTogVGhpcyBzaG91bGQgbWF0Y2ggdGhlIGZvcm1hdCBleHBvcnRlZCBieSB1c2VNYXRjaGVzLCBzbyBpZiB5b3UgY2hhbmdlCi8vIHRoaXMgcGxlYXNlIGFsc28gY2hhbmdlIHRoYXQgOikgIEV2ZW50dWFsbHkgd2UnbGwgRFJZIHRoaXMgdXAKCgpmdW5jdGlvbiBjcmVhdGVVc2VNYXRjaGVzTWF0Y2gobWF0Y2gsIGxvYWRlckRhdGEpIHsKICBsZXQgewogICAgcm91dGUsCiAgICBwYXRobmFtZSwKICAgIHBhcmFtcwogIH0gPSBtYXRjaDsKICByZXR1cm4gewogICAgaWQ6IHJvdXRlLmlkLAogICAgcGF0aG5hbWUsCiAgICBwYXJhbXMsCiAgICBkYXRhOiBsb2FkZXJEYXRhW3JvdXRlLmlkXSwKICAgIGhhbmRsZTogcm91dGUuaGFuZGxlCiAgfTsKfQoKZnVuY3Rpb24gZ2V0VGFyZ2V0TWF0Y2gobWF0Y2hlcywgbG9jYXRpb24pIHsKICBsZXQgc2VhcmNoID0gdHlwZW9mIGxvY2F0aW9uID09PSAic3RyaW5nIiA/IHBhcnNlUGF0aChsb2NhdGlvbikuc2VhcmNoIDogbG9jYXRpb24uc2VhcmNoOwoKICBpZiAobWF0Y2hlc1ttYXRjaGVzLmxlbmd0aCAtIDFdLnJvdXRlLmluZGV4ICYmIGhhc05ha2VkSW5kZXhRdWVyeShzZWFyY2ggfHwgIiIpKSB7CiAgICAvLyBSZXR1cm4gdGhlIGxlYWYgaW5kZXggcm91dGUgd2hlbiBpbmRleCBpcyBwcmVzZW50CiAgICByZXR1cm4gbWF0Y2hlc1ttYXRjaGVzLmxlbmd0aCAtIDFdOwogIH0gLy8gT3RoZXJ3aXNlIGdyYWIgdGhlIGRlZXBlc3QgInBhdGggY29udHJpYnV0aW5nIiBtYXRjaCAoaWdub3JpbmcgaW5kZXggYW5kCiAgLy8gcGF0aGxlc3MgbGF5b3V0IHJvdXRlcykKCgogIGxldCBwYXRoTWF0Y2hlcyA9IGdldFBhdGhDb250cmlidXRpbmdNYXRjaGVzKG1hdGNoZXMpOwogIHJldHVybiBwYXRoTWF0Y2hlc1twYXRoTWF0Y2hlcy5sZW5ndGggLSAxXTsKfSAvLyNlbmRyZWdpb24KCgovLyMgc291cmNlTWFwcGluZ1VSTD1yb3V0ZXIuanMubWFwCgovLyBFWFRFUk5BTCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlYWN0L2luZGV4LmpzCnZhciByZWFjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMjk0KTsKdmFyIHJlYWN0X25hbWVzcGFjZU9iamVjdCA9IC8qI19fUFVSRV9fKi9fX3dlYnBhY2tfcmVxdWlyZV9fLnQocmVhY3QsIDIpOwo7Ly8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVhY3Qtcm91dGVyL2Rpc3QvaW5kZXguanMKLyoqCiAqIFJlYWN0IFJvdXRlciB2Ni40LjMKICoKICogQ29weXJpZ2h0IChjKSBSZW1peCBTb2Z0d2FyZSBJbmMuCiAqCiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZQogKiBMSUNFTlNFLm1kIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAqCiAqIEBsaWNlbnNlIE1JVAogKi8KCgoKCmZ1bmN0aW9uIGRpc3RfZXh0ZW5kcygpIHsKICBkaXN0X2V4dGVuZHMgPSBPYmplY3QuYXNzaWduID8gT2JqZWN0LmFzc2lnbi5iaW5kKCkgOiBmdW5jdGlvbiAodGFyZ2V0KSB7CiAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOwoKICAgICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgewogICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7CiAgICAgICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHJldHVybiB0YXJnZXQ7CiAgfTsKICByZXR1cm4gZGlzdF9leHRlbmRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCi8qKgogKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy4KICoKICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4KICovCi8qKgogKiBpbmxpbmVkIE9iamVjdC5pcyBwb2x5ZmlsbCB0byBhdm9pZCByZXF1aXJpbmcgY29uc3VtZXJzIHNoaXAgdGhlaXIgb3duCiAqIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL09iamVjdC9pcwogKi8KCmZ1bmN0aW9uIGlzUG9seWZpbGwoeCwgeSkgewogIHJldHVybiB4ID09PSB5ICYmICh4ICE9PSAwIHx8IDEgLyB4ID09PSAxIC8geSkgfHwgeCAhPT0geCAmJiB5ICE9PSB5IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tc2VsZi1jb21wYXJlCiAgOwp9Cgpjb25zdCBpcyA9IHR5cGVvZiBPYmplY3QuaXMgPT09ICJmdW5jdGlvbiIgPyBPYmplY3QuaXMgOiBpc1BvbHlmaWxsOyAvLyBJbnRlbnRpb25hbGx5IG5vdCB1c2luZyBuYW1lZCBpbXBvcnRzIGJlY2F1c2UgUm9sbHVwIHVzZXMgZHluYW1pYwovLyBkaXNwYXRjaCBmb3IgQ29tbW9uSlMgaW50ZXJvcCBuYW1lZCBpbXBvcnRzLgoKY29uc3QgewogIHVzZVN0YXRlLAogIHVzZUVmZmVjdCwKICB1c2VMYXlvdXRFZmZlY3QsCiAgdXNlRGVidWdWYWx1ZQp9ID0gcmVhY3RfbmFtZXNwYWNlT2JqZWN0OwpsZXQgZGlkV2Fybk9sZDE4QWxwaGEgPSBmYWxzZTsKbGV0IGRpZFdhcm5VbmNhY2hlZEdldFNuYXBzaG90ID0gZmFsc2U7IC8vIERpc2NsYWltZXI6IFRoaXMgc2hpbSBicmVha3MgbWFueSBvZiB0aGUgcnVsZXMgb2YgUmVhY3QsIGFuZCBvbmx5IHdvcmtzCi8vIGJlY2F1c2Ugb2YgYSB2ZXJ5IHBhcnRpY3VsYXIgc2V0IG9mIGltcGxlbWVudGF0aW9uIGRldGFpbHMgYW5kIGFzc3VtcHRpb25zCi8vIC0tIGNoYW5nZSBhbnkgb25lIG9mIHRoZW0gYW5kIGl0IHdpbGwgYnJlYWsuIFRoZSBtb3N0IGltcG9ydGFudCBhc3N1bXB0aW9uCi8vIGlzIHRoYXQgdXBkYXRlcyBhcmUgYWx3YXlzIHN5bmNocm9ub3VzLCBiZWNhdXNlIGNvbmN1cnJlbnQgcmVuZGVyaW5nIGlzCi8vIG9ubHkgYXZhaWxhYmxlIGluIHZlcnNpb25zIG9mIFJlYWN0IHRoYXQgYWxzbyBoYXZlIGEgYnVpbHQtaW4KLy8gdXNlU3luY0V4dGVybmFsU3RvcmUgQVBJLiBBbmQgd2Ugb25seSB1c2UgdGhpcyBzaGltIHdoZW4gdGhlIGJ1aWx0LWluIEFQSQovLyBkb2VzIG5vdCBleGlzdC4KLy8KLy8gRG8gbm90IGFzc3VtZSB0aGF0IHRoZSBjbGV2ZXIgaGFja3MgdXNlZCBieSB0aGlzIGhvb2sgYWxzbyB3b3JrIGluIGdlbmVyYWwuCi8vIFRoZSBwb2ludCBvZiB0aGlzIHNoaW0gaXMgdG8gcmVwbGFjZSB0aGUgbmVlZCBmb3IgaGFja3MgYnkgb3RoZXIgbGlicmFyaWVzLgoKZnVuY3Rpb24gdXNlU3luY0V4dGVybmFsU3RvcmUkMihzdWJzY3JpYmUsIGdldFNuYXBzaG90LCAvLyBOb3RlOiBUaGUgc2hpbSBkb2VzIG5vdCB1c2UgZ2V0U2VydmVyU25hcHNob3QsIGJlY2F1c2UgcHJlLTE4IHZlcnNpb25zIG9mCi8vIFJlYWN0IGRvIG5vdCBleHBvc2UgYSB3YXkgdG8gY2hlY2sgaWYgd2UncmUgaHlkcmF0aW5nLiBTbyB1c2VycyBvZiB0aGUgc2hpbQovLyB3aWxsIG5lZWQgdG8gdHJhY2sgdGhhdCB0aGVtc2VsdmVzIGFuZCByZXR1cm4gdGhlIGNvcnJlY3QgdmFsdWUKLy8gZnJvbSBgZ2V0U25hcHNob3RgLgpnZXRTZXJ2ZXJTbmFwc2hvdCkgewogIGlmIChmYWxzZSkge30gLy8gUmVhZCB0aGUgY3VycmVudCBzbmFwc2hvdCBmcm9tIHRoZSBzdG9yZSBvbiBldmVyeSByZW5kZXIuIEFnYWluLCB0aGlzCiAgLy8gYnJlYWtzIHRoZSBydWxlcyBvZiBSZWFjdCwgYW5kIG9ubHkgd29ya3MgaGVyZSBiZWNhdXNlIG9mIHNwZWNpZmljCiAgLy8gaW1wbGVtZW50YXRpb24gZGV0YWlscywgbW9zdCBpbXBvcnRhbnRseSB0aGF0IHVwZGF0ZXMgYXJlCiAgLy8gYWx3YXlzIHN5bmNocm9ub3VzLgoKCiAgY29uc3QgdmFsdWUgPSBnZXRTbmFwc2hvdCgpOwoKICBpZiAoZmFsc2UpIHt9IC8vIEJlY2F1c2UgdXBkYXRlcyBhcmUgc3luY2hyb25vdXMsIHdlIGRvbid0IHF1ZXVlIHRoZW0uIEluc3RlYWQgd2UgZm9yY2UgYQogIC8vIHJlLXJlbmRlciB3aGVuZXZlciB0aGUgc3Vic2NyaWJlZCBzdGF0ZSBjaGFuZ2VzIGJ5IHVwZGF0aW5nIGFuIHNvbWUKICAvLyBhcmJpdHJhcnkgdXNlU3RhdGUgaG9vay4gVGhlbiwgZHVyaW5nIHJlbmRlciwgd2UgY2FsbCBnZXRTbmFwc2hvdCB0byByZWFkCiAgLy8gdGhlIGN1cnJlbnQgdmFsdWUuCiAgLy8KICAvLyBCZWNhdXNlIHdlIGRvbid0IGFjdHVhbGx5IHVzZSB0aGUgc3RhdGUgcmV0dXJuZWQgYnkgdGhlIHVzZVN0YXRlIGhvb2ssIHdlCiAgLy8gY2FuIHNhdmUgYSBiaXQgb2YgbWVtb3J5IGJ5IHN0b3Jpbmcgb3RoZXIgc3R1ZmYgaW4gdGhhdCBzbG90LgogIC8vCiAgLy8gVG8gaW1wbGVtZW50IHRoZSBlYXJseSBiYWlsb3V0LCB3ZSBuZWVkIHRvIHRyYWNrIHNvbWUgdGhpbmdzIG9uIGEgbXV0YWJsZQogIC8vIG9iamVjdC4gVXN1YWxseSwgd2Ugd291bGQgcHV0IHRoYXQgaW4gYSB1c2VSZWYgaG9vaywgYnV0IHdlIGNhbiBzdGFzaCBpdCBpbgogIC8vIG91ciB1c2VTdGF0ZSBob29rIGluc3RlYWQuCiAgLy8KICAvLyBUbyBmb3JjZSBhIHJlLXJlbmRlciwgd2UgY2FsbCBmb3JjZVVwZGF0ZSh7aW5zdH0pLiBUaGF0IHdvcmtzIGJlY2F1c2UgdGhlCiAgLy8gbmV3IG9iamVjdCBhbHdheXMgZmFpbHMgYW4gZXF1YWxpdHkgY2hlY2suCgoKICBjb25zdCBbewogICAgaW5zdAogIH0sIGZvcmNlVXBkYXRlXSA9IHVzZVN0YXRlKHsKICAgIGluc3Q6IHsKICAgICAgdmFsdWUsCiAgICAgIGdldFNuYXBzaG90CiAgICB9CiAgfSk7IC8vIFRyYWNrIHRoZSBsYXRlc3QgZ2V0U25hcHNob3QgZnVuY3Rpb24gd2l0aCBhIHJlZi4gVGhpcyBuZWVkcyB0byBiZSB1cGRhdGVkCiAgLy8gaW4gdGhlIGxheW91dCBwaGFzZSBzbyB3ZSBjYW4gYWNjZXNzIGl0IGR1cmluZyB0aGUgdGVhcmluZyBjaGVjayB0aGF0CiAgLy8gaGFwcGVucyBvbiBzdWJzY3JpYmUuCgogIHVzZUxheW91dEVmZmVjdCgoKSA9PiB7CiAgICBpbnN0LnZhbHVlID0gdmFsdWU7CiAgICBpbnN0LmdldFNuYXBzaG90ID0gZ2V0U25hcHNob3Q7IC8vIFdoZW5ldmVyIGdldFNuYXBzaG90IG9yIHN1YnNjcmliZSBjaGFuZ2VzLCB3ZSBuZWVkIHRvIGNoZWNrIGluIHRoZQogICAgLy8gY29tbWl0IHBoYXNlIGlmIHRoZXJlIHdhcyBhbiBpbnRlcmxlYXZlZCBtdXRhdGlvbi4gSW4gY29uY3VycmVudCBtb2RlCiAgICAvLyB0aGlzIGNhbiBoYXBwZW4gYWxsIHRoZSB0aW1lLCBidXQgZXZlbiBpbiBzeW5jaHJvbm91cyBtb2RlLCBhbiBlYXJsaWVyCiAgICAvLyBlZmZlY3QgbWF5IGhhdmUgbXV0YXRlZCB0aGUgc3RvcmUuCgogICAgaWYgKGNoZWNrSWZTbmFwc2hvdENoYW5nZWQoaW5zdCkpIHsKICAgICAgLy8gRm9yY2UgYSByZS1yZW5kZXIuCiAgICAgIGZvcmNlVXBkYXRlKHsKICAgICAgICBpbnN0CiAgICAgIH0pOwogICAgfSAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzCgogIH0sIFtzdWJzY3JpYmUsIHZhbHVlLCBnZXRTbmFwc2hvdF0pOwogIHVzZUVmZmVjdCgoKSA9PiB7CiAgICAvLyBDaGVjayBmb3IgY2hhbmdlcyByaWdodCBiZWZvcmUgc3Vic2NyaWJpbmcuIFN1YnNlcXVlbnQgY2hhbmdlcyB3aWxsIGJlCiAgICAvLyBkZXRlY3RlZCBpbiB0aGUgc3Vic2NyaXB0aW9uIGhhbmRsZXIuCiAgICBpZiAoY2hlY2tJZlNuYXBzaG90Q2hhbmdlZChpbnN0KSkgewogICAgICAvLyBGb3JjZSBhIHJlLXJlbmRlci4KICAgICAgZm9yY2VVcGRhdGUoewogICAgICAgIGluc3QKICAgICAgfSk7CiAgICB9CgogICAgY29uc3QgaGFuZGxlU3RvcmVDaGFuZ2UgPSAoKSA9PiB7CiAgICAgIC8vIFRPRE86IEJlY2F1c2UgdGhlcmUgaXMgbm8gY3Jvc3MtcmVuZGVyZXIgQVBJIGZvciBiYXRjaGluZyB1cGRhdGVzLCBpdCdzCiAgICAgIC8vIHVwIHRvIHRoZSBjb25zdW1lciBvZiB0aGlzIGxpYnJhcnkgdG8gd3JhcCB0aGVpciBzdWJzY3JpcHRpb24gZXZlbnQKICAgICAgLy8gd2l0aCB1bnN0YWJsZV9iYXRjaGVkVXBkYXRlcy4gU2hvdWxkIHdlIHRyeSB0byBkZXRlY3Qgd2hlbiB0aGlzIGlzbid0CiAgICAgIC8vIHRoZSBjYXNlIGFuZCBwcmludCBhIHdhcm5pbmcgaW4gZGV2ZWxvcG1lbnQ/CiAgICAgIC8vIFRoZSBzdG9yZSBjaGFuZ2VkLiBDaGVjayBpZiB0aGUgc25hcHNob3QgY2hhbmdlZCBzaW5jZSB0aGUgbGFzdCB0aW1lIHdlCiAgICAgIC8vIHJlYWQgZnJvbSB0aGUgc3RvcmUuCiAgICAgIGlmIChjaGVja0lmU25hcHNob3RDaGFuZ2VkKGluc3QpKSB7CiAgICAgICAgLy8gRm9yY2UgYSByZS1yZW5kZXIuCiAgICAgICAgZm9yY2VVcGRhdGUoewogICAgICAgICAgaW5zdAogICAgICAgIH0pOwogICAgICB9CiAgICB9OyAvLyBTdWJzY3JpYmUgdG8gdGhlIHN0b3JlIGFuZCByZXR1cm4gYSBjbGVhbi11cCBmdW5jdGlvbi4KCgogICAgcmV0dXJuIHN1YnNjcmliZShoYW5kbGVTdG9yZUNoYW5nZSk7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHMKICB9LCBbc3Vic2NyaWJlXSk7CiAgdXNlRGVidWdWYWx1ZSh2YWx1ZSk7CiAgcmV0dXJuIHZhbHVlOwp9CgpmdW5jdGlvbiBjaGVja0lmU25hcHNob3RDaGFuZ2VkKGluc3QpIHsKICBjb25zdCBsYXRlc3RHZXRTbmFwc2hvdCA9IGluc3QuZ2V0U25hcHNob3Q7CiAgY29uc3QgcHJldlZhbHVlID0gaW5zdC52YWx1ZTsKCiAgdHJ5IHsKICAgIGNvbnN0IG5leHRWYWx1ZSA9IGxhdGVzdEdldFNuYXBzaG90KCk7CiAgICByZXR1cm4gIWlzKHByZXZWYWx1ZSwgbmV4dFZhbHVlKTsKICB9IGNhdGNoIChlcnJvcikgewogICAgcmV0dXJuIHRydWU7CiAgfQp9CgovKioKICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuCiAqCiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZQogKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAqCiAqIEBmbG93CiAqLwpmdW5jdGlvbiB1c2VTeW5jRXh0ZXJuYWxTdG9yZSQxKHN1YnNjcmliZSwgZ2V0U25hcHNob3QsIGdldFNlcnZlclNuYXBzaG90KSB7CiAgLy8gTm90ZTogVGhlIHNoaW0gZG9lcyBub3QgdXNlIGdldFNlcnZlclNuYXBzaG90LCBiZWNhdXNlIHByZS0xOCB2ZXJzaW9ucyBvZgogIC8vIFJlYWN0IGRvIG5vdCBleHBvc2UgYSB3YXkgdG8gY2hlY2sgaWYgd2UncmUgaHlkcmF0aW5nLiBTbyB1c2VycyBvZiB0aGUgc2hpbQogIC8vIHdpbGwgbmVlZCB0byB0cmFjayB0aGF0IHRoZW1zZWx2ZXMgYW5kIHJldHVybiB0aGUgY29ycmVjdCB2YWx1ZQogIC8vIGZyb20gYGdldFNuYXBzaG90YC4KICByZXR1cm4gZ2V0U25hcHNob3QoKTsKfQoKLyoqCiAqIElubGluZWQgaW50byB0aGUgcmVhY3Qtcm91dGVyIHJlcG8gc2luY2UgdXNlLXN5bmMtZXh0ZXJuYWwtc3RvcmUgZG9lcyBub3QKICogcHJvdmlkZSBhIFVNRC1jb21wYXRpYmxlIHBhY2thZ2UsIHNvIHdlIG5lZWQgdGhpcyB0byBiZSBhYmxlIHRvIGRpc3RyaWJ1dGUKICogVU1EIHJlYWN0LXJvdXRlciBidW5kbGVzCiAqLwpjb25zdCBjYW5Vc2VET00gPSAhISh0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Ygd2luZG93LmRvY3VtZW50ICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Ygd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgIT09ICJ1bmRlZmluZWQiKTsKY29uc3QgaXNTZXJ2ZXJFbnZpcm9ubWVudCA9ICFjYW5Vc2VET007CmNvbnN0IHNoaW0gPSBpc1NlcnZlckVudmlyb25tZW50ID8gdXNlU3luY0V4dGVybmFsU3RvcmUkMSA6IHVzZVN5bmNFeHRlcm5hbFN0b3JlJDI7CmNvbnN0IHVzZVN5bmNFeHRlcm5hbFN0b3JlID0gIHRydWUgPyAobW9kdWxlID0+IG1vZHVsZS51c2VTeW5jRXh0ZXJuYWxTdG9yZSkocmVhY3RfbmFtZXNwYWNlT2JqZWN0KSA6IHNoaW07CgovLyBDb250ZXh0cyBmb3IgZGF0YSByb3V0ZXJzCmNvbnN0IERhdGFTdGF0aWNSb3V0ZXJDb250ZXh0ID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUNvbnRleHQobnVsbCk7CgppZiAoZmFsc2UpIHt9Cgpjb25zdCBEYXRhUm91dGVyQ29udGV4dCA9IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVDb250ZXh0KG51bGwpOwoKaWYgKGZhbHNlKSB7fQoKY29uc3QgRGF0YVJvdXRlclN0YXRlQ29udGV4dCA9IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVDb250ZXh0KG51bGwpOwoKaWYgKGZhbHNlKSB7fQoKY29uc3QgQXdhaXRDb250ZXh0ID0gLyojX19QVVJFX18qLygvKiB1bnVzZWQgcHVyZSBleHByZXNzaW9uIG9yIHN1cGVyICovIG51bGwgJiYgKFJlYWN0LmNyZWF0ZUNvbnRleHQobnVsbCkpKTsKCmlmIChmYWxzZSkge30KCmNvbnN0IE5hdmlnYXRpb25Db250ZXh0ID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUNvbnRleHQobnVsbCk7CgppZiAoZmFsc2UpIHt9Cgpjb25zdCBMb2NhdGlvbkNvbnRleHQgPSAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlQ29udGV4dChudWxsKTsKCmlmIChmYWxzZSkge30KCmNvbnN0IFJvdXRlQ29udGV4dCA9IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVDb250ZXh0KHsKICBvdXRsZXQ6IG51bGwsCiAgbWF0Y2hlczogW10KfSk7CgppZiAoZmFsc2UpIHt9Cgpjb25zdCBSb3V0ZUVycm9yQ29udGV4dCA9IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVDb250ZXh0KG51bGwpOwoKaWYgKGZhbHNlKSB7fQoKLyoqCiAqIFJldHVybnMgdGhlIGZ1bGwgaHJlZiBmb3IgdGhlIGdpdmVuICJ0byIgdmFsdWUuIFRoaXMgaXMgdXNlZnVsIGZvciBidWlsZGluZwogKiBjdXN0b20gbGlua3MgdGhhdCBhcmUgYWxzbyBhY2Nlc3NpYmxlIGFuZCBwcmVzZXJ2ZSByaWdodC1jbGljayBiZWhhdmlvci4KICoKICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9kb2NzL2VuL3Y2L2hvb2tzL3VzZS1ocmVmCiAqLwoKZnVuY3Rpb24gdXNlSHJlZih0bywgX3RlbXApIHsKICBsZXQgewogICAgcmVsYXRpdmUKICB9ID0gX3RlbXAgPT09IHZvaWQgMCA/IHt9IDogX3RlbXA7CiAgIXVzZUluUm91dGVyQ29udGV4dCgpID8gIGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogIGxldCB7CiAgICBiYXNlbmFtZSwKICAgIG5hdmlnYXRvcgogIH0gPSByZWFjdC51c2VDb250ZXh0KE5hdmlnYXRpb25Db250ZXh0KTsKICBsZXQgewogICAgaGFzaCwKICAgIHBhdGhuYW1lLAogICAgc2VhcmNoCiAgfSA9IGRpc3RfdXNlUmVzb2x2ZWRQYXRoKHRvLCB7CiAgICByZWxhdGl2ZQogIH0pOwogIGxldCBqb2luZWRQYXRobmFtZSA9IHBhdGhuYW1lOyAvLyBJZiB3ZSdyZSBvcGVyYXRpbmcgd2l0aGluIGEgYmFzZW5hbWUsIHByZXBlbmQgaXQgdG8gdGhlIHBhdGhuYW1lIHByaW9yCiAgLy8gdG8gY3JlYXRpbmcgdGhlIGhyZWYuICBJZiB0aGlzIGlzIGEgcm9vdCBuYXZpZ2F0aW9uLCB0aGVuIGp1c3QgdXNlIHRoZSByYXcKICAvLyBiYXNlbmFtZSB3aGljaCBhbGxvd3MgdGhlIGJhc2VuYW1lIHRvIGhhdmUgZnVsbCBjb250cm9sIG92ZXIgdGhlIHByZXNlbmNlCiAgLy8gb2YgYSB0cmFpbGluZyBzbGFzaCBvbiByb290IGxpbmtzCgogIGlmIChiYXNlbmFtZSAhPT0gIi8iKSB7CiAgICBqb2luZWRQYXRobmFtZSA9IHBhdGhuYW1lID09PSAiLyIgPyBiYXNlbmFtZSA6IHJvdXRlcl9qb2luUGF0aHMoW2Jhc2VuYW1lLCBwYXRobmFtZV0pOwogIH0KCiAgcmV0dXJuIG5hdmlnYXRvci5jcmVhdGVIcmVmKHsKICAgIHBhdGhuYW1lOiBqb2luZWRQYXRobmFtZSwKICAgIHNlYXJjaCwKICAgIGhhc2gKICB9KTsKfQovKioKICogUmV0dXJucyB0cnVlIGlmIHRoaXMgY29tcG9uZW50IGlzIGEgZGVzY2VuZGFudCBvZiBhIDxSb3V0ZXI+LgogKgogKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvaG9va3MvdXNlLWluLXJvdXRlci1jb250ZXh0CiAqLwoKZnVuY3Rpb24gdXNlSW5Sb3V0ZXJDb250ZXh0KCkgewogIHJldHVybiByZWFjdC51c2VDb250ZXh0KExvY2F0aW9uQ29udGV4dCkgIT0gbnVsbDsKfQovKioKICogUmV0dXJucyB0aGUgY3VycmVudCBsb2NhdGlvbiBvYmplY3QsIHdoaWNoIHJlcHJlc2VudHMgdGhlIGN1cnJlbnQgVVJMIGluIHdlYgogKiBicm93c2Vycy4KICoKICogTm90ZTogSWYgeW91J3JlIHVzaW5nIHRoaXMgaXQgbWF5IG1lYW4geW91J3JlIGRvaW5nIHNvbWUgb2YgeW91ciBvd24KICogInJvdXRpbmciIGluIHlvdXIgYXBwLCBhbmQgd2UnZCBsaWtlIHRvIGtub3cgd2hhdCB5b3VyIHVzZSBjYXNlIGlzLiBXZSBtYXkKICogYmUgYWJsZSB0byBwcm92aWRlIHNvbWV0aGluZyBoaWdoZXItbGV2ZWwgdG8gYmV0dGVyIHN1aXQgeW91ciBuZWVkcy4KICoKICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9kb2NzL2VuL3Y2L2hvb2tzL3VzZS1sb2NhdGlvbgogKi8KCmZ1bmN0aW9uIGRpc3RfdXNlTG9jYXRpb24oKSB7CiAgIXVzZUluUm91dGVyQ29udGV4dCgpID8gIGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogIHJldHVybiByZWFjdC51c2VDb250ZXh0KExvY2F0aW9uQ29udGV4dCkubG9jYXRpb247Cn0KLyoqCiAqIFJldHVybnMgdGhlIGN1cnJlbnQgbmF2aWdhdGlvbiBhY3Rpb24gd2hpY2ggZGVzY3JpYmVzIGhvdyB0aGUgcm91dGVyIGNhbWUgdG8KICogdGhlIGN1cnJlbnQgbG9jYXRpb24sIGVpdGhlciBieSBhIHBvcCwgcHVzaCwgb3IgcmVwbGFjZSBvbiB0aGUgaGlzdG9yeSBzdGFjay4KICoKICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9kb2NzL2VuL3Y2L2hvb2tzL3VzZS1uYXZpZ2F0aW9uLXR5cGUKICovCgpmdW5jdGlvbiB1c2VOYXZpZ2F0aW9uVHlwZSgpIHsKICByZXR1cm4gUmVhY3QudXNlQ29udGV4dChMb2NhdGlvbkNvbnRleHQpLm5hdmlnYXRpb25UeXBlOwp9Ci8qKgogKiBSZXR1cm5zIHRydWUgaWYgdGhlIFVSTCBmb3IgdGhlIGdpdmVuICJ0byIgdmFsdWUgbWF0Y2hlcyB0aGUgY3VycmVudCBVUkwuCiAqIFRoaXMgaXMgdXNlZnVsIGZvciBjb21wb25lbnRzIHRoYXQgbmVlZCB0byBrbm93ICJhY3RpdmUiIHN0YXRlLCBlLmcuCiAqIDxOYXZMaW5rPi4KICoKICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9kb2NzL2VuL3Y2L2hvb2tzL3VzZS1tYXRjaAogKi8KCmZ1bmN0aW9uIHVzZU1hdGNoKHBhdHRlcm4pIHsKICAhdXNlSW5Sb3V0ZXJDb250ZXh0KCkgPyAgZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICBsZXQgewogICAgcGF0aG5hbWUKICB9ID0gZGlzdF91c2VMb2NhdGlvbigpOwogIHJldHVybiBSZWFjdC51c2VNZW1vKCgpID0+IG1hdGNoUGF0aChwYXR0ZXJuLCBwYXRobmFtZSksIFtwYXRobmFtZSwgcGF0dGVybl0pOwp9Ci8qKgogKiBUaGUgaW50ZXJmYWNlIGZvciB0aGUgbmF2aWdhdGUoKSBmdW5jdGlvbiByZXR1cm5lZCBmcm9tIHVzZU5hdmlnYXRlKCkuCiAqLwoKLyoqCiAqIFJldHVybnMgYW4gaW1wZXJhdGl2ZSBtZXRob2QgZm9yIGNoYW5naW5nIHRoZSBsb2NhdGlvbi4gVXNlZCBieSA8TGluaz5zLCBidXQKICogbWF5IGFsc28gYmUgdXNlZCBieSBvdGhlciBlbGVtZW50cyB0byBjaGFuZ2UgdGhlIGxvY2F0aW9uLgogKgogKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvaG9va3MvdXNlLW5hdmlnYXRlCiAqLwpmdW5jdGlvbiBkaXN0X3VzZU5hdmlnYXRlKCkgewogICF1c2VJblJvdXRlckNvbnRleHQoKSA/ICBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICBsZXQgewogICAgYmFzZW5hbWUsCiAgICBuYXZpZ2F0b3IKICB9ID0gcmVhY3QudXNlQ29udGV4dChOYXZpZ2F0aW9uQ29udGV4dCk7CiAgbGV0IHsKICAgIG1hdGNoZXMKICB9ID0gcmVhY3QudXNlQ29udGV4dChSb3V0ZUNvbnRleHQpOwogIGxldCB7CiAgICBwYXRobmFtZTogbG9jYXRpb25QYXRobmFtZQogIH0gPSBkaXN0X3VzZUxvY2F0aW9uKCk7CiAgbGV0IHJvdXRlUGF0aG5hbWVzSnNvbiA9IEpTT04uc3RyaW5naWZ5KGdldFBhdGhDb250cmlidXRpbmdNYXRjaGVzKG1hdGNoZXMpLm1hcChtYXRjaCA9PiBtYXRjaC5wYXRobmFtZUJhc2UpKTsKICBsZXQgYWN0aXZlUmVmID0gcmVhY3QudXNlUmVmKGZhbHNlKTsKICByZWFjdC51c2VFZmZlY3QoKCkgPT4gewogICAgYWN0aXZlUmVmLmN1cnJlbnQgPSB0cnVlOwogIH0pOwogIGxldCBuYXZpZ2F0ZSA9IHJlYWN0LnVzZUNhbGxiYWNrKGZ1bmN0aW9uICh0bywgb3B0aW9ucykgewogICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICBvcHRpb25zID0ge307CiAgICB9CgogICAgIGZhbHNlID8gMCA6IHZvaWQgMDsKICAgIGlmICghYWN0aXZlUmVmLmN1cnJlbnQpIHJldHVybjsKCiAgICBpZiAodHlwZW9mIHRvID09PSAibnVtYmVyIikgewogICAgICBuYXZpZ2F0b3IuZ28odG8pOwogICAgICByZXR1cm47CiAgICB9CgogICAgbGV0IHBhdGggPSByZXNvbHZlVG8odG8sIEpTT04ucGFyc2Uocm91dGVQYXRobmFtZXNKc29uKSwgbG9jYXRpb25QYXRobmFtZSwgb3B0aW9ucy5yZWxhdGl2ZSA9PT0gInBhdGgiKTsgLy8gSWYgd2UncmUgb3BlcmF0aW5nIHdpdGhpbiBhIGJhc2VuYW1lLCBwcmVwZW5kIGl0IHRvIHRoZSBwYXRobmFtZSBwcmlvcgogICAgLy8gdG8gaGFuZGluZyBvZmYgdG8gaGlzdG9yeS4gIElmIHRoaXMgaXMgYSByb290IG5hdmlnYXRpb24sIHRoZW4gd2UKICAgIC8vIG5hdmlnYXRlIHRvIHRoZSByYXcgYmFzZW5hbWUgd2hpY2ggYWxsb3dzIHRoZSBiYXNlbmFtZSB0byBoYXZlIGZ1bGwKICAgIC8vIGNvbnRyb2wgb3ZlciB0aGUgcHJlc2VuY2Ugb2YgYSB0cmFpbGluZyBzbGFzaCBvbiByb290IGxpbmtzCgogICAgaWYgKGJhc2VuYW1lICE9PSAiLyIpIHsKICAgICAgcGF0aC5wYXRobmFtZSA9IHBhdGgucGF0aG5hbWUgPT09ICIvIiA/IGJhc2VuYW1lIDogcm91dGVyX2pvaW5QYXRocyhbYmFzZW5hbWUsIHBhdGgucGF0aG5hbWVdKTsKICAgIH0KCiAgICAoISFvcHRpb25zLnJlcGxhY2UgPyBuYXZpZ2F0b3IucmVwbGFjZSA6IG5hdmlnYXRvci5wdXNoKShwYXRoLCBvcHRpb25zLnN0YXRlLCBvcHRpb25zKTsKICB9LCBbYmFzZW5hbWUsIG5hdmlnYXRvciwgcm91dGVQYXRobmFtZXNKc29uLCBsb2NhdGlvblBhdGhuYW1lXSk7CiAgcmV0dXJuIG5hdmlnYXRlOwp9CmNvbnN0IE91dGxldENvbnRleHQgPSAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlQ29udGV4dChudWxsKTsKLyoqCiAqIFJldHVybnMgdGhlIGNvbnRleHQgKGlmIHByb3ZpZGVkKSBmb3IgdGhlIGNoaWxkIHJvdXRlIGF0IHRoaXMgbGV2ZWwgb2YgdGhlIHJvdXRlCiAqIGhpZXJhcmNoeS4KICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9kb2NzL2VuL3Y2L2hvb2tzL3VzZS1vdXRsZXQtY29udGV4dAogKi8KCmZ1bmN0aW9uIHVzZU91dGxldENvbnRleHQoKSB7CiAgcmV0dXJuIFJlYWN0LnVzZUNvbnRleHQoT3V0bGV0Q29udGV4dCk7Cn0KLyoqCiAqIFJldHVybnMgdGhlIGVsZW1lbnQgZm9yIHRoZSBjaGlsZCByb3V0ZSBhdCB0aGlzIGxldmVsIG9mIHRoZSByb3V0ZQogKiBoaWVyYXJjaHkuIFVzZWQgaW50ZXJuYWxseSBieSA8T3V0bGV0PiB0byByZW5kZXIgY2hpbGQgcm91dGVzLgogKgogKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvaG9va3MvdXNlLW91dGxldAogKi8KCmZ1bmN0aW9uIHVzZU91dGxldChjb250ZXh0KSB7CiAgbGV0IG91dGxldCA9IHJlYWN0LnVzZUNvbnRleHQoUm91dGVDb250ZXh0KS5vdXRsZXQ7CgogIGlmIChvdXRsZXQpIHsKICAgIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChPdXRsZXRDb250ZXh0LlByb3ZpZGVyLCB7CiAgICAgIHZhbHVlOiBjb250ZXh0CiAgICB9LCBvdXRsZXQpOwogIH0KCiAgcmV0dXJuIG91dGxldDsKfQovKioKICogUmV0dXJucyBhbiBvYmplY3Qgb2Yga2V5L3ZhbHVlIHBhaXJzIG9mIHRoZSBkeW5hbWljIHBhcmFtcyBmcm9tIHRoZSBjdXJyZW50CiAqIFVSTCB0aGF0IHdlcmUgbWF0Y2hlZCBieSB0aGUgcm91dGUgcGF0aC4KICoKICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9kb2NzL2VuL3Y2L2hvb2tzL3VzZS1wYXJhbXMKICovCgpmdW5jdGlvbiB1c2VQYXJhbXMoKSB7CiAgbGV0IHsKICAgIG1hdGNoZXMKICB9ID0gUmVhY3QudXNlQ29udGV4dChSb3V0ZUNvbnRleHQpOwogIGxldCByb3V0ZU1hdGNoID0gbWF0Y2hlc1ttYXRjaGVzLmxlbmd0aCAtIDFdOwogIHJldHVybiByb3V0ZU1hdGNoID8gcm91dGVNYXRjaC5wYXJhbXMgOiB7fTsKfQovKioKICogUmVzb2x2ZXMgdGhlIHBhdGhuYW1lIG9mIHRoZSBnaXZlbiBgdG9gIHZhbHVlIGFnYWluc3QgdGhlIGN1cnJlbnQgbG9jYXRpb24uCiAqCiAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni9ob29rcy91c2UtcmVzb2x2ZWQtcGF0aAogKi8KCmZ1bmN0aW9uIGRpc3RfdXNlUmVzb2x2ZWRQYXRoKHRvLCBfdGVtcDIpIHsKICBsZXQgewogICAgcmVsYXRpdmUKICB9ID0gX3RlbXAyID09PSB2b2lkIDAgPyB7fSA6IF90ZW1wMjsKICBsZXQgewogICAgbWF0Y2hlcwogIH0gPSByZWFjdC51c2VDb250ZXh0KFJvdXRlQ29udGV4dCk7CiAgbGV0IHsKICAgIHBhdGhuYW1lOiBsb2NhdGlvblBhdGhuYW1lCiAgfSA9IGRpc3RfdXNlTG9jYXRpb24oKTsKICBsZXQgcm91dGVQYXRobmFtZXNKc29uID0gSlNPTi5zdHJpbmdpZnkoZ2V0UGF0aENvbnRyaWJ1dGluZ01hdGNoZXMobWF0Y2hlcykubWFwKG1hdGNoID0+IG1hdGNoLnBhdGhuYW1lQmFzZSkpOwogIHJldHVybiByZWFjdC51c2VNZW1vKCgpID0+IHJlc29sdmVUbyh0bywgSlNPTi5wYXJzZShyb3V0ZVBhdGhuYW1lc0pzb24pLCBsb2NhdGlvblBhdGhuYW1lLCByZWxhdGl2ZSA9PT0gInBhdGgiKSwgW3RvLCByb3V0ZVBhdGhuYW1lc0pzb24sIGxvY2F0aW9uUGF0aG5hbWUsIHJlbGF0aXZlXSk7Cn0KLyoqCiAqIFJldHVybnMgdGhlIGVsZW1lbnQgb2YgdGhlIHJvdXRlIHRoYXQgbWF0Y2hlZCB0aGUgY3VycmVudCBsb2NhdGlvbiwgcHJlcGFyZWQKICogd2l0aCB0aGUgY29ycmVjdCBjb250ZXh0IHRvIHJlbmRlciB0aGUgcmVtYWluZGVyIG9mIHRoZSByb3V0ZSB0cmVlLiBSb3V0ZQogKiBlbGVtZW50cyBpbiB0aGUgdHJlZSBtdXN0IHJlbmRlciBhbiA8T3V0bGV0PiB0byByZW5kZXIgdGhlaXIgY2hpbGQgcm91dGUncwogKiBlbGVtZW50LgogKgogKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvaG9va3MvdXNlLXJvdXRlcwogKi8KCmZ1bmN0aW9uIHVzZVJvdXRlcyhyb3V0ZXMsIGxvY2F0aW9uQXJnKSB7CiAgIXVzZUluUm91dGVyQ29udGV4dCgpID8gIGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogIGxldCBkYXRhUm91dGVyU3RhdGVDb250ZXh0ID0gcmVhY3QudXNlQ29udGV4dChEYXRhUm91dGVyU3RhdGVDb250ZXh0KTsKICBsZXQgewogICAgbWF0Y2hlczogcGFyZW50TWF0Y2hlcwogIH0gPSByZWFjdC51c2VDb250ZXh0KFJvdXRlQ29udGV4dCk7CiAgbGV0IHJvdXRlTWF0Y2ggPSBwYXJlbnRNYXRjaGVzW3BhcmVudE1hdGNoZXMubGVuZ3RoIC0gMV07CiAgbGV0IHBhcmVudFBhcmFtcyA9IHJvdXRlTWF0Y2ggPyByb3V0ZU1hdGNoLnBhcmFtcyA6IHt9OwogIGxldCBwYXJlbnRQYXRobmFtZSA9IHJvdXRlTWF0Y2ggPyByb3V0ZU1hdGNoLnBhdGhuYW1lIDogIi8iOwogIGxldCBwYXJlbnRQYXRobmFtZUJhc2UgPSByb3V0ZU1hdGNoID8gcm91dGVNYXRjaC5wYXRobmFtZUJhc2UgOiAiLyI7CiAgbGV0IHBhcmVudFJvdXRlID0gcm91dGVNYXRjaCAmJiByb3V0ZU1hdGNoLnJvdXRlOwoKICBpZiAoZmFsc2UpIHt9CgogIGxldCBsb2NhdGlvbkZyb21Db250ZXh0ID0gZGlzdF91c2VMb2NhdGlvbigpOwogIGxldCBsb2NhdGlvbjsKCiAgaWYgKGxvY2F0aW9uQXJnKSB7CiAgICB2YXIgX3BhcnNlZExvY2F0aW9uQXJnJHBhOwoKICAgIGxldCBwYXJzZWRMb2NhdGlvbkFyZyA9IHR5cGVvZiBsb2NhdGlvbkFyZyA9PT0gInN0cmluZyIgPyBwYXJzZVBhdGgobG9jYXRpb25BcmcpIDogbG9jYXRpb25Bcmc7CiAgICAhKHBhcmVudFBhdGhuYW1lQmFzZSA9PT0gIi8iIHx8ICgoX3BhcnNlZExvY2F0aW9uQXJnJHBhID0gcGFyc2VkTG9jYXRpb25BcmcucGF0aG5hbWUpID09IG51bGwgPyB2b2lkIDAgOiBfcGFyc2VkTG9jYXRpb25BcmckcGEuc3RhcnRzV2l0aChwYXJlbnRQYXRobmFtZUJhc2UpKSkgPyAgZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICBsb2NhdGlvbiA9IHBhcnNlZExvY2F0aW9uQXJnOwogIH0gZWxzZSB7CiAgICBsb2NhdGlvbiA9IGxvY2F0aW9uRnJvbUNvbnRleHQ7CiAgfQoKICBsZXQgcGF0aG5hbWUgPSBsb2NhdGlvbi5wYXRobmFtZSB8fCAiLyI7CiAgbGV0IHJlbWFpbmluZ1BhdGhuYW1lID0gcGFyZW50UGF0aG5hbWVCYXNlID09PSAiLyIgPyBwYXRobmFtZSA6IHBhdGhuYW1lLnNsaWNlKHBhcmVudFBhdGhuYW1lQmFzZS5sZW5ndGgpIHx8ICIvIjsKICBsZXQgbWF0Y2hlcyA9IG1hdGNoUm91dGVzKHJvdXRlcywgewogICAgcGF0aG5hbWU6IHJlbWFpbmluZ1BhdGhuYW1lCiAgfSk7CgogIGlmIChmYWxzZSkge30KCiAgbGV0IHJlbmRlcmVkTWF0Y2hlcyA9IF9yZW5kZXJNYXRjaGVzKG1hdGNoZXMgJiYgbWF0Y2hlcy5tYXAobWF0Y2ggPT4gT2JqZWN0LmFzc2lnbih7fSwgbWF0Y2gsIHsKICAgIHBhcmFtczogT2JqZWN0LmFzc2lnbih7fSwgcGFyZW50UGFyYW1zLCBtYXRjaC5wYXJhbXMpLAogICAgcGF0aG5hbWU6IHJvdXRlcl9qb2luUGF0aHMoW3BhcmVudFBhdGhuYW1lQmFzZSwgbWF0Y2gucGF0aG5hbWVdKSwKICAgIHBhdGhuYW1lQmFzZTogbWF0Y2gucGF0aG5hbWVCYXNlID09PSAiLyIgPyBwYXJlbnRQYXRobmFtZUJhc2UgOiByb3V0ZXJfam9pblBhdGhzKFtwYXJlbnRQYXRobmFtZUJhc2UsIG1hdGNoLnBhdGhuYW1lQmFzZV0pCiAgfSkpLCBwYXJlbnRNYXRjaGVzLCBkYXRhUm91dGVyU3RhdGVDb250ZXh0IHx8IHVuZGVmaW5lZCk7IC8vIFdoZW4gYSB1c2VyIHBhc3NlcyBpbiBhIGBsb2NhdGlvbkFyZ2AsIHRoZSBhc3NvY2lhdGVkIHJvdXRlcyBuZWVkIHRvCiAgLy8gYmUgd3JhcHBlZCBpbiBhIG5ldyBgTG9jYXRpb25Db250ZXh0LlByb3ZpZGVyYCBpbiBvcmRlciBmb3IgYHVzZUxvY2F0aW9uYAogIC8vIHRvIHVzZSB0aGUgc2NvcGVkIGxvY2F0aW9uIGluc3RlYWQgb2YgdGhlIGdsb2JhbCBsb2NhdGlvbi4KCgogIGlmIChsb2NhdGlvbkFyZyAmJiByZW5kZXJlZE1hdGNoZXMpIHsKICAgIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChMb2NhdGlvbkNvbnRleHQuUHJvdmlkZXIsIHsKICAgICAgdmFsdWU6IHsKICAgICAgICBsb2NhdGlvbjogZGlzdF9leHRlbmRzKHsKICAgICAgICAgIHBhdGhuYW1lOiAiLyIsCiAgICAgICAgICBzZWFyY2g6ICIiLAogICAgICAgICAgaGFzaDogIiIsCiAgICAgICAgICBzdGF0ZTogbnVsbCwKICAgICAgICAgIGtleTogImRlZmF1bHQiCiAgICAgICAgfSwgbG9jYXRpb24pLAogICAgICAgIG5hdmlnYXRpb25UeXBlOiBBY3Rpb24uUG9wCiAgICAgIH0KICAgIH0sIHJlbmRlcmVkTWF0Y2hlcyk7CiAgfQoKICByZXR1cm4gcmVuZGVyZWRNYXRjaGVzOwp9CgpmdW5jdGlvbiBEZWZhdWx0RXJyb3JFbGVtZW50KCkgewogIGxldCBlcnJvciA9IHVzZVJvdXRlRXJyb3IoKTsKICBsZXQgbWVzc2FnZSA9IGlzUm91dGVFcnJvclJlc3BvbnNlKGVycm9yKSA/IGVycm9yLnN0YXR1cyArICIgIiArIGVycm9yLnN0YXR1c1RleHQgOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IEpTT04uc3RyaW5naWZ5KGVycm9yKTsKICBsZXQgc3RhY2sgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3Iuc3RhY2sgOiBudWxsOwogIGxldCBsaWdodGdyZXkgPSAicmdiYSgyMDAsMjAwLDIwMCwgMC41KSI7CiAgbGV0IHByZVN0eWxlcyA9IHsKICAgIHBhZGRpbmc6ICIwLjVyZW0iLAogICAgYmFja2dyb3VuZENvbG9yOiBsaWdodGdyZXkKICB9OwogIGxldCBjb2RlU3R5bGVzID0gewogICAgcGFkZGluZzogIjJweCA0cHgiLAogICAgYmFja2dyb3VuZENvbG9yOiBsaWdodGdyZXkKICB9OwogIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChyZWFjdC5GcmFnbWVudCwgbnVsbCwgLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoImgyIiwgbnVsbCwgIlVuaGFuZGxlZCBUaHJvd24gRXJyb3IhIiksIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KCJoMyIsIHsKICAgIHN0eWxlOiB7CiAgICAgIGZvbnRTdHlsZTogIml0YWxpYyIKICAgIH0KICB9LCBtZXNzYWdlKSwgc3RhY2sgPyAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudCgicHJlIiwgewogICAgc3R5bGU6IHByZVN0eWxlcwogIH0sIHN0YWNrKSA6IG51bGwsIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KCJwIiwgbnVsbCwgIlx1RDgzRFx1RENCRiBIZXkgZGV2ZWxvcGVyIFx1RDgzRFx1REM0QiIpLCAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudCgicCIsIG51bGwsICJZb3UgY2FuIHByb3ZpZGUgYSB3YXkgYmV0dGVyIFVYIHRoYW4gdGhpcyB3aGVuIHlvdXIgYXBwIHRocm93cyBlcnJvcnMgYnkgcHJvdmlkaW5nIHlvdXIgb3duXHhBMCIsIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KCJjb2RlIiwgewogICAgc3R5bGU6IGNvZGVTdHlsZXMKICB9LCAiZXJyb3JFbGVtZW50IiksICIgcHJvcHMgb25ceEEwIiwgLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoImNvZGUiLCB7CiAgICBzdHlsZTogY29kZVN0eWxlcwogIH0sICI8Um91dGU+IikpKTsKfQoKY2xhc3MgUmVuZGVyRXJyb3JCb3VuZGFyeSBleHRlbmRzIHJlYWN0LkNvbXBvbmVudCB7CiAgY29uc3RydWN0b3IocHJvcHMpIHsKICAgIHN1cGVyKHByb3BzKTsKICAgIHRoaXMuc3RhdGUgPSB7CiAgICAgIGxvY2F0aW9uOiBwcm9wcy5sb2NhdGlvbiwKICAgICAgZXJyb3I6IHByb3BzLmVycm9yCiAgICB9OwogIH0KCiAgc3RhdGljIGdldERlcml2ZWRTdGF0ZUZyb21FcnJvcihlcnJvcikgewogICAgcmV0dXJuIHsKICAgICAgZXJyb3I6IGVycm9yCiAgICB9OwogIH0KCiAgc3RhdGljIGdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyhwcm9wcywgc3RhdGUpIHsKICAgIC8vIFdoZW4gd2UgZ2V0IGludG8gYW4gZXJyb3Igc3RhdGUsIHRoZSB1c2VyIHdpbGwgbGlrZWx5IGNsaWNrICJiYWNrIiB0byB0aGUKICAgIC8vIHByZXZpb3VzIHBhZ2UgdGhhdCBkaWRuJ3QgaGF2ZSBhbiBlcnJvci4gQmVjYXVzZSB0aGlzIHdyYXBzIHRoZSBlbnRpcmUKICAgIC8vIGFwcGxpY2F0aW9uLCB0aGF0IHdpbGwgaGF2ZSBubyBlZmZlY3QtLXRoZSBlcnJvciBwYWdlIGNvbnRpbnVlcyB0byBkaXNwbGF5LgogICAgLy8gVGhpcyBnaXZlcyB1cyBhIG1lY2hhbmlzbSB0byByZWNvdmVyIGZyb20gdGhlIGVycm9yIHdoZW4gdGhlIGxvY2F0aW9uIGNoYW5nZXMuCiAgICAvLwogICAgLy8gV2hldGhlciB3ZSdyZSBpbiBhbiBlcnJvciBzdGF0ZSBvciBub3QsIHdlIHVwZGF0ZSB0aGUgbG9jYXRpb24gaW4gc3RhdGUKICAgIC8vIHNvIHRoYXQgd2hlbiB3ZSBhcmUgaW4gYW4gZXJyb3Igc3RhdGUsIGl0IGdldHMgcmVzZXQgd2hlbiBhIG5ldyBsb2NhdGlvbgogICAgLy8gY29tZXMgaW4gYW5kIHRoZSB1c2VyIHJlY292ZXJzIGZyb20gdGhlIGVycm9yLgogICAgaWYgKHN0YXRlLmxvY2F0aW9uICE9PSBwcm9wcy5sb2NhdGlvbikgewogICAgICByZXR1cm4gewogICAgICAgIGVycm9yOiBwcm9wcy5lcnJvciwKICAgICAgICBsb2NhdGlvbjogcHJvcHMubG9jYXRpb24KICAgICAgfTsKICAgIH0gLy8gSWYgd2UncmUgbm90IGNoYW5naW5nIGxvY2F0aW9ucywgcHJlc2VydmUgdGhlIGxvY2F0aW9uIGJ1dCBzdGlsbCBzdXJmYWNlCiAgICAvLyBhbnkgbmV3IGVycm9ycyB0aGF0IG1heSBjb21lIHRocm91Z2guIFdlIHJldGFpbiB0aGUgZXhpc3RpbmcgZXJyb3IsIHdlIGRvCiAgICAvLyB0aGlzIGJlY2F1c2UgdGhlIGVycm9yIHByb3ZpZGVkIGZyb20gdGhlIGFwcCBzdGF0ZSBtYXkgYmUgY2xlYXJlZCB3aXRob3V0CiAgICAvLyB0aGUgbG9jYXRpb24gY2hhbmdpbmcuCgoKICAgIHJldHVybiB7CiAgICAgIGVycm9yOiBwcm9wcy5lcnJvciB8fCBzdGF0ZS5lcnJvciwKICAgICAgbG9jYXRpb246IHN0YXRlLmxvY2F0aW9uCiAgICB9OwogIH0KCiAgY29tcG9uZW50RGlkQ2F0Y2goZXJyb3IsIGVycm9ySW5mbykgewogICAgY29uc29sZS5lcnJvcigiUmVhY3QgUm91dGVyIGNhdWdodCB0aGUgZm9sbG93aW5nIGVycm9yIGR1cmluZyByZW5kZXIiLCBlcnJvciwgZXJyb3JJbmZvKTsKICB9CgogIHJlbmRlcigpIHsKICAgIHJldHVybiB0aGlzLnN0YXRlLmVycm9yID8gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGVFcnJvckNvbnRleHQuUHJvdmlkZXIsIHsKICAgICAgdmFsdWU6IHRoaXMuc3RhdGUuZXJyb3IsCiAgICAgIGNoaWxkcmVuOiB0aGlzLnByb3BzLmNvbXBvbmVudAogICAgfSkgOiB0aGlzLnByb3BzLmNoaWxkcmVuOwogIH0KCn0KCmZ1bmN0aW9uIFJlbmRlcmVkUm91dGUoX3JlZikgewogIGxldCB7CiAgICByb3V0ZUNvbnRleHQsCiAgICBtYXRjaCwKICAgIGNoaWxkcmVuCiAgfSA9IF9yZWY7CiAgbGV0IGRhdGFTdGF0aWNSb3V0ZXJDb250ZXh0ID0gcmVhY3QudXNlQ29udGV4dChEYXRhU3RhdGljUm91dGVyQ29udGV4dCk7IC8vIFRyYWNrIGhvdyBkZWVwIHdlIGdvdCBpbiBvdXIgcmVuZGVyIHBhc3MgdG8gZW11bGF0ZSBTU1IgY29tcG9uZW50RGlkQ2F0Y2gKICAvLyBpbiBhIERhdGFTdGF0aWNSb3V0ZXIKCiAgaWYgKGRhdGFTdGF0aWNSb3V0ZXJDb250ZXh0ICYmIG1hdGNoLnJvdXRlLmVycm9yRWxlbWVudCkgewogICAgZGF0YVN0YXRpY1JvdXRlckNvbnRleHQuX2RlZXBlc3RSZW5kZXJlZEJvdW5kYXJ5SWQgPSBtYXRjaC5yb3V0ZS5pZDsKICB9CgogIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChSb3V0ZUNvbnRleHQuUHJvdmlkZXIsIHsKICAgIHZhbHVlOiByb3V0ZUNvbnRleHQKICB9LCBjaGlsZHJlbik7Cn0KCmZ1bmN0aW9uIF9yZW5kZXJNYXRjaGVzKG1hdGNoZXMsIHBhcmVudE1hdGNoZXMsIGRhdGFSb3V0ZXJTdGF0ZSkgewogIGlmIChwYXJlbnRNYXRjaGVzID09PSB2b2lkIDApIHsKICAgIHBhcmVudE1hdGNoZXMgPSBbXTsKICB9CgogIGlmIChtYXRjaGVzID09IG51bGwpIHsKICAgIGlmIChkYXRhUm91dGVyU3RhdGUgIT0gbnVsbCAmJiBkYXRhUm91dGVyU3RhdGUuZXJyb3JzKSB7CiAgICAgIC8vIERvbid0IGJhaWwgaWYgd2UgaGF2ZSBkYXRhIHJvdXRlciBlcnJvcnMgc28gd2UgY2FuIHJlbmRlciB0aGVtIGluIHRoZQogICAgICAvLyBib3VuZGFyeS4gIFVzZSB0aGUgcHJlLW1hdGNoZWQgKG9yIHNoaW1tZWQpIG1hdGNoZXMKICAgICAgbWF0Y2hlcyA9IGRhdGFSb3V0ZXJTdGF0ZS5tYXRjaGVzOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfQoKICBsZXQgcmVuZGVyZWRNYXRjaGVzID0gbWF0Y2hlczsgLy8gSWYgd2UgaGF2ZSBkYXRhIGVycm9ycywgdHJpbSBtYXRjaGVzIHRvIHRoZSBoaWdoZXN0IGVycm9yIGJvdW5kYXJ5CgogIGxldCBlcnJvcnMgPSBkYXRhUm91dGVyU3RhdGUgPT0gbnVsbCA/IHZvaWQgMCA6IGRhdGFSb3V0ZXJTdGF0ZS5lcnJvcnM7CgogIGlmIChlcnJvcnMgIT0gbnVsbCkgewogICAgbGV0IGVycm9ySW5kZXggPSByZW5kZXJlZE1hdGNoZXMuZmluZEluZGV4KG0gPT4gbS5yb3V0ZS5pZCAmJiAoZXJyb3JzID09IG51bGwgPyB2b2lkIDAgOiBlcnJvcnNbbS5yb3V0ZS5pZF0pKTsKICAgICEoZXJyb3JJbmRleCA+PSAwKSA/ICBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgIHJlbmRlcmVkTWF0Y2hlcyA9IHJlbmRlcmVkTWF0Y2hlcy5zbGljZSgwLCBNYXRoLm1pbihyZW5kZXJlZE1hdGNoZXMubGVuZ3RoLCBlcnJvckluZGV4ICsgMSkpOwogIH0KCiAgcmV0dXJuIHJlbmRlcmVkTWF0Y2hlcy5yZWR1Y2VSaWdodCgob3V0bGV0LCBtYXRjaCwgaW5kZXgpID0+IHsKICAgIGxldCBlcnJvciA9IG1hdGNoLnJvdXRlLmlkID8gZXJyb3JzID09IG51bGwgPyB2b2lkIDAgOiBlcnJvcnNbbWF0Y2gucm91dGUuaWRdIDogbnVsbDsgLy8gT25seSBkYXRhIHJvdXRlcnMgaGFuZGxlIGVycm9ycwoKICAgIGxldCBlcnJvckVsZW1lbnQgPSBkYXRhUm91dGVyU3RhdGUgPyBtYXRjaC5yb3V0ZS5lcnJvckVsZW1lbnQgfHwgLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoRGVmYXVsdEVycm9yRWxlbWVudCwgbnVsbCkgOiBudWxsOwoKICAgIGxldCBnZXRDaGlsZHJlbiA9ICgpID0+IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KFJlbmRlcmVkUm91dGUsIHsKICAgICAgbWF0Y2g6IG1hdGNoLAogICAgICByb3V0ZUNvbnRleHQ6IHsKICAgICAgICBvdXRsZXQsCiAgICAgICAgbWF0Y2hlczogcGFyZW50TWF0Y2hlcy5jb25jYXQocmVuZGVyZWRNYXRjaGVzLnNsaWNlKDAsIGluZGV4ICsgMSkpCiAgICAgIH0KICAgIH0sIGVycm9yID8gZXJyb3JFbGVtZW50IDogbWF0Y2gucm91dGUuZWxlbWVudCAhPT0gdW5kZWZpbmVkID8gbWF0Y2gucm91dGUuZWxlbWVudCA6IG91dGxldCk7IC8vIE9ubHkgd3JhcCBpbiBhbiBlcnJvciBib3VuZGFyeSB3aXRoaW4gZGF0YSByb3V0ZXIgdXNhZ2VzIHdoZW4gd2UgaGF2ZSBhbgogICAgLy8gZXJyb3JFbGVtZW50IG9uIHRoaXMgcm91dGUuICBPdGhlcndpc2UgbGV0IGl0IGJ1YmJsZSB1cCB0byBhbiBhbmNlc3RvcgogICAgLy8gZXJyb3JFbGVtZW50CgoKICAgIHJldHVybiBkYXRhUm91dGVyU3RhdGUgJiYgKG1hdGNoLnJvdXRlLmVycm9yRWxlbWVudCB8fCBpbmRleCA9PT0gMCkgPyAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChSZW5kZXJFcnJvckJvdW5kYXJ5LCB7CiAgICAgIGxvY2F0aW9uOiBkYXRhUm91dGVyU3RhdGUubG9jYXRpb24sCiAgICAgIGNvbXBvbmVudDogZXJyb3JFbGVtZW50LAogICAgICBlcnJvcjogZXJyb3IsCiAgICAgIGNoaWxkcmVuOiBnZXRDaGlsZHJlbigpCiAgICB9KSA6IGdldENoaWxkcmVuKCk7CiAgfSwgbnVsbCk7Cn0KdmFyIERhdGFSb3V0ZXJIb29rOwoKKGZ1bmN0aW9uIChEYXRhUm91dGVySG9vaykgewogIERhdGFSb3V0ZXJIb29rWyJVc2VSZXZhbGlkYXRvciJdID0gInVzZVJldmFsaWRhdG9yIjsKfSkoRGF0YVJvdXRlckhvb2sgfHwgKERhdGFSb3V0ZXJIb29rID0ge30pKTsKCnZhciBEYXRhUm91dGVyU3RhdGVIb29rOwoKKGZ1bmN0aW9uIChEYXRhUm91dGVyU3RhdGVIb29rKSB7CiAgRGF0YVJvdXRlclN0YXRlSG9va1siVXNlTG9hZGVyRGF0YSJdID0gInVzZUxvYWRlckRhdGEiOwogIERhdGFSb3V0ZXJTdGF0ZUhvb2tbIlVzZUFjdGlvbkRhdGEiXSA9ICJ1c2VBY3Rpb25EYXRhIjsKICBEYXRhUm91dGVyU3RhdGVIb29rWyJVc2VSb3V0ZUVycm9yIl0gPSAidXNlUm91dGVFcnJvciI7CiAgRGF0YVJvdXRlclN0YXRlSG9va1siVXNlTmF2aWdhdGlvbiJdID0gInVzZU5hdmlnYXRpb24iOwogIERhdGFSb3V0ZXJTdGF0ZUhvb2tbIlVzZVJvdXRlTG9hZGVyRGF0YSJdID0gInVzZVJvdXRlTG9hZGVyRGF0YSI7CiAgRGF0YVJvdXRlclN0YXRlSG9va1siVXNlTWF0Y2hlcyJdID0gInVzZU1hdGNoZXMiOwogIERhdGFSb3V0ZXJTdGF0ZUhvb2tbIlVzZVJldmFsaWRhdG9yIl0gPSAidXNlUmV2YWxpZGF0b3IiOwp9KShEYXRhUm91dGVyU3RhdGVIb29rIHx8IChEYXRhUm91dGVyU3RhdGVIb29rID0ge30pKTsKCmZ1bmN0aW9uIGdldERhdGFSb3V0ZXJDb25zb2xlRXJyb3IoaG9va05hbWUpIHsKICByZXR1cm4gaG9va05hbWUgKyAiIG11c3QgYmUgdXNlZCB3aXRoaW4gYSBkYXRhIHJvdXRlci4gIFNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9lbi9tYWluL3JvdXRlcnMvcGlja2luZy1hLXJvdXRlci4iOwp9CgpmdW5jdGlvbiB1c2VEYXRhUm91dGVyQ29udGV4dChob29rTmFtZSkgewogIGxldCBjdHggPSBSZWFjdC51c2VDb250ZXh0KERhdGFSb3V0ZXJDb250ZXh0KTsKICAhY3R4ID8gIGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgcmV0dXJuIGN0eDsKfQoKZnVuY3Rpb24gdXNlRGF0YVJvdXRlclN0YXRlKGhvb2tOYW1lKSB7CiAgbGV0IHN0YXRlID0gcmVhY3QudXNlQ29udGV4dChEYXRhUm91dGVyU3RhdGVDb250ZXh0KTsKICAhc3RhdGUgPyAgZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgcmV0dXJuIHN0YXRlOwp9Ci8qKgogKiBSZXR1cm5zIHRoZSBjdXJyZW50IG5hdmlnYXRpb24sIGRlZmF1bHRpbmcgdG8gYW4gImlkbGUiIG5hdmlnYXRpb24gd2hlbgogKiBubyBuYXZpZ2F0aW9uIGlzIGluIHByb2dyZXNzCiAqLwoKCmZ1bmN0aW9uIGRpc3RfdXNlTmF2aWdhdGlvbigpIHsKICBsZXQgc3RhdGUgPSB1c2VEYXRhUm91dGVyU3RhdGUoRGF0YVJvdXRlclN0YXRlSG9vay5Vc2VOYXZpZ2F0aW9uKTsKICByZXR1cm4gc3RhdGUubmF2aWdhdGlvbjsKfQovKioKICogUmV0dXJucyBhIHJldmFsaWRhdGUgZnVuY3Rpb24gZm9yIG1hbnVhbGx5IHRyaWdnZXJpbmcgcmV2YWxpZGF0aW9uLCBhcyB3ZWxsCiAqIGFzIHRoZSBjdXJyZW50IHN0YXRlIG9mIGFueSBtYW51YWwgcmV2YWxpZGF0aW9ucwogKi8KCmZ1bmN0aW9uIHVzZVJldmFsaWRhdG9yKCkgewogIGxldCBkYXRhUm91dGVyQ29udGV4dCA9IHVzZURhdGFSb3V0ZXJDb250ZXh0KERhdGFSb3V0ZXJIb29rLlVzZVJldmFsaWRhdG9yKTsKICBsZXQgc3RhdGUgPSB1c2VEYXRhUm91dGVyU3RhdGUoRGF0YVJvdXRlclN0YXRlSG9vay5Vc2VSZXZhbGlkYXRvcik7CiAgcmV0dXJuIHsKICAgIHJldmFsaWRhdGU6IGRhdGFSb3V0ZXJDb250ZXh0LnJvdXRlci5yZXZhbGlkYXRlLAogICAgc3RhdGU6IHN0YXRlLnJldmFsaWRhdGlvbgogIH07Cn0KLyoqCiAqIFJldHVybnMgdGhlIGFjdGl2ZSByb3V0ZSBtYXRjaGVzLCB1c2VmdWwgZm9yIGFjY2Vzc2luZyBsb2FkZXJEYXRhIGZvcgogKiBwYXJlbnQvY2hpbGQgcm91dGVzIG9yIHRoZSByb3V0ZSAiaGFuZGxlIiBwcm9wZXJ0eQogKi8KCmZ1bmN0aW9uIGRpc3RfdXNlTWF0Y2hlcygpIHsKICBsZXQgewogICAgbWF0Y2hlcywKICAgIGxvYWRlckRhdGEKICB9ID0gdXNlRGF0YVJvdXRlclN0YXRlKERhdGFSb3V0ZXJTdGF0ZUhvb2suVXNlTWF0Y2hlcyk7CiAgcmV0dXJuIFJlYWN0LnVzZU1lbW8oKCkgPT4gbWF0Y2hlcy5tYXAobWF0Y2ggPT4gewogICAgbGV0IHsKICAgICAgcGF0aG5hbWUsCiAgICAgIHBhcmFtcwogICAgfSA9IG1hdGNoOyAvLyBOb3RlOiBUaGlzIHN0cnVjdHVyZSBtYXRjaGVzIHRoYXQgY3JlYXRlZCBieSBjcmVhdGVVc2VNYXRjaGVzTWF0Y2gKICAgIC8vIGluIHRoZSBAcmVtaXgtcnVuL3JvdXRlciAsIHNvIGlmIHlvdSBjaGFuZ2UgdGhpcyBwbGVhc2UgYWxzbyBjaGFuZ2UKICAgIC8vIHRoYXQgOikgIEV2ZW50dWFsbHkgd2UnbGwgRFJZIHRoaXMgdXAKCiAgICByZXR1cm4gewogICAgICBpZDogbWF0Y2gucm91dGUuaWQsCiAgICAgIHBhdGhuYW1lLAogICAgICBwYXJhbXMsCiAgICAgIGRhdGE6IGxvYWRlckRhdGFbbWF0Y2gucm91dGUuaWRdLAogICAgICBoYW5kbGU6IG1hdGNoLnJvdXRlLmhhbmRsZQogICAgfTsKICB9KSwgW21hdGNoZXMsIGxvYWRlckRhdGFdKTsKfQovKioKICogUmV0dXJucyB0aGUgbG9hZGVyIGRhdGEgZm9yIHRoZSBuZWFyZXN0IGFuY2VzdG9yIFJvdXRlIGxvYWRlcgogKi8KCmZ1bmN0aW9uIHVzZUxvYWRlckRhdGEoKSB7CiAgbGV0IHN0YXRlID0gdXNlRGF0YVJvdXRlclN0YXRlKERhdGFSb3V0ZXJTdGF0ZUhvb2suVXNlTG9hZGVyRGF0YSk7CiAgbGV0IHJvdXRlID0gUmVhY3QudXNlQ29udGV4dChSb3V0ZUNvbnRleHQpOwogICFyb3V0ZSA/ICBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogIGxldCB0aGlzUm91dGUgPSByb3V0ZS5tYXRjaGVzW3JvdXRlLm1hdGNoZXMubGVuZ3RoIC0gMV07CiAgIXRoaXNSb3V0ZS5yb3V0ZS5pZCA/ICBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogIHJldHVybiBzdGF0ZS5sb2FkZXJEYXRhW3RoaXNSb3V0ZS5yb3V0ZS5pZF07Cn0KLyoqCiAqIFJldHVybnMgdGhlIGxvYWRlckRhdGEgZm9yIHRoZSBnaXZlbiByb3V0ZUlkCiAqLwoKZnVuY3Rpb24gdXNlUm91dGVMb2FkZXJEYXRhKHJvdXRlSWQpIHsKICBsZXQgc3RhdGUgPSB1c2VEYXRhUm91dGVyU3RhdGUoRGF0YVJvdXRlclN0YXRlSG9vay5Vc2VSb3V0ZUxvYWRlckRhdGEpOwogIHJldHVybiBzdGF0ZS5sb2FkZXJEYXRhW3JvdXRlSWRdOwp9Ci8qKgogKiBSZXR1cm5zIHRoZSBhY3Rpb24gZGF0YSBmb3IgdGhlIG5lYXJlc3QgYW5jZXN0b3IgUm91dGUgYWN0aW9uCiAqLwoKZnVuY3Rpb24gdXNlQWN0aW9uRGF0YSgpIHsKICBsZXQgc3RhdGUgPSB1c2VEYXRhUm91dGVyU3RhdGUoRGF0YVJvdXRlclN0YXRlSG9vay5Vc2VBY3Rpb25EYXRhKTsKICBsZXQgcm91dGUgPSBSZWFjdC51c2VDb250ZXh0KFJvdXRlQ29udGV4dCk7CiAgIXJvdXRlID8gIGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgcmV0dXJuIE9iamVjdC52YWx1ZXMoKHN0YXRlID09IG51bGwgPyB2b2lkIDAgOiBzdGF0ZS5hY3Rpb25EYXRhKSB8fCB7fSlbMF07Cn0KLyoqCiAqIFJldHVybnMgdGhlIG5lYXJlc3QgYW5jZXN0b3IgUm91dGUgZXJyb3IsIHdoaWNoIGNvdWxkIGJlIGEgbG9hZGVyL2FjdGlvbgogKiBlcnJvciBvciBhIHJlbmRlciBlcnJvci4gIFRoaXMgaXMgaW50ZW5kZWQgdG8gYmUgY2FsbGVkIGZyb20geW91cgogKiBlcnJvckVsZW1lbnQgdG8gZGlzcGxheSBhIHByb3BlciBlcnJvciBtZXNzYWdlLgogKi8KCmZ1bmN0aW9uIHVzZVJvdXRlRXJyb3IoKSB7CiAgdmFyIF9zdGF0ZSRlcnJvcnM7CgogIGxldCBlcnJvciA9IHJlYWN0LnVzZUNvbnRleHQoUm91dGVFcnJvckNvbnRleHQpOwogIGxldCBzdGF0ZSA9IHVzZURhdGFSb3V0ZXJTdGF0ZShEYXRhUm91dGVyU3RhdGVIb29rLlVzZVJvdXRlRXJyb3IpOwogIGxldCByb3V0ZSA9IHJlYWN0LnVzZUNvbnRleHQoUm91dGVDb250ZXh0KTsKICBsZXQgdGhpc1JvdXRlID0gcm91dGUubWF0Y2hlc1tyb3V0ZS5tYXRjaGVzLmxlbmd0aCAtIDFdOyAvLyBJZiB0aGlzIHdhcyBhIHJlbmRlciBlcnJvciwgd2UgcHV0IGl0IGluIGEgUm91dGVFcnJvciBjb250ZXh0IGluc2lkZQogIC8vIG9mIFJlbmRlckVycm9yQm91bmRhcnkKCiAgaWYgKGVycm9yKSB7CiAgICByZXR1cm4gZXJyb3I7CiAgfQoKICAhcm91dGUgPyAgZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgIXRoaXNSb3V0ZS5yb3V0ZS5pZCA/ICBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsgLy8gT3RoZXJ3aXNlIGxvb2sgZm9yIGVycm9ycyBmcm9tIG91ciBkYXRhIHJvdXRlciBzdGF0ZQoKICByZXR1cm4gKF9zdGF0ZSRlcnJvcnMgPSBzdGF0ZS5lcnJvcnMpID09IG51bGwgPyB2b2lkIDAgOiBfc3RhdGUkZXJyb3JzW3RoaXNSb3V0ZS5yb3V0ZS5pZF07Cn0KLyoqCiAqIFJldHVybnMgdGhlIGhhcHB5LXBhdGggZGF0YSBmcm9tIHRoZSBuZWFyZXN0IGFuY2VzdG9yIDxBd2FpdCAvPiB2YWx1ZQogKi8KCmZ1bmN0aW9uIHVzZUFzeW5jVmFsdWUoKSB7CiAgbGV0IHZhbHVlID0gUmVhY3QudXNlQ29udGV4dChBd2FpdENvbnRleHQpOwogIHJldHVybiB2YWx1ZSA9PSBudWxsID8gdm9pZCAwIDogdmFsdWUuX2RhdGE7Cn0KLyoqCiAqIFJldHVybnMgdGhlIGVycm9yIGZyb20gdGhlIG5lYXJlc3QgYW5jZXN0b3IgPEF3YWl0IC8+IHZhbHVlCiAqLwoKZnVuY3Rpb24gdXNlQXN5bmNFcnJvcigpIHsKICBsZXQgdmFsdWUgPSBSZWFjdC51c2VDb250ZXh0KEF3YWl0Q29udGV4dCk7CiAgcmV0dXJuIHZhbHVlID09IG51bGwgPyB2b2lkIDAgOiB2YWx1ZS5fZXJyb3I7Cn0KY29uc3QgYWxyZWFkeVdhcm5lZCA9IHt9OwoKZnVuY3Rpb24gd2FybmluZ09uY2Uoa2V5LCBjb25kLCBtZXNzYWdlKSB7CiAgaWYgKCFjb25kICYmICFhbHJlYWR5V2FybmVkW2tleV0pIHsKICAgIGFscmVhZHlXYXJuZWRba2V5XSA9IHRydWU7CiAgICAgZmFsc2UgPyAwIDogdm9pZCAwOwogIH0KfQoKLyoqCiAqIEdpdmVuIGEgUmVtaXggUm91dGVyIGluc3RhbmNlLCByZW5kZXIgdGhlIGFwcHJvcHJpYXRlIFVJCiAqLwpmdW5jdGlvbiBSb3V0ZXJQcm92aWRlcihfcmVmKSB7CiAgbGV0IHsKICAgIGZhbGxiYWNrRWxlbWVudCwKICAgIHJvdXRlcgogIH0gPSBfcmVmOwogIC8vIFN5bmMgcm91dGVyIHN0YXRlIHRvIG91ciBjb21wb25lbnQgc3RhdGUgdG8gZm9yY2UgcmUtcmVuZGVycwogIGxldCBzdGF0ZSA9IHVzZVN5bmNFeHRlcm5hbFN0b3JlKHJvdXRlci5zdWJzY3JpYmUsICgpID0+IHJvdXRlci5zdGF0ZSwgLy8gV2UgaGF2ZSB0byBwcm92aWRlIHRoaXMgc28gUmVhY3RAMTggZG9lc24ndCBjb21wbGFpbiBkdXJpbmcgaHlkcmF0aW9uLAogIC8vIGJ1dCB3ZSBwYXNzIG91ciBzZXJpYWxpemVkIGh5ZHJhdGlvbiBkYXRhIGludG8gdGhlIHJvdXRlciBzbyBzdGF0ZSBoZXJlCiAgLy8gaXMgYWxyZWFkeSBzeW5jZWQgd2l0aCB3aGF0IHRoZSBzZXJ2ZXIgc2F3CiAgKCkgPT4gcm91dGVyLnN0YXRlKTsKICBsZXQgbmF2aWdhdG9yID0gUmVhY3QudXNlTWVtbygoKSA9PiB7CiAgICByZXR1cm4gewogICAgICBjcmVhdGVIcmVmOiByb3V0ZXIuY3JlYXRlSHJlZiwKICAgICAgZ286IG4gPT4gcm91dGVyLm5hdmlnYXRlKG4pLAogICAgICBwdXNoOiAodG8sIHN0YXRlLCBvcHRzKSA9PiByb3V0ZXIubmF2aWdhdGUodG8sIHsKICAgICAgICBzdGF0ZSwKICAgICAgICBwcmV2ZW50U2Nyb2xsUmVzZXQ6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMucHJldmVudFNjcm9sbFJlc2V0CiAgICAgIH0pLAogICAgICByZXBsYWNlOiAodG8sIHN0YXRlLCBvcHRzKSA9PiByb3V0ZXIubmF2aWdhdGUodG8sIHsKICAgICAgICByZXBsYWNlOiB0cnVlLAogICAgICAgIHN0YXRlLAogICAgICAgIHByZXZlbnRTY3JvbGxSZXNldDogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5wcmV2ZW50U2Nyb2xsUmVzZXQKICAgICAgfSkKICAgIH07CiAgfSwgW3JvdXRlcl0pOwogIGxldCBiYXNlbmFtZSA9IHJvdXRlci5iYXNlbmFtZSB8fCAiLyI7CiAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KERhdGFSb3V0ZXJDb250ZXh0LlByb3ZpZGVyLCB7CiAgICB2YWx1ZTogewogICAgICByb3V0ZXIsCiAgICAgIG5hdmlnYXRvciwKICAgICAgc3RhdGljOiBmYWxzZSwKICAgICAgLy8gRG8gd2UgbmVlZCB0aGlzPwogICAgICBiYXNlbmFtZQogICAgfQogIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KERhdGFSb3V0ZXJTdGF0ZUNvbnRleHQuUHJvdmlkZXIsIHsKICAgIHZhbHVlOiBzdGF0ZQogIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KGRpc3RfUm91dGVyLCB7CiAgICBiYXNlbmFtZTogcm91dGVyLmJhc2VuYW1lLAogICAgbG9jYXRpb246IHJvdXRlci5zdGF0ZS5sb2NhdGlvbiwKICAgIG5hdmlnYXRpb25UeXBlOiByb3V0ZXIuc3RhdGUuaGlzdG9yeUFjdGlvbiwKICAgIG5hdmlnYXRvcjogbmF2aWdhdG9yCiAgfSwgcm91dGVyLnN0YXRlLmluaXRpYWxpemVkID8gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGVzLCBudWxsKSA6IGZhbGxiYWNrRWxlbWVudCkpKTsKfQoKLyoqCiAqIEEgPFJvdXRlcj4gdGhhdCBzdG9yZXMgYWxsIGVudHJpZXMgaW4gbWVtb3J5LgogKgogKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvcm91dGVycy9tZW1vcnktcm91dGVyCiAqLwpmdW5jdGlvbiBNZW1vcnlSb3V0ZXIoX3JlZjIpIHsKICBsZXQgewogICAgYmFzZW5hbWUsCiAgICBjaGlsZHJlbiwKICAgIGluaXRpYWxFbnRyaWVzLAogICAgaW5pdGlhbEluZGV4CiAgfSA9IF9yZWYyOwogIGxldCBoaXN0b3J5UmVmID0gcmVhY3QudXNlUmVmKCk7CgogIGlmIChoaXN0b3J5UmVmLmN1cnJlbnQgPT0gbnVsbCkgewogICAgaGlzdG9yeVJlZi5jdXJyZW50ID0gcm91dGVyX2NyZWF0ZU1lbW9yeUhpc3RvcnkoewogICAgICBpbml0aWFsRW50cmllcywKICAgICAgaW5pdGlhbEluZGV4LAogICAgICB2NUNvbXBhdDogdHJ1ZQogICAgfSk7CiAgfQoKICBsZXQgaGlzdG9yeSA9IGhpc3RvcnlSZWYuY3VycmVudDsKICBsZXQgW3N0YXRlLCBzZXRTdGF0ZV0gPSByZWFjdC51c2VTdGF0ZSh7CiAgICBhY3Rpb246IGhpc3RvcnkuYWN0aW9uLAogICAgbG9jYXRpb246IGhpc3RvcnkubG9jYXRpb24KICB9KTsKICByZWFjdC51c2VMYXlvdXRFZmZlY3QoKCkgPT4gaGlzdG9yeS5saXN0ZW4oc2V0U3RhdGUpLCBbaGlzdG9yeV0pOwogIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChkaXN0X1JvdXRlciwgewogICAgYmFzZW5hbWU6IGJhc2VuYW1lLAogICAgY2hpbGRyZW46IGNoaWxkcmVuLAogICAgbG9jYXRpb246IHN0YXRlLmxvY2F0aW9uLAogICAgbmF2aWdhdGlvblR5cGU6IHN0YXRlLmFjdGlvbiwKICAgIG5hdmlnYXRvcjogaGlzdG9yeQogIH0pOwp9CgovKioKICogQ2hhbmdlcyB0aGUgY3VycmVudCBsb2NhdGlvbi4KICoKICogTm90ZTogVGhpcyBBUEkgaXMgbW9zdGx5IHVzZWZ1bCBpbiBSZWFjdC5Db21wb25lbnQgc3ViY2xhc3NlcyB0aGF0IGFyZSBub3QKICogYWJsZSB0byB1c2UgaG9va3MuIEluIGZ1bmN0aW9uYWwgY29tcG9uZW50cywgd2UgcmVjb21tZW5kIHlvdSB1c2UgdGhlCiAqIGB1c2VOYXZpZ2F0ZWAgaG9vayBpbnN0ZWFkLgogKgogKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvY29tcG9uZW50cy9uYXZpZ2F0ZQogKi8KZnVuY3Rpb24gTmF2aWdhdGUoX3JlZjMpIHsKICBsZXQgewogICAgdG8sCiAgICByZXBsYWNlLAogICAgc3RhdGUsCiAgICByZWxhdGl2ZQogIH0gPSBfcmVmMzsKICAhdXNlSW5Sb3V0ZXJDb250ZXh0KCkgPyAgZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgIGZhbHNlID8gMCA6IHZvaWQgMDsKICBsZXQgZGF0YVJvdXRlclN0YXRlID0gcmVhY3QudXNlQ29udGV4dChEYXRhUm91dGVyU3RhdGVDb250ZXh0KTsKICBsZXQgbmF2aWdhdGUgPSBkaXN0X3VzZU5hdmlnYXRlKCk7CiAgcmVhY3QudXNlRWZmZWN0KCgpID0+IHsKICAgIC8vIEF2b2lkIGtpY2tpbmcgb2ZmIG11bHRpcGxlIG5hdmlnYXRpb25zIGlmIHdlJ3JlIGluIHRoZSBtaWRkbGUgb2YgYQogICAgLy8gZGF0YS1yb3V0ZXIgbmF2aWdhdGlvbiwgc2luY2UgY29tcG9uZW50cyBnZXQgcmUtcmVuZGVyZWQgd2hlbiB3ZSBlbnRlcgogICAgLy8gYSBzdWJtaXR0aW5nL2xvYWRpbmcgc3RhdGUKICAgIGlmIChkYXRhUm91dGVyU3RhdGUgJiYgZGF0YVJvdXRlclN0YXRlLm5hdmlnYXRpb24uc3RhdGUgIT09ICJpZGxlIikgewogICAgICByZXR1cm47CiAgICB9CgogICAgbmF2aWdhdGUodG8sIHsKICAgICAgcmVwbGFjZSwKICAgICAgc3RhdGUsCiAgICAgIHJlbGF0aXZlCiAgICB9KTsKICB9KTsKICByZXR1cm4gbnVsbDsKfQoKLyoqCiAqIFJlbmRlcnMgdGhlIGNoaWxkIHJvdXRlJ3MgZWxlbWVudCwgaWYgdGhlcmUgaXMgb25lLgogKgogKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvY29tcG9uZW50cy9vdXRsZXQKICovCmZ1bmN0aW9uIE91dGxldChwcm9wcykgewogIHJldHVybiB1c2VPdXRsZXQocHJvcHMuY29udGV4dCk7Cn0KCi8qKgogKiBEZWNsYXJlcyBhbiBlbGVtZW50IHRoYXQgc2hvdWxkIGJlIHJlbmRlcmVkIGF0IGEgY2VydGFpbiBVUkwgcGF0aC4KICoKICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9kb2NzL2VuL3Y2L2NvbXBvbmVudHMvcm91dGUKICovCmZ1bmN0aW9uIFJvdXRlKF9wcm9wcykgewogICBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA7Cn0KCi8qKgogKiBQcm92aWRlcyBsb2NhdGlvbiBjb250ZXh0IGZvciB0aGUgcmVzdCBvZiB0aGUgYXBwLgogKgogKiBOb3RlOiBZb3UgdXN1YWxseSB3b24ndCByZW5kZXIgYSA8Um91dGVyPiBkaXJlY3RseS4gSW5zdGVhZCwgeW91J2xsIHJlbmRlciBhCiAqIHJvdXRlciB0aGF0IGlzIG1vcmUgc3BlY2lmaWMgdG8geW91ciBlbnZpcm9ubWVudCBzdWNoIGFzIGEgPEJyb3dzZXJSb3V0ZXI+CiAqIGluIHdlYiBicm93c2VycyBvciBhIDxTdGF0aWNSb3V0ZXI+IGZvciBzZXJ2ZXIgcmVuZGVyaW5nLgogKgogKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvcm91dGVycy9yb3V0ZXIKICovCmZ1bmN0aW9uIGRpc3RfUm91dGVyKF9yZWY0KSB7CiAgbGV0IHsKICAgIGJhc2VuYW1lOiBiYXNlbmFtZVByb3AgPSAiLyIsCiAgICBjaGlsZHJlbiA9IG51bGwsCiAgICBsb2NhdGlvbjogbG9jYXRpb25Qcm9wLAogICAgbmF2aWdhdGlvblR5cGUgPSBBY3Rpb24uUG9wLAogICAgbmF2aWdhdG9yLAogICAgc3RhdGljOiBzdGF0aWNQcm9wID0gZmFsc2UKICB9ID0gX3JlZjQ7CiAgISF1c2VJblJvdXRlckNvbnRleHQoKSA/ICBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsgLy8gUHJlc2VydmUgdHJhaWxpbmcgc2xhc2hlcyBvbiBiYXNlbmFtZSwgc28gd2UgY2FuIGxldCB0aGUgdXNlciBjb250cm9sCiAgLy8gdGhlIGVuZm9yY2VtZW50IG9mIHRyYWlsaW5nIHNsYXNoZXMgdGhyb3VnaG91dCB0aGUgYXBwCgogIGxldCBiYXNlbmFtZSA9IGJhc2VuYW1lUHJvcC5yZXBsYWNlKC9eXC8qLywgIi8iKTsKICBsZXQgbmF2aWdhdGlvbkNvbnRleHQgPSByZWFjdC51c2VNZW1vKCgpID0+ICh7CiAgICBiYXNlbmFtZSwKICAgIG5hdmlnYXRvciwKICAgIHN0YXRpYzogc3RhdGljUHJvcAogIH0pLCBbYmFzZW5hbWUsIG5hdmlnYXRvciwgc3RhdGljUHJvcF0pOwoKICBpZiAodHlwZW9mIGxvY2F0aW9uUHJvcCA9PT0gInN0cmluZyIpIHsKICAgIGxvY2F0aW9uUHJvcCA9IHBhcnNlUGF0aChsb2NhdGlvblByb3ApOwogIH0KCiAgbGV0IHsKICAgIHBhdGhuYW1lID0gIi8iLAogICAgc2VhcmNoID0gIiIsCiAgICBoYXNoID0gIiIsCiAgICBzdGF0ZSA9IG51bGwsCiAgICBrZXkgPSAiZGVmYXVsdCIKICB9ID0gbG9jYXRpb25Qcm9wOwogIGxldCBsb2NhdGlvbiA9IHJlYWN0LnVzZU1lbW8oKCkgPT4gewogICAgbGV0IHRyYWlsaW5nUGF0aG5hbWUgPSBzdHJpcEJhc2VuYW1lKHBhdGhuYW1lLCBiYXNlbmFtZSk7CgogICAgaWYgKHRyYWlsaW5nUGF0aG5hbWUgPT0gbnVsbCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICByZXR1cm4gewogICAgICBwYXRobmFtZTogdHJhaWxpbmdQYXRobmFtZSwKICAgICAgc2VhcmNoLAogICAgICBoYXNoLAogICAgICBzdGF0ZSwKICAgICAga2V5CiAgICB9OwogIH0sIFtiYXNlbmFtZSwgcGF0aG5hbWUsIHNlYXJjaCwgaGFzaCwgc3RhdGUsIGtleV0pOwogICBmYWxzZSA/IDAgOiB2b2lkIDA7CgogIGlmIChsb2NhdGlvbiA9PSBudWxsKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CgogIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChOYXZpZ2F0aW9uQ29udGV4dC5Qcm92aWRlciwgewogICAgdmFsdWU6IG5hdmlnYXRpb25Db250ZXh0CiAgfSwgLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoTG9jYXRpb25Db250ZXh0LlByb3ZpZGVyLCB7CiAgICBjaGlsZHJlbjogY2hpbGRyZW4sCiAgICB2YWx1ZTogewogICAgICBsb2NhdGlvbiwKICAgICAgbmF2aWdhdGlvblR5cGUKICAgIH0KICB9KSk7Cn0KCi8qKgogKiBBIGNvbnRhaW5lciBmb3IgYSBuZXN0ZWQgdHJlZSBvZiA8Um91dGU+IGVsZW1lbnRzIHRoYXQgcmVuZGVycyB0aGUgYnJhbmNoCiAqIHRoYXQgYmVzdCBtYXRjaGVzIHRoZSBjdXJyZW50IGxvY2F0aW9uLgogKgogKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvY29tcG9uZW50cy9yb3V0ZXMKICovCmZ1bmN0aW9uIFJvdXRlcyhfcmVmNSkgewogIGxldCB7CiAgICBjaGlsZHJlbiwKICAgIGxvY2F0aW9uCiAgfSA9IF9yZWY1OwogIGxldCBkYXRhUm91dGVyQ29udGV4dCA9IHJlYWN0LnVzZUNvbnRleHQoRGF0YVJvdXRlckNvbnRleHQpOyAvLyBXaGVuIGluIGEgRGF0YVJvdXRlckNvbnRleHQgX3dpdGhvdXRfIGNoaWxkcmVuLCB3ZSB1c2UgdGhlIHJvdXRlciByb3V0ZXMKICAvLyBkaXJlY3RseS4gIElmIHdlIGhhdmUgY2hpbGRyZW4sIHRoZW4gd2UncmUgaW4gYSBkZXNjZW5kYW50IHRyZWUgYW5kIHdlCiAgLy8gbmVlZCB0byB1c2UgY2hpbGQgcm91dGVzLgoKICBsZXQgcm91dGVzID0gZGF0YVJvdXRlckNvbnRleHQgJiYgIWNoaWxkcmVuID8gZGF0YVJvdXRlckNvbnRleHQucm91dGVyLnJvdXRlcyA6IGNyZWF0ZVJvdXRlc0Zyb21DaGlsZHJlbihjaGlsZHJlbik7CiAgcmV0dXJuIHVzZVJvdXRlcyhyb3V0ZXMsIGxvY2F0aW9uKTsKfQoKLyoqCiAqIENvbXBvbmVudCB0byB1c2UgZm9yIHJlbmRlcmluZyBsYXppbHkgbG9hZGVkIGRhdGEgZnJvbSByZXR1cm5pbmcgZGVmZXIoKQogKiBpbiBhIGxvYWRlciBmdW5jdGlvbgogKi8KZnVuY3Rpb24gQXdhaXQoX3JlZjYpIHsKICBsZXQgewogICAgY2hpbGRyZW4sCiAgICBlcnJvckVsZW1lbnQsCiAgICByZXNvbHZlCiAgfSA9IF9yZWY2OwogIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChBd2FpdEVycm9yQm91bmRhcnksIHsKICAgIHJlc29sdmU6IHJlc29sdmUsCiAgICBlcnJvckVsZW1lbnQ6IGVycm9yRWxlbWVudAogIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFJlc29sdmVBd2FpdCwgbnVsbCwgY2hpbGRyZW4pKTsKfQp2YXIgQXdhaXRSZW5kZXJTdGF0dXM7CgooZnVuY3Rpb24gKEF3YWl0UmVuZGVyU3RhdHVzKSB7CiAgQXdhaXRSZW5kZXJTdGF0dXNbQXdhaXRSZW5kZXJTdGF0dXNbInBlbmRpbmciXSA9IDBdID0gInBlbmRpbmciOwogIEF3YWl0UmVuZGVyU3RhdHVzW0F3YWl0UmVuZGVyU3RhdHVzWyJzdWNjZXNzIl0gPSAxXSA9ICJzdWNjZXNzIjsKICBBd2FpdFJlbmRlclN0YXR1c1tBd2FpdFJlbmRlclN0YXR1c1siZXJyb3IiXSA9IDJdID0gImVycm9yIjsKfSkoQXdhaXRSZW5kZXJTdGF0dXMgfHwgKEF3YWl0UmVuZGVyU3RhdHVzID0ge30pKTsKCmNvbnN0IG5ldmVyU2V0dGxlZFByb21pc2UgPSBuZXcgUHJvbWlzZSgoKSA9PiB7fSk7CgpjbGFzcyBBd2FpdEVycm9yQm91bmRhcnkgZXh0ZW5kcyByZWFjdC5Db21wb25lbnQgewogIGNvbnN0cnVjdG9yKHByb3BzKSB7CiAgICBzdXBlcihwcm9wcyk7CiAgICB0aGlzLnN0YXRlID0gewogICAgICBlcnJvcjogbnVsbAogICAgfTsKICB9CgogIHN0YXRpYyBnZXREZXJpdmVkU3RhdGVGcm9tRXJyb3IoZXJyb3IpIHsKICAgIHJldHVybiB7CiAgICAgIGVycm9yCiAgICB9OwogIH0KCiAgY29tcG9uZW50RGlkQ2F0Y2goZXJyb3IsIGVycm9ySW5mbykgewogICAgY29uc29sZS5lcnJvcigiPEF3YWl0PiBjYXVnaHQgdGhlIGZvbGxvd2luZyBlcnJvciBkdXJpbmcgcmVuZGVyIiwgZXJyb3IsIGVycm9ySW5mbyk7CiAgfQoKICByZW5kZXIoKSB7CiAgICBsZXQgewogICAgICBjaGlsZHJlbiwKICAgICAgZXJyb3JFbGVtZW50LAogICAgICByZXNvbHZlCiAgICB9ID0gdGhpcy5wcm9wczsKICAgIGxldCBwcm9taXNlID0gbnVsbDsKICAgIGxldCBzdGF0dXMgPSBBd2FpdFJlbmRlclN0YXR1cy5wZW5kaW5nOwoKICAgIGlmICghKHJlc29sdmUgaW5zdGFuY2VvZiBQcm9taXNlKSkgewogICAgICAvLyBEaWRuJ3QgZ2V0IGEgcHJvbWlzZSAtIHByb3ZpZGUgYXMgYSByZXNvbHZlZCBwcm9taXNlCiAgICAgIHN0YXR1cyA9IEF3YWl0UmVuZGVyU3RhdHVzLnN1Y2Nlc3M7CiAgICAgIHByb21pc2UgPSBQcm9taXNlLnJlc29sdmUoKTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb21pc2UsICJfdHJhY2tlZCIsIHsKICAgICAgICBnZXQ6ICgpID0+IHRydWUKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9taXNlLCAiX2RhdGEiLCB7CiAgICAgICAgZ2V0OiAoKSA9PiByZXNvbHZlCiAgICAgIH0pOwogICAgfSBlbHNlIGlmICh0aGlzLnN0YXRlLmVycm9yKSB7CiAgICAgIC8vIENhdWdodCBhIHJlbmRlciBlcnJvciwgcHJvdmlkZSBpdCBhcyBhIHJlamVjdGVkIHByb21pc2UKICAgICAgc3RhdHVzID0gQXdhaXRSZW5kZXJTdGF0dXMuZXJyb3I7CiAgICAgIGxldCByZW5kZXJFcnJvciA9IHRoaXMuc3RhdGUuZXJyb3I7CiAgICAgIHByb21pc2UgPSBQcm9taXNlLnJlamVjdCgpLmNhdGNoKCgpID0+IHt9KTsgLy8gQXZvaWQgdW5oYW5kbGVkIHJlamVjdGlvbiB3YXJuaW5ncwoKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb21pc2UsICJfdHJhY2tlZCIsIHsKICAgICAgICBnZXQ6ICgpID0+IHRydWUKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9taXNlLCAiX2Vycm9yIiwgewogICAgICAgIGdldDogKCkgPT4gcmVuZGVyRXJyb3IKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKHJlc29sdmUuX3RyYWNrZWQpIHsKICAgICAgLy8gQWxyZWFkeSB0cmFja2VkIHByb21pc2UgLSBjaGVjayBjb250ZW50cwogICAgICBwcm9taXNlID0gcmVzb2x2ZTsKICAgICAgc3RhdHVzID0gcHJvbWlzZS5fZXJyb3IgIT09IHVuZGVmaW5lZCA/IEF3YWl0UmVuZGVyU3RhdHVzLmVycm9yIDogcHJvbWlzZS5fZGF0YSAhPT0gdW5kZWZpbmVkID8gQXdhaXRSZW5kZXJTdGF0dXMuc3VjY2VzcyA6IEF3YWl0UmVuZGVyU3RhdHVzLnBlbmRpbmc7CiAgICB9IGVsc2UgewogICAgICAvLyBSYXcgKHVudHJhY2tlZCkgcHJvbWlzZSAtIHRyYWNrIGl0CiAgICAgIHN0YXR1cyA9IEF3YWl0UmVuZGVyU3RhdHVzLnBlbmRpbmc7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyZXNvbHZlLCAiX3RyYWNrZWQiLCB7CiAgICAgICAgZ2V0OiAoKSA9PiB0cnVlCiAgICAgIH0pOwogICAgICBwcm9taXNlID0gcmVzb2x2ZS50aGVuKGRhdGEgPT4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHJlc29sdmUsICJfZGF0YSIsIHsKICAgICAgICBnZXQ6ICgpID0+IGRhdGEKICAgICAgfSksIGVycm9yID0+IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyZXNvbHZlLCAiX2Vycm9yIiwgewogICAgICAgIGdldDogKCkgPT4gZXJyb3IKICAgICAgfSkpOwogICAgfQoKICAgIGlmIChzdGF0dXMgPT09IEF3YWl0UmVuZGVyU3RhdHVzLmVycm9yICYmIHByb21pc2UuX2Vycm9yIGluc3RhbmNlb2YgQWJvcnRlZERlZmVycmVkRXJyb3IpIHsKICAgICAgLy8gRnJlZXplIHRoZSBVSSBieSB0aHJvd2luZyBhIG5ldmVyIHJlc29sdmVkIHByb21pc2UKICAgICAgdGhyb3cgbmV2ZXJTZXR0bGVkUHJvbWlzZTsKICAgIH0KCiAgICBpZiAoc3RhdHVzID09PSBBd2FpdFJlbmRlclN0YXR1cy5lcnJvciAmJiAhZXJyb3JFbGVtZW50KSB7CiAgICAgIC8vIE5vIGVycm9yRWxlbWVudCwgdGhyb3cgdG8gdGhlIG5lYXJlc3Qgcm91dGUtbGV2ZWwgZXJyb3IgYm91bmRhcnkKICAgICAgdGhyb3cgcHJvbWlzZS5fZXJyb3I7CiAgICB9CgogICAgaWYgKHN0YXR1cyA9PT0gQXdhaXRSZW5kZXJTdGF0dXMuZXJyb3IpIHsKICAgICAgLy8gUmVuZGVyIHZpYSBvdXIgZXJyb3JFbGVtZW50CiAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChBd2FpdENvbnRleHQuUHJvdmlkZXIsIHsKICAgICAgICB2YWx1ZTogcHJvbWlzZSwKICAgICAgICBjaGlsZHJlbjogZXJyb3JFbGVtZW50CiAgICAgIH0pOwogICAgfQoKICAgIGlmIChzdGF0dXMgPT09IEF3YWl0UmVuZGVyU3RhdHVzLnN1Y2Nlc3MpIHsKICAgICAgLy8gUmVuZGVyIGNoaWxkcmVuIHdpdGggcmVzb2x2ZWQgdmFsdWUKICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KEF3YWl0Q29udGV4dC5Qcm92aWRlciwgewogICAgICAgIHZhbHVlOiBwcm9taXNlLAogICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlbgogICAgICB9KTsKICAgIH0gLy8gVGhyb3cgdG8gdGhlIHN1c3BlbnNlIGJvdW5kYXJ5CgoKICAgIHRocm93IHByb21pc2U7CiAgfQoKfQovKioKICogQHByaXZhdGUKICogSW5kaXJlY3Rpb24gdG8gbGV2ZXJhZ2UgdXNlQXN5bmNWYWx1ZSBmb3IgYSByZW5kZXItcHJvcCBBUEkgb24gPEF3YWl0PgogKi8KCgpmdW5jdGlvbiBSZXNvbHZlQXdhaXQoX3JlZjcpIHsKICBsZXQgewogICAgY2hpbGRyZW4KICB9ID0gX3JlZjc7CiAgbGV0IGRhdGEgPSB1c2VBc3luY1ZhbHVlKCk7CgogIGlmICh0eXBlb2YgY2hpbGRyZW4gPT09ICJmdW5jdGlvbiIpIHsKICAgIHJldHVybiBjaGlsZHJlbihkYXRhKTsKICB9CgogIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChSZWFjdC5GcmFnbWVudCwgbnVsbCwgY2hpbGRyZW4pOwp9IC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gVVRJTFMKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKLyoqCiAqIENyZWF0ZXMgYSByb3V0ZSBjb25maWcgZnJvbSBhIFJlYWN0ICJjaGlsZHJlbiIgb2JqZWN0LCB3aGljaCBpcyB1c3VhbGx5CiAqIGVpdGhlciBhIGA8Um91dGU+YCBlbGVtZW50IG9yIGFuIGFycmF5IG9mIHRoZW0uIFVzZWQgaW50ZXJuYWxseSBieQogKiBgPFJvdXRlcz5gIHRvIGNyZWF0ZSBhIHJvdXRlIGNvbmZpZyBmcm9tIGl0cyBjaGlsZHJlbi4KICoKICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9kb2NzL2VuL3Y2L3V0aWxzL2NyZWF0ZS1yb3V0ZXMtZnJvbS1jaGlsZHJlbgogKi8KCgpmdW5jdGlvbiBjcmVhdGVSb3V0ZXNGcm9tQ2hpbGRyZW4oY2hpbGRyZW4sIHBhcmVudFBhdGgpIHsKICBpZiAocGFyZW50UGF0aCA9PT0gdm9pZCAwKSB7CiAgICBwYXJlbnRQYXRoID0gW107CiAgfQoKICBsZXQgcm91dGVzID0gW107CiAgcmVhY3QuQ2hpbGRyZW4uZm9yRWFjaChjaGlsZHJlbiwgKGVsZW1lbnQsIGluZGV4KSA9PiB7CiAgICBpZiAoISAvKiNfX1BVUkVfXyovcmVhY3QuaXNWYWxpZEVsZW1lbnQoZWxlbWVudCkpIHsKICAgICAgLy8gSWdub3JlIG5vbi1lbGVtZW50cy4gVGhpcyBhbGxvd3MgcGVvcGxlIHRvIG1vcmUgZWFzaWx5IGlubGluZQogICAgICAvLyBjb25kaXRpb25hbHMgaW4gdGhlaXIgcm91dGUgY29uZmlnLgogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKGVsZW1lbnQudHlwZSA9PT0gcmVhY3QuRnJhZ21lbnQpIHsKICAgICAgLy8gVHJhbnNwYXJlbnRseSBzdXBwb3J0IFJlYWN0LkZyYWdtZW50IGFuZCBpdHMgY2hpbGRyZW4uCiAgICAgIHJvdXRlcy5wdXNoLmFwcGx5KHJvdXRlcywgY3JlYXRlUm91dGVzRnJvbUNoaWxkcmVuKGVsZW1lbnQucHJvcHMuY2hpbGRyZW4sIHBhcmVudFBhdGgpKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgICEoZWxlbWVudC50eXBlID09PSBSb3V0ZSkgPyAgZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAhKCFlbGVtZW50LnByb3BzLmluZGV4IHx8ICFlbGVtZW50LnByb3BzLmNoaWxkcmVuKSA/ICBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgIGxldCB0cmVlUGF0aCA9IFsuLi5wYXJlbnRQYXRoLCBpbmRleF07CiAgICBsZXQgcm91dGUgPSB7CiAgICAgIGlkOiBlbGVtZW50LnByb3BzLmlkIHx8IHRyZWVQYXRoLmpvaW4oIi0iKSwKICAgICAgY2FzZVNlbnNpdGl2ZTogZWxlbWVudC5wcm9wcy5jYXNlU2Vuc2l0aXZlLAogICAgICBlbGVtZW50OiBlbGVtZW50LnByb3BzLmVsZW1lbnQsCiAgICAgIGluZGV4OiBlbGVtZW50LnByb3BzLmluZGV4LAogICAgICBwYXRoOiBlbGVtZW50LnByb3BzLnBhdGgsCiAgICAgIGxvYWRlcjogZWxlbWVudC5wcm9wcy5sb2FkZXIsCiAgICAgIGFjdGlvbjogZWxlbWVudC5wcm9wcy5hY3Rpb24sCiAgICAgIGVycm9yRWxlbWVudDogZWxlbWVudC5wcm9wcy5lcnJvckVsZW1lbnQsCiAgICAgIGhhc0Vycm9yQm91bmRhcnk6IGVsZW1lbnQucHJvcHMuZXJyb3JFbGVtZW50ICE9IG51bGwsCiAgICAgIHNob3VsZFJldmFsaWRhdGU6IGVsZW1lbnQucHJvcHMuc2hvdWxkUmV2YWxpZGF0ZSwKICAgICAgaGFuZGxlOiBlbGVtZW50LnByb3BzLmhhbmRsZQogICAgfTsKCiAgICBpZiAoZWxlbWVudC5wcm9wcy5jaGlsZHJlbikgewogICAgICByb3V0ZS5jaGlsZHJlbiA9IGNyZWF0ZVJvdXRlc0Zyb21DaGlsZHJlbihlbGVtZW50LnByb3BzLmNoaWxkcmVuLCB0cmVlUGF0aCk7CiAgICB9CgogICAgcm91dGVzLnB1c2gocm91dGUpOwogIH0pOwogIHJldHVybiByb3V0ZXM7Cn0KLyoqCiAqIFJlbmRlcnMgdGhlIHJlc3VsdCBvZiBgbWF0Y2hSb3V0ZXMoKWAgaW50byBhIFJlYWN0IGVsZW1lbnQuCiAqLwoKZnVuY3Rpb24gcmVuZGVyTWF0Y2hlcyhtYXRjaGVzKSB7CiAgcmV0dXJuIF9yZW5kZXJNYXRjaGVzKG1hdGNoZXMpOwp9Ci8qKgogKiBAcHJpdmF0ZQogKiBXYWxrIHRoZSByb3V0ZSB0cmVlIGFuZCBhZGQgaGFzRXJyb3JCb3VuZGFyeSBpZiBpdCdzIG5vdCBwcm92aWRlZCwgc28gdGhhdAogKiB1c2VycyBwcm92aWRpbmcgbWFudWFsIHJvdXRlIGFycmF5cyBjYW4ganVzdCBzcGVjaWZ5IGVycm9yRWxlbWVudAogKi8KCmZ1bmN0aW9uIGVuaGFuY2VNYW51YWxSb3V0ZU9iamVjdHMocm91dGVzKSB7CiAgcmV0dXJuIHJvdXRlcy5tYXAocm91dGUgPT4gewogICAgbGV0IHJvdXRlQ2xvbmUgPSBkaXN0X2V4dGVuZHMoe30sIHJvdXRlKTsKCiAgICBpZiAocm91dGVDbG9uZS5oYXNFcnJvckJvdW5kYXJ5ID09IG51bGwpIHsKICAgICAgcm91dGVDbG9uZS5oYXNFcnJvckJvdW5kYXJ5ID0gcm91dGVDbG9uZS5lcnJvckVsZW1lbnQgIT0gbnVsbDsKICAgIH0KCiAgICBpZiAocm91dGVDbG9uZS5jaGlsZHJlbikgewogICAgICByb3V0ZUNsb25lLmNoaWxkcmVuID0gZW5oYW5jZU1hbnVhbFJvdXRlT2JqZWN0cyhyb3V0ZUNsb25lLmNoaWxkcmVuKTsKICAgIH0KCiAgICByZXR1cm4gcm91dGVDbG9uZTsKICB9KTsKfQoKZnVuY3Rpb24gY3JlYXRlTWVtb3J5Um91dGVyKHJvdXRlcywgb3B0cykgewogIHJldHVybiBjcmVhdGVSb3V0ZXIoewogICAgYmFzZW5hbWU6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMuYmFzZW5hbWUsCiAgICBoaXN0b3J5OiBjcmVhdGVNZW1vcnlIaXN0b3J5KHsKICAgICAgaW5pdGlhbEVudHJpZXM6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMuaW5pdGlhbEVudHJpZXMsCiAgICAgIGluaXRpYWxJbmRleDogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5pbml0aWFsSW5kZXgKICAgIH0pLAogICAgaHlkcmF0aW9uRGF0YTogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5oeWRyYXRpb25EYXRhLAogICAgcm91dGVzOiBlbmhhbmNlTWFudWFsUm91dGVPYmplY3RzKHJvdXRlcykKICB9KS5pbml0aWFsaXplKCk7Cn0gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKCi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcAoKOy8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlYWN0LXJvdXRlci1kb20vZGlzdC9pbmRleC5qcwovKioKICogUmVhY3QgUm91dGVyIERPTSB2Ni40LjMKICoKICogQ29weXJpZ2h0IChjKSBSZW1peCBTb2Z0d2FyZSBJbmMuCiAqCiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZQogKiBMSUNFTlNFLm1kIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAqCiAqIEBsaWNlbnNlIE1JVAogKi8KCgoKCgpmdW5jdGlvbiByZWFjdF9yb3V0ZXJfZG9tX2Rpc3RfZXh0ZW5kcygpIHsKICByZWFjdF9yb3V0ZXJfZG9tX2Rpc3RfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gPyBPYmplY3QuYXNzaWduLmJpbmQoKSA6IGZ1bmN0aW9uICh0YXJnZXQpIHsKICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07CgogICAgICBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7CiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsKICAgICAgICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRhcmdldDsKICB9OwogIHJldHVybiByZWFjdF9yb3V0ZXJfZG9tX2Rpc3RfZXh0ZW5kcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpmdW5jdGlvbiBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShzb3VyY2UsIGV4Y2x1ZGVkKSB7CiAgaWYgKHNvdXJjZSA9PSBudWxsKSByZXR1cm4ge307CiAgdmFyIHRhcmdldCA9IHt9OwogIHZhciBzb3VyY2VLZXlzID0gT2JqZWN0LmtleXMoc291cmNlKTsKICB2YXIga2V5LCBpOwoKICBmb3IgKGkgPSAwOyBpIDwgc291cmNlS2V5cy5sZW5ndGg7IGkrKykgewogICAga2V5ID0gc291cmNlS2V5c1tpXTsKICAgIGlmIChleGNsdWRlZC5pbmRleE9mKGtleSkgPj0gMCkgY29udGludWU7CiAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOwogIH0KCiAgcmV0dXJuIHRhcmdldDsKfQoKY29uc3QgZGVmYXVsdE1ldGhvZCA9ICJnZXQiOwpjb25zdCBkZWZhdWx0RW5jVHlwZSA9ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiOwpmdW5jdGlvbiBpc0h0bWxFbGVtZW50KG9iamVjdCkgewogIHJldHVybiBvYmplY3QgIT0gbnVsbCAmJiB0eXBlb2Ygb2JqZWN0LnRhZ05hbWUgPT09ICJzdHJpbmciOwp9CmZ1bmN0aW9uIGlzQnV0dG9uRWxlbWVudChvYmplY3QpIHsKICByZXR1cm4gaXNIdG1sRWxlbWVudChvYmplY3QpICYmIG9iamVjdC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJidXR0b24iOwp9CmZ1bmN0aW9uIGlzRm9ybUVsZW1lbnQob2JqZWN0KSB7CiAgcmV0dXJuIGlzSHRtbEVsZW1lbnQob2JqZWN0KSAmJiBvYmplY3QudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAiZm9ybSI7Cn0KZnVuY3Rpb24gaXNJbnB1dEVsZW1lbnQob2JqZWN0KSB7CiAgcmV0dXJuIGlzSHRtbEVsZW1lbnQob2JqZWN0KSAmJiBvYmplY3QudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAiaW5wdXQiOwp9CgpmdW5jdGlvbiBpc01vZGlmaWVkRXZlbnQoZXZlbnQpIHsKICByZXR1cm4gISEoZXZlbnQubWV0YUtleSB8fCBldmVudC5hbHRLZXkgfHwgZXZlbnQuY3RybEtleSB8fCBldmVudC5zaGlmdEtleSk7Cn0KCmZ1bmN0aW9uIHNob3VsZFByb2Nlc3NMaW5rQ2xpY2soZXZlbnQsIHRhcmdldCkgewogIHJldHVybiBldmVudC5idXR0b24gPT09IDAgJiYgKCAvLyBJZ25vcmUgZXZlcnl0aGluZyBidXQgbGVmdCBjbGlja3MKICAhdGFyZ2V0IHx8IHRhcmdldCA9PT0gIl9zZWxmIikgJiYgLy8gTGV0IGJyb3dzZXIgaGFuZGxlICJ0YXJnZXQ9X2JsYW5rIiBldGMuCiAgIWlzTW9kaWZpZWRFdmVudChldmVudCkgLy8gSWdub3JlIGNsaWNrcyB3aXRoIG1vZGlmaWVyIGtleXMKICA7Cn0KLyoqCiAqIENyZWF0ZXMgYSBVUkxTZWFyY2hQYXJhbXMgb2JqZWN0IHVzaW5nIHRoZSBnaXZlbiBpbml0aWFsaXplci4KICoKICogVGhpcyBpcyBpZGVudGljYWwgdG8gYG5ldyBVUkxTZWFyY2hQYXJhbXMoaW5pdClgIGV4Y2VwdCBpdCBhbHNvCiAqIHN1cHBvcnRzIGFycmF5cyBhcyB2YWx1ZXMgaW4gdGhlIG9iamVjdCBmb3JtIG9mIHRoZSBpbml0aWFsaXplcgogKiBpbnN0ZWFkIG9mIGp1c3Qgc3RyaW5ncy4gVGhpcyBpcyBjb252ZW5pZW50IHdoZW4geW91IG5lZWQgbXVsdGlwbGUKICogdmFsdWVzIGZvciBhIGdpdmVuIGtleSwgYnV0IGRvbid0IHdhbnQgdG8gdXNlIGFuIGFycmF5IGluaXRpYWxpemVyLgogKgogKiBGb3IgZXhhbXBsZSwgaW5zdGVhZCBvZjoKICoKICogICBsZXQgc2VhcmNoUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyhbCiAqICAgICBbJ3NvcnQnLCAnbmFtZSddLAogKiAgICAgWydzb3J0JywgJ3ByaWNlJ10KICogICBdKTsKICoKICogeW91IGNhbiBkbzoKICoKICogICBsZXQgc2VhcmNoUGFyYW1zID0gY3JlYXRlU2VhcmNoUGFyYW1zKHsKICogICAgIHNvcnQ6IFsnbmFtZScsICdwcmljZSddCiAqICAgfSk7CiAqLwoKZnVuY3Rpb24gY3JlYXRlU2VhcmNoUGFyYW1zKGluaXQpIHsKICBpZiAoaW5pdCA9PT0gdm9pZCAwKSB7CiAgICBpbml0ID0gIiI7CiAgfQoKICByZXR1cm4gbmV3IFVSTFNlYXJjaFBhcmFtcyh0eXBlb2YgaW5pdCA9PT0gInN0cmluZyIgfHwgQXJyYXkuaXNBcnJheShpbml0KSB8fCBpbml0IGluc3RhbmNlb2YgVVJMU2VhcmNoUGFyYW1zID8gaW5pdCA6IE9iamVjdC5rZXlzKGluaXQpLnJlZHVjZSgobWVtbywga2V5KSA9PiB7CiAgICBsZXQgdmFsdWUgPSBpbml0W2tleV07CiAgICByZXR1cm4gbWVtby5jb25jYXQoQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZS5tYXAodiA9PiBba2V5LCB2XSkgOiBbW2tleSwgdmFsdWVdXSk7CiAgfSwgW10pKTsKfQpmdW5jdGlvbiBnZXRTZWFyY2hQYXJhbXNGb3JMb2NhdGlvbihsb2NhdGlvblNlYXJjaCwgZGVmYXVsdFNlYXJjaFBhcmFtcykgewogIGxldCBzZWFyY2hQYXJhbXMgPSBjcmVhdGVTZWFyY2hQYXJhbXMobG9jYXRpb25TZWFyY2gpOwoKICBmb3IgKGxldCBrZXkgb2YgZGVmYXVsdFNlYXJjaFBhcmFtcy5rZXlzKCkpIHsKICAgIGlmICghc2VhcmNoUGFyYW1zLmhhcyhrZXkpKSB7CiAgICAgIGRlZmF1bHRTZWFyY2hQYXJhbXMuZ2V0QWxsKGtleSkuZm9yRWFjaCh2YWx1ZSA9PiB7CiAgICAgICAgc2VhcmNoUGFyYW1zLmFwcGVuZChrZXksIHZhbHVlKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gc2VhcmNoUGFyYW1zOwp9CmZ1bmN0aW9uIGdldEZvcm1TdWJtaXNzaW9uSW5mbyh0YXJnZXQsIGRlZmF1bHRBY3Rpb24sIG9wdGlvbnMpIHsKICBsZXQgbWV0aG9kOwogIGxldCBhY3Rpb247CiAgbGV0IGVuY1R5cGU7CiAgbGV0IGZvcm1EYXRhOwoKICBpZiAoaXNGb3JtRWxlbWVudCh0YXJnZXQpKSB7CiAgICBsZXQgc3VibWlzc2lvblRyaWdnZXIgPSBvcHRpb25zLnN1Ym1pc3Npb25UcmlnZ2VyOwogICAgbWV0aG9kID0gb3B0aW9ucy5tZXRob2QgfHwgdGFyZ2V0LmdldEF0dHJpYnV0ZSgibWV0aG9kIikgfHwgZGVmYXVsdE1ldGhvZDsKICAgIGFjdGlvbiA9IG9wdGlvbnMuYWN0aW9uIHx8IHRhcmdldC5nZXRBdHRyaWJ1dGUoImFjdGlvbiIpIHx8IGRlZmF1bHRBY3Rpb247CiAgICBlbmNUeXBlID0gb3B0aW9ucy5lbmNUeXBlIHx8IHRhcmdldC5nZXRBdHRyaWJ1dGUoImVuY3R5cGUiKSB8fCBkZWZhdWx0RW5jVHlwZTsKICAgIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKHRhcmdldCk7CgogICAgaWYgKHN1Ym1pc3Npb25UcmlnZ2VyICYmIHN1Ym1pc3Npb25UcmlnZ2VyLm5hbWUpIHsKICAgICAgZm9ybURhdGEuYXBwZW5kKHN1Ym1pc3Npb25UcmlnZ2VyLm5hbWUsIHN1Ym1pc3Npb25UcmlnZ2VyLnZhbHVlKTsKICAgIH0KICB9IGVsc2UgaWYgKGlzQnV0dG9uRWxlbWVudCh0YXJnZXQpIHx8IGlzSW5wdXRFbGVtZW50KHRhcmdldCkgJiYgKHRhcmdldC50eXBlID09PSAic3VibWl0IiB8fCB0YXJnZXQudHlwZSA9PT0gImltYWdlIikpIHsKICAgIGxldCBmb3JtID0gdGFyZ2V0LmZvcm07CgogICAgaWYgKGZvcm0gPT0gbnVsbCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBzdWJtaXQgYSA8YnV0dG9uPiBvciA8aW5wdXQgdHlwZT1cInN1Ym1pdFwiPiB3aXRob3V0IGEgPGZvcm0+Iik7CiAgICB9IC8vIDxidXR0b24+LzxpbnB1dCB0eXBlPSJzdWJtaXQiPiBtYXkgb3ZlcnJpZGUgYXR0cmlidXRlcyBvZiA8Zm9ybT4KCgogICAgbWV0aG9kID0gb3B0aW9ucy5tZXRob2QgfHwgdGFyZ2V0LmdldEF0dHJpYnV0ZSgiZm9ybW1ldGhvZCIpIHx8IGZvcm0uZ2V0QXR0cmlidXRlKCJtZXRob2QiKSB8fCBkZWZhdWx0TWV0aG9kOwogICAgYWN0aW9uID0gb3B0aW9ucy5hY3Rpb24gfHwgdGFyZ2V0LmdldEF0dHJpYnV0ZSgiZm9ybWFjdGlvbiIpIHx8IGZvcm0uZ2V0QXR0cmlidXRlKCJhY3Rpb24iKSB8fCBkZWZhdWx0QWN0aW9uOwogICAgZW5jVHlwZSA9IG9wdGlvbnMuZW5jVHlwZSB8fCB0YXJnZXQuZ2V0QXR0cmlidXRlKCJmb3JtZW5jdHlwZSIpIHx8IGZvcm0uZ2V0QXR0cmlidXRlKCJlbmN0eXBlIikgfHwgZGVmYXVsdEVuY1R5cGU7CiAgICBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YShmb3JtKTsgLy8gSW5jbHVkZSBuYW1lICsgdmFsdWUgZnJvbSBhIDxidXR0b24+LCBhcHBlbmRpbmcgaW4gY2FzZSB0aGUgYnV0dG9uIG5hbWUKICAgIC8vIG1hdGNoZXMgYW4gZXhpc3RpbmcgaW5wdXQgbmFtZQoKICAgIGlmICh0YXJnZXQubmFtZSkgewogICAgICBmb3JtRGF0YS5hcHBlbmQodGFyZ2V0Lm5hbWUsIHRhcmdldC52YWx1ZSk7CiAgICB9CiAgfSBlbHNlIGlmIChpc0h0bWxFbGVtZW50KHRhcmdldCkpIHsKICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IHN1Ym1pdCBlbGVtZW50IHRoYXQgaXMgbm90IDxmb3JtPiwgPGJ1dHRvbj4sIG9yICIgKyAiPGlucHV0IHR5cGU9XCJzdWJtaXR8aW1hZ2VcIj4iKTsKICB9IGVsc2UgewogICAgbWV0aG9kID0gb3B0aW9ucy5tZXRob2QgfHwgZGVmYXVsdE1ldGhvZDsKICAgIGFjdGlvbiA9IG9wdGlvbnMuYWN0aW9uIHx8IGRlZmF1bHRBY3Rpb247CiAgICBlbmNUeXBlID0gb3B0aW9ucy5lbmNUeXBlIHx8IGRlZmF1bHRFbmNUeXBlOwoKICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBGb3JtRGF0YSkgewogICAgICBmb3JtRGF0YSA9IHRhcmdldDsKICAgIH0gZWxzZSB7CiAgICAgIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7CgogICAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgVVJMU2VhcmNoUGFyYW1zKSB7CiAgICAgICAgZm9yIChsZXQgW25hbWUsIHZhbHVlXSBvZiB0YXJnZXQpIHsKICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChuYW1lLCB2YWx1ZSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHRhcmdldCAhPSBudWxsKSB7CiAgICAgICAgZm9yIChsZXQgbmFtZSBvZiBPYmplY3Qua2V5cyh0YXJnZXQpKSB7CiAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQobmFtZSwgdGFyZ2V0W25hbWVdKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIGxldCB7CiAgICBwcm90b2NvbCwKICAgIGhvc3QKICB9ID0gd2luZG93LmxvY2F0aW9uOwogIGxldCB1cmwgPSBuZXcgVVJMKGFjdGlvbiwgcHJvdG9jb2wgKyAiLy8iICsgaG9zdCk7CiAgcmV0dXJuIHsKICAgIHVybCwKICAgIG1ldGhvZCwKICAgIGVuY1R5cGUsCiAgICBmb3JtRGF0YQogIH07Cn0KCmNvbnN0IF9leGNsdWRlZCA9IFsib25DbGljayIsICJyZWxhdGl2ZSIsICJyZWxvYWREb2N1bWVudCIsICJyZXBsYWNlIiwgInN0YXRlIiwgInRhcmdldCIsICJ0byIsICJwcmV2ZW50U2Nyb2xsUmVzZXQiXSwKICAgICAgX2V4Y2x1ZGVkMiA9IFsiYXJpYS1jdXJyZW50IiwgImNhc2VTZW5zaXRpdmUiLCAiY2xhc3NOYW1lIiwgImVuZCIsICJzdHlsZSIsICJ0byIsICJjaGlsZHJlbiJdLAogICAgICBfZXhjbHVkZWQzID0gKC8qIHVudXNlZCBwdXJlIGV4cHJlc3Npb24gb3Igc3VwZXIgKi8gbnVsbCAmJiAoWyJyZWxvYWREb2N1bWVudCIsICJyZXBsYWNlIiwgIm1ldGhvZCIsICJhY3Rpb24iLCAib25TdWJtaXQiLCAiZmV0Y2hlcktleSIsICJyb3V0ZUlkIiwgInJlbGF0aXZlIl0pKTsKLy8jcmVnaW9uIFJvdXRlcnMKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCmZ1bmN0aW9uIGNyZWF0ZUJyb3dzZXJSb3V0ZXIocm91dGVzLCBvcHRzKSB7CiAgdmFyIF93aW5kb3c7CgogIHJldHVybiBjcmVhdGVSb3V0ZXIoewogICAgYmFzZW5hbWU6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMuYmFzZW5hbWUsCiAgICBoaXN0b3J5OiBjcmVhdGVCcm93c2VySGlzdG9yeSh7CiAgICAgIHdpbmRvdzogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy53aW5kb3cKICAgIH0pLAogICAgaHlkcmF0aW9uRGF0YTogKG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMuaHlkcmF0aW9uRGF0YSkgfHwgKChfd2luZG93ID0gd2luZG93KSA9PSBudWxsID8gdm9pZCAwIDogX3dpbmRvdy5fX3N0YXRpY1JvdXRlckh5ZHJhdGlvbkRhdGEpLAogICAgcm91dGVzOiBVTlNBRkVfZW5oYW5jZU1hbnVhbFJvdXRlT2JqZWN0cyhyb3V0ZXMpCiAgfSkuaW5pdGlhbGl6ZSgpOwp9CmZ1bmN0aW9uIGNyZWF0ZUhhc2hSb3V0ZXIocm91dGVzLCBvcHRzKSB7CiAgdmFyIF93aW5kb3cyOwoKICByZXR1cm4gY3JlYXRlUm91dGVyKHsKICAgIGJhc2VuYW1lOiBvcHRzID09IG51bGwgPyB2b2lkIDAgOiBvcHRzLmJhc2VuYW1lLAogICAgaGlzdG9yeTogY3JlYXRlSGFzaEhpc3RvcnkoewogICAgICB3aW5kb3c6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMud2luZG93CiAgICB9KSwKICAgIGh5ZHJhdGlvbkRhdGE6IChvcHRzID09IG51bGwgPyB2b2lkIDAgOiBvcHRzLmh5ZHJhdGlvbkRhdGEpIHx8ICgoX3dpbmRvdzIgPSB3aW5kb3cpID09IG51bGwgPyB2b2lkIDAgOiBfd2luZG93Mi5fX3N0YXRpY1JvdXRlckh5ZHJhdGlvbkRhdGEpLAogICAgcm91dGVzOiBVTlNBRkVfZW5oYW5jZU1hbnVhbFJvdXRlT2JqZWN0cyhyb3V0ZXMpCiAgfSkuaW5pdGlhbGl6ZSgpOwp9Ci8qKgogKiBBIGA8Um91dGVyPmAgZm9yIHVzZSBpbiB3ZWIgYnJvd3NlcnMuIFByb3ZpZGVzIHRoZSBjbGVhbmVzdCBVUkxzLgogKi8KCmZ1bmN0aW9uIEJyb3dzZXJSb3V0ZXIoX3JlZikgewogIGxldCB7CiAgICBiYXNlbmFtZSwKICAgIGNoaWxkcmVuLAogICAgd2luZG93CiAgfSA9IF9yZWY7CiAgbGV0IGhpc3RvcnlSZWYgPSBSZWFjdC51c2VSZWYoKTsKCiAgaWYgKGhpc3RvcnlSZWYuY3VycmVudCA9PSBudWxsKSB7CiAgICBoaXN0b3J5UmVmLmN1cnJlbnQgPSBjcmVhdGVCcm93c2VySGlzdG9yeSh7CiAgICAgIHdpbmRvdywKICAgICAgdjVDb21wYXQ6IHRydWUKICAgIH0pOwogIH0KCiAgbGV0IGhpc3RvcnkgPSBoaXN0b3J5UmVmLmN1cnJlbnQ7CiAgbGV0IFtzdGF0ZSwgc2V0U3RhdGVdID0gUmVhY3QudXNlU3RhdGUoewogICAgYWN0aW9uOiBoaXN0b3J5LmFjdGlvbiwKICAgIGxvY2F0aW9uOiBoaXN0b3J5LmxvY2F0aW9uCiAgfSk7CiAgUmVhY3QudXNlTGF5b3V0RWZmZWN0KCgpID0+IGhpc3RvcnkubGlzdGVuKHNldFN0YXRlKSwgW2hpc3RvcnldKTsKICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGVyLCB7CiAgICBiYXNlbmFtZTogYmFzZW5hbWUsCiAgICBjaGlsZHJlbjogY2hpbGRyZW4sCiAgICBsb2NhdGlvbjogc3RhdGUubG9jYXRpb24sCiAgICBuYXZpZ2F0aW9uVHlwZTogc3RhdGUuYWN0aW9uLAogICAgbmF2aWdhdG9yOiBoaXN0b3J5CiAgfSk7Cn0KLyoqCiAqIEEgYDxSb3V0ZXI+YCBmb3IgdXNlIGluIHdlYiBicm93c2Vycy4gU3RvcmVzIHRoZSBsb2NhdGlvbiBpbiB0aGUgaGFzaAogKiBwb3J0aW9uIG9mIHRoZSBVUkwgc28gaXQgaXMgbm90IHNlbnQgdG8gdGhlIHNlcnZlci4KICovCgpmdW5jdGlvbiBIYXNoUm91dGVyKF9yZWYyKSB7CiAgbGV0IHsKICAgIGJhc2VuYW1lLAogICAgY2hpbGRyZW4sCiAgICB3aW5kb3cKICB9ID0gX3JlZjI7CiAgbGV0IGhpc3RvcnlSZWYgPSBSZWFjdC51c2VSZWYoKTsKCiAgaWYgKGhpc3RvcnlSZWYuY3VycmVudCA9PSBudWxsKSB7CiAgICBoaXN0b3J5UmVmLmN1cnJlbnQgPSBjcmVhdGVIYXNoSGlzdG9yeSh7CiAgICAgIHdpbmRvdywKICAgICAgdjVDb21wYXQ6IHRydWUKICAgIH0pOwogIH0KCiAgbGV0IGhpc3RvcnkgPSBoaXN0b3J5UmVmLmN1cnJlbnQ7CiAgbGV0IFtzdGF0ZSwgc2V0U3RhdGVdID0gUmVhY3QudXNlU3RhdGUoewogICAgYWN0aW9uOiBoaXN0b3J5LmFjdGlvbiwKICAgIGxvY2F0aW9uOiBoaXN0b3J5LmxvY2F0aW9uCiAgfSk7CiAgUmVhY3QudXNlTGF5b3V0RWZmZWN0KCgpID0+IGhpc3RvcnkubGlzdGVuKHNldFN0YXRlKSwgW2hpc3RvcnldKTsKICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGVyLCB7CiAgICBiYXNlbmFtZTogYmFzZW5hbWUsCiAgICBjaGlsZHJlbjogY2hpbGRyZW4sCiAgICBsb2NhdGlvbjogc3RhdGUubG9jYXRpb24sCiAgICBuYXZpZ2F0aW9uVHlwZTogc3RhdGUuYWN0aW9uLAogICAgbmF2aWdhdG9yOiBoaXN0b3J5CiAgfSk7Cn0KLyoqCiAqIEEgYDxSb3V0ZXI+YCB0aGF0IGFjY2VwdHMgYSBwcmUtaW5zdGFudGlhdGVkIGhpc3Rvcnkgb2JqZWN0LiBJdCdzIGltcG9ydGFudAogKiB0byBub3RlIHRoYXQgdXNpbmcgeW91ciBvd24gaGlzdG9yeSBvYmplY3QgaXMgaGlnaGx5IGRpc2NvdXJhZ2VkIGFuZCBtYXkgYWRkCiAqIHR3byB2ZXJzaW9ucyBvZiB0aGUgaGlzdG9yeSBsaWJyYXJ5IHRvIHlvdXIgYnVuZGxlcyB1bmxlc3MgeW91IHVzZSB0aGUgc2FtZQogKiB2ZXJzaW9uIG9mIHRoZSBoaXN0b3J5IGxpYnJhcnkgdGhhdCBSZWFjdCBSb3V0ZXIgdXNlcyBpbnRlcm5hbGx5LgogKi8KCmZ1bmN0aW9uIEhpc3RvcnlSb3V0ZXIoX3JlZjMpIHsKICBsZXQgewogICAgYmFzZW5hbWUsCiAgICBjaGlsZHJlbiwKICAgIGhpc3RvcnkKICB9ID0gX3JlZjM7CiAgY29uc3QgW3N0YXRlLCBzZXRTdGF0ZV0gPSBSZWFjdC51c2VTdGF0ZSh7CiAgICBhY3Rpb246IGhpc3RvcnkuYWN0aW9uLAogICAgbG9jYXRpb246IGhpc3RvcnkubG9jYXRpb24KICB9KTsKICBSZWFjdC51c2VMYXlvdXRFZmZlY3QoKCkgPT4gaGlzdG9yeS5saXN0ZW4oc2V0U3RhdGUpLCBbaGlzdG9yeV0pOwogIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChSb3V0ZXIsIHsKICAgIGJhc2VuYW1lOiBiYXNlbmFtZSwKICAgIGNoaWxkcmVuOiBjaGlsZHJlbiwKICAgIGxvY2F0aW9uOiBzdGF0ZS5sb2NhdGlvbiwKICAgIG5hdmlnYXRpb25UeXBlOiBzdGF0ZS5hY3Rpb24sCiAgICBuYXZpZ2F0b3I6IGhpc3RvcnkKICB9KTsKfQoKaWYgKGZhbHNlKSB7fQovKioKICogVGhlIHB1YmxpYyBBUEkgZm9yIHJlbmRlcmluZyBhIGhpc3RvcnktYXdhcmUgPGE+LgogKi8KCmNvbnN0IExpbmsgPSAvKiNfX1BVUkVfXyovcmVhY3QuZm9yd2FyZFJlZihmdW5jdGlvbiBMaW5rV2l0aFJlZihfcmVmNCwgcmVmKSB7CiAgbGV0IHsKICAgIG9uQ2xpY2ssCiAgICByZWxhdGl2ZSwKICAgIHJlbG9hZERvY3VtZW50LAogICAgcmVwbGFjZSwKICAgIHN0YXRlLAogICAgdGFyZ2V0LAogICAgdG8sCiAgICBwcmV2ZW50U2Nyb2xsUmVzZXQKICB9ID0gX3JlZjQsCiAgICAgIHJlc3QgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShfcmVmNCwgX2V4Y2x1ZGVkKTsKCiAgbGV0IGhyZWYgPSB1c2VIcmVmKHRvLCB7CiAgICByZWxhdGl2ZQogIH0pOwogIGxldCBpbnRlcm5hbE9uQ2xpY2sgPSB1c2VMaW5rQ2xpY2tIYW5kbGVyKHRvLCB7CiAgICByZXBsYWNlLAogICAgc3RhdGUsCiAgICB0YXJnZXQsCiAgICBwcmV2ZW50U2Nyb2xsUmVzZXQsCiAgICByZWxhdGl2ZQogIH0pOwoKICBmdW5jdGlvbiBoYW5kbGVDbGljayhldmVudCkgewogICAgaWYgKG9uQ2xpY2spIG9uQ2xpY2soZXZlbnQpOwoKICAgIGlmICghZXZlbnQuZGVmYXVsdFByZXZlbnRlZCkgewogICAgICBpbnRlcm5hbE9uQ2xpY2soZXZlbnQpOwogICAgfQogIH0KCiAgcmV0dXJuICgKICAgIC8qI19fUFVSRV9fKi8KICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBqc3gtYTExeS9hbmNob3ItaGFzLWNvbnRlbnQKICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImEiLCByZWFjdF9yb3V0ZXJfZG9tX2Rpc3RfZXh0ZW5kcyh7fSwgcmVzdCwgewogICAgICBocmVmOiBocmVmLAogICAgICBvbkNsaWNrOiByZWxvYWREb2N1bWVudCA/IG9uQ2xpY2sgOiBoYW5kbGVDbGljaywKICAgICAgcmVmOiByZWYsCiAgICAgIHRhcmdldDogdGFyZ2V0CiAgICB9KSkKICApOwp9KTsKCmlmIChmYWxzZSkge30KLyoqCiAqIEEgPExpbms+IHdyYXBwZXIgdGhhdCBrbm93cyBpZiBpdCdzICJhY3RpdmUiIG9yIG5vdC4KICovCgoKY29uc3QgTmF2TGluayA9IC8qI19fUFVSRV9fKi9yZWFjdC5mb3J3YXJkUmVmKGZ1bmN0aW9uIE5hdkxpbmtXaXRoUmVmKF9yZWY1LCByZWYpIHsKICBsZXQgewogICAgImFyaWEtY3VycmVudCI6IGFyaWFDdXJyZW50UHJvcCA9ICJwYWdlIiwKICAgIGNhc2VTZW5zaXRpdmUgPSBmYWxzZSwKICAgIGNsYXNzTmFtZTogY2xhc3NOYW1lUHJvcCA9ICIiLAogICAgZW5kID0gZmFsc2UsCiAgICBzdHlsZTogc3R5bGVQcm9wLAogICAgdG8sCiAgICBjaGlsZHJlbgogIH0gPSBfcmVmNSwKICAgICAgcmVzdCA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKF9yZWY1LCBfZXhjbHVkZWQyKTsKCiAgbGV0IHBhdGggPSBkaXN0X3VzZVJlc29sdmVkUGF0aCh0bywgewogICAgcmVsYXRpdmU6IHJlc3QucmVsYXRpdmUKICB9KTsKICBsZXQgbG9jYXRpb24gPSBkaXN0X3VzZUxvY2F0aW9uKCk7CiAgbGV0IHJvdXRlclN0YXRlID0gcmVhY3QudXNlQ29udGV4dChEYXRhUm91dGVyU3RhdGVDb250ZXh0KTsKICBsZXQgdG9QYXRobmFtZSA9IHBhdGgucGF0aG5hbWU7CiAgbGV0IGxvY2F0aW9uUGF0aG5hbWUgPSBsb2NhdGlvbi5wYXRobmFtZTsKICBsZXQgbmV4dExvY2F0aW9uUGF0aG5hbWUgPSByb3V0ZXJTdGF0ZSAmJiByb3V0ZXJTdGF0ZS5uYXZpZ2F0aW9uICYmIHJvdXRlclN0YXRlLm5hdmlnYXRpb24ubG9jYXRpb24gPyByb3V0ZXJTdGF0ZS5uYXZpZ2F0aW9uLmxvY2F0aW9uLnBhdGhuYW1lIDogbnVsbDsKCiAgaWYgKCFjYXNlU2Vuc2l0aXZlKSB7CiAgICBsb2NhdGlvblBhdGhuYW1lID0gbG9jYXRpb25QYXRobmFtZS50b0xvd2VyQ2FzZSgpOwogICAgbmV4dExvY2F0aW9uUGF0aG5hbWUgPSBuZXh0TG9jYXRpb25QYXRobmFtZSA/IG5leHRMb2NhdGlvblBhdGhuYW1lLnRvTG93ZXJDYXNlKCkgOiBudWxsOwogICAgdG9QYXRobmFtZSA9IHRvUGF0aG5hbWUudG9Mb3dlckNhc2UoKTsKICB9CgogIGxldCBpc0FjdGl2ZSA9IGxvY2F0aW9uUGF0aG5hbWUgPT09IHRvUGF0aG5hbWUgfHwgIWVuZCAmJiBsb2NhdGlvblBhdGhuYW1lLnN0YXJ0c1dpdGgodG9QYXRobmFtZSkgJiYgbG9jYXRpb25QYXRobmFtZS5jaGFyQXQodG9QYXRobmFtZS5sZW5ndGgpID09PSAiLyI7CiAgbGV0IGlzUGVuZGluZyA9IG5leHRMb2NhdGlvblBhdGhuYW1lICE9IG51bGwgJiYgKG5leHRMb2NhdGlvblBhdGhuYW1lID09PSB0b1BhdGhuYW1lIHx8ICFlbmQgJiYgbmV4dExvY2F0aW9uUGF0aG5hbWUuc3RhcnRzV2l0aCh0b1BhdGhuYW1lKSAmJiBuZXh0TG9jYXRpb25QYXRobmFtZS5jaGFyQXQodG9QYXRobmFtZS5sZW5ndGgpID09PSAiLyIpOwogIGxldCBhcmlhQ3VycmVudCA9IGlzQWN0aXZlID8gYXJpYUN1cnJlbnRQcm9wIDogdW5kZWZpbmVkOwogIGxldCBjbGFzc05hbWU7CgogIGlmICh0eXBlb2YgY2xhc3NOYW1lUHJvcCA9PT0gImZ1bmN0aW9uIikgewogICAgY2xhc3NOYW1lID0gY2xhc3NOYW1lUHJvcCh7CiAgICAgIGlzQWN0aXZlLAogICAgICBpc1BlbmRpbmcKICAgIH0pOwogIH0gZWxzZSB7CiAgICAvLyBJZiB0aGUgY2xhc3NOYW1lIHByb3AgaXMgbm90IGEgZnVuY3Rpb24sIHdlIHVzZSBhIGRlZmF1bHQgYGFjdGl2ZWAKICAgIC8vIGNsYXNzIGZvciA8TmF2TGluayAvPnMgdGhhdCBhcmUgYWN0aXZlLiBJbiB2NSBgYWN0aXZlYCB3YXMgdGhlIGRlZmF1bHQKICAgIC8vIHZhbHVlIGZvciBgYWN0aXZlQ2xhc3NOYW1lYCwgYnV0IHdlIGFyZSByZW1vdmluZyB0aGF0IEFQSSBhbmQgY2FuIHN0aWxsCiAgICAvLyB1c2UgdGhlIG9sZCBkZWZhdWx0IGJlaGF2aW9yIGZvciBhIGNsZWFuZXIgdXBncmFkZSBwYXRoIGFuZCBrZWVwIHRoZQogICAgLy8gc2ltcGxlIHN0eWxpbmcgcnVsZXMgd29ya2luZyBhcyB0aGV5IGN1cnJlbnRseSBkby4KICAgIGNsYXNzTmFtZSA9IFtjbGFzc05hbWVQcm9wLCBpc0FjdGl2ZSA/ICJhY3RpdmUiIDogbnVsbCwgaXNQZW5kaW5nID8gInBlbmRpbmciIDogbnVsbF0uZmlsdGVyKEJvb2xlYW4pLmpvaW4oIiAiKTsKICB9CgogIGxldCBzdHlsZSA9IHR5cGVvZiBzdHlsZVByb3AgPT09ICJmdW5jdGlvbiIgPyBzdHlsZVByb3AoewogICAgaXNBY3RpdmUsCiAgICBpc1BlbmRpbmcKICB9KSA6IHN0eWxlUHJvcDsKICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoTGluaywgcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMoe30sIHJlc3QsIHsKICAgICJhcmlhLWN1cnJlbnQiOiBhcmlhQ3VycmVudCwKICAgIGNsYXNzTmFtZTogY2xhc3NOYW1lLAogICAgcmVmOiByZWYsCiAgICBzdHlsZTogc3R5bGUsCiAgICB0bzogdG8KICB9KSwgdHlwZW9mIGNoaWxkcmVuID09PSAiZnVuY3Rpb24iID8gY2hpbGRyZW4oewogICAgaXNBY3RpdmUsCiAgICBpc1BlbmRpbmcKICB9KSA6IGNoaWxkcmVuKTsKfSk7CgppZiAoZmFsc2UpIHt9Ci8qKgogKiBBIGBAcmVtaXgtcnVuL3JvdXRlcmAtYXdhcmUgYDxmb3JtPmAuIEl0IGJlaGF2ZXMgbGlrZSBhIG5vcm1hbCBmb3JtIGV4Y2VwdAogKiB0aGF0IHRoZSBpbnRlcmFjdGlvbiB3aXRoIHRoZSBzZXJ2ZXIgaXMgd2l0aCBgZmV0Y2hgIGluc3RlYWQgb2YgbmV3IGRvY3VtZW50CiAqIHJlcXVlc3RzLCBhbGxvd2luZyBjb21wb25lbnRzIHRvIGFkZCBuaWNlciBVWCB0byB0aGUgcGFnZSBhcyB0aGUgZm9ybSBpcwogKiBzdWJtaXR0ZWQgYW5kIHJldHVybnMgd2l0aCBkYXRhLgogKi8KCgpjb25zdCBGb3JtID0gLyojX19QVVJFX18qLygvKiB1bnVzZWQgcHVyZSBleHByZXNzaW9uIG9yIHN1cGVyICovIG51bGwgJiYgKFJlYWN0LmZvcndhcmRSZWYoKHByb3BzLCByZWYpID0+IHsKICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoRm9ybUltcGwsIHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzKHt9LCBwcm9wcywgewogICAgcmVmOiByZWYKICB9KSk7Cn0pKSk7CgppZiAoZmFsc2UpIHt9Cgpjb25zdCBGb3JtSW1wbCA9IC8qI19fUFVSRV9fKi8oLyogdW51c2VkIHB1cmUgZXhwcmVzc2lvbiBvciBzdXBlciAqLyBudWxsICYmIChSZWFjdC5mb3J3YXJkUmVmKChfcmVmNiwgZm9yd2FyZGVkUmVmKSA9PiB7CiAgbGV0IHsKICAgIHJlbG9hZERvY3VtZW50LAogICAgcmVwbGFjZSwKICAgIG1ldGhvZCA9IGRlZmF1bHRNZXRob2QsCiAgICBhY3Rpb24sCiAgICBvblN1Ym1pdCwKICAgIGZldGNoZXJLZXksCiAgICByb3V0ZUlkLAogICAgcmVsYXRpdmUKICB9ID0gX3JlZjYsCiAgICAgIHByb3BzID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UoX3JlZjYsIF9leGNsdWRlZDMpOwoKICBsZXQgc3VibWl0ID0gdXNlU3VibWl0SW1wbChmZXRjaGVyS2V5LCByb3V0ZUlkKTsKICBsZXQgZm9ybU1ldGhvZCA9IG1ldGhvZC50b0xvd2VyQ2FzZSgpID09PSAiZ2V0IiA/ICJnZXQiIDogInBvc3QiOwogIGxldCBmb3JtQWN0aW9uID0gdXNlRm9ybUFjdGlvbihhY3Rpb24sIHsKICAgIHJlbGF0aXZlCiAgfSk7CgogIGxldCBzdWJtaXRIYW5kbGVyID0gZXZlbnQgPT4gewogICAgb25TdWJtaXQgJiYgb25TdWJtaXQoZXZlbnQpOwogICAgaWYgKGV2ZW50LmRlZmF1bHRQcmV2ZW50ZWQpIHJldHVybjsKICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICBsZXQgc3VibWl0dGVyID0gZXZlbnQubmF0aXZlRXZlbnQuc3VibWl0dGVyOwogICAgc3VibWl0KHN1Ym1pdHRlciB8fCBldmVudC5jdXJyZW50VGFyZ2V0LCB7CiAgICAgIG1ldGhvZCwKICAgICAgcmVwbGFjZSwKICAgICAgcmVsYXRpdmUKICAgIH0pOwogIH07CgogIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZm9ybSIsIHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzKHsKICAgIHJlZjogZm9yd2FyZGVkUmVmLAogICAgbWV0aG9kOiBmb3JtTWV0aG9kLAogICAgYWN0aW9uOiBmb3JtQWN0aW9uLAogICAgb25TdWJtaXQ6IHJlbG9hZERvY3VtZW50ID8gb25TdWJtaXQgOiBzdWJtaXRIYW5kbGVyCiAgfSwgcHJvcHMpKTsKfSkpKTsKCmlmIChmYWxzZSkge30KLyoqCiAqIFRoaXMgY29tcG9uZW50IHdpbGwgZW11bGF0ZSB0aGUgYnJvd3NlcidzIHNjcm9sbCByZXN0b3JhdGlvbiBvbiBsb2NhdGlvbgogKiBjaGFuZ2VzLgogKi8KCgpmdW5jdGlvbiBTY3JvbGxSZXN0b3JhdGlvbihfcmVmNykgewogIGxldCB7CiAgICBnZXRLZXksCiAgICBzdG9yYWdlS2V5CiAgfSA9IF9yZWY3OwogIHVzZVNjcm9sbFJlc3RvcmF0aW9uKHsKICAgIGdldEtleSwKICAgIHN0b3JhZ2VLZXkKICB9KTsKICByZXR1cm4gbnVsbDsKfQoKaWYgKGZhbHNlKSB7fSAvLyNlbmRyZWdpb24KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8jcmVnaW9uIEhvb2tzCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgoKdmFyIGRpc3RfRGF0YVJvdXRlckhvb2s7CgooZnVuY3Rpb24gKERhdGFSb3V0ZXJIb29rKSB7CiAgRGF0YVJvdXRlckhvb2tbIlVzZVNjcm9sbFJlc3RvcmF0aW9uIl0gPSAidXNlU2Nyb2xsUmVzdG9yYXRpb24iOwogIERhdGFSb3V0ZXJIb29rWyJVc2VTdWJtaXRJbXBsIl0gPSAidXNlU3VibWl0SW1wbCI7CiAgRGF0YVJvdXRlckhvb2tbIlVzZUZldGNoZXIiXSA9ICJ1c2VGZXRjaGVyIjsKfSkoZGlzdF9EYXRhUm91dGVySG9vayB8fCAoZGlzdF9EYXRhUm91dGVySG9vayA9IHt9KSk7Cgp2YXIgZGlzdF9EYXRhUm91dGVyU3RhdGVIb29rOwoKKGZ1bmN0aW9uIChEYXRhUm91dGVyU3RhdGVIb29rKSB7CiAgRGF0YVJvdXRlclN0YXRlSG9va1siVXNlRmV0Y2hlcnMiXSA9ICJ1c2VGZXRjaGVycyI7CiAgRGF0YVJvdXRlclN0YXRlSG9va1siVXNlU2Nyb2xsUmVzdG9yYXRpb24iXSA9ICJ1c2VTY3JvbGxSZXN0b3JhdGlvbiI7Cn0pKGRpc3RfRGF0YVJvdXRlclN0YXRlSG9vayB8fCAoZGlzdF9EYXRhUm91dGVyU3RhdGVIb29rID0ge30pKTsKCmZ1bmN0aW9uIGRpc3RfZ2V0RGF0YVJvdXRlckNvbnNvbGVFcnJvcihob29rTmFtZSkgewogIHJldHVybiBob29rTmFtZSArICIgbXVzdCBiZSB1c2VkIHdpdGhpbiBhIGRhdGEgcm91dGVyLiAgU2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2VuL21haW4vcm91dGVycy9waWNraW5nLWEtcm91dGVyLiI7Cn0KCmZ1bmN0aW9uIGRpc3RfdXNlRGF0YVJvdXRlckNvbnRleHQoaG9va05hbWUpIHsKICBsZXQgY3R4ID0gUmVhY3QudXNlQ29udGV4dChVTlNBRkVfRGF0YVJvdXRlckNvbnRleHQpOwogICFjdHggPyAgZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICByZXR1cm4gY3R4Owp9CgpmdW5jdGlvbiBkaXN0X3VzZURhdGFSb3V0ZXJTdGF0ZShob29rTmFtZSkgewogIGxldCBzdGF0ZSA9IFJlYWN0LnVzZUNvbnRleHQoVU5TQUZFX0RhdGFSb3V0ZXJTdGF0ZUNvbnRleHQpOwogICFzdGF0ZSA/ICBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogIHJldHVybiBzdGF0ZTsKfQovKioKICogSGFuZGxlcyB0aGUgY2xpY2sgYmVoYXZpb3IgZm9yIHJvdXRlciBgPExpbms+YCBjb21wb25lbnRzLiBUaGlzIGlzIHVzZWZ1bCBpZgogKiB5b3UgbmVlZCB0byBjcmVhdGUgY3VzdG9tIGA8TGluaz5gIGNvbXBvbmVudHMgd2l0aCB0aGUgc2FtZSBjbGljayBiZWhhdmlvciB3ZQogKiB1c2UgaW4gb3VyIGV4cG9ydGVkIGA8TGluaz5gLgogKi8KCgpmdW5jdGlvbiB1c2VMaW5rQ2xpY2tIYW5kbGVyKHRvLCBfdGVtcCkgewogIGxldCB7CiAgICB0YXJnZXQsCiAgICByZXBsYWNlOiByZXBsYWNlUHJvcCwKICAgIHN0YXRlLAogICAgcHJldmVudFNjcm9sbFJlc2V0LAogICAgcmVsYXRpdmUKICB9ID0gX3RlbXAgPT09IHZvaWQgMCA/IHt9IDogX3RlbXA7CiAgbGV0IG5hdmlnYXRlID0gZGlzdF91c2VOYXZpZ2F0ZSgpOwogIGxldCBsb2NhdGlvbiA9IGRpc3RfdXNlTG9jYXRpb24oKTsKICBsZXQgcGF0aCA9IGRpc3RfdXNlUmVzb2x2ZWRQYXRoKHRvLCB7CiAgICByZWxhdGl2ZQogIH0pOwogIHJldHVybiByZWFjdC51c2VDYWxsYmFjayhldmVudCA9PiB7CiAgICBpZiAoc2hvdWxkUHJvY2Vzc0xpbmtDbGljayhldmVudCwgdGFyZ2V0KSkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyAvLyBJZiB0aGUgVVJMIGhhc24ndCBjaGFuZ2VkLCBhIHJlZ3VsYXIgPGE+IHdpbGwgZG8gYSByZXBsYWNlIGluc3RlYWQgb2YKICAgICAgLy8gYSBwdXNoLCBzbyBkbyB0aGUgc2FtZSBoZXJlIHVubGVzcyB0aGUgcmVwbGFjZSBwcm9wIGlzIGV4cGxpY2l0bHkgc2V0CgogICAgICBsZXQgcmVwbGFjZSA9IHJlcGxhY2VQcm9wICE9PSB1bmRlZmluZWQgPyByZXBsYWNlUHJvcCA6IHJvdXRlcl9jcmVhdGVQYXRoKGxvY2F0aW9uKSA9PT0gcm91dGVyX2NyZWF0ZVBhdGgocGF0aCk7CiAgICAgIG5hdmlnYXRlKHRvLCB7CiAgICAgICAgcmVwbGFjZSwKICAgICAgICBzdGF0ZSwKICAgICAgICBwcmV2ZW50U2Nyb2xsUmVzZXQsCiAgICAgICAgcmVsYXRpdmUKICAgICAgfSk7CiAgICB9CiAgfSwgW2xvY2F0aW9uLCBuYXZpZ2F0ZSwgcGF0aCwgcmVwbGFjZVByb3AsIHN0YXRlLCB0YXJnZXQsIHRvLCBwcmV2ZW50U2Nyb2xsUmVzZXQsIHJlbGF0aXZlXSk7Cn0KLyoqCiAqIEEgY29udmVuaWVudCB3cmFwcGVyIGZvciByZWFkaW5nIGFuZCB3cml0aW5nIHNlYXJjaCBwYXJhbWV0ZXJzIHZpYSB0aGUKICogVVJMU2VhcmNoUGFyYW1zIGludGVyZmFjZS4KICovCgpmdW5jdGlvbiB1c2VTZWFyY2hQYXJhbXMoZGVmYXVsdEluaXQpIHsKICAgZmFsc2UgPyAwIDogdm9pZCAwOwogIGxldCBkZWZhdWx0U2VhcmNoUGFyYW1zUmVmID0gUmVhY3QudXNlUmVmKGNyZWF0ZVNlYXJjaFBhcmFtcyhkZWZhdWx0SW5pdCkpOwogIGxldCBsb2NhdGlvbiA9IHVzZUxvY2F0aW9uKCk7CiAgbGV0IHNlYXJjaFBhcmFtcyA9IFJlYWN0LnVzZU1lbW8oKCkgPT4gZ2V0U2VhcmNoUGFyYW1zRm9yTG9jYXRpb24obG9jYXRpb24uc2VhcmNoLCBkZWZhdWx0U2VhcmNoUGFyYW1zUmVmLmN1cnJlbnQpLCBbbG9jYXRpb24uc2VhcmNoXSk7CiAgbGV0IG5hdmlnYXRlID0gdXNlTmF2aWdhdGUoKTsKICBsZXQgc2V0U2VhcmNoUGFyYW1zID0gUmVhY3QudXNlQ2FsbGJhY2soKG5leHRJbml0LCBuYXZpZ2F0ZU9wdGlvbnMpID0+IHsKICAgIGNvbnN0IG5ld1NlYXJjaFBhcmFtcyA9IGNyZWF0ZVNlYXJjaFBhcmFtcyh0eXBlb2YgbmV4dEluaXQgPT09ICJmdW5jdGlvbiIgPyBuZXh0SW5pdChzZWFyY2hQYXJhbXMpIDogbmV4dEluaXQpOwogICAgbmF2aWdhdGUoIj8iICsgbmV3U2VhcmNoUGFyYW1zLCBuYXZpZ2F0ZU9wdGlvbnMpOwogIH0sIFtuYXZpZ2F0ZSwgc2VhcmNoUGFyYW1zXSk7CiAgcmV0dXJuIFtzZWFyY2hQYXJhbXMsIHNldFNlYXJjaFBhcmFtc107Cn0KLyoqCiAqIFJldHVybnMgYSBmdW5jdGlvbiB0aGF0IG1heSBiZSB1c2VkIHRvIHByb2dyYW1tYXRpY2FsbHkgc3VibWl0IGEgZm9ybSAob3IKICogc29tZSBhcmJpdHJhcnkgZGF0YSkgdG8gdGhlIHNlcnZlci4KICovCgpmdW5jdGlvbiB1c2VTdWJtaXQoKSB7CiAgcmV0dXJuIHVzZVN1Ym1pdEltcGwoKTsKfQoKZnVuY3Rpb24gdXNlU3VibWl0SW1wbChmZXRjaGVyS2V5LCByb3V0ZUlkKSB7CiAgbGV0IHsKICAgIHJvdXRlcgogIH0gPSBkaXN0X3VzZURhdGFSb3V0ZXJDb250ZXh0KGRpc3RfRGF0YVJvdXRlckhvb2suVXNlU3VibWl0SW1wbCk7CiAgbGV0IGRlZmF1bHRBY3Rpb24gPSB1c2VGb3JtQWN0aW9uKCk7CiAgcmV0dXJuIFJlYWN0LnVzZUNhbGxiYWNrKGZ1bmN0aW9uICh0YXJnZXQsIG9wdGlvbnMpIHsKICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgb3B0aW9ucyA9IHt9OwogICAgfQoKICAgIGlmICh0eXBlb2YgZG9jdW1lbnQgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiWW91IGFyZSBjYWxsaW5nIHN1Ym1pdCBkdXJpbmcgdGhlIHNlcnZlciByZW5kZXIuICIgKyAiVHJ5IGNhbGxpbmcgc3VibWl0IHdpdGhpbiBhIGB1c2VFZmZlY3RgIG9yIGNhbGxiYWNrIGluc3RlYWQuIik7CiAgICB9CgogICAgbGV0IHsKICAgICAgbWV0aG9kLAogICAgICBlbmNUeXBlLAogICAgICBmb3JtRGF0YSwKICAgICAgdXJsCiAgICB9ID0gZ2V0Rm9ybVN1Ym1pc3Npb25JbmZvKHRhcmdldCwgZGVmYXVsdEFjdGlvbiwgb3B0aW9ucyk7CiAgICBsZXQgaHJlZiA9IHVybC5wYXRobmFtZSArIHVybC5zZWFyY2g7CiAgICBsZXQgb3B0cyA9IHsKICAgICAgcmVwbGFjZTogb3B0aW9ucy5yZXBsYWNlLAogICAgICBmb3JtRGF0YSwKICAgICAgZm9ybU1ldGhvZDogbWV0aG9kLAogICAgICBmb3JtRW5jVHlwZTogZW5jVHlwZQogICAgfTsKCiAgICBpZiAoZmV0Y2hlcktleSkgewogICAgICAhKHJvdXRlSWQgIT0gbnVsbCkgPyAgZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgcm91dGVyLmZldGNoKGZldGNoZXJLZXksIHJvdXRlSWQsIGhyZWYsIG9wdHMpOwogICAgfSBlbHNlIHsKICAgICAgcm91dGVyLm5hdmlnYXRlKGhyZWYsIG9wdHMpOwogICAgfQogIH0sIFtkZWZhdWx0QWN0aW9uLCByb3V0ZXIsIGZldGNoZXJLZXksIHJvdXRlSWRdKTsKfQoKZnVuY3Rpb24gdXNlRm9ybUFjdGlvbihhY3Rpb24sIF90ZW1wMikgewogIGxldCB7CiAgICByZWxhdGl2ZQogIH0gPSBfdGVtcDIgPT09IHZvaWQgMCA/IHt9IDogX3RlbXAyOwogIGxldCB7CiAgICBiYXNlbmFtZQogIH0gPSBSZWFjdC51c2VDb250ZXh0KFVOU0FGRV9OYXZpZ2F0aW9uQ29udGV4dCk7CiAgbGV0IHJvdXRlQ29udGV4dCA9IFJlYWN0LnVzZUNvbnRleHQoVU5TQUZFX1JvdXRlQ29udGV4dCk7CiAgIXJvdXRlQ29udGV4dCA/ICBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogIGxldCBbbWF0Y2hdID0gcm91dGVDb250ZXh0Lm1hdGNoZXMuc2xpY2UoLTEpOwogIGxldCByZXNvbHZlZEFjdGlvbiA9IGFjdGlvbiAhPSBudWxsID8gYWN0aW9uIDogIi4iOyAvLyBTaGFsbG93IGNsb25lIHBhdGggc28gd2UgY2FuIG1vZGlmeSBpdCBiZWxvdywgb3RoZXJ3aXNlIHdlIG1vZGlmeSB0aGUKICAvLyBvYmplY3QgcmVmZXJlbmNlZCBieSB1c2VNZW1vIGluc2lkZSB1c2VSZXNvbHZlZFBhdGgKCiAgbGV0IHBhdGggPSByZWFjdF9yb3V0ZXJfZG9tX2Rpc3RfZXh0ZW5kcyh7fSwgdXNlUmVzb2x2ZWRQYXRoKHJlc29sdmVkQWN0aW9uLCB7CiAgICByZWxhdGl2ZQogIH0pKTsgLy8gUHJldmlvdXNseSB3ZSBzZXQgdGhlIGRlZmF1bHQgYWN0aW9uIHRvICIuIi4gVGhlIHByb2JsZW0gd2l0aCB0aGlzIGlzIHRoYXQKICAvLyBgdXNlUmVzb2x2ZWRQYXRoKCIuIilgIGV4Y2x1ZGVzIHNlYXJjaCBwYXJhbXMgYW5kIHRoZSBoYXNoIG9mIHRoZSByZXNvbHZlZAogIC8vIFVSTC4gVGhpcyBpcyB0aGUgaW50ZW5kZWQgYmVoYXZpb3Igb2Ygd2hlbiAiLiIgaXMgc3BlY2lmaWNhbGx5IHByb3ZpZGVkIGFzCiAgLy8gdGhlIGZvcm0gYWN0aW9uLCBidXQgaW5jb25zaXN0ZW50IHcvIGJyb3dzZXJzIHdoZW4gdGhlIGFjdGlvbiBpcyBvbWl0dGVkLgogIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9yZW1peC1ydW4vcmVtaXgvaXNzdWVzLzkyNwoKCiAgbGV0IGxvY2F0aW9uID0gdXNlTG9jYXRpb24oKTsKCiAgaWYgKGFjdGlvbiA9PSBudWxsKSB7CiAgICAvLyBTYWZlIHRvIHdyaXRlIHRvIHRoZXNlIGRpcmVjdGx5IGhlcmUgc2luY2UgaWYgYWN0aW9uIHdhcyB1bmRlZmluZWQsIHdlCiAgICAvLyB3b3VsZCBoYXZlIGNhbGxlZCB1c2VSZXNvbHZlZFBhdGgoIi4iKSB3aGljaCB3aWxsIG5ldmVyIGluY2x1ZGUgYSBzZWFyY2gKICAgIC8vIG9yIGhhc2gKICAgIHBhdGguc2VhcmNoID0gbG9jYXRpb24uc2VhcmNoOwogICAgcGF0aC5oYXNoID0gbG9jYXRpb24uaGFzaDsgLy8gV2hlbiBncmFiYmluZyBzZWFyY2ggcGFyYW1zIGZyb20gdGhlIFVSTCwgcmVtb3ZlIHRoZSBhdXRvbWF0aWNhbGx5CiAgICAvLyBpbnNlcnRlZCA/aW5kZXggcGFyYW0gc28gd2UgbWF0Y2ggdGhlIHVzZVJlc29sdmVkUGF0aCBzZWFyY2ggYmVoYXZpb3IKICAgIC8vIHdoaWNoIHdvdWxkIG5vdCBpbmNsdWRlID9pbmRleAoKICAgIGlmIChtYXRjaC5yb3V0ZS5pbmRleCkgewogICAgICBsZXQgcGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyhwYXRoLnNlYXJjaCk7CiAgICAgIHBhcmFtcy5kZWxldGUoImluZGV4Iik7CiAgICAgIHBhdGguc2VhcmNoID0gcGFyYW1zLnRvU3RyaW5nKCkgPyAiPyIgKyBwYXJhbXMudG9TdHJpbmcoKSA6ICIiOwogICAgfQogIH0KCiAgaWYgKCghYWN0aW9uIHx8IGFjdGlvbiA9PT0gIi4iKSAmJiBtYXRjaC5yb3V0ZS5pbmRleCkgewogICAgcGF0aC5zZWFyY2ggPSBwYXRoLnNlYXJjaCA/IHBhdGguc2VhcmNoLnJlcGxhY2UoL15cPy8sICI/aW5kZXgmIikgOiAiP2luZGV4IjsKICB9IC8vIElmIHdlJ3JlIG9wZXJhdGluZyB3aXRoaW4gYSBiYXNlbmFtZSwgcHJlcGVuZCBpdCB0byB0aGUgcGF0aG5hbWUgcHJpb3IKICAvLyB0byBjcmVhdGluZyB0aGUgZm9ybSBhY3Rpb24uICBJZiB0aGlzIGlzIGEgcm9vdCBuYXZpZ2F0aW9uLCB0aGVuIGp1c3QgdXNlCiAgLy8gdGhlIHJhdyBiYXNlbmFtZSB3aGljaCBhbGxvd3MgdGhlIGJhc2VuYW1lIHRvIGhhdmUgZnVsbCBjb250cm9sIG92ZXIgdGhlCiAgLy8gcHJlc2VuY2Ugb2YgYSB0cmFpbGluZyBzbGFzaCBvbiByb290IGFjdGlvbnMKCgogIGlmIChiYXNlbmFtZSAhPT0gIi8iKSB7CiAgICBwYXRoLnBhdGhuYW1lID0gcGF0aC5wYXRobmFtZSA9PT0gIi8iID8gYmFzZW5hbWUgOiBqb2luUGF0aHMoW2Jhc2VuYW1lLCBwYXRoLnBhdGhuYW1lXSk7CiAgfQoKICByZXR1cm4gY3JlYXRlUGF0aChwYXRoKTsKfQoKZnVuY3Rpb24gY3JlYXRlRmV0Y2hlckZvcm0oZmV0Y2hlcktleSwgcm91dGVJZCkgewogIGxldCBGZXRjaGVyRm9ybSA9IC8qI19fUFVSRV9fKi9SZWFjdC5mb3J3YXJkUmVmKChwcm9wcywgcmVmKSA9PiB7CiAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoRm9ybUltcGwsIHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzKHt9LCBwcm9wcywgewogICAgICByZWY6IHJlZiwKICAgICAgZmV0Y2hlcktleTogZmV0Y2hlcktleSwKICAgICAgcm91dGVJZDogcm91dGVJZAogICAgfSkpOwogIH0pOwoKICBpZiAoZmFsc2UpIHt9CgogIHJldHVybiBGZXRjaGVyRm9ybTsKfQoKbGV0IGZldGNoZXJJZCA9IDA7Ci8qKgogKiBJbnRlcmFjdHMgd2l0aCByb3V0ZSBsb2FkZXJzIGFuZCBhY3Rpb25zIHdpdGhvdXQgY2F1c2luZyBhIG5hdmlnYXRpb24uIEdyZWF0CiAqIGZvciBhbnkgaW50ZXJhY3Rpb24gdGhhdCBzdGF5cyBvbiB0aGUgc2FtZSBwYWdlLgogKi8KCmZ1bmN0aW9uIHVzZUZldGNoZXIoKSB7CiAgdmFyIF9yb3V0ZSRtYXRjaGVzOwoKICBsZXQgewogICAgcm91dGVyCiAgfSA9IGRpc3RfdXNlRGF0YVJvdXRlckNvbnRleHQoZGlzdF9EYXRhUm91dGVySG9vay5Vc2VGZXRjaGVyKTsKICBsZXQgcm91dGUgPSBSZWFjdC51c2VDb250ZXh0KFVOU0FGRV9Sb3V0ZUNvbnRleHQpOwogICFyb3V0ZSA/ICBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogIGxldCByb3V0ZUlkID0gKF9yb3V0ZSRtYXRjaGVzID0gcm91dGUubWF0Y2hlc1tyb3V0ZS5tYXRjaGVzLmxlbmd0aCAtIDFdKSA9PSBudWxsID8gdm9pZCAwIDogX3JvdXRlJG1hdGNoZXMucm91dGUuaWQ7CiAgIShyb3V0ZUlkICE9IG51bGwpID8gIGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgbGV0IFtmZXRjaGVyS2V5XSA9IFJlYWN0LnVzZVN0YXRlKCgpID0+IFN0cmluZygrK2ZldGNoZXJJZCkpOwogIGxldCBbRm9ybV0gPSBSZWFjdC51c2VTdGF0ZSgoKSA9PiB7CiAgICAhcm91dGVJZCA/ICBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgcmV0dXJuIGNyZWF0ZUZldGNoZXJGb3JtKGZldGNoZXJLZXksIHJvdXRlSWQpOwogIH0pOwogIGxldCBbbG9hZF0gPSBSZWFjdC51c2VTdGF0ZSgoKSA9PiBocmVmID0+IHsKICAgICFyb3V0ZXIgPyAgZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICFyb3V0ZUlkID8gIGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICByb3V0ZXIuZmV0Y2goZmV0Y2hlcktleSwgcm91dGVJZCwgaHJlZik7CiAgfSk7CiAgbGV0IHN1Ym1pdCA9IHVzZVN1Ym1pdEltcGwoZmV0Y2hlcktleSwgcm91dGVJZCk7CiAgbGV0IGZldGNoZXIgPSByb3V0ZXIuZ2V0RmV0Y2hlcihmZXRjaGVyS2V5KTsKICBsZXQgZmV0Y2hlcldpdGhDb21wb25lbnRzID0gUmVhY3QudXNlTWVtbygoKSA9PiByZWFjdF9yb3V0ZXJfZG9tX2Rpc3RfZXh0ZW5kcyh7CiAgICBGb3JtLAogICAgc3VibWl0LAogICAgbG9hZAogIH0sIGZldGNoZXIpLCBbZmV0Y2hlciwgRm9ybSwgc3VibWl0LCBsb2FkXSk7CiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHsKICAgIC8vIElzIHRoaXMgYnVzdGVkIHdoZW4gdGhlIFJlYWN0IHRlYW0gZ2V0cyByZWFsIHdlaXJkIGFuZCBjYWxscyBlZmZlY3RzCiAgICAvLyB0d2ljZSBvbiBtb3VudD8gIFdlIHJlYWxseSBqdXN0IG5lZWQgdG8gZ2FyYmFnZSBjb2xsZWN0IGhlcmUgd2hlbiB0aGlzCiAgICAvLyBmZXRjaGVyIGlzIG5vIGxvbmdlciBhcm91bmQuCiAgICByZXR1cm4gKCkgPT4gewogICAgICBpZiAoIXJvdXRlcikgewogICAgICAgIGNvbnNvbGUud2FybigiTm8gZmV0Y2hlciBhdmFpbGFibGUgdG8gY2xlYW4gdXAgZnJvbSB1c2VGZXRjaGVyKCkiKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHJvdXRlci5kZWxldGVGZXRjaGVyKGZldGNoZXJLZXkpOwogICAgfTsKICB9LCBbcm91dGVyLCBmZXRjaGVyS2V5XSk7CiAgcmV0dXJuIGZldGNoZXJXaXRoQ29tcG9uZW50czsKfQovKioKICogUHJvdmlkZXMgYWxsIGZldGNoZXJzIGN1cnJlbnRseSBvbiB0aGUgcGFnZS4gVXNlZnVsIGZvciBsYXlvdXRzIGFuZCBwYXJlbnQKICogcm91dGVzIHRoYXQgbmVlZCB0byBwcm92aWRlIHBlbmRpbmcvb3B0aW1pc3RpYyBVSSByZWdhcmRpbmcgdGhlIGZldGNoLgogKi8KCmZ1bmN0aW9uIHVzZUZldGNoZXJzKCkgewogIGxldCBzdGF0ZSA9IGRpc3RfdXNlRGF0YVJvdXRlclN0YXRlKGRpc3RfRGF0YVJvdXRlclN0YXRlSG9vay5Vc2VGZXRjaGVycyk7CiAgcmV0dXJuIFsuLi5zdGF0ZS5mZXRjaGVycy52YWx1ZXMoKV07Cn0KY29uc3QgU0NST0xMX1JFU1RPUkFUSU9OX1NUT1JBR0VfS0VZID0gInJlYWN0LXJvdXRlci1zY3JvbGwtcG9zaXRpb25zIjsKbGV0IHNhdmVkU2Nyb2xsUG9zaXRpb25zID0ge307Ci8qKgogKiBXaGVuIHJlbmRlcmVkIGluc2lkZSBhIFJvdXRlclByb3ZpZGVyLCB3aWxsIHJlc3RvcmUgc2Nyb2xsIHBvc2l0aW9ucyBvbiBuYXZpZ2F0aW9ucwogKi8KCmZ1bmN0aW9uIHVzZVNjcm9sbFJlc3RvcmF0aW9uKF90ZW1wMykgewogIGxldCB7CiAgICBnZXRLZXksCiAgICBzdG9yYWdlS2V5CiAgfSA9IF90ZW1wMyA9PT0gdm9pZCAwID8ge30gOiBfdGVtcDM7CiAgbGV0IHsKICAgIHJvdXRlcgogIH0gPSBkaXN0X3VzZURhdGFSb3V0ZXJDb250ZXh0KGRpc3RfRGF0YVJvdXRlckhvb2suVXNlU2Nyb2xsUmVzdG9yYXRpb24pOwogIGxldCB7CiAgICByZXN0b3JlU2Nyb2xsUG9zaXRpb24sCiAgICBwcmV2ZW50U2Nyb2xsUmVzZXQKICB9ID0gZGlzdF91c2VEYXRhUm91dGVyU3RhdGUoZGlzdF9EYXRhUm91dGVyU3RhdGVIb29rLlVzZVNjcm9sbFJlc3RvcmF0aW9uKTsKICBsZXQgbG9jYXRpb24gPSB1c2VMb2NhdGlvbigpOwogIGxldCBtYXRjaGVzID0gdXNlTWF0Y2hlcygpOwogIGxldCBuYXZpZ2F0aW9uID0gdXNlTmF2aWdhdGlvbigpOyAvLyBUcmlnZ2VyIG1hbnVhbCBzY3JvbGwgcmVzdG9yYXRpb24gd2hpbGUgd2UncmUgYWN0aXZlCgogIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7CiAgICB3aW5kb3cuaGlzdG9yeS5zY3JvbGxSZXN0b3JhdGlvbiA9ICJtYW51YWwiOwogICAgcmV0dXJuICgpID0+IHsKICAgICAgd2luZG93Lmhpc3Rvcnkuc2Nyb2xsUmVzdG9yYXRpb24gPSAiYXV0byI7CiAgICB9OwogIH0sIFtdKTsgLy8gU2F2ZSBwb3NpdGlvbnMgb24gdW5sb2FkCgogIHVzZUJlZm9yZVVubG9hZChSZWFjdC51c2VDYWxsYmFjaygoKSA9PiB7CiAgICBpZiAobmF2aWdhdGlvbi5zdGF0ZSA9PT0gImlkbGUiKSB7CiAgICAgIGxldCBrZXkgPSAoZ2V0S2V5ID8gZ2V0S2V5KGxvY2F0aW9uLCBtYXRjaGVzKSA6IG51bGwpIHx8IGxvY2F0aW9uLmtleTsKICAgICAgc2F2ZWRTY3JvbGxQb3NpdGlvbnNba2V5XSA9IHdpbmRvdy5zY3JvbGxZOwogICAgfQoKICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oc3RvcmFnZUtleSB8fCBTQ1JPTExfUkVTVE9SQVRJT05fU1RPUkFHRV9LRVksIEpTT04uc3RyaW5naWZ5KHNhdmVkU2Nyb2xsUG9zaXRpb25zKSk7CiAgICB3aW5kb3cuaGlzdG9yeS5zY3JvbGxSZXN0b3JhdGlvbiA9ICJhdXRvIjsKICB9LCBbc3RvcmFnZUtleSwgZ2V0S2V5LCBuYXZpZ2F0aW9uLnN0YXRlLCBsb2NhdGlvbiwgbWF0Y2hlc10pKTsgLy8gUmVhZCBpbiBhbnkgc2F2ZWQgc2Nyb2xsIGxvY2F0aW9ucwoKICBSZWFjdC51c2VMYXlvdXRFZmZlY3QoKCkgPT4gewogICAgdHJ5IHsKICAgICAgbGV0IHNlc3Npb25Qb3NpdGlvbnMgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKHN0b3JhZ2VLZXkgfHwgU0NST0xMX1JFU1RPUkFUSU9OX1NUT1JBR0VfS0VZKTsKCiAgICAgIGlmIChzZXNzaW9uUG9zaXRpb25zKSB7CiAgICAgICAgc2F2ZWRTY3JvbGxQb3NpdGlvbnMgPSBKU09OLnBhcnNlKHNlc3Npb25Qb3NpdGlvbnMpOwogICAgICB9CiAgICB9IGNhdGNoIChlKSB7Ly8gbm8tb3AsIHVzZSBkZWZhdWx0IGVtcHR5IG9iamVjdAogICAgfQogIH0sIFtzdG9yYWdlS2V5XSk7IC8vIEVuYWJsZSBzY3JvbGwgcmVzdG9yYXRpb24gaW4gdGhlIHJvdXRlcgoKICBSZWFjdC51c2VMYXlvdXRFZmZlY3QoKCkgPT4gewogICAgbGV0IGRpc2FibGVTY3JvbGxSZXN0b3JhdGlvbiA9IHJvdXRlciA9PSBudWxsID8gdm9pZCAwIDogcm91dGVyLmVuYWJsZVNjcm9sbFJlc3RvcmF0aW9uKHNhdmVkU2Nyb2xsUG9zaXRpb25zLCAoKSA9PiB3aW5kb3cuc2Nyb2xsWSwgZ2V0S2V5KTsKICAgIHJldHVybiAoKSA9PiBkaXNhYmxlU2Nyb2xsUmVzdG9yYXRpb24gJiYgZGlzYWJsZVNjcm9sbFJlc3RvcmF0aW9uKCk7CiAgfSwgW3JvdXRlciwgZ2V0S2V5XSk7IC8vIFJlc3RvcmUgc2Nyb2xsaW5nIHdoZW4gc3RhdGUucmVzdG9yZVNjcm9sbFBvc2l0aW9uIGNoYW5nZXMKCiAgUmVhY3QudXNlTGF5b3V0RWZmZWN0KCgpID0+IHsKICAgIC8vIEV4cGxpY2l0IGZhbHNlIG1lYW5zIGRvbid0IGRvIGFueXRoaW5nICh1c2VkIGZvciBzdWJtaXNzaW9ucykKICAgIGlmIChyZXN0b3JlU2Nyb2xsUG9zaXRpb24gPT09IGZhbHNlKSB7CiAgICAgIHJldHVybjsKICAgIH0gLy8gYmVlbiBoZXJlIGJlZm9yZSwgc2Nyb2xsIHRvIGl0CgoKICAgIGlmICh0eXBlb2YgcmVzdG9yZVNjcm9sbFBvc2l0aW9uID09PSAibnVtYmVyIikgewogICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgcmVzdG9yZVNjcm9sbFBvc2l0aW9uKTsKICAgICAgcmV0dXJuOwogICAgfSAvLyB0cnkgdG8gc2Nyb2xsIHRvIHRoZSBoYXNoCgoKICAgIGlmIChsb2NhdGlvbi5oYXNoKSB7CiAgICAgIGxldCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGxvY2F0aW9uLmhhc2guc2xpY2UoMSkpOwoKICAgICAgaWYgKGVsKSB7CiAgICAgICAgZWwuc2Nyb2xsSW50b1ZpZXcoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0gLy8gT3B0IG91dCBvZiBzY3JvbGwgcmVzZXQgaWYgdGhpcyBsaW5rIHJlcXVlc3RlZCBpdAoKCiAgICBpZiAocHJldmVudFNjcm9sbFJlc2V0ID09PSB0cnVlKSB7CiAgICAgIHJldHVybjsKICAgIH0gLy8gb3RoZXJ3aXNlIGdvIHRvIHRoZSB0b3Agb24gbmV3IGxvY2F0aW9ucwoKCiAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgMCk7CiAgfSwgW2xvY2F0aW9uLCByZXN0b3JlU2Nyb2xsUG9zaXRpb24sIHByZXZlbnRTY3JvbGxSZXNldF0pOwp9CgpmdW5jdGlvbiB1c2VCZWZvcmVVbmxvYWQoY2FsbGJhY2spIHsKICBSZWFjdC51c2VFZmZlY3QoKCkgPT4gewogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImJlZm9yZXVubG9hZCIsIGNhbGxiYWNrKTsKICAgIHJldHVybiAoKSA9PiB7CiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJiZWZvcmV1bmxvYWQiLCBjYWxsYmFjayk7CiAgICB9OwogIH0sIFtjYWxsYmFja10pOwp9IC8vI2VuZHJlZ2lvbgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLyNyZWdpb24gVXRpbHMKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgpmdW5jdGlvbiBkaXN0X3dhcm5pbmcoY29uZCwgbWVzc2FnZSkgewogIGlmICghY29uZCkgewogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGUKICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gInVuZGVmaW5lZCIpIGNvbnNvbGUud2FybihtZXNzYWdlKTsKCiAgICB0cnkgewogICAgICAvLyBXZWxjb21lIHRvIGRlYnVnZ2luZyBSZWFjdCBSb3V0ZXIhCiAgICAgIC8vCiAgICAgIC8vIFRoaXMgZXJyb3IgaXMgdGhyb3duIGFzIGEgY29udmVuaWVuY2Ugc28geW91IGNhbiBtb3JlIGVhc2lseQogICAgICAvLyBmaW5kIHRoZSBzb3VyY2UgZm9yIGEgd2FybmluZyB0aGF0IGFwcGVhcnMgaW4gdGhlIGNvbnNvbGUgYnkKICAgICAgLy8gZW5hYmxpbmcgInBhdXNlIG9uIGV4Y2VwdGlvbnMiIGluIHlvdXIgSmF2YVNjcmlwdCBkZWJ1Z2dlci4KICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tZW1wdHkKICAgIH0gY2F0Y2ggKGUpIHt9CiAgfQp9IC8vI2VuZHJlZ2lvbgoKCi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcAoKOy8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L2NvbXBvbmVudHMvTGF5b3V0LnRzeAoKCgoKdmFyIExheW91dCA9IGZ1bmN0aW9uIExheW91dChfcmVmKSB7dmFyIHBhZ2VzID0gX3JlZi5wYWdlczsKICB2YXIgb3V0bGV0ID0gLyojX19QVVJFX18qLwogIHJlYWN0LmNyZWF0ZUVsZW1lbnQocmVhY3QuRnJhZ21lbnQsIG51bGwsIC8qI19fUFVSRV9fKi8KICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGlkOiAibm90aWZpY2F0aW9uc0NvbnRhaW5lciIgfSksIC8qI19fUFVSRV9fKi8KICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGlkOiAicmVsYXlDb250YWluZXIiIH0sIC8qI19fUFVSRV9fKi8KICByZWFjdC5jcmVhdGVFbGVtZW50KE91dGxldCwgbnVsbCkpKTsKCgoKCiAgaWYgKHBhZ2VzLmxlbmd0aCA8PSAxKSB7CiAgICByZXR1cm4gb3V0bGV0OwogIH0KCiAgcmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICByZWFjdC5jcmVhdGVFbGVtZW50KHJlYWN0LkZyYWdtZW50LCBudWxsLAogICAgIiAiLCAvKiNfX1BVUkVfXyovCiAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJuYXYiLCBudWxsLCAvKiNfX1BVUkVfXyovCiAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogInRvcEJhciIgfSwKICAgICIgIiwKICAgIHBhZ2VzLm1hcChmdW5jdGlvbiAocCkge3JldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsga2V5OiAiIi5jb25jYXQocC5maWxlLCAiICIpLmNvbmNhdChwLnBhZ2UpLCBjbGFzc05hbWU6ICJ0YWJFbnRyeSIgfSwgLyojX19QVVJFX18qLwogICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoTmF2TGluaywgeyB0bzogIi8iICsgcC5maWxlIH0sIHAucGFnZSksICIgIikpO30pKSksCgoKCiAgICAiICIsCiAgICBvdXRsZXQpKTsKCgp9OwoKLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyBjb25zdCBjb21wb25lbnRzX0xheW91dCA9IChMYXlvdXQpOwo7Ly8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvYXBpL0FwaVJlcXVlc3QudHN4CmZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjtyZXR1cm4gX3R5cGVvZiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiAic3ltYm9sIiA9PSB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID8gZnVuY3Rpb24gKG9iaikge3JldHVybiB0eXBlb2Ygb2JqO30gOiBmdW5jdGlvbiAob2JqKSB7cmV0dXJuIG9iaiAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqO30sIF90eXBlb2Yob2JqKTt9ZnVuY3Rpb24gX3JlZ2VuZXJhdG9yUnVudGltZSgpIHsidXNlIHN0cmljdCI7Ci8qISByZWdlbmVyYXRvci1ydW50aW1lIC0tIENvcHlyaWdodCAoYykgMjAxNC1wcmVzZW50LCBGYWNlYm9vaywgSW5jLiAtLSBsaWNlbnNlIChNSVQpOiBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svcmVnZW5lcmF0b3IvYmxvYi9tYWluL0xJQ0VOU0UgKi9fcmVnZW5lcmF0b3JSdW50aW1lID0gZnVuY3Rpb24gX3JlZ2VuZXJhdG9yUnVudGltZSgpIHtyZXR1cm4gZXhwb3J0czt9O3ZhciBleHBvcnRzID0ge30sT3AgPSBPYmplY3QucHJvdG90eXBlLGhhc093biA9IE9wLmhhc093blByb3BlcnR5LGRlZmluZVByb3BlcnR5ID0gT2JqZWN0LmRlZmluZVByb3BlcnR5IHx8IGZ1bmN0aW9uIChvYmosIGtleSwgZGVzYykge29ialtrZXldID0gZGVzYy52YWx1ZTt9LCRTeW1ib2wgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgPyBTeW1ib2wgOiB7fSxpdGVyYXRvclN5bWJvbCA9ICRTeW1ib2wuaXRlcmF0b3IgfHwgIkBAaXRlcmF0b3IiLGFzeW5jSXRlcmF0b3JTeW1ib2wgPSAkU3ltYm9sLmFzeW5jSXRlcmF0b3IgfHwgIkBAYXN5bmNJdGVyYXRvciIsdG9TdHJpbmdUYWdTeW1ib2wgPSAkU3ltYm9sLnRvU3RyaW5nVGFnIHx8ICJAQHRvU3RyaW5nVGFnIjtmdW5jdGlvbiBkZWZpbmUob2JqLCBrZXksIHZhbHVlKSB7cmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6ICEwLCBjb25maWd1cmFibGU6ICEwLCB3cml0YWJsZTogITAgfSksIG9ialtrZXldO310cnkge2RlZmluZSh7fSwgIiIpO30gY2F0Y2ggKGVycikge2RlZmluZSA9IGZ1bmN0aW9uIGRlZmluZShvYmosIGtleSwgdmFsdWUpIHtyZXR1cm4gb2JqW2tleV0gPSB2YWx1ZTt9O31mdW5jdGlvbiB3cmFwKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSB7dmFyIHByb3RvR2VuZXJhdG9yID0gb3V0ZXJGbiAmJiBvdXRlckZuLnByb3RvdHlwZSBpbnN0YW5jZW9mIEdlbmVyYXRvciA/IG91dGVyRm4gOiBHZW5lcmF0b3IsZ2VuZXJhdG9yID0gT2JqZWN0LmNyZWF0ZShwcm90b0dlbmVyYXRvci5wcm90b3R5cGUpLGNvbnRleHQgPSBuZXcgQ29udGV4dCh0cnlMb2NzTGlzdCB8fCBbXSk7cmV0dXJuIGRlZmluZVByb3BlcnR5KGdlbmVyYXRvciwgIl9pbnZva2UiLCB7IHZhbHVlOiBtYWtlSW52b2tlTWV0aG9kKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpIH0pLCBnZW5lcmF0b3I7fWZ1bmN0aW9uIHRyeUNhdGNoKGZuLCBvYmosIGFyZykge3RyeSB7cmV0dXJuIHsgdHlwZTogIm5vcm1hbCIsIGFyZzogZm4uY2FsbChvYmosIGFyZykgfTt9IGNhdGNoIChlcnIpIHtyZXR1cm4geyB0eXBlOiAidGhyb3ciLCBhcmc6IGVyciB9O319ZXhwb3J0cy53cmFwID0gd3JhcDt2YXIgQ29udGludWVTZW50aW5lbCA9IHt9O2Z1bmN0aW9uIEdlbmVyYXRvcigpIHt9ZnVuY3Rpb24gR2VuZXJhdG9yRnVuY3Rpb24oKSB7fWZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkge312YXIgSXRlcmF0b3JQcm90b3R5cGUgPSB7fTtkZWZpbmUoSXRlcmF0b3JQcm90b3R5cGUsIGl0ZXJhdG9yU3ltYm9sLCBmdW5jdGlvbiAoKSB7cmV0dXJuIHRoaXM7fSk7dmFyIGdldFByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mLE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlID0gZ2V0UHJvdG8gJiYgZ2V0UHJvdG8oZ2V0UHJvdG8odmFsdWVzKFtdKSkpO05hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlICYmIE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlICE9PSBPcCAmJiBoYXNPd24uY2FsbChOYXRpdmVJdGVyYXRvclByb3RvdHlwZSwgaXRlcmF0b3JTeW1ib2wpICYmIChJdGVyYXRvclByb3RvdHlwZSA9IE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlKTt2YXIgR3AgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZS5wcm90b3R5cGUgPSBHZW5lcmF0b3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShJdGVyYXRvclByb3RvdHlwZSk7ZnVuY3Rpb24gZGVmaW5lSXRlcmF0b3JNZXRob2RzKHByb3RvdHlwZSkge1sibmV4dCIsICJ0aHJvdyIsICJyZXR1cm4iXS5mb3JFYWNoKGZ1bmN0aW9uIChtZXRob2QpIHtkZWZpbmUocHJvdG90eXBlLCBtZXRob2QsIGZ1bmN0aW9uIChhcmcpIHtyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgYXJnKTt9KTt9KTt9ZnVuY3Rpb24gQXN5bmNJdGVyYXRvcihnZW5lcmF0b3IsIFByb21pc2VJbXBsKSB7ZnVuY3Rpb24gaW52b2tlKG1ldGhvZCwgYXJnLCByZXNvbHZlLCByZWplY3QpIHt2YXIgcmVjb3JkID0gdHJ5Q2F0Y2goZ2VuZXJhdG9yW21ldGhvZF0sIGdlbmVyYXRvciwgYXJnKTtpZiAoInRocm93IiAhPT0gcmVjb3JkLnR5cGUpIHt2YXIgcmVzdWx0ID0gcmVjb3JkLmFyZyx2YWx1ZSA9IHJlc3VsdC52YWx1ZTtyZXR1cm4gdmFsdWUgJiYgIm9iamVjdCIgPT0gX3R5cGVvZih2YWx1ZSkgJiYgaGFzT3duLmNhbGwodmFsdWUsICJfX2F3YWl0IikgPyBQcm9taXNlSW1wbC5yZXNvbHZlKHZhbHVlLl9fYXdhaXQpLnRoZW4oZnVuY3Rpb24gKHZhbHVlKSB7aW52b2tlKCJuZXh0IiwgdmFsdWUsIHJlc29sdmUsIHJlamVjdCk7fSwgZnVuY3Rpb24gKGVycikge2ludm9rZSgidGhyb3ciLCBlcnIsIHJlc29sdmUsIHJlamVjdCk7fSkgOiBQcm9taXNlSW1wbC5yZXNvbHZlKHZhbHVlKS50aGVuKGZ1bmN0aW9uICh1bndyYXBwZWQpIHtyZXN1bHQudmFsdWUgPSB1bndyYXBwZWQsIHJlc29sdmUocmVzdWx0KTt9LCBmdW5jdGlvbiAoZXJyb3IpIHtyZXR1cm4gaW52b2tlKCJ0aHJvdyIsIGVycm9yLCByZXNvbHZlLCByZWplY3QpO30pO31yZWplY3QocmVjb3JkLmFyZyk7fXZhciBwcmV2aW91c1Byb21pc2U7ZGVmaW5lUHJvcGVydHkodGhpcywgIl9pbnZva2UiLCB7IHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShtZXRob2QsIGFyZykge2Z1bmN0aW9uIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKCkge3JldHVybiBuZXcgUHJvbWlzZUltcGwoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge2ludm9rZShtZXRob2QsIGFyZywgcmVzb2x2ZSwgcmVqZWN0KTt9KTt9cmV0dXJuIHByZXZpb3VzUHJvbWlzZSA9IHByZXZpb3VzUHJvbWlzZSA/IHByZXZpb3VzUHJvbWlzZS50aGVuKGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnLCBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZykgOiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpO30gfSk7fWZ1bmN0aW9uIG1ha2VJbnZva2VNZXRob2QoaW5uZXJGbiwgc2VsZiwgY29udGV4dCkge3ZhciBzdGF0ZSA9ICJzdXNwZW5kZWRTdGFydCI7cmV0dXJuIGZ1bmN0aW9uIChtZXRob2QsIGFyZykge2lmICgiZXhlY3V0aW5nIiA9PT0gc3RhdGUpIHRocm93IG5ldyBFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgcnVubmluZyIpO2lmICgiY29tcGxldGVkIiA9PT0gc3RhdGUpIHtpZiAoInRocm93IiA9PT0gbWV0aG9kKSB0aHJvdyBhcmc7cmV0dXJuIGRvbmVSZXN1bHQoKTt9Zm9yIChjb250ZXh0Lm1ldGhvZCA9IG1ldGhvZCwgY29udGV4dC5hcmcgPSBhcmc7Oykge3ZhciBkZWxlZ2F0ZSA9IGNvbnRleHQuZGVsZWdhdGU7aWYgKGRlbGVnYXRlKSB7dmFyIGRlbGVnYXRlUmVzdWx0ID0gbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCk7aWYgKGRlbGVnYXRlUmVzdWx0KSB7aWYgKGRlbGVnYXRlUmVzdWx0ID09PSBDb250aW51ZVNlbnRpbmVsKSBjb250aW51ZTtyZXR1cm4gZGVsZWdhdGVSZXN1bHQ7fX1pZiAoIm5leHQiID09PSBjb250ZXh0Lm1ldGhvZCkgY29udGV4dC5zZW50ID0gY29udGV4dC5fc2VudCA9IGNvbnRleHQuYXJnO2Vsc2UgaWYgKCJ0aHJvdyIgPT09IGNvbnRleHQubWV0aG9kKSB7aWYgKCJzdXNwZW5kZWRTdGFydCIgPT09IHN0YXRlKSB0aHJvdyBzdGF0ZSA9ICJjb21wbGV0ZWQiLCBjb250ZXh0LmFyZztjb250ZXh0LmRpc3BhdGNoRXhjZXB0aW9uKGNvbnRleHQuYXJnKTt9IGVsc2UgInJldHVybiIgPT09IGNvbnRleHQubWV0aG9kICYmIGNvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBjb250ZXh0LmFyZyk7c3RhdGUgPSAiZXhlY3V0aW5nIjt2YXIgcmVjb3JkID0gdHJ5Q2F0Y2goaW5uZXJGbiwgc2VsZiwgY29udGV4dCk7aWYgKCJub3JtYWwiID09PSByZWNvcmQudHlwZSkge2lmIChzdGF0ZSA9IGNvbnRleHQuZG9uZSA/ICJjb21wbGV0ZWQiIDogInN1c3BlbmRlZFlpZWxkIiwgcmVjb3JkLmFyZyA9PT0gQ29udGludWVTZW50aW5lbCkgY29udGludWU7cmV0dXJuIHsgdmFsdWU6IHJlY29yZC5hcmcsIGRvbmU6IGNvbnRleHQuZG9uZSB9O30idGhyb3ciID09PSByZWNvcmQudHlwZSAmJiAoc3RhdGUgPSAiY29tcGxldGVkIiwgY29udGV4dC5tZXRob2QgPSAidGhyb3ciLCBjb250ZXh0LmFyZyA9IHJlY29yZC5hcmcpO319O31mdW5jdGlvbiBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KSB7dmFyIG1ldGhvZCA9IGRlbGVnYXRlLml0ZXJhdG9yW2NvbnRleHQubWV0aG9kXTtpZiAodW5kZWZpbmVkID09PSBtZXRob2QpIHtpZiAoY29udGV4dC5kZWxlZ2F0ZSA9IG51bGwsICJ0aHJvdyIgPT09IGNvbnRleHQubWV0aG9kKSB7aWYgKGRlbGVnYXRlLml0ZXJhdG9yWyJyZXR1cm4iXSAmJiAoY29udGV4dC5tZXRob2QgPSAicmV0dXJuIiwgY29udGV4dC5hcmcgPSB1bmRlZmluZWQsIG1heWJlSW52b2tlRGVsZWdhdGUoZGVsZWdhdGUsIGNvbnRleHQpLCAidGhyb3ciID09PSBjb250ZXh0Lm1ldGhvZCkpIHJldHVybiBDb250aW51ZVNlbnRpbmVsO2NvbnRleHQubWV0aG9kID0gInRocm93IiwgY29udGV4dC5hcmcgPSBuZXcgVHlwZUVycm9yKCJUaGUgaXRlcmF0b3IgZG9lcyBub3QgcHJvdmlkZSBhICd0aHJvdycgbWV0aG9kIik7fXJldHVybiBDb250aW51ZVNlbnRpbmVsO312YXIgcmVjb3JkID0gdHJ5Q2F0Y2gobWV0aG9kLCBkZWxlZ2F0ZS5pdGVyYXRvciwgY29udGV4dC5hcmcpO2lmICgidGhyb3ciID09PSByZWNvcmQudHlwZSkgcmV0dXJuIGNvbnRleHQubWV0aG9kID0gInRocm93IiwgY29udGV4dC5hcmcgPSByZWNvcmQuYXJnLCBjb250ZXh0LmRlbGVnYXRlID0gbnVsbCwgQ29udGludWVTZW50aW5lbDt2YXIgaW5mbyA9IHJlY29yZC5hcmc7cmV0dXJuIGluZm8gPyBpbmZvLmRvbmUgPyAoY29udGV4dFtkZWxlZ2F0ZS5yZXN1bHROYW1lXSA9IGluZm8udmFsdWUsIGNvbnRleHQubmV4dCA9IGRlbGVnYXRlLm5leHRMb2MsICJyZXR1cm4iICE9PSBjb250ZXh0Lm1ldGhvZCAmJiAoY29udGV4dC5tZXRob2QgPSAibmV4dCIsIGNvbnRleHQuYXJnID0gdW5kZWZpbmVkKSwgY29udGV4dC5kZWxlZ2F0ZSA9IG51bGwsIENvbnRpbnVlU2VudGluZWwpIDogaW5mbyA6IChjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyIsIGNvbnRleHQuYXJnID0gbmV3IFR5cGVFcnJvcigiaXRlcmF0b3IgcmVzdWx0IGlzIG5vdCBhbiBvYmplY3QiKSwgY29udGV4dC5kZWxlZ2F0ZSA9IG51bGwsIENvbnRpbnVlU2VudGluZWwpO31mdW5jdGlvbiBwdXNoVHJ5RW50cnkobG9jcykge3ZhciBlbnRyeSA9IHsgdHJ5TG9jOiBsb2NzWzBdIH07MSBpbiBsb2NzICYmIChlbnRyeS5jYXRjaExvYyA9IGxvY3NbMV0pLCAyIGluIGxvY3MgJiYgKGVudHJ5LmZpbmFsbHlMb2MgPSBsb2NzWzJdLCBlbnRyeS5hZnRlckxvYyA9IGxvY3NbM10pLCB0aGlzLnRyeUVudHJpZXMucHVzaChlbnRyeSk7fWZ1bmN0aW9uIHJlc2V0VHJ5RW50cnkoZW50cnkpIHt2YXIgcmVjb3JkID0gZW50cnkuY29tcGxldGlvbiB8fCB7fTtyZWNvcmQudHlwZSA9ICJub3JtYWwiLCBkZWxldGUgcmVjb3JkLmFyZywgZW50cnkuY29tcGxldGlvbiA9IHJlY29yZDt9ZnVuY3Rpb24gQ29udGV4dCh0cnlMb2NzTGlzdCkge3RoaXMudHJ5RW50cmllcyA9IFt7IHRyeUxvYzogInJvb3QiIH1dLCB0cnlMb2NzTGlzdC5mb3JFYWNoKHB1c2hUcnlFbnRyeSwgdGhpcyksIHRoaXMucmVzZXQoITApO31mdW5jdGlvbiB2YWx1ZXMoaXRlcmFibGUpIHtpZiAoaXRlcmFibGUpIHt2YXIgaXRlcmF0b3JNZXRob2QgPSBpdGVyYWJsZVtpdGVyYXRvclN5bWJvbF07aWYgKGl0ZXJhdG9yTWV0aG9kKSByZXR1cm4gaXRlcmF0b3JNZXRob2QuY2FsbChpdGVyYWJsZSk7aWYgKCJmdW5jdGlvbiIgPT0gdHlwZW9mIGl0ZXJhYmxlLm5leHQpIHJldHVybiBpdGVyYWJsZTtpZiAoIWlzTmFOKGl0ZXJhYmxlLmxlbmd0aCkpIHt2YXIgaSA9IC0xLG5leHQgPSBmdW5jdGlvbiBuZXh0KCkge2ZvciAoOyArK2kgPCBpdGVyYWJsZS5sZW5ndGg7KSB7aWYgKGhhc093bi5jYWxsKGl0ZXJhYmxlLCBpKSkgcmV0dXJuIG5leHQudmFsdWUgPSBpdGVyYWJsZVtpXSwgbmV4dC5kb25lID0gITEsIG5leHQ7fXJldHVybiBuZXh0LnZhbHVlID0gdW5kZWZpbmVkLCBuZXh0LmRvbmUgPSAhMCwgbmV4dDt9O3JldHVybiBuZXh0Lm5leHQgPSBuZXh0O319cmV0dXJuIHsgbmV4dDogZG9uZVJlc3VsdCB9O31mdW5jdGlvbiBkb25lUmVzdWx0KCkge3JldHVybiB7IHZhbHVlOiB1bmRlZmluZWQsIGRvbmU6ICEwIH07fXJldHVybiBHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgZGVmaW5lUHJvcGVydHkoR3AsICJjb25zdHJ1Y3RvciIsIHsgdmFsdWU6IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCBjb25maWd1cmFibGU6ICEwIH0pLCBkZWZpbmVQcm9wZXJ0eShHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgImNvbnN0cnVjdG9yIiwgeyB2YWx1ZTogR2VuZXJhdG9yRnVuY3Rpb24sIGNvbmZpZ3VyYWJsZTogITAgfSksIEdlbmVyYXRvckZ1bmN0aW9uLmRpc3BsYXlOYW1lID0gZGVmaW5lKEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCB0b1N0cmluZ1RhZ1N5bWJvbCwgIkdlbmVyYXRvckZ1bmN0aW9uIiksIGV4cG9ydHMuaXNHZW5lcmF0b3JGdW5jdGlvbiA9IGZ1bmN0aW9uIChnZW5GdW4pIHt2YXIgY3RvciA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGdlbkZ1biAmJiBnZW5GdW4uY29uc3RydWN0b3I7cmV0dXJuICEhY3RvciAmJiAoY3RvciA9PT0gR2VuZXJhdG9yRnVuY3Rpb24gfHwgIkdlbmVyYXRvckZ1bmN0aW9uIiA9PT0gKGN0b3IuZGlzcGxheU5hbWUgfHwgY3Rvci5uYW1lKSk7fSwgZXhwb3J0cy5tYXJrID0gZnVuY3Rpb24gKGdlbkZ1bikge3JldHVybiBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2YoZ2VuRnVuLCBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSkgOiAoZ2VuRnVuLl9fcHJvdG9fXyA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCBkZWZpbmUoZ2VuRnVuLCB0b1N0cmluZ1RhZ1N5bWJvbCwgIkdlbmVyYXRvckZ1bmN0aW9uIikpLCBnZW5GdW4ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShHcCksIGdlbkZ1bjt9LCBleHBvcnRzLmF3cmFwID0gZnVuY3Rpb24gKGFyZykge3JldHVybiB7IF9fYXdhaXQ6IGFyZyB9O30sIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSksIGRlZmluZShBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSwgYXN5bmNJdGVyYXRvclN5bWJvbCwgZnVuY3Rpb24gKCkge3JldHVybiB0aGlzO30pLCBleHBvcnRzLkFzeW5jSXRlcmF0b3IgPSBBc3luY0l0ZXJhdG9yLCBleHBvcnRzLmFzeW5jID0gZnVuY3Rpb24gKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0LCBQcm9taXNlSW1wbCkge3ZvaWQgMCA9PT0gUHJvbWlzZUltcGwgJiYgKFByb21pc2VJbXBsID0gUHJvbWlzZSk7dmFyIGl0ZXIgPSBuZXcgQXN5bmNJdGVyYXRvcih3cmFwKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSwgUHJvbWlzZUltcGwpO3JldHVybiBleHBvcnRzLmlzR2VuZXJhdG9yRnVuY3Rpb24ob3V0ZXJGbikgPyBpdGVyIDogaXRlci5uZXh0KCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7cmV0dXJuIHJlc3VsdC5kb25lID8gcmVzdWx0LnZhbHVlIDogaXRlci5uZXh0KCk7fSk7fSwgZGVmaW5lSXRlcmF0b3JNZXRob2RzKEdwKSwgZGVmaW5lKEdwLCB0b1N0cmluZ1RhZ1N5bWJvbCwgIkdlbmVyYXRvciIpLCBkZWZpbmUoR3AsIGl0ZXJhdG9yU3ltYm9sLCBmdW5jdGlvbiAoKSB7cmV0dXJuIHRoaXM7fSksIGRlZmluZShHcCwgInRvU3RyaW5nIiwgZnVuY3Rpb24gKCkge3JldHVybiAiW29iamVjdCBHZW5lcmF0b3JdIjt9KSwgZXhwb3J0cy5rZXlzID0gZnVuY3Rpb24gKHZhbCkge3ZhciBvYmplY3QgPSBPYmplY3QodmFsKSxrZXlzID0gW107Zm9yICh2YXIga2V5IGluIG9iamVjdCkge2tleXMucHVzaChrZXkpO31yZXR1cm4ga2V5cy5yZXZlcnNlKCksIGZ1bmN0aW9uIG5leHQoKSB7Zm9yICg7IGtleXMubGVuZ3RoOykge3ZhciBrZXkgPSBrZXlzLnBvcCgpO2lmIChrZXkgaW4gb2JqZWN0KSByZXR1cm4gbmV4dC52YWx1ZSA9IGtleSwgbmV4dC5kb25lID0gITEsIG5leHQ7fXJldHVybiBuZXh0LmRvbmUgPSAhMCwgbmV4dDt9O30sIGV4cG9ydHMudmFsdWVzID0gdmFsdWVzLCBDb250ZXh0LnByb3RvdHlwZSA9IHsgY29uc3RydWN0b3I6IENvbnRleHQsIHJlc2V0OiBmdW5jdGlvbiByZXNldChza2lwVGVtcFJlc2V0KSB7aWYgKHRoaXMucHJldiA9IDAsIHRoaXMubmV4dCA9IDAsIHRoaXMuc2VudCA9IHRoaXMuX3NlbnQgPSB1bmRlZmluZWQsIHRoaXMuZG9uZSA9ICExLCB0aGlzLmRlbGVnYXRlID0gbnVsbCwgdGhpcy5tZXRob2QgPSAibmV4dCIsIHRoaXMuYXJnID0gdW5kZWZpbmVkLCB0aGlzLnRyeUVudHJpZXMuZm9yRWFjaChyZXNldFRyeUVudHJ5KSwgIXNraXBUZW1wUmVzZXQpIGZvciAodmFyIG5hbWUgaW4gdGhpcykgeyJ0IiA9PT0gbmFtZS5jaGFyQXQoMCkgJiYgaGFzT3duLmNhbGwodGhpcywgbmFtZSkgJiYgIWlzTmFOKCtuYW1lLnNsaWNlKDEpKSAmJiAodGhpc1tuYW1lXSA9IHVuZGVmaW5lZCk7fX0sIHN0b3A6IGZ1bmN0aW9uIHN0b3AoKSB7dGhpcy5kb25lID0gITA7dmFyIHJvb3RSZWNvcmQgPSB0aGlzLnRyeUVudHJpZXNbMF0uY29tcGxldGlvbjtpZiAoInRocm93IiA9PT0gcm9vdFJlY29yZC50eXBlKSB0aHJvdyByb290UmVjb3JkLmFyZztyZXR1cm4gdGhpcy5ydmFsO30sIGRpc3BhdGNoRXhjZXB0aW9uOiBmdW5jdGlvbiBkaXNwYXRjaEV4Y2VwdGlvbihleGNlcHRpb24pIHtpZiAodGhpcy5kb25lKSB0aHJvdyBleGNlcHRpb247dmFyIGNvbnRleHQgPSB0aGlzO2Z1bmN0aW9uIGhhbmRsZShsb2MsIGNhdWdodCkge3JldHVybiByZWNvcmQudHlwZSA9ICJ0aHJvdyIsIHJlY29yZC5hcmcgPSBleGNlcHRpb24sIGNvbnRleHQubmV4dCA9IGxvYywgY2F1Z2h0ICYmIChjb250ZXh0Lm1ldGhvZCA9ICJuZXh0IiwgY29udGV4dC5hcmcgPSB1bmRlZmluZWQpLCAhIWNhdWdodDt9Zm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge3ZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXSxyZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uO2lmICgicm9vdCIgPT09IGVudHJ5LnRyeUxvYykgcmV0dXJuIGhhbmRsZSgiZW5kIik7aWYgKGVudHJ5LnRyeUxvYyA8PSB0aGlzLnByZXYpIHt2YXIgaGFzQ2F0Y2ggPSBoYXNPd24uY2FsbChlbnRyeSwgImNhdGNoTG9jIiksaGFzRmluYWxseSA9IGhhc093bi5jYWxsKGVudHJ5LCAiZmluYWxseUxvYyIpO2lmIChoYXNDYXRjaCAmJiBoYXNGaW5hbGx5KSB7aWYgKHRoaXMucHJldiA8IGVudHJ5LmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGVudHJ5LmNhdGNoTG9jLCAhMCk7aWYgKHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHJldHVybiBoYW5kbGUoZW50cnkuZmluYWxseUxvYyk7fSBlbHNlIGlmIChoYXNDYXRjaCkge2lmICh0aGlzLnByZXYgPCBlbnRyeS5jYXRjaExvYykgcmV0dXJuIGhhbmRsZShlbnRyeS5jYXRjaExvYywgITApO30gZWxzZSB7aWYgKCFoYXNGaW5hbGx5KSB0aHJvdyBuZXcgRXJyb3IoInRyeSBzdGF0ZW1lbnQgd2l0aG91dCBjYXRjaCBvciBmaW5hbGx5Iik7aWYgKHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHJldHVybiBoYW5kbGUoZW50cnkuZmluYWxseUxvYyk7fX19fSwgYWJydXB0OiBmdW5jdGlvbiBhYnJ1cHQodHlwZSwgYXJnKSB7Zm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge3ZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTtpZiAoZW50cnkudHJ5TG9jIDw9IHRoaXMucHJldiAmJiBoYXNPd24uY2FsbChlbnRyeSwgImZpbmFsbHlMb2MiKSAmJiB0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7dmFyIGZpbmFsbHlFbnRyeSA9IGVudHJ5O2JyZWFrO319ZmluYWxseUVudHJ5ICYmICgiYnJlYWsiID09PSB0eXBlIHx8ICJjb250aW51ZSIgPT09IHR5cGUpICYmIGZpbmFsbHlFbnRyeS50cnlMb2MgPD0gYXJnICYmIGFyZyA8PSBmaW5hbGx5RW50cnkuZmluYWxseUxvYyAmJiAoZmluYWxseUVudHJ5ID0gbnVsbCk7dmFyIHJlY29yZCA9IGZpbmFsbHlFbnRyeSA/IGZpbmFsbHlFbnRyeS5jb21wbGV0aW9uIDoge307cmV0dXJuIHJlY29yZC50eXBlID0gdHlwZSwgcmVjb3JkLmFyZyA9IGFyZywgZmluYWxseUVudHJ5ID8gKHRoaXMubWV0aG9kID0gIm5leHQiLCB0aGlzLm5leHQgPSBmaW5hbGx5RW50cnkuZmluYWxseUxvYywgQ29udGludWVTZW50aW5lbCkgOiB0aGlzLmNvbXBsZXRlKHJlY29yZCk7fSwgY29tcGxldGU6IGZ1bmN0aW9uIGNvbXBsZXRlKHJlY29yZCwgYWZ0ZXJMb2MpIHtpZiAoInRocm93IiA9PT0gcmVjb3JkLnR5cGUpIHRocm93IHJlY29yZC5hcmc7cmV0dXJuICJicmVhayIgPT09IHJlY29yZC50eXBlIHx8ICJjb250aW51ZSIgPT09IHJlY29yZC50eXBlID8gdGhpcy5uZXh0ID0gcmVjb3JkLmFyZyA6ICJyZXR1cm4iID09PSByZWNvcmQudHlwZSA/ICh0aGlzLnJ2YWwgPSB0aGlzLmFyZyA9IHJlY29yZC5hcmcsIHRoaXMubWV0aG9kID0gInJldHVybiIsIHRoaXMubmV4dCA9ICJlbmQiKSA6ICJub3JtYWwiID09PSByZWNvcmQudHlwZSAmJiBhZnRlckxvYyAmJiAodGhpcy5uZXh0ID0gYWZ0ZXJMb2MpLCBDb250aW51ZVNlbnRpbmVsO30sIGZpbmlzaDogZnVuY3Rpb24gZmluaXNoKGZpbmFsbHlMb2MpIHtmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7dmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldO2lmIChlbnRyeS5maW5hbGx5TG9jID09PSBmaW5hbGx5TG9jKSByZXR1cm4gdGhpcy5jb21wbGV0ZShlbnRyeS5jb21wbGV0aW9uLCBlbnRyeS5hZnRlckxvYyksIHJlc2V0VHJ5RW50cnkoZW50cnkpLCBDb250aW51ZVNlbnRpbmVsO319LCAiY2F0Y2giOiBmdW5jdGlvbiBfY2F0Y2godHJ5TG9jKSB7Zm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge3ZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTtpZiAoZW50cnkudHJ5TG9jID09PSB0cnlMb2MpIHt2YXIgcmVjb3JkID0gZW50cnkuY29tcGxldGlvbjtpZiAoInRocm93IiA9PT0gcmVjb3JkLnR5cGUpIHt2YXIgdGhyb3duID0gcmVjb3JkLmFyZztyZXNldFRyeUVudHJ5KGVudHJ5KTt9cmV0dXJuIHRocm93bjt9fXRocm93IG5ldyBFcnJvcigiaWxsZWdhbCBjYXRjaCBhdHRlbXB0Iik7fSwgZGVsZWdhdGVZaWVsZDogZnVuY3Rpb24gZGVsZWdhdGVZaWVsZChpdGVyYWJsZSwgcmVzdWx0TmFtZSwgbmV4dExvYykge3JldHVybiB0aGlzLmRlbGVnYXRlID0geyBpdGVyYXRvcjogdmFsdWVzKGl0ZXJhYmxlKSwgcmVzdWx0TmFtZTogcmVzdWx0TmFtZSwgbmV4dExvYzogbmV4dExvYyB9LCAibmV4dCIgPT09IHRoaXMubWV0aG9kICYmICh0aGlzLmFyZyA9IHVuZGVmaW5lZCksIENvbnRpbnVlU2VudGluZWw7fSB9LCBleHBvcnRzO31mdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7dHJ5IHt2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7dmFyIHZhbHVlID0gaW5mby52YWx1ZTt9IGNhdGNoIChlcnJvcikge3JlamVjdChlcnJvcik7cmV0dXJuO31pZiAoaW5mby5kb25lKSB7cmVzb2x2ZSh2YWx1ZSk7fSBlbHNlIHtQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7fX1mdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikge3JldHVybiBmdW5jdGlvbiAoKSB7dmFyIHNlbGYgPSB0aGlzLGFyZ3MgPSBhcmd1bWVudHM7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHt2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7ZnVuY3Rpb24gX25leHQodmFsdWUpIHthc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpO31mdW5jdGlvbiBfdGhyb3coZXJyKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIpO31fbmV4dCh1bmRlZmluZWQpO30pO307fQpmdW5jdGlvbiBhZGROb3RpZmljYXRpb24obm90aWZpY2F0aW9uKSB7CiAgdmFyIGVsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogIGVsZS5jbGFzc05hbWUgPSAibm90aWZpY2F0aW9uIjsKICBlbGUuYWRkRXZlbnRMaXN0ZW5lcigiYW5pbWF0aW9uZW5kIiwgZnVuY3Rpb24gKCkge3JldHVybiBlbGUucmVtb3ZlKCk7fSk7CiAgZWxlLmlubmVyVGV4dCA9IG5vdGlmaWNhdGlvbjsKCiAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJub3RpZmljYXRpb25zQ29udGFpbmVyIik7CgogIGlmICghY29udGFpbmVyKSB7CiAgICByZXR1cm47CiAgfQoKICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZWxlKTsKfQoKZnVuY3Rpb24gc2F2ZVNldHRpbmdzKApwcm9wZXJ0aWVzKQp7CiAgcmV0dXJuIHNldFByb3BlcnRpZXMoCiAgcHJvcGVydGllcy4KICBmaWx0ZXIoZnVuY3Rpb24gKHApIHsKICAgIGlmIChwLnByZXZpb3VzVmFsdWUgPT09IHAudmFsdWUpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHAucHJldmlvdXNWYWx1ZSA9IHAudmFsdWU7CiAgICByZXR1cm4gdHJ1ZTsKICB9KS4KICBtYXAoZnVuY3Rpb24gKHByb3ApIHtyZXR1cm4gW3Byb3AucHJlZmVyZW5jZSwgcHJvcC52YWx1ZS50cmltKCldO30pKTsKCn0KCmZ1bmN0aW9uIHNldFByb3BlcnRpZXMoCnByb3BlcnRpZXMpCnsKICByZXR1cm4gcnVuUmVsYXkoInNldFByb3BlcnRpZXMiLCBKU09OLnN0cmluZ2lmeShwcm9wZXJ0aWVzKSkudGhlbihmdW5jdGlvbiAodmFsKSB7cmV0dXJuICgKICAgICAgSlNPTi5wYXJzZSh2YWwpKTt9KTsKCn1mdW5jdGlvbgoKcnVuUmVsYXkoX3gsIF94Mikge3JldHVybiBfcnVuUmVsYXkuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX3J1blJlbGF5KCkge19ydW5SZWxheSA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZShmb3JtTmFtZSwgcGFyYW0pIHtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHt3aGlsZSAoMSkge3N3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHtjYXNlIDA6cmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICAgICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICAgICAgICAgeGhyLnJlc3BvbnNlVHlwZSA9ICJ0ZXh0IjsKICAgICAgICAgICAgICB4aHIub3BlbigiUE9TVCIsIGRvY3VtZW50LmxvY2F0aW9uLmhyZWYsIHRydWUpOwogICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCJDb250ZW50LVR5cGUiLCAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIik7CiAgICAgICAgICAgICAgeGhyLnNlbmQoZm9ybU5hbWUgKyAiPSIgKyBlbmNvZGVVUklDb21wb25lbnQocGFyYW0pKTsKICAgICAgICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlICE9IDQgfHwgeGhyLnN0YXR1cyAhPSAyMDApIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJlc29sdmUoeGhyLnJlc3BvbnNlVGV4dCk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSkpO2Nhc2UgMTpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dC5zdG9wKCk7fX19LCBfY2FsbGVlKTt9KSk7cmV0dXJuIF9ydW5SZWxheS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KOy8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L2FwaS9TZXR0aW5nVmFsaWRhdG9yLnRzeApmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHtyZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdCgpO31mdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7fWZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHt2YXIgX2kgPSBhcnIgPT0gbnVsbCA/IG51bGwgOiB0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBhcnJbU3ltYm9sLml0ZXJhdG9yXSB8fCBhcnJbIkBAaXRlcmF0b3IiXTtpZiAoX2kgPT0gbnVsbCkgcmV0dXJuO3ZhciBfYXJyID0gW107dmFyIF9uID0gdHJ1ZTt2YXIgX2QgPSBmYWxzZTt2YXIgX3MsIF9lO3RyeSB7Zm9yIChfaSA9IF9pLmNhbGwoYXJyKTsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkge19hcnIucHVzaChfcy52YWx1ZSk7aWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrO319IGNhdGNoIChlcnIpIHtfZCA9IHRydWU7X2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO31mdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7aWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjt9ZnVuY3Rpb24gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIobywgYWxsb3dBcnJheUxpa2UpIHt2YXIgaXQgPSB0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl0gfHwgb1siQEBpdGVyYXRvciJdO2lmICghaXQpIHtpZiAoQXJyYXkuaXNBcnJheShvKSB8fCAoaXQgPSBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobykpIHx8IGFsbG93QXJyYXlMaWtlICYmIG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikge2lmIChpdCkgbyA9IGl0O3ZhciBpID0gMDt2YXIgRiA9IGZ1bmN0aW9uIEYoKSB7fTtyZXR1cm4geyBzOiBGLCBuOiBmdW5jdGlvbiBuKCkge2lmIChpID49IG8ubGVuZ3RoKSByZXR1cm4geyBkb25lOiB0cnVlIH07cmV0dXJuIHsgZG9uZTogZmFsc2UsIHZhbHVlOiBvW2krK10gfTt9LCBlOiBmdW5jdGlvbiBlKF9lMikge3Rocm93IF9lMjt9LCBmOiBGIH07fXRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBpdGVyYXRlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTt9dmFyIG5vcm1hbENvbXBsZXRpb24gPSB0cnVlLGRpZEVyciA9IGZhbHNlLGVycjtyZXR1cm4geyBzOiBmdW5jdGlvbiBzKCkge2l0ID0gaXQuY2FsbChvKTt9LCBuOiBmdW5jdGlvbiBuKCkge3ZhciBzdGVwID0gaXQubmV4dCgpO25vcm1hbENvbXBsZXRpb24gPSBzdGVwLmRvbmU7cmV0dXJuIHN0ZXA7fSwgZTogZnVuY3Rpb24gZShfZTMpIHtkaWRFcnIgPSB0cnVlO2VyciA9IF9lMzt9LCBmOiBmdW5jdGlvbiBmKCkge3RyeSB7aWYgKCFub3JtYWxDb21wbGV0aW9uICYmIGl0WyJyZXR1cm4iXSAhPSBudWxsKSBpdFsicmV0dXJuIl0oKTt9IGZpbmFsbHkge2lmIChkaWRFcnIpIHRocm93IGVycjt9fSB9O31mdW5jdGlvbiBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobywgbWluTGVuKSB7aWYgKCFvKSByZXR1cm47aWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7dmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpO2lmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lO2lmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikgcmV0dXJuIEFycmF5LmZyb20obyk7aWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt9ZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHtpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDtmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIHthcnIyW2ldID0gYXJyW2ldO31yZXR1cm4gYXJyMjt9ZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3Rvcikge2lmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7fX1mdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7Zm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykge3ZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07ZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlO2Rlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTtpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTtPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7fX1mdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7aWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7aWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpO09iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdHJ1Y3RvciwgInByb3RvdHlwZSIsIHsgd3JpdGFibGU6IGZhbHNlIH0pO3JldHVybiBDb25zdHJ1Y3Rvcjt9ZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkge2lmIChrZXkgaW4gb2JqKSB7T2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTt9IGVsc2Uge29ialtrZXldID0gdmFsdWU7fXJldHVybiBvYmo7fXZhcgoKClNldHRpbmdWYWxpZGF0b3IgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkge2Z1bmN0aW9uIFNldHRpbmdWYWxpZGF0b3IoKSB7X2NsYXNzQ2FsbENoZWNrKHRoaXMsIFNldHRpbmdWYWxpZGF0b3IpO19kZWZpbmVQcm9wZXJ0eSh0aGlzLCAic2V0dGluZ3MiLAogICAgW10pO19kZWZpbmVQcm9wZXJ0eSh0aGlzLCAib2JqZWN0IiwKICAgIHt9KTt9X2NyZWF0ZUNsYXNzKFNldHRpbmdWYWxpZGF0b3IsIFt7IGtleTogImFkZFNldHRpbmciLCB2YWx1ZToKCiAgICBmdW5jdGlvbiBhZGRTZXR0aW5nKHNldHRpbmcsIHNldFN0YXRlKSB7CiAgICAgIHRoaXMuc2V0dGluZ3MucHVzaChbc2V0dGluZywgc2V0U3RhdGVdKTsKICAgIH0gfSwgeyBrZXk6ICJ1cGRhdGVTZXR0aW5nIiwgdmFsdWU6CgogICAgZnVuY3Rpb24gdXBkYXRlU2V0dGluZyhzZXR0aW5nKSB7CiAgICAgIHRoaXMub2JqZWN0W3NldHRpbmcucHJlZmVyZW5jZV0gPSBzZXR0aW5nLnZhbHVlOwogICAgICB0aGlzLmRvVmFsaWRhdGVzKCk7CiAgICB9IH0sIHsga2V5OiAidXBkYXRlT2JqZWN0IiwgdmFsdWU6CgogICAgZnVuY3Rpb24gdXBkYXRlT2JqZWN0KCkge3ZhciBfaXRlcmF0b3IgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcigKICAgICAgICB0aGlzLnNldHRpbmdzKSxfc3RlcDt0cnkge2ZvciAoX2l0ZXJhdG9yLnMoKTsgIShfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmU7KSB7dmFyIF9zdGVwJHZhbHVlID0gX3NsaWNlZFRvQXJyYXkoX3N0ZXAudmFsdWUsIDEpLHNldHRpbmcgPSBfc3RlcCR2YWx1ZVswXTsKICAgICAgICAgIHRoaXMub2JqZWN0W3NldHRpbmcucHJlZmVyZW5jZV0gPSBzZXR0aW5nLnZhbHVlOwogICAgICAgIH19IGNhdGNoIChlcnIpIHtfaXRlcmF0b3IuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yLmYoKTt9CiAgICB9IH0sIHsga2V5OiAiZG9WYWxpZGF0ZXMiLCB2YWx1ZToKCiAgICBmdW5jdGlvbiBkb1ZhbGlkYXRlcygpIHt2YXIgX2l0ZXJhdG9yMiA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKAogICAgICAgIHRoaXMuc2V0dGluZ3MpLF9zdGVwMjt0cnkge2ZvciAoX2l0ZXJhdG9yMi5zKCk7ICEoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uKCkpLmRvbmU7KSB7dmFyIF9zdGVwMiR2YWx1ZSA9IF9zbGljZWRUb0FycmF5KF9zdGVwMi52YWx1ZSwgMiksc2V0dGluZyA9IF9zdGVwMiR2YWx1ZVswXSxzZXRWYWxpZCA9IF9zdGVwMiR2YWx1ZVsxXTsKICAgICAgICAgIHNldFZhbGlkKHRoaXMuaXNWYWxpZChzZXR0aW5nKSk7CiAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjIuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yMi5mKCk7fQogICAgfSB9LCB7IGtleTogImlzVmFsaWQiLCB2YWx1ZToKCiAgICBmdW5jdGlvbiBpc1ZhbGlkKHNldHRpbmcpIHsKICAgICAgcmV0dXJuICgKICAgICAgICBzZXR0aW5nLnZhbGlkYXRlID09IG51bGwgfHwgc2V0dGluZy52YWxpZGF0ZShzZXR0aW5nLnZhbHVlLCB0aGlzLm9iamVjdCkpOwoKICAgIH0gfV0pO3JldHVybiBTZXR0aW5nVmFsaWRhdG9yO30oKTsKCgovKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIGNvbnN0IGFwaV9TZXR0aW5nVmFsaWRhdG9yID0gKFNldHRpbmdWYWxpZGF0b3IpOwo7Ly8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvY29tcG9uZW50cy9JbnRlcnJ1cHQudHN4CgoKCgpmdW5jdGlvbiBJbnRlcnJ1cHQoX3JlZikge3ZhciBidXR0b24gPSBfcmVmLmJ1dHRvbjsKICByZXR1cm4gLyojX19QVVJFX18qLygKICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImlucHV0IiwgewogICAgICBjbGFzc05hbWU6ICJpbnRlcnJ1cHQiLAogICAgICB0eXBlOiAic3VibWl0IiwKICAgICAgdmFsdWU6IGJ1dHRvbi5uYW1lLAogICAgICAiZGF0YS1uYW1lIjogYnV0dG9uLm5hbWUsCiAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgc2V0UHJvcGVydGllcygKICAgICAgICBidXR0b24uYWN0aW9ucy5tYXAoZnVuY3Rpb24gKF9yZWYyKSB7dmFyIHByZWZlcmVuY2UgPSBfcmVmMi5wcmVmZXJlbmNlLHZhbHVlID0gX3JlZjIudmFsdWU7cmV0dXJuIFtwcmVmZXJlbmNlLCB2YWx1ZV07fSkpLgogICAgICAgIHRoZW4oZnVuY3Rpb24gKCkge3JldHVybiBhZGROb3RpZmljYXRpb24oYnV0dG9uLm5vdGlmaWNhdGlvbiB8fCAiSW50ZXJydXB0ZWQhIik7fSk7CiAgICAgIH0gfSkpOwoKCn0KCi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gY29uc3QgY29tcG9uZW50c19JbnRlcnJ1cHQgPSAoSW50ZXJydXB0KTsKOy8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L3R5cGVzL1R5cGVzLnRzeAoKCnZhciBSZWxheUNvbXBvbmVudFR5cGU7KGZ1bmN0aW9uIChSZWxheUNvbXBvbmVudFR5cGUpIHtSZWxheUNvbXBvbmVudFR5cGVbIkJPT0xFQU4iXSA9ICJib29sZWFuIjtSZWxheUNvbXBvbmVudFR5cGVbIkRST1BET1dOIl0gPSAiZHJvcGRvd24iO1JlbGF5Q29tcG9uZW50VHlwZVsiU1RSSU5HIl0gPSAic3RyaW5nIjtSZWxheUNvbXBvbmVudFR5cGVbIkhUTUwiXSA9ICJodG1sIjtSZWxheUNvbXBvbmVudFR5cGVbIklOVEVSUlVQVCJdID0gImludGVycnVwdCI7UmVsYXlDb21wb25lbnRUeXBlWyJUQUdTIl0gPSAidGFncyI7fSkoUmVsYXlDb21wb25lbnRUeXBlIHx8IChSZWxheUNvbXBvbmVudFR5cGUgPSB7fSkpOwo7Ly8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvY29tcG9uZW50cy9zZXR0aW5ncy9Cb29sZWFuSW5wdXQudHN4CmZ1bmN0aW9uIEJvb2xlYW5JbnB1dF9zbGljZWRUb0FycmF5KGFyciwgaSkge3JldHVybiBCb29sZWFuSW5wdXRfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBCb29sZWFuSW5wdXRfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBCb29sZWFuSW5wdXRfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyLCBpKSB8fCBCb29sZWFuSW5wdXRfbm9uSXRlcmFibGVSZXN0KCk7fWZ1bmN0aW9uIEJvb2xlYW5JbnB1dF9ub25JdGVyYWJsZVJlc3QoKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTt9ZnVuY3Rpb24gQm9vbGVhbklucHV0X3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikge2lmICghbykgcmV0dXJuO2lmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBCb29sZWFuSW5wdXRfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO3ZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTtpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTtpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pO2lmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIEJvb2xlYW5JbnB1dF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7fWZ1bmN0aW9uIEJvb2xlYW5JbnB1dF9hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuKSB7aWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7Zm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSB7YXJyMltpXSA9IGFycltpXTt9cmV0dXJuIGFycjI7fWZ1bmN0aW9uIEJvb2xlYW5JbnB1dF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHt2YXIgX2kgPSBhcnIgPT0gbnVsbCA/IG51bGwgOiB0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBhcnJbU3ltYm9sLml0ZXJhdG9yXSB8fCBhcnJbIkBAaXRlcmF0b3IiXTtpZiAoX2kgPT0gbnVsbCkgcmV0dXJuO3ZhciBfYXJyID0gW107dmFyIF9uID0gdHJ1ZTt2YXIgX2QgPSBmYWxzZTt2YXIgX3MsIF9lO3RyeSB7Zm9yIChfaSA9IF9pLmNhbGwoYXJyKTsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkge19hcnIucHVzaChfcy52YWx1ZSk7aWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrO319IGNhdGNoIChlcnIpIHtfZCA9IHRydWU7X2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO31mdW5jdGlvbiBCb29sZWFuSW5wdXRfYXJyYXlXaXRoSG9sZXMoYXJyKSB7aWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjt9CgoKCmZ1bmN0aW9uIEJvb2xlYW5JbnB1dChfcmVmKSB7dmFyIGJ1dHRvbiA9IF9yZWYuYnV0dG9uOwogIHZhciBfdXNlU3RhdGUgPSAoMCxyZWFjdC51c2VTdGF0ZSkoYnV0dG9uLnZhbHVlID09PSAidHJ1ZSIpLF91c2VTdGF0ZTIgPSBCb29sZWFuSW5wdXRfc2xpY2VkVG9BcnJheShfdXNlU3RhdGUsIDIpLHZhbHVlID0gX3VzZVN0YXRlMlswXSxzZXRWYWx1ZSA9IF91c2VTdGF0ZTJbMV07CgogIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgcmVhY3QuY3JlYXRlRWxlbWVudCgibGFiZWwiLCB7IGNsYXNzTmFtZTogImNoZWNrY29udGFpbmVyIiB9LCAvKiNfX1BVUkVfXyovCiAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJpbnB1dCIsIHsgdHlwZTogImhpZGRlbiIsIG5hbWU6IGJ1dHRvbi5uYW1lLCB2YWx1ZTogYnV0dG9uLnZhbHVlIH0pLCAvKiNfX1BVUkVfXyovCiAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgIGNsYXNzTmFtZTogInRvZ2dsZS10cmFjayIsCiAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgc2V0VmFsdWUoIXZhbHVlKTsKICAgICAgICBidXR0b24uc2V0VmFsdWUoKCF2YWx1ZSkudG9TdHJpbmcoKSk7CiAgICAgIH0gfSwgLyojX19QVVJFX18qLwoKICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCB7IGNsYXNzTmFtZTogInRvZ2dsZS1pbmRpY2F0b3IiIH0sIC8qI19fUFVSRV9fKi8KICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCB7IGNsYXNzTmFtZTogImNoZWNrTWFyayIgfSwgLyojX19QVVJFX18qLwogICAgcmVhY3QuY3JlYXRlRWxlbWVudCgic3ZnIiwgewogICAgICB2aWV3Qm94OiAiMCAwIDI0IDI0IiwKICAgICAgaWQ6ICJnaHEtc3ZnLWNoZWNrIiwKICAgICAgcm9sZTogInByZXNlbnRhdGlvbiIsCiAgICAgICJhcmlhLWhpZGRlbiI6ICJ0cnVlIiB9LCAvKiNfX1BVUkVfXyovCgogICAgcmVhY3QuY3JlYXRlRWxlbWVudCgicGF0aCIsIHsgZDogIk05Ljg2IDE4YTEgMSAwIDAxLS43My0uMzJsLTQuODYtNS4xN2ExLjAwMSAxLjAwMSAwIDAxMS40Ni0xLjM3bDQuMTIgNC4zOSA4LjQxLTkuMmExIDEgMCAxMTEuNDggMS4zNGwtOS4xNCAxMGExIDEgMCAwMS0uNzMuMzNoLS4wMXoiIH0pKSkpKSkpOwoKCgoKCgp9CgovKgo8ZGl2CiAgY2xhc3M9ImNoZWNrbWFyayIKICBvbkNsaWNrPXsoKSA9PiB7CiAgICBzZXRWYWx1ZSghdmFsdWUpOwogIH19Ci8+CiAqLwovKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIGNvbnN0IHNldHRpbmdzX0Jvb2xlYW5JbnB1dCA9IChCb29sZWFuSW5wdXQpOwo7Ly8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvY29tcG9uZW50cy9zZXR0aW5ncy9Ecm9wZG93bklucHV0LnRzeAoKCgpmdW5jdGlvbiBEcm9wZG93bklucHV0KF9yZWYpIHt2YXIgYnV0dG9uID0gX3JlZi5idXR0b247CiAgcmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJzZWxlY3QiLCB7CiAgICAgIGNsYXNzTmFtZTogImRyb3Bkb3duY29udGFpbmVyIiwKICAgICAgbmFtZTogYnV0dG9uLm5hbWUsCiAgICAgIGRlZmF1bHRWYWx1ZTogYnV0dG9uLnZhbHVlLAogICAgICBvbkNoYW5nZTogZnVuY3Rpb24gb25DaGFuZ2UoZSkge3JldHVybiBidXR0b24uc2V0VmFsdWUoZS50YXJnZXQudmFsdWUpO30gfSwKCiAgICBidXR0b24uZHJvcGRvd24ubWFwKGZ1bmN0aW9uIChvcHRpb24sIGluZGV4KSB7CiAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIsIHsga2V5OiBpbmRleCwgdmFsdWU6IG9wdGlvbi52YWx1ZSB9LAogICAgICAgIG9wdGlvbi5kaXNwbGF5IHx8IG9wdGlvbi52YWx1ZSkpOwoKCiAgICB9KSkpOwoKCn0KCi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gY29uc3Qgc2V0dGluZ3NfRHJvcGRvd25JbnB1dCA9IChEcm9wZG93bklucHV0KTsKOy8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L2NvbXBvbmVudHMvc2V0dGluZ3MvU3RyaW5nSW5wdXQudHN4CgoKCmZ1bmN0aW9uIFN0cmluZ0lucHV0KF9yZWYpIHt2YXIgYnV0dG9uID0gX3JlZi5idXR0b247CiAgcmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJpbnB1dCIsIHsKICAgICAgY2xhc3NOYW1lOiAic3RyaW5nY29udGFpbmVyIiwKICAgICAgbmFtZTogYnV0dG9uLm5hbWUsCiAgICAgIGRlZmF1bHRWYWx1ZTogYnV0dG9uLnZhbHVlLAogICAgICBwbGFjZWhvbGRlcjogYnV0dG9uLnBsYWNlaG9sZGVyVGV4dCA/IGJ1dHRvbi5wbGFjZWhvbGRlclRleHQgOiAiIiwKICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKGUpIHtyZXR1cm4gYnV0dG9uLnNldFZhbHVlKGUudGFyZ2V0LnZhbHVlKTt9IH0pKTsKCgp9CgovKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIGNvbnN0IHNldHRpbmdzX1N0cmluZ0lucHV0ID0gKFN0cmluZ0lucHV0KTsKOy8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L2NvbXBvbmVudHMvc2V0dGluZ3MvVGFnc0lucHV0LnRzeApmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7cmV0dXJuIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBUYWdzSW5wdXRfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfbm9uSXRlcmFibGVTcHJlYWQoKTt9ZnVuY3Rpb24gX25vbkl0ZXJhYmxlU3ByZWFkKCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO31mdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5KGl0ZXIpIHtpZiAodHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgaXRlcltTeW1ib2wuaXRlcmF0b3JdICE9IG51bGwgfHwgaXRlclsiQEBpdGVyYXRvciJdICE9IG51bGwpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpO31mdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7aWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIFRhZ3NJbnB1dF9hcnJheUxpa2VUb0FycmF5KGFycik7fWZ1bmN0aW9uIFRhZ3NJbnB1dF9zbGljZWRUb0FycmF5KGFyciwgaSkge3JldHVybiBUYWdzSW5wdXRfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBUYWdzSW5wdXRfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBUYWdzSW5wdXRfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyLCBpKSB8fCBUYWdzSW5wdXRfbm9uSXRlcmFibGVSZXN0KCk7fWZ1bmN0aW9uIFRhZ3NJbnB1dF9ub25JdGVyYWJsZVJlc3QoKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTt9ZnVuY3Rpb24gVGFnc0lucHV0X3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikge2lmICghbykgcmV0dXJuO2lmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBUYWdzSW5wdXRfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO3ZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTtpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTtpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pO2lmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIFRhZ3NJbnB1dF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7fWZ1bmN0aW9uIFRhZ3NJbnB1dF9hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuKSB7aWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7Zm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSB7YXJyMltpXSA9IGFycltpXTt9cmV0dXJuIGFycjI7fWZ1bmN0aW9uIFRhZ3NJbnB1dF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHt2YXIgX2kgPSBhcnIgPT0gbnVsbCA/IG51bGwgOiB0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBhcnJbU3ltYm9sLml0ZXJhdG9yXSB8fCBhcnJbIkBAaXRlcmF0b3IiXTtpZiAoX2kgPT0gbnVsbCkgcmV0dXJuO3ZhciBfYXJyID0gW107dmFyIF9uID0gdHJ1ZTt2YXIgX2QgPSBmYWxzZTt2YXIgX3MsIF9lO3RyeSB7Zm9yIChfaSA9IF9pLmNhbGwoYXJyKTsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkge19hcnIucHVzaChfcy52YWx1ZSk7aWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrO319IGNhdGNoIChlcnIpIHtfZCA9IHRydWU7X2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO31mdW5jdGlvbiBUYWdzSW5wdXRfYXJyYXlXaXRoSG9sZXMoYXJyKSB7aWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjt9CgoKdmFyIENsb3NlSWNvbiA9IGZ1bmN0aW9uIENsb3NlSWNvbigpIHsKICByZXR1cm4gLyojX19QVVJFX18qLygKICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInN2ZyIsIHsgaGVpZ2h0OiAiMjAiLCB3aWR0aDogIjIwIiwgdmlld0JveDogIjAgMCAyMCAyMCIgfSwgLyojX19QVVJFX18qLwogICAgcmVhY3QuY3JlYXRlRWxlbWVudCgicGF0aCIsIHsgZDogIk0xNC4zNDggMTQuODQ5Yy0wLjQ2OSAwLjQ2OS0xLjIyOSAwLjQ2OS0xLjY5NyAwbC0yLjY1MS0zLjAzMC0yLjY1MSAzLjAyOWMtMC40NjkgMC40NjktMS4yMjkgMC40NjktMS42OTcgMC0wLjQ2OS0wLjQ2OS0wLjQ2OS0xLjIyOSAwLTEuNjk3bDIuNzU4LTMuMTUtMi43NTktMy4xNTJjLTAuNDY5LTAuNDY5LTAuNDY5LTEuMjI4IDAtMS42OTdzMS4yMjgtMC40NjkgMS42OTcgMGwyLjY1MiAzLjAzMSAyLjY1MS0zLjAzMWMwLjQ2OS0wLjQ2OSAxLjIyOC0wLjQ2OSAxLjY5NyAwczAuNDY5IDEuMjI5IDAgMS42OTdsLTIuNzU4IDMuMTUyIDIuNzU4IDMuMTVjMC40NjkgMC40NjkgMC40NjkgMS4yMjkgMCAxLjY5OHoiIH0pKSk7CgoKfTsKCnZhciBtYXBWYWx1ZXNUb0Rpc3BsYXkgPSBmdW5jdGlvbiBtYXBWYWx1ZXNUb0Rpc3BsYXkoYnV0dG9uLCB2YWx1ZXMpIHsKICB2YXIgdGFncyA9IFtdOwoKICB2YWx1ZXMuZm9yRWFjaChmdW5jdGlvbiAodikgewogICAgaWYgKGJ1dHRvbi5kcm9wZG93biA9PSBudWxsKSB7CiAgICAgIHRhZ3MucHVzaCh7IGRpc3BsYXk6IHYsIHZhbHVlOiB2IH0pOwogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIGRyb3AgPSBidXR0b24uZHJvcGRvd24uZmluZCgKICAgIGZ1bmN0aW9uIChkKSB7cmV0dXJuIGQudmFsdWUudG9Mb3dlckNhc2UoKSA9PSB2LnRvTG93ZXJDYXNlKCk7fSk7CgoKICAgIGlmIChkcm9wID09IG51bGwpIHsKICAgICAgdGFncy5wdXNoKHsgZGlzcGxheTogdiwgdmFsdWU6IHYgfSk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB0YWdzLnB1c2goZHJvcCk7CiAgfSk7CgogIHJldHVybiB0YWdzOwp9OwoKdmFyIFRhZ3NJbnB1dCA9IGZ1bmN0aW9uIFRhZ3NJbnB1dChfcmVmKSB7dmFyIGJ1dHRvbiA9IF9yZWYuYnV0dG9uOwogIHZhciBfUmVhY3QkdXNlU3RhdGUgPSByZWFjdC51c2VTdGF0ZSgKICAgIG1hcFZhbHVlc1RvRGlzcGxheSgKICAgIGJ1dHRvbiwKICAgIGJ1dHRvbi52YWx1ZS5zcGxpdChidXR0b24udGFnc1NlcGVyYXRvcikuZmlsdGVyKGZ1bmN0aW9uIChzKSB7cmV0dXJuIHMubGVuZ3RoID4gMDt9KSkpLF9SZWFjdCR1c2VTdGF0ZTIgPSBUYWdzSW5wdXRfc2xpY2VkVG9BcnJheShfUmVhY3QkdXNlU3RhdGUsIDIpLHRhZ3MgPSBfUmVhY3QkdXNlU3RhdGUyWzBdLHNldFRhZ3MgPSBfUmVhY3QkdXNlU3RhdGUyWzFdOwoKCgogIHZhciBhZGRUYWcgPSBmdW5jdGlvbiBhZGRUYWcodGFnKSB7CiAgICBzZXRTZWFyY2hWYWx1ZSgiIik7CiAgICBzZXRUYWdzKFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkodGFncyksIFt0YWddKSk7CgogICAgdmFyIHZhbHMgPSBidXR0b24udmFsdWUuCiAgICBzcGxpdChidXR0b24udGFnc1NlcGVyYXRvcikuCiAgICBmaWx0ZXIoZnVuY3Rpb24gKHMpIHtyZXR1cm4gcy5sZW5ndGggPiAwO30pOwogICAgdmFscy5wdXNoKHRhZy52YWx1ZSk7CgogICAgYnV0dG9uLnNldFZhbHVlKHZhbHMuam9pbihidXR0b24udGFnc1NlcGVyYXRvcikpOwogIH07CgogIC8vIEFkZCBvciByZW1vdmUgdGFncyBieSB1c2luZyB0aGUga2V5CiAgdmFyIGhhbmRsZVRhZ3MgPSBmdW5jdGlvbiBoYW5kbGVUYWdzKGV2ZW50KSB7CiAgICBpZiAoZXZlbnQua2V5ID09PSAiRW50ZXIiICYmIGV2ZW50LmN1cnJlbnRUYXJnZXQudmFsdWUgIT09ICIiKSB7CiAgICAgIHZhciBkcm9wZG93blZhbHVlID0KICAgICAgYnV0dG9uLmRyb3Bkb3duICE9IG51bGwgPwogICAgICBidXR0b24uZHJvcGRvd24uZmluZCgKICAgICAgZnVuY3Rpb24gKGQpIHtyZXR1cm4gKAogICAgICAgICAgZC5kaXNwbGF5LnRvTG93ZXJDYXNlKCkgPT0KICAgICAgICAgIGV2ZW50LmN1cnJlbnRUYXJnZXQudmFsdWUudG9Mb3dlckNhc2UoKSk7fSkgOgoKICAgICAgbnVsbDsKCiAgICAgIGlmIChidXR0b24uZHJvcGRvd24gIT0gbnVsbCAmJiBkcm9wZG93blZhbHVlID09IG51bGwpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciB2YWwgPQogICAgICBkcm9wZG93blZhbHVlICE9IG51bGwgPyBkcm9wZG93blZhbHVlLnZhbHVlIDogZXZlbnQuY3VycmVudFRhcmdldC52YWx1ZTsKCiAgICAgIGlmICghYnV0dG9uLmFsbG93RHVwbGljYXRlVGFncykgewogICAgICAgIGlmICgKICAgICAgICBidXR0b24udmFsdWUuCiAgICAgICAgc3BsaXQoYnV0dG9uLnRhZ3NTZXBlcmF0b3IpLgogICAgICAgIGZpbmQoZnVuY3Rpb24gKGQpIHtyZXR1cm4gZC50b0xvd2VyQ2FzZSgpID09IHZhbC50b0xvd2VyQ2FzZSgpO30pICE9IG51bGwpCiAgICAgICAgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQoKICAgICAgYWRkVGFnKAogICAgICBkcm9wZG93blZhbHVlICE9IG51bGwgPyBkcm9wZG93blZhbHVlIDogeyBkaXNwbGF5OiB2YWwsIHZhbHVlOiB2YWwgfSk7CgogICAgfSBlbHNlIGlmICgKICAgIGV2ZW50LmtleSA9PT0gIkJhY2tzcGFjZSIgJiYKICAgIHRhZ3MubGVuZ3RoICYmCiAgICBldmVudC5jdXJyZW50VGFyZ2V0LnZhbHVlLmxlbmd0aCA9PSAwKQogICAgewogICAgICBzZXRTZWFyY2hWYWx1ZSh0YWdzW3RhZ3MubGVuZ3RoIC0gMV0uZGlzcGxheSk7CgogICAgICB2YXIgdGFnc0NvcHkgPSBfdG9Db25zdW1hYmxlQXJyYXkodGFncyk7CiAgICAgIHRhZ3NDb3B5LnBvcCgpOwogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBzZXRUYWdzKHRhZ3NDb3B5KTsKCiAgICAgIHZhciB2YWxzID0gYnV0dG9uLnZhbHVlLgogICAgICBzcGxpdChidXR0b24udGFnc1NlcGVyYXRvcikuCiAgICAgIGZpbHRlcihmdW5jdGlvbiAocykge3JldHVybiBzLmxlbmd0aCA+IDA7fSk7CiAgICAgIHZhbHMucG9wKCk7CiAgICAgIGJ1dHRvbi5zZXRWYWx1ZSh2YWxzLmpvaW4oYnV0dG9uLnRhZ3NTZXBlcmF0b3IpKTsKICAgIH0KICB9OwoKICAvL1JlbW92ZSB0YWdzIGJ5IGNsaWNraW5nIHRoZSBjcm9zcyBzaWduCiAgdmFyIHJlbW92ZVRhZ3MgPSBmdW5jdGlvbiByZW1vdmVUYWdzKGluZGV4KSB7CiAgICBzZXRMYXN0SW5zZXJ0ZWQoLTEpOwogICAgc2V0VGFncyhfdG9Db25zdW1hYmxlQXJyYXkodGFncy5maWx0ZXIoZnVuY3Rpb24gKHRhZywgaW5kKSB7cmV0dXJuIGluZCAhPT0gaW5kZXg7fSkpKTsKCiAgICB2YXIgdmFscyA9IGJ1dHRvbi52YWx1ZS4KICAgIHNwbGl0KGJ1dHRvbi50YWdzU2VwZXJhdG9yKS4KICAgIGZpbHRlcihmdW5jdGlvbiAocykge3JldHVybiBzLmxlbmd0aCA+IDA7fSkuCiAgICBmaWx0ZXIoZnVuY3Rpb24gKHYsIGluZCkge3JldHVybiBpbmQgIT09IGluZGV4O30pOwoKICAgIGJ1dHRvbi5zZXRWYWx1ZSh2YWxzLmpvaW4oYnV0dG9uLnRhZ3NTZXBlcmF0b3IpKTsKICB9OwoKICB2YXIgX3VzZVN0YXRlID0gKDAscmVhY3QudXNlU3RhdGUpKGZhbHNlKSxfdXNlU3RhdGUyID0gVGFnc0lucHV0X3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlLCAyKSxzaG93TWVudSA9IF91c2VTdGF0ZTJbMF0sc2V0U2hvd01lbnUgPSBfdXNlU3RhdGUyWzFdOwogIHZhciBfdXNlU3RhdGUzID0gKDAscmVhY3QudXNlU3RhdGUpKCIiKSxfdXNlU3RhdGU0ID0gVGFnc0lucHV0X3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlMywgMiksc2VhcmNoVmFsdWUgPSBfdXNlU3RhdGU0WzBdLHNldFNlYXJjaFZhbHVlID0gX3VzZVN0YXRlNFsxXTsKICB2YXIgc2VhcmNoUmVmID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZVJlZigpOwogIHZhciBzZWFyY2hDb250YWluZXJSZWYgPSAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlUmVmKCk7CiAgdmFyIGlucHV0UmVmID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZVJlZigpOwogIHZhciBfdXNlU3RhdGU1ID0gKDAscmVhY3QudXNlU3RhdGUpKC0xKSxfdXNlU3RhdGU2ID0gVGFnc0lucHV0X3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlNSwgMiksaW5zZXJ0SW5kZXhBdCA9IF91c2VTdGF0ZTZbMF0sc2V0SW5zZXJ0SW5kZXhBdCA9IF91c2VTdGF0ZTZbMV07CiAgdmFyIF91c2VTdGF0ZTcgPSAoMCxyZWFjdC51c2VTdGF0ZSkoLTEpLF91c2VTdGF0ZTggPSBUYWdzSW5wdXRfc2xpY2VkVG9BcnJheShfdXNlU3RhdGU3LCAyKSxkcmFnZ2VkSXRlbSA9IF91c2VTdGF0ZThbMF0sc2V0RHJhZ2dlZEl0ZW0gPSBfdXNlU3RhdGU4WzFdOwogIHZhciBfdXNlU3RhdGU5ID0gKDAscmVhY3QudXNlU3RhdGUpKC0xKSxfdXNlU3RhdGUxMCA9IFRhZ3NJbnB1dF9zbGljZWRUb0FycmF5KF91c2VTdGF0ZTksIDIpLGxhc3RJbnNlcnRlZCA9IF91c2VTdGF0ZTEwWzBdLHNldExhc3RJbnNlcnRlZCA9IF91c2VTdGF0ZTEwWzFdOwogIHZhciBfdXNlU3RhdGUxMSA9ICgwLHJlYWN0LnVzZVN0YXRlKSgwKSxfdXNlU3RhdGUxMiA9IFRhZ3NJbnB1dF9zbGljZWRUb0FycmF5KF91c2VTdGF0ZTExLCAyKSxkcmFnZ2VkV2lkdGggPSBfdXNlU3RhdGUxMlswXSxzZXREcmFnZ2VkV2lkdGggPSBfdXNlU3RhdGUxMlsxXTsKICB2YXIgX3VzZVN0YXRlMTMgPSAoMCxyZWFjdC51c2VTdGF0ZSkoMCksX3VzZVN0YXRlMTQgPSBUYWdzSW5wdXRfc2xpY2VkVG9BcnJheShfdXNlU3RhdGUxMywgMiksZHJhZ2dlZEhlaWdodCA9IF91c2VTdGF0ZTE0WzBdLHNldERyYWdnZWRIZWlnaHQgPSBfdXNlU3RhdGUxNFsxXTsKCiAgKDAscmVhY3QudXNlRWZmZWN0KShmdW5jdGlvbiAoKSB7CiAgICBpZiAoc2hvd01lbnUgJiYgc2VhcmNoUmVmLmN1cnJlbnQpIHsKICAgICAgc2VhcmNoUmVmLmN1cnJlbnQuZm9jdXMoKTsKICAgIH0KICB9LCBbc2hvd01lbnVdKTsKCiAgdmFyIG9uQWRkVGFnID0gZnVuY3Rpb24gb25BZGRUYWcob3B0aW9uKSB7CiAgICBpZiAoCiAgICAhYnV0dG9uLmFsbG93RHVwbGljYXRlVGFncyAmJgogICAgdGFncy5maW5kKGZ1bmN0aW9uICh0KSB7CiAgICAgIHQudmFsdWUgPT0gb3B0aW9uLnZhbHVlOwogICAgfSkpCiAgICB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBhZGRUYWcob3B0aW9uKTsKCiAgICBpZiAoc2VhcmNoUmVmLmN1cnJlbnQgIT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkgewogICAgICBzZXRTaG93TWVudShmYWxzZSk7CiAgICB9CiAgfTsKCiAgdmFyIG9uU2VhcmNoID0gZnVuY3Rpb24gb25TZWFyY2goZSkgewogICAgc2V0U2VhcmNoVmFsdWUoZS50YXJnZXQudmFsdWUpOwogIH07CgogIHZhciBnZXRPcHRpb25zID0gZnVuY3Rpb24gZ2V0T3B0aW9ucygpIHsKICAgIHZhciBvcHRzID0gYnV0dG9uLmFsbG93RHVwbGljYXRlVGFncyA/CiAgICBidXR0b24uZHJvcGRvd24gOgogICAgYnV0dG9uLmRyb3Bkb3duLmZpbHRlcihmdW5jdGlvbiAoZCkge3JldHVybiAhdGFncy5pbmNsdWRlcyhkKTt9KTsKCiAgICBpZiAoIXNlYXJjaFZhbHVlKSB7CiAgICAgIHJldHVybiBvcHRzOwogICAgfQoKICAgIHJldHVybiBvcHRzLmZpbHRlcigKICAgIGZ1bmN0aW9uIChvcHRpb24pIHtyZXR1cm4gKAogICAgICAgIG9wdGlvbi5kaXNwbGF5LnRvTG93ZXJDYXNlKCkuaW5kZXhPZihzZWFyY2hWYWx1ZS50b0xvd2VyQ2FzZSgpKSA+PSAwKTt9KTsKCiAgfTsKCiAgdmFyIGRyb3Bkb3duRm9jdXNIYW5kbGVyID0gZnVuY3Rpb24gZHJvcGRvd25Gb2N1c0hhbmRsZXIoKSB7CiAgICBpZiAoc2VhcmNoQ29udGFpbmVyUmVmLmN1cnJlbnQgPT0gbnVsbCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKCEoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCBpbnN0YW5jZW9mIE5vZGUpKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoc2VhcmNoQ29udGFpbmVyUmVmLmN1cnJlbnQuY29udGFpbnMoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHNldFNob3dNZW51KGZhbHNlKTsKICB9OwoKICAoMCxyZWFjdC51c2VFZmZlY3QpKGZ1bmN0aW9uICgpIHsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uICgpIHtyZXR1cm4gZHJvcGRvd25Gb2N1c0hhbmRsZXIoKTt9KTsKCiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbiAoKSB7cmV0dXJuIGRyb3Bkb3duRm9jdXNIYW5kbGVyKCk7fSk7CiAgICB9OwogIH0pOwoKICB2YXIgdXBkYXRlSW5kZXhJbnNlcnQgPSBmdW5jdGlvbiB1cGRhdGVJbmRleEluc2VydChlKSB7dmFyIF90YWckZ2V0QXR0cmlidXRlOwogICAgaWYgKGlucHV0UmVmLmN1cnJlbnQgPT0gbnVsbCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIHRhZyA9IGUuY3VycmVudFRhcmdldDsKICAgIHZhciB0YWdJZCA9ICsoKF90YWckZ2V0QXR0cmlidXRlID0gdGFnLmdldEF0dHJpYnV0ZSgiZGF0YS1rZXkiKSkgIT09IG51bGwgJiYgX3RhZyRnZXRBdHRyaWJ1dGUgIT09IHZvaWQgMCA/IF90YWckZ2V0QXR0cmlidXRlIDogLTEwKTsKCiAgICB2YXIgYiA9CiAgICB0YWcucXVlcnlTZWxlY3RvcigiLnNldHRpbmdUYWdTaW5nbGUiKS4KICAgIGdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgdmFyIG9mZnNldCA9IGUuY2xpZW50WCAtIChiLmxlZnQgKyBiLndpZHRoIC8gMik7CgogICAgaWYgKG9mZnNldCA+PSAwKSB7CiAgICAgIHRhZ0lkKys7CiAgICB9CgogICAgc2V0SW5zZXJ0SW5kZXhBdCh0YWdJZCk7CiAgfTsKCiAgdmFyIGRyYWdFbmQgPSBmdW5jdGlvbiBkcmFnRW5kKCkgewogICAgaWYgKGRyYWdnZWRJdGVtID09IC0xKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoaW5zZXJ0SW5kZXhBdCAtIDEgIT0gZHJhZ2dlZEl0ZW0gJiYgaW5zZXJ0SW5kZXhBdCAhPSBkcmFnZ2VkSXRlbSkgewogICAgICB2YXIgbmV3SW5kZXggPSBpbnNlcnRJbmRleEF0OwogICAgICB2YXIgbmV3VGFncyA9IF90b0NvbnN1bWFibGVBcnJheSh0YWdzKTsKICAgICAgbmV3VGFncy5zcGxpY2UoZHJhZ2dlZEl0ZW0sIDEpOwogICAgICBuZXdUYWdzLnNwbGljZSgKICAgICAgbmV3SW5kZXggLSAoZHJhZ2dlZEl0ZW0gPCBuZXdJbmRleCA/IDEgOiAwKSwKICAgICAgMCwKICAgICAgdGFnc1tkcmFnZ2VkSXRlbV0pOwoKCiAgICAgIHNldFRhZ3MobmV3VGFncyk7CiAgICAgIHNldExhc3RJbnNlcnRlZChuZXdJbmRleCAtIChkcmFnZ2VkSXRlbSA8IG5ld0luZGV4ID8gMSA6IDApKTsKICAgIH0gZWxzZSB7CiAgICAgIHNldExhc3RJbnNlcnRlZCgtMSk7CiAgICB9CgogICAgc2V0RHJhZ2dlZEl0ZW0oLTEpOwogICAgc2V0SW5zZXJ0SW5kZXhBdCgtMSk7CiAgfTsKCiAgdmFyIHN0cmluZ1RvQ29sb3VyID0gZnVuY3Rpb24gc3RyaW5nVG9Db2xvdXIoc3RyKSB7CiAgICB2YXIgaGFzaCA9IDA7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHsKICAgICAgaGFzaCA9IHN0ci5jaGFyQ29kZUF0KGkpICsgKChoYXNoIDw8IDUpIC0gaGFzaCk7CiAgICB9CgogICAgdmFyIGNvbG91ciA9ICIjIjsKCiAgICBmb3IgKHZhciBfaTIgPSAwOyBfaTIgPCAzOyBfaTIrKykgewogICAgICB2YXIgdmFsdWUgPSBoYXNoID4+IF9pMiAqIDggJiAweGZmOwogICAgICBjb2xvdXIgKz0gKCIwMCIgKyB2YWx1ZS50b1N0cmluZygxNikpLnN1YnN0cigtMik7CiAgICB9CgogICAgcmV0dXJuIGNvbG91cjsKICB9OwoKICByZXR1cm4gLyojX19QVVJFX18qLygKICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAic2V0dGluZ1RhZyIsIHJlZjogaW5wdXRSZWYgfSwKICAgIHRhZ3MubWFwKGZ1bmN0aW9uICh0YWcsIGluZGV4KSB7cmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChyZWFjdC5GcmFnbWVudCwgeyBrZXk6ICIiLmNvbmNhdCh0YWcuZGlzcGxheSwgIiAiKS5jb25jYXQodGFnLnZhbHVlLCAiICIpLmNvbmNhdChpbmRleCkgfSwKICAgICAgICBkcmFnZ2VkSXRlbSA+PSAwICYmCiAgICAgICAgaW5kZXggPT0gMCAmJgogICAgICAgIGluZGV4ID09IGluc2VydEluZGV4QXQgJiYKICAgICAgICBpbnNlcnRJbmRleEF0ICE9IGRyYWdnZWRJdGVtICYmCiAgICAgICAgZHJhZ2dlZEl0ZW0gIT0gaW5zZXJ0SW5kZXhBdCAtIDEgPyAvKiNfX1BVUkVfXyovCiAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgY2xhc3NOYW1lOiAiaGludFRhZ0Ryb3AiLAogICAgICAgICAgb25EcmFnT3ZlcjogZnVuY3Rpb24gb25EcmFnT3ZlcihlKSB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgIH0sCiAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICB3aWR0aDogZHJhZ2dlZFdpZHRoICsgInB4IiwKICAgICAgICAgICAgaGVpZ2h0OiBkcmFnZ2VkSGVpZ2h0ICsgInB4IgogICAgICAgICAgfSB9KSA6IC8qI19fUFVSRV9fKi8KCgogICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQocmVhY3QuRnJhZ21lbnQsIG51bGwpLAoKICAgICAgICBkcmFnZ2VkSXRlbSA9PSBpbmRleCA/IC8qI19fUFVSRV9fKi8KICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICBjbGFzc05hbWU6ICJoaW50VGFnRHJvcCBoaW50VGFnRHJvcE9yaWdpbmFsIiwKICAgICAgICAgIG9uRHJhZ092ZXI6IGZ1bmN0aW9uIG9uRHJhZ092ZXIoZSkgewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICB9LAogICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgd2lkdGg6IGRyYWdnZWRXaWR0aCArICJweCIsCiAgICAgICAgICAgIGhlaWdodDogZHJhZ2dlZEhlaWdodCArICJweCIsCiAgICAgICAgICAgIGRpc3BsYXk6CiAgICAgICAgICAgIGluc2VydEluZGV4QXQgPT0gaW5kZXggfHwgaW5zZXJ0SW5kZXhBdCAtIDEgPT0gaW5kZXggPwogICAgICAgICAgICAiaW5saW5lIiA6CiAgICAgICAgICAgICJub25lIgogICAgICAgICAgfSB9KSA6IC8qI19fUFVSRV9fKi8KCgogICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQocmVhY3QuRnJhZ21lbnQsIG51bGwpLCAvKiNfX1BVUkVfXyovCgogICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgIGRyYWdnYWJsZTogdHJ1ZSwKICAgICAgICAgIG9uRHJhZ1N0YXJ0OiBmdW5jdGlvbiBvbkRyYWdTdGFydChlKSB7CiAgICAgICAgICAgIHZhciBpbmQgPSBpbmRleDsKICAgICAgICAgICAgdmFyIHdpZCA9IGUuY3VycmVudFRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCAtIDEwOwogICAgICAgICAgICB2YXIgaGVpZ2h0ID0gZS5jdXJyZW50VGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodCAtIDI7CgogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBzZXRJbnNlcnRJbmRleEF0KGluZCk7CiAgICAgICAgICAgICAgc2V0RHJhZ2dlZEl0ZW0oaW5kKTsKICAgICAgICAgICAgICBzZXREcmFnZ2VkV2lkdGgod2lkKTsKICAgICAgICAgICAgICBzZXREcmFnZ2VkSGVpZ2h0KGhlaWdodCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIG9uRHJhZ0VuZDogZnVuY3Rpb24gb25EcmFnRW5kKCkgewogICAgICAgICAgICBkcmFnRW5kKCk7CiAgICAgICAgICB9LAogICAgICAgICAgb25EcmFnT3ZlcjogZnVuY3Rpb24gb25EcmFnT3ZlcihlKSB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgICAgIHVwZGF0ZUluZGV4SW5zZXJ0KGUpOwogICAgICAgICAgfSwKICAgICAgICAgICJkYXRhLWtleSI6IGluZGV4LAogICAgICAgICAgY2xhc3NOYW1lOiAidGFnQ29udGFpbmVyIiArIChkcmFnZ2VkSXRlbSA9PSBpbmRleCA/ICIgaGlkZGVuIiA6ICIiKSB9LCAvKiNfX1BVUkVfXyovCgogICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgIGNsYXNzTmFtZToKICAgICAgICAgICJzZXR0aW5nVGFnU2luZ2xlIiArICgKICAgICAgICAgIGluZGV4ID09IGRyYWdnZWRJdGVtID8gIiBkcmFnZ2VkSXRlbSIgOiAiIikgKyAoCiAgICAgICAgICBsYXN0SW5zZXJ0ZWQgPT0gaW5kZXggPyAiIHJlYXJyYW5nZWRUYWciIDogIiIpLAoKICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogIiIuY29uY2F0KHN0cmluZ1RvQ29sb3VyKCIiLmNvbmNhdCgKICAgICAgICAgICAgdGFnLmRpc3BsYXksICIgIikuY29uY2F0KHRhZy52YWx1ZSkpLCAiMjIiKQoKICAgICAgICAgIH0gfSwgLyojX19QVVJFX18qLwoKICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgbnVsbCwgdGFnLmRpc3BsYXkpLCAvKiNfX1BVUkVfXyovCiAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgY2xhc3NOYW1lOiAic2V0dGluZ1RhZ0Nsb3NlIiwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7cmV0dXJuIHJlbW92ZVRhZ3MoaW5kZXgpO30gfSwgLyojX19QVVJFX18qLwoKICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KENsb3NlSWNvbiwgbnVsbCkpKSksCgoKCiAgICAgICAgZHJhZ2dlZEl0ZW0gPj0gMCAmJgogICAgICAgIGluZGV4ICsgMSA9PSBpbnNlcnRJbmRleEF0ICYmCiAgICAgICAgZHJhZ2dlZEl0ZW0gKyAxICE9IGluc2VydEluZGV4QXQgJiYKICAgICAgICBkcmFnZ2VkSXRlbSAhPSBpbnNlcnRJbmRleEF0ID8gLyojX19QVVJFX18qLwogICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgIGNsYXNzTmFtZTogImhpbnRUYWdEcm9wIiwKICAgICAgICAgIG9uRHJhZ092ZXI6IGZ1bmN0aW9uIG9uRHJhZ092ZXIoZSkgewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICB9LAogICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgd2lkdGg6IGRyYWdnZWRXaWR0aCArICJweCIsCiAgICAgICAgICAgIGhlaWdodDogZHJhZ2dlZEhlaWdodCArICJweCIKICAgICAgICAgIH0gfSkgOiAvKiNfX1BVUkVfXyovCgoKICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHJlYWN0LkZyYWdtZW50LCBudWxsKSkpO30pLCAvKiNfX1BVUkVfXyovCgoKCiAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgIHJlZjogc2VhcmNoQ29udGFpbmVyUmVmLAogICAgICBjbGFzc05hbWU6CiAgICAgICJzZXR0aW5nVGFnSW5wdXQiICsgKAogICAgICBidXR0b24ubWF4VGFncyAmJiB0YWdzLmxlbmd0aCA+PSBwYXJzZUludChidXR0b24ubWF4VGFncykgPwogICAgICAiIGhpZGRlbiIgOgogICAgICAiIikgfSwgLyojX19QVVJFX18qLwoKCiAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCBudWxsLCAvKiNfX1BVUkVfXyovCiAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJpbnB1dCIsIHsKICAgICAgdHlwZTogInRleHQiLAogICAgICBvbkNoYW5nZTogb25TZWFyY2gsCiAgICAgIHBsYWNlaG9sZGVyOiBidXR0b24ucGxhY2Vob2xkZXJUZXh0ID8gYnV0dG9uLnBsYWNlaG9sZGVyVGV4dCA6ICIiLAogICAgICB2YWx1ZTogc2VhcmNoVmFsdWUsCiAgICAgIHJlZjogc2VhcmNoUmVmLAogICAgICBvbkZvY3VzOiBmdW5jdGlvbiBvbkZvY3VzKCkge3JldHVybiBzZXRTaG93TWVudSh0cnVlKTt9LAogICAgICBvbktleURvd246IGZ1bmN0aW9uIG9uS2V5RG93bihldmVudCkge3JldHVybiBoYW5kbGVUYWdzKGV2ZW50KTt9LAogICAgICBzaXplOiAxMCB9KSksCgoKCiAgICBidXR0b24uZHJvcGRvd24gPT0gbnVsbCA/IC8qI19fUFVSRV9fKi8KICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQocmVhY3QuRnJhZ21lbnQsIG51bGwpIDogLyojX19QVVJFX18qLwoKICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQocmVhY3QuRnJhZ21lbnQsIG51bGwsCiAgICBzaG93TWVudSAmJiBnZXRPcHRpb25zKCkubGVuZ3RoID4gMCAmJiAvKiNfX1BVUkVfXyovCiAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogImRyb3Bkb3duTWVudSIgfSwKICAgIGdldE9wdGlvbnMoKS5tYXAoZnVuY3Rpb24gKG9wdGlvbiwgaW5kZXgpIHtyZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICBrZXk6IGluZGV4LAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHtyZXR1cm4gb25BZGRUYWcob3B0aW9uKTt9LAogICAgICAgICAgY2xhc3NOYW1lOiAiZHJvcGRvd25JdGVtIiB9LAoKICAgICAgICBvcHRpb24uZGlzcGxheSkpO30pKSkpKSk7CgoKCgoKCgoKCn07CgovKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIGNvbnN0IHNldHRpbmdzX1RhZ3NJbnB1dCA9IChUYWdzSW5wdXQpOwo7Ly8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvY29tcG9uZW50cy9zZXR0aW5ncy9TZXR0aW5nLnRzeApmdW5jdGlvbiBTZXR0aW5nX3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7cmV0dXJuIFNldHRpbmdfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBTZXR0aW5nX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgU2V0dGluZ191bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShhcnIsIGkpIHx8IFNldHRpbmdfbm9uSXRlcmFibGVSZXN0KCk7fWZ1bmN0aW9uIFNldHRpbmdfbm9uSXRlcmFibGVSZXN0KCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7fWZ1bmN0aW9uIFNldHRpbmdfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobywgbWluTGVuKSB7aWYgKCFvKSByZXR1cm47aWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIFNldHRpbmdfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO3ZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTtpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTtpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pO2lmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIFNldHRpbmdfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO31mdW5jdGlvbiBTZXR0aW5nX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHtpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDtmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIHthcnIyW2ldID0gYXJyW2ldO31yZXR1cm4gYXJyMjt9ZnVuY3Rpb24gU2V0dGluZ19pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHt2YXIgX2kgPSBhcnIgPT0gbnVsbCA/IG51bGwgOiB0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBhcnJbU3ltYm9sLml0ZXJhdG9yXSB8fCBhcnJbIkBAaXRlcmF0b3IiXTtpZiAoX2kgPT0gbnVsbCkgcmV0dXJuO3ZhciBfYXJyID0gW107dmFyIF9uID0gdHJ1ZTt2YXIgX2QgPSBmYWxzZTt2YXIgX3MsIF9lO3RyeSB7Zm9yIChfaSA9IF9pLmNhbGwoYXJyKTsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkge19hcnIucHVzaChfcy52YWx1ZSk7aWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrO319IGNhdGNoIChlcnIpIHtfZCA9IHRydWU7X2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO31mdW5jdGlvbiBTZXR0aW5nX2FycmF5V2l0aEhvbGVzKGFycikge2lmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7fQoKCgoKCgoKZnVuY3Rpb24gU2V0dGluZyhfcmVmKQoKCgoKCnt2YXIgYnV0dG9uID0gX3JlZi5idXR0b24sdmFsaWRhdG9yID0gX3JlZi52YWxpZGF0b3I7CiAgdmFyIF91c2VTdGF0ZSA9ICgwLHJlYWN0LnVzZVN0YXRlKSh2YWxpZGF0b3IuaXNWYWxpZChidXR0b24pKSxfdXNlU3RhdGUyID0gU2V0dGluZ19zbGljZWRUb0FycmF5KF91c2VTdGF0ZSwgMiksdmFsaWQgPSBfdXNlU3RhdGUyWzBdLHNldFZhbGlkID0gX3VzZVN0YXRlMlsxXTsKCiAgYnV0dG9uLnNldFZhbHVlID0gZnVuY3Rpb24gKHZhbCkgewogICAgYnV0dG9uLnZhbHVlID0gdmFsOwogICAgdmFsaWRhdG9yLnVwZGF0ZVNldHRpbmcoYnV0dG9uKTsKICB9OwoKICB2YWxpZGF0b3IuYWRkU2V0dGluZyhidXR0b24sIHNldFZhbGlkKTsKCiAgcmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJ0ciIsIHsgY2xhc3NOYW1lOiAidXNlclByZWZlcmVuY2UiLCAiZGF0YS1uYW1lIjogYnV0dG9uLm5hbWUgfSwgLyojX19QVVJFX18qLwogICAgcmVhY3QuY3JlYXRlRWxlbWVudCgidGQiLCB7IGNsYXNzTmFtZTogInNldHRpbmciIH0sCiAgICBidXR0b24ubmFtZSwgLyojX19QVVJFX18qLwogICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJzZXR0aW5nTmFtZUhvdmVyIiB9LCBidXR0b24ucHJlZmVyZW5jZSkpLCAvKiNfX1BVUkVfXyovCgogICAgcmVhY3QuY3JlYXRlRWxlbWVudCgidGQiLCB7IGNsYXNzTmFtZTogdmFsaWQgPyAic2V0dGluZ0lucHV0IiA6ICJzZXR0aW5nSW5wdXQgaW52YWxpZC1zZXR0aW5nIiB9LAogICAgYnV0dG9uLnR5cGUgPT09IFJlbGF5Q29tcG9uZW50VHlwZS5CT09MRUFOID8gLyojX19QVVJFX18qLwogICAgcmVhY3QuY3JlYXRlRWxlbWVudChzZXR0aW5nc19Cb29sZWFuSW5wdXQsIHsgYnV0dG9uOiBidXR0b24gfSkgOgogICAgYnV0dG9uLnR5cGUgPT09IFJlbGF5Q29tcG9uZW50VHlwZS5EUk9QRE9XTiA/IC8qI19fUFVSRV9fKi8KICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoc2V0dGluZ3NfRHJvcGRvd25JbnB1dCwgeyBidXR0b246IGJ1dHRvbiB9KSA6CiAgICBidXR0b24udHlwZSA9PSBSZWxheUNvbXBvbmVudFR5cGUuVEFHUyA/IC8qI19fUFVSRV9fKi8KICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoc2V0dGluZ3NfVGFnc0lucHV0LCB7IGJ1dHRvbjogYnV0dG9uIH0pIDogLyojX19QVVJFX18qLwoKICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoc2V0dGluZ3NfU3RyaW5nSW5wdXQsIHsgYnV0dG9uOiBidXR0b24gfSksCgogICAgYnV0dG9uLmludmFsaWRSZWFzb24gIT0gbnVsbCA/IC8qI19fUFVSRV9fKi8KICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiaW52YWxpZC1yZWFzb24iLCBoaWRkZW46IHZhbGlkIH0sIC8qI19fUFVSRV9fKi8KICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInNtYWxsIiwgbnVsbCwgYnV0dG9uLmludmFsaWRSZWFzb24pKSA6IC8qI19fUFVSRV9fKi8KCgogICAgcmVhY3QuY3JlYXRlRWxlbWVudChyZWFjdC5GcmFnbWVudCwgbnVsbCksIC8qI19fUFVSRV9fKi8KCgogICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJob3ZlckJveCIgfSwgLyojX19QVVJFX18qLwogICAgcmVhY3QuY3JlYXRlRWxlbWVudCgic21hbGwiLCB7IGNsYXNzTmFtZTogInNldHRpbmdEZWZhdWx0SG92ZXIiIH0sCiAgICBidXR0b25bImRlZmF1bHQiXSAhPSBudWxsID8KICAgICJEZWZhdWx0OiAiICsgKAogICAgYnV0dG9uWyJkZWZhdWx0Il0gPT0gIiIgPyAiPEVtcHR5PiIgOiBidXR0b25bImRlZmF1bHQiXSkgOgogICAgIkRlZmF1bHQgbm90IHNldCIpKSksIC8qI19fUFVSRV9fKi8KCgoKICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInRkIiwgbnVsbCwgYnV0dG9uLmRlc2NyaXB0aW9uKSkpOwoKCn0KCi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gY29uc3Qgc2V0dGluZ3NfU2V0dGluZyA9IChTZXR0aW5nKTsKOy8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L3JvdXRlcy9SZWxheVBhZ2UudHN4CmZ1bmN0aW9uIFJlbGF5UGFnZV9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKG8sIGFsbG93QXJyYXlMaWtlKSB7dmFyIGl0ID0gdHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgb1tTeW1ib2wuaXRlcmF0b3JdIHx8IG9bIkBAaXRlcmF0b3IiXTtpZiAoIWl0KSB7aWYgKEFycmF5LmlzQXJyYXkobykgfHwgKGl0ID0gUmVsYXlQYWdlX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8pKSB8fCBhbGxvd0FycmF5TGlrZSAmJiBvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHtpZiAoaXQpIG8gPSBpdDt2YXIgaSA9IDA7dmFyIEYgPSBmdW5jdGlvbiBGKCkge307cmV0dXJuIHsgczogRiwgbjogZnVuY3Rpb24gbigpIHtpZiAoaSA+PSBvLmxlbmd0aCkgcmV0dXJuIHsgZG9uZTogdHJ1ZSB9O3JldHVybiB7IGRvbmU6IGZhbHNlLCB2YWx1ZTogb1tpKytdIH07fSwgZTogZnVuY3Rpb24gZShfZSkge3Rocm93IF9lO30sIGY6IEYgfTt9dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGl0ZXJhdGUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO312YXIgbm9ybWFsQ29tcGxldGlvbiA9IHRydWUsZGlkRXJyID0gZmFsc2UsZXJyO3JldHVybiB7IHM6IGZ1bmN0aW9uIHMoKSB7aXQgPSBpdC5jYWxsKG8pO30sIG46IGZ1bmN0aW9uIG4oKSB7dmFyIHN0ZXAgPSBpdC5uZXh0KCk7bm9ybWFsQ29tcGxldGlvbiA9IHN0ZXAuZG9uZTtyZXR1cm4gc3RlcDt9LCBlOiBmdW5jdGlvbiBlKF9lMikge2RpZEVyciA9IHRydWU7ZXJyID0gX2UyO30sIGY6IGZ1bmN0aW9uIGYoKSB7dHJ5IHtpZiAoIW5vcm1hbENvbXBsZXRpb24gJiYgaXRbInJldHVybiJdICE9IG51bGwpIGl0WyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKGRpZEVycikgdGhyb3cgZXJyO319IH07fWZ1bmN0aW9uIFJlbGF5UGFnZV91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHtpZiAoIW8pIHJldHVybjtpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKSByZXR1cm4gUmVsYXlQYWdlX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7aWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7aWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShvKTtpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBSZWxheVBhZ2VfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO31mdW5jdGlvbiBSZWxheVBhZ2VfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikge2lmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoO2ZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykge2FycjJbaV0gPSBhcnJbaV07fXJldHVybiBhcnIyO30KCgoKCgoKZnVuY3Rpb24gUmVsYXlQYWdlKF9yZWYpCgoKCnt2YXIgY29tcG9uZW50cyA9IF9yZWYuY29tcG9uZW50czsKICB2YXIgZ3JvdXBzID0gW107CiAgdmFyIGN1cnJlbnRHcm91cCA9IG51bGw7dmFyIF9pdGVyYXRvciA9IFJlbGF5UGFnZV9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKAoKICAgIGNvbXBvbmVudHMpLF9zdGVwO3RyeSB7Zm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTspIHt2YXIgY29tcG9uZW50ID0gX3N0ZXAudmFsdWU7CiAgICAgIGlmICgKICAgICAgY29tcG9uZW50LnR5cGUgPT0gUmVsYXlDb21wb25lbnRUeXBlLkhUTUwgfHwKICAgICAgY29tcG9uZW50LnR5cGUgPT0gUmVsYXlDb21wb25lbnRUeXBlLklOVEVSUlVQVCkKICAgICAgewogICAgICAgIGdyb3Vwcy5wdXNoKGNvbXBvbmVudCk7CiAgICAgICAgY3VycmVudEdyb3VwID0gbnVsbDsKICAgICAgICBjb250aW51ZTsKICAgICAgfQoKICAgICAgaWYgKGN1cnJlbnRHcm91cCA9PSBudWxsKSB7CiAgICAgICAgY3VycmVudEdyb3VwID0gW107CiAgICAgICAgZ3JvdXBzLnB1c2goY3VycmVudEdyb3VwKTsKICAgICAgfQoKICAgICAgY3VycmVudEdyb3VwLnB1c2goY29tcG9uZW50KTsKICAgIH19IGNhdGNoIChlcnIpIHtfaXRlcmF0b3IuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yLmYoKTt9CgogIHZhciBlbGVtZW50cyA9IFtdOwogIHZhciB2YWxpZGF0b3IgPSBuZXcgYXBpX1NldHRpbmdWYWxpZGF0b3IoKTsKCiAgZ3JvdXBzLmZvckVhY2goZnVuY3Rpb24gKGNvbXBvbmVudHMsIGluZGV4KSB7CiAgICBpZiAoY29tcG9uZW50cy50eXBlID09IFJlbGF5Q29tcG9uZW50VHlwZS5IVE1MKSB7CiAgICAgIHZhciBodG1sID0gY29tcG9uZW50czsKCiAgICAgIGlmIChodG1sLmRhdGEgPT0gbnVsbCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgZWxlbWVudHMucHVzaCggLyojX19QVVJFX18qLwogICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAga2V5OiAiSFRNTCAiLmNvbmNhdChpbmRleCksCiAgICAgICAgZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUw6IHsKICAgICAgICAgIF9faHRtbDogY29tcG9uZW50cy5kYXRhCiAgICAgICAgfSB9KSk7CgoKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmIChjb21wb25lbnRzLnR5cGUgPT0gUmVsYXlDb21wb25lbnRUeXBlLklOVEVSUlVQVCkgewogICAgICBlbGVtZW50cy5wdXNoKCAvKiNfX1BVUkVfXyovCiAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoY29tcG9uZW50c19JbnRlcnJ1cHQsIHsKICAgICAgICBrZXk6ICJJbnRlcnJ1cHQgIi5jb25jYXQoaW5kZXgpLAogICAgICAgIGJ1dHRvbjogY29tcG9uZW50cyB9KSk7CgoKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBidXR0b25zID0gY29tcG9uZW50czsKCiAgICBlbGVtZW50cy5wdXNoKCAvKiNfX1BVUkVfXyovCiAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJ0YWJsZSIsIHsga2V5OiAiVGFibGUgIi5jb25jYXQoaW5kZXgpLCBjbGFzc05hbWU6ICJyZWxheVRhYmxlIiB9LCAvKiNfX1BVUkVfXyovCiAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJ0Ym9keSIsIG51bGwsCiAgICBidXR0b25zLm1hcChmdW5jdGlvbiAoc2V0dGluZywgaW5kZXgpIHtyZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHNldHRpbmdzX1NldHRpbmcsIHsKICAgICAgICAgIGtleTogIlNldHRpbmcgIi5jb25jYXQoc2V0dGluZy5uYW1lLCAiICIpLmNvbmNhdChzZXR0aW5nLnByZWZlcmVuY2UsICIgIikuY29uY2F0KGluZGV4KSwKICAgICAgICAgIGJ1dHRvbjogc2V0dGluZywKICAgICAgICAgIHZhbGlkYXRvcjogdmFsaWRhdG9yIH0pKTt9KSkpKTsKCgoKCgogIH0pOwoKICB2YWxpZGF0b3IudXBkYXRlT2JqZWN0KCk7CgogIC8vIElmIHdlIGhhdmUgbm8gc2V0dGluZ3MgaW4gd2hpY2ggd2UnZCBzYXZlIHN0dWZmLCBkb24ndCBib3RoZXIgcmVuZGVyaW5nIHNhdmUgYnV0dG9uCiAgaWYgKAogIGNvbXBvbmVudHMuZmluZChmdW5jdGlvbiAoYykge3JldHVybiBjLnByZWZlcmVuY2UgIT0gbnVsbDt9KSA9PSBudWxsKQogIHsKICAgIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChyZWFjdC5GcmFnbWVudCwgbnVsbCwgZWxlbWVudHMpOwogIH0KCiAgcmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICByZWFjdC5jcmVhdGVFbGVtZW50KHJlYWN0LkZyYWdtZW50LCBudWxsLAogICAgIiAiLAogICAgZWxlbWVudHMsICIgIiwgLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoImJyIiwgbnVsbCksIC8qI19fUFVSRV9fKi8KICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImlucHV0IiwgewogICAgICBjbGFzc05hbWU6ICJzYXZlIiwKICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHtyZXR1cm4gKAogICAgICAgICAgc2F2ZVNldHRpbmdzKAogICAgICAgICAgY29tcG9uZW50cy5maWx0ZXIoCiAgICAgICAgICBmdW5jdGlvbiAoYikge3JldHVybiBiLnByZWZlcmVuY2UgIT0gbnVsbDt9KSkuCgogICAgICAgICAgdGhlbihmdW5jdGlvbiAobm90aWZzKSB7dmFyIF9pdGVyYXRvcjIgPSBSZWxheVBhZ2VfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcigKICAgICAgICAgICAgICBub3RpZnMpLF9zdGVwMjt0cnkge2ZvciAoX2l0ZXJhdG9yMi5zKCk7ICEoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uKCkpLmRvbmU7KSB7dmFyIG5vdGlmID0gX3N0ZXAyLnZhbHVlOwogICAgICAgICAgICAgICAgYWRkTm90aWZpY2F0aW9uKG5vdGlmKTsKICAgICAgICAgICAgICB9fSBjYXRjaCAoZXJyKSB7X2l0ZXJhdG9yMi5lKGVycik7fSBmaW5hbGx5IHtfaXRlcmF0b3IyLmYoKTt9CiAgICAgICAgICB9KSk7fSwKCiAgICAgIHR5cGU6ICJzdWJtaXQiLAogICAgICB2YWx1ZTogIlNhdmUgQ2hhbmdlcyIgfSkpKTsKCgoKfQoKLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyBjb25zdCByb3V0ZXNfUmVsYXlQYWdlID0gKFJlbGF5UGFnZSk7CjsvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9yZWxheS9BcHAudHN4CgoKCgoKCmZ1bmN0aW9uIEFwcChfcmVmKSB7dmFyIHBhZ2VzID0gX3JlZi5wYWdlczsKICByZXR1cm4gLyojX19QVVJFX18qLygKICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoTWVtb3J5Um91dGVyLCBudWxsLAogICAgIiAiLCAvKiNfX1BVUkVfXyovCiAgICByZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlcywgbnVsbCwKICAgICIgIiwgLyojX19QVVJFX18qLwogICAgcmVhY3QuY3JlYXRlRWxlbWVudChSb3V0ZSwgeyBlbGVtZW50OiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChjb21wb25lbnRzX0xheW91dCwgeyBwYWdlczogcGFnZXMgfSkgfSwKICAgICIgIiwgLyojX19QVVJFX18qLwogICAgcmVhY3QuY3JlYXRlRWxlbWVudChSb3V0ZSwgewogICAgICBwYXRoOiAiLyIsCiAgICAgIGVsZW1lbnQ6IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KE5hdmlnYXRlLCB7IHRvOiAiLyIgKyBwYWdlc1swXS5maWxlLCByZXBsYWNlOiB0cnVlIH0pIH0pLAogICAgIiAiLAogICAgcGFnZXMubWFwKGZ1bmN0aW9uIChwKSB7CiAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGUsIHsKICAgICAgICAgIGtleTogIiIuY29uY2F0KHAuZmlsZSwgIiAiKS5jb25jYXQocC5wYWdlKSwKICAgICAgICAgIHBhdGg6ICIvIiArIHAuZmlsZSwKICAgICAgICAgIGVsZW1lbnQ6IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KHJvdXRlc19SZWxheVBhZ2UsIHsgY29tcG9uZW50czogcC5jb21wb25lbnRzIH0pIH0pKTsKCgogICAgfSksICIgIiksCiAgICAiICIpLAogICAgIiAiKSk7CgoKfQoKLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyBjb25zdCByZWxheV9BcHAgPSAoQXBwKTsKCi8qKiovIH0pLAoKLyoqKi8gNDQ4OgovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgovKioKICogQGxpY2Vuc2UgUmVhY3QKICogcmVhY3QtZG9tLnByb2R1Y3Rpb24ubWluLmpzCiAqCiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLgogKgogKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGUKICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLgogKi8KLyoKIE1vZGVybml6ciAzLjAuMHByZSAoQ3VzdG9tIEJ1aWxkKSB8IE1JVAoqLwp2YXIgYWE9X193ZWJwYWNrX3JlcXVpcmVfXygyOTQpLGNhPV9fd2VicGFja19yZXF1aXJlX18oODQwKTtmdW5jdGlvbiBwKGEpe2Zvcih2YXIgYj0iaHR0cHM6Ly9yZWFjdGpzLm9yZy9kb2NzL2Vycm9yLWRlY29kZXIuaHRtbD9pbnZhcmlhbnQ9IithLGM9MTtjPGFyZ3VtZW50cy5sZW5ndGg7YysrKWIrPSImYXJnc1tdPSIrZW5jb2RlVVJJQ29tcG9uZW50KGFyZ3VtZW50c1tjXSk7cmV0dXJuIk1pbmlmaWVkIFJlYWN0IGVycm9yICMiK2ErIjsgdmlzaXQgIitiKyIgZm9yIHRoZSBmdWxsIG1lc3NhZ2Ugb3IgdXNlIHRoZSBub24tbWluaWZpZWQgZGV2IGVudmlyb25tZW50IGZvciBmdWxsIGVycm9ycyBhbmQgYWRkaXRpb25hbCBoZWxwZnVsIHdhcm5pbmdzLiJ9dmFyIGRhPW5ldyBTZXQsZWE9e307ZnVuY3Rpb24gZmEoYSxiKXtoYShhLGIpO2hhKGErIkNhcHR1cmUiLGIpfQpmdW5jdGlvbiBoYShhLGIpe2VhW2FdPWI7Zm9yKGE9MDthPGIubGVuZ3RoO2ErKylkYS5hZGQoYlthXSl9CnZhciBpYT0hKCJ1bmRlZmluZWQiPT09dHlwZW9mIHdpbmRvd3x8InVuZGVmaW5lZCI9PT10eXBlb2Ygd2luZG93LmRvY3VtZW50fHwidW5kZWZpbmVkIj09PXR5cGVvZiB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCksamE9T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSxrYT0vXls6QS1aX2Etelx1MDBDMC1cdTAwRDZcdTAwRDgtXHUwMEY2XHUwMEY4LVx1MDJGRlx1MDM3MC1cdTAzN0RcdTAzN0YtXHUxRkZGXHUyMDBDLVx1MjAwRFx1MjA3MC1cdTIxOEZcdTJDMDAtXHUyRkVGXHUzMDAxLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkZEXVs6QS1aX2Etelx1MDBDMC1cdTAwRDZcdTAwRDgtXHUwMEY2XHUwMEY4LVx1MDJGRlx1MDM3MC1cdTAzN0RcdTAzN0YtXHUxRkZGXHUyMDBDLVx1MjAwRFx1MjA3MC1cdTIxOEZcdTJDMDAtXHUyRkVGXHUzMDAxLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkZEXC0uMC05XHUwMEI3XHUwMzAwLVx1MDM2Rlx1MjAzRi1cdTIwNDBdKiQvLGxhPQp7fSxtYT17fTtmdW5jdGlvbiBvYShhKXtpZihqYS5jYWxsKG1hLGEpKXJldHVybiEwO2lmKGphLmNhbGwobGEsYSkpcmV0dXJuITE7aWYoa2EudGVzdChhKSlyZXR1cm4gbWFbYV09ITA7bGFbYV09ITA7cmV0dXJuITF9ZnVuY3Rpb24gcGEoYSxiLGMsZCl7aWYobnVsbCE9PWMmJjA9PT1jLnR5cGUpcmV0dXJuITE7c3dpdGNoKHR5cGVvZiBiKXtjYXNlICJmdW5jdGlvbiI6Y2FzZSAic3ltYm9sIjpyZXR1cm4hMDtjYXNlICJib29sZWFuIjppZihkKXJldHVybiExO2lmKG51bGwhPT1jKXJldHVybiFjLmFjY2VwdHNCb29sZWFuczthPWEudG9Mb3dlckNhc2UoKS5zbGljZSgwLDUpO3JldHVybiJkYXRhLSIhPT1hJiYiYXJpYS0iIT09YTtkZWZhdWx0OnJldHVybiExfX0KZnVuY3Rpb24gcWEoYSxiLGMsZCl7aWYobnVsbD09PWJ8fCJ1bmRlZmluZWQiPT09dHlwZW9mIGJ8fHBhKGEsYixjLGQpKXJldHVybiEwO2lmKGQpcmV0dXJuITE7aWYobnVsbCE9PWMpc3dpdGNoKGMudHlwZSl7Y2FzZSAzOnJldHVybiFiO2Nhc2UgNDpyZXR1cm4hMT09PWI7Y2FzZSA1OnJldHVybiBpc05hTihiKTtjYXNlIDY6cmV0dXJuIGlzTmFOKGIpfHwxPmJ9cmV0dXJuITF9ZnVuY3Rpb24gdihhLGIsYyxkLGUsZixnKXt0aGlzLmFjY2VwdHNCb29sZWFucz0yPT09Ynx8Mz09PWJ8fDQ9PT1iO3RoaXMuYXR0cmlidXRlTmFtZT1kO3RoaXMuYXR0cmlidXRlTmFtZXNwYWNlPWU7dGhpcy5tdXN0VXNlUHJvcGVydHk9Yzt0aGlzLnByb3BlcnR5TmFtZT1hO3RoaXMudHlwZT1iO3RoaXMuc2FuaXRpemVVUkw9Zjt0aGlzLnJlbW92ZUVtcHR5U3RyaW5nPWd9dmFyIHo9e307CiJjaGlsZHJlbiBkYW5nZXJvdXNseVNldElubmVySFRNTCBkZWZhdWx0VmFsdWUgZGVmYXVsdENoZWNrZWQgaW5uZXJIVE1MIHN1cHByZXNzQ29udGVudEVkaXRhYmxlV2FybmluZyBzdXBwcmVzc0h5ZHJhdGlvbldhcm5pbmcgc3R5bGUiLnNwbGl0KCIgIikuZm9yRWFjaChmdW5jdGlvbihhKXt6W2FdPW5ldyB2KGEsMCwhMSxhLG51bGwsITEsITEpfSk7W1siYWNjZXB0Q2hhcnNldCIsImFjY2VwdC1jaGFyc2V0Il0sWyJjbGFzc05hbWUiLCJjbGFzcyJdLFsiaHRtbEZvciIsImZvciJdLFsiaHR0cEVxdWl2IiwiaHR0cC1lcXVpdiJdXS5mb3JFYWNoKGZ1bmN0aW9uKGEpe3ZhciBiPWFbMF07eltiXT1uZXcgdihiLDEsITEsYVsxXSxudWxsLCExLCExKX0pO1siY29udGVudEVkaXRhYmxlIiwiZHJhZ2dhYmxlIiwic3BlbGxDaGVjayIsInZhbHVlIl0uZm9yRWFjaChmdW5jdGlvbihhKXt6W2FdPW5ldyB2KGEsMiwhMSxhLnRvTG93ZXJDYXNlKCksbnVsbCwhMSwhMSl9KTsKWyJhdXRvUmV2ZXJzZSIsImV4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQiLCJmb2N1c2FibGUiLCJwcmVzZXJ2ZUFscGhhIl0uZm9yRWFjaChmdW5jdGlvbihhKXt6W2FdPW5ldyB2KGEsMiwhMSxhLG51bGwsITEsITEpfSk7ImFsbG93RnVsbFNjcmVlbiBhc3luYyBhdXRvRm9jdXMgYXV0b1BsYXkgY29udHJvbHMgZGVmYXVsdCBkZWZlciBkaXNhYmxlZCBkaXNhYmxlUGljdHVyZUluUGljdHVyZSBkaXNhYmxlUmVtb3RlUGxheWJhY2sgZm9ybU5vVmFsaWRhdGUgaGlkZGVuIGxvb3Agbm9Nb2R1bGUgbm9WYWxpZGF0ZSBvcGVuIHBsYXlzSW5saW5lIHJlYWRPbmx5IHJlcXVpcmVkIHJldmVyc2VkIHNjb3BlZCBzZWFtbGVzcyBpdGVtU2NvcGUiLnNwbGl0KCIgIikuZm9yRWFjaChmdW5jdGlvbihhKXt6W2FdPW5ldyB2KGEsMywhMSxhLnRvTG93ZXJDYXNlKCksbnVsbCwhMSwhMSl9KTsKWyJjaGVja2VkIiwibXVsdGlwbGUiLCJtdXRlZCIsInNlbGVjdGVkIl0uZm9yRWFjaChmdW5jdGlvbihhKXt6W2FdPW5ldyB2KGEsMywhMCxhLG51bGwsITEsITEpfSk7WyJjYXB0dXJlIiwiZG93bmxvYWQiXS5mb3JFYWNoKGZ1bmN0aW9uKGEpe3pbYV09bmV3IHYoYSw0LCExLGEsbnVsbCwhMSwhMSl9KTtbImNvbHMiLCJyb3dzIiwic2l6ZSIsInNwYW4iXS5mb3JFYWNoKGZ1bmN0aW9uKGEpe3pbYV09bmV3IHYoYSw2LCExLGEsbnVsbCwhMSwhMSl9KTtbInJvd1NwYW4iLCJzdGFydCJdLmZvckVhY2goZnVuY3Rpb24oYSl7elthXT1uZXcgdihhLDUsITEsYS50b0xvd2VyQ2FzZSgpLG51bGwsITEsITEpfSk7dmFyIHJhPS9bXC06XShbYS16XSkvZztmdW5jdGlvbiBzYShhKXtyZXR1cm4gYVsxXS50b1VwcGVyQ2FzZSgpfQoiYWNjZW50LWhlaWdodCBhbGlnbm1lbnQtYmFzZWxpbmUgYXJhYmljLWZvcm0gYmFzZWxpbmUtc2hpZnQgY2FwLWhlaWdodCBjbGlwLXBhdGggY2xpcC1ydWxlIGNvbG9yLWludGVycG9sYXRpb24gY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzIGNvbG9yLXByb2ZpbGUgY29sb3ItcmVuZGVyaW5nIGRvbWluYW50LWJhc2VsaW5lIGVuYWJsZS1iYWNrZ3JvdW5kIGZpbGwtb3BhY2l0eSBmaWxsLXJ1bGUgZmxvb2QtY29sb3IgZmxvb2Qtb3BhY2l0eSBmb250LWZhbWlseSBmb250LXNpemUgZm9udC1zaXplLWFkanVzdCBmb250LXN0cmV0Y2ggZm9udC1zdHlsZSBmb250LXZhcmlhbnQgZm9udC13ZWlnaHQgZ2x5cGgtbmFtZSBnbHlwaC1vcmllbnRhdGlvbi1ob3Jpem9udGFsIGdseXBoLW9yaWVudGF0aW9uLXZlcnRpY2FsIGhvcml6LWFkdi14IGhvcml6LW9yaWdpbi14IGltYWdlLXJlbmRlcmluZyBsZXR0ZXItc3BhY2luZyBsaWdodGluZy1jb2xvciBtYXJrZXItZW5kIG1hcmtlci1taWQgbWFya2VyLXN0YXJ0IG92ZXJsaW5lLXBvc2l0aW9uIG92ZXJsaW5lLXRoaWNrbmVzcyBwYWludC1vcmRlciBwYW5vc2UtMSBwb2ludGVyLWV2ZW50cyByZW5kZXJpbmctaW50ZW50IHNoYXBlLXJlbmRlcmluZyBzdG9wLWNvbG9yIHN0b3Atb3BhY2l0eSBzdHJpa2V0aHJvdWdoLXBvc2l0aW9uIHN0cmlrZXRocm91Z2gtdGhpY2tuZXNzIHN0cm9rZS1kYXNoYXJyYXkgc3Ryb2tlLWRhc2hvZmZzZXQgc3Ryb2tlLWxpbmVjYXAgc3Ryb2tlLWxpbmVqb2luIHN0cm9rZS1taXRlcmxpbWl0IHN0cm9rZS1vcGFjaXR5IHN0cm9rZS13aWR0aCB0ZXh0LWFuY2hvciB0ZXh0LWRlY29yYXRpb24gdGV4dC1yZW5kZXJpbmcgdW5kZXJsaW5lLXBvc2l0aW9uIHVuZGVybGluZS10aGlja25lc3MgdW5pY29kZS1iaWRpIHVuaWNvZGUtcmFuZ2UgdW5pdHMtcGVyLWVtIHYtYWxwaGFiZXRpYyB2LWhhbmdpbmcgdi1pZGVvZ3JhcGhpYyB2LW1hdGhlbWF0aWNhbCB2ZWN0b3ItZWZmZWN0IHZlcnQtYWR2LXkgdmVydC1vcmlnaW4teCB2ZXJ0LW9yaWdpbi15IHdvcmQtc3BhY2luZyB3cml0aW5nLW1vZGUgeG1sbnM6eGxpbmsgeC1oZWlnaHQiLnNwbGl0KCIgIikuZm9yRWFjaChmdW5jdGlvbihhKXt2YXIgYj1hLnJlcGxhY2UocmEsCnNhKTt6W2JdPW5ldyB2KGIsMSwhMSxhLG51bGwsITEsITEpfSk7InhsaW5rOmFjdHVhdGUgeGxpbms6YXJjcm9sZSB4bGluazpyb2xlIHhsaW5rOnNob3cgeGxpbms6dGl0bGUgeGxpbms6dHlwZSIuc3BsaXQoIiAiKS5mb3JFYWNoKGZ1bmN0aW9uKGEpe3ZhciBiPWEucmVwbGFjZShyYSxzYSk7eltiXT1uZXcgdihiLDEsITEsYSwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIsITEsITEpfSk7WyJ4bWw6YmFzZSIsInhtbDpsYW5nIiwieG1sOnNwYWNlIl0uZm9yRWFjaChmdW5jdGlvbihhKXt2YXIgYj1hLnJlcGxhY2UocmEsc2EpO3pbYl09bmV3IHYoYiwxLCExLGEsImh0dHA6Ly93d3cudzMub3JnL1hNTC8xOTk4L25hbWVzcGFjZSIsITEsITEpfSk7WyJ0YWJJbmRleCIsImNyb3NzT3JpZ2luIl0uZm9yRWFjaChmdW5jdGlvbihhKXt6W2FdPW5ldyB2KGEsMSwhMSxhLnRvTG93ZXJDYXNlKCksbnVsbCwhMSwhMSl9KTsKei54bGlua0hyZWY9bmV3IHYoInhsaW5rSHJlZiIsMSwhMSwieGxpbms6aHJlZiIsImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiLCEwLCExKTtbInNyYyIsImhyZWYiLCJhY3Rpb24iLCJmb3JtQWN0aW9uIl0uZm9yRWFjaChmdW5jdGlvbihhKXt6W2FdPW5ldyB2KGEsMSwhMSxhLnRvTG93ZXJDYXNlKCksbnVsbCwhMCwhMCl9KTsKZnVuY3Rpb24gdGEoYSxiLGMsZCl7dmFyIGU9ei5oYXNPd25Qcm9wZXJ0eShiKT96W2JdOm51bGw7aWYobnVsbCE9PWU/MCE9PWUudHlwZTpkfHwhKDI8Yi5sZW5ndGgpfHwibyIhPT1iWzBdJiYiTyIhPT1iWzBdfHwibiIhPT1iWzFdJiYiTiIhPT1iWzFdKXFhKGIsYyxlLGQpJiYoYz1udWxsKSxkfHxudWxsPT09ZT9vYShiKSYmKG51bGw9PT1jP2EucmVtb3ZlQXR0cmlidXRlKGIpOmEuc2V0QXR0cmlidXRlKGIsIiIrYykpOmUubXVzdFVzZVByb3BlcnR5P2FbZS5wcm9wZXJ0eU5hbWVdPW51bGw9PT1jPzM9PT1lLnR5cGU/ITE6IiI6YzooYj1lLmF0dHJpYnV0ZU5hbWUsZD1lLmF0dHJpYnV0ZU5hbWVzcGFjZSxudWxsPT09Yz9hLnJlbW92ZUF0dHJpYnV0ZShiKTooZT1lLnR5cGUsYz0zPT09ZXx8ND09PWUmJiEwPT09Yz8iIjoiIitjLGQ/YS5zZXRBdHRyaWJ1dGVOUyhkLGIsYyk6YS5zZXRBdHRyaWJ1dGUoYixjKSkpfQp2YXIgdWE9YWEuX19TRUNSRVRfSU5URVJOQUxTX0RPX05PVF9VU0VfT1JfWU9VX1dJTExfQkVfRklSRUQsdmE9U3ltYm9sLmZvcigicmVhY3QuZWxlbWVudCIpLHdhPVN5bWJvbC5mb3IoInJlYWN0LnBvcnRhbCIpLHlhPVN5bWJvbC5mb3IoInJlYWN0LmZyYWdtZW50IiksemE9U3ltYm9sLmZvcigicmVhY3Quc3RyaWN0X21vZGUiKSxBYT1TeW1ib2wuZm9yKCJyZWFjdC5wcm9maWxlciIpLEJhPVN5bWJvbC5mb3IoInJlYWN0LnByb3ZpZGVyIiksQ2E9U3ltYm9sLmZvcigicmVhY3QuY29udGV4dCIpLERhPVN5bWJvbC5mb3IoInJlYWN0LmZvcndhcmRfcmVmIiksRWE9U3ltYm9sLmZvcigicmVhY3Quc3VzcGVuc2UiKSxGYT1TeW1ib2wuZm9yKCJyZWFjdC5zdXNwZW5zZV9saXN0IiksR2E9U3ltYm9sLmZvcigicmVhY3QubWVtbyIpLEhhPVN5bWJvbC5mb3IoInJlYWN0LmxhenkiKTtTeW1ib2wuZm9yKCJyZWFjdC5zY29wZSIpO1N5bWJvbC5mb3IoInJlYWN0LmRlYnVnX3RyYWNlX21vZGUiKTsKdmFyIElhPVN5bWJvbC5mb3IoInJlYWN0Lm9mZnNjcmVlbiIpO1N5bWJvbC5mb3IoInJlYWN0LmxlZ2FjeV9oaWRkZW4iKTtTeW1ib2wuZm9yKCJyZWFjdC5jYWNoZSIpO1N5bWJvbC5mb3IoInJlYWN0LnRyYWNpbmdfbWFya2VyIik7dmFyIEphPVN5bWJvbC5pdGVyYXRvcjtmdW5jdGlvbiBLYShhKXtpZihudWxsPT09YXx8Im9iamVjdCIhPT10eXBlb2YgYSlyZXR1cm4gbnVsbDthPUphJiZhW0phXXx8YVsiQEBpdGVyYXRvciJdO3JldHVybiJmdW5jdGlvbiI9PT10eXBlb2YgYT9hOm51bGx9dmFyIEE9T2JqZWN0LmFzc2lnbixMYTtmdW5jdGlvbiBNYShhKXtpZih2b2lkIDA9PT1MYSl0cnl7dGhyb3cgRXJyb3IoKTt9Y2F0Y2goYyl7dmFyIGI9Yy5zdGFjay50cmltKCkubWF0Y2goL1xuKCAqKGF0ICk/KS8pO0xhPWImJmJbMV18fCIifXJldHVybiJcbiIrTGErYX12YXIgTmE9ITE7CmZ1bmN0aW9uIE9hKGEsYil7aWYoIWF8fE5hKXJldHVybiIiO05hPSEwO3ZhciBjPUVycm9yLnByZXBhcmVTdGFja1RyYWNlO0Vycm9yLnByZXBhcmVTdGFja1RyYWNlPXZvaWQgMDt0cnl7aWYoYilpZihiPWZ1bmN0aW9uKCl7dGhyb3cgRXJyb3IoKTt9LE9iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSwicHJvcHMiLHtzZXQ6ZnVuY3Rpb24oKXt0aHJvdyBFcnJvcigpO319KSwib2JqZWN0Ij09PXR5cGVvZiBSZWZsZWN0JiZSZWZsZWN0LmNvbnN0cnVjdCl7dHJ5e1JlZmxlY3QuY29uc3RydWN0KGIsW10pfWNhdGNoKGwpe3ZhciBkPWx9UmVmbGVjdC5jb25zdHJ1Y3QoYSxbXSxiKX1lbHNle3RyeXtiLmNhbGwoKX1jYXRjaChsKXtkPWx9YS5jYWxsKGIucHJvdG90eXBlKX1lbHNle3RyeXt0aHJvdyBFcnJvcigpO31jYXRjaChsKXtkPWx9YSgpfX1jYXRjaChsKXtpZihsJiZkJiYic3RyaW5nIj09PXR5cGVvZiBsLnN0YWNrKXtmb3IodmFyIGU9bC5zdGFjay5zcGxpdCgiXG4iKSwKZj1kLnN0YWNrLnNwbGl0KCJcbiIpLGc9ZS5sZW5ndGgtMSxoPWYubGVuZ3RoLTE7MTw9ZyYmMDw9aCYmZVtnXSE9PWZbaF07KWgtLTtmb3IoOzE8PWcmJjA8PWg7Zy0tLGgtLSlpZihlW2ddIT09ZltoXSl7aWYoMSE9PWd8fDEhPT1oKXtkbyBpZihnLS0saC0tLDA+aHx8ZVtnXSE9PWZbaF0pe3ZhciBrPSJcbiIrZVtnXS5yZXBsYWNlKCIgYXQgbmV3ICIsIiBhdCAiKTthLmRpc3BsYXlOYW1lJiZrLmluY2x1ZGVzKCI8YW5vbnltb3VzPiIpJiYoaz1rLnJlcGxhY2UoIjxhbm9ueW1vdXM+IixhLmRpc3BsYXlOYW1lKSk7cmV0dXJuIGt9d2hpbGUoMTw9ZyYmMDw9aCl9YnJlYWt9fX1maW5hbGx5e05hPSExLEVycm9yLnByZXBhcmVTdGFja1RyYWNlPWN9cmV0dXJuKGE9YT9hLmRpc3BsYXlOYW1lfHxhLm5hbWU6IiIpP01hKGEpOiIifQpmdW5jdGlvbiBQYShhKXtzd2l0Y2goYS50YWcpe2Nhc2UgNTpyZXR1cm4gTWEoYS50eXBlKTtjYXNlIDE2OnJldHVybiBNYSgiTGF6eSIpO2Nhc2UgMTM6cmV0dXJuIE1hKCJTdXNwZW5zZSIpO2Nhc2UgMTk6cmV0dXJuIE1hKCJTdXNwZW5zZUxpc3QiKTtjYXNlIDA6Y2FzZSAyOmNhc2UgMTU6cmV0dXJuIGE9T2EoYS50eXBlLCExKSxhO2Nhc2UgMTE6cmV0dXJuIGE9T2EoYS50eXBlLnJlbmRlciwhMSksYTtjYXNlIDE6cmV0dXJuIGE9T2EoYS50eXBlLCEwKSxhO2RlZmF1bHQ6cmV0dXJuIiJ9fQpmdW5jdGlvbiBRYShhKXtpZihudWxsPT1hKXJldHVybiBudWxsO2lmKCJmdW5jdGlvbiI9PT10eXBlb2YgYSlyZXR1cm4gYS5kaXNwbGF5TmFtZXx8YS5uYW1lfHxudWxsO2lmKCJzdHJpbmciPT09dHlwZW9mIGEpcmV0dXJuIGE7c3dpdGNoKGEpe2Nhc2UgeWE6cmV0dXJuIkZyYWdtZW50IjtjYXNlIHdhOnJldHVybiJQb3J0YWwiO2Nhc2UgQWE6cmV0dXJuIlByb2ZpbGVyIjtjYXNlIHphOnJldHVybiJTdHJpY3RNb2RlIjtjYXNlIEVhOnJldHVybiJTdXNwZW5zZSI7Y2FzZSBGYTpyZXR1cm4iU3VzcGVuc2VMaXN0In1pZigib2JqZWN0Ij09PXR5cGVvZiBhKXN3aXRjaChhLiQkdHlwZW9mKXtjYXNlIENhOnJldHVybihhLmRpc3BsYXlOYW1lfHwiQ29udGV4dCIpKyIuQ29uc3VtZXIiO2Nhc2UgQmE6cmV0dXJuKGEuX2NvbnRleHQuZGlzcGxheU5hbWV8fCJDb250ZXh0IikrIi5Qcm92aWRlciI7Y2FzZSBEYTp2YXIgYj1hLnJlbmRlcjthPWEuZGlzcGxheU5hbWU7YXx8KGE9Yi5kaXNwbGF5TmFtZXx8CmIubmFtZXx8IiIsYT0iIiE9PWE/IkZvcndhcmRSZWYoIithKyIpIjoiRm9yd2FyZFJlZiIpO3JldHVybiBhO2Nhc2UgR2E6cmV0dXJuIGI9YS5kaXNwbGF5TmFtZXx8bnVsbCxudWxsIT09Yj9iOlFhKGEudHlwZSl8fCJNZW1vIjtjYXNlIEhhOmI9YS5fcGF5bG9hZDthPWEuX2luaXQ7dHJ5e3JldHVybiBRYShhKGIpKX1jYXRjaChjKXt9fXJldHVybiBudWxsfQpmdW5jdGlvbiBSYShhKXt2YXIgYj1hLnR5cGU7c3dpdGNoKGEudGFnKXtjYXNlIDI0OnJldHVybiJDYWNoZSI7Y2FzZSA5OnJldHVybihiLmRpc3BsYXlOYW1lfHwiQ29udGV4dCIpKyIuQ29uc3VtZXIiO2Nhc2UgMTA6cmV0dXJuKGIuX2NvbnRleHQuZGlzcGxheU5hbWV8fCJDb250ZXh0IikrIi5Qcm92aWRlciI7Y2FzZSAxODpyZXR1cm4iRGVoeWRyYXRlZEZyYWdtZW50IjtjYXNlIDExOnJldHVybiBhPWIucmVuZGVyLGE9YS5kaXNwbGF5TmFtZXx8YS5uYW1lfHwiIixiLmRpc3BsYXlOYW1lfHwoIiIhPT1hPyJGb3J3YXJkUmVmKCIrYSsiKSI6IkZvcndhcmRSZWYiKTtjYXNlIDc6cmV0dXJuIkZyYWdtZW50IjtjYXNlIDU6cmV0dXJuIGI7Y2FzZSA0OnJldHVybiJQb3J0YWwiO2Nhc2UgMzpyZXR1cm4iUm9vdCI7Y2FzZSA2OnJldHVybiJUZXh0IjtjYXNlIDE2OnJldHVybiBRYShiKTtjYXNlIDg6cmV0dXJuIGI9PT16YT8iU3RyaWN0TW9kZSI6Ik1vZGUiO2Nhc2UgMjI6cmV0dXJuIk9mZnNjcmVlbiI7CmNhc2UgMTI6cmV0dXJuIlByb2ZpbGVyIjtjYXNlIDIxOnJldHVybiJTY29wZSI7Y2FzZSAxMzpyZXR1cm4iU3VzcGVuc2UiO2Nhc2UgMTk6cmV0dXJuIlN1c3BlbnNlTGlzdCI7Y2FzZSAyNTpyZXR1cm4iVHJhY2luZ01hcmtlciI7Y2FzZSAxOmNhc2UgMDpjYXNlIDE3OmNhc2UgMjpjYXNlIDE0OmNhc2UgMTU6aWYoImZ1bmN0aW9uIj09PXR5cGVvZiBiKXJldHVybiBiLmRpc3BsYXlOYW1lfHxiLm5hbWV8fG51bGw7aWYoInN0cmluZyI9PT10eXBlb2YgYilyZXR1cm4gYn1yZXR1cm4gbnVsbH1mdW5jdGlvbiBTYShhKXtzd2l0Y2godHlwZW9mIGEpe2Nhc2UgImJvb2xlYW4iOmNhc2UgIm51bWJlciI6Y2FzZSAic3RyaW5nIjpjYXNlICJ1bmRlZmluZWQiOnJldHVybiBhO2Nhc2UgIm9iamVjdCI6cmV0dXJuIGE7ZGVmYXVsdDpyZXR1cm4iIn19CmZ1bmN0aW9uIFRhKGEpe3ZhciBiPWEudHlwZTtyZXR1cm4oYT1hLm5vZGVOYW1lKSYmImlucHV0Ij09PWEudG9Mb3dlckNhc2UoKSYmKCJjaGVja2JveCI9PT1ifHwicmFkaW8iPT09Yil9CmZ1bmN0aW9uIFVhKGEpe3ZhciBiPVRhKGEpPyJjaGVja2VkIjoidmFsdWUiLGM9T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihhLmNvbnN0cnVjdG9yLnByb3RvdHlwZSxiKSxkPSIiK2FbYl07aWYoIWEuaGFzT3duUHJvcGVydHkoYikmJiJ1bmRlZmluZWQiIT09dHlwZW9mIGMmJiJmdW5jdGlvbiI9PT10eXBlb2YgYy5nZXQmJiJmdW5jdGlvbiI9PT10eXBlb2YgYy5zZXQpe3ZhciBlPWMuZ2V0LGY9Yy5zZXQ7T2JqZWN0LmRlZmluZVByb3BlcnR5KGEsYix7Y29uZmlndXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiBlLmNhbGwodGhpcyl9LHNldDpmdW5jdGlvbihhKXtkPSIiK2E7Zi5jYWxsKHRoaXMsYSl9fSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGEsYix7ZW51bWVyYWJsZTpjLmVudW1lcmFibGV9KTtyZXR1cm57Z2V0VmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4gZH0sc2V0VmFsdWU6ZnVuY3Rpb24oYSl7ZD0iIithfSxzdG9wVHJhY2tpbmc6ZnVuY3Rpb24oKXthLl92YWx1ZVRyYWNrZXI9Cm51bGw7ZGVsZXRlIGFbYl19fX19ZnVuY3Rpb24gVmEoYSl7YS5fdmFsdWVUcmFja2VyfHwoYS5fdmFsdWVUcmFja2VyPVVhKGEpKX1mdW5jdGlvbiBXYShhKXtpZighYSlyZXR1cm4hMTt2YXIgYj1hLl92YWx1ZVRyYWNrZXI7aWYoIWIpcmV0dXJuITA7dmFyIGM9Yi5nZXRWYWx1ZSgpO3ZhciBkPSIiO2EmJihkPVRhKGEpP2EuY2hlY2tlZD8idHJ1ZSI6ImZhbHNlIjphLnZhbHVlKTthPWQ7cmV0dXJuIGEhPT1jPyhiLnNldFZhbHVlKGEpLCEwKTohMX1mdW5jdGlvbiBYYShhKXthPWF8fCgidW5kZWZpbmVkIiE9PXR5cGVvZiBkb2N1bWVudD9kb2N1bWVudDp2b2lkIDApO2lmKCJ1bmRlZmluZWQiPT09dHlwZW9mIGEpcmV0dXJuIG51bGw7dHJ5e3JldHVybiBhLmFjdGl2ZUVsZW1lbnR8fGEuYm9keX1jYXRjaChiKXtyZXR1cm4gYS5ib2R5fX0KZnVuY3Rpb24gWWEoYSxiKXt2YXIgYz1iLmNoZWNrZWQ7cmV0dXJuIEEoe30sYix7ZGVmYXVsdENoZWNrZWQ6dm9pZCAwLGRlZmF1bHRWYWx1ZTp2b2lkIDAsdmFsdWU6dm9pZCAwLGNoZWNrZWQ6bnVsbCE9Yz9jOmEuX3dyYXBwZXJTdGF0ZS5pbml0aWFsQ2hlY2tlZH0pfWZ1bmN0aW9uIFphKGEsYil7dmFyIGM9bnVsbD09Yi5kZWZhdWx0VmFsdWU/IiI6Yi5kZWZhdWx0VmFsdWUsZD1udWxsIT1iLmNoZWNrZWQ/Yi5jaGVja2VkOmIuZGVmYXVsdENoZWNrZWQ7Yz1TYShudWxsIT1iLnZhbHVlP2IudmFsdWU6Yyk7YS5fd3JhcHBlclN0YXRlPXtpbml0aWFsQ2hlY2tlZDpkLGluaXRpYWxWYWx1ZTpjLGNvbnRyb2xsZWQ6ImNoZWNrYm94Ij09PWIudHlwZXx8InJhZGlvIj09PWIudHlwZT9udWxsIT1iLmNoZWNrZWQ6bnVsbCE9Yi52YWx1ZX19ZnVuY3Rpb24gYWIoYSxiKXtiPWIuY2hlY2tlZDtudWxsIT1iJiZ0YShhLCJjaGVja2VkIixiLCExKX0KZnVuY3Rpb24gYmIoYSxiKXthYihhLGIpO3ZhciBjPVNhKGIudmFsdWUpLGQ9Yi50eXBlO2lmKG51bGwhPWMpaWYoIm51bWJlciI9PT1kKXtpZigwPT09YyYmIiI9PT1hLnZhbHVlfHxhLnZhbHVlIT1jKWEudmFsdWU9IiIrY31lbHNlIGEudmFsdWUhPT0iIitjJiYoYS52YWx1ZT0iIitjKTtlbHNlIGlmKCJzdWJtaXQiPT09ZHx8InJlc2V0Ij09PWQpe2EucmVtb3ZlQXR0cmlidXRlKCJ2YWx1ZSIpO3JldHVybn1iLmhhc093blByb3BlcnR5KCJ2YWx1ZSIpP2NiKGEsYi50eXBlLGMpOmIuaGFzT3duUHJvcGVydHkoImRlZmF1bHRWYWx1ZSIpJiZjYihhLGIudHlwZSxTYShiLmRlZmF1bHRWYWx1ZSkpO251bGw9PWIuY2hlY2tlZCYmbnVsbCE9Yi5kZWZhdWx0Q2hlY2tlZCYmKGEuZGVmYXVsdENoZWNrZWQ9ISFiLmRlZmF1bHRDaGVja2VkKX0KZnVuY3Rpb24gZGIoYSxiLGMpe2lmKGIuaGFzT3duUHJvcGVydHkoInZhbHVlIil8fGIuaGFzT3duUHJvcGVydHkoImRlZmF1bHRWYWx1ZSIpKXt2YXIgZD1iLnR5cGU7aWYoISgic3VibWl0IiE9PWQmJiJyZXNldCIhPT1kfHx2b2lkIDAhPT1iLnZhbHVlJiZudWxsIT09Yi52YWx1ZSkpcmV0dXJuO2I9IiIrYS5fd3JhcHBlclN0YXRlLmluaXRpYWxWYWx1ZTtjfHxiPT09YS52YWx1ZXx8KGEudmFsdWU9Yik7YS5kZWZhdWx0VmFsdWU9Yn1jPWEubmFtZTsiIiE9PWMmJihhLm5hbWU9IiIpO2EuZGVmYXVsdENoZWNrZWQ9ISFhLl93cmFwcGVyU3RhdGUuaW5pdGlhbENoZWNrZWQ7IiIhPT1jJiYoYS5uYW1lPWMpfQpmdW5jdGlvbiBjYihhLGIsYyl7aWYoIm51bWJlciIhPT1ifHxYYShhLm93bmVyRG9jdW1lbnQpIT09YSludWxsPT1jP2EuZGVmYXVsdFZhbHVlPSIiK2EuX3dyYXBwZXJTdGF0ZS5pbml0aWFsVmFsdWU6YS5kZWZhdWx0VmFsdWUhPT0iIitjJiYoYS5kZWZhdWx0VmFsdWU9IiIrYyl9dmFyIGViPUFycmF5LmlzQXJyYXk7CmZ1bmN0aW9uIGZiKGEsYixjLGQpe2E9YS5vcHRpb25zO2lmKGIpe2I9e307Zm9yKHZhciBlPTA7ZTxjLmxlbmd0aDtlKyspYlsiJCIrY1tlXV09ITA7Zm9yKGM9MDtjPGEubGVuZ3RoO2MrKyllPWIuaGFzT3duUHJvcGVydHkoIiQiK2FbY10udmFsdWUpLGFbY10uc2VsZWN0ZWQhPT1lJiYoYVtjXS5zZWxlY3RlZD1lKSxlJiZkJiYoYVtjXS5kZWZhdWx0U2VsZWN0ZWQ9ITApfWVsc2V7Yz0iIitTYShjKTtiPW51bGw7Zm9yKGU9MDtlPGEubGVuZ3RoO2UrKyl7aWYoYVtlXS52YWx1ZT09PWMpe2FbZV0uc2VsZWN0ZWQ9ITA7ZCYmKGFbZV0uZGVmYXVsdFNlbGVjdGVkPSEwKTtyZXR1cm59bnVsbCE9PWJ8fGFbZV0uZGlzYWJsZWR8fChiPWFbZV0pfW51bGwhPT1iJiYoYi5zZWxlY3RlZD0hMCl9fQpmdW5jdGlvbiBnYihhLGIpe2lmKG51bGwhPWIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwpdGhyb3cgRXJyb3IocCg5MSkpO3JldHVybiBBKHt9LGIse3ZhbHVlOnZvaWQgMCxkZWZhdWx0VmFsdWU6dm9pZCAwLGNoaWxkcmVuOiIiK2EuX3dyYXBwZXJTdGF0ZS5pbml0aWFsVmFsdWV9KX1mdW5jdGlvbiBoYihhLGIpe3ZhciBjPWIudmFsdWU7aWYobnVsbD09Yyl7Yz1iLmNoaWxkcmVuO2I9Yi5kZWZhdWx0VmFsdWU7aWYobnVsbCE9Yyl7aWYobnVsbCE9Yil0aHJvdyBFcnJvcihwKDkyKSk7aWYoZWIoYykpe2lmKDE8Yy5sZW5ndGgpdGhyb3cgRXJyb3IocCg5MykpO2M9Y1swXX1iPWN9bnVsbD09YiYmKGI9IiIpO2M9Yn1hLl93cmFwcGVyU3RhdGU9e2luaXRpYWxWYWx1ZTpTYShjKX19CmZ1bmN0aW9uIGliKGEsYil7dmFyIGM9U2EoYi52YWx1ZSksZD1TYShiLmRlZmF1bHRWYWx1ZSk7bnVsbCE9YyYmKGM9IiIrYyxjIT09YS52YWx1ZSYmKGEudmFsdWU9YyksbnVsbD09Yi5kZWZhdWx0VmFsdWUmJmEuZGVmYXVsdFZhbHVlIT09YyYmKGEuZGVmYXVsdFZhbHVlPWMpKTtudWxsIT1kJiYoYS5kZWZhdWx0VmFsdWU9IiIrZCl9ZnVuY3Rpb24gamIoYSl7dmFyIGI9YS50ZXh0Q29udGVudDtiPT09YS5fd3JhcHBlclN0YXRlLmluaXRpYWxWYWx1ZSYmIiIhPT1iJiZudWxsIT09YiYmKGEudmFsdWU9Yil9ZnVuY3Rpb24ga2IoYSl7c3dpdGNoKGEpe2Nhc2UgInN2ZyI6cmV0dXJuImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIjtjYXNlICJtYXRoIjpyZXR1cm4iaHR0cDovL3d3dy53My5vcmcvMTk5OC9NYXRoL01hdGhNTCI7ZGVmYXVsdDpyZXR1cm4iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCJ9fQpmdW5jdGlvbiBsYihhLGIpe3JldHVybiBudWxsPT1hfHwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCI9PT1hP2tiKGIpOiJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI9PT1hJiYiZm9yZWlnbk9iamVjdCI9PT1iPyJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIjphfQp2YXIgbWIsbmI9ZnVuY3Rpb24oYSl7cmV0dXJuInVuZGVmaW5lZCIhPT10eXBlb2YgTVNBcHAmJk1TQXBwLmV4ZWNVbnNhZmVMb2NhbEZ1bmN0aW9uP2Z1bmN0aW9uKGIsYyxkLGUpe01TQXBwLmV4ZWNVbnNhZmVMb2NhbEZ1bmN0aW9uKGZ1bmN0aW9uKCl7cmV0dXJuIGEoYixjLGQsZSl9KX06YX0oZnVuY3Rpb24oYSxiKXtpZigiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIT09YS5uYW1lc3BhY2VVUkl8fCJpbm5lckhUTUwiaW4gYSlhLmlubmVySFRNTD1iO2Vsc2V7bWI9bWJ8fGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO21iLmlubmVySFRNTD0iPHN2Zz4iK2IudmFsdWVPZigpLnRvU3RyaW5nKCkrIjwvc3ZnPiI7Zm9yKGI9bWIuZmlyc3RDaGlsZDthLmZpcnN0Q2hpbGQ7KWEucmVtb3ZlQ2hpbGQoYS5maXJzdENoaWxkKTtmb3IoO2IuZmlyc3RDaGlsZDspYS5hcHBlbmRDaGlsZChiLmZpcnN0Q2hpbGQpfX0pOwpmdW5jdGlvbiBvYihhLGIpe2lmKGIpe3ZhciBjPWEuZmlyc3RDaGlsZDtpZihjJiZjPT09YS5sYXN0Q2hpbGQmJjM9PT1jLm5vZGVUeXBlKXtjLm5vZGVWYWx1ZT1iO3JldHVybn19YS50ZXh0Q29udGVudD1ifQp2YXIgcGI9e2FuaW1hdGlvbkl0ZXJhdGlvbkNvdW50OiEwLGFzcGVjdFJhdGlvOiEwLGJvcmRlckltYWdlT3V0c2V0OiEwLGJvcmRlckltYWdlU2xpY2U6ITAsYm9yZGVySW1hZ2VXaWR0aDohMCxib3hGbGV4OiEwLGJveEZsZXhHcm91cDohMCxib3hPcmRpbmFsR3JvdXA6ITAsY29sdW1uQ291bnQ6ITAsY29sdW1uczohMCxmbGV4OiEwLGZsZXhHcm93OiEwLGZsZXhQb3NpdGl2ZTohMCxmbGV4U2hyaW5rOiEwLGZsZXhOZWdhdGl2ZTohMCxmbGV4T3JkZXI6ITAsZ3JpZEFyZWE6ITAsZ3JpZFJvdzohMCxncmlkUm93RW5kOiEwLGdyaWRSb3dTcGFuOiEwLGdyaWRSb3dTdGFydDohMCxncmlkQ29sdW1uOiEwLGdyaWRDb2x1bW5FbmQ6ITAsZ3JpZENvbHVtblNwYW46ITAsZ3JpZENvbHVtblN0YXJ0OiEwLGZvbnRXZWlnaHQ6ITAsbGluZUNsYW1wOiEwLGxpbmVIZWlnaHQ6ITAsb3BhY2l0eTohMCxvcmRlcjohMCxvcnBoYW5zOiEwLHRhYlNpemU6ITAsd2lkb3dzOiEwLHpJbmRleDohMCwKem9vbTohMCxmaWxsT3BhY2l0eTohMCxmbG9vZE9wYWNpdHk6ITAsc3RvcE9wYWNpdHk6ITAsc3Ryb2tlRGFzaGFycmF5OiEwLHN0cm9rZURhc2hvZmZzZXQ6ITAsc3Ryb2tlTWl0ZXJsaW1pdDohMCxzdHJva2VPcGFjaXR5OiEwLHN0cm9rZVdpZHRoOiEwfSxxYj1bIldlYmtpdCIsIm1zIiwiTW96IiwiTyJdO09iamVjdC5rZXlzKHBiKS5mb3JFYWNoKGZ1bmN0aW9uKGEpe3FiLmZvckVhY2goZnVuY3Rpb24oYil7Yj1iK2EuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkrYS5zdWJzdHJpbmcoMSk7cGJbYl09cGJbYV19KX0pO2Z1bmN0aW9uIHJiKGEsYixjKXtyZXR1cm4gbnVsbD09Ynx8ImJvb2xlYW4iPT09dHlwZW9mIGJ8fCIiPT09Yj8iIjpjfHwibnVtYmVyIiE9PXR5cGVvZiBifHwwPT09Ynx8cGIuaGFzT3duUHJvcGVydHkoYSkmJnBiW2FdPygiIitiKS50cmltKCk6YisicHgifQpmdW5jdGlvbiBzYihhLGIpe2E9YS5zdHlsZTtmb3IodmFyIGMgaW4gYilpZihiLmhhc093blByb3BlcnR5KGMpKXt2YXIgZD0wPT09Yy5pbmRleE9mKCItLSIpLGU9cmIoYyxiW2NdLGQpOyJmbG9hdCI9PT1jJiYoYz0iY3NzRmxvYXQiKTtkP2Euc2V0UHJvcGVydHkoYyxlKTphW2NdPWV9fXZhciB0Yj1BKHttZW51aXRlbTohMH0se2FyZWE6ITAsYmFzZTohMCxicjohMCxjb2w6ITAsZW1iZWQ6ITAsaHI6ITAsaW1nOiEwLGlucHV0OiEwLGtleWdlbjohMCxsaW5rOiEwLG1ldGE6ITAscGFyYW06ITAsc291cmNlOiEwLHRyYWNrOiEwLHdicjohMH0pOwpmdW5jdGlvbiB1YihhLGIpe2lmKGIpe2lmKHRiW2FdJiYobnVsbCE9Yi5jaGlsZHJlbnx8bnVsbCE9Yi5kYW5nZXJvdXNseVNldElubmVySFRNTCkpdGhyb3cgRXJyb3IocCgxMzcsYSkpO2lmKG51bGwhPWIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwpe2lmKG51bGwhPWIuY2hpbGRyZW4pdGhyb3cgRXJyb3IocCg2MCkpO2lmKCJvYmplY3QiIT09dHlwZW9mIGIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUx8fCEoIl9faHRtbCJpbiBiLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MKSl0aHJvdyBFcnJvcihwKDYxKSk7fWlmKG51bGwhPWIuc3R5bGUmJiJvYmplY3QiIT09dHlwZW9mIGIuc3R5bGUpdGhyb3cgRXJyb3IocCg2MikpO319CmZ1bmN0aW9uIHZiKGEsYil7aWYoLTE9PT1hLmluZGV4T2YoIi0iKSlyZXR1cm4ic3RyaW5nIj09PXR5cGVvZiBiLmlzO3N3aXRjaChhKXtjYXNlICJhbm5vdGF0aW9uLXhtbCI6Y2FzZSAiY29sb3ItcHJvZmlsZSI6Y2FzZSAiZm9udC1mYWNlIjpjYXNlICJmb250LWZhY2Utc3JjIjpjYXNlICJmb250LWZhY2UtdXJpIjpjYXNlICJmb250LWZhY2UtZm9ybWF0IjpjYXNlICJmb250LWZhY2UtbmFtZSI6Y2FzZSAibWlzc2luZy1nbHlwaCI6cmV0dXJuITE7ZGVmYXVsdDpyZXR1cm4hMH19dmFyIHdiPW51bGw7ZnVuY3Rpb24geGIoYSl7YT1hLnRhcmdldHx8YS5zcmNFbGVtZW50fHx3aW5kb3c7YS5jb3JyZXNwb25kaW5nVXNlRWxlbWVudCYmKGE9YS5jb3JyZXNwb25kaW5nVXNlRWxlbWVudCk7cmV0dXJuIDM9PT1hLm5vZGVUeXBlP2EucGFyZW50Tm9kZTphfXZhciB5Yj1udWxsLHpiPW51bGwsQWI9bnVsbDsKZnVuY3Rpb24gQmIoYSl7aWYoYT1DYihhKSl7aWYoImZ1bmN0aW9uIiE9PXR5cGVvZiB5Yil0aHJvdyBFcnJvcihwKDI4MCkpO3ZhciBiPWEuc3RhdGVOb2RlO2ImJihiPURiKGIpLHliKGEuc3RhdGVOb2RlLGEudHlwZSxiKSl9fWZ1bmN0aW9uIEViKGEpe3piP0FiP0FiLnB1c2goYSk6QWI9W2FdOnpiPWF9ZnVuY3Rpb24gRmIoKXtpZih6Yil7dmFyIGE9emIsYj1BYjtBYj16Yj1udWxsO0JiKGEpO2lmKGIpZm9yKGE9MDthPGIubGVuZ3RoO2ErKylCYihiW2FdKX19ZnVuY3Rpb24gR2IoYSxiKXtyZXR1cm4gYShiKX1mdW5jdGlvbiBIYigpe312YXIgSWI9ITE7ZnVuY3Rpb24gSmIoYSxiLGMpe2lmKEliKXJldHVybiBhKGIsYyk7SWI9ITA7dHJ5e3JldHVybiBHYihhLGIsYyl9ZmluYWxseXtpZihJYj0hMSxudWxsIT09emJ8fG51bGwhPT1BYilIYigpLEZiKCl9fQpmdW5jdGlvbiBLYihhLGIpe3ZhciBjPWEuc3RhdGVOb2RlO2lmKG51bGw9PT1jKXJldHVybiBudWxsO3ZhciBkPURiKGMpO2lmKG51bGw9PT1kKXJldHVybiBudWxsO2M9ZFtiXTthOnN3aXRjaChiKXtjYXNlICJvbkNsaWNrIjpjYXNlICJvbkNsaWNrQ2FwdHVyZSI6Y2FzZSAib25Eb3VibGVDbGljayI6Y2FzZSAib25Eb3VibGVDbGlja0NhcHR1cmUiOmNhc2UgIm9uTW91c2VEb3duIjpjYXNlICJvbk1vdXNlRG93bkNhcHR1cmUiOmNhc2UgIm9uTW91c2VNb3ZlIjpjYXNlICJvbk1vdXNlTW92ZUNhcHR1cmUiOmNhc2UgIm9uTW91c2VVcCI6Y2FzZSAib25Nb3VzZVVwQ2FwdHVyZSI6Y2FzZSAib25Nb3VzZUVudGVyIjooZD0hZC5kaXNhYmxlZCl8fChhPWEudHlwZSxkPSEoImJ1dHRvbiI9PT1hfHwiaW5wdXQiPT09YXx8InNlbGVjdCI9PT1hfHwidGV4dGFyZWEiPT09YSkpO2E9IWQ7YnJlYWsgYTtkZWZhdWx0OmE9ITF9aWYoYSlyZXR1cm4gbnVsbDtpZihjJiYiZnVuY3Rpb24iIT09CnR5cGVvZiBjKXRocm93IEVycm9yKHAoMjMxLGIsdHlwZW9mIGMpKTtyZXR1cm4gY312YXIgTGI9ITE7aWYoaWEpdHJ5e3ZhciBNYj17fTtPYmplY3QuZGVmaW5lUHJvcGVydHkoTWIsInBhc3NpdmUiLHtnZXQ6ZnVuY3Rpb24oKXtMYj0hMH19KTt3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigidGVzdCIsTWIsTWIpO3dpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJ0ZXN0IixNYixNYil9Y2F0Y2goYSl7TGI9ITF9ZnVuY3Rpb24gTmIoYSxiLGMsZCxlLGYsZyxoLGspe3ZhciBsPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywzKTt0cnl7Yi5hcHBseShjLGwpfWNhdGNoKG0pe3RoaXMub25FcnJvcihtKX19dmFyIE9iPSExLFBiPW51bGwsUWI9ITEsUmI9bnVsbCxTYj17b25FcnJvcjpmdW5jdGlvbihhKXtPYj0hMDtQYj1hfX07ZnVuY3Rpb24gVGIoYSxiLGMsZCxlLGYsZyxoLGspe09iPSExO1BiPW51bGw7TmIuYXBwbHkoU2IsYXJndW1lbnRzKX0KZnVuY3Rpb24gVWIoYSxiLGMsZCxlLGYsZyxoLGspe1RiLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtpZihPYil7aWYoT2Ipe3ZhciBsPVBiO09iPSExO1BiPW51bGx9ZWxzZSB0aHJvdyBFcnJvcihwKDE5OCkpO1FifHwoUWI9ITAsUmI9bCl9fWZ1bmN0aW9uIFZiKGEpe3ZhciBiPWEsYz1hO2lmKGEuYWx0ZXJuYXRlKWZvcig7Yi5yZXR1cm47KWI9Yi5yZXR1cm47ZWxzZXthPWI7ZG8gYj1hLDAhPT0oYi5mbGFncyY0MDk4KSYmKGM9Yi5yZXR1cm4pLGE9Yi5yZXR1cm47d2hpbGUoYSl9cmV0dXJuIDM9PT1iLnRhZz9jOm51bGx9ZnVuY3Rpb24gV2IoYSl7aWYoMTM9PT1hLnRhZyl7dmFyIGI9YS5tZW1vaXplZFN0YXRlO251bGw9PT1iJiYoYT1hLmFsdGVybmF0ZSxudWxsIT09YSYmKGI9YS5tZW1vaXplZFN0YXRlKSk7aWYobnVsbCE9PWIpcmV0dXJuIGIuZGVoeWRyYXRlZH1yZXR1cm4gbnVsbH1mdW5jdGlvbiBYYihhKXtpZihWYihhKSE9PWEpdGhyb3cgRXJyb3IocCgxODgpKTt9CmZ1bmN0aW9uIFliKGEpe3ZhciBiPWEuYWx0ZXJuYXRlO2lmKCFiKXtiPVZiKGEpO2lmKG51bGw9PT1iKXRocm93IEVycm9yKHAoMTg4KSk7cmV0dXJuIGIhPT1hP251bGw6YX1mb3IodmFyIGM9YSxkPWI7Oyl7dmFyIGU9Yy5yZXR1cm47aWYobnVsbD09PWUpYnJlYWs7dmFyIGY9ZS5hbHRlcm5hdGU7aWYobnVsbD09PWYpe2Q9ZS5yZXR1cm47aWYobnVsbCE9PWQpe2M9ZDtjb250aW51ZX1icmVha31pZihlLmNoaWxkPT09Zi5jaGlsZCl7Zm9yKGY9ZS5jaGlsZDtmOyl7aWYoZj09PWMpcmV0dXJuIFhiKGUpLGE7aWYoZj09PWQpcmV0dXJuIFhiKGUpLGI7Zj1mLnNpYmxpbmd9dGhyb3cgRXJyb3IocCgxODgpKTt9aWYoYy5yZXR1cm4hPT1kLnJldHVybiljPWUsZD1mO2Vsc2V7Zm9yKHZhciBnPSExLGg9ZS5jaGlsZDtoOyl7aWYoaD09PWMpe2c9ITA7Yz1lO2Q9ZjticmVha31pZihoPT09ZCl7Zz0hMDtkPWU7Yz1mO2JyZWFrfWg9aC5zaWJsaW5nfWlmKCFnKXtmb3IoaD1mLmNoaWxkO2g7KXtpZihoPT09CmMpe2c9ITA7Yz1mO2Q9ZTticmVha31pZihoPT09ZCl7Zz0hMDtkPWY7Yz1lO2JyZWFrfWg9aC5zaWJsaW5nfWlmKCFnKXRocm93IEVycm9yKHAoMTg5KSk7fX1pZihjLmFsdGVybmF0ZSE9PWQpdGhyb3cgRXJyb3IocCgxOTApKTt9aWYoMyE9PWMudGFnKXRocm93IEVycm9yKHAoMTg4KSk7cmV0dXJuIGMuc3RhdGVOb2RlLmN1cnJlbnQ9PT1jP2E6Yn1mdW5jdGlvbiBaYihhKXthPVliKGEpO3JldHVybiBudWxsIT09YT8kYihhKTpudWxsfWZ1bmN0aW9uICRiKGEpe2lmKDU9PT1hLnRhZ3x8Nj09PWEudGFnKXJldHVybiBhO2ZvcihhPWEuY2hpbGQ7bnVsbCE9PWE7KXt2YXIgYj0kYihhKTtpZihudWxsIT09YilyZXR1cm4gYjthPWEuc2libGluZ31yZXR1cm4gbnVsbH0KdmFyIGFjPWNhLnVuc3RhYmxlX3NjaGVkdWxlQ2FsbGJhY2ssYmM9Y2EudW5zdGFibGVfY2FuY2VsQ2FsbGJhY2ssY2M9Y2EudW5zdGFibGVfc2hvdWxkWWllbGQsZGM9Y2EudW5zdGFibGVfcmVxdWVzdFBhaW50LEI9Y2EudW5zdGFibGVfbm93LGVjPWNhLnVuc3RhYmxlX2dldEN1cnJlbnRQcmlvcml0eUxldmVsLGZjPWNhLnVuc3RhYmxlX0ltbWVkaWF0ZVByaW9yaXR5LGdjPWNhLnVuc3RhYmxlX1VzZXJCbG9ja2luZ1ByaW9yaXR5LGhjPWNhLnVuc3RhYmxlX05vcm1hbFByaW9yaXR5LGljPWNhLnVuc3RhYmxlX0xvd1ByaW9yaXR5LGpjPWNhLnVuc3RhYmxlX0lkbGVQcmlvcml0eSxrYz1udWxsLGxjPW51bGw7ZnVuY3Rpb24gbWMoYSl7aWYobGMmJiJmdW5jdGlvbiI9PT10eXBlb2YgbGMub25Db21taXRGaWJlclJvb3QpdHJ5e2xjLm9uQ29tbWl0RmliZXJSb290KGtjLGEsdm9pZCAwLDEyOD09PShhLmN1cnJlbnQuZmxhZ3MmMTI4KSl9Y2F0Y2goYil7fX0KdmFyIG9jPU1hdGguY2x6MzI/TWF0aC5jbHozMjpuYyxwYz1NYXRoLmxvZyxxYz1NYXRoLkxOMjtmdW5jdGlvbiBuYyhhKXthPj4+PTA7cmV0dXJuIDA9PT1hPzMyOjMxLShwYyhhKS9xY3wwKXwwfXZhciByYz02NCxzYz00MTk0MzA0OwpmdW5jdGlvbiB0YyhhKXtzd2l0Y2goYSYtYSl7Y2FzZSAxOnJldHVybiAxO2Nhc2UgMjpyZXR1cm4gMjtjYXNlIDQ6cmV0dXJuIDQ7Y2FzZSA4OnJldHVybiA4O2Nhc2UgMTY6cmV0dXJuIDE2O2Nhc2UgMzI6cmV0dXJuIDMyO2Nhc2UgNjQ6Y2FzZSAxMjg6Y2FzZSAyNTY6Y2FzZSA1MTI6Y2FzZSAxMDI0OmNhc2UgMjA0ODpjYXNlIDQwOTY6Y2FzZSA4MTkyOmNhc2UgMTYzODQ6Y2FzZSAzMjc2ODpjYXNlIDY1NTM2OmNhc2UgMTMxMDcyOmNhc2UgMjYyMTQ0OmNhc2UgNTI0Mjg4OmNhc2UgMTA0ODU3NjpjYXNlIDIwOTcxNTI6cmV0dXJuIGEmNDE5NDI0MDtjYXNlIDQxOTQzMDQ6Y2FzZSA4Mzg4NjA4OmNhc2UgMTY3NzcyMTY6Y2FzZSAzMzU1NDQzMjpjYXNlIDY3MTA4ODY0OnJldHVybiBhJjEzMDAyMzQyNDtjYXNlIDEzNDIxNzcyODpyZXR1cm4gMTM0MjE3NzI4O2Nhc2UgMjY4NDM1NDU2OnJldHVybiAyNjg0MzU0NTY7Y2FzZSA1MzY4NzA5MTI6cmV0dXJuIDUzNjg3MDkxMjtjYXNlIDEwNzM3NDE4MjQ6cmV0dXJuIDEwNzM3NDE4MjQ7CmRlZmF1bHQ6cmV0dXJuIGF9fWZ1bmN0aW9uIHVjKGEsYil7dmFyIGM9YS5wZW5kaW5nTGFuZXM7aWYoMD09PWMpcmV0dXJuIDA7dmFyIGQ9MCxlPWEuc3VzcGVuZGVkTGFuZXMsZj1hLnBpbmdlZExhbmVzLGc9YyYyNjg0MzU0NTU7aWYoMCE9PWcpe3ZhciBoPWcmfmU7MCE9PWg/ZD10YyhoKTooZiY9ZywwIT09ZiYmKGQ9dGMoZikpKX1lbHNlIGc9YyZ+ZSwwIT09Zz9kPXRjKGcpOjAhPT1mJiYoZD10YyhmKSk7aWYoMD09PWQpcmV0dXJuIDA7aWYoMCE9PWImJmIhPT1kJiYwPT09KGImZSkmJihlPWQmLWQsZj1iJi1iLGU+PWZ8fDE2PT09ZSYmMCE9PShmJjQxOTQyNDApKSlyZXR1cm4gYjswIT09KGQmNCkmJihkfD1jJjE2KTtiPWEuZW50YW5nbGVkTGFuZXM7aWYoMCE9PWIpZm9yKGE9YS5lbnRhbmdsZW1lbnRzLGImPWQ7MDxiOyljPTMxLW9jKGIpLGU9MTw8YyxkfD1hW2NdLGImPX5lO3JldHVybiBkfQpmdW5jdGlvbiB2YyhhLGIpe3N3aXRjaChhKXtjYXNlIDE6Y2FzZSAyOmNhc2UgNDpyZXR1cm4gYisyNTA7Y2FzZSA4OmNhc2UgMTY6Y2FzZSAzMjpjYXNlIDY0OmNhc2UgMTI4OmNhc2UgMjU2OmNhc2UgNTEyOmNhc2UgMTAyNDpjYXNlIDIwNDg6Y2FzZSA0MDk2OmNhc2UgODE5MjpjYXNlIDE2Mzg0OmNhc2UgMzI3Njg6Y2FzZSA2NTUzNjpjYXNlIDEzMTA3MjpjYXNlIDI2MjE0NDpjYXNlIDUyNDI4ODpjYXNlIDEwNDg1NzY6Y2FzZSAyMDk3MTUyOnJldHVybiBiKzVFMztjYXNlIDQxOTQzMDQ6Y2FzZSA4Mzg4NjA4OmNhc2UgMTY3NzcyMTY6Y2FzZSAzMzU1NDQzMjpjYXNlIDY3MTA4ODY0OnJldHVybi0xO2Nhc2UgMTM0MjE3NzI4OmNhc2UgMjY4NDM1NDU2OmNhc2UgNTM2ODcwOTEyOmNhc2UgMTA3Mzc0MTgyNDpyZXR1cm4tMTtkZWZhdWx0OnJldHVybi0xfX0KZnVuY3Rpb24gd2MoYSxiKXtmb3IodmFyIGM9YS5zdXNwZW5kZWRMYW5lcyxkPWEucGluZ2VkTGFuZXMsZT1hLmV4cGlyYXRpb25UaW1lcyxmPWEucGVuZGluZ0xhbmVzOzA8Zjspe3ZhciBnPTMxLW9jKGYpLGg9MTw8ZyxrPWVbZ107aWYoLTE9PT1rKXtpZigwPT09KGgmYyl8fDAhPT0oaCZkKSllW2ddPXZjKGgsYil9ZWxzZSBrPD1iJiYoYS5leHBpcmVkTGFuZXN8PWgpO2YmPX5ofX1mdW5jdGlvbiB4YyhhKXthPWEucGVuZGluZ0xhbmVzJi0xMDczNzQxODI1O3JldHVybiAwIT09YT9hOmEmMTA3Mzc0MTgyND8xMDczNzQxODI0OjB9ZnVuY3Rpb24geWMoKXt2YXIgYT1yYztyYzw8PTE7MD09PShyYyY0MTk0MjQwKSYmKHJjPTY0KTtyZXR1cm4gYX1mdW5jdGlvbiB6YyhhKXtmb3IodmFyIGI9W10sYz0wOzMxPmM7YysrKWIucHVzaChhKTtyZXR1cm4gYn0KZnVuY3Rpb24gQWMoYSxiLGMpe2EucGVuZGluZ0xhbmVzfD1iOzUzNjg3MDkxMiE9PWImJihhLnN1c3BlbmRlZExhbmVzPTAsYS5waW5nZWRMYW5lcz0wKTthPWEuZXZlbnRUaW1lcztiPTMxLW9jKGIpO2FbYl09Y31mdW5jdGlvbiBCYyhhLGIpe3ZhciBjPWEucGVuZGluZ0xhbmVzJn5iO2EucGVuZGluZ0xhbmVzPWI7YS5zdXNwZW5kZWRMYW5lcz0wO2EucGluZ2VkTGFuZXM9MDthLmV4cGlyZWRMYW5lcyY9YjthLm11dGFibGVSZWFkTGFuZXMmPWI7YS5lbnRhbmdsZWRMYW5lcyY9YjtiPWEuZW50YW5nbGVtZW50czt2YXIgZD1hLmV2ZW50VGltZXM7Zm9yKGE9YS5leHBpcmF0aW9uVGltZXM7MDxjOyl7dmFyIGU9MzEtb2MoYyksZj0xPDxlO2JbZV09MDtkW2VdPS0xO2FbZV09LTE7YyY9fmZ9fQpmdW5jdGlvbiBDYyhhLGIpe3ZhciBjPWEuZW50YW5nbGVkTGFuZXN8PWI7Zm9yKGE9YS5lbnRhbmdsZW1lbnRzO2M7KXt2YXIgZD0zMS1vYyhjKSxlPTE8PGQ7ZSZifGFbZF0mYiYmKGFbZF18PWIpO2MmPX5lfX12YXIgQz0wO2Z1bmN0aW9uIERjKGEpe2EmPS1hO3JldHVybiAxPGE/NDxhPzAhPT0oYSYyNjg0MzU0NTUpPzE2OjUzNjg3MDkxMjo0OjF9dmFyIEVjLEZjLEdjLEhjLEljLEpjPSExLEtjPVtdLExjPW51bGwsTWM9bnVsbCxOYz1udWxsLE9jPW5ldyBNYXAsUGM9bmV3IE1hcCxRYz1bXSxSYz0ibW91c2Vkb3duIG1vdXNldXAgdG91Y2hjYW5jZWwgdG91Y2hlbmQgdG91Y2hzdGFydCBhdXhjbGljayBkYmxjbGljayBwb2ludGVyY2FuY2VsIHBvaW50ZXJkb3duIHBvaW50ZXJ1cCBkcmFnZW5kIGRyYWdzdGFydCBkcm9wIGNvbXBvc2l0aW9uZW5kIGNvbXBvc2l0aW9uc3RhcnQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBpbnB1dCB0ZXh0SW5wdXQgY29weSBjdXQgcGFzdGUgY2xpY2sgY2hhbmdlIGNvbnRleHRtZW51IHJlc2V0IHN1Ym1pdCIuc3BsaXQoIiAiKTsKZnVuY3Rpb24gU2MoYSxiKXtzd2l0Y2goYSl7Y2FzZSAiZm9jdXNpbiI6Y2FzZSAiZm9jdXNvdXQiOkxjPW51bGw7YnJlYWs7Y2FzZSAiZHJhZ2VudGVyIjpjYXNlICJkcmFnbGVhdmUiOk1jPW51bGw7YnJlYWs7Y2FzZSAibW91c2VvdmVyIjpjYXNlICJtb3VzZW91dCI6TmM9bnVsbDticmVhaztjYXNlICJwb2ludGVyb3ZlciI6Y2FzZSAicG9pbnRlcm91dCI6T2MuZGVsZXRlKGIucG9pbnRlcklkKTticmVhaztjYXNlICJnb3Rwb2ludGVyY2FwdHVyZSI6Y2FzZSAibG9zdHBvaW50ZXJjYXB0dXJlIjpQYy5kZWxldGUoYi5wb2ludGVySWQpfX0KZnVuY3Rpb24gVGMoYSxiLGMsZCxlLGYpe2lmKG51bGw9PT1hfHxhLm5hdGl2ZUV2ZW50IT09ZilyZXR1cm4gYT17YmxvY2tlZE9uOmIsZG9tRXZlbnROYW1lOmMsZXZlbnRTeXN0ZW1GbGFnczpkLG5hdGl2ZUV2ZW50OmYsdGFyZ2V0Q29udGFpbmVyczpbZV19LG51bGwhPT1iJiYoYj1DYihiKSxudWxsIT09YiYmRmMoYikpLGE7YS5ldmVudFN5c3RlbUZsYWdzfD1kO2I9YS50YXJnZXRDb250YWluZXJzO251bGwhPT1lJiYtMT09PWIuaW5kZXhPZihlKSYmYi5wdXNoKGUpO3JldHVybiBhfQpmdW5jdGlvbiBVYyhhLGIsYyxkLGUpe3N3aXRjaChiKXtjYXNlICJmb2N1c2luIjpyZXR1cm4gTGM9VGMoTGMsYSxiLGMsZCxlKSwhMDtjYXNlICJkcmFnZW50ZXIiOnJldHVybiBNYz1UYyhNYyxhLGIsYyxkLGUpLCEwO2Nhc2UgIm1vdXNlb3ZlciI6cmV0dXJuIE5jPVRjKE5jLGEsYixjLGQsZSksITA7Y2FzZSAicG9pbnRlcm92ZXIiOnZhciBmPWUucG9pbnRlcklkO09jLnNldChmLFRjKE9jLmdldChmKXx8bnVsbCxhLGIsYyxkLGUpKTtyZXR1cm4hMDtjYXNlICJnb3Rwb2ludGVyY2FwdHVyZSI6cmV0dXJuIGY9ZS5wb2ludGVySWQsUGMuc2V0KGYsVGMoUGMuZ2V0KGYpfHxudWxsLGEsYixjLGQsZSkpLCEwfXJldHVybiExfQpmdW5jdGlvbiBWYyhhKXt2YXIgYj1XYyhhLnRhcmdldCk7aWYobnVsbCE9PWIpe3ZhciBjPVZiKGIpO2lmKG51bGwhPT1jKWlmKGI9Yy50YWcsMTM9PT1iKXtpZihiPVdiKGMpLG51bGwhPT1iKXthLmJsb2NrZWRPbj1iO0ljKGEucHJpb3JpdHksZnVuY3Rpb24oKXtHYyhjKX0pO3JldHVybn19ZWxzZSBpZigzPT09YiYmYy5zdGF0ZU5vZGUuY3VycmVudC5tZW1vaXplZFN0YXRlLmlzRGVoeWRyYXRlZCl7YS5ibG9ja2VkT249Mz09PWMudGFnP2Muc3RhdGVOb2RlLmNvbnRhaW5lckluZm86bnVsbDtyZXR1cm59fWEuYmxvY2tlZE9uPW51bGx9CmZ1bmN0aW9uIFhjKGEpe2lmKG51bGwhPT1hLmJsb2NrZWRPbilyZXR1cm4hMTtmb3IodmFyIGI9YS50YXJnZXRDb250YWluZXJzOzA8Yi5sZW5ndGg7KXt2YXIgYz1ZYyhhLmRvbUV2ZW50TmFtZSxhLmV2ZW50U3lzdGVtRmxhZ3MsYlswXSxhLm5hdGl2ZUV2ZW50KTtpZihudWxsPT09Yyl7Yz1hLm5hdGl2ZUV2ZW50O3ZhciBkPW5ldyBjLmNvbnN0cnVjdG9yKGMudHlwZSxjKTt3Yj1kO2MudGFyZ2V0LmRpc3BhdGNoRXZlbnQoZCk7d2I9bnVsbH1lbHNlIHJldHVybiBiPUNiKGMpLG51bGwhPT1iJiZGYyhiKSxhLmJsb2NrZWRPbj1jLCExO2Iuc2hpZnQoKX1yZXR1cm4hMH1mdW5jdGlvbiBaYyhhLGIsYyl7WGMoYSkmJmMuZGVsZXRlKGIpfWZ1bmN0aW9uICRjKCl7SmM9ITE7bnVsbCE9PUxjJiZYYyhMYykmJihMYz1udWxsKTtudWxsIT09TWMmJlhjKE1jKSYmKE1jPW51bGwpO251bGwhPT1OYyYmWGMoTmMpJiYoTmM9bnVsbCk7T2MuZm9yRWFjaChaYyk7UGMuZm9yRWFjaChaYyl9CmZ1bmN0aW9uIGFkKGEsYil7YS5ibG9ja2VkT249PT1iJiYoYS5ibG9ja2VkT249bnVsbCxKY3x8KEpjPSEwLGNhLnVuc3RhYmxlX3NjaGVkdWxlQ2FsbGJhY2soY2EudW5zdGFibGVfTm9ybWFsUHJpb3JpdHksJGMpKSl9CmZ1bmN0aW9uIGJkKGEpe2Z1bmN0aW9uIGIoYil7cmV0dXJuIGFkKGIsYSl9aWYoMDxLYy5sZW5ndGgpe2FkKEtjWzBdLGEpO2Zvcih2YXIgYz0xO2M8S2MubGVuZ3RoO2MrKyl7dmFyIGQ9S2NbY107ZC5ibG9ja2VkT249PT1hJiYoZC5ibG9ja2VkT249bnVsbCl9fW51bGwhPT1MYyYmYWQoTGMsYSk7bnVsbCE9PU1jJiZhZChNYyxhKTtudWxsIT09TmMmJmFkKE5jLGEpO09jLmZvckVhY2goYik7UGMuZm9yRWFjaChiKTtmb3IoYz0wO2M8UWMubGVuZ3RoO2MrKylkPVFjW2NdLGQuYmxvY2tlZE9uPT09YSYmKGQuYmxvY2tlZE9uPW51bGwpO2Zvcig7MDxRYy5sZW5ndGgmJihjPVFjWzBdLG51bGw9PT1jLmJsb2NrZWRPbik7KVZjKGMpLG51bGw9PT1jLmJsb2NrZWRPbiYmUWMuc2hpZnQoKX12YXIgY2Q9dWEuUmVhY3RDdXJyZW50QmF0Y2hDb25maWcsZGQ9ITA7CmZ1bmN0aW9uIGVkKGEsYixjLGQpe3ZhciBlPUMsZj1jZC50cmFuc2l0aW9uO2NkLnRyYW5zaXRpb249bnVsbDt0cnl7Qz0xLGZkKGEsYixjLGQpfWZpbmFsbHl7Qz1lLGNkLnRyYW5zaXRpb249Zn19ZnVuY3Rpb24gZ2QoYSxiLGMsZCl7dmFyIGU9QyxmPWNkLnRyYW5zaXRpb247Y2QudHJhbnNpdGlvbj1udWxsO3RyeXtDPTQsZmQoYSxiLGMsZCl9ZmluYWxseXtDPWUsY2QudHJhbnNpdGlvbj1mfX0KZnVuY3Rpb24gZmQoYSxiLGMsZCl7aWYoZGQpe3ZhciBlPVljKGEsYixjLGQpO2lmKG51bGw9PT1lKWhkKGEsYixkLGlkLGMpLFNjKGEsZCk7ZWxzZSBpZihVYyhlLGEsYixjLGQpKWQuc3RvcFByb3BhZ2F0aW9uKCk7ZWxzZSBpZihTYyhhLGQpLGImNCYmLTE8UmMuaW5kZXhPZihhKSl7Zm9yKDtudWxsIT09ZTspe3ZhciBmPUNiKGUpO251bGwhPT1mJiZFYyhmKTtmPVljKGEsYixjLGQpO251bGw9PT1mJiZoZChhLGIsZCxpZCxjKTtpZihmPT09ZSlicmVhaztlPWZ9bnVsbCE9PWUmJmQuc3RvcFByb3BhZ2F0aW9uKCl9ZWxzZSBoZChhLGIsZCxudWxsLGMpfX12YXIgaWQ9bnVsbDsKZnVuY3Rpb24gWWMoYSxiLGMsZCl7aWQ9bnVsbDthPXhiKGQpO2E9V2MoYSk7aWYobnVsbCE9PWEpaWYoYj1WYihhKSxudWxsPT09YilhPW51bGw7ZWxzZSBpZihjPWIudGFnLDEzPT09Yyl7YT1XYihiKTtpZihudWxsIT09YSlyZXR1cm4gYTthPW51bGx9ZWxzZSBpZigzPT09Yyl7aWYoYi5zdGF0ZU5vZGUuY3VycmVudC5tZW1vaXplZFN0YXRlLmlzRGVoeWRyYXRlZClyZXR1cm4gMz09PWIudGFnP2Iuc3RhdGVOb2RlLmNvbnRhaW5lckluZm86bnVsbDthPW51bGx9ZWxzZSBiIT09YSYmKGE9bnVsbCk7aWQ9YTtyZXR1cm4gbnVsbH0KZnVuY3Rpb24gamQoYSl7c3dpdGNoKGEpe2Nhc2UgImNhbmNlbCI6Y2FzZSAiY2xpY2siOmNhc2UgImNsb3NlIjpjYXNlICJjb250ZXh0bWVudSI6Y2FzZSAiY29weSI6Y2FzZSAiY3V0IjpjYXNlICJhdXhjbGljayI6Y2FzZSAiZGJsY2xpY2siOmNhc2UgImRyYWdlbmQiOmNhc2UgImRyYWdzdGFydCI6Y2FzZSAiZHJvcCI6Y2FzZSAiZm9jdXNpbiI6Y2FzZSAiZm9jdXNvdXQiOmNhc2UgImlucHV0IjpjYXNlICJpbnZhbGlkIjpjYXNlICJrZXlkb3duIjpjYXNlICJrZXlwcmVzcyI6Y2FzZSAia2V5dXAiOmNhc2UgIm1vdXNlZG93biI6Y2FzZSAibW91c2V1cCI6Y2FzZSAicGFzdGUiOmNhc2UgInBhdXNlIjpjYXNlICJwbGF5IjpjYXNlICJwb2ludGVyY2FuY2VsIjpjYXNlICJwb2ludGVyZG93biI6Y2FzZSAicG9pbnRlcnVwIjpjYXNlICJyYXRlY2hhbmdlIjpjYXNlICJyZXNldCI6Y2FzZSAicmVzaXplIjpjYXNlICJzZWVrZWQiOmNhc2UgInN1Ym1pdCI6Y2FzZSAidG91Y2hjYW5jZWwiOmNhc2UgInRvdWNoZW5kIjpjYXNlICJ0b3VjaHN0YXJ0IjpjYXNlICJ2b2x1bWVjaGFuZ2UiOmNhc2UgImNoYW5nZSI6Y2FzZSAic2VsZWN0aW9uY2hhbmdlIjpjYXNlICJ0ZXh0SW5wdXQiOmNhc2UgImNvbXBvc2l0aW9uc3RhcnQiOmNhc2UgImNvbXBvc2l0aW9uZW5kIjpjYXNlICJjb21wb3NpdGlvbnVwZGF0ZSI6Y2FzZSAiYmVmb3JlYmx1ciI6Y2FzZSAiYWZ0ZXJibHVyIjpjYXNlICJiZWZvcmVpbnB1dCI6Y2FzZSAiYmx1ciI6Y2FzZSAiZnVsbHNjcmVlbmNoYW5nZSI6Y2FzZSAiZm9jdXMiOmNhc2UgImhhc2hjaGFuZ2UiOmNhc2UgInBvcHN0YXRlIjpjYXNlICJzZWxlY3QiOmNhc2UgInNlbGVjdHN0YXJ0IjpyZXR1cm4gMTtjYXNlICJkcmFnIjpjYXNlICJkcmFnZW50ZXIiOmNhc2UgImRyYWdleGl0IjpjYXNlICJkcmFnbGVhdmUiOmNhc2UgImRyYWdvdmVyIjpjYXNlICJtb3VzZW1vdmUiOmNhc2UgIm1vdXNlb3V0IjpjYXNlICJtb3VzZW92ZXIiOmNhc2UgInBvaW50ZXJtb3ZlIjpjYXNlICJwb2ludGVyb3V0IjpjYXNlICJwb2ludGVyb3ZlciI6Y2FzZSAic2Nyb2xsIjpjYXNlICJ0b2dnbGUiOmNhc2UgInRvdWNobW92ZSI6Y2FzZSAid2hlZWwiOmNhc2UgIm1vdXNlZW50ZXIiOmNhc2UgIm1vdXNlbGVhdmUiOmNhc2UgInBvaW50ZXJlbnRlciI6Y2FzZSAicG9pbnRlcmxlYXZlIjpyZXR1cm4gNDsKY2FzZSAibWVzc2FnZSI6c3dpdGNoKGVjKCkpe2Nhc2UgZmM6cmV0dXJuIDE7Y2FzZSBnYzpyZXR1cm4gNDtjYXNlIGhjOmNhc2UgaWM6cmV0dXJuIDE2O2Nhc2UgamM6cmV0dXJuIDUzNjg3MDkxMjtkZWZhdWx0OnJldHVybiAxNn1kZWZhdWx0OnJldHVybiAxNn19dmFyIGtkPW51bGwsbGQ9bnVsbCxtZD1udWxsO2Z1bmN0aW9uIG5kKCl7aWYobWQpcmV0dXJuIG1kO3ZhciBhLGI9bGQsYz1iLmxlbmd0aCxkLGU9InZhbHVlImluIGtkP2tkLnZhbHVlOmtkLnRleHRDb250ZW50LGY9ZS5sZW5ndGg7Zm9yKGE9MDthPGMmJmJbYV09PT1lW2FdO2ErKyk7dmFyIGc9Yy1hO2ZvcihkPTE7ZDw9ZyYmYltjLWRdPT09ZVtmLWRdO2QrKyk7cmV0dXJuIG1kPWUuc2xpY2UoYSwxPGQ/MS1kOnZvaWQgMCl9CmZ1bmN0aW9uIG9kKGEpe3ZhciBiPWEua2V5Q29kZTsiY2hhckNvZGUiaW4gYT8oYT1hLmNoYXJDb2RlLDA9PT1hJiYxMz09PWImJihhPTEzKSk6YT1iOzEwPT09YSYmKGE9MTMpO3JldHVybiAzMjw9YXx8MTM9PT1hP2E6MH1mdW5jdGlvbiBwZCgpe3JldHVybiEwfWZ1bmN0aW9uIHFkKCl7cmV0dXJuITF9CmZ1bmN0aW9uIHJkKGEpe2Z1bmN0aW9uIGIoYixkLGUsZixnKXt0aGlzLl9yZWFjdE5hbWU9Yjt0aGlzLl90YXJnZXRJbnN0PWU7dGhpcy50eXBlPWQ7dGhpcy5uYXRpdmVFdmVudD1mO3RoaXMudGFyZ2V0PWc7dGhpcy5jdXJyZW50VGFyZ2V0PW51bGw7Zm9yKHZhciBjIGluIGEpYS5oYXNPd25Qcm9wZXJ0eShjKSYmKGI9YVtjXSx0aGlzW2NdPWI/YihmKTpmW2NdKTt0aGlzLmlzRGVmYXVsdFByZXZlbnRlZD0obnVsbCE9Zi5kZWZhdWx0UHJldmVudGVkP2YuZGVmYXVsdFByZXZlbnRlZDohMT09PWYucmV0dXJuVmFsdWUpP3BkOnFkO3RoaXMuaXNQcm9wYWdhdGlvblN0b3BwZWQ9cWQ7cmV0dXJuIHRoaXN9QShiLnByb3RvdHlwZSx7cHJldmVudERlZmF1bHQ6ZnVuY3Rpb24oKXt0aGlzLmRlZmF1bHRQcmV2ZW50ZWQ9ITA7dmFyIGE9dGhpcy5uYXRpdmVFdmVudDthJiYoYS5wcmV2ZW50RGVmYXVsdD9hLnByZXZlbnREZWZhdWx0KCk6InVua25vd24iIT09dHlwZW9mIGEucmV0dXJuVmFsdWUmJgooYS5yZXR1cm5WYWx1ZT0hMSksdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQ9cGQpfSxzdG9wUHJvcGFnYXRpb246ZnVuY3Rpb24oKXt2YXIgYT10aGlzLm5hdGl2ZUV2ZW50O2EmJihhLnN0b3BQcm9wYWdhdGlvbj9hLnN0b3BQcm9wYWdhdGlvbigpOiJ1bmtub3duIiE9PXR5cGVvZiBhLmNhbmNlbEJ1YmJsZSYmKGEuY2FuY2VsQnViYmxlPSEwKSx0aGlzLmlzUHJvcGFnYXRpb25TdG9wcGVkPXBkKX0scGVyc2lzdDpmdW5jdGlvbigpe30saXNQZXJzaXN0ZW50OnBkfSk7cmV0dXJuIGJ9CnZhciBzZD17ZXZlbnRQaGFzZTowLGJ1YmJsZXM6MCxjYW5jZWxhYmxlOjAsdGltZVN0YW1wOmZ1bmN0aW9uKGEpe3JldHVybiBhLnRpbWVTdGFtcHx8RGF0ZS5ub3coKX0sZGVmYXVsdFByZXZlbnRlZDowLGlzVHJ1c3RlZDowfSx0ZD1yZChzZCksdWQ9QSh7fSxzZCx7dmlldzowLGRldGFpbDowfSksdmQ9cmQodWQpLHdkLHhkLHlkLEFkPUEoe30sdWQse3NjcmVlblg6MCxzY3JlZW5ZOjAsY2xpZW50WDowLGNsaWVudFk6MCxwYWdlWDowLHBhZ2VZOjAsY3RybEtleTowLHNoaWZ0S2V5OjAsYWx0S2V5OjAsbWV0YUtleTowLGdldE1vZGlmaWVyU3RhdGU6emQsYnV0dG9uOjAsYnV0dG9uczowLHJlbGF0ZWRUYXJnZXQ6ZnVuY3Rpb24oYSl7cmV0dXJuIHZvaWQgMD09PWEucmVsYXRlZFRhcmdldD9hLmZyb21FbGVtZW50PT09YS5zcmNFbGVtZW50P2EudG9FbGVtZW50OmEuZnJvbUVsZW1lbnQ6YS5yZWxhdGVkVGFyZ2V0fSxtb3ZlbWVudFg6ZnVuY3Rpb24oYSl7aWYoIm1vdmVtZW50WCJpbgphKXJldHVybiBhLm1vdmVtZW50WDthIT09eWQmJih5ZCYmIm1vdXNlbW92ZSI9PT1hLnR5cGU/KHdkPWEuc2NyZWVuWC15ZC5zY3JlZW5YLHhkPWEuc2NyZWVuWS15ZC5zY3JlZW5ZKTp4ZD13ZD0wLHlkPWEpO3JldHVybiB3ZH0sbW92ZW1lbnRZOmZ1bmN0aW9uKGEpe3JldHVybiJtb3ZlbWVudFkiaW4gYT9hLm1vdmVtZW50WTp4ZH19KSxCZD1yZChBZCksQ2Q9QSh7fSxBZCx7ZGF0YVRyYW5zZmVyOjB9KSxEZD1yZChDZCksRWQ9QSh7fSx1ZCx7cmVsYXRlZFRhcmdldDowfSksRmQ9cmQoRWQpLEdkPUEoe30sc2Qse2FuaW1hdGlvbk5hbWU6MCxlbGFwc2VkVGltZTowLHBzZXVkb0VsZW1lbnQ6MH0pLEhkPXJkKEdkKSxJZD1BKHt9LHNkLHtjbGlwYm9hcmREYXRhOmZ1bmN0aW9uKGEpe3JldHVybiJjbGlwYm9hcmREYXRhImluIGE/YS5jbGlwYm9hcmREYXRhOndpbmRvdy5jbGlwYm9hcmREYXRhfX0pLEpkPXJkKElkKSxLZD1BKHt9LHNkLHtkYXRhOjB9KSxMZD1yZChLZCksTWQ9e0VzYzoiRXNjYXBlIiwKU3BhY2ViYXI6IiAiLExlZnQ6IkFycm93TGVmdCIsVXA6IkFycm93VXAiLFJpZ2h0OiJBcnJvd1JpZ2h0IixEb3duOiJBcnJvd0Rvd24iLERlbDoiRGVsZXRlIixXaW46Ik9TIixNZW51OiJDb250ZXh0TWVudSIsQXBwczoiQ29udGV4dE1lbnUiLFNjcm9sbDoiU2Nyb2xsTG9jayIsTW96UHJpbnRhYmxlS2V5OiJVbmlkZW50aWZpZWQifSxOZD17ODoiQmFja3NwYWNlIiw5OiJUYWIiLDEyOiJDbGVhciIsMTM6IkVudGVyIiwxNjoiU2hpZnQiLDE3OiJDb250cm9sIiwxODoiQWx0IiwxOToiUGF1c2UiLDIwOiJDYXBzTG9jayIsMjc6IkVzY2FwZSIsMzI6IiAiLDMzOiJQYWdlVXAiLDM0OiJQYWdlRG93biIsMzU6IkVuZCIsMzY6IkhvbWUiLDM3OiJBcnJvd0xlZnQiLDM4OiJBcnJvd1VwIiwzOToiQXJyb3dSaWdodCIsNDA6IkFycm93RG93biIsNDU6Ikluc2VydCIsNDY6IkRlbGV0ZSIsMTEyOiJGMSIsMTEzOiJGMiIsMTE0OiJGMyIsMTE1OiJGNCIsMTE2OiJGNSIsMTE3OiJGNiIsMTE4OiJGNyIsCjExOToiRjgiLDEyMDoiRjkiLDEyMToiRjEwIiwxMjI6IkYxMSIsMTIzOiJGMTIiLDE0NDoiTnVtTG9jayIsMTQ1OiJTY3JvbGxMb2NrIiwyMjQ6Ik1ldGEifSxPZD17QWx0OiJhbHRLZXkiLENvbnRyb2w6ImN0cmxLZXkiLE1ldGE6Im1ldGFLZXkiLFNoaWZ0OiJzaGlmdEtleSJ9O2Z1bmN0aW9uIFBkKGEpe3ZhciBiPXRoaXMubmF0aXZlRXZlbnQ7cmV0dXJuIGIuZ2V0TW9kaWZpZXJTdGF0ZT9iLmdldE1vZGlmaWVyU3RhdGUoYSk6KGE9T2RbYV0pPyEhYlthXTohMX1mdW5jdGlvbiB6ZCgpe3JldHVybiBQZH0KdmFyIFFkPUEoe30sdWQse2tleTpmdW5jdGlvbihhKXtpZihhLmtleSl7dmFyIGI9TWRbYS5rZXldfHxhLmtleTtpZigiVW5pZGVudGlmaWVkIiE9PWIpcmV0dXJuIGJ9cmV0dXJuImtleXByZXNzIj09PWEudHlwZT8oYT1vZChhKSwxMz09PWE/IkVudGVyIjpTdHJpbmcuZnJvbUNoYXJDb2RlKGEpKToia2V5ZG93biI9PT1hLnR5cGV8fCJrZXl1cCI9PT1hLnR5cGU/TmRbYS5rZXlDb2RlXXx8IlVuaWRlbnRpZmllZCI6IiJ9LGNvZGU6MCxsb2NhdGlvbjowLGN0cmxLZXk6MCxzaGlmdEtleTowLGFsdEtleTowLG1ldGFLZXk6MCxyZXBlYXQ6MCxsb2NhbGU6MCxnZXRNb2RpZmllclN0YXRlOnpkLGNoYXJDb2RlOmZ1bmN0aW9uKGEpe3JldHVybiJrZXlwcmVzcyI9PT1hLnR5cGU/b2QoYSk6MH0sa2V5Q29kZTpmdW5jdGlvbihhKXtyZXR1cm4ia2V5ZG93biI9PT1hLnR5cGV8fCJrZXl1cCI9PT1hLnR5cGU/YS5rZXlDb2RlOjB9LHdoaWNoOmZ1bmN0aW9uKGEpe3JldHVybiJrZXlwcmVzcyI9PT0KYS50eXBlP29kKGEpOiJrZXlkb3duIj09PWEudHlwZXx8ImtleXVwIj09PWEudHlwZT9hLmtleUNvZGU6MH19KSxSZD1yZChRZCksU2Q9QSh7fSxBZCx7cG9pbnRlcklkOjAsd2lkdGg6MCxoZWlnaHQ6MCxwcmVzc3VyZTowLHRhbmdlbnRpYWxQcmVzc3VyZTowLHRpbHRYOjAsdGlsdFk6MCx0d2lzdDowLHBvaW50ZXJUeXBlOjAsaXNQcmltYXJ5OjB9KSxUZD1yZChTZCksVWQ9QSh7fSx1ZCx7dG91Y2hlczowLHRhcmdldFRvdWNoZXM6MCxjaGFuZ2VkVG91Y2hlczowLGFsdEtleTowLG1ldGFLZXk6MCxjdHJsS2V5OjAsc2hpZnRLZXk6MCxnZXRNb2RpZmllclN0YXRlOnpkfSksVmQ9cmQoVWQpLFdkPUEoe30sc2Qse3Byb3BlcnR5TmFtZTowLGVsYXBzZWRUaW1lOjAscHNldWRvRWxlbWVudDowfSksWGQ9cmQoV2QpLFlkPUEoe30sQWQse2RlbHRhWDpmdW5jdGlvbihhKXtyZXR1cm4iZGVsdGFYImluIGE/YS5kZWx0YVg6IndoZWVsRGVsdGFYImluIGE/LWEud2hlZWxEZWx0YVg6MH0sCmRlbHRhWTpmdW5jdGlvbihhKXtyZXR1cm4iZGVsdGFZImluIGE/YS5kZWx0YVk6IndoZWVsRGVsdGFZImluIGE/LWEud2hlZWxEZWx0YVk6IndoZWVsRGVsdGEiaW4gYT8tYS53aGVlbERlbHRhOjB9LGRlbHRhWjowLGRlbHRhTW9kZTowfSksWmQ9cmQoWWQpLCRkPVs5LDEzLDI3LDMyXSxhZT1pYSYmIkNvbXBvc2l0aW9uRXZlbnQiaW4gd2luZG93LGJlPW51bGw7aWEmJiJkb2N1bWVudE1vZGUiaW4gZG9jdW1lbnQmJihiZT1kb2N1bWVudC5kb2N1bWVudE1vZGUpO3ZhciBjZT1pYSYmIlRleHRFdmVudCJpbiB3aW5kb3cmJiFiZSxkZT1pYSYmKCFhZXx8YmUmJjg8YmUmJjExPj1iZSksZWU9U3RyaW5nLmZyb21DaGFyQ29kZSgzMiksZmU9ITE7CmZ1bmN0aW9uIGdlKGEsYil7c3dpdGNoKGEpe2Nhc2UgImtleXVwIjpyZXR1cm4tMSE9PSRkLmluZGV4T2YoYi5rZXlDb2RlKTtjYXNlICJrZXlkb3duIjpyZXR1cm4gMjI5IT09Yi5rZXlDb2RlO2Nhc2UgImtleXByZXNzIjpjYXNlICJtb3VzZWRvd24iOmNhc2UgImZvY3Vzb3V0IjpyZXR1cm4hMDtkZWZhdWx0OnJldHVybiExfX1mdW5jdGlvbiBoZShhKXthPWEuZGV0YWlsO3JldHVybiJvYmplY3QiPT09dHlwZW9mIGEmJiJkYXRhImluIGE/YS5kYXRhOm51bGx9dmFyIGllPSExO2Z1bmN0aW9uIGplKGEsYil7c3dpdGNoKGEpe2Nhc2UgImNvbXBvc2l0aW9uZW5kIjpyZXR1cm4gaGUoYik7Y2FzZSAia2V5cHJlc3MiOmlmKDMyIT09Yi53aGljaClyZXR1cm4gbnVsbDtmZT0hMDtyZXR1cm4gZWU7Y2FzZSAidGV4dElucHV0IjpyZXR1cm4gYT1iLmRhdGEsYT09PWVlJiZmZT9udWxsOmE7ZGVmYXVsdDpyZXR1cm4gbnVsbH19CmZ1bmN0aW9uIGtlKGEsYil7aWYoaWUpcmV0dXJuImNvbXBvc2l0aW9uZW5kIj09PWF8fCFhZSYmZ2UoYSxiKT8oYT1uZCgpLG1kPWxkPWtkPW51bGwsaWU9ITEsYSk6bnVsbDtzd2l0Y2goYSl7Y2FzZSAicGFzdGUiOnJldHVybiBudWxsO2Nhc2UgImtleXByZXNzIjppZighKGIuY3RybEtleXx8Yi5hbHRLZXl8fGIubWV0YUtleSl8fGIuY3RybEtleSYmYi5hbHRLZXkpe2lmKGIuY2hhciYmMTxiLmNoYXIubGVuZ3RoKXJldHVybiBiLmNoYXI7aWYoYi53aGljaClyZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShiLndoaWNoKX1yZXR1cm4gbnVsbDtjYXNlICJjb21wb3NpdGlvbmVuZCI6cmV0dXJuIGRlJiYia28iIT09Yi5sb2NhbGU/bnVsbDpiLmRhdGE7ZGVmYXVsdDpyZXR1cm4gbnVsbH19CnZhciBsZT17Y29sb3I6ITAsZGF0ZTohMCxkYXRldGltZTohMCwiZGF0ZXRpbWUtbG9jYWwiOiEwLGVtYWlsOiEwLG1vbnRoOiEwLG51bWJlcjohMCxwYXNzd29yZDohMCxyYW5nZTohMCxzZWFyY2g6ITAsdGVsOiEwLHRleHQ6ITAsdGltZTohMCx1cmw6ITAsd2VlazohMH07ZnVuY3Rpb24gbWUoYSl7dmFyIGI9YSYmYS5ub2RlTmFtZSYmYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO3JldHVybiJpbnB1dCI9PT1iPyEhbGVbYS50eXBlXToidGV4dGFyZWEiPT09Yj8hMDohMX1mdW5jdGlvbiBuZShhLGIsYyxkKXtFYihkKTtiPW9lKGIsIm9uQ2hhbmdlIik7MDxiLmxlbmd0aCYmKGM9bmV3IHRkKCJvbkNoYW5nZSIsImNoYW5nZSIsbnVsbCxjLGQpLGEucHVzaCh7ZXZlbnQ6YyxsaXN0ZW5lcnM6Yn0pKX12YXIgcGU9bnVsbCxxZT1udWxsO2Z1bmN0aW9uIHJlKGEpe3NlKGEsMCl9ZnVuY3Rpb24gdGUoYSl7dmFyIGI9dWUoYSk7aWYoV2EoYikpcmV0dXJuIGF9CmZ1bmN0aW9uIHZlKGEsYil7aWYoImNoYW5nZSI9PT1hKXJldHVybiBifXZhciB3ZT0hMTtpZihpYSl7dmFyIHhlO2lmKGlhKXt2YXIgeWU9Im9uaW5wdXQiaW4gZG9jdW1lbnQ7aWYoIXllKXt2YXIgemU9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7emUuc2V0QXR0cmlidXRlKCJvbmlucHV0IiwicmV0dXJuOyIpO3llPSJmdW5jdGlvbiI9PT10eXBlb2YgemUub25pbnB1dH14ZT15ZX1lbHNlIHhlPSExO3dlPXhlJiYoIWRvY3VtZW50LmRvY3VtZW50TW9kZXx8OTxkb2N1bWVudC5kb2N1bWVudE1vZGUpfWZ1bmN0aW9uIEFlKCl7cGUmJihwZS5kZXRhY2hFdmVudCgib25wcm9wZXJ0eWNoYW5nZSIsQmUpLHFlPXBlPW51bGwpfWZ1bmN0aW9uIEJlKGEpe2lmKCJ2YWx1ZSI9PT1hLnByb3BlcnR5TmFtZSYmdGUocWUpKXt2YXIgYj1bXTtuZShiLHFlLGEseGIoYSkpO0piKHJlLGIpfX0KZnVuY3Rpb24gQ2UoYSxiLGMpeyJmb2N1c2luIj09PWE/KEFlKCkscGU9YixxZT1jLHBlLmF0dGFjaEV2ZW50KCJvbnByb3BlcnR5Y2hhbmdlIixCZSkpOiJmb2N1c291dCI9PT1hJiZBZSgpfWZ1bmN0aW9uIERlKGEpe2lmKCJzZWxlY3Rpb25jaGFuZ2UiPT09YXx8ImtleXVwIj09PWF8fCJrZXlkb3duIj09PWEpcmV0dXJuIHRlKHFlKX1mdW5jdGlvbiBFZShhLGIpe2lmKCJjbGljayI9PT1hKXJldHVybiB0ZShiKX1mdW5jdGlvbiBGZShhLGIpe2lmKCJpbnB1dCI9PT1hfHwiY2hhbmdlIj09PWEpcmV0dXJuIHRlKGIpfWZ1bmN0aW9uIEdlKGEsYil7cmV0dXJuIGE9PT1iJiYoMCE9PWF8fDEvYT09PTEvYil8fGEhPT1hJiZiIT09Yn12YXIgSGU9ImZ1bmN0aW9uIj09PXR5cGVvZiBPYmplY3QuaXM/T2JqZWN0LmlzOkdlOwpmdW5jdGlvbiBJZShhLGIpe2lmKEhlKGEsYikpcmV0dXJuITA7aWYoIm9iamVjdCIhPT10eXBlb2YgYXx8bnVsbD09PWF8fCJvYmplY3QiIT09dHlwZW9mIGJ8fG51bGw9PT1iKXJldHVybiExO3ZhciBjPU9iamVjdC5rZXlzKGEpLGQ9T2JqZWN0LmtleXMoYik7aWYoYy5sZW5ndGghPT1kLmxlbmd0aClyZXR1cm4hMTtmb3IoZD0wO2Q8Yy5sZW5ndGg7ZCsrKXt2YXIgZT1jW2RdO2lmKCFqYS5jYWxsKGIsZSl8fCFIZShhW2VdLGJbZV0pKXJldHVybiExfXJldHVybiEwfWZ1bmN0aW9uIEplKGEpe2Zvcig7YSYmYS5maXJzdENoaWxkOylhPWEuZmlyc3RDaGlsZDtyZXR1cm4gYX0KZnVuY3Rpb24gS2UoYSxiKXt2YXIgYz1KZShhKTthPTA7Zm9yKHZhciBkO2M7KXtpZigzPT09Yy5ub2RlVHlwZSl7ZD1hK2MudGV4dENvbnRlbnQubGVuZ3RoO2lmKGE8PWImJmQ+PWIpcmV0dXJue25vZGU6YyxvZmZzZXQ6Yi1hfTthPWR9YTp7Zm9yKDtjOyl7aWYoYy5uZXh0U2libGluZyl7Yz1jLm5leHRTaWJsaW5nO2JyZWFrIGF9Yz1jLnBhcmVudE5vZGV9Yz12b2lkIDB9Yz1KZShjKX19ZnVuY3Rpb24gTGUoYSxiKXtyZXR1cm4gYSYmYj9hPT09Yj8hMDphJiYzPT09YS5ub2RlVHlwZT8hMTpiJiYzPT09Yi5ub2RlVHlwZT9MZShhLGIucGFyZW50Tm9kZSk6ImNvbnRhaW5zImluIGE/YS5jb250YWlucyhiKTphLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uPyEhKGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYikmMTYpOiExOiExfQpmdW5jdGlvbiBNZSgpe2Zvcih2YXIgYT13aW5kb3csYj1YYSgpO2IgaW5zdGFuY2VvZiBhLkhUTUxJRnJhbWVFbGVtZW50Oyl7dHJ5e3ZhciBjPSJzdHJpbmciPT09dHlwZW9mIGIuY29udGVudFdpbmRvdy5sb2NhdGlvbi5ocmVmfWNhdGNoKGQpe2M9ITF9aWYoYylhPWIuY29udGVudFdpbmRvdztlbHNlIGJyZWFrO2I9WGEoYS5kb2N1bWVudCl9cmV0dXJuIGJ9ZnVuY3Rpb24gTmUoYSl7dmFyIGI9YSYmYS5ub2RlTmFtZSYmYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO3JldHVybiBiJiYoImlucHV0Ij09PWImJigidGV4dCI9PT1hLnR5cGV8fCJzZWFyY2giPT09YS50eXBlfHwidGVsIj09PWEudHlwZXx8InVybCI9PT1hLnR5cGV8fCJwYXNzd29yZCI9PT1hLnR5cGUpfHwidGV4dGFyZWEiPT09Ynx8InRydWUiPT09YS5jb250ZW50RWRpdGFibGUpfQpmdW5jdGlvbiBPZShhKXt2YXIgYj1NZSgpLGM9YS5mb2N1c2VkRWxlbSxkPWEuc2VsZWN0aW9uUmFuZ2U7aWYoYiE9PWMmJmMmJmMub3duZXJEb2N1bWVudCYmTGUoYy5vd25lckRvY3VtZW50LmRvY3VtZW50RWxlbWVudCxjKSl7aWYobnVsbCE9PWQmJk5lKGMpKWlmKGI9ZC5zdGFydCxhPWQuZW5kLHZvaWQgMD09PWEmJihhPWIpLCJzZWxlY3Rpb25TdGFydCJpbiBjKWMuc2VsZWN0aW9uU3RhcnQ9YixjLnNlbGVjdGlvbkVuZD1NYXRoLm1pbihhLGMudmFsdWUubGVuZ3RoKTtlbHNlIGlmKGE9KGI9Yy5vd25lckRvY3VtZW50fHxkb2N1bWVudCkmJmIuZGVmYXVsdFZpZXd8fHdpbmRvdyxhLmdldFNlbGVjdGlvbil7YT1hLmdldFNlbGVjdGlvbigpO3ZhciBlPWMudGV4dENvbnRlbnQubGVuZ3RoLGY9TWF0aC5taW4oZC5zdGFydCxlKTtkPXZvaWQgMD09PWQuZW5kP2Y6TWF0aC5taW4oZC5lbmQsZSk7IWEuZXh0ZW5kJiZmPmQmJihlPWQsZD1mLGY9ZSk7ZT1LZShjLGYpO3ZhciBnPUtlKGMsCmQpO2UmJmcmJigxIT09YS5yYW5nZUNvdW50fHxhLmFuY2hvck5vZGUhPT1lLm5vZGV8fGEuYW5jaG9yT2Zmc2V0IT09ZS5vZmZzZXR8fGEuZm9jdXNOb2RlIT09Zy5ub2RlfHxhLmZvY3VzT2Zmc2V0IT09Zy5vZmZzZXQpJiYoYj1iLmNyZWF0ZVJhbmdlKCksYi5zZXRTdGFydChlLm5vZGUsZS5vZmZzZXQpLGEucmVtb3ZlQWxsUmFuZ2VzKCksZj5kPyhhLmFkZFJhbmdlKGIpLGEuZXh0ZW5kKGcubm9kZSxnLm9mZnNldCkpOihiLnNldEVuZChnLm5vZGUsZy5vZmZzZXQpLGEuYWRkUmFuZ2UoYikpKX1iPVtdO2ZvcihhPWM7YT1hLnBhcmVudE5vZGU7KTE9PT1hLm5vZGVUeXBlJiZiLnB1c2goe2VsZW1lbnQ6YSxsZWZ0OmEuc2Nyb2xsTGVmdCx0b3A6YS5zY3JvbGxUb3B9KTsiZnVuY3Rpb24iPT09dHlwZW9mIGMuZm9jdXMmJmMuZm9jdXMoKTtmb3IoYz0wO2M8Yi5sZW5ndGg7YysrKWE9YltjXSxhLmVsZW1lbnQuc2Nyb2xsTGVmdD1hLmxlZnQsYS5lbGVtZW50LnNjcm9sbFRvcD1hLnRvcH19CnZhciBQZT1pYSYmImRvY3VtZW50TW9kZSJpbiBkb2N1bWVudCYmMTE+PWRvY3VtZW50LmRvY3VtZW50TW9kZSxRZT1udWxsLFJlPW51bGwsU2U9bnVsbCxUZT0hMTsKZnVuY3Rpb24gVWUoYSxiLGMpe3ZhciBkPWMud2luZG93PT09Yz9jLmRvY3VtZW50Ojk9PT1jLm5vZGVUeXBlP2M6Yy5vd25lckRvY3VtZW50O1RlfHxudWxsPT1RZXx8UWUhPT1YYShkKXx8KGQ9UWUsInNlbGVjdGlvblN0YXJ0ImluIGQmJk5lKGQpP2Q9e3N0YXJ0OmQuc2VsZWN0aW9uU3RhcnQsZW5kOmQuc2VsZWN0aW9uRW5kfTooZD0oZC5vd25lckRvY3VtZW50JiZkLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXd8fHdpbmRvdykuZ2V0U2VsZWN0aW9uKCksZD17YW5jaG9yTm9kZTpkLmFuY2hvck5vZGUsYW5jaG9yT2Zmc2V0OmQuYW5jaG9yT2Zmc2V0LGZvY3VzTm9kZTpkLmZvY3VzTm9kZSxmb2N1c09mZnNldDpkLmZvY3VzT2Zmc2V0fSksU2UmJkllKFNlLGQpfHwoU2U9ZCxkPW9lKFJlLCJvblNlbGVjdCIpLDA8ZC5sZW5ndGgmJihiPW5ldyB0ZCgib25TZWxlY3QiLCJzZWxlY3QiLG51bGwsYixjKSxhLnB1c2goe2V2ZW50OmIsbGlzdGVuZXJzOmR9KSxiLnRhcmdldD1RZSkpKX0KZnVuY3Rpb24gVmUoYSxiKXt2YXIgYz17fTtjW2EudG9Mb3dlckNhc2UoKV09Yi50b0xvd2VyQ2FzZSgpO2NbIldlYmtpdCIrYV09IndlYmtpdCIrYjtjWyJNb3oiK2FdPSJtb3oiK2I7cmV0dXJuIGN9dmFyIFdlPXthbmltYXRpb25lbmQ6VmUoIkFuaW1hdGlvbiIsIkFuaW1hdGlvbkVuZCIpLGFuaW1hdGlvbml0ZXJhdGlvbjpWZSgiQW5pbWF0aW9uIiwiQW5pbWF0aW9uSXRlcmF0aW9uIiksYW5pbWF0aW9uc3RhcnQ6VmUoIkFuaW1hdGlvbiIsIkFuaW1hdGlvblN0YXJ0IiksdHJhbnNpdGlvbmVuZDpWZSgiVHJhbnNpdGlvbiIsIlRyYW5zaXRpb25FbmQiKX0sWGU9e30sWWU9e307CmlhJiYoWWU9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iikuc3R5bGUsIkFuaW1hdGlvbkV2ZW50ImluIHdpbmRvd3x8KGRlbGV0ZSBXZS5hbmltYXRpb25lbmQuYW5pbWF0aW9uLGRlbGV0ZSBXZS5hbmltYXRpb25pdGVyYXRpb24uYW5pbWF0aW9uLGRlbGV0ZSBXZS5hbmltYXRpb25zdGFydC5hbmltYXRpb24pLCJUcmFuc2l0aW9uRXZlbnQiaW4gd2luZG93fHxkZWxldGUgV2UudHJhbnNpdGlvbmVuZC50cmFuc2l0aW9uKTtmdW5jdGlvbiBaZShhKXtpZihYZVthXSlyZXR1cm4gWGVbYV07aWYoIVdlW2FdKXJldHVybiBhO3ZhciBiPVdlW2FdLGM7Zm9yKGMgaW4gYilpZihiLmhhc093blByb3BlcnR5KGMpJiZjIGluIFllKXJldHVybiBYZVthXT1iW2NdO3JldHVybiBhfXZhciAkZT1aZSgiYW5pbWF0aW9uZW5kIiksYWY9WmUoImFuaW1hdGlvbml0ZXJhdGlvbiIpLGJmPVplKCJhbmltYXRpb25zdGFydCIpLGNmPVplKCJ0cmFuc2l0aW9uZW5kIiksZGY9bmV3IE1hcCxlZj0iYWJvcnQgYXV4Q2xpY2sgY2FuY2VsIGNhblBsYXkgY2FuUGxheVRocm91Z2ggY2xpY2sgY2xvc2UgY29udGV4dE1lbnUgY29weSBjdXQgZHJhZyBkcmFnRW5kIGRyYWdFbnRlciBkcmFnRXhpdCBkcmFnTGVhdmUgZHJhZ092ZXIgZHJhZ1N0YXJ0IGRyb3AgZHVyYXRpb25DaGFuZ2UgZW1wdGllZCBlbmNyeXB0ZWQgZW5kZWQgZXJyb3IgZ290UG9pbnRlckNhcHR1cmUgaW5wdXQgaW52YWxpZCBrZXlEb3duIGtleVByZXNzIGtleVVwIGxvYWQgbG9hZGVkRGF0YSBsb2FkZWRNZXRhZGF0YSBsb2FkU3RhcnQgbG9zdFBvaW50ZXJDYXB0dXJlIG1vdXNlRG93biBtb3VzZU1vdmUgbW91c2VPdXQgbW91c2VPdmVyIG1vdXNlVXAgcGFzdGUgcGF1c2UgcGxheSBwbGF5aW5nIHBvaW50ZXJDYW5jZWwgcG9pbnRlckRvd24gcG9pbnRlck1vdmUgcG9pbnRlck91dCBwb2ludGVyT3ZlciBwb2ludGVyVXAgcHJvZ3Jlc3MgcmF0ZUNoYW5nZSByZXNldCByZXNpemUgc2Vla2VkIHNlZWtpbmcgc3RhbGxlZCBzdWJtaXQgc3VzcGVuZCB0aW1lVXBkYXRlIHRvdWNoQ2FuY2VsIHRvdWNoRW5kIHRvdWNoU3RhcnQgdm9sdW1lQ2hhbmdlIHNjcm9sbCB0b2dnbGUgdG91Y2hNb3ZlIHdhaXRpbmcgd2hlZWwiLnNwbGl0KCIgIik7CmZ1bmN0aW9uIGZmKGEsYil7ZGYuc2V0KGEsYik7ZmEoYixbYV0pfWZvcih2YXIgZ2Y9MDtnZjxlZi5sZW5ndGg7Z2YrKyl7dmFyIGhmPWVmW2dmXSxqZj1oZi50b0xvd2VyQ2FzZSgpLGtmPWhmWzBdLnRvVXBwZXJDYXNlKCkraGYuc2xpY2UoMSk7ZmYoamYsIm9uIitrZil9ZmYoJGUsIm9uQW5pbWF0aW9uRW5kIik7ZmYoYWYsIm9uQW5pbWF0aW9uSXRlcmF0aW9uIik7ZmYoYmYsIm9uQW5pbWF0aW9uU3RhcnQiKTtmZigiZGJsY2xpY2siLCJvbkRvdWJsZUNsaWNrIik7ZmYoImZvY3VzaW4iLCJvbkZvY3VzIik7ZmYoImZvY3Vzb3V0Iiwib25CbHVyIik7ZmYoY2YsIm9uVHJhbnNpdGlvbkVuZCIpO2hhKCJvbk1vdXNlRW50ZXIiLFsibW91c2VvdXQiLCJtb3VzZW92ZXIiXSk7aGEoIm9uTW91c2VMZWF2ZSIsWyJtb3VzZW91dCIsIm1vdXNlb3ZlciJdKTtoYSgib25Qb2ludGVyRW50ZXIiLFsicG9pbnRlcm91dCIsInBvaW50ZXJvdmVyIl0pOwpoYSgib25Qb2ludGVyTGVhdmUiLFsicG9pbnRlcm91dCIsInBvaW50ZXJvdmVyIl0pO2ZhKCJvbkNoYW5nZSIsImNoYW5nZSBjbGljayBmb2N1c2luIGZvY3Vzb3V0IGlucHV0IGtleWRvd24ga2V5dXAgc2VsZWN0aW9uY2hhbmdlIi5zcGxpdCgiICIpKTtmYSgib25TZWxlY3QiLCJmb2N1c291dCBjb250ZXh0bWVudSBkcmFnZW5kIGZvY3VzaW4ga2V5ZG93biBrZXl1cCBtb3VzZWRvd24gbW91c2V1cCBzZWxlY3Rpb25jaGFuZ2UiLnNwbGl0KCIgIikpO2ZhKCJvbkJlZm9yZUlucHV0IixbImNvbXBvc2l0aW9uZW5kIiwia2V5cHJlc3MiLCJ0ZXh0SW5wdXQiLCJwYXN0ZSJdKTtmYSgib25Db21wb3NpdGlvbkVuZCIsImNvbXBvc2l0aW9uZW5kIGZvY3Vzb3V0IGtleWRvd24ga2V5cHJlc3Mga2V5dXAgbW91c2Vkb3duIi5zcGxpdCgiICIpKTtmYSgib25Db21wb3NpdGlvblN0YXJ0IiwiY29tcG9zaXRpb25zdGFydCBmb2N1c291dCBrZXlkb3duIGtleXByZXNzIGtleXVwIG1vdXNlZG93biIuc3BsaXQoIiAiKSk7CmZhKCJvbkNvbXBvc2l0aW9uVXBkYXRlIiwiY29tcG9zaXRpb251cGRhdGUgZm9jdXNvdXQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBtb3VzZWRvd24iLnNwbGl0KCIgIikpO3ZhciBsZj0iYWJvcnQgY2FucGxheSBjYW5wbGF5dGhyb3VnaCBkdXJhdGlvbmNoYW5nZSBlbXB0aWVkIGVuY3J5cHRlZCBlbmRlZCBlcnJvciBsb2FkZWRkYXRhIGxvYWRlZG1ldGFkYXRhIGxvYWRzdGFydCBwYXVzZSBwbGF5IHBsYXlpbmcgcHJvZ3Jlc3MgcmF0ZWNoYW5nZSByZXNpemUgc2Vla2VkIHNlZWtpbmcgc3RhbGxlZCBzdXNwZW5kIHRpbWV1cGRhdGUgdm9sdW1lY2hhbmdlIHdhaXRpbmciLnNwbGl0KCIgIiksbWY9bmV3IFNldCgiY2FuY2VsIGNsb3NlIGludmFsaWQgbG9hZCBzY3JvbGwgdG9nZ2xlIi5zcGxpdCgiICIpLmNvbmNhdChsZikpOwpmdW5jdGlvbiBuZihhLGIsYyl7dmFyIGQ9YS50eXBlfHwidW5rbm93bi1ldmVudCI7YS5jdXJyZW50VGFyZ2V0PWM7VWIoZCxiLHZvaWQgMCxhKTthLmN1cnJlbnRUYXJnZXQ9bnVsbH0KZnVuY3Rpb24gc2UoYSxiKXtiPTAhPT0oYiY0KTtmb3IodmFyIGM9MDtjPGEubGVuZ3RoO2MrKyl7dmFyIGQ9YVtjXSxlPWQuZXZlbnQ7ZD1kLmxpc3RlbmVyczthOnt2YXIgZj12b2lkIDA7aWYoYilmb3IodmFyIGc9ZC5sZW5ndGgtMTswPD1nO2ctLSl7dmFyIGg9ZFtnXSxrPWguaW5zdGFuY2UsbD1oLmN1cnJlbnRUYXJnZXQ7aD1oLmxpc3RlbmVyO2lmKGshPT1mJiZlLmlzUHJvcGFnYXRpb25TdG9wcGVkKCkpYnJlYWsgYTtuZihlLGgsbCk7Zj1rfWVsc2UgZm9yKGc9MDtnPGQubGVuZ3RoO2crKyl7aD1kW2ddO2s9aC5pbnN0YW5jZTtsPWguY3VycmVudFRhcmdldDtoPWgubGlzdGVuZXI7aWYoayE9PWYmJmUuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSlicmVhayBhO25mKGUsaCxsKTtmPWt9fX1pZihRYil0aHJvdyBhPVJiLFFiPSExLFJiPW51bGwsYTt9CmZ1bmN0aW9uIEQoYSxiKXt2YXIgYz1iW29mXTt2b2lkIDA9PT1jJiYoYz1iW29mXT1uZXcgU2V0KTt2YXIgZD1hKyJfX2J1YmJsZSI7Yy5oYXMoZCl8fChwZihiLGEsMiwhMSksYy5hZGQoZCkpfWZ1bmN0aW9uIHFmKGEsYixjKXt2YXIgZD0wO2ImJihkfD00KTtwZihjLGEsZCxiKX12YXIgcmY9Il9yZWFjdExpc3RlbmluZyIrTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMik7ZnVuY3Rpb24gc2YoYSl7aWYoIWFbcmZdKXthW3JmXT0hMDtkYS5mb3JFYWNoKGZ1bmN0aW9uKGIpeyJzZWxlY3Rpb25jaGFuZ2UiIT09YiYmKG1mLmhhcyhiKXx8cWYoYiwhMSxhKSxxZihiLCEwLGEpKX0pO3ZhciBiPTk9PT1hLm5vZGVUeXBlP2E6YS5vd25lckRvY3VtZW50O251bGw9PT1ifHxiW3JmXXx8KGJbcmZdPSEwLHFmKCJzZWxlY3Rpb25jaGFuZ2UiLCExLGIpKX19CmZ1bmN0aW9uIHBmKGEsYixjLGQpe3N3aXRjaChqZChiKSl7Y2FzZSAxOnZhciBlPWVkO2JyZWFrO2Nhc2UgNDplPWdkO2JyZWFrO2RlZmF1bHQ6ZT1mZH1jPWUuYmluZChudWxsLGIsYyxhKTtlPXZvaWQgMDshTGJ8fCJ0b3VjaHN0YXJ0IiE9PWImJiJ0b3VjaG1vdmUiIT09YiYmIndoZWVsIiE9PWJ8fChlPSEwKTtkP3ZvaWQgMCE9PWU/YS5hZGRFdmVudExpc3RlbmVyKGIsYyx7Y2FwdHVyZTohMCxwYXNzaXZlOmV9KTphLmFkZEV2ZW50TGlzdGVuZXIoYixjLCEwKTp2b2lkIDAhPT1lP2EuYWRkRXZlbnRMaXN0ZW5lcihiLGMse3Bhc3NpdmU6ZX0pOmEuYWRkRXZlbnRMaXN0ZW5lcihiLGMsITEpfQpmdW5jdGlvbiBoZChhLGIsYyxkLGUpe3ZhciBmPWQ7aWYoMD09PShiJjEpJiYwPT09KGImMikmJm51bGwhPT1kKWE6Zm9yKDs7KXtpZihudWxsPT09ZClyZXR1cm47dmFyIGc9ZC50YWc7aWYoMz09PWd8fDQ9PT1nKXt2YXIgaD1kLnN0YXRlTm9kZS5jb250YWluZXJJbmZvO2lmKGg9PT1lfHw4PT09aC5ub2RlVHlwZSYmaC5wYXJlbnROb2RlPT09ZSlicmVhaztpZig0PT09Zylmb3IoZz1kLnJldHVybjtudWxsIT09Zzspe3ZhciBrPWcudGFnO2lmKDM9PT1rfHw0PT09aylpZihrPWcuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8saz09PWV8fDg9PT1rLm5vZGVUeXBlJiZrLnBhcmVudE5vZGU9PT1lKXJldHVybjtnPWcucmV0dXJufWZvcig7bnVsbCE9PWg7KXtnPVdjKGgpO2lmKG51bGw9PT1nKXJldHVybjtrPWcudGFnO2lmKDU9PT1rfHw2PT09ayl7ZD1mPWc7Y29udGludWUgYX1oPWgucGFyZW50Tm9kZX19ZD1kLnJldHVybn1KYihmdW5jdGlvbigpe3ZhciBkPWYsZT14YihjKSxnPVtdOwphOnt2YXIgaD1kZi5nZXQoYSk7aWYodm9pZCAwIT09aCl7dmFyIGs9dGQsbj1hO3N3aXRjaChhKXtjYXNlICJrZXlwcmVzcyI6aWYoMD09PW9kKGMpKWJyZWFrIGE7Y2FzZSAia2V5ZG93biI6Y2FzZSAia2V5dXAiOms9UmQ7YnJlYWs7Y2FzZSAiZm9jdXNpbiI6bj0iZm9jdXMiO2s9RmQ7YnJlYWs7Y2FzZSAiZm9jdXNvdXQiOm49ImJsdXIiO2s9RmQ7YnJlYWs7Y2FzZSAiYmVmb3JlYmx1ciI6Y2FzZSAiYWZ0ZXJibHVyIjprPUZkO2JyZWFrO2Nhc2UgImNsaWNrIjppZigyPT09Yy5idXR0b24pYnJlYWsgYTtjYXNlICJhdXhjbGljayI6Y2FzZSAiZGJsY2xpY2siOmNhc2UgIm1vdXNlZG93biI6Y2FzZSAibW91c2Vtb3ZlIjpjYXNlICJtb3VzZXVwIjpjYXNlICJtb3VzZW91dCI6Y2FzZSAibW91c2VvdmVyIjpjYXNlICJjb250ZXh0bWVudSI6az1CZDticmVhaztjYXNlICJkcmFnIjpjYXNlICJkcmFnZW5kIjpjYXNlICJkcmFnZW50ZXIiOmNhc2UgImRyYWdleGl0IjpjYXNlICJkcmFnbGVhdmUiOmNhc2UgImRyYWdvdmVyIjpjYXNlICJkcmFnc3RhcnQiOmNhc2UgImRyb3AiOms9CkRkO2JyZWFrO2Nhc2UgInRvdWNoY2FuY2VsIjpjYXNlICJ0b3VjaGVuZCI6Y2FzZSAidG91Y2htb3ZlIjpjYXNlICJ0b3VjaHN0YXJ0IjprPVZkO2JyZWFrO2Nhc2UgJGU6Y2FzZSBhZjpjYXNlIGJmOms9SGQ7YnJlYWs7Y2FzZSBjZjprPVhkO2JyZWFrO2Nhc2UgInNjcm9sbCI6az12ZDticmVhaztjYXNlICJ3aGVlbCI6az1aZDticmVhaztjYXNlICJjb3B5IjpjYXNlICJjdXQiOmNhc2UgInBhc3RlIjprPUpkO2JyZWFrO2Nhc2UgImdvdHBvaW50ZXJjYXB0dXJlIjpjYXNlICJsb3N0cG9pbnRlcmNhcHR1cmUiOmNhc2UgInBvaW50ZXJjYW5jZWwiOmNhc2UgInBvaW50ZXJkb3duIjpjYXNlICJwb2ludGVybW92ZSI6Y2FzZSAicG9pbnRlcm91dCI6Y2FzZSAicG9pbnRlcm92ZXIiOmNhc2UgInBvaW50ZXJ1cCI6az1UZH12YXIgdD0wIT09KGImNCksSj0hdCYmInNjcm9sbCI9PT1hLHg9dD9udWxsIT09aD9oKyJDYXB0dXJlIjpudWxsOmg7dD1bXTtmb3IodmFyIHc9ZCx1O251bGwhPT0Kdzspe3U9dzt2YXIgRj11LnN0YXRlTm9kZTs1PT09dS50YWcmJm51bGwhPT1GJiYodT1GLG51bGwhPT14JiYoRj1LYih3LHgpLG51bGwhPUYmJnQucHVzaCh0Zih3LEYsdSkpKSk7aWYoSilicmVhazt3PXcucmV0dXJufTA8dC5sZW5ndGgmJihoPW5ldyBrKGgsbixudWxsLGMsZSksZy5wdXNoKHtldmVudDpoLGxpc3RlbmVyczp0fSkpfX1pZigwPT09KGImNykpe2E6e2g9Im1vdXNlb3ZlciI9PT1hfHwicG9pbnRlcm92ZXIiPT09YTtrPSJtb3VzZW91dCI9PT1hfHwicG9pbnRlcm91dCI9PT1hO2lmKGgmJmMhPT13YiYmKG49Yy5yZWxhdGVkVGFyZ2V0fHxjLmZyb21FbGVtZW50KSYmKFdjKG4pfHxuW3VmXSkpYnJlYWsgYTtpZihrfHxoKXtoPWUud2luZG93PT09ZT9lOihoPWUub3duZXJEb2N1bWVudCk/aC5kZWZhdWx0Vmlld3x8aC5wYXJlbnRXaW5kb3c6d2luZG93O2lmKGspe2lmKG49Yy5yZWxhdGVkVGFyZ2V0fHxjLnRvRWxlbWVudCxrPWQsbj1uP1djKG4pOm51bGwsbnVsbCE9PQpuJiYoSj1WYihuKSxuIT09Snx8NSE9PW4udGFnJiY2IT09bi50YWcpKW49bnVsbH1lbHNlIGs9bnVsbCxuPWQ7aWYoayE9PW4pe3Q9QmQ7Rj0ib25Nb3VzZUxlYXZlIjt4PSJvbk1vdXNlRW50ZXIiO3c9Im1vdXNlIjtpZigicG9pbnRlcm91dCI9PT1hfHwicG9pbnRlcm92ZXIiPT09YSl0PVRkLEY9Im9uUG9pbnRlckxlYXZlIix4PSJvblBvaW50ZXJFbnRlciIsdz0icG9pbnRlciI7Sj1udWxsPT1rP2g6dWUoayk7dT1udWxsPT1uP2g6dWUobik7aD1uZXcgdChGLHcrImxlYXZlIixrLGMsZSk7aC50YXJnZXQ9SjtoLnJlbGF0ZWRUYXJnZXQ9dTtGPW51bGw7V2MoZSk9PT1kJiYodD1uZXcgdCh4LHcrImVudGVyIixuLGMsZSksdC50YXJnZXQ9dSx0LnJlbGF0ZWRUYXJnZXQ9SixGPXQpO0o9RjtpZihrJiZuKWI6e3Q9azt4PW47dz0wO2Zvcih1PXQ7dTt1PXZmKHUpKXcrKzt1PTA7Zm9yKEY9eDtGO0Y9dmYoRikpdSsrO2Zvcig7MDx3LXU7KXQ9dmYodCksdy0tO2Zvcig7MDx1LXc7KXg9CnZmKHgpLHUtLTtmb3IoO3ctLTspe2lmKHQ9PT14fHxudWxsIT09eCYmdD09PXguYWx0ZXJuYXRlKWJyZWFrIGI7dD12Zih0KTt4PXZmKHgpfXQ9bnVsbH1lbHNlIHQ9bnVsbDtudWxsIT09ayYmd2YoZyxoLGssdCwhMSk7bnVsbCE9PW4mJm51bGwhPT1KJiZ3ZihnLEosbix0LCEwKX19fWE6e2g9ZD91ZShkKTp3aW5kb3c7az1oLm5vZGVOYW1lJiZoLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7aWYoInNlbGVjdCI9PT1rfHwiaW5wdXQiPT09ayYmImZpbGUiPT09aC50eXBlKXZhciBuYT12ZTtlbHNlIGlmKG1lKGgpKWlmKHdlKW5hPUZlO2Vsc2V7bmE9RGU7dmFyIHhhPUNlfWVsc2Uoaz1oLm5vZGVOYW1lKSYmImlucHV0Ij09PWsudG9Mb3dlckNhc2UoKSYmKCJjaGVja2JveCI9PT1oLnR5cGV8fCJyYWRpbyI9PT1oLnR5cGUpJiYobmE9RWUpO2lmKG5hJiYobmE9bmEoYSxkKSkpe25lKGcsbmEsYyxlKTticmVhayBhfXhhJiZ4YShhLGgsZCk7ImZvY3Vzb3V0Ij09PWEmJih4YT1oLl93cmFwcGVyU3RhdGUpJiYKeGEuY29udHJvbGxlZCYmIm51bWJlciI9PT1oLnR5cGUmJmNiKGgsIm51bWJlciIsaC52YWx1ZSl9eGE9ZD91ZShkKTp3aW5kb3c7c3dpdGNoKGEpe2Nhc2UgImZvY3VzaW4iOmlmKG1lKHhhKXx8InRydWUiPT09eGEuY29udGVudEVkaXRhYmxlKVFlPXhhLFJlPWQsU2U9bnVsbDticmVhaztjYXNlICJmb2N1c291dCI6U2U9UmU9UWU9bnVsbDticmVhaztjYXNlICJtb3VzZWRvd24iOlRlPSEwO2JyZWFrO2Nhc2UgImNvbnRleHRtZW51IjpjYXNlICJtb3VzZXVwIjpjYXNlICJkcmFnZW5kIjpUZT0hMTtVZShnLGMsZSk7YnJlYWs7Y2FzZSAic2VsZWN0aW9uY2hhbmdlIjppZihQZSlicmVhaztjYXNlICJrZXlkb3duIjpjYXNlICJrZXl1cCI6VWUoZyxjLGUpfXZhciAkYTtpZihhZSliOntzd2l0Y2goYSl7Y2FzZSAiY29tcG9zaXRpb25zdGFydCI6dmFyIGJhPSJvbkNvbXBvc2l0aW9uU3RhcnQiO2JyZWFrIGI7Y2FzZSAiY29tcG9zaXRpb25lbmQiOmJhPSJvbkNvbXBvc2l0aW9uRW5kIjsKYnJlYWsgYjtjYXNlICJjb21wb3NpdGlvbnVwZGF0ZSI6YmE9Im9uQ29tcG9zaXRpb25VcGRhdGUiO2JyZWFrIGJ9YmE9dm9pZCAwfWVsc2UgaWU/Z2UoYSxjKSYmKGJhPSJvbkNvbXBvc2l0aW9uRW5kIik6ImtleWRvd24iPT09YSYmMjI5PT09Yy5rZXlDb2RlJiYoYmE9Im9uQ29tcG9zaXRpb25TdGFydCIpO2JhJiYoZGUmJiJrbyIhPT1jLmxvY2FsZSYmKGllfHwib25Db21wb3NpdGlvblN0YXJ0IiE9PWJhPyJvbkNvbXBvc2l0aW9uRW5kIj09PWJhJiZpZSYmKCRhPW5kKCkpOihrZD1lLGxkPSJ2YWx1ZSJpbiBrZD9rZC52YWx1ZTprZC50ZXh0Q29udGVudCxpZT0hMCkpLHhhPW9lKGQsYmEpLDA8eGEubGVuZ3RoJiYoYmE9bmV3IExkKGJhLGEsbnVsbCxjLGUpLGcucHVzaCh7ZXZlbnQ6YmEsbGlzdGVuZXJzOnhhfSksJGE/YmEuZGF0YT0kYTooJGE9aGUoYyksbnVsbCE9PSRhJiYoYmEuZGF0YT0kYSkpKSk7aWYoJGE9Y2U/amUoYSxjKTprZShhLGMpKWQ9b2UoZCwib25CZWZvcmVJbnB1dCIpLAowPGQubGVuZ3RoJiYoZT1uZXcgTGQoIm9uQmVmb3JlSW5wdXQiLCJiZWZvcmVpbnB1dCIsbnVsbCxjLGUpLGcucHVzaCh7ZXZlbnQ6ZSxsaXN0ZW5lcnM6ZH0pLGUuZGF0YT0kYSl9c2UoZyxiKX0pfWZ1bmN0aW9uIHRmKGEsYixjKXtyZXR1cm57aW5zdGFuY2U6YSxsaXN0ZW5lcjpiLGN1cnJlbnRUYXJnZXQ6Y319ZnVuY3Rpb24gb2UoYSxiKXtmb3IodmFyIGM9YisiQ2FwdHVyZSIsZD1bXTtudWxsIT09YTspe3ZhciBlPWEsZj1lLnN0YXRlTm9kZTs1PT09ZS50YWcmJm51bGwhPT1mJiYoZT1mLGY9S2IoYSxjKSxudWxsIT1mJiZkLnVuc2hpZnQodGYoYSxmLGUpKSxmPUtiKGEsYiksbnVsbCE9ZiYmZC5wdXNoKHRmKGEsZixlKSkpO2E9YS5yZXR1cm59cmV0dXJuIGR9ZnVuY3Rpb24gdmYoYSl7aWYobnVsbD09PWEpcmV0dXJuIG51bGw7ZG8gYT1hLnJldHVybjt3aGlsZShhJiY1IT09YS50YWcpO3JldHVybiBhP2E6bnVsbH0KZnVuY3Rpb24gd2YoYSxiLGMsZCxlKXtmb3IodmFyIGY9Yi5fcmVhY3ROYW1lLGc9W107bnVsbCE9PWMmJmMhPT1kOyl7dmFyIGg9YyxrPWguYWx0ZXJuYXRlLGw9aC5zdGF0ZU5vZGU7aWYobnVsbCE9PWsmJms9PT1kKWJyZWFrOzU9PT1oLnRhZyYmbnVsbCE9PWwmJihoPWwsZT8oaz1LYihjLGYpLG51bGwhPWsmJmcudW5zaGlmdCh0ZihjLGssaCkpKTplfHwoaz1LYihjLGYpLG51bGwhPWsmJmcucHVzaCh0ZihjLGssaCkpKSk7Yz1jLnJldHVybn0wIT09Zy5sZW5ndGgmJmEucHVzaCh7ZXZlbnQ6YixsaXN0ZW5lcnM6Z30pfXZhciB4Zj0vXHJcbj8vZyx5Zj0vXHUwMDAwfFx1RkZGRC9nO2Z1bmN0aW9uIHpmKGEpe3JldHVybigic3RyaW5nIj09PXR5cGVvZiBhP2E6IiIrYSkucmVwbGFjZSh4ZiwiXG4iKS5yZXBsYWNlKHlmLCIiKX1mdW5jdGlvbiBBZihhLGIsYyl7Yj16ZihiKTtpZih6ZihhKSE9PWImJmMpdGhyb3cgRXJyb3IocCg0MjUpKTt9ZnVuY3Rpb24gQmYoKXt9CnZhciBDZj1udWxsLERmPW51bGw7ZnVuY3Rpb24gRWYoYSxiKXtyZXR1cm4idGV4dGFyZWEiPT09YXx8Im5vc2NyaXB0Ij09PWF8fCJzdHJpbmciPT09dHlwZW9mIGIuY2hpbGRyZW58fCJudW1iZXIiPT09dHlwZW9mIGIuY2hpbGRyZW58fCJvYmplY3QiPT09dHlwZW9mIGIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwmJm51bGwhPT1iLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MJiZudWxsIT1iLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MLl9faHRtbH0KdmFyIEZmPSJmdW5jdGlvbiI9PT10eXBlb2Ygc2V0VGltZW91dD9zZXRUaW1lb3V0OnZvaWQgMCxHZj0iZnVuY3Rpb24iPT09dHlwZW9mIGNsZWFyVGltZW91dD9jbGVhclRpbWVvdXQ6dm9pZCAwLEhmPSJmdW5jdGlvbiI9PT10eXBlb2YgUHJvbWlzZT9Qcm9taXNlOnZvaWQgMCxKZj0iZnVuY3Rpb24iPT09dHlwZW9mIHF1ZXVlTWljcm90YXNrP3F1ZXVlTWljcm90YXNrOiJ1bmRlZmluZWQiIT09dHlwZW9mIEhmP2Z1bmN0aW9uKGEpe3JldHVybiBIZi5yZXNvbHZlKG51bGwpLnRoZW4oYSkuY2F0Y2goSWYpfTpGZjtmdW5jdGlvbiBJZihhKXtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7dGhyb3cgYTt9KX0KZnVuY3Rpb24gS2YoYSxiKXt2YXIgYz1iLGQ9MDtkb3t2YXIgZT1jLm5leHRTaWJsaW5nO2EucmVtb3ZlQ2hpbGQoYyk7aWYoZSYmOD09PWUubm9kZVR5cGUpaWYoYz1lLmRhdGEsIi8kIj09PWMpe2lmKDA9PT1kKXthLnJlbW92ZUNoaWxkKGUpO2JkKGIpO3JldHVybn1kLS19ZWxzZSIkIiE9PWMmJiIkPyIhPT1jJiYiJCEiIT09Y3x8ZCsrO2M9ZX13aGlsZShjKTtiZChiKX1mdW5jdGlvbiBMZihhKXtmb3IoO251bGwhPWE7YT1hLm5leHRTaWJsaW5nKXt2YXIgYj1hLm5vZGVUeXBlO2lmKDE9PT1ifHwzPT09YilicmVhaztpZig4PT09Yil7Yj1hLmRhdGE7aWYoIiQiPT09Ynx8IiQhIj09PWJ8fCIkPyI9PT1iKWJyZWFrO2lmKCIvJCI9PT1iKXJldHVybiBudWxsfX1yZXR1cm4gYX0KZnVuY3Rpb24gTWYoYSl7YT1hLnByZXZpb3VzU2libGluZztmb3IodmFyIGI9MDthOyl7aWYoOD09PWEubm9kZVR5cGUpe3ZhciBjPWEuZGF0YTtpZigiJCI9PT1jfHwiJCEiPT09Y3x8IiQ/Ij09PWMpe2lmKDA9PT1iKXJldHVybiBhO2ItLX1lbHNlIi8kIj09PWMmJmIrK31hPWEucHJldmlvdXNTaWJsaW5nfXJldHVybiBudWxsfXZhciBOZj1NYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zbGljZSgyKSxPZj0iX19yZWFjdEZpYmVyJCIrTmYsUGY9Il9fcmVhY3RQcm9wcyQiK05mLHVmPSJfX3JlYWN0Q29udGFpbmVyJCIrTmYsb2Y9Il9fcmVhY3RFdmVudHMkIitOZixRZj0iX19yZWFjdExpc3RlbmVycyQiK05mLFJmPSJfX3JlYWN0SGFuZGxlcyQiK05mOwpmdW5jdGlvbiBXYyhhKXt2YXIgYj1hW09mXTtpZihiKXJldHVybiBiO2Zvcih2YXIgYz1hLnBhcmVudE5vZGU7Yzspe2lmKGI9Y1t1Zl18fGNbT2ZdKXtjPWIuYWx0ZXJuYXRlO2lmKG51bGwhPT1iLmNoaWxkfHxudWxsIT09YyYmbnVsbCE9PWMuY2hpbGQpZm9yKGE9TWYoYSk7bnVsbCE9PWE7KXtpZihjPWFbT2ZdKXJldHVybiBjO2E9TWYoYSl9cmV0dXJuIGJ9YT1jO2M9YS5wYXJlbnROb2RlfXJldHVybiBudWxsfWZ1bmN0aW9uIENiKGEpe2E9YVtPZl18fGFbdWZdO3JldHVybiFhfHw1IT09YS50YWcmJjYhPT1hLnRhZyYmMTMhPT1hLnRhZyYmMyE9PWEudGFnP251bGw6YX1mdW5jdGlvbiB1ZShhKXtpZig1PT09YS50YWd8fDY9PT1hLnRhZylyZXR1cm4gYS5zdGF0ZU5vZGU7dGhyb3cgRXJyb3IocCgzMykpO31mdW5jdGlvbiBEYihhKXtyZXR1cm4gYVtQZl18fG51bGx9dmFyIFNmPVtdLFRmPS0xO2Z1bmN0aW9uIFVmKGEpe3JldHVybntjdXJyZW50OmF9fQpmdW5jdGlvbiBFKGEpezA+VGZ8fChhLmN1cnJlbnQ9U2ZbVGZdLFNmW1RmXT1udWxsLFRmLS0pfWZ1bmN0aW9uIEcoYSxiKXtUZisrO1NmW1RmXT1hLmN1cnJlbnQ7YS5jdXJyZW50PWJ9dmFyIFZmPXt9LEg9VWYoVmYpLFdmPVVmKCExKSxYZj1WZjtmdW5jdGlvbiBZZihhLGIpe3ZhciBjPWEudHlwZS5jb250ZXh0VHlwZXM7aWYoIWMpcmV0dXJuIFZmO3ZhciBkPWEuc3RhdGVOb2RlO2lmKGQmJmQuX19yZWFjdEludGVybmFsTWVtb2l6ZWRVbm1hc2tlZENoaWxkQ29udGV4dD09PWIpcmV0dXJuIGQuX19yZWFjdEludGVybmFsTWVtb2l6ZWRNYXNrZWRDaGlsZENvbnRleHQ7dmFyIGU9e30sZjtmb3IoZiBpbiBjKWVbZl09YltmXTtkJiYoYT1hLnN0YXRlTm9kZSxhLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkVW5tYXNrZWRDaGlsZENvbnRleHQ9YixhLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkTWFza2VkQ2hpbGRDb250ZXh0PWUpO3JldHVybiBlfQpmdW5jdGlvbiBaZihhKXthPWEuY2hpbGRDb250ZXh0VHlwZXM7cmV0dXJuIG51bGwhPT1hJiZ2b2lkIDAhPT1hfWZ1bmN0aW9uICRmKCl7RShXZik7RShIKX1mdW5jdGlvbiBhZyhhLGIsYyl7aWYoSC5jdXJyZW50IT09VmYpdGhyb3cgRXJyb3IocCgxNjgpKTtHKEgsYik7RyhXZixjKX1mdW5jdGlvbiBiZyhhLGIsYyl7dmFyIGQ9YS5zdGF0ZU5vZGU7Yj1iLmNoaWxkQ29udGV4dFR5cGVzO2lmKCJmdW5jdGlvbiIhPT10eXBlb2YgZC5nZXRDaGlsZENvbnRleHQpcmV0dXJuIGM7ZD1kLmdldENoaWxkQ29udGV4dCgpO2Zvcih2YXIgZSBpbiBkKWlmKCEoZSBpbiBiKSl0aHJvdyBFcnJvcihwKDEwOCxSYShhKXx8IlVua25vd24iLGUpKTtyZXR1cm4gQSh7fSxjLGQpfQpmdW5jdGlvbiBjZyhhKXthPShhPWEuc3RhdGVOb2RlKSYmYS5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZE1lcmdlZENoaWxkQ29udGV4dHx8VmY7WGY9SC5jdXJyZW50O0coSCxhKTtHKFdmLFdmLmN1cnJlbnQpO3JldHVybiEwfWZ1bmN0aW9uIGRnKGEsYixjKXt2YXIgZD1hLnN0YXRlTm9kZTtpZighZCl0aHJvdyBFcnJvcihwKDE2OSkpO2M/KGE9YmcoYSxiLFhmKSxkLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkTWVyZ2VkQ2hpbGRDb250ZXh0PWEsRShXZiksRShIKSxHKEgsYSkpOkUoV2YpO0coV2YsYyl9dmFyIGVnPW51bGwsZmc9ITEsZ2c9ITE7ZnVuY3Rpb24gaGcoYSl7bnVsbD09PWVnP2VnPVthXTplZy5wdXNoKGEpfWZ1bmN0aW9uIGlnKGEpe2ZnPSEwO2hnKGEpfQpmdW5jdGlvbiBqZygpe2lmKCFnZyYmbnVsbCE9PWVnKXtnZz0hMDt2YXIgYT0wLGI9Qzt0cnl7dmFyIGM9ZWc7Zm9yKEM9MTthPGMubGVuZ3RoO2ErKyl7dmFyIGQ9Y1thXTtkbyBkPWQoITApO3doaWxlKG51bGwhPT1kKX1lZz1udWxsO2ZnPSExfWNhdGNoKGUpe3Rocm93IG51bGwhPT1lZyYmKGVnPWVnLnNsaWNlKGErMSkpLGFjKGZjLGpnKSxlO31maW5hbGx5e0M9YixnZz0hMX19cmV0dXJuIG51bGx9dmFyIGtnPVtdLGxnPTAsbWc9bnVsbCxuZz0wLG9nPVtdLHBnPTAscWc9bnVsbCxyZz0xLHNnPSIiO2Z1bmN0aW9uIHRnKGEsYil7a2dbbGcrK109bmc7a2dbbGcrK109bWc7bWc9YTtuZz1ifQpmdW5jdGlvbiB1ZyhhLGIsYyl7b2dbcGcrK109cmc7b2dbcGcrK109c2c7b2dbcGcrK109cWc7cWc9YTt2YXIgZD1yZzthPXNnO3ZhciBlPTMyLW9jKGQpLTE7ZCY9figxPDxlKTtjKz0xO3ZhciBmPTMyLW9jKGIpK2U7aWYoMzA8Zil7dmFyIGc9ZS1lJTU7Zj0oZCYoMTw8ZyktMSkudG9TdHJpbmcoMzIpO2Q+Pj1nO2UtPWc7cmc9MTw8MzItb2MoYikrZXxjPDxlfGQ7c2c9ZithfWVsc2Ugcmc9MTw8ZnxjPDxlfGQsc2c9YX1mdW5jdGlvbiB2ZyhhKXtudWxsIT09YS5yZXR1cm4mJih0ZyhhLDEpLHVnKGEsMSwwKSl9ZnVuY3Rpb24gd2coYSl7Zm9yKDthPT09bWc7KW1nPWtnWy0tbGddLGtnW2xnXT1udWxsLG5nPWtnWy0tbGddLGtnW2xnXT1udWxsO2Zvcig7YT09PXFnOylxZz1vZ1stLXBnXSxvZ1twZ109bnVsbCxzZz1vZ1stLXBnXSxvZ1twZ109bnVsbCxyZz1vZ1stLXBnXSxvZ1twZ109bnVsbH12YXIgeGc9bnVsbCx5Zz1udWxsLEk9ITEsemc9bnVsbDsKZnVuY3Rpb24gQWcoYSxiKXt2YXIgYz1CZyg1LG51bGwsbnVsbCwwKTtjLmVsZW1lbnRUeXBlPSJERUxFVEVEIjtjLnN0YXRlTm9kZT1iO2MucmV0dXJuPWE7Yj1hLmRlbGV0aW9ucztudWxsPT09Yj8oYS5kZWxldGlvbnM9W2NdLGEuZmxhZ3N8PTE2KTpiLnB1c2goYyl9CmZ1bmN0aW9uIENnKGEsYil7c3dpdGNoKGEudGFnKXtjYXNlIDU6dmFyIGM9YS50eXBlO2I9MSE9PWIubm9kZVR5cGV8fGMudG9Mb3dlckNhc2UoKSE9PWIubm9kZU5hbWUudG9Mb3dlckNhc2UoKT9udWxsOmI7cmV0dXJuIG51bGwhPT1iPyhhLnN0YXRlTm9kZT1iLHhnPWEseWc9TGYoYi5maXJzdENoaWxkKSwhMCk6ITE7Y2FzZSA2OnJldHVybiBiPSIiPT09YS5wZW5kaW5nUHJvcHN8fDMhPT1iLm5vZGVUeXBlP251bGw6YixudWxsIT09Yj8oYS5zdGF0ZU5vZGU9Yix4Zz1hLHlnPW51bGwsITApOiExO2Nhc2UgMTM6cmV0dXJuIGI9OCE9PWIubm9kZVR5cGU/bnVsbDpiLG51bGwhPT1iPyhjPW51bGwhPT1xZz97aWQ6cmcsb3ZlcmZsb3c6c2d9Om51bGwsYS5tZW1vaXplZFN0YXRlPXtkZWh5ZHJhdGVkOmIsdHJlZUNvbnRleHQ6YyxyZXRyeUxhbmU6MTA3Mzc0MTgyNH0sYz1CZygxOCxudWxsLG51bGwsMCksYy5zdGF0ZU5vZGU9YixjLnJldHVybj1hLGEuY2hpbGQ9Yyx4Zz1hLHlnPQpudWxsLCEwKTohMTtkZWZhdWx0OnJldHVybiExfX1mdW5jdGlvbiBEZyhhKXtyZXR1cm4gMCE9PShhLm1vZGUmMSkmJjA9PT0oYS5mbGFncyYxMjgpfWZ1bmN0aW9uIEVnKGEpe2lmKEkpe3ZhciBiPXlnO2lmKGIpe3ZhciBjPWI7aWYoIUNnKGEsYikpe2lmKERnKGEpKXRocm93IEVycm9yKHAoNDE4KSk7Yj1MZihjLm5leHRTaWJsaW5nKTt2YXIgZD14ZztiJiZDZyhhLGIpP0FnKGQsYyk6KGEuZmxhZ3M9YS5mbGFncyYtNDA5N3wyLEk9ITEseGc9YSl9fWVsc2V7aWYoRGcoYSkpdGhyb3cgRXJyb3IocCg0MTgpKTthLmZsYWdzPWEuZmxhZ3MmLTQwOTd8MjtJPSExO3hnPWF9fX1mdW5jdGlvbiBGZyhhKXtmb3IoYT1hLnJldHVybjtudWxsIT09YSYmNSE9PWEudGFnJiYzIT09YS50YWcmJjEzIT09YS50YWc7KWE9YS5yZXR1cm47eGc9YX0KZnVuY3Rpb24gR2coYSl7aWYoYSE9PXhnKXJldHVybiExO2lmKCFJKXJldHVybiBGZyhhKSxJPSEwLCExO3ZhciBiOyhiPTMhPT1hLnRhZykmJiEoYj01IT09YS50YWcpJiYoYj1hLnR5cGUsYj0iaGVhZCIhPT1iJiYiYm9keSIhPT1iJiYhRWYoYS50eXBlLGEubWVtb2l6ZWRQcm9wcykpO2lmKGImJihiPXlnKSl7aWYoRGcoYSkpdGhyb3cgSGcoKSxFcnJvcihwKDQxOCkpO2Zvcig7YjspQWcoYSxiKSxiPUxmKGIubmV4dFNpYmxpbmcpfUZnKGEpO2lmKDEzPT09YS50YWcpe2E9YS5tZW1vaXplZFN0YXRlO2E9bnVsbCE9PWE/YS5kZWh5ZHJhdGVkOm51bGw7aWYoIWEpdGhyb3cgRXJyb3IocCgzMTcpKTthOnthPWEubmV4dFNpYmxpbmc7Zm9yKGI9MDthOyl7aWYoOD09PWEubm9kZVR5cGUpe3ZhciBjPWEuZGF0YTtpZigiLyQiPT09Yyl7aWYoMD09PWIpe3lnPUxmKGEubmV4dFNpYmxpbmcpO2JyZWFrIGF9Yi0tfWVsc2UiJCIhPT1jJiYiJCEiIT09YyYmIiQ/IiE9PWN8fGIrK31hPWEubmV4dFNpYmxpbmd9eWc9Cm51bGx9fWVsc2UgeWc9eGc/TGYoYS5zdGF0ZU5vZGUubmV4dFNpYmxpbmcpOm51bGw7cmV0dXJuITB9ZnVuY3Rpb24gSGcoKXtmb3IodmFyIGE9eWc7YTspYT1MZihhLm5leHRTaWJsaW5nKX1mdW5jdGlvbiBJZygpe3lnPXhnPW51bGw7ST0hMX1mdW5jdGlvbiBKZyhhKXtudWxsPT09emc/emc9W2FdOnpnLnB1c2goYSl9dmFyIEtnPXVhLlJlYWN0Q3VycmVudEJhdGNoQ29uZmlnO2Z1bmN0aW9uIExnKGEsYil7aWYoYSYmYS5kZWZhdWx0UHJvcHMpe2I9QSh7fSxiKTthPWEuZGVmYXVsdFByb3BzO2Zvcih2YXIgYyBpbiBhKXZvaWQgMD09PWJbY10mJihiW2NdPWFbY10pO3JldHVybiBifXJldHVybiBifXZhciBNZz1VZihudWxsKSxOZz1udWxsLE9nPW51bGwsUGc9bnVsbDtmdW5jdGlvbiBRZygpe1BnPU9nPU5nPW51bGx9ZnVuY3Rpb24gUmcoYSl7dmFyIGI9TWcuY3VycmVudDtFKE1nKTthLl9jdXJyZW50VmFsdWU9Yn0KZnVuY3Rpb24gU2coYSxiLGMpe2Zvcig7bnVsbCE9PWE7KXt2YXIgZD1hLmFsdGVybmF0ZTsoYS5jaGlsZExhbmVzJmIpIT09Yj8oYS5jaGlsZExhbmVzfD1iLG51bGwhPT1kJiYoZC5jaGlsZExhbmVzfD1iKSk6bnVsbCE9PWQmJihkLmNoaWxkTGFuZXMmYikhPT1iJiYoZC5jaGlsZExhbmVzfD1iKTtpZihhPT09YylicmVhazthPWEucmV0dXJufX1mdW5jdGlvbiBUZyhhLGIpe05nPWE7UGc9T2c9bnVsbDthPWEuZGVwZW5kZW5jaWVzO251bGwhPT1hJiZudWxsIT09YS5maXJzdENvbnRleHQmJigwIT09KGEubGFuZXMmYikmJihVZz0hMCksYS5maXJzdENvbnRleHQ9bnVsbCl9CmZ1bmN0aW9uIFZnKGEpe3ZhciBiPWEuX2N1cnJlbnRWYWx1ZTtpZihQZyE9PWEpaWYoYT17Y29udGV4dDphLG1lbW9pemVkVmFsdWU6YixuZXh0Om51bGx9LG51bGw9PT1PZyl7aWYobnVsbD09PU5nKXRocm93IEVycm9yKHAoMzA4KSk7T2c9YTtOZy5kZXBlbmRlbmNpZXM9e2xhbmVzOjAsZmlyc3RDb250ZXh0OmF9fWVsc2UgT2c9T2cubmV4dD1hO3JldHVybiBifXZhciBXZz1udWxsO2Z1bmN0aW9uIFhnKGEpe251bGw9PT1XZz9XZz1bYV06V2cucHVzaChhKX1mdW5jdGlvbiBZZyhhLGIsYyxkKXt2YXIgZT1iLmludGVybGVhdmVkO251bGw9PT1lPyhjLm5leHQ9YyxYZyhiKSk6KGMubmV4dD1lLm5leHQsZS5uZXh0PWMpO2IuaW50ZXJsZWF2ZWQ9YztyZXR1cm4gWmcoYSxkKX0KZnVuY3Rpb24gWmcoYSxiKXthLmxhbmVzfD1iO3ZhciBjPWEuYWx0ZXJuYXRlO251bGwhPT1jJiYoYy5sYW5lc3w9Yik7Yz1hO2ZvcihhPWEucmV0dXJuO251bGwhPT1hOylhLmNoaWxkTGFuZXN8PWIsYz1hLmFsdGVybmF0ZSxudWxsIT09YyYmKGMuY2hpbGRMYW5lc3w9YiksYz1hLGE9YS5yZXR1cm47cmV0dXJuIDM9PT1jLnRhZz9jLnN0YXRlTm9kZTpudWxsfXZhciAkZz0hMTtmdW5jdGlvbiBhaChhKXthLnVwZGF0ZVF1ZXVlPXtiYXNlU3RhdGU6YS5tZW1vaXplZFN0YXRlLGZpcnN0QmFzZVVwZGF0ZTpudWxsLGxhc3RCYXNlVXBkYXRlOm51bGwsc2hhcmVkOntwZW5kaW5nOm51bGwsaW50ZXJsZWF2ZWQ6bnVsbCxsYW5lczowfSxlZmZlY3RzOm51bGx9fQpmdW5jdGlvbiBiaChhLGIpe2E9YS51cGRhdGVRdWV1ZTtiLnVwZGF0ZVF1ZXVlPT09YSYmKGIudXBkYXRlUXVldWU9e2Jhc2VTdGF0ZTphLmJhc2VTdGF0ZSxmaXJzdEJhc2VVcGRhdGU6YS5maXJzdEJhc2VVcGRhdGUsbGFzdEJhc2VVcGRhdGU6YS5sYXN0QmFzZVVwZGF0ZSxzaGFyZWQ6YS5zaGFyZWQsZWZmZWN0czphLmVmZmVjdHN9KX1mdW5jdGlvbiBjaChhLGIpe3JldHVybntldmVudFRpbWU6YSxsYW5lOmIsdGFnOjAscGF5bG9hZDpudWxsLGNhbGxiYWNrOm51bGwsbmV4dDpudWxsfX0KZnVuY3Rpb24gZGgoYSxiLGMpe3ZhciBkPWEudXBkYXRlUXVldWU7aWYobnVsbD09PWQpcmV0dXJuIG51bGw7ZD1kLnNoYXJlZDtpZigwIT09KEsmMikpe3ZhciBlPWQucGVuZGluZztudWxsPT09ZT9iLm5leHQ9YjooYi5uZXh0PWUubmV4dCxlLm5leHQ9Yik7ZC5wZW5kaW5nPWI7cmV0dXJuIFpnKGEsYyl9ZT1kLmludGVybGVhdmVkO251bGw9PT1lPyhiLm5leHQ9YixYZyhkKSk6KGIubmV4dD1lLm5leHQsZS5uZXh0PWIpO2QuaW50ZXJsZWF2ZWQ9YjtyZXR1cm4gWmcoYSxjKX1mdW5jdGlvbiBlaChhLGIsYyl7Yj1iLnVwZGF0ZVF1ZXVlO2lmKG51bGwhPT1iJiYoYj1iLnNoYXJlZCwwIT09KGMmNDE5NDI0MCkpKXt2YXIgZD1iLmxhbmVzO2QmPWEucGVuZGluZ0xhbmVzO2N8PWQ7Yi5sYW5lcz1jO0NjKGEsYyl9fQpmdW5jdGlvbiBmaChhLGIpe3ZhciBjPWEudXBkYXRlUXVldWUsZD1hLmFsdGVybmF0ZTtpZihudWxsIT09ZCYmKGQ9ZC51cGRhdGVRdWV1ZSxjPT09ZCkpe3ZhciBlPW51bGwsZj1udWxsO2M9Yy5maXJzdEJhc2VVcGRhdGU7aWYobnVsbCE9PWMpe2Rve3ZhciBnPXtldmVudFRpbWU6Yy5ldmVudFRpbWUsbGFuZTpjLmxhbmUsdGFnOmMudGFnLHBheWxvYWQ6Yy5wYXlsb2FkLGNhbGxiYWNrOmMuY2FsbGJhY2ssbmV4dDpudWxsfTtudWxsPT09Zj9lPWY9ZzpmPWYubmV4dD1nO2M9Yy5uZXh0fXdoaWxlKG51bGwhPT1jKTtudWxsPT09Zj9lPWY9YjpmPWYubmV4dD1ifWVsc2UgZT1mPWI7Yz17YmFzZVN0YXRlOmQuYmFzZVN0YXRlLGZpcnN0QmFzZVVwZGF0ZTplLGxhc3RCYXNlVXBkYXRlOmYsc2hhcmVkOmQuc2hhcmVkLGVmZmVjdHM6ZC5lZmZlY3RzfTthLnVwZGF0ZVF1ZXVlPWM7cmV0dXJufWE9Yy5sYXN0QmFzZVVwZGF0ZTtudWxsPT09YT9jLmZpcnN0QmFzZVVwZGF0ZT1iOmEubmV4dD0KYjtjLmxhc3RCYXNlVXBkYXRlPWJ9CmZ1bmN0aW9uIGdoKGEsYixjLGQpe3ZhciBlPWEudXBkYXRlUXVldWU7JGc9ITE7dmFyIGY9ZS5maXJzdEJhc2VVcGRhdGUsZz1lLmxhc3RCYXNlVXBkYXRlLGg9ZS5zaGFyZWQucGVuZGluZztpZihudWxsIT09aCl7ZS5zaGFyZWQucGVuZGluZz1udWxsO3ZhciBrPWgsbD1rLm5leHQ7ay5uZXh0PW51bGw7bnVsbD09PWc/Zj1sOmcubmV4dD1sO2c9azt2YXIgbT1hLmFsdGVybmF0ZTtudWxsIT09bSYmKG09bS51cGRhdGVRdWV1ZSxoPW0ubGFzdEJhc2VVcGRhdGUsaCE9PWcmJihudWxsPT09aD9tLmZpcnN0QmFzZVVwZGF0ZT1sOmgubmV4dD1sLG0ubGFzdEJhc2VVcGRhdGU9aykpfWlmKG51bGwhPT1mKXt2YXIgcT1lLmJhc2VTdGF0ZTtnPTA7bT1sPWs9bnVsbDtoPWY7ZG97dmFyIHI9aC5sYW5lLHk9aC5ldmVudFRpbWU7aWYoKGQmcik9PT1yKXtudWxsIT09bSYmKG09bS5uZXh0PXtldmVudFRpbWU6eSxsYW5lOjAsdGFnOmgudGFnLHBheWxvYWQ6aC5wYXlsb2FkLGNhbGxiYWNrOmguY2FsbGJhY2ssCm5leHQ6bnVsbH0pO2E6e3ZhciBuPWEsdD1oO3I9Yjt5PWM7c3dpdGNoKHQudGFnKXtjYXNlIDE6bj10LnBheWxvYWQ7aWYoImZ1bmN0aW9uIj09PXR5cGVvZiBuKXtxPW4uY2FsbCh5LHEscik7YnJlYWsgYX1xPW47YnJlYWsgYTtjYXNlIDM6bi5mbGFncz1uLmZsYWdzJi02NTUzN3wxMjg7Y2FzZSAwOm49dC5wYXlsb2FkO3I9ImZ1bmN0aW9uIj09PXR5cGVvZiBuP24uY2FsbCh5LHEscik6bjtpZihudWxsPT09cnx8dm9pZCAwPT09cilicmVhayBhO3E9QSh7fSxxLHIpO2JyZWFrIGE7Y2FzZSAyOiRnPSEwfX1udWxsIT09aC5jYWxsYmFjayYmMCE9PWgubGFuZSYmKGEuZmxhZ3N8PTY0LHI9ZS5lZmZlY3RzLG51bGw9PT1yP2UuZWZmZWN0cz1baF06ci5wdXNoKGgpKX1lbHNlIHk9e2V2ZW50VGltZTp5LGxhbmU6cix0YWc6aC50YWcscGF5bG9hZDpoLnBheWxvYWQsY2FsbGJhY2s6aC5jYWxsYmFjayxuZXh0Om51bGx9LG51bGw9PT1tPyhsPW09eSxrPXEpOm09bS5uZXh0PXksZ3w9cjsKaD1oLm5leHQ7aWYobnVsbD09PWgpaWYoaD1lLnNoYXJlZC5wZW5kaW5nLG51bGw9PT1oKWJyZWFrO2Vsc2Ugcj1oLGg9ci5uZXh0LHIubmV4dD1udWxsLGUubGFzdEJhc2VVcGRhdGU9cixlLnNoYXJlZC5wZW5kaW5nPW51bGx9d2hpbGUoMSk7bnVsbD09PW0mJihrPXEpO2UuYmFzZVN0YXRlPWs7ZS5maXJzdEJhc2VVcGRhdGU9bDtlLmxhc3RCYXNlVXBkYXRlPW07Yj1lLnNoYXJlZC5pbnRlcmxlYXZlZDtpZihudWxsIT09Yil7ZT1iO2RvIGd8PWUubGFuZSxlPWUubmV4dDt3aGlsZShlIT09Yil9ZWxzZSBudWxsPT09ZiYmKGUuc2hhcmVkLmxhbmVzPTApO2hofD1nO2EubGFuZXM9ZzthLm1lbW9pemVkU3RhdGU9cX19CmZ1bmN0aW9uIGloKGEsYixjKXthPWIuZWZmZWN0cztiLmVmZmVjdHM9bnVsbDtpZihudWxsIT09YSlmb3IoYj0wO2I8YS5sZW5ndGg7YisrKXt2YXIgZD1hW2JdLGU9ZC5jYWxsYmFjaztpZihudWxsIT09ZSl7ZC5jYWxsYmFjaz1udWxsO2Q9YztpZigiZnVuY3Rpb24iIT09dHlwZW9mIGUpdGhyb3cgRXJyb3IocCgxOTEsZSkpO2UuY2FsbChkKX19fXZhciBqaD0obmV3IGFhLkNvbXBvbmVudCkucmVmcztmdW5jdGlvbiBraChhLGIsYyxkKXtiPWEubWVtb2l6ZWRTdGF0ZTtjPWMoZCxiKTtjPW51bGw9PT1jfHx2b2lkIDA9PT1jP2I6QSh7fSxiLGMpO2EubWVtb2l6ZWRTdGF0ZT1jOzA9PT1hLmxhbmVzJiYoYS51cGRhdGVRdWV1ZS5iYXNlU3RhdGU9Yyl9CnZhciBuaD17aXNNb3VudGVkOmZ1bmN0aW9uKGEpe3JldHVybihhPWEuX3JlYWN0SW50ZXJuYWxzKT9WYihhKT09PWE6ITF9LGVucXVldWVTZXRTdGF0ZTpmdW5jdGlvbihhLGIsYyl7YT1hLl9yZWFjdEludGVybmFsczt2YXIgZD1MKCksZT1saChhKSxmPWNoKGQsZSk7Zi5wYXlsb2FkPWI7dm9pZCAwIT09YyYmbnVsbCE9PWMmJihmLmNhbGxiYWNrPWMpO2I9ZGgoYSxmLGUpO251bGwhPT1iJiYobWgoYixhLGUsZCksZWgoYixhLGUpKX0sZW5xdWV1ZVJlcGxhY2VTdGF0ZTpmdW5jdGlvbihhLGIsYyl7YT1hLl9yZWFjdEludGVybmFsczt2YXIgZD1MKCksZT1saChhKSxmPWNoKGQsZSk7Zi50YWc9MTtmLnBheWxvYWQ9Yjt2b2lkIDAhPT1jJiZudWxsIT09YyYmKGYuY2FsbGJhY2s9Yyk7Yj1kaChhLGYsZSk7bnVsbCE9PWImJihtaChiLGEsZSxkKSxlaChiLGEsZSkpfSxlbnF1ZXVlRm9yY2VVcGRhdGU6ZnVuY3Rpb24oYSxiKXthPWEuX3JlYWN0SW50ZXJuYWxzO3ZhciBjPUwoKSxkPQpsaChhKSxlPWNoKGMsZCk7ZS50YWc9Mjt2b2lkIDAhPT1iJiZudWxsIT09YiYmKGUuY2FsbGJhY2s9Yik7Yj1kaChhLGUsZCk7bnVsbCE9PWImJihtaChiLGEsZCxjKSxlaChiLGEsZCkpfX07ZnVuY3Rpb24gb2goYSxiLGMsZCxlLGYsZyl7YT1hLnN0YXRlTm9kZTtyZXR1cm4iZnVuY3Rpb24iPT09dHlwZW9mIGEuc2hvdWxkQ29tcG9uZW50VXBkYXRlP2Euc2hvdWxkQ29tcG9uZW50VXBkYXRlKGQsZixnKTpiLnByb3RvdHlwZSYmYi5wcm90b3R5cGUuaXNQdXJlUmVhY3RDb21wb25lbnQ/IUllKGMsZCl8fCFJZShlLGYpOiEwfQpmdW5jdGlvbiBwaChhLGIsYyl7dmFyIGQ9ITEsZT1WZjt2YXIgZj1iLmNvbnRleHRUeXBlOyJvYmplY3QiPT09dHlwZW9mIGYmJm51bGwhPT1mP2Y9VmcoZik6KGU9WmYoYik/WGY6SC5jdXJyZW50LGQ9Yi5jb250ZXh0VHlwZXMsZj0oZD1udWxsIT09ZCYmdm9pZCAwIT09ZCk/WWYoYSxlKTpWZik7Yj1uZXcgYihjLGYpO2EubWVtb2l6ZWRTdGF0ZT1udWxsIT09Yi5zdGF0ZSYmdm9pZCAwIT09Yi5zdGF0ZT9iLnN0YXRlOm51bGw7Yi51cGRhdGVyPW5oO2Euc3RhdGVOb2RlPWI7Yi5fcmVhY3RJbnRlcm5hbHM9YTtkJiYoYT1hLnN0YXRlTm9kZSxhLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkVW5tYXNrZWRDaGlsZENvbnRleHQ9ZSxhLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkTWFza2VkQ2hpbGRDb250ZXh0PWYpO3JldHVybiBifQpmdW5jdGlvbiBxaChhLGIsYyxkKXthPWIuc3RhdGU7ImZ1bmN0aW9uIj09PXR5cGVvZiBiLmNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMmJmIuY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhjLGQpOyJmdW5jdGlvbiI9PT10eXBlb2YgYi5VTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyYmYi5VTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhjLGQpO2Iuc3RhdGUhPT1hJiZuaC5lbnF1ZXVlUmVwbGFjZVN0YXRlKGIsYi5zdGF0ZSxudWxsKX0KZnVuY3Rpb24gcmgoYSxiLGMsZCl7dmFyIGU9YS5zdGF0ZU5vZGU7ZS5wcm9wcz1jO2Uuc3RhdGU9YS5tZW1vaXplZFN0YXRlO2UucmVmcz1qaDthaChhKTt2YXIgZj1iLmNvbnRleHRUeXBlOyJvYmplY3QiPT09dHlwZW9mIGYmJm51bGwhPT1mP2UuY29udGV4dD1WZyhmKTooZj1aZihiKT9YZjpILmN1cnJlbnQsZS5jb250ZXh0PVlmKGEsZikpO2Uuc3RhdGU9YS5tZW1vaXplZFN0YXRlO2Y9Yi5nZXREZXJpdmVkU3RhdGVGcm9tUHJvcHM7ImZ1bmN0aW9uIj09PXR5cGVvZiBmJiYoa2goYSxiLGYsYyksZS5zdGF0ZT1hLm1lbW9pemVkU3RhdGUpOyJmdW5jdGlvbiI9PT10eXBlb2YgYi5nZXREZXJpdmVkU3RhdGVGcm9tUHJvcHN8fCJmdW5jdGlvbiI9PT10eXBlb2YgZS5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZXx8ImZ1bmN0aW9uIiE9PXR5cGVvZiBlLlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQmJiJmdW5jdGlvbiIhPT10eXBlb2YgZS5jb21wb25lbnRXaWxsTW91bnR8fChiPWUuc3RhdGUsCiJmdW5jdGlvbiI9PT10eXBlb2YgZS5jb21wb25lbnRXaWxsTW91bnQmJmUuY29tcG9uZW50V2lsbE1vdW50KCksImZ1bmN0aW9uIj09PXR5cGVvZiBlLlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQmJmUuVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCgpLGIhPT1lLnN0YXRlJiZuaC5lbnF1ZXVlUmVwbGFjZVN0YXRlKGUsZS5zdGF0ZSxudWxsKSxnaChhLGMsZSxkKSxlLnN0YXRlPWEubWVtb2l6ZWRTdGF0ZSk7ImZ1bmN0aW9uIj09PXR5cGVvZiBlLmNvbXBvbmVudERpZE1vdW50JiYoYS5mbGFnc3w9NDE5NDMwOCl9CmZ1bmN0aW9uIHNoKGEsYixjKXthPWMucmVmO2lmKG51bGwhPT1hJiYiZnVuY3Rpb24iIT09dHlwZW9mIGEmJiJvYmplY3QiIT09dHlwZW9mIGEpe2lmKGMuX293bmVyKXtjPWMuX293bmVyO2lmKGMpe2lmKDEhPT1jLnRhZyl0aHJvdyBFcnJvcihwKDMwOSkpO3ZhciBkPWMuc3RhdGVOb2RlfWlmKCFkKXRocm93IEVycm9yKHAoMTQ3LGEpKTt2YXIgZT1kLGY9IiIrYTtpZihudWxsIT09YiYmbnVsbCE9PWIucmVmJiYiZnVuY3Rpb24iPT09dHlwZW9mIGIucmVmJiZiLnJlZi5fc3RyaW5nUmVmPT09ZilyZXR1cm4gYi5yZWY7Yj1mdW5jdGlvbihhKXt2YXIgYj1lLnJlZnM7Yj09PWpoJiYoYj1lLnJlZnM9e30pO251bGw9PT1hP2RlbGV0ZSBiW2ZdOmJbZl09YX07Yi5fc3RyaW5nUmVmPWY7cmV0dXJuIGJ9aWYoInN0cmluZyIhPT10eXBlb2YgYSl0aHJvdyBFcnJvcihwKDI4NCkpO2lmKCFjLl9vd25lcil0aHJvdyBFcnJvcihwKDI5MCxhKSk7fXJldHVybiBhfQpmdW5jdGlvbiB0aChhLGIpe2E9T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGIpO3Rocm93IEVycm9yKHAoMzEsIltvYmplY3QgT2JqZWN0XSI9PT1hPyJvYmplY3Qgd2l0aCBrZXlzIHsiK09iamVjdC5rZXlzKGIpLmpvaW4oIiwgIikrIn0iOmEpKTt9ZnVuY3Rpb24gdWgoYSl7dmFyIGI9YS5faW5pdDtyZXR1cm4gYihhLl9wYXlsb2FkKX0KZnVuY3Rpb24gdmgoYSl7ZnVuY3Rpb24gYihiLGMpe2lmKGEpe3ZhciBkPWIuZGVsZXRpb25zO251bGw9PT1kPyhiLmRlbGV0aW9ucz1bY10sYi5mbGFnc3w9MTYpOmQucHVzaChjKX19ZnVuY3Rpb24gYyhjLGQpe2lmKCFhKXJldHVybiBudWxsO2Zvcig7bnVsbCE9PWQ7KWIoYyxkKSxkPWQuc2libGluZztyZXR1cm4gbnVsbH1mdW5jdGlvbiBkKGEsYil7Zm9yKGE9bmV3IE1hcDtudWxsIT09YjspbnVsbCE9PWIua2V5P2Euc2V0KGIua2V5LGIpOmEuc2V0KGIuaW5kZXgsYiksYj1iLnNpYmxpbmc7cmV0dXJuIGF9ZnVuY3Rpb24gZShhLGIpe2E9d2goYSxiKTthLmluZGV4PTA7YS5zaWJsaW5nPW51bGw7cmV0dXJuIGF9ZnVuY3Rpb24gZihiLGMsZCl7Yi5pbmRleD1kO2lmKCFhKXJldHVybiBiLmZsYWdzfD0xMDQ4NTc2LGM7ZD1iLmFsdGVybmF0ZTtpZihudWxsIT09ZClyZXR1cm4gZD1kLmluZGV4LGQ8Yz8oYi5mbGFnc3w9MixjKTpkO2IuZmxhZ3N8PTI7cmV0dXJuIGN9ZnVuY3Rpb24gZyhiKXthJiYKbnVsbD09PWIuYWx0ZXJuYXRlJiYoYi5mbGFnc3w9Mik7cmV0dXJuIGJ9ZnVuY3Rpb24gaChhLGIsYyxkKXtpZihudWxsPT09Ynx8NiE9PWIudGFnKXJldHVybiBiPXhoKGMsYS5tb2RlLGQpLGIucmV0dXJuPWEsYjtiPWUoYixjKTtiLnJldHVybj1hO3JldHVybiBifWZ1bmN0aW9uIGsoYSxiLGMsZCl7dmFyIGY9Yy50eXBlO2lmKGY9PT15YSlyZXR1cm4gbShhLGIsYy5wcm9wcy5jaGlsZHJlbixkLGMua2V5KTtpZihudWxsIT09YiYmKGIuZWxlbWVudFR5cGU9PT1mfHwib2JqZWN0Ij09PXR5cGVvZiBmJiZudWxsIT09ZiYmZi4kJHR5cGVvZj09PUhhJiZ1aChmKT09PWIudHlwZSkpcmV0dXJuIGQ9ZShiLGMucHJvcHMpLGQucmVmPXNoKGEsYixjKSxkLnJldHVybj1hLGQ7ZD15aChjLnR5cGUsYy5rZXksYy5wcm9wcyxudWxsLGEubW9kZSxkKTtkLnJlZj1zaChhLGIsYyk7ZC5yZXR1cm49YTtyZXR1cm4gZH1mdW5jdGlvbiBsKGEsYixjLGQpe2lmKG51bGw9PT1ifHw0IT09Yi50YWd8fApiLnN0YXRlTm9kZS5jb250YWluZXJJbmZvIT09Yy5jb250YWluZXJJbmZvfHxiLnN0YXRlTm9kZS5pbXBsZW1lbnRhdGlvbiE9PWMuaW1wbGVtZW50YXRpb24pcmV0dXJuIGI9emgoYyxhLm1vZGUsZCksYi5yZXR1cm49YSxiO2I9ZShiLGMuY2hpbGRyZW58fFtdKTtiLnJldHVybj1hO3JldHVybiBifWZ1bmN0aW9uIG0oYSxiLGMsZCxmKXtpZihudWxsPT09Ynx8NyE9PWIudGFnKXJldHVybiBiPUFoKGMsYS5tb2RlLGQsZiksYi5yZXR1cm49YSxiO2I9ZShiLGMpO2IucmV0dXJuPWE7cmV0dXJuIGJ9ZnVuY3Rpb24gcShhLGIsYyl7aWYoInN0cmluZyI9PT10eXBlb2YgYiYmIiIhPT1ifHwibnVtYmVyIj09PXR5cGVvZiBiKXJldHVybiBiPXhoKCIiK2IsYS5tb2RlLGMpLGIucmV0dXJuPWEsYjtpZigib2JqZWN0Ij09PXR5cGVvZiBiJiZudWxsIT09Yil7c3dpdGNoKGIuJCR0eXBlb2Ype2Nhc2UgdmE6cmV0dXJuIGM9eWgoYi50eXBlLGIua2V5LGIucHJvcHMsbnVsbCxhLm1vZGUsYyksCmMucmVmPXNoKGEsbnVsbCxiKSxjLnJldHVybj1hLGM7Y2FzZSB3YTpyZXR1cm4gYj16aChiLGEubW9kZSxjKSxiLnJldHVybj1hLGI7Y2FzZSBIYTp2YXIgZD1iLl9pbml0O3JldHVybiBxKGEsZChiLl9wYXlsb2FkKSxjKX1pZihlYihiKXx8S2EoYikpcmV0dXJuIGI9QWgoYixhLm1vZGUsYyxudWxsKSxiLnJldHVybj1hLGI7dGgoYSxiKX1yZXR1cm4gbnVsbH1mdW5jdGlvbiByKGEsYixjLGQpe3ZhciBlPW51bGwhPT1iP2Iua2V5Om51bGw7aWYoInN0cmluZyI9PT10eXBlb2YgYyYmIiIhPT1jfHwibnVtYmVyIj09PXR5cGVvZiBjKXJldHVybiBudWxsIT09ZT9udWxsOmgoYSxiLCIiK2MsZCk7aWYoIm9iamVjdCI9PT10eXBlb2YgYyYmbnVsbCE9PWMpe3N3aXRjaChjLiQkdHlwZW9mKXtjYXNlIHZhOnJldHVybiBjLmtleT09PWU/ayhhLGIsYyxkKTpudWxsO2Nhc2Ugd2E6cmV0dXJuIGMua2V5PT09ZT9sKGEsYixjLGQpOm51bGw7Y2FzZSBIYTpyZXR1cm4gZT1jLl9pbml0LHIoYSwKYixlKGMuX3BheWxvYWQpLGQpfWlmKGViKGMpfHxLYShjKSlyZXR1cm4gbnVsbCE9PWU/bnVsbDptKGEsYixjLGQsbnVsbCk7dGgoYSxjKX1yZXR1cm4gbnVsbH1mdW5jdGlvbiB5KGEsYixjLGQsZSl7aWYoInN0cmluZyI9PT10eXBlb2YgZCYmIiIhPT1kfHwibnVtYmVyIj09PXR5cGVvZiBkKXJldHVybiBhPWEuZ2V0KGMpfHxudWxsLGgoYixhLCIiK2QsZSk7aWYoIm9iamVjdCI9PT10eXBlb2YgZCYmbnVsbCE9PWQpe3N3aXRjaChkLiQkdHlwZW9mKXtjYXNlIHZhOnJldHVybiBhPWEuZ2V0KG51bGw9PT1kLmtleT9jOmQua2V5KXx8bnVsbCxrKGIsYSxkLGUpO2Nhc2Ugd2E6cmV0dXJuIGE9YS5nZXQobnVsbD09PWQua2V5P2M6ZC5rZXkpfHxudWxsLGwoYixhLGQsZSk7Y2FzZSBIYTp2YXIgZj1kLl9pbml0O3JldHVybiB5KGEsYixjLGYoZC5fcGF5bG9hZCksZSl9aWYoZWIoZCl8fEthKGQpKXJldHVybiBhPWEuZ2V0KGMpfHxudWxsLG0oYixhLGQsZSxudWxsKTt0aChiLGQpfXJldHVybiBudWxsfQpmdW5jdGlvbiBuKGUsZyxoLGspe2Zvcih2YXIgbD1udWxsLG09bnVsbCx1PWcsdz1nPTAseD1udWxsO251bGwhPT11JiZ3PGgubGVuZ3RoO3crKyl7dS5pbmRleD53Pyh4PXUsdT1udWxsKTp4PXUuc2libGluZzt2YXIgbj1yKGUsdSxoW3ddLGspO2lmKG51bGw9PT1uKXtudWxsPT09dSYmKHU9eCk7YnJlYWt9YSYmdSYmbnVsbD09PW4uYWx0ZXJuYXRlJiZiKGUsdSk7Zz1mKG4sZyx3KTtudWxsPT09bT9sPW46bS5zaWJsaW5nPW47bT1uO3U9eH1pZih3PT09aC5sZW5ndGgpcmV0dXJuIGMoZSx1KSxJJiZ0ZyhlLHcpLGw7aWYobnVsbD09PXUpe2Zvcig7dzxoLmxlbmd0aDt3KyspdT1xKGUsaFt3XSxrKSxudWxsIT09dSYmKGc9Zih1LGcsdyksbnVsbD09PW0/bD11Om0uc2libGluZz11LG09dSk7SSYmdGcoZSx3KTtyZXR1cm4gbH1mb3IodT1kKGUsdSk7dzxoLmxlbmd0aDt3KyspeD15KHUsZSx3LGhbd10sayksbnVsbCE9PXgmJihhJiZudWxsIT09eC5hbHRlcm5hdGUmJnUuZGVsZXRlKG51bGw9PT0KeC5rZXk/dzp4LmtleSksZz1mKHgsZyx3KSxudWxsPT09bT9sPXg6bS5zaWJsaW5nPXgsbT14KTthJiZ1LmZvckVhY2goZnVuY3Rpb24oYSl7cmV0dXJuIGIoZSxhKX0pO0kmJnRnKGUsdyk7cmV0dXJuIGx9ZnVuY3Rpb24gdChlLGcsaCxrKXt2YXIgbD1LYShoKTtpZigiZnVuY3Rpb24iIT09dHlwZW9mIGwpdGhyb3cgRXJyb3IocCgxNTApKTtoPWwuY2FsbChoKTtpZihudWxsPT1oKXRocm93IEVycm9yKHAoMTUxKSk7Zm9yKHZhciB1PWw9bnVsbCxtPWcsdz1nPTAseD1udWxsLG49aC5uZXh0KCk7bnVsbCE9PW0mJiFuLmRvbmU7dysrLG49aC5uZXh0KCkpe20uaW5kZXg+dz8oeD1tLG09bnVsbCk6eD1tLnNpYmxpbmc7dmFyIHQ9cihlLG0sbi52YWx1ZSxrKTtpZihudWxsPT09dCl7bnVsbD09PW0mJihtPXgpO2JyZWFrfWEmJm0mJm51bGw9PT10LmFsdGVybmF0ZSYmYihlLG0pO2c9Zih0LGcsdyk7bnVsbD09PXU/bD10OnUuc2libGluZz10O3U9dDttPXh9aWYobi5kb25lKXJldHVybiBjKGUsCm0pLEkmJnRnKGUsdyksbDtpZihudWxsPT09bSl7Zm9yKDshbi5kb25lO3crKyxuPWgubmV4dCgpKW49cShlLG4udmFsdWUsayksbnVsbCE9PW4mJihnPWYobixnLHcpLG51bGw9PT11P2w9bjp1LnNpYmxpbmc9bix1PW4pO0kmJnRnKGUsdyk7cmV0dXJuIGx9Zm9yKG09ZChlLG0pOyFuLmRvbmU7dysrLG49aC5uZXh0KCkpbj15KG0sZSx3LG4udmFsdWUsayksbnVsbCE9PW4mJihhJiZudWxsIT09bi5hbHRlcm5hdGUmJm0uZGVsZXRlKG51bGw9PT1uLmtleT93Om4ua2V5KSxnPWYobixnLHcpLG51bGw9PT11P2w9bjp1LnNpYmxpbmc9bix1PW4pO2EmJm0uZm9yRWFjaChmdW5jdGlvbihhKXtyZXR1cm4gYihlLGEpfSk7SSYmdGcoZSx3KTtyZXR1cm4gbH1mdW5jdGlvbiBKKGEsZCxmLGgpeyJvYmplY3QiPT09dHlwZW9mIGYmJm51bGwhPT1mJiZmLnR5cGU9PT15YSYmbnVsbD09PWYua2V5JiYoZj1mLnByb3BzLmNoaWxkcmVuKTtpZigib2JqZWN0Ij09PXR5cGVvZiBmJiZudWxsIT09Zil7c3dpdGNoKGYuJCR0eXBlb2Ype2Nhc2UgdmE6YTp7Zm9yKHZhciBrPQpmLmtleSxsPWQ7bnVsbCE9PWw7KXtpZihsLmtleT09PWspe2s9Zi50eXBlO2lmKGs9PT15YSl7aWYoNz09PWwudGFnKXtjKGEsbC5zaWJsaW5nKTtkPWUobCxmLnByb3BzLmNoaWxkcmVuKTtkLnJldHVybj1hO2E9ZDticmVhayBhfX1lbHNlIGlmKGwuZWxlbWVudFR5cGU9PT1rfHwib2JqZWN0Ij09PXR5cGVvZiBrJiZudWxsIT09ayYmay4kJHR5cGVvZj09PUhhJiZ1aChrKT09PWwudHlwZSl7YyhhLGwuc2libGluZyk7ZD1lKGwsZi5wcm9wcyk7ZC5yZWY9c2goYSxsLGYpO2QucmV0dXJuPWE7YT1kO2JyZWFrIGF9YyhhLGwpO2JyZWFrfWVsc2UgYihhLGwpO2w9bC5zaWJsaW5nfWYudHlwZT09PXlhPyhkPUFoKGYucHJvcHMuY2hpbGRyZW4sYS5tb2RlLGgsZi5rZXkpLGQucmV0dXJuPWEsYT1kKTooaD15aChmLnR5cGUsZi5rZXksZi5wcm9wcyxudWxsLGEubW9kZSxoKSxoLnJlZj1zaChhLGQsZiksaC5yZXR1cm49YSxhPWgpfXJldHVybiBnKGEpO2Nhc2Ugd2E6YTp7Zm9yKGw9Zi5rZXk7bnVsbCE9PQpkOyl7aWYoZC5rZXk9PT1sKWlmKDQ9PT1kLnRhZyYmZC5zdGF0ZU5vZGUuY29udGFpbmVySW5mbz09PWYuY29udGFpbmVySW5mbyYmZC5zdGF0ZU5vZGUuaW1wbGVtZW50YXRpb249PT1mLmltcGxlbWVudGF0aW9uKXtjKGEsZC5zaWJsaW5nKTtkPWUoZCxmLmNoaWxkcmVufHxbXSk7ZC5yZXR1cm49YTthPWQ7YnJlYWsgYX1lbHNle2MoYSxkKTticmVha31lbHNlIGIoYSxkKTtkPWQuc2libGluZ31kPXpoKGYsYS5tb2RlLGgpO2QucmV0dXJuPWE7YT1kfXJldHVybiBnKGEpO2Nhc2UgSGE6cmV0dXJuIGw9Zi5faW5pdCxKKGEsZCxsKGYuX3BheWxvYWQpLGgpfWlmKGViKGYpKXJldHVybiBuKGEsZCxmLGgpO2lmKEthKGYpKXJldHVybiB0KGEsZCxmLGgpO3RoKGEsZil9cmV0dXJuInN0cmluZyI9PT10eXBlb2YgZiYmIiIhPT1mfHwibnVtYmVyIj09PXR5cGVvZiBmPyhmPSIiK2YsbnVsbCE9PWQmJjY9PT1kLnRhZz8oYyhhLGQuc2libGluZyksZD1lKGQsZiksZC5yZXR1cm49YSxhPWQpOgooYyhhLGQpLGQ9eGgoZixhLm1vZGUsaCksZC5yZXR1cm49YSxhPWQpLGcoYSkpOmMoYSxkKX1yZXR1cm4gSn12YXIgQmg9dmgoITApLENoPXZoKCExKSxEaD17fSxFaD1VZihEaCksRmg9VWYoRGgpLEdoPVVmKERoKTtmdW5jdGlvbiBIaChhKXtpZihhPT09RGgpdGhyb3cgRXJyb3IocCgxNzQpKTtyZXR1cm4gYX1mdW5jdGlvbiBJaChhLGIpe0coR2gsYik7RyhGaCxhKTtHKEVoLERoKTthPWIubm9kZVR5cGU7c3dpdGNoKGEpe2Nhc2UgOTpjYXNlIDExOmI9KGI9Yi5kb2N1bWVudEVsZW1lbnQpP2IubmFtZXNwYWNlVVJJOmxiKG51bGwsIiIpO2JyZWFrO2RlZmF1bHQ6YT04PT09YT9iLnBhcmVudE5vZGU6YixiPWEubmFtZXNwYWNlVVJJfHxudWxsLGE9YS50YWdOYW1lLGI9bGIoYixhKX1FKEVoKTtHKEVoLGIpfWZ1bmN0aW9uIEpoKCl7RShFaCk7RShGaCk7RShHaCl9CmZ1bmN0aW9uIEtoKGEpe0hoKEdoLmN1cnJlbnQpO3ZhciBiPUhoKEVoLmN1cnJlbnQpO3ZhciBjPWxiKGIsYS50eXBlKTtiIT09YyYmKEcoRmgsYSksRyhFaCxjKSl9ZnVuY3Rpb24gTGgoYSl7RmguY3VycmVudD09PWEmJihFKEVoKSxFKEZoKSl9dmFyIE09VWYoMCk7CmZ1bmN0aW9uIE1oKGEpe2Zvcih2YXIgYj1hO251bGwhPT1iOyl7aWYoMTM9PT1iLnRhZyl7dmFyIGM9Yi5tZW1vaXplZFN0YXRlO2lmKG51bGwhPT1jJiYoYz1jLmRlaHlkcmF0ZWQsbnVsbD09PWN8fCIkPyI9PT1jLmRhdGF8fCIkISI9PT1jLmRhdGEpKXJldHVybiBifWVsc2UgaWYoMTk9PT1iLnRhZyYmdm9pZCAwIT09Yi5tZW1vaXplZFByb3BzLnJldmVhbE9yZGVyKXtpZigwIT09KGIuZmxhZ3MmMTI4KSlyZXR1cm4gYn1lbHNlIGlmKG51bGwhPT1iLmNoaWxkKXtiLmNoaWxkLnJldHVybj1iO2I9Yi5jaGlsZDtjb250aW51ZX1pZihiPT09YSlicmVhaztmb3IoO251bGw9PT1iLnNpYmxpbmc7KXtpZihudWxsPT09Yi5yZXR1cm58fGIucmV0dXJuPT09YSlyZXR1cm4gbnVsbDtiPWIucmV0dXJufWIuc2libGluZy5yZXR1cm49Yi5yZXR1cm47Yj1iLnNpYmxpbmd9cmV0dXJuIG51bGx9dmFyIE5oPVtdOwpmdW5jdGlvbiBPaCgpe2Zvcih2YXIgYT0wO2E8TmgubGVuZ3RoO2ErKylOaFthXS5fd29ya0luUHJvZ3Jlc3NWZXJzaW9uUHJpbWFyeT1udWxsO05oLmxlbmd0aD0wfXZhciBQaD11YS5SZWFjdEN1cnJlbnREaXNwYXRjaGVyLFFoPXVhLlJlYWN0Q3VycmVudEJhdGNoQ29uZmlnLFJoPTAsTj1udWxsLE89bnVsbCxQPW51bGwsU2g9ITEsVGg9ITEsVWg9MCxWaD0wO2Z1bmN0aW9uIFEoKXt0aHJvdyBFcnJvcihwKDMyMSkpO31mdW5jdGlvbiBXaChhLGIpe2lmKG51bGw9PT1iKXJldHVybiExO2Zvcih2YXIgYz0wO2M8Yi5sZW5ndGgmJmM8YS5sZW5ndGg7YysrKWlmKCFIZShhW2NdLGJbY10pKXJldHVybiExO3JldHVybiEwfQpmdW5jdGlvbiBYaChhLGIsYyxkLGUsZil7Umg9ZjtOPWI7Yi5tZW1vaXplZFN0YXRlPW51bGw7Yi51cGRhdGVRdWV1ZT1udWxsO2IubGFuZXM9MDtQaC5jdXJyZW50PW51bGw9PT1hfHxudWxsPT09YS5tZW1vaXplZFN0YXRlP1loOlpoO2E9YyhkLGUpO2lmKFRoKXtmPTA7ZG97VGg9ITE7VWg9MDtpZigyNTw9Zil0aHJvdyBFcnJvcihwKDMwMSkpO2YrPTE7UD1PPW51bGw7Yi51cGRhdGVRdWV1ZT1udWxsO1BoLmN1cnJlbnQ9JGg7YT1jKGQsZSl9d2hpbGUoVGgpfVBoLmN1cnJlbnQ9YWk7Yj1udWxsIT09TyYmbnVsbCE9PU8ubmV4dDtSaD0wO1A9Tz1OPW51bGw7U2g9ITE7aWYoYil0aHJvdyBFcnJvcihwKDMwMCkpO3JldHVybiBhfWZ1bmN0aW9uIGJpKCl7dmFyIGE9MCE9PVVoO1VoPTA7cmV0dXJuIGF9CmZ1bmN0aW9uIGNpKCl7dmFyIGE9e21lbW9pemVkU3RhdGU6bnVsbCxiYXNlU3RhdGU6bnVsbCxiYXNlUXVldWU6bnVsbCxxdWV1ZTpudWxsLG5leHQ6bnVsbH07bnVsbD09PVA/Ti5tZW1vaXplZFN0YXRlPVA9YTpQPVAubmV4dD1hO3JldHVybiBQfWZ1bmN0aW9uIGRpKCl7aWYobnVsbD09PU8pe3ZhciBhPU4uYWx0ZXJuYXRlO2E9bnVsbCE9PWE/YS5tZW1vaXplZFN0YXRlOm51bGx9ZWxzZSBhPU8ubmV4dDt2YXIgYj1udWxsPT09UD9OLm1lbW9pemVkU3RhdGU6UC5uZXh0O2lmKG51bGwhPT1iKVA9YixPPWE7ZWxzZXtpZihudWxsPT09YSl0aHJvdyBFcnJvcihwKDMxMCkpO089YTthPXttZW1vaXplZFN0YXRlOk8ubWVtb2l6ZWRTdGF0ZSxiYXNlU3RhdGU6Ty5iYXNlU3RhdGUsYmFzZVF1ZXVlOk8uYmFzZVF1ZXVlLHF1ZXVlOk8ucXVldWUsbmV4dDpudWxsfTtudWxsPT09UD9OLm1lbW9pemVkU3RhdGU9UD1hOlA9UC5uZXh0PWF9cmV0dXJuIFB9CmZ1bmN0aW9uIGVpKGEsYil7cmV0dXJuImZ1bmN0aW9uIj09PXR5cGVvZiBiP2IoYSk6Yn0KZnVuY3Rpb24gZmkoYSl7dmFyIGI9ZGkoKSxjPWIucXVldWU7aWYobnVsbD09PWMpdGhyb3cgRXJyb3IocCgzMTEpKTtjLmxhc3RSZW5kZXJlZFJlZHVjZXI9YTt2YXIgZD1PLGU9ZC5iYXNlUXVldWUsZj1jLnBlbmRpbmc7aWYobnVsbCE9PWYpe2lmKG51bGwhPT1lKXt2YXIgZz1lLm5leHQ7ZS5uZXh0PWYubmV4dDtmLm5leHQ9Z31kLmJhc2VRdWV1ZT1lPWY7Yy5wZW5kaW5nPW51bGx9aWYobnVsbCE9PWUpe2Y9ZS5uZXh0O2Q9ZC5iYXNlU3RhdGU7dmFyIGg9Zz1udWxsLGs9bnVsbCxsPWY7ZG97dmFyIG09bC5sYW5lO2lmKChSaCZtKT09PW0pbnVsbCE9PWsmJihrPWsubmV4dD17bGFuZTowLGFjdGlvbjpsLmFjdGlvbixoYXNFYWdlclN0YXRlOmwuaGFzRWFnZXJTdGF0ZSxlYWdlclN0YXRlOmwuZWFnZXJTdGF0ZSxuZXh0Om51bGx9KSxkPWwuaGFzRWFnZXJTdGF0ZT9sLmVhZ2VyU3RhdGU6YShkLGwuYWN0aW9uKTtlbHNle3ZhciBxPXtsYW5lOm0sYWN0aW9uOmwuYWN0aW9uLGhhc0VhZ2VyU3RhdGU6bC5oYXNFYWdlclN0YXRlLAplYWdlclN0YXRlOmwuZWFnZXJTdGF0ZSxuZXh0Om51bGx9O251bGw9PT1rPyhoPWs9cSxnPWQpOms9ay5uZXh0PXE7Ti5sYW5lc3w9bTtoaHw9bX1sPWwubmV4dH13aGlsZShudWxsIT09bCYmbCE9PWYpO251bGw9PT1rP2c9ZDprLm5leHQ9aDtIZShkLGIubWVtb2l6ZWRTdGF0ZSl8fChVZz0hMCk7Yi5tZW1vaXplZFN0YXRlPWQ7Yi5iYXNlU3RhdGU9ZztiLmJhc2VRdWV1ZT1rO2MubGFzdFJlbmRlcmVkU3RhdGU9ZH1hPWMuaW50ZXJsZWF2ZWQ7aWYobnVsbCE9PWEpe2U9YTtkbyBmPWUubGFuZSxOLmxhbmVzfD1mLGhofD1mLGU9ZS5uZXh0O3doaWxlKGUhPT1hKX1lbHNlIG51bGw9PT1lJiYoYy5sYW5lcz0wKTtyZXR1cm5bYi5tZW1vaXplZFN0YXRlLGMuZGlzcGF0Y2hdfQpmdW5jdGlvbiBnaShhKXt2YXIgYj1kaSgpLGM9Yi5xdWV1ZTtpZihudWxsPT09Yyl0aHJvdyBFcnJvcihwKDMxMSkpO2MubGFzdFJlbmRlcmVkUmVkdWNlcj1hO3ZhciBkPWMuZGlzcGF0Y2gsZT1jLnBlbmRpbmcsZj1iLm1lbW9pemVkU3RhdGU7aWYobnVsbCE9PWUpe2MucGVuZGluZz1udWxsO3ZhciBnPWU9ZS5uZXh0O2RvIGY9YShmLGcuYWN0aW9uKSxnPWcubmV4dDt3aGlsZShnIT09ZSk7SGUoZixiLm1lbW9pemVkU3RhdGUpfHwoVWc9ITApO2IubWVtb2l6ZWRTdGF0ZT1mO251bGw9PT1iLmJhc2VRdWV1ZSYmKGIuYmFzZVN0YXRlPWYpO2MubGFzdFJlbmRlcmVkU3RhdGU9Zn1yZXR1cm5bZixkXX1mdW5jdGlvbiBoaSgpe30KZnVuY3Rpb24gaWkoYSxiKXt2YXIgYz1OLGQ9ZGkoKSxlPWIoKSxmPSFIZShkLm1lbW9pemVkU3RhdGUsZSk7ZiYmKGQubWVtb2l6ZWRTdGF0ZT1lLFVnPSEwKTtkPWQucXVldWU7amkoa2kuYmluZChudWxsLGMsZCxhKSxbYV0pO2lmKGQuZ2V0U25hcHNob3QhPT1ifHxmfHxudWxsIT09UCYmUC5tZW1vaXplZFN0YXRlLnRhZyYxKXtjLmZsYWdzfD0yMDQ4O2xpKDksbWkuYmluZChudWxsLGMsZCxlLGIpLHZvaWQgMCxudWxsKTtpZihudWxsPT09Uil0aHJvdyBFcnJvcihwKDM0OSkpOzAhPT0oUmgmMzApfHxuaShjLGIsZSl9cmV0dXJuIGV9ZnVuY3Rpb24gbmkoYSxiLGMpe2EuZmxhZ3N8PTE2Mzg0O2E9e2dldFNuYXBzaG90OmIsdmFsdWU6Y307Yj1OLnVwZGF0ZVF1ZXVlO251bGw9PT1iPyhiPXtsYXN0RWZmZWN0Om51bGwsc3RvcmVzOm51bGx9LE4udXBkYXRlUXVldWU9YixiLnN0b3Jlcz1bYV0pOihjPWIuc3RvcmVzLG51bGw9PT1jP2Iuc3RvcmVzPVthXTpjLnB1c2goYSkpfQpmdW5jdGlvbiBtaShhLGIsYyxkKXtiLnZhbHVlPWM7Yi5nZXRTbmFwc2hvdD1kO29pKGIpJiZwaShhKX1mdW5jdGlvbiBraShhLGIsYyl7cmV0dXJuIGMoZnVuY3Rpb24oKXtvaShiKSYmcGkoYSl9KX1mdW5jdGlvbiBvaShhKXt2YXIgYj1hLmdldFNuYXBzaG90O2E9YS52YWx1ZTt0cnl7dmFyIGM9YigpO3JldHVybiFIZShhLGMpfWNhdGNoKGQpe3JldHVybiEwfX1mdW5jdGlvbiBwaShhKXt2YXIgYj1aZyhhLDEpO251bGwhPT1iJiZtaChiLGEsMSwtMSl9CmZ1bmN0aW9uIHFpKGEpe3ZhciBiPWNpKCk7ImZ1bmN0aW9uIj09PXR5cGVvZiBhJiYoYT1hKCkpO2IubWVtb2l6ZWRTdGF0ZT1iLmJhc2VTdGF0ZT1hO2E9e3BlbmRpbmc6bnVsbCxpbnRlcmxlYXZlZDpudWxsLGxhbmVzOjAsZGlzcGF0Y2g6bnVsbCxsYXN0UmVuZGVyZWRSZWR1Y2VyOmVpLGxhc3RSZW5kZXJlZFN0YXRlOmF9O2IucXVldWU9YTthPWEuZGlzcGF0Y2g9cmkuYmluZChudWxsLE4sYSk7cmV0dXJuW2IubWVtb2l6ZWRTdGF0ZSxhXX0KZnVuY3Rpb24gbGkoYSxiLGMsZCl7YT17dGFnOmEsY3JlYXRlOmIsZGVzdHJveTpjLGRlcHM6ZCxuZXh0Om51bGx9O2I9Ti51cGRhdGVRdWV1ZTtudWxsPT09Yj8oYj17bGFzdEVmZmVjdDpudWxsLHN0b3JlczpudWxsfSxOLnVwZGF0ZVF1ZXVlPWIsYi5sYXN0RWZmZWN0PWEubmV4dD1hKTooYz1iLmxhc3RFZmZlY3QsbnVsbD09PWM/Yi5sYXN0RWZmZWN0PWEubmV4dD1hOihkPWMubmV4dCxjLm5leHQ9YSxhLm5leHQ9ZCxiLmxhc3RFZmZlY3Q9YSkpO3JldHVybiBhfWZ1bmN0aW9uIHNpKCl7cmV0dXJuIGRpKCkubWVtb2l6ZWRTdGF0ZX1mdW5jdGlvbiB0aShhLGIsYyxkKXt2YXIgZT1jaSgpO04uZmxhZ3N8PWE7ZS5tZW1vaXplZFN0YXRlPWxpKDF8YixjLHZvaWQgMCx2b2lkIDA9PT1kP251bGw6ZCl9CmZ1bmN0aW9uIHVpKGEsYixjLGQpe3ZhciBlPWRpKCk7ZD12b2lkIDA9PT1kP251bGw6ZDt2YXIgZj12b2lkIDA7aWYobnVsbCE9PU8pe3ZhciBnPU8ubWVtb2l6ZWRTdGF0ZTtmPWcuZGVzdHJveTtpZihudWxsIT09ZCYmV2goZCxnLmRlcHMpKXtlLm1lbW9pemVkU3RhdGU9bGkoYixjLGYsZCk7cmV0dXJufX1OLmZsYWdzfD1hO2UubWVtb2l6ZWRTdGF0ZT1saSgxfGIsYyxmLGQpfWZ1bmN0aW9uIHZpKGEsYil7cmV0dXJuIHRpKDgzOTA2NTYsOCxhLGIpfWZ1bmN0aW9uIGppKGEsYil7cmV0dXJuIHVpKDIwNDgsOCxhLGIpfWZ1bmN0aW9uIHdpKGEsYil7cmV0dXJuIHVpKDQsMixhLGIpfWZ1bmN0aW9uIHhpKGEsYil7cmV0dXJuIHVpKDQsNCxhLGIpfQpmdW5jdGlvbiB5aShhLGIpe2lmKCJmdW5jdGlvbiI9PT10eXBlb2YgYilyZXR1cm4gYT1hKCksYihhKSxmdW5jdGlvbigpe2IobnVsbCl9O2lmKG51bGwhPT1iJiZ2b2lkIDAhPT1iKXJldHVybiBhPWEoKSxiLmN1cnJlbnQ9YSxmdW5jdGlvbigpe2IuY3VycmVudD1udWxsfX1mdW5jdGlvbiB6aShhLGIsYyl7Yz1udWxsIT09YyYmdm9pZCAwIT09Yz9jLmNvbmNhdChbYV0pOm51bGw7cmV0dXJuIHVpKDQsNCx5aS5iaW5kKG51bGwsYixhKSxjKX1mdW5jdGlvbiBBaSgpe31mdW5jdGlvbiBCaShhLGIpe3ZhciBjPWRpKCk7Yj12b2lkIDA9PT1iP251bGw6Yjt2YXIgZD1jLm1lbW9pemVkU3RhdGU7aWYobnVsbCE9PWQmJm51bGwhPT1iJiZXaChiLGRbMV0pKXJldHVybiBkWzBdO2MubWVtb2l6ZWRTdGF0ZT1bYSxiXTtyZXR1cm4gYX0KZnVuY3Rpb24gQ2koYSxiKXt2YXIgYz1kaSgpO2I9dm9pZCAwPT09Yj9udWxsOmI7dmFyIGQ9Yy5tZW1vaXplZFN0YXRlO2lmKG51bGwhPT1kJiZudWxsIT09YiYmV2goYixkWzFdKSlyZXR1cm4gZFswXTthPWEoKTtjLm1lbW9pemVkU3RhdGU9W2EsYl07cmV0dXJuIGF9ZnVuY3Rpb24gRGkoYSxiLGMpe2lmKDA9PT0oUmgmMjEpKXJldHVybiBhLmJhc2VTdGF0ZSYmKGEuYmFzZVN0YXRlPSExLFVnPSEwKSxhLm1lbW9pemVkU3RhdGU9YztIZShjLGIpfHwoYz15YygpLE4ubGFuZXN8PWMsaGh8PWMsYS5iYXNlU3RhdGU9ITApO3JldHVybiBifWZ1bmN0aW9uIEVpKGEsYil7dmFyIGM9QztDPTAhPT1jJiY0PmM/Yzo0O2EoITApO3ZhciBkPVFoLnRyYW5zaXRpb247UWgudHJhbnNpdGlvbj17fTt0cnl7YSghMSksYigpfWZpbmFsbHl7Qz1jLFFoLnRyYW5zaXRpb249ZH19ZnVuY3Rpb24gRmkoKXtyZXR1cm4gZGkoKS5tZW1vaXplZFN0YXRlfQpmdW5jdGlvbiBHaShhLGIsYyl7dmFyIGQ9bGgoYSk7Yz17bGFuZTpkLGFjdGlvbjpjLGhhc0VhZ2VyU3RhdGU6ITEsZWFnZXJTdGF0ZTpudWxsLG5leHQ6bnVsbH07aWYoSGkoYSkpSWkoYixjKTtlbHNlIGlmKGM9WWcoYSxiLGMsZCksbnVsbCE9PWMpe3ZhciBlPUwoKTttaChjLGEsZCxlKTtKaShjLGIsZCl9fQpmdW5jdGlvbiByaShhLGIsYyl7dmFyIGQ9bGgoYSksZT17bGFuZTpkLGFjdGlvbjpjLGhhc0VhZ2VyU3RhdGU6ITEsZWFnZXJTdGF0ZTpudWxsLG5leHQ6bnVsbH07aWYoSGkoYSkpSWkoYixlKTtlbHNle3ZhciBmPWEuYWx0ZXJuYXRlO2lmKDA9PT1hLmxhbmVzJiYobnVsbD09PWZ8fDA9PT1mLmxhbmVzKSYmKGY9Yi5sYXN0UmVuZGVyZWRSZWR1Y2VyLG51bGwhPT1mKSl0cnl7dmFyIGc9Yi5sYXN0UmVuZGVyZWRTdGF0ZSxoPWYoZyxjKTtlLmhhc0VhZ2VyU3RhdGU9ITA7ZS5lYWdlclN0YXRlPWg7aWYoSGUoaCxnKSl7dmFyIGs9Yi5pbnRlcmxlYXZlZDtudWxsPT09az8oZS5uZXh0PWUsWGcoYikpOihlLm5leHQ9ay5uZXh0LGsubmV4dD1lKTtiLmludGVybGVhdmVkPWU7cmV0dXJufX1jYXRjaChsKXt9ZmluYWxseXt9Yz1ZZyhhLGIsZSxkKTtudWxsIT09YyYmKGU9TCgpLG1oKGMsYSxkLGUpLEppKGMsYixkKSl9fQpmdW5jdGlvbiBIaShhKXt2YXIgYj1hLmFsdGVybmF0ZTtyZXR1cm4gYT09PU58fG51bGwhPT1iJiZiPT09Tn1mdW5jdGlvbiBJaShhLGIpe1RoPVNoPSEwO3ZhciBjPWEucGVuZGluZztudWxsPT09Yz9iLm5leHQ9YjooYi5uZXh0PWMubmV4dCxjLm5leHQ9Yik7YS5wZW5kaW5nPWJ9ZnVuY3Rpb24gSmkoYSxiLGMpe2lmKDAhPT0oYyY0MTk0MjQwKSl7dmFyIGQ9Yi5sYW5lcztkJj1hLnBlbmRpbmdMYW5lcztjfD1kO2IubGFuZXM9YztDYyhhLGMpfX0KdmFyIGFpPXtyZWFkQ29udGV4dDpWZyx1c2VDYWxsYmFjazpRLHVzZUNvbnRleHQ6USx1c2VFZmZlY3Q6USx1c2VJbXBlcmF0aXZlSGFuZGxlOlEsdXNlSW5zZXJ0aW9uRWZmZWN0OlEsdXNlTGF5b3V0RWZmZWN0OlEsdXNlTWVtbzpRLHVzZVJlZHVjZXI6USx1c2VSZWY6USx1c2VTdGF0ZTpRLHVzZURlYnVnVmFsdWU6USx1c2VEZWZlcnJlZFZhbHVlOlEsdXNlVHJhbnNpdGlvbjpRLHVzZU11dGFibGVTb3VyY2U6USx1c2VTeW5jRXh0ZXJuYWxTdG9yZTpRLHVzZUlkOlEsdW5zdGFibGVfaXNOZXdSZWNvbmNpbGVyOiExfSxZaD17cmVhZENvbnRleHQ6VmcsdXNlQ2FsbGJhY2s6ZnVuY3Rpb24oYSxiKXtjaSgpLm1lbW9pemVkU3RhdGU9W2Esdm9pZCAwPT09Yj9udWxsOmJdO3JldHVybiBhfSx1c2VDb250ZXh0OlZnLHVzZUVmZmVjdDp2aSx1c2VJbXBlcmF0aXZlSGFuZGxlOmZ1bmN0aW9uKGEsYixjKXtjPW51bGwhPT1jJiZ2b2lkIDAhPT1jP2MuY29uY2F0KFthXSk6bnVsbDtyZXR1cm4gdGkoNDE5NDMwOCwKNCx5aS5iaW5kKG51bGwsYixhKSxjKX0sdXNlTGF5b3V0RWZmZWN0OmZ1bmN0aW9uKGEsYil7cmV0dXJuIHRpKDQxOTQzMDgsNCxhLGIpfSx1c2VJbnNlcnRpb25FZmZlY3Q6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGkoNCwyLGEsYil9LHVzZU1lbW86ZnVuY3Rpb24oYSxiKXt2YXIgYz1jaSgpO2I9dm9pZCAwPT09Yj9udWxsOmI7YT1hKCk7Yy5tZW1vaXplZFN0YXRlPVthLGJdO3JldHVybiBhfSx1c2VSZWR1Y2VyOmZ1bmN0aW9uKGEsYixjKXt2YXIgZD1jaSgpO2I9dm9pZCAwIT09Yz9jKGIpOmI7ZC5tZW1vaXplZFN0YXRlPWQuYmFzZVN0YXRlPWI7YT17cGVuZGluZzpudWxsLGludGVybGVhdmVkOm51bGwsbGFuZXM6MCxkaXNwYXRjaDpudWxsLGxhc3RSZW5kZXJlZFJlZHVjZXI6YSxsYXN0UmVuZGVyZWRTdGF0ZTpifTtkLnF1ZXVlPWE7YT1hLmRpc3BhdGNoPUdpLmJpbmQobnVsbCxOLGEpO3JldHVybltkLm1lbW9pemVkU3RhdGUsYV19LHVzZVJlZjpmdW5jdGlvbihhKXt2YXIgYj0KY2koKTthPXtjdXJyZW50OmF9O3JldHVybiBiLm1lbW9pemVkU3RhdGU9YX0sdXNlU3RhdGU6cWksdXNlRGVidWdWYWx1ZTpBaSx1c2VEZWZlcnJlZFZhbHVlOmZ1bmN0aW9uKGEpe3JldHVybiBjaSgpLm1lbW9pemVkU3RhdGU9YX0sdXNlVHJhbnNpdGlvbjpmdW5jdGlvbigpe3ZhciBhPXFpKCExKSxiPWFbMF07YT1FaS5iaW5kKG51bGwsYVsxXSk7Y2koKS5tZW1vaXplZFN0YXRlPWE7cmV0dXJuW2IsYV19LHVzZU11dGFibGVTb3VyY2U6ZnVuY3Rpb24oKXt9LHVzZVN5bmNFeHRlcm5hbFN0b3JlOmZ1bmN0aW9uKGEsYixjKXt2YXIgZD1OLGU9Y2koKTtpZihJKXtpZih2b2lkIDA9PT1jKXRocm93IEVycm9yKHAoNDA3KSk7Yz1jKCl9ZWxzZXtjPWIoKTtpZihudWxsPT09Uil0aHJvdyBFcnJvcihwKDM0OSkpOzAhPT0oUmgmMzApfHxuaShkLGIsYyl9ZS5tZW1vaXplZFN0YXRlPWM7dmFyIGY9e3ZhbHVlOmMsZ2V0U25hcHNob3Q6Yn07ZS5xdWV1ZT1mO3ZpKGtpLmJpbmQobnVsbCxkLApmLGEpLFthXSk7ZC5mbGFnc3w9MjA0ODtsaSg5LG1pLmJpbmQobnVsbCxkLGYsYyxiKSx2b2lkIDAsbnVsbCk7cmV0dXJuIGN9LHVzZUlkOmZ1bmN0aW9uKCl7dmFyIGE9Y2koKSxiPVIuaWRlbnRpZmllclByZWZpeDtpZihJKXt2YXIgYz1zZzt2YXIgZD1yZztjPShkJn4oMTw8MzItb2MoZCktMSkpLnRvU3RyaW5nKDMyKStjO2I9IjoiK2IrIlIiK2M7Yz1VaCsrOzA8YyYmKGIrPSJIIitjLnRvU3RyaW5nKDMyKSk7Yis9IjoifWVsc2UgYz1WaCsrLGI9IjoiK2IrInIiK2MudG9TdHJpbmcoMzIpKyI6IjtyZXR1cm4gYS5tZW1vaXplZFN0YXRlPWJ9LHVuc3RhYmxlX2lzTmV3UmVjb25jaWxlcjohMX0sWmg9e3JlYWRDb250ZXh0OlZnLHVzZUNhbGxiYWNrOkJpLHVzZUNvbnRleHQ6VmcsdXNlRWZmZWN0OmppLHVzZUltcGVyYXRpdmVIYW5kbGU6emksdXNlSW5zZXJ0aW9uRWZmZWN0OndpLHVzZUxheW91dEVmZmVjdDp4aSx1c2VNZW1vOkNpLHVzZVJlZHVjZXI6ZmksdXNlUmVmOnNpLHVzZVN0YXRlOmZ1bmN0aW9uKCl7cmV0dXJuIGZpKGVpKX0sCnVzZURlYnVnVmFsdWU6QWksdXNlRGVmZXJyZWRWYWx1ZTpmdW5jdGlvbihhKXt2YXIgYj1kaSgpO3JldHVybiBEaShiLE8ubWVtb2l6ZWRTdGF0ZSxhKX0sdXNlVHJhbnNpdGlvbjpmdW5jdGlvbigpe3ZhciBhPWZpKGVpKVswXSxiPWRpKCkubWVtb2l6ZWRTdGF0ZTtyZXR1cm5bYSxiXX0sdXNlTXV0YWJsZVNvdXJjZTpoaSx1c2VTeW5jRXh0ZXJuYWxTdG9yZTppaSx1c2VJZDpGaSx1bnN0YWJsZV9pc05ld1JlY29uY2lsZXI6ITF9LCRoPXtyZWFkQ29udGV4dDpWZyx1c2VDYWxsYmFjazpCaSx1c2VDb250ZXh0OlZnLHVzZUVmZmVjdDpqaSx1c2VJbXBlcmF0aXZlSGFuZGxlOnppLHVzZUluc2VydGlvbkVmZmVjdDp3aSx1c2VMYXlvdXRFZmZlY3Q6eGksdXNlTWVtbzpDaSx1c2VSZWR1Y2VyOmdpLHVzZVJlZjpzaSx1c2VTdGF0ZTpmdW5jdGlvbigpe3JldHVybiBnaShlaSl9LHVzZURlYnVnVmFsdWU6QWksdXNlRGVmZXJyZWRWYWx1ZTpmdW5jdGlvbihhKXt2YXIgYj1kaSgpO3JldHVybiBudWxsPT09Ck8/Yi5tZW1vaXplZFN0YXRlPWE6RGkoYixPLm1lbW9pemVkU3RhdGUsYSl9LHVzZVRyYW5zaXRpb246ZnVuY3Rpb24oKXt2YXIgYT1naShlaSlbMF0sYj1kaSgpLm1lbW9pemVkU3RhdGU7cmV0dXJuW2EsYl19LHVzZU11dGFibGVTb3VyY2U6aGksdXNlU3luY0V4dGVybmFsU3RvcmU6aWksdXNlSWQ6RmksdW5zdGFibGVfaXNOZXdSZWNvbmNpbGVyOiExfTtmdW5jdGlvbiBLaShhLGIpe3RyeXt2YXIgYz0iIixkPWI7ZG8gYys9UGEoZCksZD1kLnJldHVybjt3aGlsZShkKTt2YXIgZT1jfWNhdGNoKGYpe2U9IlxuRXJyb3IgZ2VuZXJhdGluZyBzdGFjazogIitmLm1lc3NhZ2UrIlxuIitmLnN0YWNrfXJldHVybnt2YWx1ZTphLHNvdXJjZTpiLHN0YWNrOmUsZGlnZXN0Om51bGx9fWZ1bmN0aW9uIExpKGEsYixjKXtyZXR1cm57dmFsdWU6YSxzb3VyY2U6bnVsbCxzdGFjazpudWxsIT1jP2M6bnVsbCxkaWdlc3Q6bnVsbCE9Yj9iOm51bGx9fQpmdW5jdGlvbiBNaShhLGIpe3RyeXtjb25zb2xlLmVycm9yKGIudmFsdWUpfWNhdGNoKGMpe3NldFRpbWVvdXQoZnVuY3Rpb24oKXt0aHJvdyBjO30pfX12YXIgTmk9ImZ1bmN0aW9uIj09PXR5cGVvZiBXZWFrTWFwP1dlYWtNYXA6TWFwO2Z1bmN0aW9uIE9pKGEsYixjKXtjPWNoKC0xLGMpO2MudGFnPTM7Yy5wYXlsb2FkPXtlbGVtZW50Om51bGx9O3ZhciBkPWIudmFsdWU7Yy5jYWxsYmFjaz1mdW5jdGlvbigpe1BpfHwoUGk9ITAsUWk9ZCk7TWkoYSxiKX07cmV0dXJuIGN9CmZ1bmN0aW9uIFJpKGEsYixjKXtjPWNoKC0xLGMpO2MudGFnPTM7dmFyIGQ9YS50eXBlLmdldERlcml2ZWRTdGF0ZUZyb21FcnJvcjtpZigiZnVuY3Rpb24iPT09dHlwZW9mIGQpe3ZhciBlPWIudmFsdWU7Yy5wYXlsb2FkPWZ1bmN0aW9uKCl7cmV0dXJuIGQoZSl9O2MuY2FsbGJhY2s9ZnVuY3Rpb24oKXtNaShhLGIpfX12YXIgZj1hLnN0YXRlTm9kZTtudWxsIT09ZiYmImZ1bmN0aW9uIj09PXR5cGVvZiBmLmNvbXBvbmVudERpZENhdGNoJiYoYy5jYWxsYmFjaz1mdW5jdGlvbigpe01pKGEsYik7ImZ1bmN0aW9uIiE9PXR5cGVvZiBkJiYobnVsbD09PVNpP1NpPW5ldyBTZXQoW3RoaXNdKTpTaS5hZGQodGhpcykpO3ZhciBjPWIuc3RhY2s7dGhpcy5jb21wb25lbnREaWRDYXRjaChiLnZhbHVlLHtjb21wb25lbnRTdGFjazpudWxsIT09Yz9jOiIifSl9KTtyZXR1cm4gY30KZnVuY3Rpb24gVGkoYSxiLGMpe3ZhciBkPWEucGluZ0NhY2hlO2lmKG51bGw9PT1kKXtkPWEucGluZ0NhY2hlPW5ldyBOaTt2YXIgZT1uZXcgU2V0O2Quc2V0KGIsZSl9ZWxzZSBlPWQuZ2V0KGIpLHZvaWQgMD09PWUmJihlPW5ldyBTZXQsZC5zZXQoYixlKSk7ZS5oYXMoYyl8fChlLmFkZChjKSxhPVVpLmJpbmQobnVsbCxhLGIsYyksYi50aGVuKGEsYSkpfWZ1bmN0aW9uIFZpKGEpe2Rve3ZhciBiO2lmKGI9MTM9PT1hLnRhZyliPWEubWVtb2l6ZWRTdGF0ZSxiPW51bGwhPT1iP251bGwhPT1iLmRlaHlkcmF0ZWQ/ITA6ITE6ITA7aWYoYilyZXR1cm4gYTthPWEucmV0dXJufXdoaWxlKG51bGwhPT1hKTtyZXR1cm4gbnVsbH0KZnVuY3Rpb24gV2koYSxiLGMsZCxlKXtpZigwPT09KGEubW9kZSYxKSlyZXR1cm4gYT09PWI/YS5mbGFnc3w9NjU1MzY6KGEuZmxhZ3N8PTEyOCxjLmZsYWdzfD0xMzEwNzIsYy5mbGFncyY9LTUyODA1LDE9PT1jLnRhZyYmKG51bGw9PT1jLmFsdGVybmF0ZT9jLnRhZz0xNzooYj1jaCgtMSwxKSxiLnRhZz0yLGRoKGMsYiwxKSkpLGMubGFuZXN8PTEpLGE7YS5mbGFnc3w9NjU1MzY7YS5sYW5lcz1lO3JldHVybiBhfXZhciBYaT11YS5SZWFjdEN1cnJlbnRPd25lcixVZz0hMTtmdW5jdGlvbiBZaShhLGIsYyxkKXtiLmNoaWxkPW51bGw9PT1hP0NoKGIsbnVsbCxjLGQpOkJoKGIsYS5jaGlsZCxjLGQpfQpmdW5jdGlvbiBaaShhLGIsYyxkLGUpe2M9Yy5yZW5kZXI7dmFyIGY9Yi5yZWY7VGcoYixlKTtkPVhoKGEsYixjLGQsZixlKTtjPWJpKCk7aWYobnVsbCE9PWEmJiFVZylyZXR1cm4gYi51cGRhdGVRdWV1ZT1hLnVwZGF0ZVF1ZXVlLGIuZmxhZ3MmPS0yMDUzLGEubGFuZXMmPX5lLCRpKGEsYixlKTtJJiZjJiZ2ZyhiKTtiLmZsYWdzfD0xO1lpKGEsYixkLGUpO3JldHVybiBiLmNoaWxkfQpmdW5jdGlvbiBhaihhLGIsYyxkLGUpe2lmKG51bGw9PT1hKXt2YXIgZj1jLnR5cGU7aWYoImZ1bmN0aW9uIj09PXR5cGVvZiBmJiYhYmooZikmJnZvaWQgMD09PWYuZGVmYXVsdFByb3BzJiZudWxsPT09Yy5jb21wYXJlJiZ2b2lkIDA9PT1jLmRlZmF1bHRQcm9wcylyZXR1cm4gYi50YWc9MTUsYi50eXBlPWYsY2ooYSxiLGYsZCxlKTthPXloKGMudHlwZSxudWxsLGQsYixiLm1vZGUsZSk7YS5yZWY9Yi5yZWY7YS5yZXR1cm49YjtyZXR1cm4gYi5jaGlsZD1hfWY9YS5jaGlsZDtpZigwPT09KGEubGFuZXMmZSkpe3ZhciBnPWYubWVtb2l6ZWRQcm9wcztjPWMuY29tcGFyZTtjPW51bGwhPT1jP2M6SWU7aWYoYyhnLGQpJiZhLnJlZj09PWIucmVmKXJldHVybiAkaShhLGIsZSl9Yi5mbGFnc3w9MTthPXdoKGYsZCk7YS5yZWY9Yi5yZWY7YS5yZXR1cm49YjtyZXR1cm4gYi5jaGlsZD1hfQpmdW5jdGlvbiBjaihhLGIsYyxkLGUpe2lmKG51bGwhPT1hKXt2YXIgZj1hLm1lbW9pemVkUHJvcHM7aWYoSWUoZixkKSYmYS5yZWY9PT1iLnJlZilpZihVZz0hMSxiLnBlbmRpbmdQcm9wcz1kPWYsMCE9PShhLmxhbmVzJmUpKTAhPT0oYS5mbGFncyYxMzEwNzIpJiYoVWc9ITApO2Vsc2UgcmV0dXJuIGIubGFuZXM9YS5sYW5lcywkaShhLGIsZSl9cmV0dXJuIGRqKGEsYixjLGQsZSl9CmZ1bmN0aW9uIGVqKGEsYixjKXt2YXIgZD1iLnBlbmRpbmdQcm9wcyxlPWQuY2hpbGRyZW4sZj1udWxsIT09YT9hLm1lbW9pemVkU3RhdGU6bnVsbDtpZigiaGlkZGVuIj09PWQubW9kZSlpZigwPT09KGIubW9kZSYxKSliLm1lbW9pemVkU3RhdGU9e2Jhc2VMYW5lczowLGNhY2hlUG9vbDpudWxsLHRyYW5zaXRpb25zOm51bGx9LEcoZmosZ2opLGdqfD1jO2Vsc2V7aWYoMD09PShjJjEwNzM3NDE4MjQpKXJldHVybiBhPW51bGwhPT1mP2YuYmFzZUxhbmVzfGM6YyxiLmxhbmVzPWIuY2hpbGRMYW5lcz0xMDczNzQxODI0LGIubWVtb2l6ZWRTdGF0ZT17YmFzZUxhbmVzOmEsY2FjaGVQb29sOm51bGwsdHJhbnNpdGlvbnM6bnVsbH0sYi51cGRhdGVRdWV1ZT1udWxsLEcoZmosZ2opLGdqfD1hLG51bGw7Yi5tZW1vaXplZFN0YXRlPXtiYXNlTGFuZXM6MCxjYWNoZVBvb2w6bnVsbCx0cmFuc2l0aW9uczpudWxsfTtkPW51bGwhPT1mP2YuYmFzZUxhbmVzOmM7Ryhmaixnaik7Z2p8PWR9ZWxzZSBudWxsIT09CmY/KGQ9Zi5iYXNlTGFuZXN8YyxiLm1lbW9pemVkU3RhdGU9bnVsbCk6ZD1jLEcoZmosZ2opLGdqfD1kO1lpKGEsYixlLGMpO3JldHVybiBiLmNoaWxkfWZ1bmN0aW9uIGhqKGEsYil7dmFyIGM9Yi5yZWY7aWYobnVsbD09PWEmJm51bGwhPT1jfHxudWxsIT09YSYmYS5yZWYhPT1jKWIuZmxhZ3N8PTUxMixiLmZsYWdzfD0yMDk3MTUyfWZ1bmN0aW9uIGRqKGEsYixjLGQsZSl7dmFyIGY9WmYoYyk/WGY6SC5jdXJyZW50O2Y9WWYoYixmKTtUZyhiLGUpO2M9WGgoYSxiLGMsZCxmLGUpO2Q9YmkoKTtpZihudWxsIT09YSYmIVVnKXJldHVybiBiLnVwZGF0ZVF1ZXVlPWEudXBkYXRlUXVldWUsYi5mbGFncyY9LTIwNTMsYS5sYW5lcyY9fmUsJGkoYSxiLGUpO0kmJmQmJnZnKGIpO2IuZmxhZ3N8PTE7WWkoYSxiLGMsZSk7cmV0dXJuIGIuY2hpbGR9CmZ1bmN0aW9uIGlqKGEsYixjLGQsZSl7aWYoWmYoYykpe3ZhciBmPSEwO2NnKGIpfWVsc2UgZj0hMTtUZyhiLGUpO2lmKG51bGw9PT1iLnN0YXRlTm9kZSlqaihhLGIpLHBoKGIsYyxkKSxyaChiLGMsZCxlKSxkPSEwO2Vsc2UgaWYobnVsbD09PWEpe3ZhciBnPWIuc3RhdGVOb2RlLGg9Yi5tZW1vaXplZFByb3BzO2cucHJvcHM9aDt2YXIgaz1nLmNvbnRleHQsbD1jLmNvbnRleHRUeXBlOyJvYmplY3QiPT09dHlwZW9mIGwmJm51bGwhPT1sP2w9VmcobCk6KGw9WmYoYyk/WGY6SC5jdXJyZW50LGw9WWYoYixsKSk7dmFyIG09Yy5nZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMscT0iZnVuY3Rpb24iPT09dHlwZW9mIG18fCJmdW5jdGlvbiI9PT10eXBlb2YgZy5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZTtxfHwiZnVuY3Rpb24iIT09dHlwZW9mIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMmJiJmdW5jdGlvbiIhPT10eXBlb2YgZy5jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzfHwKKGghPT1kfHxrIT09bCkmJnFoKGIsZyxkLGwpOyRnPSExO3ZhciByPWIubWVtb2l6ZWRTdGF0ZTtnLnN0YXRlPXI7Z2goYixkLGcsZSk7az1iLm1lbW9pemVkU3RhdGU7aCE9PWR8fHIhPT1rfHxXZi5jdXJyZW50fHwkZz8oImZ1bmN0aW9uIj09PXR5cGVvZiBtJiYoa2goYixjLG0sZCksaz1iLm1lbW9pemVkU3RhdGUpLChoPSRnfHxvaChiLGMsaCxkLHIsayxsKSk/KHF8fCJmdW5jdGlvbiIhPT10eXBlb2YgZy5VTlNBRkVfY29tcG9uZW50V2lsbE1vdW50JiYiZnVuY3Rpb24iIT09dHlwZW9mIGcuY29tcG9uZW50V2lsbE1vdW50fHwoImZ1bmN0aW9uIj09PXR5cGVvZiBnLmNvbXBvbmVudFdpbGxNb3VudCYmZy5jb21wb25lbnRXaWxsTW91bnQoKSwiZnVuY3Rpb24iPT09dHlwZW9mIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCYmZy5VTlNBRkVfY29tcG9uZW50V2lsbE1vdW50KCkpLCJmdW5jdGlvbiI9PT10eXBlb2YgZy5jb21wb25lbnREaWRNb3VudCYmKGIuZmxhZ3N8PTQxOTQzMDgpKToKKCJmdW5jdGlvbiI9PT10eXBlb2YgZy5jb21wb25lbnREaWRNb3VudCYmKGIuZmxhZ3N8PTQxOTQzMDgpLGIubWVtb2l6ZWRQcm9wcz1kLGIubWVtb2l6ZWRTdGF0ZT1rKSxnLnByb3BzPWQsZy5zdGF0ZT1rLGcuY29udGV4dD1sLGQ9aCk6KCJmdW5jdGlvbiI9PT10eXBlb2YgZy5jb21wb25lbnREaWRNb3VudCYmKGIuZmxhZ3N8PTQxOTQzMDgpLGQ9ITEpfWVsc2V7Zz1iLnN0YXRlTm9kZTtiaChhLGIpO2g9Yi5tZW1vaXplZFByb3BzO2w9Yi50eXBlPT09Yi5lbGVtZW50VHlwZT9oOkxnKGIudHlwZSxoKTtnLnByb3BzPWw7cT1iLnBlbmRpbmdQcm9wcztyPWcuY29udGV4dDtrPWMuY29udGV4dFR5cGU7Im9iamVjdCI9PT10eXBlb2YgayYmbnVsbCE9PWs/az1WZyhrKTooaz1aZihjKT9YZjpILmN1cnJlbnQsaz1ZZihiLGspKTt2YXIgeT1jLmdldERlcml2ZWRTdGF0ZUZyb21Qcm9wczsobT0iZnVuY3Rpb24iPT09dHlwZW9mIHl8fCJmdW5jdGlvbiI9PT10eXBlb2YgZy5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZSl8fAoiZnVuY3Rpb24iIT09dHlwZW9mIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMmJiJmdW5jdGlvbiIhPT10eXBlb2YgZy5jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzfHwoaCE9PXF8fHIhPT1rKSYmcWgoYixnLGQsayk7JGc9ITE7cj1iLm1lbW9pemVkU3RhdGU7Zy5zdGF0ZT1yO2doKGIsZCxnLGUpO3ZhciBuPWIubWVtb2l6ZWRTdGF0ZTtoIT09cXx8ciE9PW58fFdmLmN1cnJlbnR8fCRnPygiZnVuY3Rpb24iPT09dHlwZW9mIHkmJihraChiLGMseSxkKSxuPWIubWVtb2l6ZWRTdGF0ZSksKGw9JGd8fG9oKGIsYyxsLGQscixuLGspfHwhMSk/KG18fCJmdW5jdGlvbiIhPT10eXBlb2YgZy5VTlNBRkVfY29tcG9uZW50V2lsbFVwZGF0ZSYmImZ1bmN0aW9uIiE9PXR5cGVvZiBnLmNvbXBvbmVudFdpbGxVcGRhdGV8fCgiZnVuY3Rpb24iPT09dHlwZW9mIGcuY29tcG9uZW50V2lsbFVwZGF0ZSYmZy5jb21wb25lbnRXaWxsVXBkYXRlKGQsbixrKSwiZnVuY3Rpb24iPT09dHlwZW9mIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxVcGRhdGUmJgpnLlVOU0FGRV9jb21wb25lbnRXaWxsVXBkYXRlKGQsbixrKSksImZ1bmN0aW9uIj09PXR5cGVvZiBnLmNvbXBvbmVudERpZFVwZGF0ZSYmKGIuZmxhZ3N8PTQpLCJmdW5jdGlvbiI9PT10eXBlb2YgZy5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZSYmKGIuZmxhZ3N8PTEwMjQpKTooImZ1bmN0aW9uIiE9PXR5cGVvZiBnLmNvbXBvbmVudERpZFVwZGF0ZXx8aD09PWEubWVtb2l6ZWRQcm9wcyYmcj09PWEubWVtb2l6ZWRTdGF0ZXx8KGIuZmxhZ3N8PTQpLCJmdW5jdGlvbiIhPT10eXBlb2YgZy5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZXx8aD09PWEubWVtb2l6ZWRQcm9wcyYmcj09PWEubWVtb2l6ZWRTdGF0ZXx8KGIuZmxhZ3N8PTEwMjQpLGIubWVtb2l6ZWRQcm9wcz1kLGIubWVtb2l6ZWRTdGF0ZT1uKSxnLnByb3BzPWQsZy5zdGF0ZT1uLGcuY29udGV4dD1rLGQ9bCk6KCJmdW5jdGlvbiIhPT10eXBlb2YgZy5jb21wb25lbnREaWRVcGRhdGV8fGg9PT1hLm1lbW9pemVkUHJvcHMmJnI9PT0KYS5tZW1vaXplZFN0YXRlfHwoYi5mbGFnc3w9NCksImZ1bmN0aW9uIiE9PXR5cGVvZiBnLmdldFNuYXBzaG90QmVmb3JlVXBkYXRlfHxoPT09YS5tZW1vaXplZFByb3BzJiZyPT09YS5tZW1vaXplZFN0YXRlfHwoYi5mbGFnc3w9MTAyNCksZD0hMSl9cmV0dXJuIGtqKGEsYixjLGQsZixlKX0KZnVuY3Rpb24ga2ooYSxiLGMsZCxlLGYpe2hqKGEsYik7dmFyIGc9MCE9PShiLmZsYWdzJjEyOCk7aWYoIWQmJiFnKXJldHVybiBlJiZkZyhiLGMsITEpLCRpKGEsYixmKTtkPWIuc3RhdGVOb2RlO1hpLmN1cnJlbnQ9Yjt2YXIgaD1nJiYiZnVuY3Rpb24iIT09dHlwZW9mIGMuZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yP251bGw6ZC5yZW5kZXIoKTtiLmZsYWdzfD0xO251bGwhPT1hJiZnPyhiLmNoaWxkPUJoKGIsYS5jaGlsZCxudWxsLGYpLGIuY2hpbGQ9QmgoYixudWxsLGgsZikpOllpKGEsYixoLGYpO2IubWVtb2l6ZWRTdGF0ZT1kLnN0YXRlO2UmJmRnKGIsYywhMCk7cmV0dXJuIGIuY2hpbGR9ZnVuY3Rpb24gbGooYSl7dmFyIGI9YS5zdGF0ZU5vZGU7Yi5wZW5kaW5nQ29udGV4dD9hZyhhLGIucGVuZGluZ0NvbnRleHQsYi5wZW5kaW5nQ29udGV4dCE9PWIuY29udGV4dCk6Yi5jb250ZXh0JiZhZyhhLGIuY29udGV4dCwhMSk7SWgoYSxiLmNvbnRhaW5lckluZm8pfQpmdW5jdGlvbiBtaihhLGIsYyxkLGUpe0lnKCk7SmcoZSk7Yi5mbGFnc3w9MjU2O1lpKGEsYixjLGQpO3JldHVybiBiLmNoaWxkfXZhciBuaj17ZGVoeWRyYXRlZDpudWxsLHRyZWVDb250ZXh0Om51bGwscmV0cnlMYW5lOjB9O2Z1bmN0aW9uIG9qKGEpe3JldHVybntiYXNlTGFuZXM6YSxjYWNoZVBvb2w6bnVsbCx0cmFuc2l0aW9uczpudWxsfX0KZnVuY3Rpb24gcGooYSxiLGMpe3ZhciBkPWIucGVuZGluZ1Byb3BzLGU9TS5jdXJyZW50LGY9ITEsZz0wIT09KGIuZmxhZ3MmMTI4KSxoOyhoPWcpfHwoaD1udWxsIT09YSYmbnVsbD09PWEubWVtb2l6ZWRTdGF0ZT8hMTowIT09KGUmMikpO2lmKGgpZj0hMCxiLmZsYWdzJj0tMTI5O2Vsc2UgaWYobnVsbD09PWF8fG51bGwhPT1hLm1lbW9pemVkU3RhdGUpZXw9MTtHKE0sZSYxKTtpZihudWxsPT09YSl7RWcoYik7YT1iLm1lbW9pemVkU3RhdGU7aWYobnVsbCE9PWEmJihhPWEuZGVoeWRyYXRlZCxudWxsIT09YSkpcmV0dXJuIDA9PT0oYi5tb2RlJjEpP2IubGFuZXM9MToiJCEiPT09YS5kYXRhP2IubGFuZXM9ODpiLmxhbmVzPTEwNzM3NDE4MjQsbnVsbDtnPWQuY2hpbGRyZW47YT1kLmZhbGxiYWNrO3JldHVybiBmPyhkPWIubW9kZSxmPWIuY2hpbGQsZz17bW9kZToiaGlkZGVuIixjaGlsZHJlbjpnfSwwPT09KGQmMSkmJm51bGwhPT1mPyhmLmNoaWxkTGFuZXM9MCxmLnBlbmRpbmdQcm9wcz0KZyk6Zj1xaihnLGQsMCxudWxsKSxhPUFoKGEsZCxjLG51bGwpLGYucmV0dXJuPWIsYS5yZXR1cm49YixmLnNpYmxpbmc9YSxiLmNoaWxkPWYsYi5jaGlsZC5tZW1vaXplZFN0YXRlPW9qKGMpLGIubWVtb2l6ZWRTdGF0ZT1uaixhKTpyaihiLGcpfWU9YS5tZW1vaXplZFN0YXRlO2lmKG51bGwhPT1lJiYoaD1lLmRlaHlkcmF0ZWQsbnVsbCE9PWgpKXJldHVybiBzaihhLGIsZyxkLGgsZSxjKTtpZihmKXtmPWQuZmFsbGJhY2s7Zz1iLm1vZGU7ZT1hLmNoaWxkO2g9ZS5zaWJsaW5nO3ZhciBrPXttb2RlOiJoaWRkZW4iLGNoaWxkcmVuOmQuY2hpbGRyZW59OzA9PT0oZyYxKSYmYi5jaGlsZCE9PWU/KGQ9Yi5jaGlsZCxkLmNoaWxkTGFuZXM9MCxkLnBlbmRpbmdQcm9wcz1rLGIuZGVsZXRpb25zPW51bGwpOihkPXdoKGUsayksZC5zdWJ0cmVlRmxhZ3M9ZS5zdWJ0cmVlRmxhZ3MmMTQ2ODAwNjQpO251bGwhPT1oP2Y9d2goaCxmKTooZj1BaChmLGcsYyxudWxsKSxmLmZsYWdzfD0yKTtmLnJldHVybj0KYjtkLnJldHVybj1iO2Quc2libGluZz1mO2IuY2hpbGQ9ZDtkPWY7Zj1iLmNoaWxkO2c9YS5jaGlsZC5tZW1vaXplZFN0YXRlO2c9bnVsbD09PWc/b2ooYyk6e2Jhc2VMYW5lczpnLmJhc2VMYW5lc3xjLGNhY2hlUG9vbDpudWxsLHRyYW5zaXRpb25zOmcudHJhbnNpdGlvbnN9O2YubWVtb2l6ZWRTdGF0ZT1nO2YuY2hpbGRMYW5lcz1hLmNoaWxkTGFuZXMmfmM7Yi5tZW1vaXplZFN0YXRlPW5qO3JldHVybiBkfWY9YS5jaGlsZDthPWYuc2libGluZztkPXdoKGYse21vZGU6InZpc2libGUiLGNoaWxkcmVuOmQuY2hpbGRyZW59KTswPT09KGIubW9kZSYxKSYmKGQubGFuZXM9Yyk7ZC5yZXR1cm49YjtkLnNpYmxpbmc9bnVsbDtudWxsIT09YSYmKGM9Yi5kZWxldGlvbnMsbnVsbD09PWM/KGIuZGVsZXRpb25zPVthXSxiLmZsYWdzfD0xNik6Yy5wdXNoKGEpKTtiLmNoaWxkPWQ7Yi5tZW1vaXplZFN0YXRlPW51bGw7cmV0dXJuIGR9CmZ1bmN0aW9uIHJqKGEsYil7Yj1xaih7bW9kZToidmlzaWJsZSIsY2hpbGRyZW46Yn0sYS5tb2RlLDAsbnVsbCk7Yi5yZXR1cm49YTtyZXR1cm4gYS5jaGlsZD1ifWZ1bmN0aW9uIHRqKGEsYixjLGQpe251bGwhPT1kJiZKZyhkKTtCaChiLGEuY2hpbGQsbnVsbCxjKTthPXJqKGIsYi5wZW5kaW5nUHJvcHMuY2hpbGRyZW4pO2EuZmxhZ3N8PTI7Yi5tZW1vaXplZFN0YXRlPW51bGw7cmV0dXJuIGF9CmZ1bmN0aW9uIHNqKGEsYixjLGQsZSxmLGcpe2lmKGMpe2lmKGIuZmxhZ3MmMjU2KXJldHVybiBiLmZsYWdzJj0tMjU3LGQ9TGkoRXJyb3IocCg0MjIpKSksdGooYSxiLGcsZCk7aWYobnVsbCE9PWIubWVtb2l6ZWRTdGF0ZSlyZXR1cm4gYi5jaGlsZD1hLmNoaWxkLGIuZmxhZ3N8PTEyOCxudWxsO2Y9ZC5mYWxsYmFjaztlPWIubW9kZTtkPXFqKHttb2RlOiJ2aXNpYmxlIixjaGlsZHJlbjpkLmNoaWxkcmVufSxlLDAsbnVsbCk7Zj1BaChmLGUsZyxudWxsKTtmLmZsYWdzfD0yO2QucmV0dXJuPWI7Zi5yZXR1cm49YjtkLnNpYmxpbmc9ZjtiLmNoaWxkPWQ7MCE9PShiLm1vZGUmMSkmJkJoKGIsYS5jaGlsZCxudWxsLGcpO2IuY2hpbGQubWVtb2l6ZWRTdGF0ZT1vaihnKTtiLm1lbW9pemVkU3RhdGU9bmo7cmV0dXJuIGZ9aWYoMD09PShiLm1vZGUmMSkpcmV0dXJuIHRqKGEsYixnLG51bGwpO2lmKCIkISI9PT1lLmRhdGEpe2Q9ZS5uZXh0U2libGluZyYmZS5uZXh0U2libGluZy5kYXRhc2V0OwppZihkKXZhciBoPWQuZGdzdDtkPWg7Zj1FcnJvcihwKDQxOSkpO2Q9TGkoZixkLHZvaWQgMCk7cmV0dXJuIHRqKGEsYixnLGQpfWg9MCE9PShnJmEuY2hpbGRMYW5lcyk7aWYoVWd8fGgpe2Q9UjtpZihudWxsIT09ZCl7c3dpdGNoKGcmLWcpe2Nhc2UgNDplPTI7YnJlYWs7Y2FzZSAxNjplPTg7YnJlYWs7Y2FzZSA2NDpjYXNlIDEyODpjYXNlIDI1NjpjYXNlIDUxMjpjYXNlIDEwMjQ6Y2FzZSAyMDQ4OmNhc2UgNDA5NjpjYXNlIDgxOTI6Y2FzZSAxNjM4NDpjYXNlIDMyNzY4OmNhc2UgNjU1MzY6Y2FzZSAxMzEwNzI6Y2FzZSAyNjIxNDQ6Y2FzZSA1MjQyODg6Y2FzZSAxMDQ4NTc2OmNhc2UgMjA5NzE1MjpjYXNlIDQxOTQzMDQ6Y2FzZSA4Mzg4NjA4OmNhc2UgMTY3NzcyMTY6Y2FzZSAzMzU1NDQzMjpjYXNlIDY3MTA4ODY0OmU9MzI7YnJlYWs7Y2FzZSA1MzY4NzA5MTI6ZT0yNjg0MzU0NTY7YnJlYWs7ZGVmYXVsdDplPTB9ZT0wIT09KGUmKGQuc3VzcGVuZGVkTGFuZXN8ZykpPzA6ZTsKMCE9PWUmJmUhPT1mLnJldHJ5TGFuZSYmKGYucmV0cnlMYW5lPWUsWmcoYSxlKSxtaChkLGEsZSwtMSkpfXVqKCk7ZD1MaShFcnJvcihwKDQyMSkpKTtyZXR1cm4gdGooYSxiLGcsZCl9aWYoIiQ/Ij09PWUuZGF0YSlyZXR1cm4gYi5mbGFnc3w9MTI4LGIuY2hpbGQ9YS5jaGlsZCxiPXZqLmJpbmQobnVsbCxhKSxlLl9yZWFjdFJldHJ5PWIsbnVsbDthPWYudHJlZUNvbnRleHQ7eWc9TGYoZS5uZXh0U2libGluZyk7eGc9YjtJPSEwO3pnPW51bGw7bnVsbCE9PWEmJihvZ1twZysrXT1yZyxvZ1twZysrXT1zZyxvZ1twZysrXT1xZyxyZz1hLmlkLHNnPWEub3ZlcmZsb3cscWc9Yik7Yj1yaihiLGQuY2hpbGRyZW4pO2IuZmxhZ3N8PTQwOTY7cmV0dXJuIGJ9ZnVuY3Rpb24gd2ooYSxiLGMpe2EubGFuZXN8PWI7dmFyIGQ9YS5hbHRlcm5hdGU7bnVsbCE9PWQmJihkLmxhbmVzfD1iKTtTZyhhLnJldHVybixiLGMpfQpmdW5jdGlvbiB4aihhLGIsYyxkLGUpe3ZhciBmPWEubWVtb2l6ZWRTdGF0ZTtudWxsPT09Zj9hLm1lbW9pemVkU3RhdGU9e2lzQmFja3dhcmRzOmIscmVuZGVyaW5nOm51bGwscmVuZGVyaW5nU3RhcnRUaW1lOjAsbGFzdDpkLHRhaWw6Yyx0YWlsTW9kZTplfTooZi5pc0JhY2t3YXJkcz1iLGYucmVuZGVyaW5nPW51bGwsZi5yZW5kZXJpbmdTdGFydFRpbWU9MCxmLmxhc3Q9ZCxmLnRhaWw9YyxmLnRhaWxNb2RlPWUpfQpmdW5jdGlvbiB5aihhLGIsYyl7dmFyIGQ9Yi5wZW5kaW5nUHJvcHMsZT1kLnJldmVhbE9yZGVyLGY9ZC50YWlsO1lpKGEsYixkLmNoaWxkcmVuLGMpO2Q9TS5jdXJyZW50O2lmKDAhPT0oZCYyKSlkPWQmMXwyLGIuZmxhZ3N8PTEyODtlbHNle2lmKG51bGwhPT1hJiYwIT09KGEuZmxhZ3MmMTI4KSlhOmZvcihhPWIuY2hpbGQ7bnVsbCE9PWE7KXtpZigxMz09PWEudGFnKW51bGwhPT1hLm1lbW9pemVkU3RhdGUmJndqKGEsYyxiKTtlbHNlIGlmKDE5PT09YS50YWcpd2ooYSxjLGIpO2Vsc2UgaWYobnVsbCE9PWEuY2hpbGQpe2EuY2hpbGQucmV0dXJuPWE7YT1hLmNoaWxkO2NvbnRpbnVlfWlmKGE9PT1iKWJyZWFrIGE7Zm9yKDtudWxsPT09YS5zaWJsaW5nOyl7aWYobnVsbD09PWEucmV0dXJufHxhLnJldHVybj09PWIpYnJlYWsgYTthPWEucmV0dXJufWEuc2libGluZy5yZXR1cm49YS5yZXR1cm47YT1hLnNpYmxpbmd9ZCY9MX1HKE0sZCk7aWYoMD09PShiLm1vZGUmMSkpYi5tZW1vaXplZFN0YXRlPQpudWxsO2Vsc2Ugc3dpdGNoKGUpe2Nhc2UgImZvcndhcmRzIjpjPWIuY2hpbGQ7Zm9yKGU9bnVsbDtudWxsIT09YzspYT1jLmFsdGVybmF0ZSxudWxsIT09YSYmbnVsbD09PU1oKGEpJiYoZT1jKSxjPWMuc2libGluZztjPWU7bnVsbD09PWM/KGU9Yi5jaGlsZCxiLmNoaWxkPW51bGwpOihlPWMuc2libGluZyxjLnNpYmxpbmc9bnVsbCk7eGooYiwhMSxlLGMsZik7YnJlYWs7Y2FzZSAiYmFja3dhcmRzIjpjPW51bGw7ZT1iLmNoaWxkO2ZvcihiLmNoaWxkPW51bGw7bnVsbCE9PWU7KXthPWUuYWx0ZXJuYXRlO2lmKG51bGwhPT1hJiZudWxsPT09TWgoYSkpe2IuY2hpbGQ9ZTticmVha31hPWUuc2libGluZztlLnNpYmxpbmc9YztjPWU7ZT1hfXhqKGIsITAsYyxudWxsLGYpO2JyZWFrO2Nhc2UgInRvZ2V0aGVyIjp4aihiLCExLG51bGwsbnVsbCx2b2lkIDApO2JyZWFrO2RlZmF1bHQ6Yi5tZW1vaXplZFN0YXRlPW51bGx9cmV0dXJuIGIuY2hpbGR9CmZ1bmN0aW9uIGpqKGEsYil7MD09PShiLm1vZGUmMSkmJm51bGwhPT1hJiYoYS5hbHRlcm5hdGU9bnVsbCxiLmFsdGVybmF0ZT1udWxsLGIuZmxhZ3N8PTIpfWZ1bmN0aW9uICRpKGEsYixjKXtudWxsIT09YSYmKGIuZGVwZW5kZW5jaWVzPWEuZGVwZW5kZW5jaWVzKTtoaHw9Yi5sYW5lcztpZigwPT09KGMmYi5jaGlsZExhbmVzKSlyZXR1cm4gbnVsbDtpZihudWxsIT09YSYmYi5jaGlsZCE9PWEuY2hpbGQpdGhyb3cgRXJyb3IocCgxNTMpKTtpZihudWxsIT09Yi5jaGlsZCl7YT1iLmNoaWxkO2M9d2goYSxhLnBlbmRpbmdQcm9wcyk7Yi5jaGlsZD1jO2ZvcihjLnJldHVybj1iO251bGwhPT1hLnNpYmxpbmc7KWE9YS5zaWJsaW5nLGM9Yy5zaWJsaW5nPXdoKGEsYS5wZW5kaW5nUHJvcHMpLGMucmV0dXJuPWI7Yy5zaWJsaW5nPW51bGx9cmV0dXJuIGIuY2hpbGR9CmZ1bmN0aW9uIHpqKGEsYixjKXtzd2l0Y2goYi50YWcpe2Nhc2UgMzpsaihiKTtJZygpO2JyZWFrO2Nhc2UgNTpLaChiKTticmVhaztjYXNlIDE6WmYoYi50eXBlKSYmY2coYik7YnJlYWs7Y2FzZSA0OkloKGIsYi5zdGF0ZU5vZGUuY29udGFpbmVySW5mbyk7YnJlYWs7Y2FzZSAxMDp2YXIgZD1iLnR5cGUuX2NvbnRleHQsZT1iLm1lbW9pemVkUHJvcHMudmFsdWU7RyhNZyxkLl9jdXJyZW50VmFsdWUpO2QuX2N1cnJlbnRWYWx1ZT1lO2JyZWFrO2Nhc2UgMTM6ZD1iLm1lbW9pemVkU3RhdGU7aWYobnVsbCE9PWQpe2lmKG51bGwhPT1kLmRlaHlkcmF0ZWQpcmV0dXJuIEcoTSxNLmN1cnJlbnQmMSksYi5mbGFnc3w9MTI4LG51bGw7aWYoMCE9PShjJmIuY2hpbGQuY2hpbGRMYW5lcykpcmV0dXJuIHBqKGEsYixjKTtHKE0sTS5jdXJyZW50JjEpO2E9JGkoYSxiLGMpO3JldHVybiBudWxsIT09YT9hLnNpYmxpbmc6bnVsbH1HKE0sTS5jdXJyZW50JjEpO2JyZWFrO2Nhc2UgMTk6ZD0wIT09KGMmCmIuY2hpbGRMYW5lcyk7aWYoMCE9PShhLmZsYWdzJjEyOCkpe2lmKGQpcmV0dXJuIHlqKGEsYixjKTtiLmZsYWdzfD0xMjh9ZT1iLm1lbW9pemVkU3RhdGU7bnVsbCE9PWUmJihlLnJlbmRlcmluZz1udWxsLGUudGFpbD1udWxsLGUubGFzdEVmZmVjdD1udWxsKTtHKE0sTS5jdXJyZW50KTtpZihkKWJyZWFrO2Vsc2UgcmV0dXJuIG51bGw7Y2FzZSAyMjpjYXNlIDIzOnJldHVybiBiLmxhbmVzPTAsZWooYSxiLGMpfXJldHVybiAkaShhLGIsYyl9dmFyIEFqLEJqLENqLERqOwpBaj1mdW5jdGlvbihhLGIpe2Zvcih2YXIgYz1iLmNoaWxkO251bGwhPT1jOyl7aWYoNT09PWMudGFnfHw2PT09Yy50YWcpYS5hcHBlbmRDaGlsZChjLnN0YXRlTm9kZSk7ZWxzZSBpZig0IT09Yy50YWcmJm51bGwhPT1jLmNoaWxkKXtjLmNoaWxkLnJldHVybj1jO2M9Yy5jaGlsZDtjb250aW51ZX1pZihjPT09YilicmVhaztmb3IoO251bGw9PT1jLnNpYmxpbmc7KXtpZihudWxsPT09Yy5yZXR1cm58fGMucmV0dXJuPT09YilyZXR1cm47Yz1jLnJldHVybn1jLnNpYmxpbmcucmV0dXJuPWMucmV0dXJuO2M9Yy5zaWJsaW5nfX07Qmo9ZnVuY3Rpb24oKXt9OwpDaj1mdW5jdGlvbihhLGIsYyxkKXt2YXIgZT1hLm1lbW9pemVkUHJvcHM7aWYoZSE9PWQpe2E9Yi5zdGF0ZU5vZGU7SGgoRWguY3VycmVudCk7dmFyIGY9bnVsbDtzd2l0Y2goYyl7Y2FzZSAiaW5wdXQiOmU9WWEoYSxlKTtkPVlhKGEsZCk7Zj1bXTticmVhaztjYXNlICJzZWxlY3QiOmU9QSh7fSxlLHt2YWx1ZTp2b2lkIDB9KTtkPUEoe30sZCx7dmFsdWU6dm9pZCAwfSk7Zj1bXTticmVhaztjYXNlICJ0ZXh0YXJlYSI6ZT1nYihhLGUpO2Q9Z2IoYSxkKTtmPVtdO2JyZWFrO2RlZmF1bHQ6ImZ1bmN0aW9uIiE9PXR5cGVvZiBlLm9uQ2xpY2smJiJmdW5jdGlvbiI9PT10eXBlb2YgZC5vbkNsaWNrJiYoYS5vbmNsaWNrPUJmKX11YihjLGQpO3ZhciBnO2M9bnVsbDtmb3IobCBpbiBlKWlmKCFkLmhhc093blByb3BlcnR5KGwpJiZlLmhhc093blByb3BlcnR5KGwpJiZudWxsIT1lW2xdKWlmKCJzdHlsZSI9PT1sKXt2YXIgaD1lW2xdO2ZvcihnIGluIGgpaC5oYXNPd25Qcm9wZXJ0eShnKSYmCihjfHwoYz17fSksY1tnXT0iIil9ZWxzZSJkYW5nZXJvdXNseVNldElubmVySFRNTCIhPT1sJiYiY2hpbGRyZW4iIT09bCYmInN1cHByZXNzQ29udGVudEVkaXRhYmxlV2FybmluZyIhPT1sJiYic3VwcHJlc3NIeWRyYXRpb25XYXJuaW5nIiE9PWwmJiJhdXRvRm9jdXMiIT09bCYmKGVhLmhhc093blByb3BlcnR5KGwpP2Z8fChmPVtdKTooZj1mfHxbXSkucHVzaChsLG51bGwpKTtmb3IobCBpbiBkKXt2YXIgaz1kW2xdO2g9bnVsbCE9ZT9lW2xdOnZvaWQgMDtpZihkLmhhc093blByb3BlcnR5KGwpJiZrIT09aCYmKG51bGwhPWt8fG51bGwhPWgpKWlmKCJzdHlsZSI9PT1sKWlmKGgpe2ZvcihnIGluIGgpIWguaGFzT3duUHJvcGVydHkoZyl8fGsmJmsuaGFzT3duUHJvcGVydHkoZyl8fChjfHwoYz17fSksY1tnXT0iIik7Zm9yKGcgaW4gaylrLmhhc093blByb3BlcnR5KGcpJiZoW2ddIT09a1tnXSYmKGN8fChjPXt9KSxjW2ddPWtbZ10pfWVsc2UgY3x8KGZ8fChmPVtdKSxmLnB1c2gobCwKYykpLGM9aztlbHNlImRhbmdlcm91c2x5U2V0SW5uZXJIVE1MIj09PWw/KGs9az9rLl9faHRtbDp2b2lkIDAsaD1oP2guX19odG1sOnZvaWQgMCxudWxsIT1rJiZoIT09ayYmKGY9Znx8W10pLnB1c2gobCxrKSk6ImNoaWxkcmVuIj09PWw/InN0cmluZyIhPT10eXBlb2YgayYmIm51bWJlciIhPT10eXBlb2Yga3x8KGY9Znx8W10pLnB1c2gobCwiIitrKToic3VwcHJlc3NDb250ZW50RWRpdGFibGVXYXJuaW5nIiE9PWwmJiJzdXBwcmVzc0h5ZHJhdGlvbldhcm5pbmciIT09bCYmKGVhLmhhc093blByb3BlcnR5KGwpPyhudWxsIT1rJiYib25TY3JvbGwiPT09bCYmRCgic2Nyb2xsIixhKSxmfHxoPT09a3x8KGY9W10pKTooZj1mfHxbXSkucHVzaChsLGspKX1jJiYoZj1mfHxbXSkucHVzaCgic3R5bGUiLGMpO3ZhciBsPWY7aWYoYi51cGRhdGVRdWV1ZT1sKWIuZmxhZ3N8PTR9fTtEaj1mdW5jdGlvbihhLGIsYyxkKXtjIT09ZCYmKGIuZmxhZ3N8PTQpfTsKZnVuY3Rpb24gRWooYSxiKXtpZighSSlzd2l0Y2goYS50YWlsTW9kZSl7Y2FzZSAiaGlkZGVuIjpiPWEudGFpbDtmb3IodmFyIGM9bnVsbDtudWxsIT09YjspbnVsbCE9PWIuYWx0ZXJuYXRlJiYoYz1iKSxiPWIuc2libGluZztudWxsPT09Yz9hLnRhaWw9bnVsbDpjLnNpYmxpbmc9bnVsbDticmVhaztjYXNlICJjb2xsYXBzZWQiOmM9YS50YWlsO2Zvcih2YXIgZD1udWxsO251bGwhPT1jOyludWxsIT09Yy5hbHRlcm5hdGUmJihkPWMpLGM9Yy5zaWJsaW5nO251bGw9PT1kP2J8fG51bGw9PT1hLnRhaWw/YS50YWlsPW51bGw6YS50YWlsLnNpYmxpbmc9bnVsbDpkLnNpYmxpbmc9bnVsbH19CmZ1bmN0aW9uIFMoYSl7dmFyIGI9bnVsbCE9PWEuYWx0ZXJuYXRlJiZhLmFsdGVybmF0ZS5jaGlsZD09PWEuY2hpbGQsYz0wLGQ9MDtpZihiKWZvcih2YXIgZT1hLmNoaWxkO251bGwhPT1lOyljfD1lLmxhbmVzfGUuY2hpbGRMYW5lcyxkfD1lLnN1YnRyZWVGbGFncyYxNDY4MDA2NCxkfD1lLmZsYWdzJjE0NjgwMDY0LGUucmV0dXJuPWEsZT1lLnNpYmxpbmc7ZWxzZSBmb3IoZT1hLmNoaWxkO251bGwhPT1lOyljfD1lLmxhbmVzfGUuY2hpbGRMYW5lcyxkfD1lLnN1YnRyZWVGbGFncyxkfD1lLmZsYWdzLGUucmV0dXJuPWEsZT1lLnNpYmxpbmc7YS5zdWJ0cmVlRmxhZ3N8PWQ7YS5jaGlsZExhbmVzPWM7cmV0dXJuIGJ9CmZ1bmN0aW9uIEZqKGEsYixjKXt2YXIgZD1iLnBlbmRpbmdQcm9wczt3ZyhiKTtzd2l0Y2goYi50YWcpe2Nhc2UgMjpjYXNlIDE2OmNhc2UgMTU6Y2FzZSAwOmNhc2UgMTE6Y2FzZSA3OmNhc2UgODpjYXNlIDEyOmNhc2UgOTpjYXNlIDE0OnJldHVybiBTKGIpLG51bGw7Y2FzZSAxOnJldHVybiBaZihiLnR5cGUpJiYkZigpLFMoYiksbnVsbDtjYXNlIDM6ZD1iLnN0YXRlTm9kZTtKaCgpO0UoV2YpO0UoSCk7T2goKTtkLnBlbmRpbmdDb250ZXh0JiYoZC5jb250ZXh0PWQucGVuZGluZ0NvbnRleHQsZC5wZW5kaW5nQ29udGV4dD1udWxsKTtpZihudWxsPT09YXx8bnVsbD09PWEuY2hpbGQpR2coYik/Yi5mbGFnc3w9NDpudWxsPT09YXx8YS5tZW1vaXplZFN0YXRlLmlzRGVoeWRyYXRlZCYmMD09PShiLmZsYWdzJjI1Nil8fChiLmZsYWdzfD0xMDI0LG51bGwhPT16ZyYmKEdqKHpnKSx6Zz1udWxsKSk7QmooYSxiKTtTKGIpO3JldHVybiBudWxsO2Nhc2UgNTpMaChiKTt2YXIgZT1IaChHaC5jdXJyZW50KTsKYz1iLnR5cGU7aWYobnVsbCE9PWEmJm51bGwhPWIuc3RhdGVOb2RlKUNqKGEsYixjLGQsZSksYS5yZWYhPT1iLnJlZiYmKGIuZmxhZ3N8PTUxMixiLmZsYWdzfD0yMDk3MTUyKTtlbHNle2lmKCFkKXtpZihudWxsPT09Yi5zdGF0ZU5vZGUpdGhyb3cgRXJyb3IocCgxNjYpKTtTKGIpO3JldHVybiBudWxsfWE9SGgoRWguY3VycmVudCk7aWYoR2coYikpe2Q9Yi5zdGF0ZU5vZGU7Yz1iLnR5cGU7dmFyIGY9Yi5tZW1vaXplZFByb3BzO2RbT2ZdPWI7ZFtQZl09ZjthPTAhPT0oYi5tb2RlJjEpO3N3aXRjaChjKXtjYXNlICJkaWFsb2ciOkQoImNhbmNlbCIsZCk7RCgiY2xvc2UiLGQpO2JyZWFrO2Nhc2UgImlmcmFtZSI6Y2FzZSAib2JqZWN0IjpjYXNlICJlbWJlZCI6RCgibG9hZCIsZCk7YnJlYWs7Y2FzZSAidmlkZW8iOmNhc2UgImF1ZGlvIjpmb3IoZT0wO2U8bGYubGVuZ3RoO2UrKylEKGxmW2VdLGQpO2JyZWFrO2Nhc2UgInNvdXJjZSI6RCgiZXJyb3IiLGQpO2JyZWFrO2Nhc2UgImltZyI6Y2FzZSAiaW1hZ2UiOmNhc2UgImxpbmsiOkQoImVycm9yIiwKZCk7RCgibG9hZCIsZCk7YnJlYWs7Y2FzZSAiZGV0YWlscyI6RCgidG9nZ2xlIixkKTticmVhaztjYXNlICJpbnB1dCI6WmEoZCxmKTtEKCJpbnZhbGlkIixkKTticmVhaztjYXNlICJzZWxlY3QiOmQuX3dyYXBwZXJTdGF0ZT17d2FzTXVsdGlwbGU6ISFmLm11bHRpcGxlfTtEKCJpbnZhbGlkIixkKTticmVhaztjYXNlICJ0ZXh0YXJlYSI6aGIoZCxmKSxEKCJpbnZhbGlkIixkKX11YihjLGYpO2U9bnVsbDtmb3IodmFyIGcgaW4gZilpZihmLmhhc093blByb3BlcnR5KGcpKXt2YXIgaD1mW2ddOyJjaGlsZHJlbiI9PT1nPyJzdHJpbmciPT09dHlwZW9mIGg/ZC50ZXh0Q29udGVudCE9PWgmJighMCE9PWYuc3VwcHJlc3NIeWRyYXRpb25XYXJuaW5nJiZBZihkLnRleHRDb250ZW50LGgsYSksZT1bImNoaWxkcmVuIixoXSk6Im51bWJlciI9PT10eXBlb2YgaCYmZC50ZXh0Q29udGVudCE9PSIiK2gmJighMCE9PWYuc3VwcHJlc3NIeWRyYXRpb25XYXJuaW5nJiZBZihkLnRleHRDb250ZW50LApoLGEpLGU9WyJjaGlsZHJlbiIsIiIraF0pOmVhLmhhc093blByb3BlcnR5KGcpJiZudWxsIT1oJiYib25TY3JvbGwiPT09ZyYmRCgic2Nyb2xsIixkKX1zd2l0Y2goYyl7Y2FzZSAiaW5wdXQiOlZhKGQpO2RiKGQsZiwhMCk7YnJlYWs7Y2FzZSAidGV4dGFyZWEiOlZhKGQpO2piKGQpO2JyZWFrO2Nhc2UgInNlbGVjdCI6Y2FzZSAib3B0aW9uIjpicmVhaztkZWZhdWx0OiJmdW5jdGlvbiI9PT10eXBlb2YgZi5vbkNsaWNrJiYoZC5vbmNsaWNrPUJmKX1kPWU7Yi51cGRhdGVRdWV1ZT1kO251bGwhPT1kJiYoYi5mbGFnc3w9NCl9ZWxzZXtnPTk9PT1lLm5vZGVUeXBlP2U6ZS5vd25lckRvY3VtZW50OyJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIj09PWEmJihhPWtiKGMpKTsiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCI9PT1hPyJzY3JpcHQiPT09Yz8oYT1nLmNyZWF0ZUVsZW1lbnQoImRpdiIpLGEuaW5uZXJIVE1MPSI8c2NyaXB0Plx4M2Mvc2NyaXB0PiIsYT1hLnJlbW92ZUNoaWxkKGEuZmlyc3RDaGlsZCkpOgoic3RyaW5nIj09PXR5cGVvZiBkLmlzP2E9Zy5jcmVhdGVFbGVtZW50KGMse2lzOmQuaXN9KTooYT1nLmNyZWF0ZUVsZW1lbnQoYyksInNlbGVjdCI9PT1jJiYoZz1hLGQubXVsdGlwbGU/Zy5tdWx0aXBsZT0hMDpkLnNpemUmJihnLnNpemU9ZC5zaXplKSkpOmE9Zy5jcmVhdGVFbGVtZW50TlMoYSxjKTthW09mXT1iO2FbUGZdPWQ7QWooYSxiLCExLCExKTtiLnN0YXRlTm9kZT1hO2E6e2c9dmIoYyxkKTtzd2l0Y2goYyl7Y2FzZSAiZGlhbG9nIjpEKCJjYW5jZWwiLGEpO0QoImNsb3NlIixhKTtlPWQ7YnJlYWs7Y2FzZSAiaWZyYW1lIjpjYXNlICJvYmplY3QiOmNhc2UgImVtYmVkIjpEKCJsb2FkIixhKTtlPWQ7YnJlYWs7Y2FzZSAidmlkZW8iOmNhc2UgImF1ZGlvIjpmb3IoZT0wO2U8bGYubGVuZ3RoO2UrKylEKGxmW2VdLGEpO2U9ZDticmVhaztjYXNlICJzb3VyY2UiOkQoImVycm9yIixhKTtlPWQ7YnJlYWs7Y2FzZSAiaW1nIjpjYXNlICJpbWFnZSI6Y2FzZSAibGluayI6RCgiZXJyb3IiLAphKTtEKCJsb2FkIixhKTtlPWQ7YnJlYWs7Y2FzZSAiZGV0YWlscyI6RCgidG9nZ2xlIixhKTtlPWQ7YnJlYWs7Y2FzZSAiaW5wdXQiOlphKGEsZCk7ZT1ZYShhLGQpO0QoImludmFsaWQiLGEpO2JyZWFrO2Nhc2UgIm9wdGlvbiI6ZT1kO2JyZWFrO2Nhc2UgInNlbGVjdCI6YS5fd3JhcHBlclN0YXRlPXt3YXNNdWx0aXBsZTohIWQubXVsdGlwbGV9O2U9QSh7fSxkLHt2YWx1ZTp2b2lkIDB9KTtEKCJpbnZhbGlkIixhKTticmVhaztjYXNlICJ0ZXh0YXJlYSI6aGIoYSxkKTtlPWdiKGEsZCk7RCgiaW52YWxpZCIsYSk7YnJlYWs7ZGVmYXVsdDplPWR9dWIoYyxlKTtoPWU7Zm9yKGYgaW4gaClpZihoLmhhc093blByb3BlcnR5KGYpKXt2YXIgaz1oW2ZdOyJzdHlsZSI9PT1mP3NiKGEsayk6ImRhbmdlcm91c2x5U2V0SW5uZXJIVE1MIj09PWY/KGs9az9rLl9faHRtbDp2b2lkIDAsbnVsbCE9ayYmbmIoYSxrKSk6ImNoaWxkcmVuIj09PWY/InN0cmluZyI9PT10eXBlb2Ygaz8oInRleHRhcmVhIiE9PQpjfHwiIiE9PWspJiZvYihhLGspOiJudW1iZXIiPT09dHlwZW9mIGsmJm9iKGEsIiIrayk6InN1cHByZXNzQ29udGVudEVkaXRhYmxlV2FybmluZyIhPT1mJiYic3VwcHJlc3NIeWRyYXRpb25XYXJuaW5nIiE9PWYmJiJhdXRvRm9jdXMiIT09ZiYmKGVhLmhhc093blByb3BlcnR5KGYpP251bGwhPWsmJiJvblNjcm9sbCI9PT1mJiZEKCJzY3JvbGwiLGEpOm51bGwhPWsmJnRhKGEsZixrLGcpKX1zd2l0Y2goYyl7Y2FzZSAiaW5wdXQiOlZhKGEpO2RiKGEsZCwhMSk7YnJlYWs7Y2FzZSAidGV4dGFyZWEiOlZhKGEpO2piKGEpO2JyZWFrO2Nhc2UgIm9wdGlvbiI6bnVsbCE9ZC52YWx1ZSYmYS5zZXRBdHRyaWJ1dGUoInZhbHVlIiwiIitTYShkLnZhbHVlKSk7YnJlYWs7Y2FzZSAic2VsZWN0IjphLm11bHRpcGxlPSEhZC5tdWx0aXBsZTtmPWQudmFsdWU7bnVsbCE9Zj9mYihhLCEhZC5tdWx0aXBsZSxmLCExKTpudWxsIT1kLmRlZmF1bHRWYWx1ZSYmZmIoYSwhIWQubXVsdGlwbGUsZC5kZWZhdWx0VmFsdWUsCiEwKTticmVhaztkZWZhdWx0OiJmdW5jdGlvbiI9PT10eXBlb2YgZS5vbkNsaWNrJiYoYS5vbmNsaWNrPUJmKX1zd2l0Y2goYyl7Y2FzZSAiYnV0dG9uIjpjYXNlICJpbnB1dCI6Y2FzZSAic2VsZWN0IjpjYXNlICJ0ZXh0YXJlYSI6ZD0hIWQuYXV0b0ZvY3VzO2JyZWFrIGE7Y2FzZSAiaW1nIjpkPSEwO2JyZWFrIGE7ZGVmYXVsdDpkPSExfX1kJiYoYi5mbGFnc3w9NCl9bnVsbCE9PWIucmVmJiYoYi5mbGFnc3w9NTEyLGIuZmxhZ3N8PTIwOTcxNTIpfVMoYik7cmV0dXJuIG51bGw7Y2FzZSA2OmlmKGEmJm51bGwhPWIuc3RhdGVOb2RlKURqKGEsYixhLm1lbW9pemVkUHJvcHMsZCk7ZWxzZXtpZigic3RyaW5nIiE9PXR5cGVvZiBkJiZudWxsPT09Yi5zdGF0ZU5vZGUpdGhyb3cgRXJyb3IocCgxNjYpKTtjPUhoKEdoLmN1cnJlbnQpO0hoKEVoLmN1cnJlbnQpO2lmKEdnKGIpKXtkPWIuc3RhdGVOb2RlO2M9Yi5tZW1vaXplZFByb3BzO2RbT2ZdPWI7aWYoZj1kLm5vZGVWYWx1ZSE9PWMpaWYoYT0KeGcsbnVsbCE9PWEpc3dpdGNoKGEudGFnKXtjYXNlIDM6QWYoZC5ub2RlVmFsdWUsYywwIT09KGEubW9kZSYxKSk7YnJlYWs7Y2FzZSA1OiEwIT09YS5tZW1vaXplZFByb3BzLnN1cHByZXNzSHlkcmF0aW9uV2FybmluZyYmQWYoZC5ub2RlVmFsdWUsYywwIT09KGEubW9kZSYxKSl9ZiYmKGIuZmxhZ3N8PTQpfWVsc2UgZD0oOT09PWMubm9kZVR5cGU/YzpjLm93bmVyRG9jdW1lbnQpLmNyZWF0ZVRleHROb2RlKGQpLGRbT2ZdPWIsYi5zdGF0ZU5vZGU9ZH1TKGIpO3JldHVybiBudWxsO2Nhc2UgMTM6RShNKTtkPWIubWVtb2l6ZWRTdGF0ZTtpZihudWxsPT09YXx8bnVsbCE9PWEubWVtb2l6ZWRTdGF0ZSYmbnVsbCE9PWEubWVtb2l6ZWRTdGF0ZS5kZWh5ZHJhdGVkKXtpZihJJiZudWxsIT09eWcmJjAhPT0oYi5tb2RlJjEpJiYwPT09KGIuZmxhZ3MmMTI4KSlIZygpLElnKCksYi5mbGFnc3w9OTg1NjAsZj0hMTtlbHNlIGlmKGY9R2coYiksbnVsbCE9PWQmJm51bGwhPT1kLmRlaHlkcmF0ZWQpe2lmKG51bGw9PT0KYSl7aWYoIWYpdGhyb3cgRXJyb3IocCgzMTgpKTtmPWIubWVtb2l6ZWRTdGF0ZTtmPW51bGwhPT1mP2YuZGVoeWRyYXRlZDpudWxsO2lmKCFmKXRocm93IEVycm9yKHAoMzE3KSk7ZltPZl09Yn1lbHNlIElnKCksMD09PShiLmZsYWdzJjEyOCkmJihiLm1lbW9pemVkU3RhdGU9bnVsbCksYi5mbGFnc3w9NDtTKGIpO2Y9ITF9ZWxzZSBudWxsIT09emcmJihHaih6Zyksemc9bnVsbCksZj0hMDtpZighZilyZXR1cm4gYi5mbGFncyY2NTUzNj9iOm51bGx9aWYoMCE9PShiLmZsYWdzJjEyOCkpcmV0dXJuIGIubGFuZXM9YyxiO2Q9bnVsbCE9PWQ7ZCE9PShudWxsIT09YSYmbnVsbCE9PWEubWVtb2l6ZWRTdGF0ZSkmJmQmJihiLmNoaWxkLmZsYWdzfD04MTkyLDAhPT0oYi5tb2RlJjEpJiYobnVsbD09PWF8fDAhPT0oTS5jdXJyZW50JjEpPzA9PT1UJiYoVD0zKTp1aigpKSk7bnVsbCE9PWIudXBkYXRlUXVldWUmJihiLmZsYWdzfD00KTtTKGIpO3JldHVybiBudWxsO2Nhc2UgNDpyZXR1cm4gSmgoKSwKQmooYSxiKSxudWxsPT09YSYmc2YoYi5zdGF0ZU5vZGUuY29udGFpbmVySW5mbyksUyhiKSxudWxsO2Nhc2UgMTA6cmV0dXJuIFJnKGIudHlwZS5fY29udGV4dCksUyhiKSxudWxsO2Nhc2UgMTc6cmV0dXJuIFpmKGIudHlwZSkmJiRmKCksUyhiKSxudWxsO2Nhc2UgMTk6RShNKTtmPWIubWVtb2l6ZWRTdGF0ZTtpZihudWxsPT09ZilyZXR1cm4gUyhiKSxudWxsO2Q9MCE9PShiLmZsYWdzJjEyOCk7Zz1mLnJlbmRlcmluZztpZihudWxsPT09ZylpZihkKUVqKGYsITEpO2Vsc2V7aWYoMCE9PVR8fG51bGwhPT1hJiYwIT09KGEuZmxhZ3MmMTI4KSlmb3IoYT1iLmNoaWxkO251bGwhPT1hOyl7Zz1NaChhKTtpZihudWxsIT09Zyl7Yi5mbGFnc3w9MTI4O0VqKGYsITEpO2Q9Zy51cGRhdGVRdWV1ZTtudWxsIT09ZCYmKGIudXBkYXRlUXVldWU9ZCxiLmZsYWdzfD00KTtiLnN1YnRyZWVGbGFncz0wO2Q9Yztmb3IoYz1iLmNoaWxkO251bGwhPT1jOylmPWMsYT1kLGYuZmxhZ3MmPTE0NjgwMDY2LApnPWYuYWx0ZXJuYXRlLG51bGw9PT1nPyhmLmNoaWxkTGFuZXM9MCxmLmxhbmVzPWEsZi5jaGlsZD1udWxsLGYuc3VidHJlZUZsYWdzPTAsZi5tZW1vaXplZFByb3BzPW51bGwsZi5tZW1vaXplZFN0YXRlPW51bGwsZi51cGRhdGVRdWV1ZT1udWxsLGYuZGVwZW5kZW5jaWVzPW51bGwsZi5zdGF0ZU5vZGU9bnVsbCk6KGYuY2hpbGRMYW5lcz1nLmNoaWxkTGFuZXMsZi5sYW5lcz1nLmxhbmVzLGYuY2hpbGQ9Zy5jaGlsZCxmLnN1YnRyZWVGbGFncz0wLGYuZGVsZXRpb25zPW51bGwsZi5tZW1vaXplZFByb3BzPWcubWVtb2l6ZWRQcm9wcyxmLm1lbW9pemVkU3RhdGU9Zy5tZW1vaXplZFN0YXRlLGYudXBkYXRlUXVldWU9Zy51cGRhdGVRdWV1ZSxmLnR5cGU9Zy50eXBlLGE9Zy5kZXBlbmRlbmNpZXMsZi5kZXBlbmRlbmNpZXM9bnVsbD09PWE/bnVsbDp7bGFuZXM6YS5sYW5lcyxmaXJzdENvbnRleHQ6YS5maXJzdENvbnRleHR9KSxjPWMuc2libGluZztHKE0sTS5jdXJyZW50JjF8Mik7cmV0dXJuIGIuY2hpbGR9YT0KYS5zaWJsaW5nfW51bGwhPT1mLnRhaWwmJkIoKT5IaiYmKGIuZmxhZ3N8PTEyOCxkPSEwLEVqKGYsITEpLGIubGFuZXM9NDE5NDMwNCl9ZWxzZXtpZighZClpZihhPU1oKGcpLG51bGwhPT1hKXtpZihiLmZsYWdzfD0xMjgsZD0hMCxjPWEudXBkYXRlUXVldWUsbnVsbCE9PWMmJihiLnVwZGF0ZVF1ZXVlPWMsYi5mbGFnc3w9NCksRWooZiwhMCksbnVsbD09PWYudGFpbCYmImhpZGRlbiI9PT1mLnRhaWxNb2RlJiYhZy5hbHRlcm5hdGUmJiFJKXJldHVybiBTKGIpLG51bGx9ZWxzZSAyKkIoKS1mLnJlbmRlcmluZ1N0YXJ0VGltZT5IaiYmMTA3Mzc0MTgyNCE9PWMmJihiLmZsYWdzfD0xMjgsZD0hMCxFaihmLCExKSxiLmxhbmVzPTQxOTQzMDQpO2YuaXNCYWNrd2FyZHM/KGcuc2libGluZz1iLmNoaWxkLGIuY2hpbGQ9Zyk6KGM9Zi5sYXN0LG51bGwhPT1jP2Muc2libGluZz1nOmIuY2hpbGQ9ZyxmLmxhc3Q9Zyl9aWYobnVsbCE9PWYudGFpbClyZXR1cm4gYj1mLnRhaWwsZi5yZW5kZXJpbmc9CmIsZi50YWlsPWIuc2libGluZyxmLnJlbmRlcmluZ1N0YXJ0VGltZT1CKCksYi5zaWJsaW5nPW51bGwsYz1NLmN1cnJlbnQsRyhNLGQ/YyYxfDI6YyYxKSxiO1MoYik7cmV0dXJuIG51bGw7Y2FzZSAyMjpjYXNlIDIzOnJldHVybiBJaigpLGQ9bnVsbCE9PWIubWVtb2l6ZWRTdGF0ZSxudWxsIT09YSYmbnVsbCE9PWEubWVtb2l6ZWRTdGF0ZSE9PWQmJihiLmZsYWdzfD04MTkyKSxkJiYwIT09KGIubW9kZSYxKT8wIT09KGdqJjEwNzM3NDE4MjQpJiYoUyhiKSxiLnN1YnRyZWVGbGFncyY2JiYoYi5mbGFnc3w9ODE5MikpOlMoYiksbnVsbDtjYXNlIDI0OnJldHVybiBudWxsO2Nhc2UgMjU6cmV0dXJuIG51bGx9dGhyb3cgRXJyb3IocCgxNTYsYi50YWcpKTt9CmZ1bmN0aW9uIEpqKGEsYil7d2coYik7c3dpdGNoKGIudGFnKXtjYXNlIDE6cmV0dXJuIFpmKGIudHlwZSkmJiRmKCksYT1iLmZsYWdzLGEmNjU1MzY/KGIuZmxhZ3M9YSYtNjU1Mzd8MTI4LGIpOm51bGw7Y2FzZSAzOnJldHVybiBKaCgpLEUoV2YpLEUoSCksT2goKSxhPWIuZmxhZ3MsMCE9PShhJjY1NTM2KSYmMD09PShhJjEyOCk/KGIuZmxhZ3M9YSYtNjU1Mzd8MTI4LGIpOm51bGw7Y2FzZSA1OnJldHVybiBMaChiKSxudWxsO2Nhc2UgMTM6RShNKTthPWIubWVtb2l6ZWRTdGF0ZTtpZihudWxsIT09YSYmbnVsbCE9PWEuZGVoeWRyYXRlZCl7aWYobnVsbD09PWIuYWx0ZXJuYXRlKXRocm93IEVycm9yKHAoMzQwKSk7SWcoKX1hPWIuZmxhZ3M7cmV0dXJuIGEmNjU1MzY/KGIuZmxhZ3M9YSYtNjU1Mzd8MTI4LGIpOm51bGw7Y2FzZSAxOTpyZXR1cm4gRShNKSxudWxsO2Nhc2UgNDpyZXR1cm4gSmgoKSxudWxsO2Nhc2UgMTA6cmV0dXJuIFJnKGIudHlwZS5fY29udGV4dCksbnVsbDtjYXNlIDIyOmNhc2UgMjM6cmV0dXJuIElqKCksCm51bGw7Y2FzZSAyNDpyZXR1cm4gbnVsbDtkZWZhdWx0OnJldHVybiBudWxsfX12YXIgS2o9ITEsVT0hMSxMaj0iZnVuY3Rpb24iPT09dHlwZW9mIFdlYWtTZXQ/V2Vha1NldDpTZXQsVj1udWxsO2Z1bmN0aW9uIE1qKGEsYil7dmFyIGM9YS5yZWY7aWYobnVsbCE9PWMpaWYoImZ1bmN0aW9uIj09PXR5cGVvZiBjKXRyeXtjKG51bGwpfWNhdGNoKGQpe1coYSxiLGQpfWVsc2UgYy5jdXJyZW50PW51bGx9ZnVuY3Rpb24gTmooYSxiLGMpe3RyeXtjKCl9Y2F0Y2goZCl7VyhhLGIsZCl9fXZhciBPaj0hMTsKZnVuY3Rpb24gUGooYSxiKXtDZj1kZDthPU1lKCk7aWYoTmUoYSkpe2lmKCJzZWxlY3Rpb25TdGFydCJpbiBhKXZhciBjPXtzdGFydDphLnNlbGVjdGlvblN0YXJ0LGVuZDphLnNlbGVjdGlvbkVuZH07ZWxzZSBhOntjPShjPWEub3duZXJEb2N1bWVudCkmJmMuZGVmYXVsdFZpZXd8fHdpbmRvdzt2YXIgZD1jLmdldFNlbGVjdGlvbiYmYy5nZXRTZWxlY3Rpb24oKTtpZihkJiYwIT09ZC5yYW5nZUNvdW50KXtjPWQuYW5jaG9yTm9kZTt2YXIgZT1kLmFuY2hvck9mZnNldCxmPWQuZm9jdXNOb2RlO2Q9ZC5mb2N1c09mZnNldDt0cnl7Yy5ub2RlVHlwZSxmLm5vZGVUeXBlfWNhdGNoKEYpe2M9bnVsbDticmVhayBhfXZhciBnPTAsaD0tMSxrPS0xLGw9MCxtPTAscT1hLHI9bnVsbDtiOmZvcig7Oyl7Zm9yKHZhciB5Ozspe3EhPT1jfHwwIT09ZSYmMyE9PXEubm9kZVR5cGV8fChoPWcrZSk7cSE9PWZ8fDAhPT1kJiYzIT09cS5ub2RlVHlwZXx8KGs9ZytkKTszPT09cS5ub2RlVHlwZSYmKGcrPQpxLm5vZGVWYWx1ZS5sZW5ndGgpO2lmKG51bGw9PT0oeT1xLmZpcnN0Q2hpbGQpKWJyZWFrO3I9cTtxPXl9Zm9yKDs7KXtpZihxPT09YSlicmVhayBiO3I9PT1jJiYrK2w9PT1lJiYoaD1nKTtyPT09ZiYmKyttPT09ZCYmKGs9Zyk7aWYobnVsbCE9PSh5PXEubmV4dFNpYmxpbmcpKWJyZWFrO3E9cjtyPXEucGFyZW50Tm9kZX1xPXl9Yz0tMT09PWh8fC0xPT09az9udWxsOntzdGFydDpoLGVuZDprfX1lbHNlIGM9bnVsbH1jPWN8fHtzdGFydDowLGVuZDowfX1lbHNlIGM9bnVsbDtEZj17Zm9jdXNlZEVsZW06YSxzZWxlY3Rpb25SYW5nZTpjfTtkZD0hMTtmb3IoVj1iO251bGwhPT1WOylpZihiPVYsYT1iLmNoaWxkLDAhPT0oYi5zdWJ0cmVlRmxhZ3MmMTAyOCkmJm51bGwhPT1hKWEucmV0dXJuPWIsVj1hO2Vsc2UgZm9yKDtudWxsIT09Vjspe2I9Vjt0cnl7dmFyIG49Yi5hbHRlcm5hdGU7aWYoMCE9PShiLmZsYWdzJjEwMjQpKXN3aXRjaChiLnRhZyl7Y2FzZSAwOmNhc2UgMTE6Y2FzZSAxNTpicmVhazsKY2FzZSAxOmlmKG51bGwhPT1uKXt2YXIgdD1uLm1lbW9pemVkUHJvcHMsSj1uLm1lbW9pemVkU3RhdGUseD1iLnN0YXRlTm9kZSx3PXguZ2V0U25hcHNob3RCZWZvcmVVcGRhdGUoYi5lbGVtZW50VHlwZT09PWIudHlwZT90OkxnKGIudHlwZSx0KSxKKTt4Ll9fcmVhY3RJbnRlcm5hbFNuYXBzaG90QmVmb3JlVXBkYXRlPXd9YnJlYWs7Y2FzZSAzOnZhciB1PWIuc3RhdGVOb2RlLmNvbnRhaW5lckluZm87MT09PXUubm9kZVR5cGU/dS50ZXh0Q29udGVudD0iIjo5PT09dS5ub2RlVHlwZSYmdS5kb2N1bWVudEVsZW1lbnQmJnUucmVtb3ZlQ2hpbGQodS5kb2N1bWVudEVsZW1lbnQpO2JyZWFrO2Nhc2UgNTpjYXNlIDY6Y2FzZSA0OmNhc2UgMTc6YnJlYWs7ZGVmYXVsdDp0aHJvdyBFcnJvcihwKDE2MykpO319Y2F0Y2goRil7VyhiLGIucmV0dXJuLEYpfWE9Yi5zaWJsaW5nO2lmKG51bGwhPT1hKXthLnJldHVybj1iLnJldHVybjtWPWE7YnJlYWt9Vj1iLnJldHVybn1uPU9qO09qPSExO3JldHVybiBufQpmdW5jdGlvbiBRaihhLGIsYyl7dmFyIGQ9Yi51cGRhdGVRdWV1ZTtkPW51bGwhPT1kP2QubGFzdEVmZmVjdDpudWxsO2lmKG51bGwhPT1kKXt2YXIgZT1kPWQubmV4dDtkb3tpZigoZS50YWcmYSk9PT1hKXt2YXIgZj1lLmRlc3Ryb3k7ZS5kZXN0cm95PXZvaWQgMDt2b2lkIDAhPT1mJiZOaihiLGMsZil9ZT1lLm5leHR9d2hpbGUoZSE9PWQpfX1mdW5jdGlvbiBSaihhLGIpe2I9Yi51cGRhdGVRdWV1ZTtiPW51bGwhPT1iP2IubGFzdEVmZmVjdDpudWxsO2lmKG51bGwhPT1iKXt2YXIgYz1iPWIubmV4dDtkb3tpZigoYy50YWcmYSk9PT1hKXt2YXIgZD1jLmNyZWF0ZTtjLmRlc3Ryb3k9ZCgpfWM9Yy5uZXh0fXdoaWxlKGMhPT1iKX19ZnVuY3Rpb24gU2ooYSl7dmFyIGI9YS5yZWY7aWYobnVsbCE9PWIpe3ZhciBjPWEuc3RhdGVOb2RlO3N3aXRjaChhLnRhZyl7Y2FzZSA1OmE9YzticmVhaztkZWZhdWx0OmE9Y30iZnVuY3Rpb24iPT09dHlwZW9mIGI/YihhKTpiLmN1cnJlbnQ9YX19CmZ1bmN0aW9uIFRqKGEpe3ZhciBiPWEuYWx0ZXJuYXRlO251bGwhPT1iJiYoYS5hbHRlcm5hdGU9bnVsbCxUaihiKSk7YS5jaGlsZD1udWxsO2EuZGVsZXRpb25zPW51bGw7YS5zaWJsaW5nPW51bGw7NT09PWEudGFnJiYoYj1hLnN0YXRlTm9kZSxudWxsIT09YiYmKGRlbGV0ZSBiW09mXSxkZWxldGUgYltQZl0sZGVsZXRlIGJbb2ZdLGRlbGV0ZSBiW1FmXSxkZWxldGUgYltSZl0pKTthLnN0YXRlTm9kZT1udWxsO2EucmV0dXJuPW51bGw7YS5kZXBlbmRlbmNpZXM9bnVsbDthLm1lbW9pemVkUHJvcHM9bnVsbDthLm1lbW9pemVkU3RhdGU9bnVsbDthLnBlbmRpbmdQcm9wcz1udWxsO2Euc3RhdGVOb2RlPW51bGw7YS51cGRhdGVRdWV1ZT1udWxsfWZ1bmN0aW9uIFVqKGEpe3JldHVybiA1PT09YS50YWd8fDM9PT1hLnRhZ3x8ND09PWEudGFnfQpmdW5jdGlvbiBWaihhKXthOmZvcig7Oyl7Zm9yKDtudWxsPT09YS5zaWJsaW5nOyl7aWYobnVsbD09PWEucmV0dXJufHxVaihhLnJldHVybikpcmV0dXJuIG51bGw7YT1hLnJldHVybn1hLnNpYmxpbmcucmV0dXJuPWEucmV0dXJuO2ZvcihhPWEuc2libGluZzs1IT09YS50YWcmJjYhPT1hLnRhZyYmMTghPT1hLnRhZzspe2lmKGEuZmxhZ3MmMiljb250aW51ZSBhO2lmKG51bGw9PT1hLmNoaWxkfHw0PT09YS50YWcpY29udGludWUgYTtlbHNlIGEuY2hpbGQucmV0dXJuPWEsYT1hLmNoaWxkfWlmKCEoYS5mbGFncyYyKSlyZXR1cm4gYS5zdGF0ZU5vZGV9fQpmdW5jdGlvbiBXaihhLGIsYyl7dmFyIGQ9YS50YWc7aWYoNT09PWR8fDY9PT1kKWE9YS5zdGF0ZU5vZGUsYj84PT09Yy5ub2RlVHlwZT9jLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGEsYik6Yy5pbnNlcnRCZWZvcmUoYSxiKTooOD09PWMubm9kZVR5cGU/KGI9Yy5wYXJlbnROb2RlLGIuaW5zZXJ0QmVmb3JlKGEsYykpOihiPWMsYi5hcHBlbmRDaGlsZChhKSksYz1jLl9yZWFjdFJvb3RDb250YWluZXIsbnVsbCE9PWMmJnZvaWQgMCE9PWN8fG51bGwhPT1iLm9uY2xpY2t8fChiLm9uY2xpY2s9QmYpKTtlbHNlIGlmKDQhPT1kJiYoYT1hLmNoaWxkLG51bGwhPT1hKSlmb3IoV2ooYSxiLGMpLGE9YS5zaWJsaW5nO251bGwhPT1hOylXaihhLGIsYyksYT1hLnNpYmxpbmd9CmZ1bmN0aW9uIFhqKGEsYixjKXt2YXIgZD1hLnRhZztpZig1PT09ZHx8Nj09PWQpYT1hLnN0YXRlTm9kZSxiP2MuaW5zZXJ0QmVmb3JlKGEsYik6Yy5hcHBlbmRDaGlsZChhKTtlbHNlIGlmKDQhPT1kJiYoYT1hLmNoaWxkLG51bGwhPT1hKSlmb3IoWGooYSxiLGMpLGE9YS5zaWJsaW5nO251bGwhPT1hOylYaihhLGIsYyksYT1hLnNpYmxpbmd9dmFyIFg9bnVsbCxZaj0hMTtmdW5jdGlvbiBaaihhLGIsYyl7Zm9yKGM9Yy5jaGlsZDtudWxsIT09YzspYWsoYSxiLGMpLGM9Yy5zaWJsaW5nfQpmdW5jdGlvbiBhayhhLGIsYyl7aWYobGMmJiJmdW5jdGlvbiI9PT10eXBlb2YgbGMub25Db21taXRGaWJlclVubW91bnQpdHJ5e2xjLm9uQ29tbWl0RmliZXJVbm1vdW50KGtjLGMpfWNhdGNoKGgpe31zd2l0Y2goYy50YWcpe2Nhc2UgNTpVfHxNaihjLGIpO2Nhc2UgNjp2YXIgZD1YLGU9WWo7WD1udWxsO1pqKGEsYixjKTtYPWQ7WWo9ZTtudWxsIT09WCYmKFlqPyhhPVgsYz1jLnN0YXRlTm9kZSw4PT09YS5ub2RlVHlwZT9hLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYyk6YS5yZW1vdmVDaGlsZChjKSk6WC5yZW1vdmVDaGlsZChjLnN0YXRlTm9kZSkpO2JyZWFrO2Nhc2UgMTg6bnVsbCE9PVgmJihZaj8oYT1YLGM9Yy5zdGF0ZU5vZGUsOD09PWEubm9kZVR5cGU/S2YoYS5wYXJlbnROb2RlLGMpOjE9PT1hLm5vZGVUeXBlJiZLZihhLGMpLGJkKGEpKTpLZihYLGMuc3RhdGVOb2RlKSk7YnJlYWs7Y2FzZSA0OmQ9WDtlPVlqO1g9Yy5zdGF0ZU5vZGUuY29udGFpbmVySW5mbztZaj0hMDsKWmooYSxiLGMpO1g9ZDtZaj1lO2JyZWFrO2Nhc2UgMDpjYXNlIDExOmNhc2UgMTQ6Y2FzZSAxNTppZighVSYmKGQ9Yy51cGRhdGVRdWV1ZSxudWxsIT09ZCYmKGQ9ZC5sYXN0RWZmZWN0LG51bGwhPT1kKSkpe2U9ZD1kLm5leHQ7ZG97dmFyIGY9ZSxnPWYuZGVzdHJveTtmPWYudGFnO3ZvaWQgMCE9PWcmJigwIT09KGYmMik/TmooYyxiLGcpOjAhPT0oZiY0KSYmTmooYyxiLGcpKTtlPWUubmV4dH13aGlsZShlIT09ZCl9WmooYSxiLGMpO2JyZWFrO2Nhc2UgMTppZighVSYmKE1qKGMsYiksZD1jLnN0YXRlTm9kZSwiZnVuY3Rpb24iPT09dHlwZW9mIGQuY29tcG9uZW50V2lsbFVubW91bnQpKXRyeXtkLnByb3BzPWMubWVtb2l6ZWRQcm9wcyxkLnN0YXRlPWMubWVtb2l6ZWRTdGF0ZSxkLmNvbXBvbmVudFdpbGxVbm1vdW50KCl9Y2F0Y2goaCl7VyhjLGIsaCl9WmooYSxiLGMpO2JyZWFrO2Nhc2UgMjE6WmooYSxiLGMpO2JyZWFrO2Nhc2UgMjI6Yy5tb2RlJjE/KFU9KGQ9VSl8fG51bGwhPT0KYy5tZW1vaXplZFN0YXRlLFpqKGEsYixjKSxVPWQpOlpqKGEsYixjKTticmVhaztkZWZhdWx0OlpqKGEsYixjKX19ZnVuY3Rpb24gYmsoYSl7dmFyIGI9YS51cGRhdGVRdWV1ZTtpZihudWxsIT09Yil7YS51cGRhdGVRdWV1ZT1udWxsO3ZhciBjPWEuc3RhdGVOb2RlO251bGw9PT1jJiYoYz1hLnN0YXRlTm9kZT1uZXcgTGopO2IuZm9yRWFjaChmdW5jdGlvbihiKXt2YXIgZD1jay5iaW5kKG51bGwsYSxiKTtjLmhhcyhiKXx8KGMuYWRkKGIpLGIudGhlbihkLGQpKX0pfX0KZnVuY3Rpb24gZGsoYSxiKXt2YXIgYz1iLmRlbGV0aW9ucztpZihudWxsIT09Yylmb3IodmFyIGQ9MDtkPGMubGVuZ3RoO2QrKyl7dmFyIGU9Y1tkXTt0cnl7dmFyIGY9YSxnPWIsaD1nO2E6Zm9yKDtudWxsIT09aDspe3N3aXRjaChoLnRhZyl7Y2FzZSA1Olg9aC5zdGF0ZU5vZGU7WWo9ITE7YnJlYWsgYTtjYXNlIDM6WD1oLnN0YXRlTm9kZS5jb250YWluZXJJbmZvO1lqPSEwO2JyZWFrIGE7Y2FzZSA0Olg9aC5zdGF0ZU5vZGUuY29udGFpbmVySW5mbztZaj0hMDticmVhayBhfWg9aC5yZXR1cm59aWYobnVsbD09PVgpdGhyb3cgRXJyb3IocCgxNjApKTthayhmLGcsZSk7WD1udWxsO1lqPSExO3ZhciBrPWUuYWx0ZXJuYXRlO251bGwhPT1rJiYoay5yZXR1cm49bnVsbCk7ZS5yZXR1cm49bnVsbH1jYXRjaChsKXtXKGUsYixsKX19aWYoYi5zdWJ0cmVlRmxhZ3MmMTI4NTQpZm9yKGI9Yi5jaGlsZDtudWxsIT09YjspZWsoYixhKSxiPWIuc2libGluZ30KZnVuY3Rpb24gZWsoYSxiKXt2YXIgYz1hLmFsdGVybmF0ZSxkPWEuZmxhZ3M7c3dpdGNoKGEudGFnKXtjYXNlIDA6Y2FzZSAxMTpjYXNlIDE0OmNhc2UgMTU6ZGsoYixhKTtmayhhKTtpZihkJjQpe3RyeXtRaigzLGEsYS5yZXR1cm4pLFJqKDMsYSl9Y2F0Y2godCl7VyhhLGEucmV0dXJuLHQpfXRyeXtRaig1LGEsYS5yZXR1cm4pfWNhdGNoKHQpe1coYSxhLnJldHVybix0KX19YnJlYWs7Y2FzZSAxOmRrKGIsYSk7ZmsoYSk7ZCY1MTImJm51bGwhPT1jJiZNaihjLGMucmV0dXJuKTticmVhaztjYXNlIDU6ZGsoYixhKTtmayhhKTtkJjUxMiYmbnVsbCE9PWMmJk1qKGMsYy5yZXR1cm4pO2lmKGEuZmxhZ3MmMzIpe3ZhciBlPWEuc3RhdGVOb2RlO3RyeXtvYihlLCIiKX1jYXRjaCh0KXtXKGEsYS5yZXR1cm4sdCl9fWlmKGQmNCYmKGU9YS5zdGF0ZU5vZGUsbnVsbCE9ZSkpe3ZhciBmPWEubWVtb2l6ZWRQcm9wcyxnPW51bGwhPT1jP2MubWVtb2l6ZWRQcm9wczpmLGg9YS50eXBlLGs9YS51cGRhdGVRdWV1ZTsKYS51cGRhdGVRdWV1ZT1udWxsO2lmKG51bGwhPT1rKXRyeXsiaW5wdXQiPT09aCYmInJhZGlvIj09PWYudHlwZSYmbnVsbCE9Zi5uYW1lJiZhYihlLGYpO3ZiKGgsZyk7dmFyIGw9dmIoaCxmKTtmb3IoZz0wO2c8ay5sZW5ndGg7Zys9Mil7dmFyIG09a1tnXSxxPWtbZysxXTsic3R5bGUiPT09bT9zYihlLHEpOiJkYW5nZXJvdXNseVNldElubmVySFRNTCI9PT1tP25iKGUscSk6ImNoaWxkcmVuIj09PW0/b2IoZSxxKTp0YShlLG0scSxsKX1zd2l0Y2goaCl7Y2FzZSAiaW5wdXQiOmJiKGUsZik7YnJlYWs7Y2FzZSAidGV4dGFyZWEiOmliKGUsZik7YnJlYWs7Y2FzZSAic2VsZWN0Ijp2YXIgcj1lLl93cmFwcGVyU3RhdGUud2FzTXVsdGlwbGU7ZS5fd3JhcHBlclN0YXRlLndhc011bHRpcGxlPSEhZi5tdWx0aXBsZTt2YXIgeT1mLnZhbHVlO251bGwhPXk/ZmIoZSwhIWYubXVsdGlwbGUseSwhMSk6ciE9PSEhZi5tdWx0aXBsZSYmKG51bGwhPWYuZGVmYXVsdFZhbHVlP2ZiKGUsISFmLm11bHRpcGxlLApmLmRlZmF1bHRWYWx1ZSwhMCk6ZmIoZSwhIWYubXVsdGlwbGUsZi5tdWx0aXBsZT9bXToiIiwhMSkpfWVbUGZdPWZ9Y2F0Y2godCl7VyhhLGEucmV0dXJuLHQpfX1icmVhaztjYXNlIDY6ZGsoYixhKTtmayhhKTtpZihkJjQpe2lmKG51bGw9PT1hLnN0YXRlTm9kZSl0aHJvdyBFcnJvcihwKDE2MikpO2U9YS5zdGF0ZU5vZGU7Zj1hLm1lbW9pemVkUHJvcHM7dHJ5e2Uubm9kZVZhbHVlPWZ9Y2F0Y2godCl7VyhhLGEucmV0dXJuLHQpfX1icmVhaztjYXNlIDM6ZGsoYixhKTtmayhhKTtpZihkJjQmJm51bGwhPT1jJiZjLm1lbW9pemVkU3RhdGUuaXNEZWh5ZHJhdGVkKXRyeXtiZChiLmNvbnRhaW5lckluZm8pfWNhdGNoKHQpe1coYSxhLnJldHVybix0KX1icmVhaztjYXNlIDQ6ZGsoYixhKTtmayhhKTticmVhaztjYXNlIDEzOmRrKGIsYSk7ZmsoYSk7ZT1hLmNoaWxkO2UuZmxhZ3MmODE5MiYmKGY9bnVsbCE9PWUubWVtb2l6ZWRTdGF0ZSxlLnN0YXRlTm9kZS5pc0hpZGRlbj1mLCFmfHwKbnVsbCE9PWUuYWx0ZXJuYXRlJiZudWxsIT09ZS5hbHRlcm5hdGUubWVtb2l6ZWRTdGF0ZXx8KGdrPUIoKSkpO2QmNCYmYmsoYSk7YnJlYWs7Y2FzZSAyMjptPW51bGwhPT1jJiZudWxsIT09Yy5tZW1vaXplZFN0YXRlO2EubW9kZSYxPyhVPShsPVUpfHxtLGRrKGIsYSksVT1sKTpkayhiLGEpO2ZrKGEpO2lmKGQmODE5Mil7bD1udWxsIT09YS5tZW1vaXplZFN0YXRlO2lmKChhLnN0YXRlTm9kZS5pc0hpZGRlbj1sKSYmIW0mJjAhPT0oYS5tb2RlJjEpKWZvcihWPWEsbT1hLmNoaWxkO251bGwhPT1tOyl7Zm9yKHE9Vj1tO251bGwhPT1WOyl7cj1WO3k9ci5jaGlsZDtzd2l0Y2goci50YWcpe2Nhc2UgMDpjYXNlIDExOmNhc2UgMTQ6Y2FzZSAxNTpRaig0LHIsci5yZXR1cm4pO2JyZWFrO2Nhc2UgMTpNaihyLHIucmV0dXJuKTt2YXIgbj1yLnN0YXRlTm9kZTtpZigiZnVuY3Rpb24iPT09dHlwZW9mIG4uY29tcG9uZW50V2lsbFVubW91bnQpe2Q9cjtjPXIucmV0dXJuO3RyeXtiPWQsbi5wcm9wcz0KYi5tZW1vaXplZFByb3BzLG4uc3RhdGU9Yi5tZW1vaXplZFN0YXRlLG4uY29tcG9uZW50V2lsbFVubW91bnQoKX1jYXRjaCh0KXtXKGQsYyx0KX19YnJlYWs7Y2FzZSA1Ok1qKHIsci5yZXR1cm4pO2JyZWFrO2Nhc2UgMjI6aWYobnVsbCE9PXIubWVtb2l6ZWRTdGF0ZSl7aGsocSk7Y29udGludWV9fW51bGwhPT15Pyh5LnJldHVybj1yLFY9eSk6aGsocSl9bT1tLnNpYmxpbmd9YTpmb3IobT1udWxsLHE9YTs7KXtpZig1PT09cS50YWcpe2lmKG51bGw9PT1tKXttPXE7dHJ5e2U9cS5zdGF0ZU5vZGUsbD8oZj1lLnN0eWxlLCJmdW5jdGlvbiI9PT10eXBlb2YgZi5zZXRQcm9wZXJ0eT9mLnNldFByb3BlcnR5KCJkaXNwbGF5Iiwibm9uZSIsImltcG9ydGFudCIpOmYuZGlzcGxheT0ibm9uZSIpOihoPXEuc3RhdGVOb2RlLGs9cS5tZW1vaXplZFByb3BzLnN0eWxlLGc9dm9pZCAwIT09ayYmbnVsbCE9PWsmJmsuaGFzT3duUHJvcGVydHkoImRpc3BsYXkiKT9rLmRpc3BsYXk6bnVsbCxoLnN0eWxlLmRpc3BsYXk9CnJiKCJkaXNwbGF5IixnKSl9Y2F0Y2godCl7VyhhLGEucmV0dXJuLHQpfX19ZWxzZSBpZig2PT09cS50YWcpe2lmKG51bGw9PT1tKXRyeXtxLnN0YXRlTm9kZS5ub2RlVmFsdWU9bD8iIjpxLm1lbW9pemVkUHJvcHN9Y2F0Y2godCl7VyhhLGEucmV0dXJuLHQpfX1lbHNlIGlmKCgyMiE9PXEudGFnJiYyMyE9PXEudGFnfHxudWxsPT09cS5tZW1vaXplZFN0YXRlfHxxPT09YSkmJm51bGwhPT1xLmNoaWxkKXtxLmNoaWxkLnJldHVybj1xO3E9cS5jaGlsZDtjb250aW51ZX1pZihxPT09YSlicmVhayBhO2Zvcig7bnVsbD09PXEuc2libGluZzspe2lmKG51bGw9PT1xLnJldHVybnx8cS5yZXR1cm49PT1hKWJyZWFrIGE7bT09PXEmJihtPW51bGwpO3E9cS5yZXR1cm59bT09PXEmJihtPW51bGwpO3Euc2libGluZy5yZXR1cm49cS5yZXR1cm47cT1xLnNpYmxpbmd9fWJyZWFrO2Nhc2UgMTk6ZGsoYixhKTtmayhhKTtkJjQmJmJrKGEpO2JyZWFrO2Nhc2UgMjE6YnJlYWs7ZGVmYXVsdDpkayhiLAphKSxmayhhKX19ZnVuY3Rpb24gZmsoYSl7dmFyIGI9YS5mbGFncztpZihiJjIpe3RyeXthOntmb3IodmFyIGM9YS5yZXR1cm47bnVsbCE9PWM7KXtpZihVaihjKSl7dmFyIGQ9YzticmVhayBhfWM9Yy5yZXR1cm59dGhyb3cgRXJyb3IocCgxNjApKTt9c3dpdGNoKGQudGFnKXtjYXNlIDU6dmFyIGU9ZC5zdGF0ZU5vZGU7ZC5mbGFncyYzMiYmKG9iKGUsIiIpLGQuZmxhZ3MmPS0zMyk7dmFyIGY9VmooYSk7WGooYSxmLGUpO2JyZWFrO2Nhc2UgMzpjYXNlIDQ6dmFyIGc9ZC5zdGF0ZU5vZGUuY29udGFpbmVySW5mbyxoPVZqKGEpO1dqKGEsaCxnKTticmVhaztkZWZhdWx0OnRocm93IEVycm9yKHAoMTYxKSk7fX1jYXRjaChrKXtXKGEsYS5yZXR1cm4sayl9YS5mbGFncyY9LTN9YiY0MDk2JiYoYS5mbGFncyY9LTQwOTcpfWZ1bmN0aW9uIGlrKGEsYixjKXtWPWE7amsoYSxiLGMpfQpmdW5jdGlvbiBqayhhLGIsYyl7Zm9yKHZhciBkPTAhPT0oYS5tb2RlJjEpO251bGwhPT1WOyl7dmFyIGU9VixmPWUuY2hpbGQ7aWYoMjI9PT1lLnRhZyYmZCl7dmFyIGc9bnVsbCE9PWUubWVtb2l6ZWRTdGF0ZXx8S2o7aWYoIWcpe3ZhciBoPWUuYWx0ZXJuYXRlLGs9bnVsbCE9PWgmJm51bGwhPT1oLm1lbW9pemVkU3RhdGV8fFU7aD1Lajt2YXIgbD1VO0tqPWc7aWYoKFU9aykmJiFsKWZvcihWPWU7bnVsbCE9PVY7KWc9VixrPWcuY2hpbGQsMjI9PT1nLnRhZyYmbnVsbCE9PWcubWVtb2l6ZWRTdGF0ZT9rayhlKTpudWxsIT09az8oay5yZXR1cm49ZyxWPWspOmtrKGUpO2Zvcig7bnVsbCE9PWY7KVY9ZixqayhmLGIsYyksZj1mLnNpYmxpbmc7Vj1lO0tqPWg7VT1sfWxrKGEsYixjKX1lbHNlIDAhPT0oZS5zdWJ0cmVlRmxhZ3MmODc3MikmJm51bGwhPT1mPyhmLnJldHVybj1lLFY9Zik6bGsoYSxiLGMpfX0KZnVuY3Rpb24gbGsoYSl7Zm9yKDtudWxsIT09Vjspe3ZhciBiPVY7aWYoMCE9PShiLmZsYWdzJjg3NzIpKXt2YXIgYz1iLmFsdGVybmF0ZTt0cnl7aWYoMCE9PShiLmZsYWdzJjg3NzIpKXN3aXRjaChiLnRhZyl7Y2FzZSAwOmNhc2UgMTE6Y2FzZSAxNTpVfHxSaig1LGIpO2JyZWFrO2Nhc2UgMTp2YXIgZD1iLnN0YXRlTm9kZTtpZihiLmZsYWdzJjQmJiFVKWlmKG51bGw9PT1jKWQuY29tcG9uZW50RGlkTW91bnQoKTtlbHNle3ZhciBlPWIuZWxlbWVudFR5cGU9PT1iLnR5cGU/Yy5tZW1vaXplZFByb3BzOkxnKGIudHlwZSxjLm1lbW9pemVkUHJvcHMpO2QuY29tcG9uZW50RGlkVXBkYXRlKGUsYy5tZW1vaXplZFN0YXRlLGQuX19yZWFjdEludGVybmFsU25hcHNob3RCZWZvcmVVcGRhdGUpfXZhciBmPWIudXBkYXRlUXVldWU7bnVsbCE9PWYmJmloKGIsZixkKTticmVhaztjYXNlIDM6dmFyIGc9Yi51cGRhdGVRdWV1ZTtpZihudWxsIT09Zyl7Yz1udWxsO2lmKG51bGwhPT1iLmNoaWxkKXN3aXRjaChiLmNoaWxkLnRhZyl7Y2FzZSA1OmM9CmIuY2hpbGQuc3RhdGVOb2RlO2JyZWFrO2Nhc2UgMTpjPWIuY2hpbGQuc3RhdGVOb2RlfWloKGIsZyxjKX1icmVhaztjYXNlIDU6dmFyIGg9Yi5zdGF0ZU5vZGU7aWYobnVsbD09PWMmJmIuZmxhZ3MmNCl7Yz1oO3ZhciBrPWIubWVtb2l6ZWRQcm9wcztzd2l0Y2goYi50eXBlKXtjYXNlICJidXR0b24iOmNhc2UgImlucHV0IjpjYXNlICJzZWxlY3QiOmNhc2UgInRleHRhcmVhIjprLmF1dG9Gb2N1cyYmYy5mb2N1cygpO2JyZWFrO2Nhc2UgImltZyI6ay5zcmMmJihjLnNyYz1rLnNyYyl9fWJyZWFrO2Nhc2UgNjpicmVhaztjYXNlIDQ6YnJlYWs7Y2FzZSAxMjpicmVhaztjYXNlIDEzOmlmKG51bGw9PT1iLm1lbW9pemVkU3RhdGUpe3ZhciBsPWIuYWx0ZXJuYXRlO2lmKG51bGwhPT1sKXt2YXIgbT1sLm1lbW9pemVkU3RhdGU7aWYobnVsbCE9PW0pe3ZhciBxPW0uZGVoeWRyYXRlZDtudWxsIT09cSYmYmQocSl9fX1icmVhaztjYXNlIDE5OmNhc2UgMTc6Y2FzZSAyMTpjYXNlIDIyOmNhc2UgMjM6Y2FzZSAyNTpicmVhazsKZGVmYXVsdDp0aHJvdyBFcnJvcihwKDE2MykpO31VfHxiLmZsYWdzJjUxMiYmU2ooYil9Y2F0Y2gocil7VyhiLGIucmV0dXJuLHIpfX1pZihiPT09YSl7Vj1udWxsO2JyZWFrfWM9Yi5zaWJsaW5nO2lmKG51bGwhPT1jKXtjLnJldHVybj1iLnJldHVybjtWPWM7YnJlYWt9Vj1iLnJldHVybn19ZnVuY3Rpb24gaGsoYSl7Zm9yKDtudWxsIT09Vjspe3ZhciBiPVY7aWYoYj09PWEpe1Y9bnVsbDticmVha312YXIgYz1iLnNpYmxpbmc7aWYobnVsbCE9PWMpe2MucmV0dXJuPWIucmV0dXJuO1Y9YzticmVha31WPWIucmV0dXJufX0KZnVuY3Rpb24ga2soYSl7Zm9yKDtudWxsIT09Vjspe3ZhciBiPVY7dHJ5e3N3aXRjaChiLnRhZyl7Y2FzZSAwOmNhc2UgMTE6Y2FzZSAxNTp2YXIgYz1iLnJldHVybjt0cnl7UmooNCxiKX1jYXRjaChrKXtXKGIsYyxrKX1icmVhaztjYXNlIDE6dmFyIGQ9Yi5zdGF0ZU5vZGU7aWYoImZ1bmN0aW9uIj09PXR5cGVvZiBkLmNvbXBvbmVudERpZE1vdW50KXt2YXIgZT1iLnJldHVybjt0cnl7ZC5jb21wb25lbnREaWRNb3VudCgpfWNhdGNoKGspe1coYixlLGspfX12YXIgZj1iLnJldHVybjt0cnl7U2ooYil9Y2F0Y2goayl7VyhiLGYsayl9YnJlYWs7Y2FzZSA1OnZhciBnPWIucmV0dXJuO3RyeXtTaihiKX1jYXRjaChrKXtXKGIsZyxrKX19fWNhdGNoKGspe1coYixiLnJldHVybixrKX1pZihiPT09YSl7Vj1udWxsO2JyZWFrfXZhciBoPWIuc2libGluZztpZihudWxsIT09aCl7aC5yZXR1cm49Yi5yZXR1cm47Vj1oO2JyZWFrfVY9Yi5yZXR1cm59fQp2YXIgbWs9TWF0aC5jZWlsLG5rPXVhLlJlYWN0Q3VycmVudERpc3BhdGNoZXIsb2s9dWEuUmVhY3RDdXJyZW50T3duZXIscGs9dWEuUmVhY3RDdXJyZW50QmF0Y2hDb25maWcsSz0wLFI9bnVsbCxZPW51bGwsWj0wLGdqPTAsZmo9VWYoMCksVD0wLHFrPW51bGwsaGg9MCxyaz0wLHNrPTAsdGs9bnVsbCx1az1udWxsLGdrPTAsSGo9SW5maW5pdHksdms9bnVsbCxQaT0hMSxRaT1udWxsLFNpPW51bGwsd2s9ITEseGs9bnVsbCx5az0wLHprPTAsQWs9bnVsbCxCaz0tMSxDaz0wO2Z1bmN0aW9uIEwoKXtyZXR1cm4gMCE9PShLJjYpP0IoKTotMSE9PUJrP0JrOkJrPUIoKX0KZnVuY3Rpb24gbGgoYSl7aWYoMD09PShhLm1vZGUmMSkpcmV0dXJuIDE7aWYoMCE9PShLJjIpJiYwIT09WilyZXR1cm4gWiYtWjtpZihudWxsIT09S2cudHJhbnNpdGlvbilyZXR1cm4gMD09PUNrJiYoQ2s9eWMoKSksQ2s7YT1DO2lmKDAhPT1hKXJldHVybiBhO2E9d2luZG93LmV2ZW50O2E9dm9pZCAwPT09YT8xNjpqZChhLnR5cGUpO3JldHVybiBhfWZ1bmN0aW9uIG1oKGEsYixjLGQpe2lmKDUwPHprKXRocm93IHprPTAsQWs9bnVsbCxFcnJvcihwKDE4NSkpO0FjKGEsYyxkKTtpZigwPT09KEsmMil8fGEhPT1SKWE9PT1SJiYoMD09PShLJjIpJiYocmt8PWMpLDQ9PT1UJiZEayhhLFopKSxFayhhLGQpLDE9PT1jJiYwPT09SyYmMD09PShiLm1vZGUmMSkmJihIaj1CKCkrNTAwLGZnJiZqZygpKX0KZnVuY3Rpb24gRWsoYSxiKXt2YXIgYz1hLmNhbGxiYWNrTm9kZTt3YyhhLGIpO3ZhciBkPXVjKGEsYT09PVI/WjowKTtpZigwPT09ZCludWxsIT09YyYmYmMoYyksYS5jYWxsYmFja05vZGU9bnVsbCxhLmNhbGxiYWNrUHJpb3JpdHk9MDtlbHNlIGlmKGI9ZCYtZCxhLmNhbGxiYWNrUHJpb3JpdHkhPT1iKXtudWxsIT1jJiZiYyhjKTtpZigxPT09YikwPT09YS50YWc/aWcoRmsuYmluZChudWxsLGEpKTpoZyhGay5iaW5kKG51bGwsYSkpLEpmKGZ1bmN0aW9uKCl7MD09PShLJjYpJiZqZygpfSksYz1udWxsO2Vsc2V7c3dpdGNoKERjKGQpKXtjYXNlIDE6Yz1mYzticmVhaztjYXNlIDQ6Yz1nYzticmVhaztjYXNlIDE2OmM9aGM7YnJlYWs7Y2FzZSA1MzY4NzA5MTI6Yz1qYzticmVhaztkZWZhdWx0OmM9aGN9Yz1HayhjLEhrLmJpbmQobnVsbCxhKSl9YS5jYWxsYmFja1ByaW9yaXR5PWI7YS5jYWxsYmFja05vZGU9Y319CmZ1bmN0aW9uIEhrKGEsYil7Qms9LTE7Q2s9MDtpZigwIT09KEsmNikpdGhyb3cgRXJyb3IocCgzMjcpKTt2YXIgYz1hLmNhbGxiYWNrTm9kZTtpZihJaygpJiZhLmNhbGxiYWNrTm9kZSE9PWMpcmV0dXJuIG51bGw7dmFyIGQ9dWMoYSxhPT09Uj9aOjApO2lmKDA9PT1kKXJldHVybiBudWxsO2lmKDAhPT0oZCYzMCl8fDAhPT0oZCZhLmV4cGlyZWRMYW5lcyl8fGIpYj1KayhhLGQpO2Vsc2V7Yj1kO3ZhciBlPUs7S3w9Mjt2YXIgZj1LaygpO2lmKFIhPT1hfHxaIT09Yil2az1udWxsLEhqPUIoKSs1MDAsTGsoYSxiKTtkbyB0cnl7TWsoKTticmVha31jYXRjaChoKXtOayhhLGgpfXdoaWxlKDEpO1FnKCk7bmsuY3VycmVudD1mO0s9ZTtudWxsIT09WT9iPTA6KFI9bnVsbCxaPTAsYj1UKX1pZigwIT09Yil7Mj09PWImJihlPXhjKGEpLDAhPT1lJiYoZD1lLGI9T2soYSxlKSkpO2lmKDE9PT1iKXRocm93IGM9cWssTGsoYSwwKSxEayhhLGQpLEVrKGEsQigpKSxjO2lmKDY9PT1iKURrKGEsZCk7CmVsc2V7ZT1hLmN1cnJlbnQuYWx0ZXJuYXRlO2lmKDA9PT0oZCYzMCkmJiFQayhlKSYmKGI9SmsoYSxkKSwyPT09YiYmKGY9eGMoYSksMCE9PWYmJihkPWYsYj1PayhhLGYpKSksMT09PWIpKXRocm93IGM9cWssTGsoYSwwKSxEayhhLGQpLEVrKGEsQigpKSxjO2EuZmluaXNoZWRXb3JrPWU7YS5maW5pc2hlZExhbmVzPWQ7c3dpdGNoKGIpe2Nhc2UgMDpjYXNlIDE6dGhyb3cgRXJyb3IocCgzNDUpKTtjYXNlIDI6UWsoYSx1ayx2ayk7YnJlYWs7Y2FzZSAzOkRrKGEsZCk7aWYoKGQmMTMwMDIzNDI0KT09PWQmJihiPWdrKzUwMC1CKCksMTA8Yikpe2lmKDAhPT11YyhhLDApKWJyZWFrO2U9YS5zdXNwZW5kZWRMYW5lcztpZigoZSZkKSE9PWQpe0woKTthLnBpbmdlZExhbmVzfD1hLnN1c3BlbmRlZExhbmVzJmU7YnJlYWt9YS50aW1lb3V0SGFuZGxlPUZmKFFrLmJpbmQobnVsbCxhLHVrLHZrKSxiKTticmVha31RayhhLHVrLHZrKTticmVhaztjYXNlIDQ6RGsoYSxkKTtpZigoZCY0MTk0MjQwKT09PQpkKWJyZWFrO2I9YS5ldmVudFRpbWVzO2ZvcihlPS0xOzA8ZDspe3ZhciBnPTMxLW9jKGQpO2Y9MTw8ZztnPWJbZ107Zz5lJiYoZT1nKTtkJj1+Zn1kPWU7ZD1CKCktZDtkPSgxMjA+ZD8xMjA6NDgwPmQ/NDgwOjEwODA+ZD8xMDgwOjE5MjA+ZD8xOTIwOjNFMz5kPzNFMzo0MzIwPmQ/NDMyMDoxOTYwKm1rKGQvMTk2MCkpLWQ7aWYoMTA8ZCl7YS50aW1lb3V0SGFuZGxlPUZmKFFrLmJpbmQobnVsbCxhLHVrLHZrKSxkKTticmVha31RayhhLHVrLHZrKTticmVhaztjYXNlIDU6UWsoYSx1ayx2ayk7YnJlYWs7ZGVmYXVsdDp0aHJvdyBFcnJvcihwKDMyOSkpO319fUVrKGEsQigpKTtyZXR1cm4gYS5jYWxsYmFja05vZGU9PT1jP0hrLmJpbmQobnVsbCxhKTpudWxsfQpmdW5jdGlvbiBPayhhLGIpe3ZhciBjPXRrO2EuY3VycmVudC5tZW1vaXplZFN0YXRlLmlzRGVoeWRyYXRlZCYmKExrKGEsYikuZmxhZ3N8PTI1Nik7YT1KayhhLGIpOzIhPT1hJiYoYj11ayx1az1jLG51bGwhPT1iJiZHaihiKSk7cmV0dXJuIGF9ZnVuY3Rpb24gR2ooYSl7bnVsbD09PXVrP3VrPWE6dWsucHVzaC5hcHBseSh1ayxhKX0KZnVuY3Rpb24gUGsoYSl7Zm9yKHZhciBiPWE7Oyl7aWYoYi5mbGFncyYxNjM4NCl7dmFyIGM9Yi51cGRhdGVRdWV1ZTtpZihudWxsIT09YyYmKGM9Yy5zdG9yZXMsbnVsbCE9PWMpKWZvcih2YXIgZD0wO2Q8Yy5sZW5ndGg7ZCsrKXt2YXIgZT1jW2RdLGY9ZS5nZXRTbmFwc2hvdDtlPWUudmFsdWU7dHJ5e2lmKCFIZShmKCksZSkpcmV0dXJuITF9Y2F0Y2goZyl7cmV0dXJuITF9fX1jPWIuY2hpbGQ7aWYoYi5zdWJ0cmVlRmxhZ3MmMTYzODQmJm51bGwhPT1jKWMucmV0dXJuPWIsYj1jO2Vsc2V7aWYoYj09PWEpYnJlYWs7Zm9yKDtudWxsPT09Yi5zaWJsaW5nOyl7aWYobnVsbD09PWIucmV0dXJufHxiLnJldHVybj09PWEpcmV0dXJuITA7Yj1iLnJldHVybn1iLnNpYmxpbmcucmV0dXJuPWIucmV0dXJuO2I9Yi5zaWJsaW5nfX1yZXR1cm4hMH0KZnVuY3Rpb24gRGsoYSxiKXtiJj1+c2s7YiY9fnJrO2Euc3VzcGVuZGVkTGFuZXN8PWI7YS5waW5nZWRMYW5lcyY9fmI7Zm9yKGE9YS5leHBpcmF0aW9uVGltZXM7MDxiOyl7dmFyIGM9MzEtb2MoYiksZD0xPDxjO2FbY109LTE7YiY9fmR9fWZ1bmN0aW9uIEZrKGEpe2lmKDAhPT0oSyY2KSl0aHJvdyBFcnJvcihwKDMyNykpO0lrKCk7dmFyIGI9dWMoYSwwKTtpZigwPT09KGImMSkpcmV0dXJuIEVrKGEsQigpKSxudWxsO3ZhciBjPUprKGEsYik7aWYoMCE9PWEudGFnJiYyPT09Yyl7dmFyIGQ9eGMoYSk7MCE9PWQmJihiPWQsYz1PayhhLGQpKX1pZigxPT09Yyl0aHJvdyBjPXFrLExrKGEsMCksRGsoYSxiKSxFayhhLEIoKSksYztpZig2PT09Yyl0aHJvdyBFcnJvcihwKDM0NSkpO2EuZmluaXNoZWRXb3JrPWEuY3VycmVudC5hbHRlcm5hdGU7YS5maW5pc2hlZExhbmVzPWI7UWsoYSx1ayx2ayk7RWsoYSxCKCkpO3JldHVybiBudWxsfQpmdW5jdGlvbiBSayhhLGIpe3ZhciBjPUs7S3w9MTt0cnl7cmV0dXJuIGEoYil9ZmluYWxseXtLPWMsMD09PUsmJihIaj1CKCkrNTAwLGZnJiZqZygpKX19ZnVuY3Rpb24gU2soYSl7bnVsbCE9PXhrJiYwPT09eGsudGFnJiYwPT09KEsmNikmJklrKCk7dmFyIGI9SztLfD0xO3ZhciBjPXBrLnRyYW5zaXRpb24sZD1DO3RyeXtpZihway50cmFuc2l0aW9uPW51bGwsQz0xLGEpcmV0dXJuIGEoKX1maW5hbGx5e0M9ZCxway50cmFuc2l0aW9uPWMsSz1iLDA9PT0oSyY2KSYmamcoKX19ZnVuY3Rpb24gSWooKXtnaj1mai5jdXJyZW50O0UoZmopfQpmdW5jdGlvbiBMayhhLGIpe2EuZmluaXNoZWRXb3JrPW51bGw7YS5maW5pc2hlZExhbmVzPTA7dmFyIGM9YS50aW1lb3V0SGFuZGxlOy0xIT09YyYmKGEudGltZW91dEhhbmRsZT0tMSxHZihjKSk7aWYobnVsbCE9PVkpZm9yKGM9WS5yZXR1cm47bnVsbCE9PWM7KXt2YXIgZD1jO3dnKGQpO3N3aXRjaChkLnRhZyl7Y2FzZSAxOmQ9ZC50eXBlLmNoaWxkQ29udGV4dFR5cGVzO251bGwhPT1kJiZ2b2lkIDAhPT1kJiYkZigpO2JyZWFrO2Nhc2UgMzpKaCgpO0UoV2YpO0UoSCk7T2goKTticmVhaztjYXNlIDU6TGgoZCk7YnJlYWs7Y2FzZSA0OkpoKCk7YnJlYWs7Y2FzZSAxMzpFKE0pO2JyZWFrO2Nhc2UgMTk6RShNKTticmVhaztjYXNlIDEwOlJnKGQudHlwZS5fY29udGV4dCk7YnJlYWs7Y2FzZSAyMjpjYXNlIDIzOklqKCl9Yz1jLnJldHVybn1SPWE7WT1hPXdoKGEuY3VycmVudCxudWxsKTtaPWdqPWI7VD0wO3FrPW51bGw7c2s9cms9aGg9MDt1az10az1udWxsO2lmKG51bGwhPT1XZyl7Zm9yKGI9CjA7YjxXZy5sZW5ndGg7YisrKWlmKGM9V2dbYl0sZD1jLmludGVybGVhdmVkLG51bGwhPT1kKXtjLmludGVybGVhdmVkPW51bGw7dmFyIGU9ZC5uZXh0LGY9Yy5wZW5kaW5nO2lmKG51bGwhPT1mKXt2YXIgZz1mLm5leHQ7Zi5uZXh0PWU7ZC5uZXh0PWd9Yy5wZW5kaW5nPWR9V2c9bnVsbH1yZXR1cm4gYX0KZnVuY3Rpb24gTmsoYSxiKXtkb3t2YXIgYz1ZO3RyeXtRZygpO1BoLmN1cnJlbnQ9YWk7aWYoU2gpe2Zvcih2YXIgZD1OLm1lbW9pemVkU3RhdGU7bnVsbCE9PWQ7KXt2YXIgZT1kLnF1ZXVlO251bGwhPT1lJiYoZS5wZW5kaW5nPW51bGwpO2Q9ZC5uZXh0fVNoPSExfVJoPTA7UD1PPU49bnVsbDtUaD0hMTtVaD0wO29rLmN1cnJlbnQ9bnVsbDtpZihudWxsPT09Y3x8bnVsbD09PWMucmV0dXJuKXtUPTE7cWs9YjtZPW51bGw7YnJlYWt9YTp7dmFyIGY9YSxnPWMucmV0dXJuLGg9YyxrPWI7Yj1aO2guZmxhZ3N8PTMyNzY4O2lmKG51bGwhPT1rJiYib2JqZWN0Ij09PXR5cGVvZiBrJiYiZnVuY3Rpb24iPT09dHlwZW9mIGsudGhlbil7dmFyIGw9ayxtPWgscT1tLnRhZztpZigwPT09KG0ubW9kZSYxKSYmKDA9PT1xfHwxMT09PXF8fDE1PT09cSkpe3ZhciByPW0uYWx0ZXJuYXRlO3I/KG0udXBkYXRlUXVldWU9ci51cGRhdGVRdWV1ZSxtLm1lbW9pemVkU3RhdGU9ci5tZW1vaXplZFN0YXRlLAptLmxhbmVzPXIubGFuZXMpOihtLnVwZGF0ZVF1ZXVlPW51bGwsbS5tZW1vaXplZFN0YXRlPW51bGwpfXZhciB5PVZpKGcpO2lmKG51bGwhPT15KXt5LmZsYWdzJj0tMjU3O1dpKHksZyxoLGYsYik7eS5tb2RlJjEmJlRpKGYsbCxiKTtiPXk7az1sO3ZhciBuPWIudXBkYXRlUXVldWU7aWYobnVsbD09PW4pe3ZhciB0PW5ldyBTZXQ7dC5hZGQoayk7Yi51cGRhdGVRdWV1ZT10fWVsc2Ugbi5hZGQoayk7YnJlYWsgYX1lbHNle2lmKDA9PT0oYiYxKSl7VGkoZixsLGIpO3VqKCk7YnJlYWsgYX1rPUVycm9yKHAoNDI2KSl9fWVsc2UgaWYoSSYmaC5tb2RlJjEpe3ZhciBKPVZpKGcpO2lmKG51bGwhPT1KKXswPT09KEouZmxhZ3MmNjU1MzYpJiYoSi5mbGFnc3w9MjU2KTtXaShKLGcsaCxmLGIpO0pnKEtpKGssaCkpO2JyZWFrIGF9fWY9az1LaShrLGgpOzQhPT1UJiYoVD0yKTtudWxsPT09dGs/dGs9W2ZdOnRrLnB1c2goZik7Zj1nO2Rve3N3aXRjaChmLnRhZyl7Y2FzZSAzOmYuZmxhZ3N8PTY1NTM2OwpiJj0tYjtmLmxhbmVzfD1iO3ZhciB4PU9pKGYsayxiKTtmaChmLHgpO2JyZWFrIGE7Y2FzZSAxOmg9azt2YXIgdz1mLnR5cGUsdT1mLnN0YXRlTm9kZTtpZigwPT09KGYuZmxhZ3MmMTI4KSYmKCJmdW5jdGlvbiI9PT10eXBlb2Ygdy5nZXREZXJpdmVkU3RhdGVGcm9tRXJyb3J8fG51bGwhPT11JiYiZnVuY3Rpb24iPT09dHlwZW9mIHUuY29tcG9uZW50RGlkQ2F0Y2gmJihudWxsPT09U2l8fCFTaS5oYXModSkpKSl7Zi5mbGFnc3w9NjU1MzY7YiY9LWI7Zi5sYW5lc3w9Yjt2YXIgRj1SaShmLGgsYik7ZmgoZixGKTticmVhayBhfX1mPWYucmV0dXJufXdoaWxlKG51bGwhPT1mKX1UayhjKX1jYXRjaChuYSl7Yj1uYTtZPT09YyYmbnVsbCE9PWMmJihZPWM9Yy5yZXR1cm4pO2NvbnRpbnVlfWJyZWFrfXdoaWxlKDEpfWZ1bmN0aW9uIEtrKCl7dmFyIGE9bmsuY3VycmVudDtuay5jdXJyZW50PWFpO3JldHVybiBudWxsPT09YT9haTphfQpmdW5jdGlvbiB1aigpe2lmKDA9PT1UfHwzPT09VHx8Mj09PVQpVD00O251bGw9PT1SfHwwPT09KGhoJjI2ODQzNTQ1NSkmJjA9PT0ocmsmMjY4NDM1NDU1KXx8RGsoUixaKX1mdW5jdGlvbiBKayhhLGIpe3ZhciBjPUs7S3w9Mjt2YXIgZD1LaygpO2lmKFIhPT1hfHxaIT09Yil2az1udWxsLExrKGEsYik7ZG8gdHJ5e1VrKCk7YnJlYWt9Y2F0Y2goZSl7TmsoYSxlKX13aGlsZSgxKTtRZygpO0s9Yztuay5jdXJyZW50PWQ7aWYobnVsbCE9PVkpdGhyb3cgRXJyb3IocCgyNjEpKTtSPW51bGw7Wj0wO3JldHVybiBUfWZ1bmN0aW9uIFVrKCl7Zm9yKDtudWxsIT09WTspVmsoWSl9ZnVuY3Rpb24gTWsoKXtmb3IoO251bGwhPT1ZJiYhY2MoKTspVmsoWSl9ZnVuY3Rpb24gVmsoYSl7dmFyIGI9V2soYS5hbHRlcm5hdGUsYSxnaik7YS5tZW1vaXplZFByb3BzPWEucGVuZGluZ1Byb3BzO251bGw9PT1iP1RrKGEpOlk9Yjtvay5jdXJyZW50PW51bGx9CmZ1bmN0aW9uIFRrKGEpe3ZhciBiPWE7ZG97dmFyIGM9Yi5hbHRlcm5hdGU7YT1iLnJldHVybjtpZigwPT09KGIuZmxhZ3MmMzI3NjgpKXtpZihjPUZqKGMsYixnaiksbnVsbCE9PWMpe1k9YztyZXR1cm59fWVsc2V7Yz1KaihjLGIpO2lmKG51bGwhPT1jKXtjLmZsYWdzJj0zMjc2NztZPWM7cmV0dXJufWlmKG51bGwhPT1hKWEuZmxhZ3N8PTMyNzY4LGEuc3VidHJlZUZsYWdzPTAsYS5kZWxldGlvbnM9bnVsbDtlbHNle1Q9NjtZPW51bGw7cmV0dXJufX1iPWIuc2libGluZztpZihudWxsIT09Yil7WT1iO3JldHVybn1ZPWI9YX13aGlsZShudWxsIT09Yik7MD09PVQmJihUPTUpfWZ1bmN0aW9uIFFrKGEsYixjKXt2YXIgZD1DLGU9cGsudHJhbnNpdGlvbjt0cnl7cGsudHJhbnNpdGlvbj1udWxsLEM9MSxYayhhLGIsYyxkKX1maW5hbGx5e3BrLnRyYW5zaXRpb249ZSxDPWR9cmV0dXJuIG51bGx9CmZ1bmN0aW9uIFhrKGEsYixjLGQpe2RvIElrKCk7d2hpbGUobnVsbCE9PXhrKTtpZigwIT09KEsmNikpdGhyb3cgRXJyb3IocCgzMjcpKTtjPWEuZmluaXNoZWRXb3JrO3ZhciBlPWEuZmluaXNoZWRMYW5lcztpZihudWxsPT09YylyZXR1cm4gbnVsbDthLmZpbmlzaGVkV29yaz1udWxsO2EuZmluaXNoZWRMYW5lcz0wO2lmKGM9PT1hLmN1cnJlbnQpdGhyb3cgRXJyb3IocCgxNzcpKTthLmNhbGxiYWNrTm9kZT1udWxsO2EuY2FsbGJhY2tQcmlvcml0eT0wO3ZhciBmPWMubGFuZXN8Yy5jaGlsZExhbmVzO0JjKGEsZik7YT09PVImJihZPVI9bnVsbCxaPTApOzA9PT0oYy5zdWJ0cmVlRmxhZ3MmMjA2NCkmJjA9PT0oYy5mbGFncyYyMDY0KXx8d2t8fCh3az0hMCxHayhoYyxmdW5jdGlvbigpe0lrKCk7cmV0dXJuIG51bGx9KSk7Zj0wIT09KGMuZmxhZ3MmMTU5OTApO2lmKDAhPT0oYy5zdWJ0cmVlRmxhZ3MmMTU5OTApfHxmKXtmPXBrLnRyYW5zaXRpb247cGsudHJhbnNpdGlvbj1udWxsOwp2YXIgZz1DO0M9MTt2YXIgaD1LO0t8PTQ7b2suY3VycmVudD1udWxsO1BqKGEsYyk7ZWsoYyxhKTtPZShEZik7ZGQ9ISFDZjtEZj1DZj1udWxsO2EuY3VycmVudD1jO2lrKGMsYSxlKTtkYygpO0s9aDtDPWc7cGsudHJhbnNpdGlvbj1mfWVsc2UgYS5jdXJyZW50PWM7d2smJih3az0hMSx4az1hLHlrPWUpO2Y9YS5wZW5kaW5nTGFuZXM7MD09PWYmJihTaT1udWxsKTttYyhjLnN0YXRlTm9kZSxkKTtFayhhLEIoKSk7aWYobnVsbCE9PWIpZm9yKGQ9YS5vblJlY292ZXJhYmxlRXJyb3IsYz0wO2M8Yi5sZW5ndGg7YysrKWU9YltjXSxkKGUudmFsdWUse2NvbXBvbmVudFN0YWNrOmUuc3RhY2ssZGlnZXN0OmUuZGlnZXN0fSk7aWYoUGkpdGhyb3cgUGk9ITEsYT1RaSxRaT1udWxsLGE7MCE9PSh5ayYxKSYmMCE9PWEudGFnJiZJaygpO2Y9YS5wZW5kaW5nTGFuZXM7MCE9PShmJjEpP2E9PT1Baz96aysrOih6az0wLEFrPWEpOnprPTA7amcoKTtyZXR1cm4gbnVsbH0KZnVuY3Rpb24gSWsoKXtpZihudWxsIT09eGspe3ZhciBhPURjKHlrKSxiPXBrLnRyYW5zaXRpb24sYz1DO3RyeXtway50cmFuc2l0aW9uPW51bGw7Qz0xNj5hPzE2OmE7aWYobnVsbD09PXhrKXZhciBkPSExO2Vsc2V7YT14azt4az1udWxsO3lrPTA7aWYoMCE9PShLJjYpKXRocm93IEVycm9yKHAoMzMxKSk7dmFyIGU9SztLfD00O2ZvcihWPWEuY3VycmVudDtudWxsIT09Vjspe3ZhciBmPVYsZz1mLmNoaWxkO2lmKDAhPT0oVi5mbGFncyYxNikpe3ZhciBoPWYuZGVsZXRpb25zO2lmKG51bGwhPT1oKXtmb3IodmFyIGs9MDtrPGgubGVuZ3RoO2srKyl7dmFyIGw9aFtrXTtmb3IoVj1sO251bGwhPT1WOyl7dmFyIG09Vjtzd2l0Y2gobS50YWcpe2Nhc2UgMDpjYXNlIDExOmNhc2UgMTU6UWooOCxtLGYpfXZhciBxPW0uY2hpbGQ7aWYobnVsbCE9PXEpcS5yZXR1cm49bSxWPXE7ZWxzZSBmb3IoO251bGwhPT1WOyl7bT1WO3ZhciByPW0uc2libGluZyx5PW0ucmV0dXJuO1RqKG0pO2lmKG09PT0KbCl7Vj1udWxsO2JyZWFrfWlmKG51bGwhPT1yKXtyLnJldHVybj15O1Y9cjticmVha31WPXl9fX12YXIgbj1mLmFsdGVybmF0ZTtpZihudWxsIT09bil7dmFyIHQ9bi5jaGlsZDtpZihudWxsIT09dCl7bi5jaGlsZD1udWxsO2Rve3ZhciBKPXQuc2libGluZzt0LnNpYmxpbmc9bnVsbDt0PUp9d2hpbGUobnVsbCE9PXQpfX1WPWZ9fWlmKDAhPT0oZi5zdWJ0cmVlRmxhZ3MmMjA2NCkmJm51bGwhPT1nKWcucmV0dXJuPWYsVj1nO2Vsc2UgYjpmb3IoO251bGwhPT1WOyl7Zj1WO2lmKDAhPT0oZi5mbGFncyYyMDQ4KSlzd2l0Y2goZi50YWcpe2Nhc2UgMDpjYXNlIDExOmNhc2UgMTU6UWooOSxmLGYucmV0dXJuKX12YXIgeD1mLnNpYmxpbmc7aWYobnVsbCE9PXgpe3gucmV0dXJuPWYucmV0dXJuO1Y9eDticmVhayBifVY9Zi5yZXR1cm59fXZhciB3PWEuY3VycmVudDtmb3IoVj13O251bGwhPT1WOyl7Zz1WO3ZhciB1PWcuY2hpbGQ7aWYoMCE9PShnLnN1YnRyZWVGbGFncyYyMDY0KSYmbnVsbCE9PQp1KXUucmV0dXJuPWcsVj11O2Vsc2UgYjpmb3IoZz13O251bGwhPT1WOyl7aD1WO2lmKDAhPT0oaC5mbGFncyYyMDQ4KSl0cnl7c3dpdGNoKGgudGFnKXtjYXNlIDA6Y2FzZSAxMTpjYXNlIDE1OlJqKDksaCl9fWNhdGNoKG5hKXtXKGgsaC5yZXR1cm4sbmEpfWlmKGg9PT1nKXtWPW51bGw7YnJlYWsgYn12YXIgRj1oLnNpYmxpbmc7aWYobnVsbCE9PUYpe0YucmV0dXJuPWgucmV0dXJuO1Y9RjticmVhayBifVY9aC5yZXR1cm59fUs9ZTtqZygpO2lmKGxjJiYiZnVuY3Rpb24iPT09dHlwZW9mIGxjLm9uUG9zdENvbW1pdEZpYmVyUm9vdCl0cnl7bGMub25Qb3N0Q29tbWl0RmliZXJSb290KGtjLGEpfWNhdGNoKG5hKXt9ZD0hMH1yZXR1cm4gZH1maW5hbGx5e0M9Yyxway50cmFuc2l0aW9uPWJ9fXJldHVybiExfWZ1bmN0aW9uIFlrKGEsYixjKXtiPUtpKGMsYik7Yj1PaShhLGIsMSk7YT1kaChhLGIsMSk7Yj1MKCk7bnVsbCE9PWEmJihBYyhhLDEsYiksRWsoYSxiKSl9CmZ1bmN0aW9uIFcoYSxiLGMpe2lmKDM9PT1hLnRhZylZayhhLGEsYyk7ZWxzZSBmb3IoO251bGwhPT1iOyl7aWYoMz09PWIudGFnKXtZayhiLGEsYyk7YnJlYWt9ZWxzZSBpZigxPT09Yi50YWcpe3ZhciBkPWIuc3RhdGVOb2RlO2lmKCJmdW5jdGlvbiI9PT10eXBlb2YgYi50eXBlLmdldERlcml2ZWRTdGF0ZUZyb21FcnJvcnx8ImZ1bmN0aW9uIj09PXR5cGVvZiBkLmNvbXBvbmVudERpZENhdGNoJiYobnVsbD09PVNpfHwhU2kuaGFzKGQpKSl7YT1LaShjLGEpO2E9UmkoYixhLDEpO2I9ZGgoYixhLDEpO2E9TCgpO251bGwhPT1iJiYoQWMoYiwxLGEpLEVrKGIsYSkpO2JyZWFrfX1iPWIucmV0dXJufX0KZnVuY3Rpb24gVWkoYSxiLGMpe3ZhciBkPWEucGluZ0NhY2hlO251bGwhPT1kJiZkLmRlbGV0ZShiKTtiPUwoKTthLnBpbmdlZExhbmVzfD1hLnN1c3BlbmRlZExhbmVzJmM7Uj09PWEmJihaJmMpPT09YyYmKDQ9PT1UfHwzPT09VCYmKFomMTMwMDIzNDI0KT09PVomJjUwMD5CKCktZ2s/TGsoYSwwKTpza3w9Yyk7RWsoYSxiKX1mdW5jdGlvbiBaayhhLGIpezA9PT1iJiYoMD09PShhLm1vZGUmMSk/Yj0xOihiPXNjLHNjPDw9MSwwPT09KHNjJjEzMDAyMzQyNCkmJihzYz00MTk0MzA0KSkpO3ZhciBjPUwoKTthPVpnKGEsYik7bnVsbCE9PWEmJihBYyhhLGIsYyksRWsoYSxjKSl9ZnVuY3Rpb24gdmooYSl7dmFyIGI9YS5tZW1vaXplZFN0YXRlLGM9MDtudWxsIT09YiYmKGM9Yi5yZXRyeUxhbmUpO1prKGEsYyl9CmZ1bmN0aW9uIGNrKGEsYil7dmFyIGM9MDtzd2l0Y2goYS50YWcpe2Nhc2UgMTM6dmFyIGQ9YS5zdGF0ZU5vZGU7dmFyIGU9YS5tZW1vaXplZFN0YXRlO251bGwhPT1lJiYoYz1lLnJldHJ5TGFuZSk7YnJlYWs7Y2FzZSAxOTpkPWEuc3RhdGVOb2RlO2JyZWFrO2RlZmF1bHQ6dGhyb3cgRXJyb3IocCgzMTQpKTt9bnVsbCE9PWQmJmQuZGVsZXRlKGIpO1prKGEsYyl9dmFyIFdrOwpXaz1mdW5jdGlvbihhLGIsYyl7aWYobnVsbCE9PWEpaWYoYS5tZW1vaXplZFByb3BzIT09Yi5wZW5kaW5nUHJvcHN8fFdmLmN1cnJlbnQpVWc9ITA7ZWxzZXtpZigwPT09KGEubGFuZXMmYykmJjA9PT0oYi5mbGFncyYxMjgpKXJldHVybiBVZz0hMSx6aihhLGIsYyk7VWc9MCE9PShhLmZsYWdzJjEzMTA3Mik/ITA6ITF9ZWxzZSBVZz0hMSxJJiYwIT09KGIuZmxhZ3MmMTA0ODU3NikmJnVnKGIsbmcsYi5pbmRleCk7Yi5sYW5lcz0wO3N3aXRjaChiLnRhZyl7Y2FzZSAyOnZhciBkPWIudHlwZTtqaihhLGIpO2E9Yi5wZW5kaW5nUHJvcHM7dmFyIGU9WWYoYixILmN1cnJlbnQpO1RnKGIsYyk7ZT1YaChudWxsLGIsZCxhLGUsYyk7dmFyIGY9YmkoKTtiLmZsYWdzfD0xOyJvYmplY3QiPT09dHlwZW9mIGUmJm51bGwhPT1lJiYiZnVuY3Rpb24iPT09dHlwZW9mIGUucmVuZGVyJiZ2b2lkIDA9PT1lLiQkdHlwZW9mPyhiLnRhZz0xLGIubWVtb2l6ZWRTdGF0ZT1udWxsLGIudXBkYXRlUXVldWU9Cm51bGwsWmYoZCk/KGY9ITAsY2coYikpOmY9ITEsYi5tZW1vaXplZFN0YXRlPW51bGwhPT1lLnN0YXRlJiZ2b2lkIDAhPT1lLnN0YXRlP2Uuc3RhdGU6bnVsbCxhaChiKSxlLnVwZGF0ZXI9bmgsYi5zdGF0ZU5vZGU9ZSxlLl9yZWFjdEludGVybmFscz1iLHJoKGIsZCxhLGMpLGI9a2oobnVsbCxiLGQsITAsZixjKSk6KGIudGFnPTAsSSYmZiYmdmcoYiksWWkobnVsbCxiLGUsYyksYj1iLmNoaWxkKTtyZXR1cm4gYjtjYXNlIDE2OmQ9Yi5lbGVtZW50VHlwZTthOntqaihhLGIpO2E9Yi5wZW5kaW5nUHJvcHM7ZT1kLl9pbml0O2Q9ZShkLl9wYXlsb2FkKTtiLnR5cGU9ZDtlPWIudGFnPSRrKGQpO2E9TGcoZCxhKTtzd2l0Y2goZSl7Y2FzZSAwOmI9ZGoobnVsbCxiLGQsYSxjKTticmVhayBhO2Nhc2UgMTpiPWlqKG51bGwsYixkLGEsYyk7YnJlYWsgYTtjYXNlIDExOmI9WmkobnVsbCxiLGQsYSxjKTticmVhayBhO2Nhc2UgMTQ6Yj1haihudWxsLGIsZCxMZyhkLnR5cGUsYSksYyk7YnJlYWsgYX10aHJvdyBFcnJvcihwKDMwNiwKZCwiIikpO31yZXR1cm4gYjtjYXNlIDA6cmV0dXJuIGQ9Yi50eXBlLGU9Yi5wZW5kaW5nUHJvcHMsZT1iLmVsZW1lbnRUeXBlPT09ZD9lOkxnKGQsZSksZGooYSxiLGQsZSxjKTtjYXNlIDE6cmV0dXJuIGQ9Yi50eXBlLGU9Yi5wZW5kaW5nUHJvcHMsZT1iLmVsZW1lbnRUeXBlPT09ZD9lOkxnKGQsZSksaWooYSxiLGQsZSxjKTtjYXNlIDM6YTp7bGooYik7aWYobnVsbD09PWEpdGhyb3cgRXJyb3IocCgzODcpKTtkPWIucGVuZGluZ1Byb3BzO2Y9Yi5tZW1vaXplZFN0YXRlO2U9Zi5lbGVtZW50O2JoKGEsYik7Z2goYixkLG51bGwsYyk7dmFyIGc9Yi5tZW1vaXplZFN0YXRlO2Q9Zy5lbGVtZW50O2lmKGYuaXNEZWh5ZHJhdGVkKWlmKGY9e2VsZW1lbnQ6ZCxpc0RlaHlkcmF0ZWQ6ITEsY2FjaGU6Zy5jYWNoZSxwZW5kaW5nU3VzcGVuc2VCb3VuZGFyaWVzOmcucGVuZGluZ1N1c3BlbnNlQm91bmRhcmllcyx0cmFuc2l0aW9uczpnLnRyYW5zaXRpb25zfSxiLnVwZGF0ZVF1ZXVlLmJhc2VTdGF0ZT0KZixiLm1lbW9pemVkU3RhdGU9ZixiLmZsYWdzJjI1Nil7ZT1LaShFcnJvcihwKDQyMykpLGIpO2I9bWooYSxiLGQsYyxlKTticmVhayBhfWVsc2UgaWYoZCE9PWUpe2U9S2koRXJyb3IocCg0MjQpKSxiKTtiPW1qKGEsYixkLGMsZSk7YnJlYWsgYX1lbHNlIGZvcih5Zz1MZihiLnN0YXRlTm9kZS5jb250YWluZXJJbmZvLmZpcnN0Q2hpbGQpLHhnPWIsST0hMCx6Zz1udWxsLGM9Q2goYixudWxsLGQsYyksYi5jaGlsZD1jO2M7KWMuZmxhZ3M9Yy5mbGFncyYtM3w0MDk2LGM9Yy5zaWJsaW5nO2Vsc2V7SWcoKTtpZihkPT09ZSl7Yj0kaShhLGIsYyk7YnJlYWsgYX1ZaShhLGIsZCxjKX1iPWIuY2hpbGR9cmV0dXJuIGI7Y2FzZSA1OnJldHVybiBLaChiKSxudWxsPT09YSYmRWcoYiksZD1iLnR5cGUsZT1iLnBlbmRpbmdQcm9wcyxmPW51bGwhPT1hP2EubWVtb2l6ZWRQcm9wczpudWxsLGc9ZS5jaGlsZHJlbixFZihkLGUpP2c9bnVsbDpudWxsIT09ZiYmRWYoZCxmKSYmKGIuZmxhZ3N8PTMyKSwKaGooYSxiKSxZaShhLGIsZyxjKSxiLmNoaWxkO2Nhc2UgNjpyZXR1cm4gbnVsbD09PWEmJkVnKGIpLG51bGw7Y2FzZSAxMzpyZXR1cm4gcGooYSxiLGMpO2Nhc2UgNDpyZXR1cm4gSWgoYixiLnN0YXRlTm9kZS5jb250YWluZXJJbmZvKSxkPWIucGVuZGluZ1Byb3BzLG51bGw9PT1hP2IuY2hpbGQ9QmgoYixudWxsLGQsYyk6WWkoYSxiLGQsYyksYi5jaGlsZDtjYXNlIDExOnJldHVybiBkPWIudHlwZSxlPWIucGVuZGluZ1Byb3BzLGU9Yi5lbGVtZW50VHlwZT09PWQ/ZTpMZyhkLGUpLFppKGEsYixkLGUsYyk7Y2FzZSA3OnJldHVybiBZaShhLGIsYi5wZW5kaW5nUHJvcHMsYyksYi5jaGlsZDtjYXNlIDg6cmV0dXJuIFlpKGEsYixiLnBlbmRpbmdQcm9wcy5jaGlsZHJlbixjKSxiLmNoaWxkO2Nhc2UgMTI6cmV0dXJuIFlpKGEsYixiLnBlbmRpbmdQcm9wcy5jaGlsZHJlbixjKSxiLmNoaWxkO2Nhc2UgMTA6YTp7ZD1iLnR5cGUuX2NvbnRleHQ7ZT1iLnBlbmRpbmdQcm9wcztmPWIubWVtb2l6ZWRQcm9wczsKZz1lLnZhbHVlO0coTWcsZC5fY3VycmVudFZhbHVlKTtkLl9jdXJyZW50VmFsdWU9ZztpZihudWxsIT09ZilpZihIZShmLnZhbHVlLGcpKXtpZihmLmNoaWxkcmVuPT09ZS5jaGlsZHJlbiYmIVdmLmN1cnJlbnQpe2I9JGkoYSxiLGMpO2JyZWFrIGF9fWVsc2UgZm9yKGY9Yi5jaGlsZCxudWxsIT09ZiYmKGYucmV0dXJuPWIpO251bGwhPT1mOyl7dmFyIGg9Zi5kZXBlbmRlbmNpZXM7aWYobnVsbCE9PWgpe2c9Zi5jaGlsZDtmb3IodmFyIGs9aC5maXJzdENvbnRleHQ7bnVsbCE9PWs7KXtpZihrLmNvbnRleHQ9PT1kKXtpZigxPT09Zi50YWcpe2s9Y2goLTEsYyYtYyk7ay50YWc9Mjt2YXIgbD1mLnVwZGF0ZVF1ZXVlO2lmKG51bGwhPT1sKXtsPWwuc2hhcmVkO3ZhciBtPWwucGVuZGluZztudWxsPT09bT9rLm5leHQ9azooay5uZXh0PW0ubmV4dCxtLm5leHQ9ayk7bC5wZW5kaW5nPWt9fWYubGFuZXN8PWM7az1mLmFsdGVybmF0ZTtudWxsIT09ayYmKGsubGFuZXN8PWMpO1NnKGYucmV0dXJuLApjLGIpO2gubGFuZXN8PWM7YnJlYWt9az1rLm5leHR9fWVsc2UgaWYoMTA9PT1mLnRhZylnPWYudHlwZT09PWIudHlwZT9udWxsOmYuY2hpbGQ7ZWxzZSBpZigxOD09PWYudGFnKXtnPWYucmV0dXJuO2lmKG51bGw9PT1nKXRocm93IEVycm9yKHAoMzQxKSk7Zy5sYW5lc3w9YztoPWcuYWx0ZXJuYXRlO251bGwhPT1oJiYoaC5sYW5lc3w9Yyk7U2coZyxjLGIpO2c9Zi5zaWJsaW5nfWVsc2UgZz1mLmNoaWxkO2lmKG51bGwhPT1nKWcucmV0dXJuPWY7ZWxzZSBmb3IoZz1mO251bGwhPT1nOyl7aWYoZz09PWIpe2c9bnVsbDticmVha31mPWcuc2libGluZztpZihudWxsIT09Zil7Zi5yZXR1cm49Zy5yZXR1cm47Zz1mO2JyZWFrfWc9Zy5yZXR1cm59Zj1nfVlpKGEsYixlLmNoaWxkcmVuLGMpO2I9Yi5jaGlsZH1yZXR1cm4gYjtjYXNlIDk6cmV0dXJuIGU9Yi50eXBlLGQ9Yi5wZW5kaW5nUHJvcHMuY2hpbGRyZW4sVGcoYixjKSxlPVZnKGUpLGQ9ZChlKSxiLmZsYWdzfD0xLFlpKGEsYixkLGMpLApiLmNoaWxkO2Nhc2UgMTQ6cmV0dXJuIGQ9Yi50eXBlLGU9TGcoZCxiLnBlbmRpbmdQcm9wcyksZT1MZyhkLnR5cGUsZSksYWooYSxiLGQsZSxjKTtjYXNlIDE1OnJldHVybiBjaihhLGIsYi50eXBlLGIucGVuZGluZ1Byb3BzLGMpO2Nhc2UgMTc6cmV0dXJuIGQ9Yi50eXBlLGU9Yi5wZW5kaW5nUHJvcHMsZT1iLmVsZW1lbnRUeXBlPT09ZD9lOkxnKGQsZSksamooYSxiKSxiLnRhZz0xLFpmKGQpPyhhPSEwLGNnKGIpKTphPSExLFRnKGIsYykscGgoYixkLGUpLHJoKGIsZCxlLGMpLGtqKG51bGwsYixkLCEwLGEsYyk7Y2FzZSAxOTpyZXR1cm4geWooYSxiLGMpO2Nhc2UgMjI6cmV0dXJuIGVqKGEsYixjKX10aHJvdyBFcnJvcihwKDE1NixiLnRhZykpO307ZnVuY3Rpb24gR2soYSxiKXtyZXR1cm4gYWMoYSxiKX0KZnVuY3Rpb24gYWwoYSxiLGMsZCl7dGhpcy50YWc9YTt0aGlzLmtleT1jO3RoaXMuc2libGluZz10aGlzLmNoaWxkPXRoaXMucmV0dXJuPXRoaXMuc3RhdGVOb2RlPXRoaXMudHlwZT10aGlzLmVsZW1lbnRUeXBlPW51bGw7dGhpcy5pbmRleD0wO3RoaXMucmVmPW51bGw7dGhpcy5wZW5kaW5nUHJvcHM9Yjt0aGlzLmRlcGVuZGVuY2llcz10aGlzLm1lbW9pemVkU3RhdGU9dGhpcy51cGRhdGVRdWV1ZT10aGlzLm1lbW9pemVkUHJvcHM9bnVsbDt0aGlzLm1vZGU9ZDt0aGlzLnN1YnRyZWVGbGFncz10aGlzLmZsYWdzPTA7dGhpcy5kZWxldGlvbnM9bnVsbDt0aGlzLmNoaWxkTGFuZXM9dGhpcy5sYW5lcz0wO3RoaXMuYWx0ZXJuYXRlPW51bGx9ZnVuY3Rpb24gQmcoYSxiLGMsZCl7cmV0dXJuIG5ldyBhbChhLGIsYyxkKX1mdW5jdGlvbiBiaihhKXthPWEucHJvdG90eXBlO3JldHVybiEoIWF8fCFhLmlzUmVhY3RDb21wb25lbnQpfQpmdW5jdGlvbiAkayhhKXtpZigiZnVuY3Rpb24iPT09dHlwZW9mIGEpcmV0dXJuIGJqKGEpPzE6MDtpZih2b2lkIDAhPT1hJiZudWxsIT09YSl7YT1hLiQkdHlwZW9mO2lmKGE9PT1EYSlyZXR1cm4gMTE7aWYoYT09PUdhKXJldHVybiAxNH1yZXR1cm4gMn0KZnVuY3Rpb24gd2goYSxiKXt2YXIgYz1hLmFsdGVybmF0ZTtudWxsPT09Yz8oYz1CZyhhLnRhZyxiLGEua2V5LGEubW9kZSksYy5lbGVtZW50VHlwZT1hLmVsZW1lbnRUeXBlLGMudHlwZT1hLnR5cGUsYy5zdGF0ZU5vZGU9YS5zdGF0ZU5vZGUsYy5hbHRlcm5hdGU9YSxhLmFsdGVybmF0ZT1jKTooYy5wZW5kaW5nUHJvcHM9YixjLnR5cGU9YS50eXBlLGMuZmxhZ3M9MCxjLnN1YnRyZWVGbGFncz0wLGMuZGVsZXRpb25zPW51bGwpO2MuZmxhZ3M9YS5mbGFncyYxNDY4MDA2NDtjLmNoaWxkTGFuZXM9YS5jaGlsZExhbmVzO2MubGFuZXM9YS5sYW5lcztjLmNoaWxkPWEuY2hpbGQ7Yy5tZW1vaXplZFByb3BzPWEubWVtb2l6ZWRQcm9wcztjLm1lbW9pemVkU3RhdGU9YS5tZW1vaXplZFN0YXRlO2MudXBkYXRlUXVldWU9YS51cGRhdGVRdWV1ZTtiPWEuZGVwZW5kZW5jaWVzO2MuZGVwZW5kZW5jaWVzPW51bGw9PT1iP251bGw6e2xhbmVzOmIubGFuZXMsZmlyc3RDb250ZXh0OmIuZmlyc3RDb250ZXh0fTsKYy5zaWJsaW5nPWEuc2libGluZztjLmluZGV4PWEuaW5kZXg7Yy5yZWY9YS5yZWY7cmV0dXJuIGN9CmZ1bmN0aW9uIHloKGEsYixjLGQsZSxmKXt2YXIgZz0yO2Q9YTtpZigiZnVuY3Rpb24iPT09dHlwZW9mIGEpYmooYSkmJihnPTEpO2Vsc2UgaWYoInN0cmluZyI9PT10eXBlb2YgYSlnPTU7ZWxzZSBhOnN3aXRjaChhKXtjYXNlIHlhOnJldHVybiBBaChjLmNoaWxkcmVuLGUsZixiKTtjYXNlIHphOmc9ODtlfD04O2JyZWFrO2Nhc2UgQWE6cmV0dXJuIGE9QmcoMTIsYyxiLGV8MiksYS5lbGVtZW50VHlwZT1BYSxhLmxhbmVzPWYsYTtjYXNlIEVhOnJldHVybiBhPUJnKDEzLGMsYixlKSxhLmVsZW1lbnRUeXBlPUVhLGEubGFuZXM9ZixhO2Nhc2UgRmE6cmV0dXJuIGE9QmcoMTksYyxiLGUpLGEuZWxlbWVudFR5cGU9RmEsYS5sYW5lcz1mLGE7Y2FzZSBJYTpyZXR1cm4gcWooYyxlLGYsYik7ZGVmYXVsdDppZigib2JqZWN0Ij09PXR5cGVvZiBhJiZudWxsIT09YSlzd2l0Y2goYS4kJHR5cGVvZil7Y2FzZSBCYTpnPTEwO2JyZWFrIGE7Y2FzZSBDYTpnPTk7YnJlYWsgYTtjYXNlIERhOmc9MTE7CmJyZWFrIGE7Y2FzZSBHYTpnPTE0O2JyZWFrIGE7Y2FzZSBIYTpnPTE2O2Q9bnVsbDticmVhayBhfXRocm93IEVycm9yKHAoMTMwLG51bGw9PWE/YTp0eXBlb2YgYSwiIikpO31iPUJnKGcsYyxiLGUpO2IuZWxlbWVudFR5cGU9YTtiLnR5cGU9ZDtiLmxhbmVzPWY7cmV0dXJuIGJ9ZnVuY3Rpb24gQWgoYSxiLGMsZCl7YT1CZyg3LGEsZCxiKTthLmxhbmVzPWM7cmV0dXJuIGF9ZnVuY3Rpb24gcWooYSxiLGMsZCl7YT1CZygyMixhLGQsYik7YS5lbGVtZW50VHlwZT1JYTthLmxhbmVzPWM7YS5zdGF0ZU5vZGU9e2lzSGlkZGVuOiExfTtyZXR1cm4gYX1mdW5jdGlvbiB4aChhLGIsYyl7YT1CZyg2LGEsbnVsbCxiKTthLmxhbmVzPWM7cmV0dXJuIGF9CmZ1bmN0aW9uIHpoKGEsYixjKXtiPUJnKDQsbnVsbCE9PWEuY2hpbGRyZW4/YS5jaGlsZHJlbjpbXSxhLmtleSxiKTtiLmxhbmVzPWM7Yi5zdGF0ZU5vZGU9e2NvbnRhaW5lckluZm86YS5jb250YWluZXJJbmZvLHBlbmRpbmdDaGlsZHJlbjpudWxsLGltcGxlbWVudGF0aW9uOmEuaW1wbGVtZW50YXRpb259O3JldHVybiBifQpmdW5jdGlvbiBibChhLGIsYyxkLGUpe3RoaXMudGFnPWI7dGhpcy5jb250YWluZXJJbmZvPWE7dGhpcy5maW5pc2hlZFdvcms9dGhpcy5waW5nQ2FjaGU9dGhpcy5jdXJyZW50PXRoaXMucGVuZGluZ0NoaWxkcmVuPW51bGw7dGhpcy50aW1lb3V0SGFuZGxlPS0xO3RoaXMuY2FsbGJhY2tOb2RlPXRoaXMucGVuZGluZ0NvbnRleHQ9dGhpcy5jb250ZXh0PW51bGw7dGhpcy5jYWxsYmFja1ByaW9yaXR5PTA7dGhpcy5ldmVudFRpbWVzPXpjKDApO3RoaXMuZXhwaXJhdGlvblRpbWVzPXpjKC0xKTt0aGlzLmVudGFuZ2xlZExhbmVzPXRoaXMuZmluaXNoZWRMYW5lcz10aGlzLm11dGFibGVSZWFkTGFuZXM9dGhpcy5leHBpcmVkTGFuZXM9dGhpcy5waW5nZWRMYW5lcz10aGlzLnN1c3BlbmRlZExhbmVzPXRoaXMucGVuZGluZ0xhbmVzPTA7dGhpcy5lbnRhbmdsZW1lbnRzPXpjKDApO3RoaXMuaWRlbnRpZmllclByZWZpeD1kO3RoaXMub25SZWNvdmVyYWJsZUVycm9yPWU7dGhpcy5tdXRhYmxlU291cmNlRWFnZXJIeWRyYXRpb25EYXRhPQpudWxsfWZ1bmN0aW9uIGNsKGEsYixjLGQsZSxmLGcsaCxrKXthPW5ldyBibChhLGIsYyxoLGspOzE9PT1iPyhiPTEsITA9PT1mJiYoYnw9OCkpOmI9MDtmPUJnKDMsbnVsbCxudWxsLGIpO2EuY3VycmVudD1mO2Yuc3RhdGVOb2RlPWE7Zi5tZW1vaXplZFN0YXRlPXtlbGVtZW50OmQsaXNEZWh5ZHJhdGVkOmMsY2FjaGU6bnVsbCx0cmFuc2l0aW9uczpudWxsLHBlbmRpbmdTdXNwZW5zZUJvdW5kYXJpZXM6bnVsbH07YWgoZik7cmV0dXJuIGF9ZnVuY3Rpb24gZGwoYSxiLGMpe3ZhciBkPTM8YXJndW1lbnRzLmxlbmd0aCYmdm9pZCAwIT09YXJndW1lbnRzWzNdP2FyZ3VtZW50c1szXTpudWxsO3JldHVybnskJHR5cGVvZjp3YSxrZXk6bnVsbD09ZD9udWxsOiIiK2QsY2hpbGRyZW46YSxjb250YWluZXJJbmZvOmIsaW1wbGVtZW50YXRpb246Y319CmZ1bmN0aW9uIGVsKGEpe2lmKCFhKXJldHVybiBWZjthPWEuX3JlYWN0SW50ZXJuYWxzO2E6e2lmKFZiKGEpIT09YXx8MSE9PWEudGFnKXRocm93IEVycm9yKHAoMTcwKSk7dmFyIGI9YTtkb3tzd2l0Y2goYi50YWcpe2Nhc2UgMzpiPWIuc3RhdGVOb2RlLmNvbnRleHQ7YnJlYWsgYTtjYXNlIDE6aWYoWmYoYi50eXBlKSl7Yj1iLnN0YXRlTm9kZS5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZE1lcmdlZENoaWxkQ29udGV4dDticmVhayBhfX1iPWIucmV0dXJufXdoaWxlKG51bGwhPT1iKTt0aHJvdyBFcnJvcihwKDE3MSkpO31pZigxPT09YS50YWcpe3ZhciBjPWEudHlwZTtpZihaZihjKSlyZXR1cm4gYmcoYSxjLGIpfXJldHVybiBifQpmdW5jdGlvbiBmbChhLGIsYyxkLGUsZixnLGgsayl7YT1jbChjLGQsITAsYSxlLGYsZyxoLGspO2EuY29udGV4dD1lbChudWxsKTtjPWEuY3VycmVudDtkPUwoKTtlPWxoKGMpO2Y9Y2goZCxlKTtmLmNhbGxiYWNrPXZvaWQgMCE9PWImJm51bGwhPT1iP2I6bnVsbDtkaChjLGYsZSk7YS5jdXJyZW50LmxhbmVzPWU7QWMoYSxlLGQpO0VrKGEsZCk7cmV0dXJuIGF9ZnVuY3Rpb24gZ2woYSxiLGMsZCl7dmFyIGU9Yi5jdXJyZW50LGY9TCgpLGc9bGgoZSk7Yz1lbChjKTtudWxsPT09Yi5jb250ZXh0P2IuY29udGV4dD1jOmIucGVuZGluZ0NvbnRleHQ9YztiPWNoKGYsZyk7Yi5wYXlsb2FkPXtlbGVtZW50OmF9O2Q9dm9pZCAwPT09ZD9udWxsOmQ7bnVsbCE9PWQmJihiLmNhbGxiYWNrPWQpO2E9ZGgoZSxiLGcpO251bGwhPT1hJiYobWgoYSxlLGcsZiksZWgoYSxlLGcpKTtyZXR1cm4gZ30KZnVuY3Rpb24gaGwoYSl7YT1hLmN1cnJlbnQ7aWYoIWEuY2hpbGQpcmV0dXJuIG51bGw7c3dpdGNoKGEuY2hpbGQudGFnKXtjYXNlIDU6cmV0dXJuIGEuY2hpbGQuc3RhdGVOb2RlO2RlZmF1bHQ6cmV0dXJuIGEuY2hpbGQuc3RhdGVOb2RlfX1mdW5jdGlvbiBpbChhLGIpe2E9YS5tZW1vaXplZFN0YXRlO2lmKG51bGwhPT1hJiZudWxsIT09YS5kZWh5ZHJhdGVkKXt2YXIgYz1hLnJldHJ5TGFuZTthLnJldHJ5TGFuZT0wIT09YyYmYzxiP2M6Yn19ZnVuY3Rpb24gamwoYSxiKXtpbChhLGIpOyhhPWEuYWx0ZXJuYXRlKSYmaWwoYSxiKX1mdW5jdGlvbiBrbCgpe3JldHVybiBudWxsfXZhciBsbD0iZnVuY3Rpb24iPT09dHlwZW9mIHJlcG9ydEVycm9yP3JlcG9ydEVycm9yOmZ1bmN0aW9uKGEpe2NvbnNvbGUuZXJyb3IoYSl9O2Z1bmN0aW9uIG1sKGEpe3RoaXMuX2ludGVybmFsUm9vdD1hfQpubC5wcm90b3R5cGUucmVuZGVyPW1sLnByb3RvdHlwZS5yZW5kZXI9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5faW50ZXJuYWxSb290O2lmKG51bGw9PT1iKXRocm93IEVycm9yKHAoNDA5KSk7Z2woYSxiLG51bGwsbnVsbCl9O25sLnByb3RvdHlwZS51bm1vdW50PW1sLnByb3RvdHlwZS51bm1vdW50PWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5faW50ZXJuYWxSb290O2lmKG51bGwhPT1hKXt0aGlzLl9pbnRlcm5hbFJvb3Q9bnVsbDt2YXIgYj1hLmNvbnRhaW5lckluZm87U2soZnVuY3Rpb24oKXtnbChudWxsLGEsbnVsbCxudWxsKX0pO2JbdWZdPW51bGx9fTtmdW5jdGlvbiBubChhKXt0aGlzLl9pbnRlcm5hbFJvb3Q9YX0KbmwucHJvdG90eXBlLnVuc3RhYmxlX3NjaGVkdWxlSHlkcmF0aW9uPWZ1bmN0aW9uKGEpe2lmKGEpe3ZhciBiPUhjKCk7YT17YmxvY2tlZE9uOm51bGwsdGFyZ2V0OmEscHJpb3JpdHk6Yn07Zm9yKHZhciBjPTA7YzxRYy5sZW5ndGgmJjAhPT1iJiZiPFFjW2NdLnByaW9yaXR5O2MrKyk7UWMuc3BsaWNlKGMsMCxhKTswPT09YyYmVmMoYSl9fTtmdW5jdGlvbiBvbChhKXtyZXR1cm4hKCFhfHwxIT09YS5ub2RlVHlwZSYmOSE9PWEubm9kZVR5cGUmJjExIT09YS5ub2RlVHlwZSl9ZnVuY3Rpb24gcGwoYSl7cmV0dXJuISghYXx8MSE9PWEubm9kZVR5cGUmJjkhPT1hLm5vZGVUeXBlJiYxMSE9PWEubm9kZVR5cGUmJig4IT09YS5ub2RlVHlwZXx8IiByZWFjdC1tb3VudC1wb2ludC11bnN0YWJsZSAiIT09YS5ub2RlVmFsdWUpKX1mdW5jdGlvbiBxbCgpe30KZnVuY3Rpb24gcmwoYSxiLGMsZCxlKXtpZihlKXtpZigiZnVuY3Rpb24iPT09dHlwZW9mIGQpe3ZhciBmPWQ7ZD1mdW5jdGlvbigpe3ZhciBhPWhsKGcpO2YuY2FsbChhKX19dmFyIGc9ZmwoYixkLGEsMCxudWxsLCExLCExLCIiLHFsKTthLl9yZWFjdFJvb3RDb250YWluZXI9ZzthW3VmXT1nLmN1cnJlbnQ7c2YoOD09PWEubm9kZVR5cGU/YS5wYXJlbnROb2RlOmEpO1NrKCk7cmV0dXJuIGd9Zm9yKDtlPWEubGFzdENoaWxkOylhLnJlbW92ZUNoaWxkKGUpO2lmKCJmdW5jdGlvbiI9PT10eXBlb2YgZCl7dmFyIGg9ZDtkPWZ1bmN0aW9uKCl7dmFyIGE9aGwoayk7aC5jYWxsKGEpfX12YXIgaz1jbChhLDAsITEsbnVsbCxudWxsLCExLCExLCIiLHFsKTthLl9yZWFjdFJvb3RDb250YWluZXI9azthW3VmXT1rLmN1cnJlbnQ7c2YoOD09PWEubm9kZVR5cGU/YS5wYXJlbnROb2RlOmEpO1NrKGZ1bmN0aW9uKCl7Z2woYixrLGMsZCl9KTtyZXR1cm4ga30KZnVuY3Rpb24gc2woYSxiLGMsZCxlKXt2YXIgZj1jLl9yZWFjdFJvb3RDb250YWluZXI7aWYoZil7dmFyIGc9ZjtpZigiZnVuY3Rpb24iPT09dHlwZW9mIGUpe3ZhciBoPWU7ZT1mdW5jdGlvbigpe3ZhciBhPWhsKGcpO2guY2FsbChhKX19Z2woYixnLGEsZSl9ZWxzZSBnPXJsKGMsYixhLGUsZCk7cmV0dXJuIGhsKGcpfUVjPWZ1bmN0aW9uKGEpe3N3aXRjaChhLnRhZyl7Y2FzZSAzOnZhciBiPWEuc3RhdGVOb2RlO2lmKGIuY3VycmVudC5tZW1vaXplZFN0YXRlLmlzRGVoeWRyYXRlZCl7dmFyIGM9dGMoYi5wZW5kaW5nTGFuZXMpOzAhPT1jJiYoQ2MoYixjfDEpLEVrKGIsQigpKSwwPT09KEsmNikmJihIaj1CKCkrNTAwLGpnKCkpKX1icmVhaztjYXNlIDEzOlNrKGZ1bmN0aW9uKCl7dmFyIGI9WmcoYSwxKTtpZihudWxsIT09Yil7dmFyIGM9TCgpO21oKGIsYSwxLGMpfX0pLGpsKGEsMSl9fTsKRmM9ZnVuY3Rpb24oYSl7aWYoMTM9PT1hLnRhZyl7dmFyIGI9WmcoYSwxMzQyMTc3MjgpO2lmKG51bGwhPT1iKXt2YXIgYz1MKCk7bWgoYixhLDEzNDIxNzcyOCxjKX1qbChhLDEzNDIxNzcyOCl9fTtHYz1mdW5jdGlvbihhKXtpZigxMz09PWEudGFnKXt2YXIgYj1saChhKSxjPVpnKGEsYik7aWYobnVsbCE9PWMpe3ZhciBkPUwoKTttaChjLGEsYixkKX1qbChhLGIpfX07SGM9ZnVuY3Rpb24oKXtyZXR1cm4gQ307SWM9ZnVuY3Rpb24oYSxiKXt2YXIgYz1DO3RyeXtyZXR1cm4gQz1hLGIoKX1maW5hbGx5e0M9Y319Owp5Yj1mdW5jdGlvbihhLGIsYyl7c3dpdGNoKGIpe2Nhc2UgImlucHV0IjpiYihhLGMpO2I9Yy5uYW1lO2lmKCJyYWRpbyI9PT1jLnR5cGUmJm51bGwhPWIpe2ZvcihjPWE7Yy5wYXJlbnROb2RlOyljPWMucGFyZW50Tm9kZTtjPWMucXVlcnlTZWxlY3RvckFsbCgiaW5wdXRbbmFtZT0iK0pTT04uc3RyaW5naWZ5KCIiK2IpKyddW3R5cGU9InJhZGlvIl0nKTtmb3IoYj0wO2I8Yy5sZW5ndGg7YisrKXt2YXIgZD1jW2JdO2lmKGQhPT1hJiZkLmZvcm09PT1hLmZvcm0pe3ZhciBlPURiKGQpO2lmKCFlKXRocm93IEVycm9yKHAoOTApKTtXYShkKTtiYihkLGUpfX19YnJlYWs7Y2FzZSAidGV4dGFyZWEiOmliKGEsYyk7YnJlYWs7Y2FzZSAic2VsZWN0IjpiPWMudmFsdWUsbnVsbCE9YiYmZmIoYSwhIWMubXVsdGlwbGUsYiwhMSl9fTtHYj1SaztIYj1TazsKdmFyIHRsPXt1c2luZ0NsaWVudEVudHJ5UG9pbnQ6ITEsRXZlbnRzOltDYix1ZSxEYixFYixGYixSa119LHVsPXtmaW5kRmliZXJCeUhvc3RJbnN0YW5jZTpXYyxidW5kbGVUeXBlOjAsdmVyc2lvbjoiMTguMi4wIixyZW5kZXJlclBhY2thZ2VOYW1lOiJyZWFjdC1kb20ifTsKdmFyIHZsPXtidW5kbGVUeXBlOnVsLmJ1bmRsZVR5cGUsdmVyc2lvbjp1bC52ZXJzaW9uLHJlbmRlcmVyUGFja2FnZU5hbWU6dWwucmVuZGVyZXJQYWNrYWdlTmFtZSxyZW5kZXJlckNvbmZpZzp1bC5yZW5kZXJlckNvbmZpZyxvdmVycmlkZUhvb2tTdGF0ZTpudWxsLG92ZXJyaWRlSG9va1N0YXRlRGVsZXRlUGF0aDpudWxsLG92ZXJyaWRlSG9va1N0YXRlUmVuYW1lUGF0aDpudWxsLG92ZXJyaWRlUHJvcHM6bnVsbCxvdmVycmlkZVByb3BzRGVsZXRlUGF0aDpudWxsLG92ZXJyaWRlUHJvcHNSZW5hbWVQYXRoOm51bGwsc2V0RXJyb3JIYW5kbGVyOm51bGwsc2V0U3VzcGVuc2VIYW5kbGVyOm51bGwsc2NoZWR1bGVVcGRhdGU6bnVsbCxjdXJyZW50RGlzcGF0Y2hlclJlZjp1YS5SZWFjdEN1cnJlbnREaXNwYXRjaGVyLGZpbmRIb3N0SW5zdGFuY2VCeUZpYmVyOmZ1bmN0aW9uKGEpe2E9WmIoYSk7cmV0dXJuIG51bGw9PT1hP251bGw6YS5zdGF0ZU5vZGV9LGZpbmRGaWJlckJ5SG9zdEluc3RhbmNlOnVsLmZpbmRGaWJlckJ5SG9zdEluc3RhbmNlfHwKa2wsZmluZEhvc3RJbnN0YW5jZXNGb3JSZWZyZXNoOm51bGwsc2NoZWR1bGVSZWZyZXNoOm51bGwsc2NoZWR1bGVSb290Om51bGwsc2V0UmVmcmVzaEhhbmRsZXI6bnVsbCxnZXRDdXJyZW50RmliZXI6bnVsbCxyZWNvbmNpbGVyVmVyc2lvbjoiMTguMi4wLW5leHQtOWUzYjc3MmI4LTIwMjIwNjA4In07aWYoInVuZGVmaW5lZCIhPT10eXBlb2YgX19SRUFDVF9ERVZUT09MU19HTE9CQUxfSE9PS19fKXt2YXIgd2w9X19SRUFDVF9ERVZUT09MU19HTE9CQUxfSE9PS19fO2lmKCF3bC5pc0Rpc2FibGVkJiZ3bC5zdXBwb3J0c0ZpYmVyKXRyeXtrYz13bC5pbmplY3QodmwpLGxjPXdsfWNhdGNoKGEpe319ZXhwb3J0cy5fX1NFQ1JFVF9JTlRFUk5BTFNfRE9fTk9UX1VTRV9PUl9ZT1VfV0lMTF9CRV9GSVJFRD10bDsKZXhwb3J0cy5jcmVhdGVQb3J0YWw9ZnVuY3Rpb24oYSxiKXt2YXIgYz0yPGFyZ3VtZW50cy5sZW5ndGgmJnZvaWQgMCE9PWFyZ3VtZW50c1syXT9hcmd1bWVudHNbMl06bnVsbDtpZighb2woYikpdGhyb3cgRXJyb3IocCgyMDApKTtyZXR1cm4gZGwoYSxiLG51bGwsYyl9O2V4cG9ydHMuY3JlYXRlUm9vdD1mdW5jdGlvbihhLGIpe2lmKCFvbChhKSl0aHJvdyBFcnJvcihwKDI5OSkpO3ZhciBjPSExLGQ9IiIsZT1sbDtudWxsIT09YiYmdm9pZCAwIT09YiYmKCEwPT09Yi51bnN0YWJsZV9zdHJpY3RNb2RlJiYoYz0hMCksdm9pZCAwIT09Yi5pZGVudGlmaWVyUHJlZml4JiYoZD1iLmlkZW50aWZpZXJQcmVmaXgpLHZvaWQgMCE9PWIub25SZWNvdmVyYWJsZUVycm9yJiYoZT1iLm9uUmVjb3ZlcmFibGVFcnJvcikpO2I9Y2woYSwxLCExLG51bGwsbnVsbCxjLCExLGQsZSk7YVt1Zl09Yi5jdXJyZW50O3NmKDg9PT1hLm5vZGVUeXBlP2EucGFyZW50Tm9kZTphKTtyZXR1cm4gbmV3IG1sKGIpfTsKZXhwb3J0cy5maW5kRE9NTm9kZT1mdW5jdGlvbihhKXtpZihudWxsPT1hKXJldHVybiBudWxsO2lmKDE9PT1hLm5vZGVUeXBlKXJldHVybiBhO3ZhciBiPWEuX3JlYWN0SW50ZXJuYWxzO2lmKHZvaWQgMD09PWIpe2lmKCJmdW5jdGlvbiI9PT10eXBlb2YgYS5yZW5kZXIpdGhyb3cgRXJyb3IocCgxODgpKTthPU9iamVjdC5rZXlzKGEpLmpvaW4oIiwiKTt0aHJvdyBFcnJvcihwKDI2OCxhKSk7fWE9WmIoYik7YT1udWxsPT09YT9udWxsOmEuc3RhdGVOb2RlO3JldHVybiBhfTtleHBvcnRzLmZsdXNoU3luYz1mdW5jdGlvbihhKXtyZXR1cm4gU2soYSl9O2V4cG9ydHMuaHlkcmF0ZT1mdW5jdGlvbihhLGIsYyl7aWYoIXBsKGIpKXRocm93IEVycm9yKHAoMjAwKSk7cmV0dXJuIHNsKG51bGwsYSxiLCEwLGMpfTsKZXhwb3J0cy5oeWRyYXRlUm9vdD1mdW5jdGlvbihhLGIsYyl7aWYoIW9sKGEpKXRocm93IEVycm9yKHAoNDA1KSk7dmFyIGQ9bnVsbCE9YyYmYy5oeWRyYXRlZFNvdXJjZXN8fG51bGwsZT0hMSxmPSIiLGc9bGw7bnVsbCE9PWMmJnZvaWQgMCE9PWMmJighMD09PWMudW5zdGFibGVfc3RyaWN0TW9kZSYmKGU9ITApLHZvaWQgMCE9PWMuaWRlbnRpZmllclByZWZpeCYmKGY9Yy5pZGVudGlmaWVyUHJlZml4KSx2b2lkIDAhPT1jLm9uUmVjb3ZlcmFibGVFcnJvciYmKGc9Yy5vblJlY292ZXJhYmxlRXJyb3IpKTtiPWZsKGIsbnVsbCxhLDEsbnVsbCE9Yz9jOm51bGwsZSwhMSxmLGcpO2FbdWZdPWIuY3VycmVudDtzZihhKTtpZihkKWZvcihhPTA7YTxkLmxlbmd0aDthKyspYz1kW2FdLGU9Yy5fZ2V0VmVyc2lvbixlPWUoYy5fc291cmNlKSxudWxsPT1iLm11dGFibGVTb3VyY2VFYWdlckh5ZHJhdGlvbkRhdGE/Yi5tdXRhYmxlU291cmNlRWFnZXJIeWRyYXRpb25EYXRhPVtjLGVdOmIubXV0YWJsZVNvdXJjZUVhZ2VySHlkcmF0aW9uRGF0YS5wdXNoKGMsCmUpO3JldHVybiBuZXcgbmwoYil9O2V4cG9ydHMucmVuZGVyPWZ1bmN0aW9uKGEsYixjKXtpZighcGwoYikpdGhyb3cgRXJyb3IocCgyMDApKTtyZXR1cm4gc2wobnVsbCxhLGIsITEsYyl9O2V4cG9ydHMudW5tb3VudENvbXBvbmVudEF0Tm9kZT1mdW5jdGlvbihhKXtpZighcGwoYSkpdGhyb3cgRXJyb3IocCg0MCkpO3JldHVybiBhLl9yZWFjdFJvb3RDb250YWluZXI/KFNrKGZ1bmN0aW9uKCl7c2wobnVsbCxudWxsLGEsITEsZnVuY3Rpb24oKXthLl9yZWFjdFJvb3RDb250YWluZXI9bnVsbDthW3VmXT1udWxsfSl9KSwhMCk6ITF9O2V4cG9ydHMudW5zdGFibGVfYmF0Y2hlZFVwZGF0ZXM9Ums7CmV4cG9ydHMudW5zdGFibGVfcmVuZGVyU3VidHJlZUludG9Db250YWluZXI9ZnVuY3Rpb24oYSxiLGMsZCl7aWYoIXBsKGMpKXRocm93IEVycm9yKHAoMjAwKSk7aWYobnVsbD09YXx8dm9pZCAwPT09YS5fcmVhY3RJbnRlcm5hbHMpdGhyb3cgRXJyb3IocCgzOCkpO3JldHVybiBzbChhLGIsYywhMSxkKX07ZXhwb3J0cy52ZXJzaW9uPSIxOC4yLjAtbmV4dC05ZTNiNzcyYjgtMjAyMjA2MDgiOwoKCi8qKiovIH0pLAoKLyoqKi8gNzQ1OgovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7Cgp2YXIgX193ZWJwYWNrX3VudXNlZF9leHBvcnRfXzsKCgp2YXIgbSA9IF9fd2VicGFja19yZXF1aXJlX18oOTM1KTsKaWYgKHRydWUpIHsKICBleHBvcnRzLnMgPSBtLmNyZWF0ZVJvb3Q7CiAgX193ZWJwYWNrX3VudXNlZF9leHBvcnRfXyA9IG0uaHlkcmF0ZVJvb3Q7Cn0gZWxzZSB7IHZhciBpOyB9CgoKLyoqKi8gfSksCgovKioqLyA5MzU6Ci8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgoKZnVuY3Rpb24gY2hlY2tEQ0UoKSB7CiAgLyogZ2xvYmFsIF9fUkVBQ1RfREVWVE9PTFNfR0xPQkFMX0hPT0tfXyAqLwogIGlmICgKICAgIHR5cGVvZiBfX1JFQUNUX0RFVlRPT0xTX0dMT0JBTF9IT09LX18gPT09ICd1bmRlZmluZWQnIHx8CiAgICB0eXBlb2YgX19SRUFDVF9ERVZUT09MU19HTE9CQUxfSE9PS19fLmNoZWNrRENFICE9PSAnZnVuY3Rpb24nCiAgKSB7CiAgICByZXR1cm47CiAgfQogIGlmIChmYWxzZSkge30KICB0cnkgewogICAgLy8gVmVyaWZ5IHRoYXQgdGhlIGNvZGUgYWJvdmUgaGFzIGJlZW4gZGVhZCBjb2RlIGVsaW1pbmF0ZWQgKERDRSdkKS4KICAgIF9fUkVBQ1RfREVWVE9PTFNfR0xPQkFMX0hPT0tfXy5jaGVja0RDRShjaGVja0RDRSk7CiAgfSBjYXRjaCAoZXJyKSB7CiAgICAvLyBEZXZUb29scyBzaG91bGRuJ3QgY3Jhc2ggUmVhY3QsIG5vIG1hdHRlciB3aGF0LgogICAgLy8gV2Ugc2hvdWxkIHN0aWxsIHJlcG9ydCBpbiBjYXNlIHdlIGJyZWFrIHRoaXMgY29kZS4KICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICB9Cn0KCmlmICh0cnVlKSB7CiAgLy8gRENFIGNoZWNrIHNob3VsZCBoYXBwZW4gYmVmb3JlIFJlYWN0RE9NIGJ1bmRsZSBleGVjdXRlcyBzbyB0aGF0CiAgLy8gRGV2VG9vbHMgY2FuIHJlcG9ydCBiYWQgbWluaWZpY2F0aW9uIGR1cmluZyBpbmplY3Rpb24uCiAgY2hlY2tEQ0UoKTsKICBtb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oNDQ4KTsKfSBlbHNlIHt9CgoKLyoqKi8gfSksCgovKioqLyA0MDg6Ci8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMpID0+IHsKCi8qKgogKiBAbGljZW5zZSBSZWFjdAogKiByZWFjdC5wcm9kdWN0aW9uLm1pbi5qcwogKgogKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy4KICoKICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4KICovCnZhciBsPVN5bWJvbC5mb3IoInJlYWN0LmVsZW1lbnQiKSxuPVN5bWJvbC5mb3IoInJlYWN0LnBvcnRhbCIpLHA9U3ltYm9sLmZvcigicmVhY3QuZnJhZ21lbnQiKSxxPVN5bWJvbC5mb3IoInJlYWN0LnN0cmljdF9tb2RlIikscj1TeW1ib2wuZm9yKCJyZWFjdC5wcm9maWxlciIpLHQ9U3ltYm9sLmZvcigicmVhY3QucHJvdmlkZXIiKSx1PVN5bWJvbC5mb3IoInJlYWN0LmNvbnRleHQiKSx2PVN5bWJvbC5mb3IoInJlYWN0LmZvcndhcmRfcmVmIiksdz1TeW1ib2wuZm9yKCJyZWFjdC5zdXNwZW5zZSIpLHg9U3ltYm9sLmZvcigicmVhY3QubWVtbyIpLHk9U3ltYm9sLmZvcigicmVhY3QubGF6eSIpLHo9U3ltYm9sLml0ZXJhdG9yO2Z1bmN0aW9uIEEoYSl7aWYobnVsbD09PWF8fCJvYmplY3QiIT09dHlwZW9mIGEpcmV0dXJuIG51bGw7YT16JiZhW3pdfHxhWyJAQGl0ZXJhdG9yIl07cmV0dXJuImZ1bmN0aW9uIj09PXR5cGVvZiBhP2E6bnVsbH0KdmFyIEI9e2lzTW91bnRlZDpmdW5jdGlvbigpe3JldHVybiExfSxlbnF1ZXVlRm9yY2VVcGRhdGU6ZnVuY3Rpb24oKXt9LGVucXVldWVSZXBsYWNlU3RhdGU6ZnVuY3Rpb24oKXt9LGVucXVldWVTZXRTdGF0ZTpmdW5jdGlvbigpe319LEM9T2JqZWN0LmFzc2lnbixEPXt9O2Z1bmN0aW9uIEUoYSxiLGUpe3RoaXMucHJvcHM9YTt0aGlzLmNvbnRleHQ9Yjt0aGlzLnJlZnM9RDt0aGlzLnVwZGF0ZXI9ZXx8Qn1FLnByb3RvdHlwZS5pc1JlYWN0Q29tcG9uZW50PXt9OwpFLnByb3RvdHlwZS5zZXRTdGF0ZT1mdW5jdGlvbihhLGIpe2lmKCJvYmplY3QiIT09dHlwZW9mIGEmJiJmdW5jdGlvbiIhPT10eXBlb2YgYSYmbnVsbCE9YSl0aHJvdyBFcnJvcigic2V0U3RhdGUoLi4uKTogdGFrZXMgYW4gb2JqZWN0IG9mIHN0YXRlIHZhcmlhYmxlcyB0byB1cGRhdGUgb3IgYSBmdW5jdGlvbiB3aGljaCByZXR1cm5zIGFuIG9iamVjdCBvZiBzdGF0ZSB2YXJpYWJsZXMuIik7dGhpcy51cGRhdGVyLmVucXVldWVTZXRTdGF0ZSh0aGlzLGEsYiwic2V0U3RhdGUiKX07RS5wcm90b3R5cGUuZm9yY2VVcGRhdGU9ZnVuY3Rpb24oYSl7dGhpcy51cGRhdGVyLmVucXVldWVGb3JjZVVwZGF0ZSh0aGlzLGEsImZvcmNlVXBkYXRlIil9O2Z1bmN0aW9uIEYoKXt9Ri5wcm90b3R5cGU9RS5wcm90b3R5cGU7ZnVuY3Rpb24gRyhhLGIsZSl7dGhpcy5wcm9wcz1hO3RoaXMuY29udGV4dD1iO3RoaXMucmVmcz1EO3RoaXMudXBkYXRlcj1lfHxCfXZhciBIPUcucHJvdG90eXBlPW5ldyBGOwpILmNvbnN0cnVjdG9yPUc7QyhILEUucHJvdG90eXBlKTtILmlzUHVyZVJlYWN0Q29tcG9uZW50PSEwO3ZhciBJPUFycmF5LmlzQXJyYXksSj1PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LEs9e2N1cnJlbnQ6bnVsbH0sTD17a2V5OiEwLHJlZjohMCxfX3NlbGY6ITAsX19zb3VyY2U6ITB9OwpmdW5jdGlvbiBNKGEsYixlKXt2YXIgZCxjPXt9LGs9bnVsbCxoPW51bGw7aWYobnVsbCE9Yilmb3IoZCBpbiB2b2lkIDAhPT1iLnJlZiYmKGg9Yi5yZWYpLHZvaWQgMCE9PWIua2V5JiYoaz0iIitiLmtleSksYilKLmNhbGwoYixkKSYmIUwuaGFzT3duUHJvcGVydHkoZCkmJihjW2RdPWJbZF0pO3ZhciBnPWFyZ3VtZW50cy5sZW5ndGgtMjtpZigxPT09ZyljLmNoaWxkcmVuPWU7ZWxzZSBpZigxPGcpe2Zvcih2YXIgZj1BcnJheShnKSxtPTA7bTxnO20rKylmW21dPWFyZ3VtZW50c1ttKzJdO2MuY2hpbGRyZW49Zn1pZihhJiZhLmRlZmF1bHRQcm9wcylmb3IoZCBpbiBnPWEuZGVmYXVsdFByb3BzLGcpdm9pZCAwPT09Y1tkXSYmKGNbZF09Z1tkXSk7cmV0dXJueyQkdHlwZW9mOmwsdHlwZTphLGtleTprLHJlZjpoLHByb3BzOmMsX293bmVyOksuY3VycmVudH19CmZ1bmN0aW9uIE4oYSxiKXtyZXR1cm57JCR0eXBlb2Y6bCx0eXBlOmEudHlwZSxrZXk6YixyZWY6YS5yZWYscHJvcHM6YS5wcm9wcyxfb3duZXI6YS5fb3duZXJ9fWZ1bmN0aW9uIE8oYSl7cmV0dXJuIm9iamVjdCI9PT10eXBlb2YgYSYmbnVsbCE9PWEmJmEuJCR0eXBlb2Y9PT1sfWZ1bmN0aW9uIGVzY2FwZShhKXt2YXIgYj17Ij0iOiI9MCIsIjoiOiI9MiJ9O3JldHVybiIkIithLnJlcGxhY2UoL1s9Ol0vZyxmdW5jdGlvbihhKXtyZXR1cm4gYlthXX0pfXZhciBQPS9cLysvZztmdW5jdGlvbiBRKGEsYil7cmV0dXJuIm9iamVjdCI9PT10eXBlb2YgYSYmbnVsbCE9PWEmJm51bGwhPWEua2V5P2VzY2FwZSgiIithLmtleSk6Yi50b1N0cmluZygzNil9CmZ1bmN0aW9uIFIoYSxiLGUsZCxjKXt2YXIgaz10eXBlb2YgYTtpZigidW5kZWZpbmVkIj09PWt8fCJib29sZWFuIj09PWspYT1udWxsO3ZhciBoPSExO2lmKG51bGw9PT1hKWg9ITA7ZWxzZSBzd2l0Y2goayl7Y2FzZSAic3RyaW5nIjpjYXNlICJudW1iZXIiOmg9ITA7YnJlYWs7Y2FzZSAib2JqZWN0Ijpzd2l0Y2goYS4kJHR5cGVvZil7Y2FzZSBsOmNhc2UgbjpoPSEwfX1pZihoKXJldHVybiBoPWEsYz1jKGgpLGE9IiI9PT1kPyIuIitRKGgsMCk6ZCxJKGMpPyhlPSIiLG51bGwhPWEmJihlPWEucmVwbGFjZShQLCIkJi8iKSsiLyIpLFIoYyxiLGUsIiIsZnVuY3Rpb24oYSl7cmV0dXJuIGF9KSk6bnVsbCE9YyYmKE8oYykmJihjPU4oYyxlKyghYy5rZXl8fGgmJmgua2V5PT09Yy5rZXk/IiI6KCIiK2Mua2V5KS5yZXBsYWNlKFAsIiQmLyIpKyIvIikrYSkpLGIucHVzaChjKSksMTtoPTA7ZD0iIj09PWQ/Ii4iOmQrIjoiO2lmKEkoYSkpZm9yKHZhciBnPTA7ZzxhLmxlbmd0aDtnKyspe2s9CmFbZ107dmFyIGY9ZCtRKGssZyk7aCs9UihrLGIsZSxmLGMpfWVsc2UgaWYoZj1BKGEpLCJmdW5jdGlvbiI9PT10eXBlb2YgZilmb3IoYT1mLmNhbGwoYSksZz0wOyEoaz1hLm5leHQoKSkuZG9uZTspaz1rLnZhbHVlLGY9ZCtRKGssZysrKSxoKz1SKGssYixlLGYsYyk7ZWxzZSBpZigib2JqZWN0Ij09PWspdGhyb3cgYj1TdHJpbmcoYSksRXJyb3IoIk9iamVjdHMgYXJlIG5vdCB2YWxpZCBhcyBhIFJlYWN0IGNoaWxkIChmb3VuZDogIisoIltvYmplY3QgT2JqZWN0XSI9PT1iPyJvYmplY3Qgd2l0aCBrZXlzIHsiK09iamVjdC5rZXlzKGEpLmpvaW4oIiwgIikrIn0iOmIpKyIpLiBJZiB5b3UgbWVhbnQgdG8gcmVuZGVyIGEgY29sbGVjdGlvbiBvZiBjaGlsZHJlbiwgdXNlIGFuIGFycmF5IGluc3RlYWQuIik7cmV0dXJuIGh9CmZ1bmN0aW9uIFMoYSxiLGUpe2lmKG51bGw9PWEpcmV0dXJuIGE7dmFyIGQ9W10sYz0wO1IoYSxkLCIiLCIiLGZ1bmN0aW9uKGEpe3JldHVybiBiLmNhbGwoZSxhLGMrKyl9KTtyZXR1cm4gZH1mdW5jdGlvbiBUKGEpe2lmKC0xPT09YS5fc3RhdHVzKXt2YXIgYj1hLl9yZXN1bHQ7Yj1iKCk7Yi50aGVuKGZ1bmN0aW9uKGIpe2lmKDA9PT1hLl9zdGF0dXN8fC0xPT09YS5fc3RhdHVzKWEuX3N0YXR1cz0xLGEuX3Jlc3VsdD1ifSxmdW5jdGlvbihiKXtpZigwPT09YS5fc3RhdHVzfHwtMT09PWEuX3N0YXR1cylhLl9zdGF0dXM9MixhLl9yZXN1bHQ9Yn0pOy0xPT09YS5fc3RhdHVzJiYoYS5fc3RhdHVzPTAsYS5fcmVzdWx0PWIpfWlmKDE9PT1hLl9zdGF0dXMpcmV0dXJuIGEuX3Jlc3VsdC5kZWZhdWx0O3Rocm93IGEuX3Jlc3VsdDt9CnZhciBVPXtjdXJyZW50Om51bGx9LFY9e3RyYW5zaXRpb246bnVsbH0sVz17UmVhY3RDdXJyZW50RGlzcGF0Y2hlcjpVLFJlYWN0Q3VycmVudEJhdGNoQ29uZmlnOlYsUmVhY3RDdXJyZW50T3duZXI6S307ZXhwb3J0cy5DaGlsZHJlbj17bWFwOlMsZm9yRWFjaDpmdW5jdGlvbihhLGIsZSl7UyhhLGZ1bmN0aW9uKCl7Yi5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LGUpfSxjb3VudDpmdW5jdGlvbihhKXt2YXIgYj0wO1MoYSxmdW5jdGlvbigpe2IrK30pO3JldHVybiBifSx0b0FycmF5OmZ1bmN0aW9uKGEpe3JldHVybiBTKGEsZnVuY3Rpb24oYSl7cmV0dXJuIGF9KXx8W119LG9ubHk6ZnVuY3Rpb24oYSl7aWYoIU8oYSkpdGhyb3cgRXJyb3IoIlJlYWN0LkNoaWxkcmVuLm9ubHkgZXhwZWN0ZWQgdG8gcmVjZWl2ZSBhIHNpbmdsZSBSZWFjdCBlbGVtZW50IGNoaWxkLiIpO3JldHVybiBhfX07ZXhwb3J0cy5Db21wb25lbnQ9RTtleHBvcnRzLkZyYWdtZW50PXA7CmV4cG9ydHMuUHJvZmlsZXI9cjtleHBvcnRzLlB1cmVDb21wb25lbnQ9RztleHBvcnRzLlN0cmljdE1vZGU9cTtleHBvcnRzLlN1c3BlbnNlPXc7ZXhwb3J0cy5fX1NFQ1JFVF9JTlRFUk5BTFNfRE9fTk9UX1VTRV9PUl9ZT1VfV0lMTF9CRV9GSVJFRD1XOwpleHBvcnRzLmNsb25lRWxlbWVudD1mdW5jdGlvbihhLGIsZSl7aWYobnVsbD09PWF8fHZvaWQgMD09PWEpdGhyb3cgRXJyb3IoIlJlYWN0LmNsb25lRWxlbWVudCguLi4pOiBUaGUgYXJndW1lbnQgbXVzdCBiZSBhIFJlYWN0IGVsZW1lbnQsIGJ1dCB5b3UgcGFzc2VkICIrYSsiLiIpO3ZhciBkPUMoe30sYS5wcm9wcyksYz1hLmtleSxrPWEucmVmLGg9YS5fb3duZXI7aWYobnVsbCE9Yil7dm9pZCAwIT09Yi5yZWYmJihrPWIucmVmLGg9Sy5jdXJyZW50KTt2b2lkIDAhPT1iLmtleSYmKGM9IiIrYi5rZXkpO2lmKGEudHlwZSYmYS50eXBlLmRlZmF1bHRQcm9wcyl2YXIgZz1hLnR5cGUuZGVmYXVsdFByb3BzO2ZvcihmIGluIGIpSi5jYWxsKGIsZikmJiFMLmhhc093blByb3BlcnR5KGYpJiYoZFtmXT12b2lkIDA9PT1iW2ZdJiZ2b2lkIDAhPT1nP2dbZl06YltmXSl9dmFyIGY9YXJndW1lbnRzLmxlbmd0aC0yO2lmKDE9PT1mKWQuY2hpbGRyZW49ZTtlbHNlIGlmKDE8Zil7Zz1BcnJheShmKTsKZm9yKHZhciBtPTA7bTxmO20rKylnW21dPWFyZ3VtZW50c1ttKzJdO2QuY2hpbGRyZW49Z31yZXR1cm57JCR0eXBlb2Y6bCx0eXBlOmEudHlwZSxrZXk6YyxyZWY6ayxwcm9wczpkLF9vd25lcjpofX07ZXhwb3J0cy5jcmVhdGVDb250ZXh0PWZ1bmN0aW9uKGEpe2E9eyQkdHlwZW9mOnUsX2N1cnJlbnRWYWx1ZTphLF9jdXJyZW50VmFsdWUyOmEsX3RocmVhZENvdW50OjAsUHJvdmlkZXI6bnVsbCxDb25zdW1lcjpudWxsLF9kZWZhdWx0VmFsdWU6bnVsbCxfZ2xvYmFsTmFtZTpudWxsfTthLlByb3ZpZGVyPXskJHR5cGVvZjp0LF9jb250ZXh0OmF9O3JldHVybiBhLkNvbnN1bWVyPWF9O2V4cG9ydHMuY3JlYXRlRWxlbWVudD1NO2V4cG9ydHMuY3JlYXRlRmFjdG9yeT1mdW5jdGlvbihhKXt2YXIgYj1NLmJpbmQobnVsbCxhKTtiLnR5cGU9YTtyZXR1cm4gYn07ZXhwb3J0cy5jcmVhdGVSZWY9ZnVuY3Rpb24oKXtyZXR1cm57Y3VycmVudDpudWxsfX07CmV4cG9ydHMuZm9yd2FyZFJlZj1mdW5jdGlvbihhKXtyZXR1cm57JCR0eXBlb2Y6dixyZW5kZXI6YX19O2V4cG9ydHMuaXNWYWxpZEVsZW1lbnQ9TztleHBvcnRzLmxhenk9ZnVuY3Rpb24oYSl7cmV0dXJueyQkdHlwZW9mOnksX3BheWxvYWQ6e19zdGF0dXM6LTEsX3Jlc3VsdDphfSxfaW5pdDpUfX07ZXhwb3J0cy5tZW1vPWZ1bmN0aW9uKGEsYil7cmV0dXJueyQkdHlwZW9mOngsdHlwZTphLGNvbXBhcmU6dm9pZCAwPT09Yj9udWxsOmJ9fTtleHBvcnRzLnN0YXJ0VHJhbnNpdGlvbj1mdW5jdGlvbihhKXt2YXIgYj1WLnRyYW5zaXRpb247Vi50cmFuc2l0aW9uPXt9O3RyeXthKCl9ZmluYWxseXtWLnRyYW5zaXRpb249Yn19O2V4cG9ydHMudW5zdGFibGVfYWN0PWZ1bmN0aW9uKCl7dGhyb3cgRXJyb3IoImFjdCguLi4pIGlzIG5vdCBzdXBwb3J0ZWQgaW4gcHJvZHVjdGlvbiBidWlsZHMgb2YgUmVhY3QuIik7fTsKZXhwb3J0cy51c2VDYWxsYmFjaz1mdW5jdGlvbihhLGIpe3JldHVybiBVLmN1cnJlbnQudXNlQ2FsbGJhY2soYSxiKX07ZXhwb3J0cy51c2VDb250ZXh0PWZ1bmN0aW9uKGEpe3JldHVybiBVLmN1cnJlbnQudXNlQ29udGV4dChhKX07ZXhwb3J0cy51c2VEZWJ1Z1ZhbHVlPWZ1bmN0aW9uKCl7fTtleHBvcnRzLnVzZURlZmVycmVkVmFsdWU9ZnVuY3Rpb24oYSl7cmV0dXJuIFUuY3VycmVudC51c2VEZWZlcnJlZFZhbHVlKGEpfTtleHBvcnRzLnVzZUVmZmVjdD1mdW5jdGlvbihhLGIpe3JldHVybiBVLmN1cnJlbnQudXNlRWZmZWN0KGEsYil9O2V4cG9ydHMudXNlSWQ9ZnVuY3Rpb24oKXtyZXR1cm4gVS5jdXJyZW50LnVzZUlkKCl9O2V4cG9ydHMudXNlSW1wZXJhdGl2ZUhhbmRsZT1mdW5jdGlvbihhLGIsZSl7cmV0dXJuIFUuY3VycmVudC51c2VJbXBlcmF0aXZlSGFuZGxlKGEsYixlKX07CmV4cG9ydHMudXNlSW5zZXJ0aW9uRWZmZWN0PWZ1bmN0aW9uKGEsYil7cmV0dXJuIFUuY3VycmVudC51c2VJbnNlcnRpb25FZmZlY3QoYSxiKX07ZXhwb3J0cy51c2VMYXlvdXRFZmZlY3Q9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gVS5jdXJyZW50LnVzZUxheW91dEVmZmVjdChhLGIpfTtleHBvcnRzLnVzZU1lbW89ZnVuY3Rpb24oYSxiKXtyZXR1cm4gVS5jdXJyZW50LnVzZU1lbW8oYSxiKX07ZXhwb3J0cy51c2VSZWR1Y2VyPWZ1bmN0aW9uKGEsYixlKXtyZXR1cm4gVS5jdXJyZW50LnVzZVJlZHVjZXIoYSxiLGUpfTtleHBvcnRzLnVzZVJlZj1mdW5jdGlvbihhKXtyZXR1cm4gVS5jdXJyZW50LnVzZVJlZihhKX07ZXhwb3J0cy51c2VTdGF0ZT1mdW5jdGlvbihhKXtyZXR1cm4gVS5jdXJyZW50LnVzZVN0YXRlKGEpfTtleHBvcnRzLnVzZVN5bmNFeHRlcm5hbFN0b3JlPWZ1bmN0aW9uKGEsYixlKXtyZXR1cm4gVS5jdXJyZW50LnVzZVN5bmNFeHRlcm5hbFN0b3JlKGEsYixlKX07CmV4cG9ydHMudXNlVHJhbnNpdGlvbj1mdW5jdGlvbigpe3JldHVybiBVLmN1cnJlbnQudXNlVHJhbnNpdGlvbigpfTtleHBvcnRzLnZlcnNpb249IjE4LjIuMCI7CgoKLyoqKi8gfSksCgovKioqLyAyOTQ6Ci8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgoKaWYgKHRydWUpIHsKICBtb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oNDA4KTsKfSBlbHNlIHt9CgoKLyoqKi8gfSksCgovKioqLyA1MzoKLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cykgPT4gewoKLyoqCiAqIEBsaWNlbnNlIFJlYWN0CiAqIHNjaGVkdWxlci5wcm9kdWN0aW9uLm1pbi5qcwogKgogKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy4KICoKICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4KICovCmZ1bmN0aW9uIGYoYSxiKXt2YXIgYz1hLmxlbmd0aDthLnB1c2goYik7YTpmb3IoOzA8Yzspe3ZhciBkPWMtMT4+PjEsZT1hW2RdO2lmKDA8ZyhlLGIpKWFbZF09YixhW2NdPWUsYz1kO2Vsc2UgYnJlYWsgYX19ZnVuY3Rpb24gaChhKXtyZXR1cm4gMD09PWEubGVuZ3RoP251bGw6YVswXX1mdW5jdGlvbiBrKGEpe2lmKDA9PT1hLmxlbmd0aClyZXR1cm4gbnVsbDt2YXIgYj1hWzBdLGM9YS5wb3AoKTtpZihjIT09Yil7YVswXT1jO2E6Zm9yKHZhciBkPTAsZT1hLmxlbmd0aCx3PWU+Pj4xO2Q8dzspe3ZhciBtPTIqKGQrMSktMSxDPWFbbV0sbj1tKzEseD1hW25dO2lmKDA+ZyhDLGMpKW48ZSYmMD5nKHgsQyk/KGFbZF09eCxhW25dPWMsZD1uKTooYVtkXT1DLGFbbV09YyxkPW0pO2Vsc2UgaWYobjxlJiYwPmcoeCxjKSlhW2RdPXgsYVtuXT1jLGQ9bjtlbHNlIGJyZWFrIGF9fXJldHVybiBifQpmdW5jdGlvbiBnKGEsYil7dmFyIGM9YS5zb3J0SW5kZXgtYi5zb3J0SW5kZXg7cmV0dXJuIDAhPT1jP2M6YS5pZC1iLmlkfWlmKCJvYmplY3QiPT09dHlwZW9mIHBlcmZvcm1hbmNlJiYiZnVuY3Rpb24iPT09dHlwZW9mIHBlcmZvcm1hbmNlLm5vdyl7dmFyIGw9cGVyZm9ybWFuY2U7ZXhwb3J0cy51bnN0YWJsZV9ub3c9ZnVuY3Rpb24oKXtyZXR1cm4gbC5ub3coKX19ZWxzZXt2YXIgcD1EYXRlLHE9cC5ub3coKTtleHBvcnRzLnVuc3RhYmxlX25vdz1mdW5jdGlvbigpe3JldHVybiBwLm5vdygpLXF9fXZhciByPVtdLHQ9W10sdT0xLHY9bnVsbCx5PTMsej0hMSxBPSExLEI9ITEsRD0iZnVuY3Rpb24iPT09dHlwZW9mIHNldFRpbWVvdXQ/c2V0VGltZW91dDpudWxsLEU9ImZ1bmN0aW9uIj09PXR5cGVvZiBjbGVhclRpbWVvdXQ/Y2xlYXJUaW1lb3V0Om51bGwsRj0idW5kZWZpbmVkIiE9PXR5cGVvZiBzZXRJbW1lZGlhdGU/c2V0SW1tZWRpYXRlOm51bGw7CiJ1bmRlZmluZWQiIT09dHlwZW9mIG5hdmlnYXRvciYmdm9pZCAwIT09bmF2aWdhdG9yLnNjaGVkdWxpbmcmJnZvaWQgMCE9PW5hdmlnYXRvci5zY2hlZHVsaW5nLmlzSW5wdXRQZW5kaW5nJiZuYXZpZ2F0b3Iuc2NoZWR1bGluZy5pc0lucHV0UGVuZGluZy5iaW5kKG5hdmlnYXRvci5zY2hlZHVsaW5nKTtmdW5jdGlvbiBHKGEpe2Zvcih2YXIgYj1oKHQpO251bGwhPT1iOyl7aWYobnVsbD09PWIuY2FsbGJhY2spayh0KTtlbHNlIGlmKGIuc3RhcnRUaW1lPD1hKWsodCksYi5zb3J0SW5kZXg9Yi5leHBpcmF0aW9uVGltZSxmKHIsYik7ZWxzZSBicmVhaztiPWgodCl9fWZ1bmN0aW9uIEgoYSl7Qj0hMTtHKGEpO2lmKCFBKWlmKG51bGwhPT1oKHIpKUE9ITAsSShKKTtlbHNle3ZhciBiPWgodCk7bnVsbCE9PWImJksoSCxiLnN0YXJ0VGltZS1hKX19CmZ1bmN0aW9uIEooYSxiKXtBPSExO0ImJihCPSExLEUoTCksTD0tMSk7ej0hMDt2YXIgYz15O3RyeXtHKGIpO2Zvcih2PWgocik7bnVsbCE9PXYmJighKHYuZXhwaXJhdGlvblRpbWU+Yil8fGEmJiFNKCkpOyl7dmFyIGQ9di5jYWxsYmFjaztpZigiZnVuY3Rpb24iPT09dHlwZW9mIGQpe3YuY2FsbGJhY2s9bnVsbDt5PXYucHJpb3JpdHlMZXZlbDt2YXIgZT1kKHYuZXhwaXJhdGlvblRpbWU8PWIpO2I9ZXhwb3J0cy51bnN0YWJsZV9ub3coKTsiZnVuY3Rpb24iPT09dHlwZW9mIGU/di5jYWxsYmFjaz1lOnY9PT1oKHIpJiZrKHIpO0coYil9ZWxzZSBrKHIpO3Y9aChyKX1pZihudWxsIT09dil2YXIgdz0hMDtlbHNle3ZhciBtPWgodCk7bnVsbCE9PW0mJksoSCxtLnN0YXJ0VGltZS1iKTt3PSExfXJldHVybiB3fWZpbmFsbHl7dj1udWxsLHk9Yyx6PSExfX12YXIgTj0hMSxPPW51bGwsTD0tMSxQPTUsUT0tMTsKZnVuY3Rpb24gTSgpe3JldHVybiBleHBvcnRzLnVuc3RhYmxlX25vdygpLVE8UD8hMTohMH1mdW5jdGlvbiBSKCl7aWYobnVsbCE9PU8pe3ZhciBhPWV4cG9ydHMudW5zdGFibGVfbm93KCk7UT1hO3ZhciBiPSEwO3RyeXtiPU8oITAsYSl9ZmluYWxseXtiP1MoKTooTj0hMSxPPW51bGwpfX1lbHNlIE49ITF9dmFyIFM7aWYoImZ1bmN0aW9uIj09PXR5cGVvZiBGKVM9ZnVuY3Rpb24oKXtGKFIpfTtlbHNlIGlmKCJ1bmRlZmluZWQiIT09dHlwZW9mIE1lc3NhZ2VDaGFubmVsKXt2YXIgVD1uZXcgTWVzc2FnZUNoYW5uZWwsVT1ULnBvcnQyO1QucG9ydDEub25tZXNzYWdlPVI7Uz1mdW5jdGlvbigpe1UucG9zdE1lc3NhZ2UobnVsbCl9fWVsc2UgUz1mdW5jdGlvbigpe0QoUiwwKX07ZnVuY3Rpb24gSShhKXtPPWE7Tnx8KE49ITAsUygpKX1mdW5jdGlvbiBLKGEsYil7TD1EKGZ1bmN0aW9uKCl7YShleHBvcnRzLnVuc3RhYmxlX25vdygpKX0sYil9CmV4cG9ydHMudW5zdGFibGVfSWRsZVByaW9yaXR5PTU7ZXhwb3J0cy51bnN0YWJsZV9JbW1lZGlhdGVQcmlvcml0eT0xO2V4cG9ydHMudW5zdGFibGVfTG93UHJpb3JpdHk9NDtleHBvcnRzLnVuc3RhYmxlX05vcm1hbFByaW9yaXR5PTM7ZXhwb3J0cy51bnN0YWJsZV9Qcm9maWxpbmc9bnVsbDtleHBvcnRzLnVuc3RhYmxlX1VzZXJCbG9ja2luZ1ByaW9yaXR5PTI7ZXhwb3J0cy51bnN0YWJsZV9jYW5jZWxDYWxsYmFjaz1mdW5jdGlvbihhKXthLmNhbGxiYWNrPW51bGx9O2V4cG9ydHMudW5zdGFibGVfY29udGludWVFeGVjdXRpb249ZnVuY3Rpb24oKXtBfHx6fHwoQT0hMCxJKEopKX07CmV4cG9ydHMudW5zdGFibGVfZm9yY2VGcmFtZVJhdGU9ZnVuY3Rpb24oYSl7MD5hfHwxMjU8YT9jb25zb2xlLmVycm9yKCJmb3JjZUZyYW1lUmF0ZSB0YWtlcyBhIHBvc2l0aXZlIGludCBiZXR3ZWVuIDAgYW5kIDEyNSwgZm9yY2luZyBmcmFtZSByYXRlcyBoaWdoZXIgdGhhbiAxMjUgZnBzIGlzIG5vdCBzdXBwb3J0ZWQiKTpQPTA8YT9NYXRoLmZsb29yKDFFMy9hKTo1fTtleHBvcnRzLnVuc3RhYmxlX2dldEN1cnJlbnRQcmlvcml0eUxldmVsPWZ1bmN0aW9uKCl7cmV0dXJuIHl9O2V4cG9ydHMudW5zdGFibGVfZ2V0Rmlyc3RDYWxsYmFja05vZGU9ZnVuY3Rpb24oKXtyZXR1cm4gaChyKX07ZXhwb3J0cy51bnN0YWJsZV9uZXh0PWZ1bmN0aW9uKGEpe3N3aXRjaCh5KXtjYXNlIDE6Y2FzZSAyOmNhc2UgMzp2YXIgYj0zO2JyZWFrO2RlZmF1bHQ6Yj15fXZhciBjPXk7eT1iO3RyeXtyZXR1cm4gYSgpfWZpbmFsbHl7eT1jfX07ZXhwb3J0cy51bnN0YWJsZV9wYXVzZUV4ZWN1dGlvbj1mdW5jdGlvbigpe307CmV4cG9ydHMudW5zdGFibGVfcmVxdWVzdFBhaW50PWZ1bmN0aW9uKCl7fTtleHBvcnRzLnVuc3RhYmxlX3J1bldpdGhQcmlvcml0eT1mdW5jdGlvbihhLGIpe3N3aXRjaChhKXtjYXNlIDE6Y2FzZSAyOmNhc2UgMzpjYXNlIDQ6Y2FzZSA1OmJyZWFrO2RlZmF1bHQ6YT0zfXZhciBjPXk7eT1hO3RyeXtyZXR1cm4gYigpfWZpbmFsbHl7eT1jfX07CmV4cG9ydHMudW5zdGFibGVfc2NoZWR1bGVDYWxsYmFjaz1mdW5jdGlvbihhLGIsYyl7dmFyIGQ9ZXhwb3J0cy51bnN0YWJsZV9ub3coKTsib2JqZWN0Ij09PXR5cGVvZiBjJiZudWxsIT09Yz8oYz1jLmRlbGF5LGM9Im51bWJlciI9PT10eXBlb2YgYyYmMDxjP2QrYzpkKTpjPWQ7c3dpdGNoKGEpe2Nhc2UgMTp2YXIgZT0tMTticmVhaztjYXNlIDI6ZT0yNTA7YnJlYWs7Y2FzZSA1OmU9MTA3Mzc0MTgyMzticmVhaztjYXNlIDQ6ZT0xRTQ7YnJlYWs7ZGVmYXVsdDplPTVFM31lPWMrZTthPXtpZDp1KyssY2FsbGJhY2s6Yixwcmlvcml0eUxldmVsOmEsc3RhcnRUaW1lOmMsZXhwaXJhdGlvblRpbWU6ZSxzb3J0SW5kZXg6LTF9O2M+ZD8oYS5zb3J0SW5kZXg9YyxmKHQsYSksbnVsbD09PWgocikmJmE9PT1oKHQpJiYoQj8oRShMKSxMPS0xKTpCPSEwLEsoSCxjLWQpKSk6KGEuc29ydEluZGV4PWUsZihyLGEpLEF8fHp8fChBPSEwLEkoSikpKTtyZXR1cm4gYX07CmV4cG9ydHMudW5zdGFibGVfc2hvdWxkWWllbGQ9TTtleHBvcnRzLnVuc3RhYmxlX3dyYXBDYWxsYmFjaz1mdW5jdGlvbihhKXt2YXIgYj15O3JldHVybiBmdW5jdGlvbigpe3ZhciBjPXk7eT1iO3RyeXtyZXR1cm4gYS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9ZmluYWxseXt5PWN9fX07CgoKLyoqKi8gfSksCgovKioqLyA4NDA6Ci8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgoKaWYgKHRydWUpIHsKICBtb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oNTMpOwp9IGVsc2Uge30KCgovKioqLyB9KQoKLyoqKioqKi8gCX0pOwovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKioqKioqLyAJLy8gVGhlIG1vZHVsZSBjYWNoZQovKioqKioqLyAJdmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9OwovKioqKioqLyAJCi8qKioqKiovIAkvLyBUaGUgcmVxdWlyZSBmdW5jdGlvbgovKioqKioqLyAJZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkgewovKioqKioqLyAJCS8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZQovKioqKioqLyAJCXZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdOwovKioqKioqLyAJCWlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkgewovKioqKioqLyAJCQlyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7Ci8qKioqKiovIAkJfQovKioqKioqLyAJCS8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpCi8qKioqKiovIAkJdmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7Ci8qKioqKiovIAkJCS8vIG5vIG1vZHVsZS5pZCBuZWVkZWQKLyoqKioqKi8gCQkJLy8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWQKLyoqKioqKi8gCQkJZXhwb3J0czoge30KLyoqKioqKi8gCQl9OwovKioqKioqLyAJCi8qKioqKiovIAkJLy8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uCi8qKioqKiovIAkJX193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7Ci8qKioqKiovIAkKLyoqKioqKi8gCQkvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZQovKioqKioqLyAJCXJldHVybiBtb2R1bGUuZXhwb3J0czsKLyoqKioqKi8gCX0KLyoqKioqKi8gCQovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKioqKioqLyAJLyogd2VicGFjay9ydW50aW1lL2NyZWF0ZSBmYWtlIG5hbWVzcGFjZSBvYmplY3QgKi8KLyoqKioqKi8gCSgoKSA9PiB7Ci8qKioqKiovIAkJdmFyIGdldFByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mID8gKG9iaikgPT4gKE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmopKSA6IChvYmopID0+IChvYmouX19wcm90b19fKTsKLyoqKioqKi8gCQl2YXIgbGVhZlByb3RvdHlwZXM7Ci8qKioqKiovIAkJLy8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0Ci8qKioqKiovIAkJLy8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0Ci8qKioqKiovIAkJLy8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zCi8qKioqKiovIAkJLy8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0Ci8qKioqKiovIAkJLy8gbW9kZSAmIDE2OiByZXR1cm4gdmFsdWUgd2hlbiBpdCdzIFByb21pc2UtbGlrZQovKioqKioqLyAJCS8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmUKLyoqKioqKi8gCQlfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkgewovKioqKioqLyAJCQlpZihtb2RlICYgMSkgdmFsdWUgPSB0aGlzKHZhbHVlKTsKLyoqKioqKi8gCQkJaWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTsKLyoqKioqKi8gCQkJaWYodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSkgewovKioqKioqLyAJCQkJaWYoKG1vZGUgJiA0KSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7Ci8qKioqKiovIAkJCQlpZigobW9kZSAmIDE2KSAmJiB0eXBlb2YgdmFsdWUudGhlbiA9PT0gJ2Z1bmN0aW9uJykgcmV0dXJuIHZhbHVlOwovKioqKioqLyAJCQl9Ci8qKioqKiovIAkJCXZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7Ci8qKioqKiovIAkJCV9fd2VicGFja19yZXF1aXJlX18ucihucyk7Ci8qKioqKiovIAkJCXZhciBkZWYgPSB7fTsKLyoqKioqKi8gCQkJbGVhZlByb3RvdHlwZXMgPSBsZWFmUHJvdG90eXBlcyB8fCBbbnVsbCwgZ2V0UHJvdG8oe30pLCBnZXRQcm90byhbXSksIGdldFByb3RvKGdldFByb3RvKV07Ci8qKioqKiovIAkJCWZvcih2YXIgY3VycmVudCA9IG1vZGUgJiAyICYmIHZhbHVlOyB0eXBlb2YgY3VycmVudCA9PSAnb2JqZWN0JyAmJiAhfmxlYWZQcm90b3R5cGVzLmluZGV4T2YoY3VycmVudCk7IGN1cnJlbnQgPSBnZXRQcm90byhjdXJyZW50KSkgewovKioqKioqLyAJCQkJT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoY3VycmVudCkuZm9yRWFjaCgoa2V5KSA9PiAoZGVmW2tleV0gPSAoKSA9PiAodmFsdWVba2V5XSkpKTsKLyoqKioqKi8gCQkJfQovKioqKioqLyAJCQlkZWZbJ2RlZmF1bHQnXSA9ICgpID0+ICh2YWx1ZSk7Ci8qKioqKiovIAkJCV9fd2VicGFja19yZXF1aXJlX18uZChucywgZGVmKTsKLyoqKioqKi8gCQkJcmV0dXJuIG5zOwovKioqKioqLyAJCX07Ci8qKioqKiovIAl9KSgpOwovKioqKioqLyAJCi8qKioqKiovIAkvKiB3ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMgKi8KLyoqKioqKi8gCSgoKSA9PiB7Ci8qKioqKiovIAkJLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0cwovKioqKioqLyAJCV9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7Ci8qKioqKiovIAkJCWZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHsKLyoqKioqKi8gCQkJCWlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkgewovKioqKioqLyAJCQkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7Ci8qKioqKiovIAkJCQl9Ci8qKioqKiovIAkJCX0KLyoqKioqKi8gCQl9OwovKioqKioqLyAJfSkoKTsKLyoqKioqKi8gCQovKioqKioqLyAJLyogd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCAqLwovKioqKioqLyAJKCgpID0+IHsKLyoqKioqKi8gCQlfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpCi8qKioqKiovIAl9KSgpOwovKioqKioqLyAJCi8qKioqKiovIAkvKiB3ZWJwYWNrL3J1bnRpbWUvbWFrZSBuYW1lc3BhY2Ugb2JqZWN0ICovCi8qKioqKiovIAkoKCkgPT4gewovKioqKioqLyAJCS8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHMKLyoqKioqKi8gCQlfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSAoZXhwb3J0cykgPT4gewovKioqKioqLyAJCQlpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHsKLyoqKioqKi8gCQkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pOwovKioqKioqLyAJCQl9Ci8qKioqKiovIAkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7Ci8qKioqKiovIAkJfTsKLyoqKioqKi8gCX0pKCk7Ci8qKioqKiovIAkKLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KdmFyIF9fd2VicGFja19leHBvcnRzX18gPSB7fTsKLy8gVGhpcyBlbnRyeSBuZWVkIHRvIGJlIHdyYXBwZWQgaW4gYW4gSUlGRSBiZWNhdXNlIGl0IG5lZWQgdG8gYmUgaXNvbGF0ZWQgYWdhaW5zdCBvdGhlciBtb2R1bGVzIGluIHRoZSBjaHVuay4KKCgpID0+IHsKX193ZWJwYWNrX3JlcXVpcmVfXy5yKF9fd2VicGFja19leHBvcnRzX18pOwovKiBoYXJtb255IGltcG9ydCAqLyB2YXIgX0FwcF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4ODcpOwovKiBoYXJtb255IGltcG9ydCAqLyB2YXIgcmVhY3RfZG9tX2NsaWVudF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NDUpOwovKiBoYXJtb255IGltcG9ydCAqLyB2YXIgcmVhY3RfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzJfXyA9IF9fd2VicGFja19yZXF1aXJlX18oMjk0KTsKZnVuY3Rpb24gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIobywgYWxsb3dBcnJheUxpa2UpIHt2YXIgaXQgPSB0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl0gfHwgb1siQEBpdGVyYXRvciJdO2lmICghaXQpIHtpZiAoQXJyYXkuaXNBcnJheShvKSB8fCAoaXQgPSBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobykpIHx8IGFsbG93QXJyYXlMaWtlICYmIG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikge2lmIChpdCkgbyA9IGl0O3ZhciBpID0gMDt2YXIgRiA9IGZ1bmN0aW9uIEYoKSB7fTtyZXR1cm4geyBzOiBGLCBuOiBmdW5jdGlvbiBuKCkge2lmIChpID49IG8ubGVuZ3RoKSByZXR1cm4geyBkb25lOiB0cnVlIH07cmV0dXJuIHsgZG9uZTogZmFsc2UsIHZhbHVlOiBvW2krK10gfTt9LCBlOiBmdW5jdGlvbiBlKF9lKSB7dGhyb3cgX2U7fSwgZjogRiB9O310aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gaXRlcmF0ZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7fXZhciBub3JtYWxDb21wbGV0aW9uID0gdHJ1ZSxkaWRFcnIgPSBmYWxzZSxlcnI7cmV0dXJuIHsgczogZnVuY3Rpb24gcygpIHtpdCA9IGl0LmNhbGwobyk7fSwgbjogZnVuY3Rpb24gbigpIHt2YXIgc3RlcCA9IGl0Lm5leHQoKTtub3JtYWxDb21wbGV0aW9uID0gc3RlcC5kb25lO3JldHVybiBzdGVwO30sIGU6IGZ1bmN0aW9uIGUoX2UyKSB7ZGlkRXJyID0gdHJ1ZTtlcnIgPSBfZTI7fSwgZjogZnVuY3Rpb24gZigpIHt0cnkge2lmICghbm9ybWFsQ29tcGxldGlvbiAmJiBpdFsicmV0dXJuIl0gIT0gbnVsbCkgaXRbInJldHVybiJdKCk7fSBmaW5hbGx5IHtpZiAoZGlkRXJyKSB0aHJvdyBlcnI7fX0gfTt9ZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikge2lmICghbykgcmV0dXJuO2lmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO3ZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTtpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTtpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pO2lmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7fWZ1bmN0aW9uIF9hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuKSB7aWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7Zm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSB7YXJyMltpXSA9IGFycltpXTt9cmV0dXJuIGFycjI7fQoKCgoKCmdldERhdGEoZnVuY3Rpb24gKHBhZ2VzKSB7dmFyIF9pdGVyYXRvciA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKAogICAgcGFnZXMpLF9zdGVwO3RyeSB7Zm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTspIHt2YXIgcGFnZSA9IF9zdGVwLnZhbHVlOwogICAgICBmb3IgKHZhciBfaSA9IDAsIF9hcnIgPSBwYWdlLmNvbXBvbmVudHM7IF9pIDwgX2Fyci5sZW5ndGg7IF9pKyspIHt2YXIgY29tcG9uZW50ID0gX2FycltfaV07CiAgICAgICAgY29tcG9uZW50LnByZXZpb3VzVmFsdWUgPSBjb21wb25lbnQudmFsdWU7CgogICAgICAgIGlmIChjb21wb25lbnQudmFsaWRhdGUgIT0gbnVsbCkgewogICAgICAgICAgY29tcG9uZW50LnZhbGlkYXRlID0gZXZhbChjb21wb25lbnQudmFsaWRhdGUpOwogICAgICAgIH0KICAgICAgfQogICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvci5lKGVycik7fSBmaW5hbGx5IHtfaXRlcmF0b3IuZigpO30KCiAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyb290Iik7CiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb24KICB2YXIgcm9vdCA9ICgwLHJlYWN0X2RvbV9jbGllbnRfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzFfXy8qIC5jcmVhdGVSb290ICovIC5zKShjb250YWluZXIpOwogIHJvb3QucmVuZGVyKCAvKiNfX1BVUkVfXyovcmVhY3RfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzJfXy5jcmVhdGVFbGVtZW50KF9BcHBfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfXy8qIFsiZGVmYXVsdCJdICovIC5aLCB7IHBhZ2VzOiBwYWdlcyB9KSk7Cn0pOwp9KSgpOwoKLyoqKioqKi8gCXJldHVybiBfX3dlYnBhY2tfZXhwb3J0c19fOwovKioqKioqLyB9KSgpCjsKfSk7";

      /***/},

    /***/171:
    /***/function _(module) {

      module.exports = "#relayContainer{margin:1rem;font-family:Arial,Helvetica,sans-serif}#notificationsContainer{pointer-events:none;position:fixed;top:5%;left:70%;transform:translateX(-50%);z-index:999}img{display:block;margin:auto}input.stringcontainer{background-color:#fff;border-radius:5px;border:1px solid #121943;height:24px;margin:auto;display:flex;padding-left:5px}input.interrupt{width:100%;border-color:darkred;background-color:#f1948a;color:darkred;margin:10px 0px;cursor:pointer}input.interrupt:hover{background-color:#f5867a}input.interrupt:active{background-color:#f77163}input.save,input.interrupt{margin:auto;display:block;font-size:x-large;padding:5px 25px;border-radius:10px}.notification{border:3px solid #00529b;background-color:#bde5f8;width:fit-content;margin-right:auto;margin-left:auto;border-radius:40px;color:#00529b;padding:7px 60px;animation:2s fadeOut 5s 1 forwards;cursor:default;pointer-events:auto}@keyframes fadeOut{0%{opacity:1}99%{height:100%}100%{opacity:0;height:0}}td{padding:.5rem}.toggle{align-items:center;border-radius:100px;display:flex;font-weight:700;margin-bottom:16px}.toggle:last-of-type{margin:0}.toggle__input{clip:rect(0 0 0 0);clip-path:inset(50%);height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px}.toggle__input:not([disabled]):active+.toggle-track,.toggle__input:not([disabled]):focus+.toggle-track{border:1px solid rgba(0,0,0,0);box-shadow:0px 0px 0px 2px #121943}.toggle__input:disabled+.toggle-track{cursor:not-allowed;opacity:.7}.toggle-track{background:#fff;border:1px solid #5a72b5;border-radius:100px;cursor:pointer;display:flex;height:30px;margin-left:5%;position:relative;width:60px}.toggle-indicator{align-items:center;background:#121943;border-radius:24px;bottom:2px;display:flex;height:24px;justify-content:center;left:2px;outline:solid 2px rgba(0,0,0,0);position:absolute;transition:.4s;width:24px}.checkMark{fill:#fff;height:20px;width:20px;opacity:0;transition:opacity .4s ease-in-out}.dropdowncontainer{padding:8px 16px;border:1px solid rgba(0,0,0,0);border-color:#000}input[value=true]+.toggle-track .toggle-indicator{background:#121943;transform:translateX(30px)}input[value=true]+.toggle-track .toggle-indicator .checkMark{opacity:1;transition:opacity .4s ease-in-out}@media screen and (-ms-high-contrast: active){.toggle-track{border-radius:0;background-color:red}}.topBar{display:flex}.tabEntry{margin-right:10px;border-radius:10px;background-color:#333}.relayTable{padding-bottom:10px}.tabEntry a{display:block;color:#fff;text-align:center;padding:6px;text-decoration:none}.tabEntry a[aria-current=page]{background-color:#00529b;border-radius:10px}.tabEntry a:hover[aria-current=page]{background-color:#002c53;border-radius:10px}.tabEntry a:hover{background-color:#111;border-radius:10px}.setting{position:relative}.setting .settingNameHover{visibility:hidden;background-color:#cacaca;color:#000;text-align:center;border-radius:6px;border-color:#000;position:absolute;z-index:1}.setting:hover .settingNameHover{visibility:visible;padding:5px;margin-left:15px}.hoverBox{position:relative;white-space:nowrap}.settingInput .settingDefaultHover{visibility:hidden;color:#666;position:absolute;z-index:1;left:50%;transform:translateX(-50%)}.settingInput:hover .settingDefaultHover{visibility:visible}.invalid-setting input,.invalid-setting select,.invalid-setting .toggle-track{background:pink !important}.invalid-reason{text-align:center}.invalid-reason small{padding:0px 5px;border-radius:10px;color:red}.settingTag{display:flex;flex-wrap:wrap;overflow:hidden;color:#000;margin:5px}input{outline:none}.settingTagClose{cursor:pointer}.settingTagSingle{display:inline-flex;border:1.5px solid #764abc;padding:2px 0px 0px 5px;border-radius:5px;white-space:nowrap;color:#764abc;margin-right:5px;margin-bottom:5px;cursor:grab;position:relative}.dropdownMenu{position:absolute;transform:translateY(4px);border:1px solid #ccc;border-radius:5px;overflow-y:auto;overflow-x:clip;overflow-wrap:break-word;max-height:250px;background-color:#fff;z-index:99;user-select:none}.dropdownItem{padding:3px;cursor:pointer;padding-left:.2em}.dropdownMenu>div+div{border-top:1px solid #d6d6d6}.dropdownItem:hover{background-color:rgba(159,195,248,.4392156863)}.userPreference td:first-child{width:15%}.userPreference td:nth-child(2){width:20%}.hintTagDrop{width:40px;min-height:100%;height:20px;background-image:linear-gradient(rgb(162, 162, 162), transparent);border-radius:5px;padding:0px 0px 0px 5px;margin-right:5px;margin-bottom:2px}.hintTagDropOriginal{background-image:linear-gradient(rgb(176, 94, 168), transparent)}.tagContainer{display:flex;flex-wrap:wrap;overflow:hidden}.draggedItem{opacity:40%}.hidden{display:none}.rearrangedTag{animation:fadeIn 1s}@keyframes fadeIn{from{opacity:.2}to{opacity:1}}\n";

      /***/},

    /***/530:
    /***/function _(module) {

      module.exports = __webpack_require__(530);

      /***/}

    /******/ };
  /************************************************************************/
  /******/ // The module cache
  /******/var __webpack_module_cache__ = {};
  /******/
  /******/ // The require function
  /******/function __nested_webpack_require_513418__(moduleId) {
    /******/ // Check if module is in cache
    /******/var cachedModule = __webpack_module_cache__[moduleId];
    /******/if (cachedModule !== undefined) {
      /******/return cachedModule.exports;
      /******/}
    /******/ // Create a new module (and put it into the cache)
    /******/var module = __webpack_module_cache__[moduleId] = {
      /******/ // no module.id needed
      /******/ // no module.loaded needed
      /******/exports: {}
      /******/ };
    /******/
    /******/ // Execute the module function
    /******/__webpack_modules__[moduleId](module, module.exports, __nested_webpack_require_513418__);
    /******/
    /******/ // Return the exports of the module
    /******/return module.exports;
    /******/}
  /******/
  /************************************************************************/
  /******/ /* webpack/runtime/compat get default export */
  /******/(function () {
    /******/ // getDefaultExport function for compatibility with non-harmony modules
    /******/__nested_webpack_require_513418__.n = function (module) {
      /******/var getter = module && module.__esModule ?
      /******/function () {return module['default'];} :
      /******/function () {return module;};
      /******/__nested_webpack_require_513418__.d(getter, { a: getter });
      /******/return getter;
      /******/};
    /******/})();
  /******/
  /******/ /* webpack/runtime/define property getters */
  /******/(function () {
    /******/ // define getter functions for harmony exports
    /******/__nested_webpack_require_513418__.d = function (exports, definition) {
      /******/for (var key in definition) {
        /******/if (__nested_webpack_require_513418__.o(definition, key) && !__nested_webpack_require_513418__.o(exports, key)) {
          /******/Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
          /******/}
        /******/}
      /******/};
    /******/})();
  /******/
  /******/ /* webpack/runtime/hasOwnProperty shorthand */
  /******/(function () {
    /******/__nested_webpack_require_513418__.o = function (obj, prop) {return Object.prototype.hasOwnProperty.call(obj, prop);};
    /******/})();
  /******/
  /******/ /* webpack/runtime/make namespace object */
  /******/(function () {
    /******/ // define __esModule on exports
    /******/__nested_webpack_require_513418__.r = function (exports) {
      /******/if (typeof Symbol !== 'undefined' && Symbol.toStringTag) {
        /******/Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
        /******/}
      /******/Object.defineProperty(exports, '__esModule', { value: true });
      /******/};
    /******/})();
  /******/
  /************************************************************************/
  var __webpack_exports__ = {};
  // This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.
  (function () {
    __nested_webpack_require_513418__.r(__webpack_exports__);
    /* harmony export */__nested_webpack_require_513418__.d(__webpack_exports__, {
      /* harmony export */"generateHTML": function generateHTML() {return (/* binding */_generateHTML);},
      /* harmony export */"getPagePath": function getPagePath() {return (/* binding */_getPagePath);},
      /* harmony export */"handleApiRequest": function handleApiRequest() {return (/* binding */_handleApiRequest);},
      /* harmony export */"parseCssFromFile": function parseCssFromFile() {return (/* binding */_parseCssFromFile);},
      /* harmony export */"parsePageFromFile": function parsePageFromFile() {return (/* binding */_parsePageFromFile);},
      /* harmony export */"parsePageFromJson": function parsePageFromJson() {return (/* binding */_parsePageFromJson);}
      /* harmony export */ });
    /* harmony import */var kolmafia__WEBPACK_IMPORTED_MODULE_0__ = __nested_webpack_require_513418__(530);
    /* harmony import */var kolmafia__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__nested_webpack_require_513418__.n(kolmafia__WEBPACK_IMPORTED_MODULE_0__);
    function _toConsumableArray(arr) {return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();}function _nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArray(iter) {if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);}function _arrayWithoutHoles(arr) {if (Array.isArray(arr)) return _arrayLikeToArray(arr);}function _slicedToArray(arr, i) {return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();}function _nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArrayLimit(arr, i) {var _i = arr == null ? null : typeof Symbol !== "undefined" && arr[Symbol.iterator] || arr["@@iterator"];if (_i == null) return;var _arr = [];var _n = true;var _d = false;var _s, _e;try {for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {_arr.push(_s.value);if (i && _arr.length === i) break;}} catch (err) {_d = true;_e = err;} finally {try {if (!_n && _i["return"] != null) _i["return"]();} finally {if (_d) throw _e;}}return _arr;}function _arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function _createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function _unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return _arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);}function _arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) {arr2[i] = arr[i];}return arr2;}










    function _handleApiRequest() {
      if (handleJavascript()) {
        return true;
      }

      if (handleProperties()) {
        return true;
      }

      return false;
    }

    function handleProperties() {
      var toSet = (0, kolmafia__WEBPACK_IMPORTED_MODULE_0__.formFields)()["setProperties"];

      if (toSet == null) {
        return false;
      }

      var props = JSON.parse(toSet);
      var notifications = [];var _iterator = _createForOfIteratorHelper(

        props),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var _step$value = _slicedToArray(_step.value, 2),key = _step$value[0],value = _step$value[1];
          var prevValue = (0, kolmafia__WEBPACK_IMPORTED_MODULE_0__.getProperty)(key);

          if (prevValue === value) {
            continue;
          }

          (0, kolmafia__WEBPACK_IMPORTED_MODULE_0__.setProperty)(key, value);
          notifications.push("".concat(key, " changed from `").concat(prevValue, "` to `").concat(value, "`"));
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

      if (notifications.length == 0) {
        notifications.push("No settings were modified.");
      }

      // We include the ' ' because otherwise the browser doesn't like an empty page
      (0, kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(JSON.stringify(notifications));
      return true;
    }

    function handleJavascript() {
      var js = (0, kolmafia__WEBPACK_IMPORTED_MODULE_0__.formFields)()["javascript"];

      if (js == null) {
        return false;
      }

      var returns = eval(js) || "";
      // We include the ' ' because otherwise the browser doesn't like an empty page
      (0, kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(returns + (returns ? "" : " "));
      return true;
    }

    function validateComponents(components) {var _iterator2 = _createForOfIteratorHelper(
        components),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var _button$name;var component = _step2.value;
          var button = component;

          if (button.preference == null) {
            continue;
          }

          button.name = (_button$name = button.name) !== null && _button$name !== void 0 ? _button$name : button.preference;

          if (button.validate != null) {
            try {
              eval(button.validate);
            } catch (e) {
              (0, kolmafia__WEBPACK_IMPORTED_MODULE_0__.print)("Unable to load ".concat(button.name, "'s validator '").concat(button.validate, "'"));
              button.validate = null;
            }
          }

          if (button["default"] != undefined && typeof button["default"] != "string") {
            button["default"] = button["default"] + "";
          }

          if (button["default"] == null && (0, kolmafia__WEBPACK_IMPORTED_MODULE_0__.propertyHasDefault)(button.preference)) {
            button["default"] = (0, kolmafia__WEBPACK_IMPORTED_MODULE_0__.propertyDefaultValue)(button.preference);
          }

          if (button.value != undefined && typeof button.value != "string") {
            button.value = button.value + "";
          }

          if (button["default"] == null && button.type == "boolean") {
            button["default"] = "true";
          }

          if (button.type == "tags") {
            var tags = button;
            if (tags.allowDuplicateTags == null) {
              tags.allowDuplicateTags = true;
            }

            if (tags.tagsSeperator == null) {
              tags.tagsSeperator = ",";
            }

            if (button.placeholderText == null) {
              button.placeholderText = button["default"] ? button["default"] : "";
            }
          }

          if (button.value != null) {
            continue;
          }

          var val = void 0;

          if ((0, kolmafia__WEBPACK_IMPORTED_MODULE_0__.propertyExists)(button.preference)) {
            val = (0, kolmafia__WEBPACK_IMPORTED_MODULE_0__.getProperty)(button.preference);
          } else if (button["default"] != null) {
            val = button["default"];
          } else {
            if (button.type == "dropdown") {
              if (typeof button.dropdown[0] == "string") {
                val = button.dropdown[0];
              } else {
                val = button.dropdown[0].value;
              }
            } else if (button.type == "boolean") {
              val = "true";
            } else {
              val = "";
            }
          }

          button.value = val;
        }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}
    }

    function _generateHTML(
    pages,
    extraHtml)
    {
      pages = pages.filter(function (p) {return p != null;});var _iterator3 = _createForOfIteratorHelper(

        pages),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var _page$file;var page = _step3.value;
          page.file = (_page$file = page.file) !== null && _page$file !== void 0 ? _page$file : page.page;

          validateComponents(page.components);
        }} catch (err) {_iterator3.e(err);} finally {_iterator3.f();}

      var buffer = [];

      var cssFiles = [];

      if (extraHtml && extraHtml.cssFiles) {
        cssFiles.push.apply(cssFiles, _toConsumableArray(extraHtml.cssFiles));
      }

      buffer.push("<!DOCTYPE html>");
      buffer.push("<head>");

      cssFiles.forEach(function (s) {
        buffer.push("<link rel=\"stylesheet\" src=\"".concat(s, "\">"));
      });

      buffer.push("<style>");
      buffer.push("".concat(__nested_webpack_require_513418__(171)));

      if (extraHtml && extraHtml.css) {
        buffer.push(extraHtml.css);
      }

      buffer.push("</style>");

      buffer.push("</head>");

      buffer.push('<div id="root"></div>');

      buffer.push("<script>");

      // add script that react calls when loaded to get kol data
      buffer.push("let getData = function(callback) {callback(".concat(
      JSON.stringify(pages), ")}"));


      // close notifications when they are clicked on
      buffer.push("document.onclick = (e) => {\n    if(e.target.classList.contains('notification')) e.target.remove();\n  }");



      buffer.push("</script>");

      // include react script
      buffer.push("<script src=\"".concat(
      __nested_webpack_require_513418__(447), "\"></script>"));


      return buffer.join("\n");
    }

    function _getPagePath(file) {
      var fileName = file.includes("/") ?
      file :
      "relay/shared_relay/pages/" + file + ".json";

      if (!fileName.endsWith(".json") && (0, kolmafia__WEBPACK_IMPORTED_MODULE_0__.fileToBuffer)(fileName).length == 0) {
        fileName += ".json";
      }

      return fileName;
    }

    /**
     * Parses from relay/shared_relay/pages/ if no slashes are in the name, otherwise expects a valid json file
     */
    function _parsePageFromFile(file) {
      var data = (0, kolmafia__WEBPACK_IMPORTED_MODULE_0__.fileToBuffer)(_getPagePath(file));

      return _parsePageFromJson(file, data);
    }

    function _parseCssFromFile(file) {
      var fileName = file.includes("/") ?
      file :
      "relay/shared_relay/pages/" + file + ".css";

      if (!fileName.endsWith(".css")) {
        fileName += ".css";
      }

      var data = (0, kolmafia__WEBPACK_IMPORTED_MODULE_0__.fileToBuffer)(fileName);

      if (data.length == 0) {
        return null;
      }

      return data;
    }

    function _parsePageFromJson(id, jsonData) {
      if (jsonData.length == 0) {
        return null;
      }

      var subpage = JSON.parse(jsonData);

      subpage.file = id;

      for (var _i2 = 0, _arr2 = subpage.components; _i2 < _arr2.length; _i2++) {var _ref3;var button = _arr2[_i2];
        if (button.type != "dropdown") {
          continue;
        }

        var dropdown = button;

        if (dropdown.dropdown == null) {
          dropdown.dropdown = [];
        } else if (typeof dropdown.dropdown[0] == "string") {
          dropdown.dropdown = dropdown.dropdown.map(
          function (s) {
            return {
              display: s,
              value: s
            };
          });

        }

        if (dropdown.dropdownFiller == null) {
          continue;
        }

        var data =
        eval(dropdown.dropdownFiller).
        map(function (_ref) {var _ref2 = _slicedToArray(_ref, 2),display = _ref2[0],value = _ref2[1];
          return {
            display: display,
            value: value
          };
        });

        (_ref3 = dropdown.dropdown).push.apply(_ref3, _toConsumableArray(data));
      }

      return subpage;
    }
  })();

  var __webpack_export_target__ = exports;
  for (var i in __webpack_exports__) __webpack_export_target__[i] = __webpack_exports__[i];
  if (__webpack_exports__.__esModule) Object.defineProperty(__webpack_export_target__, "__esModule", { value: true });
  /******/})();

/***/ }),

/***/ 530:
/***/ ((module) => {

"use strict";
module.exports = require("kolmafia");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be in strict mode.
(() => {
"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__);

// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "main": () => (/* binding */ relay_greyday_main)
});

// EXTERNAL MODULE: external "kolmafia"
var external_kolmafia_ = __webpack_require__(530);
;// CONCATENATED MODULE: ./src/quests/Quests.ts






















var QuestStatus;(function (QuestStatus) {QuestStatus[QuestStatus["READY"] = 0] = "READY";QuestStatus[QuestStatus["FASTER_LATER"] = 1] = "FASTER_LATER";QuestStatus[QuestStatus["NOT_READY"] = 2] = "NOT_READY";QuestStatus[QuestStatus["COMPLETED"] = 3] = "COMPLETED";})(QuestStatus || (QuestStatus = {}));






var DelayType;(function (DelayType) {DelayType[DelayType["TURN_BURNING"] = 0] = "TURN_BURNING";DelayType[DelayType["NONCOMBAT_HITTING"] = 1] = "NONCOMBAT_HITTING";})(DelayType || (DelayType = {}));





















function getQuestStatus(property) {
  var status = (0,external_kolmafia_.getProperty)(property);

  if (status == "unstarted") {
    return -1;
  } else if (status == "started") {
    return 0;
  } else if (status == "finished") {
    return 100;
  } else if (status.match(/^step\d+$/)) {
    return (0,external_kolmafia_.toInt)(status.replace("step", ""));
  } else {
    throw (
      "Cannot parse property '" +
      property +
      "' value '" +
      status +
      "' to an int");

  }
}
;// CONCATENATED MODULE: ./src/typings/TaskInfo.ts
function _typeof(obj) {"@babel/helpers - typeof";return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, _typeof(obj);}function _inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) _setPrototypeOf(subClass, superClass);}function _setPrototypeOf(o, p) {_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return _setPrototypeOf(o, p);}function _createSuper(Derived) {var hasNativeReflectConstruct = _isNativeReflectConstruct();return function _createSuperInternal() {var Super = _getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = _getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return _possibleConstructorReturn(this, result);};}function _possibleConstructorReturn(self, call) {if (call && (_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return _assertThisInitialized(self);}function _assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function _getPrototypeOf(o) {_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return _getPrototypeOf(o);}function _createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function _slicedToArray(arr, i) {return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();}function _nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function _arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function _toConsumableArray(arr) {return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();}function _nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return _arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);}function _iterableToArray(iter) {if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);}function _arrayWithoutHoles(arr) {if (Array.isArray(arr)) return _arrayLikeToArray(arr);}function _arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function _defineProperty(obj, key, value) {key = _toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function _defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor);}}function _createClass(Constructor, protoProps, staticProps) {if (protoProps) _defineProperties(Constructor.prototype, protoProps);if (staticProps) _defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function _toPropertyKey(arg) {var key = _toPrimitive(arg, "string");return _typeof(key) === "symbol" ? key : String(key);}function _toPrimitive(input, hint) {if (_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}





var TaskInfo = /*#__PURE__*/_createClass(function TaskInfo() {_classCallCheck(this, TaskInfo);});





















var ResourcesSnapshot = /*#__PURE__*/function () {function ResourcesSnapshot() {_classCallCheck(this, ResourcesSnapshot);_defineProperty(this, "resources",
    []);_defineProperty(this, "resourceMap",
    new Map());_defineProperty(this, "unused",
    []);}_createClass(ResourcesSnapshot, [{ key: "toString", value: // For those special resources that have limits that change on the fly, aka yellow rocket

    function toString() {
      var output = [];

      output.push("Resource Snapshot");

      var resourceStrings = this.resources.
      map(
      function (s) {var _ref;return (_ref =
        s.name +
        " x " +
        ResourceCategory[s.type] +
        " - Uses " +
        s.resourcesUsed) !== null && _ref !== void 0 ? _ref : 1;}).

      join(", ");
      var resMap = _toConsumableArray(this.resourceMap).map(
      function (_ref2) {var _ref3 = _slicedToArray(_ref2, 2),id = _ref3[0],amount = _ref3[1];return id + " x " + amount;});

      var unused = this.unused.join(", ");

      output.push("Resources: " + resourceStrings);
      output.push("Resources Count: " + resMap.join(", "));
      output.push("Unused: " + unused);

      return output.join(" || ");
    } }]);return ResourcesSnapshot;}();


var PossiblePath = /*#__PURE__*/function () {











  function PossiblePath(advsMin) {var advsMax = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : advsMin;_classCallCheck(this, PossiblePath);_defineProperty(this, "resourcesNeeded", []);_defineProperty(this, "resourceUsed", []);_defineProperty(this, "resourcesAvailable", []);_defineProperty(this, "ignoreResources", []);_defineProperty(this, "pulls", []);_defineProperty(this, "tags", []);_defineProperty(this, "advsSavedMin", void 0);_defineProperty(this, "advsSavedMax", void 0);_defineProperty(this, "miscMeat", 0);_defineProperty(this, "pathCost", 0);
    this.advsSavedMax = advsMax;
    this.advsSavedMin = advsMin;
  }_createClass(PossiblePath, [{ key: "addTag", value:

    function addTag(tag) {
      this.tags.push(tag);

      return this;
    } }, { key: "removeTag", value:

    function removeTag(tag) {
      this.tags = this.tags.filter(function (t) {return t != tag;});

      return this;
    } }, { key: "hasTag", value:

    function hasTag(tag) {
      return this.tags.includes(tag);
    } }, { key: "setRoughPathCost", value:

    function setRoughPathCost(resourcesUsed) {
      this.pathCost = this.miscMeat;
      var hitFree = false;var _iterator = _createForOfIteratorHelper(

        resourcesUsed),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var _step$value = _slicedToArray(_step.value, 2),res = _step$value[1];
          this.pathCost += res.worthInAftercore;

          if (!hitFree && res.freeTurn == true) {
            hitFree = true;

            this.pathCost -= GreySettings_GreySettings.greyValueOfAdventure;
          }
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
    } }, { key: "getAverageTurns", value:

    function getAverageTurns() {
      return Math.ceil((this.advsSavedMin + this.advsSavedMax) / 2);
    } }, { key: "getCostOfPath", value:

    function getCostOfPath() {
      return (
        this.pathCost + this.getAverageTurns() * GreySettings_GreySettings.greyValueOfAdventure);

    } }, { key: "getCostPerAdv", value:

    function getCostPerAdv() {
      if (this.getAverageTurns() == 0) {
        return this.pathCost;
      }

      return this.pathCost / this.getAverageTurns();
    } }, { key: "clone", value:

    function clone() {
      var path = new PossiblePath(this.advsSavedMin, this.advsSavedMax);
      path.resourcesNeeded = _toConsumableArray(
      this.resourcesNeeded.map(
      function (_ref4) {var _ref5 = _slicedToArray(_ref4, 2),v1 = _ref5[0],v2 = _ref5[1];return [v1, v2];}));


      path.resourceUsed = _toConsumableArray(this.resourceUsed);
      path.resourcesAvailable = _toConsumableArray(this.resourcesAvailable);
      path.ignoreResources = _toConsumableArray(this.ignoreResources);
      path.miscMeat = this.miscMeat;

      return path;
    } }, { key: "detectResourceUsage", value:

    function detectResourceUsage(snapshot) {var _this = this;
      var changed = getResourcesChanged(snapshot, this);
      var diff = changed.resourceMap;
      // Get all resources that were among the changed, and uses enough of the resource to fit in
      var viableResources = this.resourcesAvailable.filter(
      function (r) {var _r$resourcesUsed;return (
          diff.has(r.resource) && diff.get(r.resource) >= ((_r$resourcesUsed = r.resourcesUsed) !== null && _r$resourcesUsed !== void 0 ? _r$resourcesUsed : 1));});

      var doDebug = function doDebug() {
        (0,external_kolmafia_.print)("Snapshot " + snapshot.toString());
        (0,external_kolmafia_.print)("Now " + createResourcesSnapshot(_this).toString());
        (0,external_kolmafia_.print)("Changed " + changed.toString());
      };var _iterator2 = _createForOfIteratorHelper(

        diff.keys()),_step2;try {var _loop = function _loop() {var _resources$0$resource, _resources$0$resource2, _changed$resources;var resourceId = _step2.value;
          var resources = viableResources.filter(function (r) {return r.resource == resourceId;});

          if (resources.length == 0) {return "continue";

          }

          // If all the resources using this key, are not of the same type
          if (resources.filter(function (r) {return r.type != resources[0].type;}).length > 1) {
            doDebug();
            throw "Multiple resources of the same source were used, need to manually register the resources of ".concat(resourceId, " and types ").concat(resources.map(
            function (r) {return ResourceCategory[r.type];}), " as used.");

          }

          var amountUsed = diff.get(resourceId) / ((_resources$0$resource = resources[0].resourcesUsed) !== null && _resources$0$resource !== void 0 ? _resources$0$resource : 1);

          // If its a yellow ray, round it if its a turn off
          if (
          resourceId == "Yellow Ray" &&
          Math.abs(diff.get(resourceId) - ((_resources$0$resource2 = resources[0].resourcesUsed) !== null && _resources$0$resource2 !== void 0 ? _resources$0$resource2 : 0)) <= 1)
          {var _ref6;
            diff.set(
            resourceId, (_ref6 =
            Math.round(amountUsed) * resources[0].resourcesUsed) !== null && _ref6 !== void 0 ? _ref6 : 1);


            amountUsed = Math.round(amountUsed);
          }

          if (amountUsed % 1 != 0) {var _resources$0$resource3;
            doDebug();
            throw "Unexpected amount of a resource used! Expected a multiple of ".concat((_resources$0$resource3 =
            resources[0].resourcesUsed) !== null && _resources$0$resource3 !== void 0 ? _resources$0$resource3 : 1, " from ").concat(
            resources[0].name, " of type ").concat(
            ResourceCategory[resources[0].type], " but got a total of ").concat(
            diff.get(
            resourceId), " used! Original value: ").concat(
            snapshot.resourceMap.get(
            resources[0].resource), ", Current Value: ").concat(
            getResourcesLeft(resources[0].resource));
          }

          if (amountUsed > resources.length) {
            doDebug();
            throw "Unexpected amount of a resource used! Expected ".concat(
            resources.length, " or less of ").concat(
            resources[0].name, " of type ").concat(
            ResourceCategory[resources[0].type], " but got a total of ").concat(
            diff.get(
            resourceId), " used! Original value: ").concat(
            snapshot.resourceMap.get(
            resources[0].resource), ", Current Value: ").concat(
            getResourcesLeft(resources[0].resource));
          }

          _this.addUsedResource(resources[0], amountUsed);

          (_changed$resources = changed.resources).push.apply(_changed$resources, _toConsumableArray(resources.slice(0, amountUsed)));
          (0,external_kolmafia_.print)(
          "Detected resource change, " +
          resources[0].name +
          " of " +
          ResourceCategory[resources[0].type] +
          " x " +
          amountUsed);

        };for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var _ret = _loop();if (_ret === "continue") continue;}} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}

      return changed;
    } }, { key: "addMeat", value:

    function addMeat(meat) {
      this.miscMeat += meat;

      return this;
    } }, { key: "addIgnored", value:

    function addIgnored(resource) {
      this.ignoreResources.push(resource);

      return this;
    } }, { key: "getResource", value:

    function getResource(resource) {
      return this.resourcesAvailable.find(function (r) {return r.type == resource;});
    } }, { key: "addUsedResource", value:

    function addUsedResource(resource) {var amount = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      for (var i = 0; i < amount; i++) {
        var index = this.resourcesAvailable.findIndex(function (r) {return r === resource;});

        if (index >= 0) {
          this.resourcesAvailable.splice(index, 1);
        } else {
          throw "Expected to find a ".concat(resource.name, " of type ").concat(
          ResourceCategory[resource.type], " but none were remaining!");

        }

        this.resourceUsed.push(resource.type);
      }

      return this;
    } }, { key: "addUsed", value:

    function addUsed(resource) {var amount = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      for (var i = 0; i < amount; i++) {
        var index = this.resourcesAvailable.findIndex(
        function (r) {return r.type == resource;});


        if (index >= 0) {
          this.resourcesAvailable.splice(index, 1);
        }

        this.resourceUsed.push(resource);
      }

      return this;
    } }, { key: "canUse", value:

    function canUse(resource) {
      return Math.max(
      0,
      this.resourcesNeeded.filter(function (r) {return r[0] == resource;}).length -
      this.getUsed(resource));

    } }, { key: "addMaybe", value:

    function addMaybe(
    resource,
    chance)

    {var amount = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;
      if (resource == null) {
        throw "Tried to add a null resource";
      }

      for (var i = 0; i < amount; i++) {
        this.resourcesNeeded.push([resource, chance]);
      }

      return this;
    } }, { key: "addConsumablePull", value:

    function addConsumablePull(item) {var chance = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      this.addMeat((0,external_kolmafia_.historicalPrice)(item) * 1.1);

      return this.addPull(item, chance);
    } }, { key: "addPull", value:

    function addPull(item) {var chance = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      this.pulls.push(item);

      this.pulls.sort(function (i1, i2) {return i1.name.localeCompare(i2.name);});

      return this.addMaybe(ResourceCategory.PULL, chance);
    } }, { key: "addFax", value:

    function addFax(monster) {var chance = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      if (!(0,external_kolmafia_.canFaxbot)(monster)) {
        this.addIgnored("Fax Machine");
      }

      if (
      (0,external_kolmafia_.getProperty)("chateauMonster") != "" &&
      (0,external_kolmafia_.toMonster)((0,external_kolmafia_.getProperty)("chateauMonster")) != monster)
      {
        this.addIgnored("Chateau Painting");
      }

      var foughtLocket = (0,external_kolmafia_.getProperty)("_locketMonstersFought").
      split(",").
      map(function (s) {return (0,external_kolmafia_.toInt)(s);});

      if (
      foughtLocket.length < 3 && (
      foughtLocket.includes((0,external_kolmafia_.toInt)(monster)) ||
      !(0,external_kolmafia_.getLocketMonsters)()[monster.name]))
      {
        this.addIgnored("Combat Locket");
      }

      return this.addMaybe(ResourceCategory.FAXER, chance);
    } }, { key: "add", value:

    function add(resource) {var resources = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      if (resource == ResourceCategory.PULL) {
        throw "Please use addPull instead";
      }

      if (resource == ResourceCategory.FAXER) {
        throw "Please use addFax instead";
      }

      this.addMaybe(resource, 1, resources);

      return this;
    } }, { key: "getUsed", value:

    function getUsed(resource) {
      return this.resourceUsed.filter(function (r) {return r == resource;}).length;
    } }]);return PossiblePath;}();


var PossibleMultiPath = /*#__PURE__*/function (_PossiblePath) {_inherits(PossibleMultiPath, _PossiblePath);var _super = _createSuper(PossibleMultiPath);function PossibleMultiPath() {var _this2;_classCallCheck(this, PossibleMultiPath);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this2 = _super.call.apply(_super, [this].concat(args));_defineProperty(_assertThisInitialized(_this2), "printUsing",
    false);_defineProperty(_assertThisInitialized(_this2), "subpaths",
    []);return _this2;}_createClass(PossibleMultiPath, [{ key: "addPath", value:

    function addPath(quest, path) {var _this$resourcesNeeded, _this$resourceUsed, _this$resourcesAvaila, _this$ignoreResources, _this$pulls;
      this.subpaths.push([quest, path]);

      (_this$resourcesNeeded = this.resourcesNeeded).push.apply(_this$resourcesNeeded, _toConsumableArray(path.resourcesNeeded));
      (_this$resourceUsed = this.resourceUsed).push.apply(_this$resourceUsed, _toConsumableArray(path.resourceUsed));
      (_this$resourcesAvaila = this.resourcesAvailable).push.apply(_this$resourcesAvaila, _toConsumableArray(path.resourcesAvailable));
      (_this$ignoreResources = this.ignoreResources).push.apply(_this$ignoreResources, _toConsumableArray(path.ignoreResources));
      (_this$pulls = this.pulls).push.apply(_this$pulls, _toConsumableArray(path.pulls));
      this.advsSavedMin += path.advsSavedMin;
      this.advsSavedMax += path.advsSavedMax;
      this.miscMeat += path.miscMeat;
    } }]);return PossibleMultiPath;}(PossiblePath);


var TaskRelation;(function (TaskRelation) {TaskRelation[TaskRelation["WAIT_FOR"] = 0] = "WAIT_FOR";TaskRelation[TaskRelation["DO_BEFORE"] = 1] = "DO_BEFORE";TaskRelation[TaskRelation["DO_AFTER"] = 2] = "DO_AFTER";TaskRelation[TaskRelation["UNRELATED"] = 3] = "UNRELATED";})(TaskRelation || (TaskRelation = {}));






function createResourcesSnapshot(
path)
{
  var snapshot = new ResourcesSnapshot();var _iterator3 = _createForOfIteratorHelper(

    ResourceIds),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var resource = _step3.value;
      if (resource == "Yellow Ray") {
        if ((0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("Everything Looks Yellow")) == 0) {
          snapshot.unused.push(resource);
        }
      }

      snapshot.resourceMap.set(resource, getResourcesLeft(resource));
    }} catch (err) {_iterator3.e(err);} finally {_iterator3.f();}

  if (path != null) {var _snapshot$resources;
    (_snapshot$resources = snapshot.resources).push.apply(_snapshot$resources, _toConsumableArray(path.resourcesAvailable));
  }

  return snapshot;
}

function getResourcesChanged(
snapshot,
path)
{
  var newSnapshot = new ResourcesSnapshot();var _iterator4 = _createForOfIteratorHelper(

    ResourceIds),_step4;try {for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {var resource = _step4.value;
      var resourcesLeft = getResourcesLeft(resource);

      // If this resource is a yellow rocket
      if (resource == "Yellow Ray") {
        var prev = snapshot.resourceMap.get(resource);
        var diff = prev - resourcesLeft;

        // On YR effect, previously if we had 100 left
        // We'd now have 25 left
        // If a turn elapsed, then it'll go from 100 to 99

        // If we have a diff of less than 10, then it probably wasn't a YR
        if (diff < 10) {
          resourcesLeft = prev;
        }
      }

      // 20 - 19 = 1 resource used.
      var res = snapshot.resourceMap.get(resource) - resourcesLeft;

      if (res === 0) {
        continue;
      }

      newSnapshot.resourceMap.set(resource, res);
    }} catch (err) {_iterator4.e(err);} finally {_iterator4.f();}

  newSnapshot.resources = [];

  if (path == null) {
    return newSnapshot;
  }

  // Now we're looking for the difference between available resources, and previously available

  var lastIndex = 0;

  snapshot.resources.forEach(function (resource) {
    if (lastIndex < path.resourcesAvailable.length) {
      if (path.resourcesAvailable[lastIndex] === resource) {
        lastIndex++;
        return;
      }
    }

    newSnapshot.resources.push(resource);
  });

  if (newSnapshot.resources.length > 0) {
    (0,external_kolmafia_.print)(
    "We manually used: " +
    newSnapshot.resources.
    map(function (r) {return r.name + " x " + ResourceCategory[r.type];}).
    join(", "));

  }

  return newSnapshot;
}
;// CONCATENATED MODULE: ./src/iotms/delayburners/DelayBurningKramco.ts
function DelayBurningKramco_typeof(obj) {"@babel/helpers - typeof";return DelayBurningKramco_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, DelayBurningKramco_typeof(obj);}function DelayBurningKramco_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function DelayBurningKramco_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, DelayBurningKramco_toPropertyKey(descriptor.key), descriptor);}}function DelayBurningKramco_createClass(Constructor, protoProps, staticProps) {if (protoProps) DelayBurningKramco_defineProperties(Constructor.prototype, protoProps);if (staticProps) DelayBurningKramco_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function DelayBurningKramco_defineProperty(obj, key, value) {key = DelayBurningKramco_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function DelayBurningKramco_toPropertyKey(arg) {var key = DelayBurningKramco_toPrimitive(arg, "string");return DelayBurningKramco_typeof(key) === "symbol" ? key : String(key);}function DelayBurningKramco_toPrimitive(input, hint) {if (DelayBurningKramco_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (DelayBurningKramco_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}


var DelayBurningKramco = /*#__PURE__*/function () {function DelayBurningKramco() {DelayBurningKramco_classCallCheck(this, DelayBurningKramco);DelayBurningKramco_defineProperty(this, "kramco",
    external_kolmafia_.Item.get("Kramco Sausage-o-Matic"));DelayBurningKramco_defineProperty(this, "goose",
    external_kolmafia_.Familiar.get("Grey Goose"));}DelayBurningKramco_createClass(DelayBurningKramco, [{ key: "getFightSetup", value:

    function getFightSetup() {
      return [this.kramco];
    } }, { key: "doFightSetup", value:

    function doFightSetup() {
      (0,external_kolmafia_.equip)(this.kramco, external_kolmafia_.Slot.get("off-hand"));

      return [external_kolmafia_.Slot.get("off-hand")];
    } }, { key: "forcesFight", value:

    function forcesFight() {
      return false;
    } }, { key: "isViableAsCombatReplacer", value:

    function isViableAsCombatReplacer() {
      return this.getChanceOfFight() > 0.1; // 10% chance
    } }, { key: "isViable", value:

    function isViable() {
      return (0,external_kolmafia_.availableAmount)(this.kramco) > 0;
    } }, { key: "isFree", value:

    function isFree() {
      return true;
    } }, { key: "readyIn", value:

    function readyIn() {
      if ((0,external_kolmafia_.familiarWeight)(this.goose) < 6 && (0,external_kolmafia_.myAdventures)() >= 80) {
        return Math.max(7, this.getNextGuaranteedFight());
      }

      return this.getNextGuaranteedFight();
    } }, { key: "doSetup", value:

    function doSetup() {} }, { key: "getGoblinsFought", value:

    function getGoblinsFought() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_sausageFights"));
    } }, { key: "getLastGoblinTurn", value:

    function getLastGoblinTurn() {
      return (0,external_kolmafia_.totalTurnsPlayed)() - (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_lastSausageMonsterTurn"));
    } }, { key: "getNextGuaranteedGoblin", value:

    function getNextGuaranteedGoblin() {
      var goblinsFought = this.getGoblinsFought();

      return (
        4 +
        goblinsFought * 3 +
        Math.max(0, goblinsFought - 5) *
        Math.max(0, goblinsFought - 5) *
        Math.max(0, goblinsFought - 5));

    } }, { key: "getNextGuaranteedFight", value:

    function getNextGuaranteedFight() {
      if (this.getGoblinsFought() == 0) {
        return 0;
      }

      return Math.max(
      0,
      this.getNextGuaranteedGoblin() - this.getLastGoblinTurn());

    } }, { key: "getGoblinMultiplier", value:

    function getGoblinMultiplier() {
      return Math.max(0, this.getGoblinsFought() - 5);
    } }, { key: "getChanceOfFight", value:

    function getChanceOfFight() {
      if ((0,external_kolmafia_.familiarWeight)(this.goose) < 6 && (0,external_kolmafia_.myAdventures)() >= 80) {
        return 0;
      }

      var chance =
      (this.getLastGoblinTurn() + 1.0) / (
      (5.0 + this.getGoblinsFought()) * 3.0 +
      this.getGoblinMultiplier() *
      this.getGoblinMultiplier() *
      this.getGoblinMultiplier());

      if (chance > 1) {
        chance = 1;
      }
      if (chance < 0) {
        chance = 0;
      }

      return chance;
    } }]);return DelayBurningKramco;}();
;// CONCATENATED MODULE: ./src/iotms/delayburners/DelayBurningVoter.ts
function DelayBurningVoter_typeof(obj) {"@babel/helpers - typeof";return DelayBurningVoter_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, DelayBurningVoter_typeof(obj);}function DelayBurningVoter_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function DelayBurningVoter_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, DelayBurningVoter_toPropertyKey(descriptor.key), descriptor);}}function DelayBurningVoter_createClass(Constructor, protoProps, staticProps) {if (protoProps) DelayBurningVoter_defineProperties(Constructor.prototype, protoProps);if (staticProps) DelayBurningVoter_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function DelayBurningVoter_defineProperty(obj, key, value) {key = DelayBurningVoter_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function DelayBurningVoter_toPropertyKey(arg) {var key = DelayBurningVoter_toPrimitive(arg, "string");return DelayBurningVoter_typeof(key) === "symbol" ? key : String(key);}function DelayBurningVoter_toPrimitive(input, hint) {if (DelayBurningVoter_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (DelayBurningVoter_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}



var DelayBurningVoter = /*#__PURE__*/function () {function DelayBurningVoter() {DelayBurningVoter_classCallCheck(this, DelayBurningVoter);DelayBurningVoter_defineProperty(this, "absentee",
    external_kolmafia_.Item.get("Absentee Voter Ballot"));DelayBurningVoter_defineProperty(this, "sticker",
    external_kolmafia_.Item.get('"I Voted!" sticker'));}DelayBurningVoter_createClass(DelayBurningVoter, [{ key: "getFightSetup", value:

    function getFightSetup() {
      return [this.sticker];
    } }, { key: "doFightSetup", value:

    function doFightSetup() {
      (0,external_kolmafia_.equip)(this.sticker, external_kolmafia_.Slot.get("acc3"));

      return [external_kolmafia_.Slot.get("acc3")];
    } }, { key: "forcesFight", value:

    function forcesFight() {
      return true;
    } }, { key: "readyIn", value:

    function readyIn() {
      var turnsPlayed = (0,external_kolmafia_.totalTurnsPlayed)();

      var turnsTillNextFight = (turnsPlayed - 1) % 11;

      if (turnsTillNextFight > 0) {
        turnsTillNextFight = 11 - turnsTillNextFight;
      }

      if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastVoteMonsterTurn")) >= turnsPlayed) {
        turnsTillNextFight += 11;
      }

      return turnsTillNextFight;
    } }, { key: "doSetup", value:

    function doSetup() {
      if (
      (0,external_kolmafia_.availableAmount)(this.sticker) > 0 ||
      (0,external_kolmafia_.turnsPlayed)() > 200 ||
      this.getVoting() == null)
      {
        return;
      }

      this.voterSetup();
    } }, { key: "getVoting", value:

    function getVoting() {
      var match = GreySettings_GreySettings.greyVotingBooth.match(/^\d+(,\d+)*$/);

      if (match == null) {
        return null;
      }

      return GreySettings_GreySettings.greyVotingBooth.split(",").map(function (s) {return (0,external_kolmafia_.toInt)(s);});
    } }, { key: "isViable", value:

    function isViable() {
      if ((0,external_kolmafia_.availableAmount)(this.sticker) > 0) {
        return true;
      }

      if (this.getVoting() == null) {
        return false;
      }

      if ((0,external_kolmafia_.getProperty)("voteAlways") == "true") {
        return true;
      }

      if ((0,external_kolmafia_.pullsRemaining)() < 0) {
        return false;
      }

      return (0,external_kolmafia_.availableAmount)(this.absentee) > 0;
    } }, { key: "isFree", value:

    function isFree() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_voteFreeFights")) < 3;
    } }, { key: "voterSetup", value:

    function voterSetup() {
      var voterValueTable = [
      {
        monster: external_kolmafia_.Monster.get("terrible mutant"),
        value: (0,external_kolmafia_.mallPrice)(external_kolmafia_.Item.get("glob of undifferentiated tissue")) + 10
      },
      {
        monster: external_kolmafia_.Monster.get("angry ghost"),
        value: (0,external_kolmafia_.mallPrice)(external_kolmafia_.Item.get("ghostly ectoplasm")) * 1.11
      },
      {
        monster: external_kolmafia_.Monster.get("government bureaucrat"),
        value:
        (0,external_kolmafia_.mallPrice)(external_kolmafia_.Item.get("absentee voter ballot")) * 0.05 + 75 * 0.25 + 50
      },
      {
        monster: external_kolmafia_.Monster.get("annoyed snake"),
        value: 25 * 0.5 + 25
      },
      {
        monster: external_kolmafia_.Monster.get("slime blob"),
        value: 20 * 0.4 + 50 * 0.2 + 250 * 0.01
      }];


      if (
      (0,external_kolmafia_.availableAmount)(this.absentee) > 0 &&
      (0,external_kolmafia_.getProperty)("_voteToday") == "false" &&
      (0,external_kolmafia_.getProperty)("voteAlways") == "false")
      {
        try {
          (0,external_kolmafia_.visitUrl)("inv_use.php?pwd&which=3&whichitem=9991");
          //use(Item.get("Absentee Voter Ballot"));
        } catch (e) {}
      }

      try {
        (0,external_kolmafia_.visitUrl)("place.php?whichplace=town_right&action=townright_vote");
      } catch (e) {}

      var votingMonsterPriority = voterValueTable.
      sort(function (a, b) {return b.value - a.value;}).
      map(function (element) {return element.monster.name;});

      var monsterVote =
      votingMonsterPriority.indexOf((0,external_kolmafia_.getProperty)("_voteMonster1")) <
      votingMonsterPriority.indexOf((0,external_kolmafia_.getProperty)("_voteMonster2")) ?
      1 :
      2;

      var canVoteFor = [
      "Muscle Percent: +25",
      "Maximum HP Percent: -50",
      "Moxie Percent: +25",
      "Hot Resistance: +3"];


      canVoteFor.forEach(function (name, index) {
        var prop = (0,external_kolmafia_.getProperty)("_voteLocal" + (index + 1));

        if (prop == name) {
          return;
        }

        throw "Expected '".concat(name, "' as voting option ").concat(
        index + 1, " but instead got '").concat(
        prop, "'");
      });

      var votingOptions = this.getVoting();

      if (votingOptions.length < 1 || votingOptions.length > 2) {
        throw "Expected 1-2 voting options, received " + votingOptions.length;
      }

      votingOptions.forEach(function (option) {
        if (option < 0 || option > 4) {
          throw "Invalid voting option " + option + " provided";
        }
      });

      if (votingOptions.length == 1) {
        votingOptions.push(votingOptions[0]);
      }

      var firstProp = (0,external_kolmafia_.getProperty)("_voteLocal" + votingOptions[0]);
      var secondProp = (0,external_kolmafia_.getProperty)("_voteLocal" + votingOptions[1]);

      (0,external_kolmafia_.print)(
      "We're voting for " +
      firstProp +
      " (" +
      votingOptions[0] +
      ")" +
      " and " +
      secondProp +
      " (" +
      votingOptions[1] +
      ")",
      "gray");


      (0,external_kolmafia_.visitUrl)("choice.php?option=1&whichchoice=1331&g=".concat(
      monsterVote, "&local[]=").concat(
      votingOptions[0] - 1, "&local[]=").concat(
      votingOptions[1] - 1));

    } }]);return DelayBurningVoter;}();
;// CONCATENATED MODULE: ./src/iotms/delayburners/DelayCursedMagnifyingGlass.ts
function DelayCursedMagnifyingGlass_typeof(obj) {"@babel/helpers - typeof";return DelayCursedMagnifyingGlass_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, DelayCursedMagnifyingGlass_typeof(obj);}function DelayCursedMagnifyingGlass_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function DelayCursedMagnifyingGlass_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, DelayCursedMagnifyingGlass_toPropertyKey(descriptor.key), descriptor);}}function DelayCursedMagnifyingGlass_createClass(Constructor, protoProps, staticProps) {if (protoProps) DelayCursedMagnifyingGlass_defineProperties(Constructor.prototype, protoProps);if (staticProps) DelayCursedMagnifyingGlass_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function DelayCursedMagnifyingGlass_defineProperty(obj, key, value) {key = DelayCursedMagnifyingGlass_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function DelayCursedMagnifyingGlass_toPropertyKey(arg) {var key = DelayCursedMagnifyingGlass_toPrimitive(arg, "string");return DelayCursedMagnifyingGlass_typeof(key) === "symbol" ? key : String(key);}function DelayCursedMagnifyingGlass_toPrimitive(input, hint) {if (DelayCursedMagnifyingGlass_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (DelayCursedMagnifyingGlass_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}


var DelayBurningCursedMagnifyingGlass = /*#__PURE__*/function () {function DelayBurningCursedMagnifyingGlass() {DelayCursedMagnifyingGlass_classCallCheck(this, DelayBurningCursedMagnifyingGlass);DelayCursedMagnifyingGlass_defineProperty(this, "item",
    external_kolmafia_.Item.get("Cursed Magnifying Glass"));DelayCursedMagnifyingGlass_defineProperty(this, "lobsterBarrels",
    external_kolmafia_.Item.get("barrel of gunpowder"));DelayCursedMagnifyingGlass_defineProperty(this, "monster",
    external_kolmafia_.Monster.get("Lobsterfrogman"));}DelayCursedMagnifyingGlass_createClass(DelayBurningCursedMagnifyingGlass, [{ key: "getFightSetup", value:

    function getFightSetup() {
      return [this.item];
    } }, { key: "isViable", value:

    function isViable() {
      return (0,external_kolmafia_.availableAmount)(this.item) > 0;
    } }, { key: "isFree", value:

    function isFree() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_voidFreeFights")) < 5;
    } }, { key: "readyIn", value:

    function readyIn() {
      return 13 - (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("cursedMagnifyingGlassCount"));
    } }, { key: "doSetup", value:

    function doSetup() {} }, { key: "doFightSetup", value:

    function doFightSetup() {
      (0,external_kolmafia_.equip)(this.item, external_kolmafia_.Slot.get("off-hand"));

      return [external_kolmafia_.Slot.get("off-hand")];
    } }, { key: "forcesFight", value:

    function forcesFight() {
      return true;
    } }]);return DelayBurningCursedMagnifyingGlass;}();
;// CONCATENATED MODULE: ./src/iotms/delayburners/DelayBurners.ts
function DelayBurners_typeof(obj) {"@babel/helpers - typeof";return DelayBurners_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, DelayBurners_typeof(obj);}function DelayBurners_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = DelayBurners_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function DelayBurners_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return DelayBurners_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return DelayBurners_arrayLikeToArray(o, minLen);}function DelayBurners_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function DelayBurners_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function DelayBurners_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, DelayBurners_toPropertyKey(descriptor.key), descriptor);}}function DelayBurners_createClass(Constructor, protoProps, staticProps) {if (protoProps) DelayBurners_defineProperties(Constructor.prototype, protoProps);if (staticProps) DelayBurners_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function DelayBurners_defineProperty(obj, key, value) {key = DelayBurners_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function DelayBurners_toPropertyKey(arg) {var key = DelayBurners_toPrimitive(arg, "string");return DelayBurners_typeof(key) === "symbol" ? key : String(key);}function DelayBurners_toPrimitive(input, hint) {if (DelayBurners_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (DelayBurners_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}



var









DelayCriteriaBuilder = /*#__PURE__*/function () {function DelayCriteriaBuilder() {DelayBurners_classCallCheck(this, DelayCriteriaBuilder);DelayBurners_defineProperty(this, "freeFights",
    true);DelayBurners_defineProperty(this, "excludeSlots",
    null);DelayBurners_defineProperty(this, "forcedFights",
    false);DelayBurners_defineProperty(this, "atLeastCombatChance",
    0.1);DelayBurners_defineProperty(this, "showNonReady",
    false);}DelayBurners_createClass(DelayCriteriaBuilder, [{ key: "showAll", value:

    function showAll() {
      this.showNonReady = true;

      return this;
    } }, { key: "withFreeFights", value:

    function withFreeFights(freeFights) {
      this.freeFights = freeFights;

      return this;
    } }, { key: "withForcedFights", value:

    function withForcedFights(forcedFights) {
      this.forcedFights = forcedFights;

      return this;
    } }, { key: "withAtLeastCombatChance", value:

    function withAtLeastCombatChance(chance) {
      this.atLeastCombatChance = chance;

      return this;
    } }]);return DelayCriteriaBuilder;}();


var DelayCriteria = function DelayCriteria() {
  return new DelayCriteriaBuilder();
};

var DelayBurners = /*#__PURE__*/function () {function DelayBurners() {DelayBurners_classCallCheck(this, DelayBurners);}DelayBurners_createClass(DelayBurners, null, [{ key: "getDelays", value:


    function getDelays() {
      if (this.delays != null) {
        this.delays.sort(function (d1, d2) {
          if (d1.isFree() == d2.isFree()) {
            return 0;
          }

          return d1.isFree() ? -1 : 1;
        });

        return this.delays;
      }

      this.delays = [
      new DelayBurningKramco(),
      new DelayBurningVoter(),
      new DelayBurningCursedMagnifyingGlass()].
      filter(function (d) {return d.isViable();});var _iterator = DelayBurners_createForOfIteratorHelper(

        this.delays),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var delay = _step.value;
          delay.doSetup();
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

      return this.delays;
    } }, { key: "isTryingForDupeableGoblin", value:

    function isTryingForDupeableGoblin() {
      var fam = external_kolmafia_.Familiar.get("Grey Goose");

      return (
        (0,external_kolmafia_.familiarWeight)(fam) >= 6 &&
        (0,external_kolmafia_.familiarWeight)(fam) < 9 &&
        (0,external_kolmafia_.equippedAmount)(external_kolmafia_.Item.get("Kramco Sausage-o-Matic")) > 0);

    } }, { key: "getReadyDelayBurner", value:

    function getReadyDelayBurner()

    {var criteria = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : DelayCriteria();
      var burner = this.getCombatReplacers(criteria)[0];

      if (burner == null || burner.readyIn() > 0) {
        return null;
      }

      return burner;
    } }, { key: "isDelayBurnerReady", value:

    function isDelayBurnerReady()

    {var criteria = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : DelayCriteria();
      var burner = this.getCombatReplacers(criteria)[0];

      return burner != null && burner.readyIn() <= 0;
    } }, { key: "meetsCriteria", value:

    function meetsCriteria(
    d,
    criteria)
    {
      if (
      criteria.forcedFights != null &&
      criteria.forcedFights != d.forcesFight())
      {
        return false;
      }

      if (criteria.freeFights != null && criteria.freeFights != d.isFree()) {
        return false;
      }

      if (criteria.showNonReady == true) {
        return true;
      }

      if (d instanceof DelayBurningKramco) {
        return (
          d.getChanceOfFight() >=
          criteria.atLeastCombatChance);

      }

      return true;
    } }, { key: "getCombatReplacers", value:

    function getCombatReplacers()

    {var _this = this;var criteria = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : DelayCriteria();
      var delays = this.getDelays().filter(function (d) {
        return _this.meetsCriteria(d, criteria) && d.readyIn() == 0;
      });

      delays.sort(function (d1, d2) {
        // If we have a choice between two free delayers, pick the one that's free
        if (d1.isFree() != d2.isFree()) {
          return d1.isFree() ? -1 : 1;
        }

        // If we have a choice between ones that is basically kramco vs something else, pick the one that's more ready
        if (d1.readyIn() != d2.readyIn()) {
          return d1.readyIn() - d2.readyIn();
        }

        // If this is a free fight, prioritize the one that forces a fight since that's rarer
        if (d1.isFree() && d1.forcesFight() != d2.forcesFight()) {
          return d1.forcesFight() ? -1 : 1;
        }

        return 0;
      });

      return delays;
    } }, { key: "isDelayBurnerFeasible", value:

    function isDelayBurnerFeasible()

    {var _this2 = this;var criteria = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : DelayCriteria();
      return (
        this.getDelays().find(
        function (d) {return d.readyIn() < 7 && _this2.meetsCriteria(d, criteria);}) !=
        null);

    } }]);return DelayBurners;}();DelayBurners_defineProperty(DelayBurners, "delays", void 0);
;// CONCATENATED MODULE: ./src/utils/GreyOutfitter.ts
function GreyOutfitter_typeof(obj) {"@babel/helpers - typeof";return GreyOutfitter_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, GreyOutfitter_typeof(obj);}function GreyOutfitter_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = GreyOutfitter_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function GreyOutfitter_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return GreyOutfitter_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return GreyOutfitter_arrayLikeToArray(o, minLen);}function GreyOutfitter_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function GreyOutfitter_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function GreyOutfitter_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, GreyOutfitter_toPropertyKey(descriptor.key), descriptor);}}function GreyOutfitter_createClass(Constructor, protoProps, staticProps) {if (protoProps) GreyOutfitter_defineProperties(Constructor.prototype, protoProps);if (staticProps) GreyOutfitter_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function GreyOutfitter_defineProperty(obj, key, value) {key = GreyOutfitter_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function GreyOutfitter_toPropertyKey(arg) {var key = GreyOutfitter_toPrimitive(arg, "string");return GreyOutfitter_typeof(key) === "symbol" ? key : String(key);}function GreyOutfitter_toPrimitive(input, hint) {if (GreyOutfitter_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (GreyOutfitter_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}











var goose = external_kolmafia_.Familiar.get("Grey Goose");
var ghostCape = external_kolmafia_.Item.get("protonic accelerator pack");

var GreyOutfit = /*#__PURE__*/function () {


















  /**
   * When we don't want to cap how much combat we run
   */


  function GreyOutfit() {var string = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;GreyOutfitter_classCallCheck(this, GreyOutfit);GreyOutfitter_defineProperty(this, "allowChampBottle", false);GreyOutfitter_defineProperty(this, "famExpWeight", 30);GreyOutfitter_defineProperty(this, "itemDropWeight", 0.3);GreyOutfitter_defineProperty(this, "meatDropWeight", 0.1);GreyOutfitter_defineProperty(this, "hpWeight", 0.001);GreyOutfitter_defineProperty(this, "hpRegenWeight", 0.01);GreyOutfitter_defineProperty(this, "mpWeight", 0.001);GreyOutfitter_defineProperty(this, "mpRegenWeight", 0.01);GreyOutfitter_defineProperty(this, "initWeight", 0.05);GreyOutfitter_defineProperty(this, "plusCombatWeight", 0);GreyOutfitter_defineProperty(this, "minusCombatWeight", 0);GreyOutfitter_defineProperty(this, "bonusWeights", []);GreyOutfitter_defineProperty(this, "extra", []);GreyOutfitter_defineProperty(this, "overrideMaximizer", void 0);GreyOutfitter_defineProperty(this, "umbrellaSetting", void 0);GreyOutfitter_defineProperty(this, "combatCap", 25);
    this.overrideMaximizer = string;

    this.setWeights();
  }

  /**
   * Checks if the user defined a bonus weight. If so, discards our own.
   */GreyOutfitter_createClass(GreyOutfit, [{ key: "hasExtra", value:
    function hasExtra(name) {
      return (
        this.bonusWeights.find(
        function (s) {return (
            !(s.item instanceof external_kolmafia_.Item) &&
            s.item.
            toLowerCase().
            replace(/^[^a-z]+/, "").
            startsWith(name));}) !=
        null);

    } }, { key: "getUmbrella", value:

    function getUmbrella() {
      if (this.umbrellaSetting == null) {
        if (this.minusCombatWeight > 0) {
          return UmbrellaState.MINUS_COMBAT;
        } else {
          //if (outfit.itemDropWeight > 2) {
          return UmbrellaState.ITEM_DROPS;
        }
      }

      return this.umbrellaSetting;
    } }, { key: "setWeights", value:

    function setWeights() {
      if (GreySettings_GreySettings.greyLocketWeight > 0) {
        this.addWeight(
        external_kolmafia_.Item.get("combat lover's locket"),
        GreySettings_GreySettings.greyLocketWeight);

      }

      this.addWeight(external_kolmafia_.Item.get("lucky gold ring"), 20);
      this.addWeight(external_kolmafia_.Item.get("mafia thumb ring"), 19);

      /*if (getQuestStatus("questL13Final") <= 5) {
        if (availableAmount(Item.get("powerful glove")) > 0) {
          this.addWeight(Item.get("hewn moon-rune spoon"), -4);
          this.addWeight(Item.get("Powerful Glove"), 4.5);
        }
      }*/

      if ((0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("Camp Scout Backpack")) > 0) {
        this.addWeight(external_kolmafia_.Item.get("camp scout backpack"), 6000);
      }

      if (
      (0,external_kolmafia_.availableAmount)(GreyOutfit.teachersPen) > 1 &&
      (0,external_kolmafia_.availableAmount)(GreyOutfit.leafPendant) > 0)
      {
        this.addIgnored(GreyOutfit.leafPendant);
      }

      this.addExtra("-equip screwing pooch");

      if ((0,external_kolmafia_.myLevel)() > 15) {
        this.initWeight = 0.001;
      }

      if ((0,external_kolmafia_.myMeat)() > 12000) {
        this.meatDropWeight = 0.01;
      }

      if (
      !(0,external_kolmafia_.haveSkill)(external_kolmafia_.Skill.get("Hivemindedness")) &&
      (0,external_kolmafia_.myMp)() < Math.min(125, Math.max((0,external_kolmafia_.myMaxmp)(), 70)))
      {
        this.mpRegenWeight += 1;

        if ((0,external_kolmafia_.myMp)() <= 30) {
          this.mpRegenWeight += 2;
        }

        /*if (myMp() < 42) {
          this.mpRegenWeight += 2;
        }*/
      }

      if (
      GreySettings_GreySettings.isHardcoreMode() &&
      (0,external_kolmafia_.myAdventures)() < 40 &&
      (0,external_kolmafia_.familiarWeight)(external_kolmafia_.Familiar.get("Grey Goose")) < 6 &&
      (0,external_kolmafia_.haveSkill)(external_kolmafia_.Skill.get("Phase Shift")) &&
      (0,external_kolmafia_.haveSkill)(external_kolmafia_.Skill.get("Photonic Shroud")))
      {
        this.famExpWeight = 100;
      }

      // Setup weights according to w/e passives I have
      if (
      (0,external_kolmafia_.availableAmount)(ghostCape) > 0 &&
      (0,external_kolmafia_.getProperty)("ghostLocation") == "" &&
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("nextParanormalActivity")) <= (0,external_kolmafia_.totalTurnsPlayed)())
      {
        this.addWeight(ghostCape, 2);
      }
    } }, { key: "addDelayer", value:

    function addDelayer()


    {var delayCriteria = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : DelayCriteria();var weight = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 31;
      var delayer = DelayBurners.getReadyDelayBurner(delayCriteria);

      if (delayer == null) {
        return;
      }var _iterator = GreyOutfitter_createForOfIteratorHelper(

        delayer.getFightSetup()),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var item = _step.value;
          this.addWeight(item, weight);
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
    } }, { key: "addIgnored", value:

    function addIgnored(item) {
      return this.addExtra("-equip " + item.name);
    } }, { key: "addExtra", value:

    function addExtra(extra) {
      this.extra.push(extra);

      return this;
    } }, { key: "addWeight", value:

    function addWeight(
    item,
    weight,
    min,
    max)
    {
      weight = weight != null ? weight : item instanceof external_kolmafia_.Item ? 999999 : 1;

      if (!(item instanceof external_kolmafia_.Item)) {
        item = item.toLowerCase();
        item = item.
        replace(" exp", " experience").
        replace(" dmg", " damage").
        replace(/ res$/, " resistance").
        replace(/ mox$/, " moxie").
        replace(/ mys$/, " mysticality").
        replace(/ mus$/, " muscle");
      }

      if (
      weight < 999999 ||
      !(item instanceof external_kolmafia_.Item) ||
      (0,external_kolmafia_.availableAmount)(item) == 0)
      {
        var existing = this.bonusWeights.find(function (m) {return m.item === item;});

        if (existing != null) {
          if (existing.weight >= 0 == weight >= 0) {
            existing.weight += weight;

            if (min != null) {var _existing$min;
              existing.min = Math.max((_existing$min = existing.min) !== null && _existing$min !== void 0 ? _existing$min : 0, min);
            }

            if (max != null) {var _existing$max;
              existing.max = Math.max((_existing$max = existing.max) !== null && _existing$max !== void 0 ? _existing$max : 0, max);
            }
          } else {
            existing.weight = weight;
            existing.min = min;
            existing.max = max;
          }
        } else {
          this.bonusWeights.push({
            item: item,
            weight: weight,
            min: min,
            max: max
          });
        }
      } else {
        this.addExtra("+equip " + item.name);
      }

      return this;
    } }, { key: "setNoCombat", value:

    function setNoCombat() {
      if (this.minusCombatWeight > 0) {
        this.minusCombatWeight += 20;
        this.setUncapped();
      }

      this.minusCombatWeight += 10;
      return this;
    } }, { key: "setPlusCombat", value:

    function setPlusCombat() {
      if (this.plusCombatWeight > 0) {
        this.plusCombatWeight += 20;
        this.setUncapped();
      }

      this.plusCombatWeight += 10;
      return this;
    } }, { key: "setItemDrops", value:

    function setItemDrops() {
      this.itemDropWeight = 2;

      return this;
    } }, { key: "setChampagneBottle", value:

    function setChampagneBottle() {
      this.allowChampBottle = true;

      return this;
    } }, { key: "setUncapped", value:

    function setUncapped() {
      this.combatCap = 100;

      return this;
    } }, { key: "createString", value:

    function createString() {
      if (this.overrideMaximizer != null) {
        return this.overrideMaximizer;
      }

      var modifiers = [];

      if (this.famExpWeight > 0 && !this.hasExtra("familiar exp")) {
        var mod = "+" + this.famExpWeight + " familiar experience";

        if ((0,external_kolmafia_.familiarWeight)(goose) < 6) {
          // Subtract 1 as we gain a minimum of 1 exp per fight
          var expToReabsorb = 36 - 1 - goose.experience;

          mod += " " + expToReabsorb + " MAX";
        }

        modifiers.push(mod);
      }

      if (this.itemDropWeight > 0 && !this.hasExtra("item drop")) {
        modifiers.push("+" + this.itemDropWeight + " item drop");
      }

      if (this.meatDropWeight > 0 && !this.hasExtra("meat drop")) {
        modifiers.push("+" + this.meatDropWeight + " meat drop");
      }

      if (this.hpWeight > 0 && !this.hasExtra("hp")) {
        modifiers.push("+" + this.hpWeight + " hp");
      }

      if (this.hpRegenWeight > 0 && !this.hasExtra("hp regen")) {
        modifiers.push("+" + this.hpRegenWeight + " hp regen");
      }

      if (this.mpWeight > 0 && !this.hasExtra("mp")) {
        modifiers.push("+" + this.mpWeight + " mp");
      }

      if (this.mpRegenWeight > 0 && !this.hasExtra("mp regen")) {
        modifiers.push("+" + this.mpRegenWeight + " mp regen");
      }

      if (this.initWeight > 0 && !this.hasExtra("init")) {
        modifiers.push("+" + this.initWeight + " init");
      }

      if (this.plusCombatWeight > 0 && !this.hasExtra("combat")) {
        modifiers.push(
        "+" + this.plusCombatWeight + " combat " + this.combatCap + " MAX");

      }

      if (this.minusCombatWeight > 0 && !this.hasExtra("combat")) {
        modifiers.push(
        "-" + this.minusCombatWeight + " combat " + this.combatCap + " MAX");

      }var _iterator2 = GreyOutfitter_createForOfIteratorHelper(

        this.bonusWeights),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var weight = _step2.value;
          modifiers.push(
          (weight.weight >= 0 ? "+" + weight.weight : weight.weight) +
          " " + (
          weight.item instanceof external_kolmafia_.Item ? "bonus " : "") +
          weight.item + (
          weight.min != null ? " " + weight.min + " MIN" : "") + (
          weight.max != null ? " " + weight.max + " MAX" : ""));

        }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}var _iterator3 = GreyOutfitter_createForOfIteratorHelper(

        this.extra),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var extra = _step3.value;
          modifiers.push(extra);
        }} catch (err) {_iterator3.e(err);} finally {_iterator3.f();}

      if (!this.allowChampBottle && !this.hasExtra("equip broken champagne")) {
        modifiers.push("-equip broken champagne bottle");
      }

      return modifiers.join(" ");
    } }]);return GreyOutfit;}();GreyOutfitter_defineProperty(GreyOutfit, "IGNORE_OUTFIT", "Ignore Outfit");GreyOutfitter_defineProperty(GreyOutfit, "teachersPen", external_kolmafia_.Item.get("Teacher's Pen"));GreyOutfitter_defineProperty(GreyOutfit, "leafPendant", external_kolmafia_.Item.get("Autumn leaf pendant"));
;// CONCATENATED MODULE: ./src/utils/GreyResources.ts
function GreyResources_typeof(obj) {"@babel/helpers - typeof";return GreyResources_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, GreyResources_typeof(obj);}function GreyResources_slicedToArray(arr, i) {return GreyResources_arrayWithHoles(arr) || GreyResources_iterableToArrayLimit(arr, i) || GreyResources_unsupportedIterableToArray(arr, i) || GreyResources_nonIterableRest();}function GreyResources_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function GreyResources_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function GreyResources_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function GreyResources_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = GreyResources_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function GreyResources_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return GreyResources_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return GreyResources_arrayLikeToArray(o, minLen);}function GreyResources_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function GreyResources_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function GreyResources_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, GreyResources_toPropertyKey(descriptor.key), descriptor);}}function GreyResources_createClass(Constructor, protoProps, staticProps) {if (protoProps) GreyResources_defineProperties(Constructor.prototype, protoProps);if (staticProps) GreyResources_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function GreyResources_toPropertyKey(arg) {var key = GreyResources_toPrimitive(arg, "string");return GreyResources_typeof(key) === "symbol" ? key : String(key);}function GreyResources_toPrimitive(input, hint) {if (GreyResources_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (GreyResources_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}

var GreyPulls = /*#__PURE__*/function () {function GreyPulls() {GreyResources_classCallCheck(this, GreyPulls);}GreyResources_createClass(GreyPulls, null, [{ key: "pullFratWarOutfit", value:
    function pullFratWarOutfit() {var _iterator = GreyResources_createForOfIteratorHelper(
        (0,external_kolmafia_.outfitPieces)("Frat Warrior Fatigues")),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var i = _step.value;
          if ((0,external_kolmafia_.availableAmount)(i) > 0) {
            continue;
          }

          GreyPulls.tryPull(i);
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
    } }, { key: "pullCrypts", value:

    function pullCrypts() {
      GreyPulls.tryPull(external_kolmafia_.Item.get("Gravy Boat"));
    } }, { key: "pullBoxOfMatches", value:

    function pullBoxOfMatches() {
      GreyPulls.tryPull(external_kolmafia_.Item.get("book of matches"));
    } }, { key: "pullScrip", value:

    function pullScrip() {
      GreyPulls.tryPull(external_kolmafia_.Item.get("Shore Inc. Ship Trip Scrip"));
    } }, { key: "pullOre", value:

    function pullOre() {
      if ((0,external_kolmafia_.getProperty)("questL08Trapper") != "step1") {
        return;
      }

      var ore = external_kolmafia_.Item.get((0,external_kolmafia_.getProperty)("trapperOre"));

      if (ore == external_kolmafia_.Item.none || (0,external_kolmafia_.availableAmount)(ore) >= 3) {
        return;
      }

      this.tryPull(ore);
    } }, { key: "getPullableKeys", value:

    function getPullableKeys() {
      var items = getZappables(external_kolmafia_.Item.get("Jarlsberg's key")).filter(
      function (i) {return !i.quest;});


      items.sort(function (i1, i2) {
        // If an item is in storage, and the other item isn't. Prioritize the item in storage.
        if ((0,external_kolmafia_.storageAmount)(i1) > 0 != (0,external_kolmafia_.storageAmount)(i2) > 0) {
          return (0,external_kolmafia_.storageAmount)(i2) - (0,external_kolmafia_.storageAmount)(i1);
        }

        return (0,external_kolmafia_.mallPrice)(i1) - (0,external_kolmafia_.mallPrice)(i2);
      });

      return items;
    } }, { key: "tryRetrieve", value:

    function tryRetrieve(item) {var maxCost = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 30000;
      if ((0,external_kolmafia_.pullsRemaining)() >= 0) {
        return this.tryPull(item, maxCost);
      }

      if ((0,external_kolmafia_.itemAmount)(item) > 0) {
        return;
      }

      if ((0,external_kolmafia_.availableAmount)(item) > 0) {
        (0,external_kolmafia_.cliExecute)("retrieve " + item);
      } else {
        if ((0,external_kolmafia_.myMeat)() > (0,external_kolmafia_.myStorageMeat)()) {
          (0,external_kolmafia_.buy)(item, 1, maxCost);
        } else {
          GreyPulls.buyWithStorage(item, maxCost);
        }
      }
    } }, { key: "buyWithStorage", value:

    function buyWithStorage(item, maxCost) {
      var prop = "autoBuyPriceLimit";
      var prev = (0,external_kolmafia_.getProperty)(prop);

      try {
        (0,external_kolmafia_.setProperty)(prop, maxCost.toString());

        (0,external_kolmafia_.buyUsingStorage)(item, 1, maxCost);
      } finally {
        (0,external_kolmafia_.setProperty)(prop, prev);
      }
    } }, { key: "tryPull", value:

    function tryPull(item) {var maxCost = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 30000;
      if ((0,external_kolmafia_.storageAmount)(item) == 0) {
        GreyPulls.buyWithStorage(item, maxCost);
      }

      if ((0,external_kolmafia_.storageAmount)(item) == 0) {
        throw "Unable to pull " + item.name;
      }

      var propPrior = (0,external_kolmafia_.getProperty)("_roninStoragePulls");

      (0,external_kolmafia_.print)("Pulling " + item.name, "blue");
      (0,external_kolmafia_.cliExecute)("pull " + item.name);

      if ((0,external_kolmafia_.getProperty)("_roninStoragePulls") != propPrior) {
        var pulled = (0,external_kolmafia_.getProperty)("_roninStoragePulls").split(",");

        var greyPulls = (0,external_kolmafia_.getProperty)("_greyPulls").
        split(",").
        filter(function (s) {return s.length > 0;});
        greyPulls.push((0,external_kolmafia_.toInt)(item).toString());
        var pullsSorted = [];var _iterator2 = GreyResources_createForOfIteratorHelper(

          pulled),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var pull = _step2.value;
            if (!greyPulls.includes(pull)) {
              continue;
            }

            pullsSorted.push(pull);
          }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}var _iterator3 = GreyResources_createForOfIteratorHelper(

          greyPulls),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var remainder = _step3.value;
            if (pullsSorted.includes(remainder)) {
              continue;
            }

            (0,external_kolmafia_.print)("Somehow didn't detect " + remainder + " as a used pull", "red");
            pullsSorted.push(remainder);
          }} catch (err) {_iterator3.e(err);} finally {_iterator3.f();}

        (0,external_kolmafia_.setProperty)("_greyPulls", pullsSorted.join(","));
      }
    } }]);return GreyPulls;}();


function getZappables(item) {
  var items = [];

  Object.keys((0,external_kolmafia_.getRelated)(item, "zap")).forEach(function (s) {
    var i = external_kolmafia_.Item.get(s);

    if (items.includes(i)) {
      return;
    }

    items.push(i);
  });

  return items;
}var

Required;(function (Required) {Required["MUST"] = "You really should have these";Required["VERY_USEFUL"] = "Optional, but very very useful";Required["USEFUL"] = "Useful, but not major";Required["MINOR"] = "Minor, can skip";})(Required || (Required = {}));var






Type;(function (Type) {Type[Type["FREE"] = 0] = "FREE";Type[Type["IOTM"] = 1] = "IOTM";Type[Type["IOTM_EXTRA"] = 2] = "IOTM_EXTRA";})(Type || (Type = {}));





var GreyResources_GreyRequirements = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {function GreyRequirements() {GreyResources_classCallCheck(this, GreyRequirements);}GreyResources_createClass(GreyRequirements, [{ key: "hasRequired", value:
    function hasRequired() {
      var required = [];
      var add = function add(
      type,
      name,
      desc,
      e,
      owns)

      {var unsupported = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : false;
        if (name instanceof Item) {
          owns =
          itemAmount(name) +
          closetAmount(name) +
          storageAmount(name) +
          equippedAmount(name) >
          0;
          name = name.name;
        } else if (name instanceof Familiar) {
          owns = haveFamiliar(name);

          var hatchling = name.hatchling;

          if (
          !owns &&
          storageAmount(hatchling) +
          itemAmount(hatchling) +
          closetAmount(hatchling) +
          displayAmount(hatchling) +
          shopAmount(hatchling) >
          0)
          {
            desc +=
            "- <u>You do have the hatchling " + hatchling + " though..</u>";
          }

          name = "" + name;
        }

        if (unsupported) {
          desc = "<s>" + desc + "</s> - <b><u>CURRENTLY UNSUPPORTED</u></b>";
        }

        required.push([type, name, desc, e, owns]);
      };

      add(
      Type.IOTM,
      Familiar.get("Grey Goose"),
      "Without this, Grey You isn't really feasible",
      Required.MUST);


      add(
      Type.IOTM,
      Item.get("Clan VIP Lounge key"),
      "Used to remove Beaten Up, grab yellow rockets, fax and get the +fam exp effect!",
      Required.MUST);


      add(
      Type.FREE,
      Item.get("Yule Hatchet"),
      "Gives +2 fam exp every fight, basically a must have",
      Required.MUST);


      var locket = Object.keys(getLocketMonsters()).map(function (s) {return (
          s.toLowerCase().trim());});


      var monstersLocket = [
      "pygmy witch lawyer",
      "mountain man",
      "cloud of disembodied whiskers",
      "one-eyed willie",
      "little man in the canoe",
      "fantasy bandit",
      "vicious gnauga",
      "revolving bugbear"];


      if (locket.length > 0) {
        var monstersNeed = monstersLocket.filter(function (m) {return !locket.includes(m);});
        var monstersHave = monstersLocket.filter(function (m) {return locket.includes(m);});

        if (monstersNeed.length > 0) {
          add(
          Type.IOTM_EXTRA,
          "Combat Locket: " + monstersNeed.join(", "),
          "The script uses these in run, you are missing these from your combat locket",
          Required.MUST,
          false);

        }

        if (monstersHave.length > 0) {
          add(
          Type.IOTM_EXTRA,
          "Combat Locket: " + monstersHave.join(", "),
          "The script uses these in run, you have these",
          Required.MUST,
          true);

        }
      } else if (availableAmount(Item.get("Combat Lover's Locket")) > 0) {
        add(
        Type.IOTM_EXTRA,
        "Combat Locket " + monstersLocket.join(", "),
        "We can't tell if you have these in your locket unfortunately due to mafia limitations.",
        Required.MUST,
        false);

      }

      var poolSkill = Math.floor(
      2 * Math.sqrt(toInt(getProperty("poolSharkCount"))));


      if (poolSkill < 10) {
        add(
        Type.FREE,
        "Pool Skill", "You can train this up using 11-Leaf Clovers to have a permanant +10 across ascensions. You currently have a pool skill of ".concat(
        poolSkill, ", we want 10. Try looking up \"A Shark's Chum\" in the kol wiki."),
        Required.MUST,
        false);

      } else {
        add(
        Type.FREE,
        "Pool Skill",
        "You have fully trained up your pool skill, which is great for the Billards pool test!",
        Required.MUST,
        true);

      }

      add(
      Type.IOTM,
      Item.get("Unbreakable Umbrella"),
      "Awesome -Combat and +ML for Oil Peak",
      Required.VERY_USEFUL);


      add(
      Type.IOTM,
      Item.get("miniature crystal ball"),
      "Great for speeding up predictions, saves about 40 turns?",
      Required.VERY_USEFUL);


      add(
      Type.FREE,
      Familiar.get("Gelatinous Cubeling"),
      "Saves about 10 turns if you're not doing a tower break",
      Required.VERY_USEFUL);


      add(
      Type.IOTM,
      Item.get("Combat Lover's Locket"),
      "Used as a fax source, with some helpful enchants",
      Required.VERY_USEFUL);


      add(
      Type.IOTM,
      Item.get("Backup Camera"),
      "Great for +ML, Init and sometimes Fantasy Bandits & Lobsters",
      Required.VERY_USEFUL);


      add(
      Type.IOTM,
      Item.get("unwrapped knock-off retro superhero cape"),
      "Great for crypts & tower",
      Required.VERY_USEFUL);


      add(
      Type.IOTM,
      Item.get("Designer Sweatpants"),
      "Great for Ron Protesters, and restoring MP!",
      Required.VERY_USEFUL);


      add(
      Type.IOTM,
      Item.get("June Cleaver"),
      "Great for 1.5k meat, occasional 5 advs, smut orcs and the teachers pen which is +2 fam exp!",
      Required.VERY_USEFUL);


      add(
      Type.IOTM,
      Item.get("mumming trunk"),
      "Absolutely great for early game MP regeneration. Especially when you're tough on meat.",
      Required.VERY_USEFUL);


      add(
      Type.IOTM,
      Item.get("protonic accelerator pack"),
      "Used for some free delay, -5 combat, get a nice +2 fam exp offhand and as a MP restorer! With sweatpants as a stunner, this is great!",
      Required.VERY_USEFUL);


      add(
      Type.IOTM,
      Item.get("Familiar Scrapbook"),
      "Great for power leveling after GYou ends, and the offhand +1 fam exp!",
      Required.VERY_USEFUL);


      add(
      Type.IOTM,
      Item.get("SongBoom&trade; BoomBox"),
      "Awesome for startup meat & nuns, then passive Special Seasoning generation you can use/sell",
      Required.VERY_USEFUL);


      add(
      Type.IOTM,
      Item.get("hewn moon-rune spoon"),
      "Great for starting as vole, then switching to Blender! Probably worth 20 turns! Don't forget to setup your Greyday settings!",
      Required.VERY_USEFUL);


      add(
      Type.IOTM,
      Item.get("Deck of Every Card"),
      "Used as a key source and as an initial meat source. Not worth buying as its very expensive",
      Required.VERY_USEFUL);


      add(
      Type.FREE,
      Item.get("HOA regulation book"),
      "Prefered over Space Trip safety headphones for the +2 res, saves 20? turns, especially on smut orcs. Very minor difference which one you have.",
      Required.VERY_USEFUL);


      add(
      Type.FREE,
      Item.get("Space Trip safety headphones"),
      "HOA regulation book is used instead when available, but this still saves 20? turns, especially on smut orcs. Very minor difference which one you have.",
      Required.VERY_USEFUL);


      add(
      Type.FREE,
      Item.get("Mafia Thumb Ring"),
      "Gives roughly 30 extra adventures over the course of your run",
      Required.VERY_USEFUL);


      add(
      Type.IOTM,
      Item.get("Industrial Fire Extinguisher"),
      "Can speed up by up 15 to 25 turns",
      Required.USEFUL);


      add(
      Type.IOTM,
      "Mayday Contract",
      "Gives a nice +combat cape and starting 5k meat boost, meat boost is extremely minor if you use a pull instead.",
      Required.USEFUL,
      toBoolean(getProperty("hasMaydayContract")));


      add(
      Type.IOTM,
      "Cosmic Bowling Ball",
      "Banishes for all!",
      Required.USEFUL,
      toBoolean(getProperty("hasCosmicBowlingBall")));


      add(
      Type.IOTM,
      Item.get("Fourth of May Cosplay Saber"),
      "Great for faster lobsterfrogmen, ele res checks and for 1-2 yellow rays!",
      Required.USEFUL);


      add(
      Type.IOTM,
      Item.get("Powerful Glove"),
      "If not tower breaking, great for white pixels. If you have cursed mag glass, saves 5 turns if you don't have fallbot?",
      Required.USEFUL);


      add(
      Type.IOTM,
      Item.get("Cargo Cultist Shorts"),
      "Used to fight Smut Orc to save 6 turns, or for the frat outfit to save pulls or 12 turns",
      Required.USEFUL);


      add(
      Type.FREE,
      Item.get("Deck of lewd playing cards"),
      "Speeds up Ron Protesters",
      Required.USEFUL);


      add(
      Type.IOTM,
      Item.get("latte lovers member's mug"),
      "Gives +3 familiar exp roughly 100 turns into the run",
      Required.USEFUL);


      add(
      Type.IOTM,
      "'Greatest American Pants' or 'Navel Ring of Navel Gazing'",
      "Free runs",
      Required.USEFUL,
      [
      Item.get("Greatest American Pants"),
      Item.get("navel ring of navel gazing")].
      find(function (i) {return availableAmount(i) + storageAmount(i) > 0;}) != null);


      add(
      Type.IOTM,
      Item.get("Pantsgiving"),
      "Gives +2 all res, 10 items which can help save turncount and stacks up stomach size increasers",
      Required.USEFUL);


      add(
      Type.IOTM,
      Familiar.get("Shorter-Order Cook"),
      "Gives an initial boost to start, skip 6-8 leveling turns! Also great for tower killing!",
      Required.USEFUL);


      add(
      Type.IOTM,
      Familiar.get("Melodramedary"),
      "Saves 3 adventures for desert!",
      Required.MINOR);


      add(
      Type.IOTM,
      Familiar.get("Cat Burglar"),
      "Only used rarely, generally not worth picking up but does sometimes save 20k of resources in meat!",
      Required.MINOR);


      add(
      Type.IOTM,
      "Fantasyrealm",
      "This isn't worth buying as it devalues Lucky Gold Ring, but if you do have it; Then it's useful as another key source.",
      Required.MINOR,
      toBoolean(getProperty("frAlways")));


      add(
      Type.IOTM,
      Item.get("Cursed Magnifying Glass"),
      "Only really used for minor delay burning, and lobsters + powerful glove if no fallbot",
      Required.MINOR);


      add(
      Type.IOTM,
      Familiar.get("XO Skeleton"),
      "Used for its pickpocket, just saves a polar vortex for the well kitted players",
      Required.MINOR);


      add(
      Type.IOTM,
      "Autumn-aton",
      "Fetches stuff from zones, the only major one is sonofa beach, and less major if you're shiny. If very shiny, saves 4 turns + resources, otherwise 20+ turns",
      Required.USEFUL,
      toBoolean(getProperty("hasAutumnaton")));


      add(
      Type.IOTM,
      "Gingerbread City",
      "Useful as another key source",
      Required.MINOR,
      toBoolean(getProperty("gingerbreadCityAvailable")),
      true);


      add(
      Type.IOTM,
      "Piraterealm",
      "Useful as another key source",
      Required.MINOR,
      toBoolean(getProperty("prAlways")),
      true);


      add(
      Type.IOTM,
      Item.get("Kramco Sausage-o-Matic&trade;"),
      "Useful as a delay burner, and for another 23 adventures a day",
      Required.MINOR);


      add(
      Type.IOTM,
      "Voting Booth",
      "Iotm for voting, +3 hot res, +25% moxie buff, has interaction with powerful glove for lobsterfrogman, and gives 3 free delay burns",
      Required.MINOR,
      toBoolean(getProperty("voteAlways")),
      true);


      required.sort(function (_ref, _ref2) {var _ref3 = GreyResources_slicedToArray(_ref, 2),t1 = _ref3[0],r1 = _ref3[1];var _ref4 = GreyResources_slicedToArray(_ref2, 2),t2 = _ref4[0],r2 = _ref4[1];return (
          t1 == t2 ? r1.localeCompare(r2) : t1 - t2);});


      printHtml(
      '<div style="text-align: center;">======= Greyday Requirements =======<br><font color="gray">Note that this has significant overlap with loopgyou</font></div>');


      var tick = "<font color='green'></font>";
      var cross = "<font color='red'></font>";var _loop = function _loop()

      {var e = _arr2[_i2];
        if (e != Required.MUST) {
          printHtml("<hr>");
        }

        printHtml("<div style=\"text-align: center;\"><font color=\"blue\">".concat(
        e, "</font></div>"));

        var values = required.filter(function (r) {return r[3] == e;});var _iterator4 = GreyResources_createForOfIteratorHelper(

          values),_step4;try {for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {var _step4$value = GreyResources_slicedToArray(_step4.value, 5),name = _step4$value[1],desc = _step4$value[2],has = _step4$value[4];
            printHtml("".concat(
            has ? tick : cross, " <font color='").concat(
            has ? "" : "red", "'>").concat(
            name, "</font> <font color='gray'>=> ").concat(desc, "</font>"));

          }} catch (err) {_iterator4.e(err);} finally {_iterator4.f();}
      };for (var _i2 = 0, _arr2 = Object.values(Required); _i2 < _arr2.length; _i2++) {_loop();}

      if (required.find(function (r) {return r[4] == false;}) == null) {
        printHtml(
        "<center color='green'>Wow! You have everything in here!</center>");

      }

      printHtml('<div style="text-align: center;">===============</div>');
    } }]);return GreyRequirements;}()));
;// CONCATENATED MODULE: ./src/quests/council/crypts/QuestL7CryptPull.ts
function QuestL7CryptPull_typeof(obj) {"@babel/helpers - typeof";return QuestL7CryptPull_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL7CryptPull_typeof(obj);}function QuestL7CryptPull_slicedToArray(arr, i) {return QuestL7CryptPull_arrayWithHoles(arr) || QuestL7CryptPull_iterableToArrayLimit(arr, i) || QuestL7CryptPull_unsupportedIterableToArray(arr, i) || QuestL7CryptPull_nonIterableRest();}function QuestL7CryptPull_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function QuestL7CryptPull_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestL7CryptPull_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestL7CryptPull_arrayLikeToArray(o, minLen);}function QuestL7CryptPull_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestL7CryptPull_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function QuestL7CryptPull_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function QuestL7CryptPull_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL7CryptPull_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL7CryptPull_toPropertyKey(descriptor.key), descriptor);}}function QuestL7CryptPull_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL7CryptPull_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL7CryptPull_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL7CryptPull_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestL7CryptPull_setPrototypeOf(subClass, superClass);}function QuestL7CryptPull_setPrototypeOf(o, p) {QuestL7CryptPull_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestL7CryptPull_setPrototypeOf(o, p);}function QuestL7CryptPull_createSuper(Derived) {var hasNativeReflectConstruct = QuestL7CryptPull_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestL7CryptPull_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestL7CryptPull_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestL7CryptPull_possibleConstructorReturn(this, result);};}function QuestL7CryptPull_possibleConstructorReturn(self, call) {if (call && (QuestL7CryptPull_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestL7CryptPull_assertThisInitialized(self);}function QuestL7CryptPull_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestL7CryptPull_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestL7CryptPull_getPrototypeOf(o) {QuestL7CryptPull_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestL7CryptPull_getPrototypeOf(o);}function QuestL7CryptPull_defineProperty(obj, key, value) {key = QuestL7CryptPull_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL7CryptPull_toPropertyKey(arg) {var key = QuestL7CryptPull_toPrimitive(arg, "string");return QuestL7CryptPull_typeof(key) === "symbol" ? key : String(key);}function QuestL7CryptPull_toPrimitive(input, hint) {if (QuestL7CryptPull_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL7CryptPull_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var QuestL7CryptPull = /*#__PURE__*/function (_TaskInfo) {QuestL7CryptPull_inherits(QuestL7CryptPull, _TaskInfo);var _super = QuestL7CryptPull_createSuper(QuestL7CryptPull);function QuestL7CryptPull() {var _this;QuestL7CryptPull_classCallCheck(this, QuestL7CryptPull);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestL7CryptPull_defineProperty(QuestL7CryptPull_assertThisInitialized(_this), "cape",
    external_kolmafia_.Item.get("Unwrapped knock-off retro superhero cape"));QuestL7CryptPull_defineProperty(QuestL7CryptPull_assertThisInitialized(_this), "gravyboat",
    external_kolmafia_.Item.get("Gravy Boat"));QuestL7CryptPull_defineProperty(QuestL7CryptPull_assertThisInitialized(_this), "completed",
    false);QuestL7CryptPull_defineProperty(QuestL7CryptPull_assertThisInitialized(_this), "backupCamera",
    external_kolmafia_.Item.get("Backup Camera"));QuestL7CryptPull_defineProperty(QuestL7CryptPull_assertThisInitialized(_this), "hasRun",
    false);QuestL7CryptPull_defineProperty(QuestL7CryptPull_assertThisInitialized(_this), "paths",
    []);return _this;}QuestL7CryptPull_createClass(QuestL7CryptPull, [{ key: "getId", value:

    function getId() {
      return "Council / Crypt / Gravy Boat Pull";
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          _this2.hasRun = true;

          if (!path.canUse(ResourceCategory.PULL)) {
            return;
          }

          GreyPulls.pullCrypts();
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "createPaths", value:

    function createPaths(assumeUnstarted) {
      var _this$getEstimatedFig = this.getEstimatedFights(
        assumeUnstarted || (0,external_kolmafia_.getProperty)("questL07Cyrptic") == "unstarted"),_this$getEstimatedFig2 = QuestL7CryptPull_slicedToArray(_this$getEstimatedFig, 2),without = _this$getEstimatedFig2[0],withBoat = _this$getEstimatedFig2[1];


      this.paths = [
      new PossiblePath(without[0], without[1]),
      new PossiblePath(withBoat[0], withBoat[1]).addPull(this.gravyboat)];

    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    }

    /**
     * Returns estimated fights, without boat. And with boat.
     */ }, { key: "getEstimatedFights", value:
    function getEstimatedFights(
    assumeFresh)
    {
      // TODO Estimate using retrocape, fire extingusher, init, ML, rough item drop

      var swarmKills = Math.max(
      Math.floor(Math.sqrt(((0,external_kolmafia_.availableAmount)(this.backupCamera) ? 50 : 0) + 30)),
      3);

      var modernEncounterRate =
      0.15 + (((0,external_kolmafia_.availableAmount)(this.backupCamera) > 0 ? 100 : 0) + 150) / 1000;
      var eyeDropRate = 0.45; // Lets assume you have +300 drop rate and do party skeleton for -50 item
      var rattlingNC = 0.6; // Lets assume you have -25%, and base is 85%. So its 60%;

      var dirty = (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("cyrptNicheEvilness"));
      var eyes = (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("cyrptNookEvilness"));
      var rattling = (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("cyrptCrannyEvilness"));
      var sprinters = (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("cyrptAlcoveEvilness"));

      if (assumeFresh) {
        dirty = eyes = rattling = sprinters = 37;
      } else {
        dirty = Math.max(0, dirty - 37);
        eyes = Math.max(0, eyes - 37);
        rattling = Math.max(0, rattling - 37);
        sprinters = Math.max(0, sprinters - 37);
      }

      var evilPerNormFight = 1 + ((0,external_kolmafia_.availableAmount)(this.cape) > 0 ? 1 : 0);
      var evilPerBoatFight = evilPerNormFight + 1;

      var boatlessMinKills = 0;
      var boatlessMaxKills = 0;
      var boatMinKills = 0;
      var boatMaxKills = 0;

      // Eyes
      boatlessMaxKills += Math.ceil(eyes / evilPerNormFight);
      boatlessMinKills += Math.ceil(eyes / (evilPerNormFight + eyeDropRate * 3));

      boatMaxKills += Math.ceil(eyes / evilPerBoatFight);
      boatMinKills += Math.ceil(eyes / (evilPerBoatFight + eyeDropRate * 3));

      // Dirty
      boatlessMaxKills += Math.ceil(dirty / evilPerNormFight);
      // Adjust for encounter rate
      boatlessMinKills += Math.ceil(dirty / (evilPerNormFight + 3 * 0.3));

      boatMaxKills += Math.ceil(dirty / evilPerBoatFight);
      boatMinKills += Math.ceil(dirty / (evilPerBoatFight + 3 * 0.3));

      // Sprinters
      boatlessMaxKills += Math.ceil(sprinters / evilPerNormFight);
      // Adjust for encounter rate
      boatlessMinKills += Math.ceil(
      sprinters / (evilPerNormFight + 5 * modernEncounterRate));


      boatMaxKills += Math.ceil(sprinters / evilPerBoatFight);
      // Adjust for encounter rate
      boatMinKills += Math.ceil(
      sprinters / (evilPerBoatFight + 5 * modernEncounterRate));


      // Rattling
      boatlessMaxKills += Math.ceil(rattling / evilPerNormFight);
      boatlessMinKills += Math.ceil(
      rattling / (evilPerNormFight + rattlingNC * swarmKills));


      boatMaxKills += Math.ceil(rattling / evilPerBoatFight);
      boatMinKills += Math.ceil(
      rattling / (evilPerBoatFight + rattlingNC * swarmKills));


      return [
      [boatlessMinKills, boatlessMaxKills],
      [boatMinKills, boatMaxKills]];

    } }, { key: "level", value:

    function level() {
      return 4;
    } }, { key: "status", value:

    function status(path) {
      if (this.hasRun || (0,external_kolmafia_.availableAmount)(this.gravyboat) > 0) {
        return QuestStatus.COMPLETED;
      }

      if (path != null && !path.canUse(ResourceCategory.PULL)) {
        this.hasRun = true;
        return QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return true;
    } }, { key: "free", value:

    function free() {
      return true;
    } }]);return QuestL7CryptPull;}(TaskInfo);
;// CONCATENATED MODULE: ./src/utils/Properties.ts
function Properties_typeof(obj) {"@babel/helpers - typeof";return Properties_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, Properties_typeof(obj);}function Properties_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = Properties_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function Properties_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return Properties_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return Properties_arrayLikeToArray(o, minLen);}function Properties_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function Properties_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function Properties_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, Properties_toPropertyKey(descriptor.key), descriptor);}}function Properties_createClass(Constructor, protoProps, staticProps) {if (protoProps) Properties_defineProperties(Constructor.prototype, protoProps);if (staticProps) Properties_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function Properties_defineProperty(obj, key, value) {key = Properties_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function Properties_toPropertyKey(arg) {var key = Properties_toPrimitive(arg, "string");return Properties_typeof(key) === "symbol" ? key : String(key);}function Properties_toPrimitive(input, hint) {if (Properties_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (Properties_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}

var handledChoices = [];

var Properties_PropertyManager = /*#__PURE__*/function () {function PropertyManager() {Properties_classCallCheck(this, PropertyManager);Properties_defineProperty(this, "properties",
    new Map());Properties_defineProperty(this, "cleanups",
    []);Properties_defineProperty(this, "choicesSet",
    []);}Properties_createClass(PropertyManager, [{ key: "setProperty", value:

    function setProperty(property, value) {var quiet = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;
      if (!this.properties.has(property)) {
        this.properties.set(property, (0,external_kolmafia_.getProperty)(property));
      }

      (0,external_kolmafia_.setProperty)(property, value);

      if (!quiet) {
        (0,external_kolmafia_.print)("Set property " + property + " to " + value);
      }
    } }, { key: "addCleanup", value:

    function addCleanup(cleanup) {
      this.cleanups.push(cleanup);
    } }, { key: "setChoiceProperty", value:

    function setChoiceProperty(choice, value) {
      this.setChoice(choice, value);

      (0,external_kolmafia_.setProperty)("choiceAdventure" + choice, value.toString());
    } }, { key: "setChoice", value:

    function setChoice(choice, value) {
      var combo = [choice, value];

      this.choicesSet.push(combo);
      handledChoices.push(combo);
    } }, { key: "resetAll", value:

    function resetAll() {var quiet = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;
      this.properties.forEach(function (value, key) {
        (0,external_kolmafia_.setProperty)(key, value);

        if (!quiet) {
          (0,external_kolmafia_.print)("Reset property " + key + " back to " + value);
        }
      });

      this.properties.clear();var _iterator = Properties_createForOfIteratorHelper(

        this.choicesSet),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var combo = _step.value;
          var index = handledChoices.lastIndexOf(combo);

          if (index < 0) {
            throw "Failed to reset a choice! Was missing!";
          }

          handledChoices.splice(index, 1);
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

      this.choicesSet.splice(0, this.choicesSet.length);

      this.cleanups.forEach(function (c) {return c();});
      this.cleanups.splice(0, this.cleanups.length);
    } }]);return PropertyManager;}();
;// CONCATENATED MODULE: ./src/quests/council/beanstalk/QuestL10GiantShip.ts
function QuestL10GiantShip_typeof(obj) {"@babel/helpers - typeof";return QuestL10GiantShip_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL10GiantShip_typeof(obj);}function QuestL10GiantShip_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL10GiantShip_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL10GiantShip_toPropertyKey(descriptor.key), descriptor);}}function QuestL10GiantShip_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL10GiantShip_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL10GiantShip_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL10GiantShip_defineProperty(obj, key, value) {key = QuestL10GiantShip_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL10GiantShip_toPropertyKey(arg) {var key = QuestL10GiantShip_toPrimitive(arg, "string");return QuestL10GiantShip_typeof(key) === "symbol" ? key : String(key);}function QuestL10GiantShip_toPrimitive(input, hint) {if (QuestL10GiantShip_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL10GiantShip_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var QuestL10GiantShip = /*#__PURE__*/function () {function QuestL10GiantShip() {QuestL10GiantShip_classCallCheck(this, QuestL10GiantShip);QuestL10GiantShip_defineProperty(this, "modelShip",
    external_kolmafia_.Item.get("Model airship"));QuestL10GiantShip_defineProperty(this, "amulet",
    external_kolmafia_.Item.get("Amulet of Extreme Plot Significance"));QuestL10GiantShip_defineProperty(this, "umbrella",
    external_kolmafia_.Item.get("Titanium Assault Umbrella"));QuestL10GiantShip_defineProperty(this, "unbreakable",
    external_kolmafia_.Item.get("Unbreakable Umbrella"));QuestL10GiantShip_defineProperty(this, "wig",
    external_kolmafia_.Item.get("Mohawk Wig"));QuestL10GiantShip_defineProperty(this, "loc",
    external_kolmafia_.Location.get("The Penultimate Fantasy Airship"));QuestL10GiantShip_defineProperty(this, "wads",
    [
    "Tissue Paper Immateria",
    "Tin Foil Immateria",
    "Gauze Immateria",
    "Plastic Wrap Immateria"].
    map(function (s) {return external_kolmafia_.Item.get(s);}));QuestL10GiantShip_defineProperty(this, "protag",
    external_kolmafia_.Monster.get("Protagonist"));QuestL10GiantShip_defineProperty(this, "healer",
    external_kolmafia_.Monster.get("Quiet Healer"));QuestL10GiantShip_defineProperty(this, "burly",
    external_kolmafia_.Monster.get("Burly Sidekick"));QuestL10GiantShip_defineProperty(this, "princess",
    external_kolmafia_.Monster.get("Spunky Princess"));QuestL10GiantShip_defineProperty(this, "toAbsorb", void 0);}QuestL10GiantShip_createClass(QuestL10GiantShip, [{ key: "shouldRunNC", value:


    function shouldRunNC() {
      if ((0,external_kolmafia_.availableAmount)(this.modelShip) == 0 || this.loc.turnsSpent >= 25) {
        return true;
      }

      if (this.loc.turnsSpent < 5) {
        return false;
      }

      var wadExpected = this.wads[Math.floor(this.loc.turnsSpent - 5) / 5];

      // If we have this wad already, then we need to wait for the next wad to be available
      if (wadExpected != null && (0,external_kolmafia_.availableAmount)(wadExpected) > 0) {
        return false;
      }

      return true;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();

      var orbs = [];

      if ((0,external_kolmafia_.availableAmount)(this.amulet) == 0) {
        orbs.push(this.healer);
      }

      if (
      (0,external_kolmafia_.availableAmount)(this.umbrella) == 0 &&
      (0,external_kolmafia_.availableAmount)(this.unbreakable) == 0)
      {
        orbs.push(this.princess);
      }

      if ((0,external_kolmafia_.availableAmount)(this.wig) == 0) {
        orbs.push(this.burly);
      }

      if (orbs.length > 0) {
        outfit.setItemDrops();
      }

      if (this.shouldRunNC()) {
        outfit.setNoCombat();
      } else {
        var criteria = DelayCriteria();

        if (orbs.length == 0) {
          criteria.withFreeFights(null);
          criteria.withForcedFights(null);
        }

        outfit.addDelayer(criteria);
      }

      return {
        location: this.loc,
        outfit: outfit,
        orbs: orbs,
        mayFreeRun: true,
        freeRun: function freeRun(monster) {return !orbs.includes(monster);},
        run: function run() {
          var props = new Properties_PropertyManager();
          props.setChoice(681, 1);

          if (DelayBurners.isTryingForDupeableGoblin()) {
            (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Grey Goose"));
          }

          try {
            if ((0,external_kolmafia_.availableAmount)(_this.modelShip) == 0) {
              props.setChoice(182, 4);
            } else {
              props.setChoice(182, 1);
            }

            var settings = new AdventureSettings();
            settings.addBanish(_this.protag);

            greyAdv(_this.loc, outfit, settings);
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "getId", value:

    function getId() {
      return "Council / Beanstalk / Ship";
    } }, { key: "level", value:

    function level() {
      return 8;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL10Garbage");

      if (status < 1) {
        return QuestStatus.NOT_READY;
      }

      if (status > 6) {
        return QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }]);return QuestL10GiantShip;}();
;// CONCATENATED MODULE: ./src/quests/council/beanstalk/QuestL10GiantGround.ts
function QuestL10GiantGround_typeof(obj) {"@babel/helpers - typeof";return QuestL10GiantGround_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL10GiantGround_typeof(obj);}function QuestL10GiantGround_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL10GiantGround_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL10GiantGround_toPropertyKey(descriptor.key), descriptor);}}function QuestL10GiantGround_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL10GiantGround_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL10GiantGround_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL10GiantGround_defineProperty(obj, key, value) {key = QuestL10GiantGround_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL10GiantGround_toPropertyKey(arg) {var key = QuestL10GiantGround_toPrimitive(arg, "string");return QuestL10GiantGround_typeof(key) === "symbol" ? key : String(key);}function QuestL10GiantGround_toPrimitive(input, hint) {if (QuestL10GiantGround_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL10GiantGround_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var QuestL10GiantGround = /*#__PURE__*/function () {function QuestL10GiantGround() {QuestL10GiantGround_classCallCheck(this, QuestL10GiantGround);QuestL10GiantGround_defineProperty(this, "boning",
    external_kolmafia_.Item.get("electric boning knife"));QuestL10GiantGround_defineProperty(this, "loc",
    external_kolmafia_.Location.get(
    "The Castle in the Clouds in the Sky (Ground Floor)"));QuestL10GiantGround_defineProperty(this, "toAbsorb", void 0);QuestL10GiantGround_defineProperty(this, "drunkBell",


    external_kolmafia_.Item.get("Drunkula's bell"));QuestL10GiantGround_defineProperty(this, "rocket",
    external_kolmafia_.Item.get("Great Wolf's rocket launcher"));}QuestL10GiantGround_createClass(QuestL10GiantGround, [{ key: "isDelayBurning", value:

    function isDelayBurning() {
      return (
        this.isKnifeHunting() &&
        this.toAbsorb.length == 0 &&
        this.loc.turnsSpent < 11);

    } }, { key: "delayCriteria", value:

    function delayCriteria() {
      return DelayCriteria().withForcedFights(
      !this.isDelayBurning() ? false : null);

    } }, { key: "isKnifeHunting", value:

    function isKnifeHunting() {
      if ((0,external_kolmafia_.availableAmount)(this.boning) > 0) {
        return false;
      }

      /*if (GreySettings.shouldAvoidTowerRequirements()) {
        return (
          availableAmount(this.drunkBell) +
            availableAmount(this.rocket) +
            storageAmount(this.drunkBell) +
            storageAmount(this.rocket) ==
          0
        );
      }*/

      return true;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();

      if (this.loc.turnsSpent < 11) {
        if (this.isKnifeHunting()) {
          outfit.setNoCombat();
        } else {
          outfit.setPlusCombat();
        }

        if (this.toAbsorb.length == 0) {
          outfit.addDelayer(this.delayCriteria());
        }
      }

      return {
        location: this.loc,
        outfit: outfit,
        freeRun: function freeRun() {return true;},
        run: function run() {
          var props = new Properties_PropertyManager();
          var hasBone = (0,external_kolmafia_.availableAmount)(_this.boning) > 0;

          if (DelayBurners.isTryingForDupeableGoblin()) {
            (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Grey Goose"));
          }

          try {
            props.setChoice(672, 2);
            props.setChoice(673, 2);
            props.setChoice(674, 2);
            props.setChoice(1026, hasBone ? 3 : 2);

            greyAdv(_this.loc, outfit);
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "getId", value:

    function getId() {
      return "Council / Beanstalk / Ground";
    } }, { key: "level", value:

    function level() {
      return 8;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL10Garbage");

      if (status < 8) {
        return QuestStatus.NOT_READY;
      }

      if (status > 8) {
        return QuestStatus.COMPLETED;
      }

      if (this.isDelayBurning()) {
        if (DelayBurners.isDelayBurnerReady()) {
          return QuestStatus.READY;
        }

        if (DelayBurners.isDelayBurnerFeasible()) {
          return QuestStatus.FASTER_LATER;
        }
      }

      return QuestStatus.READY;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }]);return QuestL10GiantGround;}();
;// CONCATENATED MODULE: ./src/quests/council/beanstalk/QuestL10GiantBasement.ts
function QuestL10GiantBasement_typeof(obj) {"@babel/helpers - typeof";return QuestL10GiantBasement_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL10GiantBasement_typeof(obj);}function QuestL10GiantBasement_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL10GiantBasement_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL10GiantBasement_toPropertyKey(descriptor.key), descriptor);}}function QuestL10GiantBasement_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL10GiantBasement_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL10GiantBasement_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL10GiantBasement_defineProperty(obj, key, value) {key = QuestL10GiantBasement_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL10GiantBasement_toPropertyKey(arg) {var key = QuestL10GiantBasement_toPrimitive(arg, "string");return QuestL10GiantBasement_typeof(key) === "symbol" ? key : String(key);}function QuestL10GiantBasement_toPrimitive(input, hint) {if (QuestL10GiantBasement_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL10GiantBasement_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var QuestL10GiantBasement = /*#__PURE__*/function () {









  // TODO Once we've got the absorbs, try replace combats if it doesn't interfere with our slots cos umbrella

  function QuestL10GiantBasement() {QuestL10GiantBasement_classCallCheck(this, QuestL10GiantBasement);QuestL10GiantBasement_defineProperty(this, "amulet", external_kolmafia_.Item.get("Amulet of Extreme Plot Significance"));QuestL10GiantBasement_defineProperty(this, "umbrella", external_kolmafia_.Item.get("Titanium Assault Umbrella"));QuestL10GiantBasement_defineProperty(this, "dumbell", external_kolmafia_.Item.get("Massive Dumbbell"));QuestL10GiantBasement_defineProperty(this, "loc", external_kolmafia_.Location.get("The Castle in the Clouds in the Sky (Basement)"));QuestL10GiantBasement_defineProperty(this, "alphaGiant", external_kolmafia_.Monster.get("Alphabet Giant"));QuestL10GiantBasement_defineProperty(this, "letterD", external_kolmafia_.Item.get("Heavy D"));QuestL10GiantBasement_defineProperty(this, "toAbsorb", void 0);
    var umbrella = external_kolmafia_.Item.get("Unbreakable Umbrella");

    if ((0,external_kolmafia_.availableAmount)(umbrella) > 0) {
      this.umbrella = umbrella; // They replace!
    }
  }QuestL10GiantBasement_createClass(QuestL10GiantBasement, [{ key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit().setNoCombat();

      if (this.toAbsorb.length == 0) {
        outfit.addDelayer();
      }

      return {
        location: this.loc,
        outfit: outfit,
        freeRun: function freeRun(monster) {return (
            monster == _this.alphaGiant && (0,external_kolmafia_.itemAmount)(_this.letterD) == 0);},
        run: function run() {
          if (DelayBurners.isTryingForDupeableGoblin()) {
            (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Grey Goose"));
          }

          var turnsSpent = (0,external_kolmafia_.turnsPlayed)();
          _this.runAdv(outfit);

          // If we took a turn, or the last choice wasn't one asking for umbrella & amulet
          if (
          turnsSpent != (0,external_kolmafia_.turnsPlayed)() ||
          (0,external_kolmafia_.lastChoice)() != 669 && (0,external_kolmafia_.lastChoice)() != 670)
          {
            return;
          }

          (0,external_kolmafia_.print)(
          "Detected that we've hit the giant NC and want to wear an umbrella/amulet.. So equipping that and trying it again.",
          "blue");


          for (var _i = 0, _arr = [_this.umbrella, _this.amulet]; _i < _arr.length; _i++) {var i = _arr[_i];
            if ((0,external_kolmafia_.equippedAmount)(i) > 0 || (0,external_kolmafia_.itemAmount)(i) == 0) {
              continue;
            }

            (0,external_kolmafia_.equip)(i);
          }

          _this.runAdv(outfit);
        }
      };
    } }, { key: "runAdv", value:

    function runAdv(outfit) {
      var props = new Properties_PropertyManager();

      try {
        // Do umbrella
        if ((0,external_kolmafia_.equippedAmount)(this.umbrella) > 0 || (0,external_kolmafia_.itemAmount)(this.umbrella) == 0) {
          // If we have umbrella equipped, or don't have one
          props.setChoice(669, 1);
        } else {
          props.setChoice(669, 4); // Skip so we can resume
        }

        // If have amulet otherwise grab dumbbell (or skips it)
        if ((0,external_kolmafia_.equippedAmount)(this.amulet) > 0) {
          props.setChoice(670, 4);
        } else if ((0,external_kolmafia_.itemAmount)(this.amulet) == 0) {
          // Grab dumbbell
          props.setChoice(670, 1);
        } else {
          // Skip
          props.setChoice(670, 5);
        }

        // Use dumbbell to open stuff
        if ((0,external_kolmafia_.availableAmount)(this.dumbell) > 0) {
          props.setChoice(671, 1);
        } else {
          // Go to gym
          props.setChoice(671, 4);
        }

        greyAdv(this.loc, outfit);
      } finally {
        props.resetAll();
      }
    } }, { key: "getId", value:

    function getId() {
      return "Council / Beanstalk / Basement";
    } }, { key: "level", value:

    function level() {
      return 8;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL10Garbage");

      if (status < 7) {
        return QuestStatus.NOT_READY;
      }

      if (status > 7) {
        return QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }]);return QuestL10GiantBasement;}();
;// CONCATENATED MODULE: ./src/quests/council/beanstalk/QuestL10GiantTop.ts
function QuestL10GiantTop_typeof(obj) {"@babel/helpers - typeof";return QuestL10GiantTop_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL10GiantTop_typeof(obj);}function QuestL10GiantTop_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL10GiantTop_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL10GiantTop_toPropertyKey(descriptor.key), descriptor);}}function QuestL10GiantTop_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL10GiantTop_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL10GiantTop_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL10GiantTop_defineProperty(obj, key, value) {key = QuestL10GiantTop_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL10GiantTop_toPropertyKey(arg) {var key = QuestL10GiantTop_toPrimitive(arg, "string");return QuestL10GiantTop_typeof(key) === "symbol" ? key : String(key);}function QuestL10GiantTop_toPrimitive(input, hint) {if (QuestL10GiantTop_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL10GiantTop_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var QuestL10GiantTop = /*#__PURE__*/function () {function QuestL10GiantTop() {QuestL10GiantTop_classCallCheck(this, QuestL10GiantTop);QuestL10GiantTop_defineProperty(this, "modelAirShip",
    external_kolmafia_.Item.get("Model airship"));QuestL10GiantTop_defineProperty(this, "wig",
    external_kolmafia_.Item.get("Mohawk Wig"));QuestL10GiantTop_defineProperty(this, "record",
    external_kolmafia_.Item.get("drum 'n' bass 'n' drum 'n' bass record"));QuestL10GiantTop_defineProperty(this, "rocketToStars",
    external_kolmafia_.Item.get("steam-powered model rocketship"));QuestL10GiantTop_defineProperty(this, "loc",
    external_kolmafia_.Location.get(
    "The Castle in the Clouds in the Sky (Top Floor)"));QuestL10GiantTop_defineProperty(this, "steamNC",

    677);QuestL10GiantTop_defineProperty(this, "raverNC",
    676);QuestL10GiantTop_defineProperty(this, "punkNC",
    678);QuestL10GiantTop_defineProperty(this, "gothNC",
    675);QuestL10GiantTop_defineProperty(this, "holeInSky",
    new QuestTowerHoleInSkyUnlock());QuestL10GiantTop_defineProperty(this, "toAbsorb", void 0);}QuestL10GiantTop_createClass(QuestL10GiantTop, [{ key: "getChildren", value:


    function getChildren() {
      return [this.holeInSky];
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit().setNoCombat();

      if ((0,external_kolmafia_.availableAmount)(this.wig) > 0) {
        outfit.addWeight(this.wig);
      }

      if (this.toAbsorb.length == 0) {
        outfit.addDelayer();
      }

      return {
        location: this.loc,
        outfit: outfit,
        freeRun: function freeRun(monster) {return true;},
        run: function run() {
          if (DelayBurners.isTryingForDupeableGoblin()) {
            (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Grey Goose"));
          }

          var props = new Properties_PropertyManager();

          try {
            // Goth and steam love each other
            if ((0,external_kolmafia_.availableAmount)(_this.modelAirShip) > 0) {
              props.setChoice(_this.steamNC, 1); // Use model ship
              props.setChoice(_this.gothNC, 4); // Crawl to copper
            } else if ((0,external_kolmafia_.availableAmount)(_this.record) > 0) {
              // We have the record, lets end this.
              props.setChoice(_this.steamNC, 4); // Crawl to goth
              props.setChoice(_this.gothNC, 2); // Grab record
            } else if ((0,external_kolmafia_.availableAmount)(_this.rocketToStars) == 0) {
              // We don't have airship or record, to avoid fighting lets just grab the rocket if we can
              props.setChoice(_this.steamNC, 2); // Grab rocket
              props.setChoice(_this.gothNC, 4); // Crawl to steam
            } else {
              // This adv is a waste, just fight.
              props.setChoice(_this.steamNC, 1); // Fight steam
              props.setChoice(_this.gothNC, 1); // Fight goth
            }

            // Punk and raver love each other
            if ((0,external_kolmafia_.equippedAmount)(_this.wig) > 0) {
              // If we can end this with the wig
              props.setChoice(_this.punkNC, 1); // Use wig
              props.setChoice(_this.raverNC, 4); // Crawl to punk rock
            } else if ((0,external_kolmafia_.availableAmount)(_this.record) == 0) {
              // If we can grab a record
              props.setChoice(_this.punkNC, 4); // Crawl to raver
              props.setChoice(_this.raverNC, 3); // Grab record
            } else {
              // We're going to waste an adventure
              props.setChoice(_this.punkNC, 4); // Crawl to raver
              props.setChoice(_this.raverNC, 1); // Fight the raver for their advs
            }

            props.setChoice(679, 1); // Turn dat wheel

            greyAdv(_this.loc, outfit);

            if ((0,external_kolmafia_.lastChoice)() == 679) {
              (0,external_kolmafia_.council)();
            }
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "getId", value:

    function getId() {
      return "Council / Beanstalk / Top";
    } }, { key: "level", value:

    function level() {
      return 10;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL10Garbage");

      if (status < 9) {
        return QuestStatus.NOT_READY;
      }

      if (status > 9) {
        return QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }]);return QuestL10GiantTop;}();


var QuestTowerHoleInSkyUnlock = /*#__PURE__*/function () {function QuestTowerHoleInSkyUnlock() {QuestL10GiantTop_classCallCheck(this, QuestTowerHoleInSkyUnlock);QuestL10GiantTop_defineProperty(this, "topFloor",
    external_kolmafia_.Location.get(
    "The Castle in the Clouds in the Sky (Top Floor)"));QuestL10GiantTop_defineProperty(this, "rocket",

    external_kolmafia_.Item.get("steam-powered model rocketship"));QuestL10GiantTop_defineProperty(this, "copperFeel",
    677);QuestL10GiantTop_defineProperty(this, "flavorOfARaver",
    676);QuestL10GiantTop_defineProperty(this, "yeahPunkRock",
    678);QuestL10GiantTop_defineProperty(this, "gothNC",
    675);}QuestL10GiantTop_createClass(QuestTowerHoleInSkyUnlock, [{ key: "getId", value:

    function getId() {
      return "Council / Tower / Keys / HoleInSkyUnlock";
    } }, { key: "level", value:

    function level() {
      return 8;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.getProperty)("questL10Garbage") != "finished") {
        return QuestStatus.NOT_READY;
      }

      if (
      getQuestStatus("questL13Final") > 5 ||
      (0,external_kolmafia_.availableAmount)(this.rocket) > 0)
      {
        return QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this2 = this;
      var outfit = new GreyOutfit().setNoCombat();

      return {
        location: this.topFloor,
        outfit: outfit,
        freeRun: function freeRun() {return true;},
        run: function run() {
          var props = new Properties_PropertyManager();

          props.setChoice(_this2.copperFeel, 2); // Grab rocket
          props.setChoice(_this2.gothNC, 4); // Crawl to steam
          props.setChoice(_this2.yeahPunkRock, 3); // Crawl to steam
          props.setChoice(_this2.flavorOfARaver, 4); // Crawl to punk

          try {
            greyAdv(_this2.topFloor, outfit);
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }]);return QuestTowerHoleInSkyUnlock;}();
;// CONCATENATED MODULE: ./src/quests/council/QuestL10Giants.ts
function QuestL10Giants_typeof(obj) {"@babel/helpers - typeof";return QuestL10Giants_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL10Giants_typeof(obj);}function QuestL10Giants_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL10Giants_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL10Giants_toPropertyKey(descriptor.key), descriptor);}}function QuestL10Giants_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL10Giants_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL10Giants_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL10Giants_defineProperty(obj, key, value) {key = QuestL10Giants_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL10Giants_toPropertyKey(arg) {var key = QuestL10Giants_toPrimitive(arg, "string");return QuestL10Giants_typeof(key) === "symbol" ? key : String(key);}function QuestL10Giants_toPrimitive(input, hint) {if (QuestL10Giants_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL10Giants_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}








var QuestL10Beanstalk = /*#__PURE__*/function () {



  function QuestL10Beanstalk() {QuestL10Giants_classCallCheck(this, QuestL10Beanstalk);QuestL10Giants_defineProperty(this, "bean", external_kolmafia_.Item.get("Enchanted Bean"));QuestL10Giants_defineProperty(this, "children", []);
    this.children.push(new QuestL10GiantShip());
    this.children.push(new QuestL10GiantGround());
    this.children.push(new QuestL10GiantBasement());
    this.children.push(new QuestL10GiantTop());
  }QuestL10Giants_createClass(QuestL10Beanstalk, [{ key: "getChildren", value:

    function getChildren() {
      return this.children;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "level", value:

    function level() {
      return 10;
    } }, { key: "getId", value:

    function getId() {
      return "Council / Beanstalk / EnchantedBean";
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL10Garbage");

      if (status > 0) {
        return QuestStatus.COMPLETED;
      }

      if (status < 0) {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.availableAmount)(this.bean) == 0) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return true;
    } }, { key: "free", value:

    function free() {
      return true;
    } }, { key: "run", value:

    function run() {
      // Use bean if we need to
      var status = getQuestStatus("questL10Garbage");

      if (status == 0) {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {
            (0,external_kolmafia_.use)(external_kolmafia_.Item.get("Enchanted Bean"));
          }
        };
      }

      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          (0,external_kolmafia_.council)();
        }
      };
    } }]);return QuestL10Beanstalk;}();var


GiantStatus;(function (GiantStatus) {GiantStatus["unstarted"] = "unstarted";GiantStatus["started"] = "started";GiantStatus["step1"] = "PLANTED_BEAN";GiantStatus["step2"] = "LOOKING_SHIP_WADS";GiantStatus["step3"] = "TISSUE_WAD";GiantStatus["step4"] = "TIN_WAD";GiantStatus["step5"] = "GAUZE_WAD";GiantStatus["step6"] = "PLASTIC_WAD";GiantStatus["step7"] = "BASEMENT";GiantStatus["step8"] = "GROUND_FLOOR";GiantStatus["step9"] = "TOP_FLOOR";GiantStatus["step10"] = "TURNED_WHEEL";GiantStatus["finished"] = "finished";})(GiantStatus || (GiantStatus = {}));
;// CONCATENATED MODULE: ./src/utils/LatteUtils.ts
function LatteUtils_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = LatteUtils_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function LatteUtils_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return LatteUtils_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return LatteUtils_arrayLikeToArray(o, minLen);}function LatteUtils_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}

var LatteFlavor;


















// Map of kol latte names, to mafia latte names
(function (LatteFlavor) {LatteFlavor["FAM_EXP"] = "vitamins";LatteFlavor["ITEM_DROP"] = "carrot";LatteFlavor["COLD_DAMAGE"] = "blue chalks";LatteFlavor["MEAT_DROP"] = "cajun";LatteFlavor["PVP_FIGHTS"] = "hellion";LatteFlavor["PLUS_COMBAT"] = "wing";LatteFlavor["MINUS_COMBAT"] = "ink";LatteFlavor["MP_5_REGEN"] = "carrrdamom";LatteFlavor["MP_10_REGEN"] = "lizard milk";LatteFlavor["HOT_RESIST"] = "chili seeds";LatteFlavor["COLD_RESIST"] = "cocoa powder";LatteFlavor["SLEAZE_RESIST"] = "white flour";LatteFlavor["SPOOKY_RESIST"] = "squamous salt";LatteFlavor["STENCH_RESIST"] = "clove";LatteFlavor["FAMILIAR_WEIGHT"] = "rawhide";LatteFlavor["UNKNOWN"] = "??";})(LatteFlavor || (LatteFlavor = {}));var latteAliases = new Map([
["fortified", "vitamins"],
["hot wing", "wing"],
["hot wings", "wing"],
["hot wing and", "wing"]]);


function getFlavors() {
  var page = (0,external_kolmafia_.visitUrl)("main.php?latte=1", false);
  (0,external_kolmafia_.visitUrl)("main.php");
  var flavors = [];var _iterator = LatteUtils_createForOfIteratorHelper(

    page.split(
    '<td valign="top" style="border-bottom: 1px solid black"></td>')),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;)
    {var spl = _step.value;
      var match = spl.match(
      /<input {2}type="radio" name="l([123])" checked value="[a-zA-Z0-9/+]+">[a-zA-z- ]+<\/td>/);


      if (match == null) {
        continue;
      }

      var level = (0,external_kolmafia_.toInt)(match[1]);
      match = spl.match(
      /<input {2}type="radio" name="l1" (?:checked)? value="[a-zA-Z0-9/+]+"> *([a-zA-z- ]+?) *<\/td>/);


      flavors[level - 1] = match[1];
    }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

  return flavors;
}

function getCurrentLatteFlavors() {
  var knownFlavors = (0,external_kolmafia_.getProperty)("_latteFlavors");

  if (knownFlavors.startsWith((0,external_kolmafia_.getProperty)("latteModifier") + "|")) {
    return knownFlavors.
    substring(knownFlavors.lastIndexOf("|") + 1).
    split(",");
  }

  var getEnum = function getEnum(flavor) {
    flavor = flavor.toLowerCase();

    if (latteAliases.has(flavor)) {
      flavor = latteAliases.get(flavor);
    }

    for (var _i = 0, _Object$values = Object.values(LatteFlavor); _i < _Object$values.length; _i++) {var v = _Object$values[_i];
      if (flavor != v) {
        continue;
      }

      return v;
    }

    return LatteFlavor.UNKNOWN;
  };

  var flavors = getFlavors();

  for (var i = 0; i < flavors.length; i++) {
    var flav = getEnum(flavors[i]);

    if (flav == LatteFlavor.UNKNOWN) {




      /* print(
        "Unknown Latte Flavor " + flavors[i] + "! Cautiously continuing..",
        "gray"
      );*/}flavors[i] = flav;}

  (0,external_kolmafia_.setProperty)(
  "_latteFlavors",
  (0,external_kolmafia_.getProperty)("latteModifier") + "|" + flavors.join(","));


  return flavors;
}

function hasUnlockedLatteFlavor(drink) {
  return (0,external_kolmafia_.getProperty)("latteUnlocks").split(",").includes(drink);
}
;// CONCATENATED MODULE: ./src/tasks/TaskMaintainStatus.ts
function TaskMaintainStatus_typeof(obj) {"@babel/helpers - typeof";return TaskMaintainStatus_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, TaskMaintainStatus_typeof(obj);}function TaskMaintainStatus_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = TaskMaintainStatus_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function TaskMaintainStatus_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return TaskMaintainStatus_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return TaskMaintainStatus_arrayLikeToArray(o, minLen);}function TaskMaintainStatus_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function TaskMaintainStatus_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function TaskMaintainStatus_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, TaskMaintainStatus_toPropertyKey(descriptor.key), descriptor);}}function TaskMaintainStatus_createClass(Constructor, protoProps, staticProps) {if (protoProps) TaskMaintainStatus_defineProperties(Constructor.prototype, protoProps);if (staticProps) TaskMaintainStatus_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function TaskMaintainStatus_defineProperty(obj, key, value) {key = TaskMaintainStatus_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function TaskMaintainStatus_toPropertyKey(arg) {var key = TaskMaintainStatus_toPrimitive(arg, "string");return TaskMaintainStatus_typeof(key) === "symbol" ? key : String(key);}function TaskMaintainStatus_toPrimitive(input, hint) {if (TaskMaintainStatus_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (TaskMaintainStatus_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}











var TaskMaintainStatus = /*#__PURE__*/function () {






































































  function TaskMaintainStatus() {TaskMaintainStatus_classCallCheck(this, TaskMaintainStatus);TaskMaintainStatus_defineProperty(this, "restorers", []);TaskMaintainStatus_defineProperty(this, "toRemove", ["Really Quite Poisoned", "Majorly Poisoned", "Somewhat Poisoned", "A Little Bit Poisoned", "Hardly Poisoned at All", "Temporary Amnesia"].map(function (s) {return external_kolmafia_.Effect.get(s);}));TaskMaintainStatus_defineProperty(this, "antidote", external_kolmafia_.Item.get("anti-anti-antidote"));
    this.fillRestorers();
  }TaskMaintainStatus_createClass(TaskMaintainStatus, [{ key: "fillRestorers", value: function fillRestorers() {this.restorers.push({ item: external_kolmafia_.Item.get("Psychokinetic energy blob"), mpRestored: 25, hpRestored: 0, available: function available() {return (0,external_kolmafia_.itemAmount)(external_kolmafia_.Item.get("Psychokinetic energy blob")) > 0;}, price: 0 });this.restorers.push({ item: external_kolmafia_.Item.get("Knob Goblin seltzer"), mpRestored: 11, hpRestored: 0, available: function available() {return (0,external_kolmafia_.dispensaryAvailable)() || (0,external_kolmafia_.itemAmount)(external_kolmafia_.Item.get("Knob Goblin seltzer")) > 0;}, price: 80 });this.restorers.push({ item: external_kolmafia_.Item.get("Black cherry soda"), mpRestored: 11, hpRestored: 0, available: function available() {return (0,external_kolmafia_.blackMarketAvailable)() || (0,external_kolmafia_.itemAmount)(external_kolmafia_.Item.get("Black cherry soda")) > 0;}, price: 80 });this.restorers.push({ item: external_kolmafia_.Item.get("Doc Galaktik's Invigorating Tonic"), mpRestored: 11, hpRestored: 0, available: function available() {return true;}, price: 90 }); // HP
      this.restorers.push({ item: external_kolmafia_.Item.get("Cast"), mpRestored: 0, hpRestored: 30, available: function available() {return (0,external_kolmafia_.itemAmount)(external_kolmafia_.Item.get("Cast")) > 0;}, price: 0 });this.restorers.push({ item: external_kolmafia_.Item.get("Doc Galaktik's Homeopathic Elixir"), mpRestored: 0, hpRestored: 19, available: function available() {return true;}, price: 120 });this.restorers.push({ item: external_kolmafia_.Item.get("Doc Galaktik's Pungent Unguent"), mpRestored: 0, hpRestored: 4, available: function available() {return true;}, price: 0 });} }, { key: "restoreHPTo", value:
    function restoreHPTo(hp) {
      var desiredHp = Math.min(hp, (0,external_kolmafia_.myMaxhp)());

      while ((0,external_kolmafia_.myMeat)() > 100 && (0,external_kolmafia_.myHp)() < desiredHp) {
        var restorer = this.restorers.find(
        function (r) {return (0,external_kolmafia_.itemAmount)(r.item) > 0 && r.hpRestored > 0;});


        if (restorer == null) {
          restorer = this.restorers.find(
          function (r) {return r.available() && r.hpRestored > 0;});

        }

        if (restorer == null) {
          return false;
        }

        var toUse = Math.ceil((desiredHp - (0,external_kolmafia_.myHp)()) / restorer.hpRestored);

        if ((0,external_kolmafia_.itemAmount)(restorer.item) > 0) {
          toUse = Math.min(toUse, (0,external_kolmafia_.itemAmount)(restorer.item));
        } else {
          toUse = Math.min(Math.floor((0,external_kolmafia_.myMeat)() / restorer.price), toUse + 4);

          (0,external_kolmafia_.cliExecute)("acquire " + toUse + " " + restorer.item);
        }

        toUse = Math.min(
        (0,external_kolmafia_.itemAmount)(restorer.item),
        Math.ceil((desiredHp - (0,external_kolmafia_.myHp)()) / restorer.hpRestored));


        (0,external_kolmafia_.cliExecute)("use " + toUse + " " + restorer.item);
        return true;
      }

      return (0,external_kolmafia_.myHp)() >= hp;
    } }, { key: "restoreMPTo", value:

    function restoreMPTo(mp) {
      if ((0,external_kolmafia_.myMp)() >= mp) {
        return true;
      }

      var ronStatus = getQuestStatus("questL11Ron");

      var desiredMp = Math.min(mp, (0,external_kolmafia_.myMaxmp)());

      if (
      (ronStatus < 0 || ronStatus > 1 || getQuestStatus("questL11Shen") <= 6) &&
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("sweat")) >= (
      (0,external_kolmafia_.myMp)() + 10 >= desiredMp && (0,external_kolmafia_.myMaxmp)() - (0,external_kolmafia_.myMp)() < 50 ? 95 : 80))
      {
        (0,external_kolmafia_.useSkill)(external_kolmafia_.Skill.get("Sip Some Sweat"));
      }

      while ((0,external_kolmafia_.myMeat)() > 100 && (0,external_kolmafia_.myMp)() < desiredMp) {
        var restorer = this.restorers.find(
        function (r) {return (0,external_kolmafia_.itemAmount)(r.item) > 0 && r.mpRestored > 0;});


        if (restorer == null) {
          restorer = this.restorers.find(
          function (r) {return r.available() && r.mpRestored > 0;});

        }

        if (restorer == null) {
          return false;
        }

        var toUse = Math.ceil((desiredMp - (0,external_kolmafia_.myMp)()) / restorer.mpRestored);

        if ((0,external_kolmafia_.itemAmount)(restorer.item) > 0) {
          toUse = Math.min(toUse, (0,external_kolmafia_.itemAmount)(restorer.item));
        } else {
          toUse = Math.min(Math.floor((0,external_kolmafia_.myMeat)() / restorer.price), toUse);

          (0,external_kolmafia_.cliExecute)("acquire " + toUse + " " + restorer.item);
        }

        (0,external_kolmafia_.cliExecute)("use " + toUse + " " + restorer.item);
      }

      return (0,external_kolmafia_.myMp)() >= mp;
    } }, { key: "run", value:

    function run() {var _iterator = TaskMaintainStatus_createForOfIteratorHelper(
        this.toRemove),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var effect = _step.value;
          if ((0,external_kolmafia_.haveEffect)(effect) == 0) {
            continue;
          }

          (0,external_kolmafia_.cliExecute)("shrug " + effect.name);

          if ((0,external_kolmafia_.haveEffect)(effect) > 0) {
            throw "Tried to remove " + effect.name + " but failed!";
          }
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

      if ((0,external_kolmafia_.itemAmount)(this.antidote) == 0 && (0,external_kolmafia_.myMeat)() > 1000) {
        (0,external_kolmafia_.buy)(this.antidote);
      }

      if ((0,external_kolmafia_.myMaxmp)() < 20) {
        return;
      }

      var desiredMp = 20; //myMaxmp() < 40 ? 20 : 40;

      this.restoreMPTo(desiredMp);
    } }]);return TaskMaintainStatus;}();


var maintainStatus = new TaskMaintainStatus();

function restoreMPTo(mp) {
  // If we can't hit that MP
  if (mp > (0,external_kolmafia_.myMaxmp)()) {
    return false;
  }

  // If we already have that amount
  if (mp <= (0,external_kolmafia_.myMp)()) {
    return true;
  }

  // If we don't have 100 meat per 10 mp
  if (Math.ceil(((0,external_kolmafia_.myMp)() - mp) / 10) * 100 > (0,external_kolmafia_.myMeat)()) {
    return false;
  }

  return maintainStatus.restoreMPTo(mp);
}

function restoreHPTo(hp) {
  // If we can't hit that MP
  if (hp > (0,external_kolmafia_.myMaxhp)()) {
    return false;
  }

  // If we already have that amount
  if (hp <= (0,external_kolmafia_.myHp)()) {
    return true;
  }

  // If we don't have 100 meat per 10 mp
  if (Math.ceil(((0,external_kolmafia_.myHp)() - hp) / 10) * 100 > (0,external_kolmafia_.myMeat)()) {
    return false;
  }

  return maintainStatus.restoreHPTo(hp);
}
;// CONCATENATED MODULE: ./src/utils/MacroBuilder.ts
function MacroBuilder_typeof(obj) {"@babel/helpers - typeof";return MacroBuilder_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, MacroBuilder_typeof(obj);}function _get() {if (typeof Reflect !== "undefined" && Reflect.get) {_get = Reflect.get.bind();} else {_get = function _get(target, property, receiver) {var base = _superPropBase(target, property);if (!base) return;var desc = Object.getOwnPropertyDescriptor(base, property);if (desc.get) {return desc.get.call(arguments.length < 3 ? target : receiver);}return desc.value;};}return _get.apply(this, arguments);}function _superPropBase(object, property) {while (!Object.prototype.hasOwnProperty.call(object, property)) {object = MacroBuilder_getPrototypeOf(object);if (object === null) break;}return object;}function MacroBuilder_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = MacroBuilder_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function MacroBuilder_toConsumableArray(arr) {return MacroBuilder_arrayWithoutHoles(arr) || MacroBuilder_iterableToArray(arr) || MacroBuilder_unsupportedIterableToArray(arr) || MacroBuilder_nonIterableSpread();}function MacroBuilder_nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function MacroBuilder_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return MacroBuilder_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return MacroBuilder_arrayLikeToArray(o, minLen);}function MacroBuilder_iterableToArray(iter) {if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);}function MacroBuilder_arrayWithoutHoles(arr) {if (Array.isArray(arr)) return MacroBuilder_arrayLikeToArray(arr);}function MacroBuilder_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function MacroBuilder_defineProperty(obj, key, value) {key = MacroBuilder_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function MacroBuilder_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, MacroBuilder_toPropertyKey(descriptor.key), descriptor);}}function MacroBuilder_createClass(Constructor, protoProps, staticProps) {if (protoProps) MacroBuilder_defineProperties(Constructor.prototype, protoProps);if (staticProps) MacroBuilder_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function MacroBuilder_toPropertyKey(arg) {var key = MacroBuilder_toPrimitive(arg, "string");return MacroBuilder_typeof(key) === "symbol" ? key : String(key);}function MacroBuilder_toPrimitive(input, hint) {if (MacroBuilder_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (MacroBuilder_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}function MacroBuilder_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function MacroBuilder_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) MacroBuilder_setPrototypeOf(subClass, superClass);}function MacroBuilder_createSuper(Derived) {var hasNativeReflectConstruct = MacroBuilder_isNativeReflectConstruct();return function _createSuperInternal() {var Super = MacroBuilder_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = MacroBuilder_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return MacroBuilder_possibleConstructorReturn(this, result);};}function MacroBuilder_possibleConstructorReturn(self, call) {if (call && (MacroBuilder_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return MacroBuilder_assertThisInitialized(self);}function MacroBuilder_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _wrapNativeSuper(Class) {var _cache = typeof Map === "function" ? new Map() : undefined;_wrapNativeSuper = function _wrapNativeSuper(Class) {if (Class === null || !_isNativeFunction(Class)) return Class;if (typeof Class !== "function") {throw new TypeError("Super expression must either be null or a function");}if (typeof _cache !== "undefined") {if (_cache.has(Class)) return _cache.get(Class);_cache.set(Class, Wrapper);}function Wrapper() {return _construct(Class, arguments, MacroBuilder_getPrototypeOf(this).constructor);}Wrapper.prototype = Object.create(Class.prototype, { constructor: { value: Wrapper, enumerable: false, writable: true, configurable: true } });return MacroBuilder_setPrototypeOf(Wrapper, Class);};return _wrapNativeSuper(Class);}function _construct(Parent, args, Class) {if (MacroBuilder_isNativeReflectConstruct()) {_construct = Reflect.construct.bind();} else {_construct = function _construct(Parent, args, Class) {var a = [null];a.push.apply(a, args);var Constructor = Function.bind.apply(Parent, a);var instance = new Constructor();if (Class) MacroBuilder_setPrototypeOf(instance, Class.prototype);return instance;};}return _construct.apply(null, arguments);}function MacroBuilder_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function _isNativeFunction(fn) {return Function.toString.call(fn).indexOf("[native code]") !== -1;}function MacroBuilder_setPrototypeOf(o, p) {MacroBuilder_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return MacroBuilder_setPrototypeOf(o, p);}function MacroBuilder_getPrototypeOf(o) {MacroBuilder_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return MacroBuilder_getPrototypeOf(o);}

var MACRO_NAME = "Script Autoattack Macro";
/**
 * Get the KoL native ID of the macro with name name.
 *
 * @category Combat
 * @returns {number} The macro ID.
 */
function getMacroId() {var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : MACRO_NAME;
  var macroMatches = (0,external_kolmafia_.xpath)(
  (0,external_kolmafia_.visitUrl)("account_combatmacros.php"), "//select[@name=\"macroid\"]/option[text()=\"".concat(
  name, "\"]/@value"));

  if (macroMatches.length === 0) {
    (0,external_kolmafia_.visitUrl)("account_combatmacros.php?action=new");
    var newMacroText = (0,external_kolmafia_.visitUrl)("account_combatmacros.php?macroid=0&name=".concat(
    name, "&macrotext=abort&action=save"));

    return parseInt(
    (0,external_kolmafia_.xpath)(newMacroText, "//input[@name=macroid]/@value")[0],
    10);

  } else {
    return parseInt(macroMatches[0], 10);
  }
}


function itemOrNameToItem(itemOrName) {
  return typeof itemOrName === "string" ? external_kolmafia_.Item.get(itemOrName) : itemOrName;
}

var substringCombatItems =
"spider web, really sticky spider web, dictionary, NG, Cloaca-Cola, yo-yo, top, ball, kite, yo, red potion, blue potion, adder, red button, pile of sand, mushroom, deluxe mushroom".
split(",").
map(function (s) {return (0,external_kolmafia_.toItem)(s);});
var substringCombatSkills =
"Shoot, Thrust-Smack, Headbutt, Toss, Sing, Disarm, LIGHT, BURN, Extract, Meteor Shower, Cleave, Boil, Slice, Rainbow".
split(",").
map(function (s) {return (0,external_kolmafia_.toSkill)(s);});

function itemOrItemsBallsMacroName(
itemOrItems)
{
  if (Array.isArray(itemOrItems)) {
    return itemOrItems.map(itemOrItemsBallsMacroName).join(", ");
  } else {
    var item = itemOrNameToItem(itemOrItems);
    return !substringCombatItems.includes(item) ?
    item.name :
    (0,external_kolmafia_.toInt)(item).toString();
  }
}

function itemOrItemsBallsMacroPredicate(
itemOrItems)
{
  if (Array.isArray(itemOrItems)) {
    return itemOrItems.map(itemOrItemsBallsMacroPredicate).join(" && ");
  } else {
    return "hascombatitem ".concat(itemOrItems);
  }
}


function skillOrNameToSkill(skillOrName) {
  if (typeof skillOrName === "string") {
    return external_kolmafia_.Skill.get(skillOrName);
  } else {
    return skillOrName;
  }
}

function skillBallsMacroName(skillOrName) {
  var skill = skillOrNameToSkill(skillOrName);
  return skill.name.match(/^[A-Za-z ]+$/) &&
  !substringCombatSkills.includes(skill) ?
  skill.name :
  (0,external_kolmafia_.toInt)(skill);
}



var InvalidMacroError = /*#__PURE__*/function (_Error) {MacroBuilder_inherits(InvalidMacroError, _Error);var _super = MacroBuilder_createSuper(InvalidMacroError);function InvalidMacroError() {MacroBuilder_classCallCheck(this, InvalidMacroError);return _super.apply(this, arguments);}return MacroBuilder_createClass(InvalidMacroError);}( /*#__PURE__*/_wrapNativeSuper(Error));

/**
 * BALLS macro builder for direct submission to KoL.
 * Create a new macro with `new Macro()` and add steps using the instance methods.
 * Uses a fluent interface, so each step returns the object for easy chaining of steps.
 * Each method is also defined as a static method that creates a new Macro with only that step.
 * For example, you can do `Macro.skill('Saucestorm').attack()`.
 */
var Macro = /*#__PURE__*/function () {function Macro() {MacroBuilder_classCallCheck(this, Macro);MacroBuilder_defineProperty(this, "components",





    []);MacroBuilder_defineProperty(this, "name",
    MACRO_NAME);}MacroBuilder_createClass(Macro, [{ key: "toString", value:

    /**
     * Convert macro to string.
     */
    function toString() {
      return this.components.join(";");
    }

    /**
     * Gives your macro a new name to be used when saving an autoattack.
     * @param name The name to be used when saving as an autoattack.
     * @returns The previous name assigned to this macro.
     */ }, { key: "rename", value:
    function rename(name) {
      var returnValue = this.name;
      this.name = name;
      return returnValue;
    }

    /**
     * Save a macro to a Mafia property for use in a consult script.
     */ }, { key: "save", value:
    function save() {
      (0,external_kolmafia_.setProperty)(Macro.SAVED_MACRO_PROPERTY, this.toString());
    }

    /**
     * Load a saved macro from the Mafia property.
     */ }, { key: "step", value:













    /**
     * Statefully add one or several steps to a macro.
     * @param nextSteps The steps to add to the macro.
     * @returns {Macro} This object itself.
     */
    function step() {var _ref;for (var _len = arguments.length, nextSteps = new Array(_len), _key = 0; _key < _len; _key++) {nextSteps[_key] = arguments[_key];}
      var nextStepsStrings = (_ref = []).concat.apply(_ref, MacroBuilder_toConsumableArray(
      nextSteps.map(function (x) {return x instanceof Macro ? x.components : [x];})));

      this.components = [].concat(MacroBuilder_toConsumableArray(
      this.components), MacroBuilder_toConsumableArray(
      nextStepsStrings.filter(function (s) {return s.length > 0;})));

      return this;
    }

    /**
     * Statefully add one or several steps to a macro.
     * @param nextSteps The steps to add to the macro.
     * @returns {Macro} This object itself.
     */ }, { key: "submit", value:







    /**
     * Submit the built macro to KoL. Only works inside combat.
     */
    function submit() {
      var _final = this.toString();
      return (0,external_kolmafia_.visitUrl)("fight.php?action=macro&macrotext=".concat(
      (0,external_kolmafia_.urlEncode)(_final)),
      true,
      true);

    }

    /**
     * Set this macro as a KoL native autoattack.
     */ }, { key: "setAutoAttack", value:
    function setAutoAttack() {
      var id = Macro.cachedMacroIds.get(this.name);
      if (id === undefined) {
        id = getMacroId(this.name);
        Macro.cachedMacroIds.set(this.name, id);
      }
      if (
      (0,external_kolmafia_.getAutoAttack)() === 99000000 + id &&
      this.toString() === Macro.cachedAutoAttacks.get(this.name))
      {
        // This macro is already set. Don"t make the server request.
        return;
      }

      (0,external_kolmafia_.visitUrl)("account_combatmacros.php?macroid=".concat(
      id, "&name=").concat((0,external_kolmafia_.urlEncode)(
      this.name), "&macrotext=").concat(
      (0,external_kolmafia_.urlEncode)(this.toString()), "&action=save"),
      true,
      true);

      (0,external_kolmafia_.visitUrl)("account.php?am=1&action=autoattack&value=".concat(
      99000000 + id, "&ajax=1"));

      Macro.cachedAutoAttacks.set(this.name, this.toString());
    }

    /**
     * Renames the macro, then sets it as an autoattack.
     * @param name The name to save the macro under as an autoattack.
     */ }, { key: "setAutoAttackAs", value:
    function setAutoAttackAs(name) {
      this.name = name;
      this.setAutoAttack();
    }

    /**
     * Clear all cached autoattacks, and delete all stored macros server-side.
     */ }, { key: "abort", value:










    /**
     * Add an "abort" step to this macro.
     * @returns {Macro} This object itself.
     */
    function abort() {
      return this.step("abort");
    }

    /**
     * Create a new macro with an "abort" step.
     * @returns {Macro} This object itself.
     */ }, { key: "runaway", value:




    /**
     * Add a "runaway" step to this macro.
     * @returns {Macro} This object itself.
     */
    function runaway() {
      return this.step("runaway");
    }

    /**
     * Create a new macro with an "runaway" step.
     * @returns {Macro} This object itself.
     */ }, { key: "if_", value:




    /**
     * Add an "if" statement to this macro.
     * @param condition The BALLS condition for the if statement.
     * @param ifTrue Continuation if the condition is true.
     * @returns {Macro} This object itself.
     */
    function if_(
    condition,








    ifTrue)
    {
      return this.step("if ".concat(this.createBalls(condition))).
      step(ifTrue).
      step("endif");
    }
    /**
     * Add an "if not" statement to this macro.
     * @param condition The BALLS condition for the if statement.
     * @param ifFalse Continuation if the condition is true.
     * @returns {Macro} This object itself.
     */ }, { key: "ifNot_", value:
    function ifNot_(
    condition,








    ifFalse)
    {
      return this.step("if !".concat(this.createBalls(condition))).
      step(ifFalse).
      step("endif");
    } }, { key: "createBalls", value:

    function createBalls(
    condition)








    {
      var ballsCondition = "";
      if (condition instanceof external_kolmafia_.Monster) {
        ballsCondition = "monsterid ".concat(condition.id);
      } else if (condition instanceof external_kolmafia_.Effect) {
        ballsCondition = "haseffect ".concat((0,external_kolmafia_.toInt)(condition));
      } else if (condition instanceof external_kolmafia_.Skill) {
        ballsCondition = "hasskill ".concat(skillBallsMacroName(condition));
      } else if (condition instanceof external_kolmafia_.Item) {
        if (!condition.combat) {
          throw new InvalidMacroError("Item ".concat(
          condition, " cannot be made a valid BALLS predicate (it is not combat-usable)"));

        }

        ballsCondition = "hascombatitem ".concat(itemOrItemsBallsMacroName(condition));
      } else if (condition instanceof external_kolmafia_.Location) {
        var snarfblat = condition.id;

        if (snarfblat < 1) {
          throw new InvalidMacroError("Location ".concat(
          condition, " cannot be made a valid BALLS predicate (it has no location id)"));

        }

        ballsCondition = "snarfblat ".concat(snarfblat);
      } else if (condition instanceof external_kolmafia_.Class) {
        if ((0,external_kolmafia_.toInt)(condition) > 6) {
          throw new InvalidMacroError("Class ".concat(
          condition, " cannot be made a valid BALLS predicate (it is not a standard class)"));

        }

        ballsCondition = condition.toString().replaceAll(" ", "").toLowerCase();
      } else if (condition instanceof external_kolmafia_.Stat) {
        ballsCondition = "".concat(condition.toString().toLowerCase(), "class");
      } else {
        ballsCondition = condition;
      }

      return ballsCondition;
    }

    /**
     * Create a new macro with an "if" statement.
     * @param condition The BALLS condition for the if statement.
     * @param ifTrue Continuation if the condition is true.
     * @returns {Macro} This object itself.
     */ }, { key: "while_", value:






















    /**
     * Add a "while" statement to this macro.
     * @param condition The BALLS condition for the if statement.
     * @param contents Loop to repeat while the condition is true.
     * @returns {Macro} This object itself.
     */
    function while_(condition, contents) {
      return this.step("while ".concat(condition)).step(contents).step("endwhile");
    }

    /**
     * Create a new macro with a "while" statement.
     * @param condition The BALLS condition for the if statement.
     * @param contents Loop to repeat while the condition is true.
     * @returns {Macro} This object itself.
     */ }, { key: "externalIf", value:








    /**
     * Conditionally add a step to a macro based on a condition evaluated at the time of building the macro.
     * @param condition The JS condition.
     * @param ifTrue Continuation to add if the condition is true.
     * @param ifFalse Optional input to turn this into an if...else statement.
     * @returns {Macro} This object itself.
     */
    function externalIf(
    condition,
    ifTrue,
    ifFalse)
    {
      if (condition) {return this.step(ifTrue);} else
      if (ifFalse) {return this.step(ifFalse);} else
      {return this;}
    }

    /**
     * Create a new macro with a condition evaluated at the time of building the macro.
     * @param condition The JS condition.
     * @param ifTrue Continuation to add if the condition is true.
     * @param ifFalse Optional input to turn this into an if...else statement.
     * @returns {Macro} This object itself.
     */ }, { key: "repeat", value:









    /**
     * Add a repeat step to the macro.
     * @returns {Macro} This object itself.
     */
    function repeat() {
      return this.step("repeat");
    }

    /**
     * Add one or more skill cast steps to the macro.
     * @param skills Skills to cast.
     * @returns {Macro} This object itself.
     */ }, { key: "skill", value:
    function skill() {for (var _len2 = arguments.length, skills = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {skills[_key2] = arguments[_key2];}
      return this.step.apply(this, MacroBuilder_toConsumableArray(
      skills.map(function (skill) {
        return "skill ".concat(skillBallsMacroName(skill));
      })));

    }

    /**
     * Create a new macro with one or more skill cast steps.
     * @param skills Skills to cast.
     * @returns {Macro} This object itself.
     */ }, { key: "trySkill", value:







    /**
     * Add one or more skill cast steps to the macro, where each step checks if you have the skill first.
     * @param skills Skills to try casting.
     * @returns {Macro} This object itself.
     */
    function trySkill() {for (var _len3 = arguments.length, skills = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {skills[_key3] = arguments[_key3];}
      return this.step.apply(this, MacroBuilder_toConsumableArray(
      skills.map(function (skill) {
        return Macro.if_("hasskill ".concat(
        skillBallsMacroName(skill)),
        Macro.skill(skill));

      })));

    }

    /**
     * Create a new macro with one or more skill cast steps, where each step checks if you have the skill first.
     * @param skills Skills to try casting.
     * @returns {Macro} This object itself.
     */ }, { key: "trySkillRepeat", value:







    /**
     * Add one or more skill-cast-and-repeat steps to the macro, where each step checks if you have the skill first.
     * @param skills Skills to try repeatedly casting.
     * @returns {Macro} This object itself.
     */
    function trySkillRepeat() {for (var _len4 = arguments.length, skills = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {skills[_key4] = arguments[_key4];}
      return this.step.apply(this, MacroBuilder_toConsumableArray(
      skills.map(function (skill) {
        return Macro.if_("hasskill ".concat(
        skillBallsMacroName(skill)),
        Macro.skill(skill).repeat());

      })));

    }

    /**
     * Create a new macro with one or more skill-cast-and-repeat steps, where each step checks if you have the skill first.
     * @param skills Skills to try repeatedly casting.
     * @returns {Macro} This object itself.
     */ }, { key: "item", value:







    /**
     * Add one or more item steps to the macro.
     * @param items Items to use. Pass a tuple [item1, item2] to funksling.
     * @returns {Macro} This object itself.
     */
    function item() {for (var _len5 = arguments.length, items = new Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {items[_key5] = arguments[_key5];}
      return this.step.apply(this, MacroBuilder_toConsumableArray(
      items.map(function (itemOrItems) {
        return "use ".concat(itemOrItemsBallsMacroName(itemOrItems));
      })));

    }

    /**
     * Create a new macro with one or more item steps.
     * @param items Items to use. Pass a tuple [item1, item2] to funksling.
     * @returns {Macro} This object itself.
     */ }, { key: "tryItem", value:







    /**
     * Add one or more item steps to the macro, where each step checks to see if you have the item first.
     * @param items Items to try using. Pass a tuple [item1, item2] to funksling.
     * @returns {Macro} This object itself.
     */
    function tryItem() {for (var _len6 = arguments.length, items = new Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {items[_key6] = arguments[_key6];}
      return this.step.apply(this, MacroBuilder_toConsumableArray(
      items.map(function (item) {
        return Macro.if_(
        itemOrItemsBallsMacroPredicate(item), "use ".concat(
        itemOrItemsBallsMacroName(item)));

      })));

    }

    /**
     * Create a new macro with one or more item steps, where each step checks to see if you have the item first.
     * @param items Items to try using. Pass a tuple [item1, item2] to funksling.
     * @returns {Macro} This object itself.
     */ }, { key: "attack", value:







    /**
     * Add an attack step to the macro.
     * @returns {Macro} This object itself.
     */
    function attack() {
      return this.step("attack");
    }

    /**
     * Create a new macro with an attack step.
     * @returns {Macro} This object itself.
     */ }, { key: "ifHolidayWanderer", value:




    /**
     * Create an if_ statement based on what holiday of loathing it currently is. On non-holidays, returns the original macro, unmutated.
     * @param macro The macro to place in the if_ statement
     */
    function ifHolidayWanderer(macro) {
      // const todaysWanderers = getTodaysHolidayWanderers();
      // if (todaysWanderers.length === 0) return this;
      // return this.if_(
      //   todaysWanderers.map((monster) => `monsterid ${monster.id}`).join(" || "),
      //   macro
      // );
      return this;
    }
    /**
     * Create a new macro starting with an ifHolidayWanderer step.
     * @param macro The macro to place inside the if_ statement
     */ }, { key: "ifNotHolidayWanderer", value:







    /**
     * Create an if_ statement based on what holiday of loathing it currently is. On non-holidays, returns the original macro, with the input macro appended.
     * @param macro The macro to place in the if_ statement.
     */
    function ifNotHolidayWanderer(macro) {
      /*const todaysWanderers = getTodaysHolidayWanderers();
      if (todaysWanderers.length === 0) return this.step(macro);
      return this.if_(
        todaysWanderers.map((monster) => `!monsterid ${monster.id}`).join(" && "),
        macro
      );*/
      return this;
    }
    /**
     * Create a new macro starting with an ifNotHolidayWanderer step.
     * @param macro The macro to place inside the if_ statement
     */ }], [{ key: "load", value: function load() {var _this;return (_this = new this()).step.apply(_this, MacroBuilder_toConsumableArray((0,external_kolmafia_.getProperty)(Macro.SAVED_MACRO_PROPERTY).split(";")));} /**
     * Clear the saved macro in the Mafia property.
     */ }, { key: "clearSaved", value: function clearSaved() {(0,external_kolmafia_.removeProperty)(Macro.SAVED_MACRO_PROPERTY);} }, { key: "step", value: function step() {var _this2;return (_this2 = new this()).step.apply(_this2, arguments);} }, { key: "clearAutoAttackMacros", value: function clearAutoAttackMacros() {var _iterator = MacroBuilder_createForOfIteratorHelper(Macro.cachedAutoAttacks.keys()),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var _Macro$cachedMacroIds;var name = _step.value;var id = (_Macro$cachedMacroIds = Macro.cachedMacroIds.get(name)) !== null && _Macro$cachedMacroIds !== void 0 ? _Macro$cachedMacroIds : getMacroId(name);(0,external_kolmafia_.visitUrl)("account_combatmacros.php?macroid=".concat(id, "&action=edit&what=Delete&confirm=1"));Macro.cachedAutoAttacks["delete"](name);}} catch (err) {_iterator.e(err);} finally {_iterator.f();}} }, { key: "abort", value: function abort() {return new this().abort();} }, { key: "runaway", value: function runaway() {return new this().runaway();} }, { key: "if_", value: function if_(condition, ifTrue) {return new this().if_(condition, ifTrue);} /**
     * Create a new macro with an "if" statement.
     * @param condition The BALLS condition for the if statement.
     * @param ifTrue Continuation if the condition is true.
     * @returns {Macro} This object itself.
     */ }, { key: "ifNot_", value: function ifNot_(condition, ifTrue) {return new this().ifNot_(condition, ifTrue);} }, { key: "while_", value: function while_(condition, contents) {return new this().while_(condition, contents);} }, { key: "externalIf", value: function externalIf(condition, ifTrue, ifFalse) {return new this().externalIf(condition, ifTrue, ifFalse);} }, { key: "skill", value: function skill() {var _this3;return (_this3 = new this()).skill.apply(_this3, arguments);} }, { key: "trySkill", value: function trySkill() {var _this4;return (_this4 = new this()).trySkill.apply(_this4, arguments);} }, { key: "trySkillRepeat", value: function trySkillRepeat() {var _this5;return (_this5 = new this()).trySkillRepeat.apply(_this5, arguments);} }, { key: "item", value: function item() {var _this6;return (_this6 = new this()).item.apply(_this6, arguments);} }, { key: "tryItem", value: function tryItem() {var _this7;return (_this7 = new this()).tryItem.apply(_this7, arguments);} }, { key: "attack", value: function attack() {return new this().attack();} }, { key: "ifHolidayWanderer", value: function ifHolidayWanderer(macro) {return new this().ifHolidayWanderer(macro);} }, { key: "ifNotHolidayWanderer", value: function ifNotHolidayWanderer(macro) {return new this().ifNotHolidayWanderer(macro);} }]);return Macro;}();

/**
 * Adventure in a location and handle all combats with a given macro.
 * To use this function you will need to create a consult script that runs Macro.load().submit() and a CCS that calls that consult script.
 * See examples/consult.ts for an example.
 *
 * @category Combat
 * @param loc Location to adventure in.
 * @param macro Macro to execute.
 */MacroBuilder_defineProperty(Macro, "SAVED_MACRO_PROPERTY", "libram_savedMacro");MacroBuilder_defineProperty(Macro, "cachedMacroIds", new Map());MacroBuilder_defineProperty(Macro, "cachedAutoAttacks", new Map());
function adventureMacro(loc, macro) {
  macro.save();
  setAutoAttack(0);
  try {
    adv1(loc, 0, "");
    while (inMultiFight()) {runCombat();}
    if (choiceFollowsFight()) {visitUrl("choice.php");}
  } finally {
    Macro.clearSaved();
  }
}

/**
 * Adventure in a location and handle all combats with a given autoattack and manual macro.
 * To use the nextMacro parameter you will need to create a consult script that runs Macro.load().submit() and a CCS that calls that consult script.
 * See examples/consult.ts for an example.
 *
 * @category Combat
 * @param loc Location to adventure in.
 * @param autoMacro Macro to execute via KoL autoattack.
 * @param nextMacro Macro to execute manually after autoattack completes.
 */
function adventureMacroAuto(
loc,
autoMacro)

{var _nextMacro;var nextMacro = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
  nextMacro = (_nextMacro = nextMacro) !== null && _nextMacro !== void 0 ? _nextMacro : Macro.abort();
  autoMacro.setAutoAttack();
  nextMacro.save();
  try {
    adv1(loc, 0, "");
    while (inMultiFight()) {runCombat();}
    if (choiceFollowsFight()) {visitUrl("choice.php");}
  } finally {
    Macro.clearSaved();
  }
}

var StrictMacro = /*#__PURE__*/(/* unused pure expression or super */ null && (function (_Macro) {MacroBuilder_inherits(StrictMacro, _Macro);var _super2 = MacroBuilder_createSuper(StrictMacro);function StrictMacro() {MacroBuilder_classCallCheck(this, StrictMacro);return _super2.apply(this, arguments);}MacroBuilder_createClass(StrictMacro, [{ key: "skill", value:
    /**
     * Add one or more skill cast steps to the macro.
     * @param skills Skills to cast.
     * @returns {StrictMacro} This object itself.
     */
    function skill() {var _get2;for (var _len7 = arguments.length, skills = new Array(_len7), _key7 = 0; _key7 < _len7; _key7++) {skills[_key7] = arguments[_key7];}
      return (_get2 = _get(MacroBuilder_getPrototypeOf(StrictMacro.prototype), "skill", this)).call.apply(_get2, [this].concat(skills));
    }

    /**
     * Create a new macro with one or more skill cast steps.
     * @param skills Skills to cast.
     * @returns {StrictMacro} This object itself.
     */ }, { key: "item", value:







    /**
     * Add one or more item steps to the macro.
     * @param items Items to use. Pass a tuple [item1, item2] to funksling.
     * @returns {StrictMacro} This object itself.
     */
    function item() {var _get3;for (var _len8 = arguments.length, items = new Array(_len8), _key8 = 0; _key8 < _len8; _key8++) {items[_key8] = arguments[_key8];}
      return (_get3 = _get(MacroBuilder_getPrototypeOf(StrictMacro.prototype), "item", this)).call.apply(_get3, [this].concat(items));
    }

    /**
     * Create a new macro with one or more item steps.
     * @param items Items to use. Pass a tuple [item1, item2] to funksling.
     * @returns {StrictMacro} This object itself.
     */ }, { key: "trySkill", value:







    /**
     * Add one or more skill cast steps to the macro, where each step checks if you have the skill first.
     * @param skills Skills to try casting.
     * @returns {StrictMacro} This object itself.
     */
    function trySkill() {var _get4;for (var _len9 = arguments.length, skills = new Array(_len9), _key9 = 0; _key9 < _len9; _key9++) {skills[_key9] = arguments[_key9];}
      return (_get4 = _get(MacroBuilder_getPrototypeOf(StrictMacro.prototype), "trySkill", this)).call.apply(_get4, [this].concat(skills));
    }

    /**
     * Create a new macro with one or more skill cast steps, where each step checks if you have the skill first.
     * @param skills Skills to try casting.
     * @returns {StrictMacro} This object itself.
     */ }, { key: "tryItem", value:







    /**
     * Add one or more item steps to the macro, where each step checks to see if you have the item first.
     * @param items Items to try using. Pass a tuple [item1, item2] to funksling.
     * @returns {StrictMacro} This object itself.
     */
    function tryItem() {var _get5;for (var _len10 = arguments.length, items = new Array(_len10), _key10 = 0; _key10 < _len10; _key10++) {items[_key10] = arguments[_key10];}
      return (_get5 = _get(MacroBuilder_getPrototypeOf(StrictMacro.prototype), "tryItem", this)).call.apply(_get5, [this].concat(items));
    }

    /**
     * Create a new macro with one or more item steps, where each step checks to see if you have the item first.
     * @param items Items to try using. Pass a tuple [item1, item2] to funksling.
     * @returns {StrictMacro} This object itself.
     */ }, { key: "trySkillRepeat", value:







    /**
     * Add one or more skill-cast-and-repeat steps to the macro, where each step checks if you have the skill first.
     * @param skills Skills to try repeatedly casting.
     * @returns {StrictMacro} This object itself.
     */
    function trySkillRepeat() {var _get6;for (var _len11 = arguments.length, skills = new Array(_len11), _key11 = 0; _key11 < _len11; _key11++) {skills[_key11] = arguments[_key11];}
      return (_get6 = _get(MacroBuilder_getPrototypeOf(StrictMacro.prototype), "trySkillRepeat", this)).call.apply(_get6, [this].concat(skills));
    }

    /**
     * Create a new macro with one or more skill-cast-and-repeat steps, where each step checks if you have the skill first.
     * @param skills Skills to try repeatedly casting.
     * @returns {StrictMacro} This object itself.
     */ }], [{ key: "skill", value: function skill() {var _this8;return (_this8 = new this()).skill.apply(_this8, arguments);} }, { key: "item", value: function item() {var _this9;return (_this9 = new this()).item.apply(_this9, arguments);} }, { key: "trySkill", value: function trySkill() {var _this10;return (_this10 = new this()).trySkill.apply(_this10, arguments);} }, { key: "tryItem", value: function tryItem() {var _this11;return (_this11 = new this()).tryItem.apply(_this11, arguments);} }, { key: "trySkillRepeat", value:
    function trySkillRepeat()


    {var _this12;
      return (_this12 = new this()).trySkillRepeat.apply(_this12, arguments);
    } }]);return StrictMacro;}(Macro)));
;// CONCATENATED MODULE: ./src/quests/council/tower/stages/QuestTowerWallSkin.ts
function QuestTowerWallSkin_typeof(obj) {"@babel/helpers - typeof";return QuestTowerWallSkin_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestTowerWallSkin_typeof(obj);}function QuestTowerWallSkin_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestTowerWallSkin_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestTowerWallSkin_toPropertyKey(descriptor.key), descriptor);}}function QuestTowerWallSkin_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestTowerWallSkin_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestTowerWallSkin_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestTowerWallSkin_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestTowerWallSkin_setPrototypeOf(subClass, superClass);}function QuestTowerWallSkin_setPrototypeOf(o, p) {QuestTowerWallSkin_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestTowerWallSkin_setPrototypeOf(o, p);}function QuestTowerWallSkin_createSuper(Derived) {var hasNativeReflectConstruct = QuestTowerWallSkin_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestTowerWallSkin_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestTowerWallSkin_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestTowerWallSkin_possibleConstructorReturn(this, result);};}function QuestTowerWallSkin_possibleConstructorReturn(self, call) {if (call && (QuestTowerWallSkin_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestTowerWallSkin_assertThisInitialized(self);}function QuestTowerWallSkin_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestTowerWallSkin_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestTowerWallSkin_getPrototypeOf(o) {QuestTowerWallSkin_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestTowerWallSkin_getPrototypeOf(o);}function QuestTowerWallSkin_defineProperty(obj, key, value) {key = QuestTowerWallSkin_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestTowerWallSkin_toPropertyKey(arg) {var key = QuestTowerWallSkin_toPrimitive(arg, "string");return QuestTowerWallSkin_typeof(key) === "symbol" ? key : String(key);}function QuestTowerWallSkin_toPrimitive(input, hint) {if (QuestTowerWallSkin_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestTowerWallSkin_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}











var QuestTowerWallSkin = /*#__PURE__*/function (_TaskInfo) {QuestTowerWallSkin_inherits(QuestTowerWallSkin, _TaskInfo);var _super = QuestTowerWallSkin_createSuper(QuestTowerWallSkin);function QuestTowerWallSkin() {var _this;QuestTowerWallSkin_classCallCheck(this, QuestTowerWallSkin);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestTowerWallSkin_defineProperty(QuestTowerWallSkin_assertThisInitialized(_this), "beehive",
    external_kolmafia_.Item.get("Beehive"));QuestTowerWallSkin_defineProperty(QuestTowerWallSkin_assertThisInitialized(_this), "killer",
    new QuestTowerKillSkin());QuestTowerWallSkin_defineProperty(QuestTowerWallSkin_assertThisInitialized(_this), "blackForest",
    external_kolmafia_.Location.get("The Black Forest"));QuestTowerWallSkin_defineProperty(QuestTowerWallSkin_assertThisInitialized(_this), "paths", void 0);return _this;}QuestTowerWallSkin_createClass(QuestTowerWallSkin, [{ key: "createPaths", value:


    function createPaths(assumeUnstarted) {
      this.paths = [
      new PossiblePath(0).addMeat(1000),
      new PossiblePath(0).add(ResourceCategory.HOT_TUB)];

    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "getId", value:

    function getId() {
      return "Council / Tower / WallOfSkin";
    } }, { key: "level", value:

    function level() {
      return 13;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL13Final");

      if (status < 6) {
        return QuestStatus.NOT_READY;
      }

      if (status > 6) {
        return QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      if ((0,external_kolmafia_.availableAmount)(this.beehive) == 0) {
        if (this.killer.isPossible()) {
          return this.killer.run(path);
        } else {
          return this.runBees();
        }
      }

      return {
        location: null,
        run: function run() {
          greyAdv(
          "place.php?whichplace=nstower&action=ns_05_monster1",
          null,
          new AdventureSettings().setStartOfFightMacro(
          Macro.tryItem(_this2.beehive)));


        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "runBees", value:

    function runBees() {var _this3 = this;
      var outfit = new GreyOutfit().setNoCombat();
      outfit.addDelayer(DelayCriteria().withFreeFights(null));

      return {
        outfit: outfit,
        location: this.blackForest,
        run: function run() {
          var props = new Properties_PropertyManager();

          if (DelayBurners.isTryingForDupeableGoblin()) {
            (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Grey Goose"));
          }

          try {
            props.setChoice(924, 3); // Beezzzz
            props.setChoice(1018, 1);
            props.setChoice(1019, 1);

            greyAdv(_this3.blackForest, outfit);
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestTowerWallSkin;}(TaskInfo);


var QuestTowerKillSkin = /*#__PURE__*/function () {function QuestTowerKillSkin() {QuestTowerWallSkin_classCallCheck(this, QuestTowerKillSkin);QuestTowerWallSkin_defineProperty(this, "familiar",
    external_kolmafia_.Familiar.get("Shorter-Order Cook"));QuestTowerWallSkin_defineProperty(this, "hotPlate",
    external_kolmafia_.Item.get("Hot Plate"));QuestTowerWallSkin_defineProperty(this, "maximizeString",

    "hot dmg 1 max +stench dmg 1 max +cold dmg 1 max +sleaze dmg 1 max +spooky dmg 1 max -tie");QuestTowerWallSkin_defineProperty(this, "familiarEquips",
    [
    "Muscle band",
    "Ant Hoe",
    "Ant Pick",
    "Ant Pitchfork",
    "Ant Rake",
    "Ant Sickle",
    "Tiny bowler"].
    map(function (s) {return external_kolmafia_.Item.get(s);}));QuestTowerWallSkin_defineProperty(this, "lastPossible",
    0);QuestTowerWallSkin_defineProperty(this, "possible", void 0);}QuestTowerWallSkin_createClass(QuestTowerKillSkin, [{ key: "isPossible", value:


    function isPossible() {
      if (!(0,external_kolmafia_.haveFamiliar)(this.familiar)) {
        return false;
      }

      if (getQuestStatus("questL13Final") < 6) {
        return true;
      }

      if (this.lastPossible == (0,external_kolmafia_.turnsPlayed)()) {
        return this.possible;
      }

      this.lastPossible = (0,external_kolmafia_.turnsPlayed)();

      // Short cook and physical damage
      var damagePerRound = 7;

      if ((0,external_kolmafia_.availableAmount)(this.hotPlate) > 0) {
        damagePerRound += 1;
      }

      if (
      this.familiarEquips.find(function (equip) {return (0,external_kolmafia_.availableAmount)(equip) > 0;}) != null)
      {
        damagePerRound++;
      }

      (0,external_kolmafia_.maximize)(this.maximizeString + " -offhand -familiar", true);

      for (var _i = 0, _arr = ["Cold", "Hot", "Sleaze", "Spooky", "Stench"]; _i < _arr.length; _i++) {var ele = _arr[_i];
        var mod = (0,external_kolmafia_.numericModifier)("Generated:_spec", ele + " Damage");

        if (mod > 0) {
          damagePerRound += 1;
        }
      }

      return this.possible = damagePerRound >= 13;
    } }, { key: "run", value:

    function run(path) {var _this4 = this;
      var str = this.maximizeString;

      var fam = this.familiarEquips.find(function (i) {return (0,external_kolmafia_.availableAmount)(i) > 0;});

      if (fam != null) {
        str += " +equip " + fam;
      }

      if ((0,external_kolmafia_.availableAmount)(this.hotPlate) > 0) {
        str += " +equip " + this.hotPlate;
      }

      var outfit = new GreyOutfit(str);

      return {
        location: null,
        familiar: this.familiar,
        disableFamOverride: true,
        outfit: outfit,
        run: function run() {
          if ((0,external_kolmafia_.myFamiliar)() != _this4.familiar) {
            throw "Expected to be using cook!";
          }

          if ((0,external_kolmafia_.myHp)() < (0,external_kolmafia_.myMaxhp)()) {
            if (path.canUse(ResourceCategory.HOT_TUB)) {
              (0,external_kolmafia_.cliExecute)("hottub");
              path.addUsed(ResourceCategory.HOT_TUB);
            } else {
              restoreHPTo((0,external_kolmafia_.myMaxhp)());
            }
          }

          if ((0,external_kolmafia_.myHp)() < (0,external_kolmafia_.myMaxhp)()) {
            throw "Not healthy enough!";
          }

          greyAdv(
          "place.php?whichplace=nstower&action=ns_05_monster1",
          outfit,
          new AdventureSettings().setStartOfFightMacro(
          Macro.skill("Grey Noise").repeat()));


        }
      };
    } }]);return QuestTowerKillSkin;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/QuestL11Black.ts
function QuestL11Black_typeof(obj) {"@babel/helpers - typeof";return QuestL11Black_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11Black_typeof(obj);}function QuestL11Black_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestL11Black_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestL11Black_slicedToArray(arr, i) {return QuestL11Black_arrayWithHoles(arr) || QuestL11Black_iterableToArrayLimit(arr, i) || QuestL11Black_unsupportedIterableToArray(arr, i) || QuestL11Black_nonIterableRest();}function QuestL11Black_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function QuestL11Black_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestL11Black_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestL11Black_arrayLikeToArray(o, minLen);}function QuestL11Black_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestL11Black_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function QuestL11Black_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function QuestL11Black_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11Black_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11Black_toPropertyKey(descriptor.key), descriptor);}}function QuestL11Black_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11Black_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11Black_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11Black_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestL11Black_setPrototypeOf(subClass, superClass);}function QuestL11Black_setPrototypeOf(o, p) {QuestL11Black_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestL11Black_setPrototypeOf(o, p);}function QuestL11Black_createSuper(Derived) {var hasNativeReflectConstruct = QuestL11Black_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestL11Black_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestL11Black_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestL11Black_possibleConstructorReturn(this, result);};}function QuestL11Black_possibleConstructorReturn(self, call) {if (call && (QuestL11Black_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestL11Black_assertThisInitialized(self);}function QuestL11Black_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestL11Black_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestL11Black_getPrototypeOf(o) {QuestL11Black_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestL11Black_getPrototypeOf(o);}function QuestL11Black_defineProperty(obj, key, value) {key = QuestL11Black_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11Black_toPropertyKey(arg) {var key = QuestL11Black_toPrimitive(arg, "string");return QuestL11Black_typeof(key) === "symbol" ? key : String(key);}function QuestL11Black_toPrimitive(input, hint) {if (QuestL11Black_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11Black_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}













var QuestL11Black = /*#__PURE__*/function (_TaskInfo) {QuestL11Black_inherits(QuestL11Black, _TaskInfo);var _super = QuestL11Black_createSuper(QuestL11Black);function QuestL11Black() {var _this;QuestL11Black_classCallCheck(this, QuestL11Black);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestL11Black_defineProperty(QuestL11Black_assertThisInitialized(_this), "boots",
    external_kolmafia_.Item.get("Blackberry Galoshes"));QuestL11Black_defineProperty(QuestL11Black_assertThisInitialized(_this), "beehive",
    external_kolmafia_.Item.get("Beehive"));QuestL11Black_defineProperty(QuestL11Black_assertThisInitialized(_this), "loc",
    external_kolmafia_.Location.get("The Black Forest"));QuestL11Black_defineProperty(QuestL11Black_assertThisInitialized(_this), "latte",
    external_kolmafia_.Item.get("Latte lovers member's mug"));QuestL11Black_defineProperty(QuestL11Black_assertThisInitialized(_this), "blackbird",
    external_kolmafia_.Item.get("reassembled blackbird"));QuestL11Black_defineProperty(QuestL11Black_assertThisInitialized(_this), "sunkenEyes",
    external_kolmafia_.Item.get("Sunken Eyes"));QuestL11Black_defineProperty(QuestL11Black_assertThisInitialized(_this), "brokenWings",
    external_kolmafia_.Item.get("Broken Wings"));QuestL11Black_defineProperty(QuestL11Black_assertThisInitialized(_this), "eyesMonster",
    external_kolmafia_.Monster.get("black adder"));QuestL11Black_defineProperty(QuestL11Black_assertThisInitialized(_this), "wingsMonster",
    external_kolmafia_.Monster.get("Black Panther"));QuestL11Black_defineProperty(QuestL11Black_assertThisInitialized(_this), "blackberryBush",
    external_kolmafia_.Monster.get("Blackberry bush"));QuestL11Black_defineProperty(QuestL11Black_assertThisInitialized(_this), "toAbsorb", void 0);QuestL11Black_defineProperty(QuestL11Black_assertThisInitialized(_this), "blackberry",


    external_kolmafia_.Item.get("Blackberry"));QuestL11Black_defineProperty(QuestL11Black_assertThisInitialized(_this), "skinKiller",
    new QuestTowerKillSkin());QuestL11Black_defineProperty(QuestL11Black_assertThisInitialized(_this), "paths", void 0);return _this;}QuestL11Black_createClass(QuestL11Black, [{ key: "level", value:


    function level() {
      return 11;
    } }, { key: "createPaths", value:

    function createPaths(assumeUnstarted) {
      this.paths = [];
      this.paths.push(new PossiblePath(17, 25));

      if ((0,external_kolmafia_.availableAmount)(this.boots) == 0) {
        this.paths.push(new PossiblePath(13, 17).addPull(this.boots));
      }
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "shouldWearLatte", value:

    function shouldWearLatte() {
      return (
        (0,external_kolmafia_.availableAmount)(this.latte) > 0 &&
        !hasUnlockedLatteFlavor(LatteFlavor.MEAT_DROP));

    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }, { key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Black";
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Black");

      if (status < 0) {
        return QuestStatus.NOT_READY;
      }

      if (status > 1) {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.myHp)() < 60) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "forcedNCIn", value:

    function forcedNCIn() {
      var encounters = getEncounters("The Black Forest", ["All Over the Map"]).
      filter(function (_ref) {var _ref2 = QuestL11Black_slicedToArray(_ref, 1),e = _ref2[0];return e.startsWith("black ") || e == "All Over the Map";}).
      reverse();

      var fightsSinceLastNC = 0;var _iterator = QuestL11Black_createForOfIteratorHelper(

        encounters),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var _step$value = QuestL11Black_slicedToArray(_step.value, 1),encounter = _step$value[0];
          if (encounter == "All Over the Map") {
            break;
          }

          fightsSinceLastNC++;
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

      return Math.max(0, 4 - fightsSinceLastNC);
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      var ncIn = this.forcedNCIn();
      var ncTime = ncIn <= 0;

      var outfit = new GreyOutfit();

      if (!ncTime) {
        outfit.setPlusCombat();
        outfit.combatCap = 5;
        outfit.addWeight("init", 3, null, 50);
      }

      if ((0,external_kolmafia_.availableAmount)(this.boots) > 0) {
        if (!ncTime) {
          outfit.addWeight(this.boots);
        }
      } else if ((0,external_kolmafia_.availableAmount)(this.blackberry) <= 1) {
        outfit.setItemDrops();

        outfit.addWeight("booze drop", 0.1).addWeight("food drop", 0.1);
      }

      if (this.shouldWearLatte()) {
        outfit.addWeight(this.latte);
      }

      outfit.addWeight("moxie").addWeight("ml", -1);

      var fam;

      if ((0,external_kolmafia_.availableAmount)(this.blackbird) == 0 && !ncTime) {
        fam = external_kolmafia_.Familiar.get("Reassembled Blackbird");
      }

      return {
        location: this.loc,
        forcedFight: [ncIn, this.blackberryBush],
        outfit: outfit,
        familiar: fam,
        orbs: this.getNeededMonsters(),
        mayFreeRun: ncIn == 0 && (0,external_kolmafia_.availableAmount)(this.boots) > 0,
        freeRun: function freeRun(monster) {return monster == _this2.blackberryBush;},
        run: function run() {
          if (path.canUse(ResourceCategory.PULL)) {
            GreyPulls.tryPull(_this2.boots);
          }

          (0,external_kolmafia_.print)("Black NC in: " + ncIn, "gray");
          var props = new Properties_PropertyManager();

          try {
            props.setChoice(923, 1);

            if (
            !GreySettings_GreySettings.shouldAvoidTowerRequirements() &&
            (0,external_kolmafia_.availableAmount)(_this2.beehive) == 0 &&
            !_this2.skinKiller.isPossible())
            {
              props.setChoice(924, 3); // Beezzzz
              props.setChoice(1018, 1);
              props.setChoice(1019, 1);
            } else if (
            (0,external_kolmafia_.availableAmount)(_this2.boots) == 0 &&
            (0,external_kolmafia_.availableAmount)(_this2.blackberry) >= 3)
            {
              props.setChoice(924, 2); // Cobble
              props.setChoice(928, 4); // Make boots
            } else {
              props.setChoice(924, 1); // Fight bush
            }

            var settings = new AdventureSettings();

            if ((0,external_kolmafia_.availableAmount)(_this2.blackbird) == 0) {var _iterator2 = QuestL11Black_createForOfIteratorHelper(
                _this2.getNeededMonsters()),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var mon = _step2.value;
                  settings.addNoBanish(mon);
                }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}
            }

            greyAdv(_this2.loc, outfit, settings);
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "getNeededMonsters", value:

    function getNeededMonsters() {
      if ((0,external_kolmafia_.availableAmount)(this.blackbird) > 0) {
        return [];
      }

      var monsters = [];

      if ((0,external_kolmafia_.availableAmount)(this.sunkenEyes) == 0) {
        monsters.push(this.eyesMonster);
      }

      if ((0,external_kolmafia_.availableAmount)(this.brokenWings) == 0) {
        monsters.push(this.wingsMonster);
      }

      return monsters;
    } }]);return QuestL11Black;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/desert/QuestL11DesertCompass.ts
function QuestL11DesertCompass_typeof(obj) {"@babel/helpers - typeof";return QuestL11DesertCompass_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11DesertCompass_typeof(obj);}function QuestL11DesertCompass_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11DesertCompass_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11DesertCompass_toPropertyKey(descriptor.key), descriptor);}}function QuestL11DesertCompass_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11DesertCompass_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11DesertCompass_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11DesertCompass_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestL11DesertCompass_setPrototypeOf(subClass, superClass);}function QuestL11DesertCompass_setPrototypeOf(o, p) {QuestL11DesertCompass_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestL11DesertCompass_setPrototypeOf(o, p);}function QuestL11DesertCompass_createSuper(Derived) {var hasNativeReflectConstruct = QuestL11DesertCompass_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestL11DesertCompass_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestL11DesertCompass_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestL11DesertCompass_possibleConstructorReturn(this, result);};}function QuestL11DesertCompass_possibleConstructorReturn(self, call) {if (call && (QuestL11DesertCompass_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestL11DesertCompass_assertThisInitialized(self);}function QuestL11DesertCompass_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestL11DesertCompass_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestL11DesertCompass_getPrototypeOf(o) {QuestL11DesertCompass_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestL11DesertCompass_getPrototypeOf(o);}function QuestL11DesertCompass_defineProperty(obj, key, value) {key = QuestL11DesertCompass_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11DesertCompass_toPropertyKey(arg) {var key = QuestL11DesertCompass_toPrimitive(arg, "string");return QuestL11DesertCompass_typeof(key) === "symbol" ? key : String(key);}function QuestL11DesertCompass_toPrimitive(input, hint) {if (QuestL11DesertCompass_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11DesertCompass_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}









var QuestL11DesertCompass = /*#__PURE__*/function (_TaskInfo) {QuestL11DesertCompass_inherits(QuestL11DesertCompass, _TaskInfo);var _super = QuestL11DesertCompass_createSuper(QuestL11DesertCompass);function QuestL11DesertCompass() {var _this;QuestL11DesertCompass_classCallCheck(this, QuestL11DesertCompass);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestL11DesertCompass_defineProperty(QuestL11DesertCompass_assertThisInitialized(_this), "compass",
    external_kolmafia_.Item.get("UV-resistant compass"));QuestL11DesertCompass_defineProperty(QuestL11DesertCompass_assertThisInitialized(_this), "script",
    external_kolmafia_.Item.get("Shore Inc. Ship Trip Scrip"));QuestL11DesertCompass_defineProperty(QuestL11DesertCompass_assertThisInitialized(_this), "dontPullScriptAt",
    6);QuestL11DesertCompass_defineProperty(QuestL11DesertCompass_assertThisInitialized(_this), "pullScript",
    new PossiblePath(0).addConsumablePull(_this.script));QuestL11DesertCompass_defineProperty(QuestL11DesertCompass_assertThisInitialized(_this), "noPull",
    new PossiblePath(3));QuestL11DesertCompass_defineProperty(QuestL11DesertCompass_assertThisInitialized(_this), "camel",
    external_kolmafia_.Familiar.get("Melodramedary"));return _this;}QuestL11DesertCompass_createClass(QuestL11DesertCompass, [{ key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Desert / Compass";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      if ((0,external_kolmafia_.storageAmount)(this.script) <= this.dontPullScriptAt) {
        return [this.noPull];
      }

      return [this.noPull, this.pullScript];
    } }, { key: "status", value:

    function status(path) {
      if (
      (0,external_kolmafia_.haveFamiliar)(this.camel) ||
      (0,external_kolmafia_.availableAmount)(this.compass) > 0 ||
      (0,external_kolmafia_.getProperty)("questL11Desert") == "finished")
      {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.myAdventures)() < 40 && path == this.pullScript) {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.getProperty)("questL11Desert") == "unstarted") {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          if (!path.canUse(ResourceCategory.PULL)) {
            var props = new Properties_PropertyManager();

            try {
              props.setChoice(793, 1);

              greyAdv(external_kolmafia_.Location.get("The Shore, Inc. Travel Agency"));
            } finally {
              props.resetAll();
            }
          } else {
            GreyPulls.pullScrip();
            path.addUsed(ResourceCategory.PULL);
          }

          (0,external_kolmafia_.cliExecute)("make " + _this2.compass.name);

          if ((0,external_kolmafia_.availableAmount)(_this2.compass) == 0) {
            throw "Compass should've been available!";
          }
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestL11DesertCompass;}(TaskInfo);
;// CONCATENATED MODULE: ./src/utils/GreyAbsorber.ts
function GreyAbsorber_typeof(obj) {"@babel/helpers - typeof";return GreyAbsorber_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, GreyAbsorber_typeof(obj);}function GreyAbsorber_slicedToArray(arr, i) {return GreyAbsorber_arrayWithHoles(arr) || GreyAbsorber_iterableToArrayLimit(arr, i) || GreyAbsorber_unsupportedIterableToArray(arr, i) || GreyAbsorber_nonIterableRest();}function GreyAbsorber_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function GreyAbsorber_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function GreyAbsorber_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function GreyAbsorber_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = GreyAbsorber_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function GreyAbsorber_toConsumableArray(arr) {return GreyAbsorber_arrayWithoutHoles(arr) || GreyAbsorber_iterableToArray(arr) || GreyAbsorber_unsupportedIterableToArray(arr) || GreyAbsorber_nonIterableSpread();}function GreyAbsorber_nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function GreyAbsorber_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return GreyAbsorber_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return GreyAbsorber_arrayLikeToArray(o, minLen);}function GreyAbsorber_iterableToArray(iter) {if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);}function GreyAbsorber_arrayWithoutHoles(arr) {if (Array.isArray(arr)) return GreyAbsorber_arrayLikeToArray(arr);}function GreyAbsorber_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function GreyAbsorber_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, GreyAbsorber_toPropertyKey(descriptor.key), descriptor);}}function GreyAbsorber_createClass(Constructor, protoProps, staticProps) {if (protoProps) GreyAbsorber_defineProperties(Constructor.prototype, protoProps);if (staticProps) GreyAbsorber_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function GreyAbsorber_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function GreyAbsorber_defineProperty(obj, key, value) {key = GreyAbsorber_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function GreyAbsorber_toPropertyKey(arg) {var key = GreyAbsorber_toPrimitive(arg, "string");return GreyAbsorber_typeof(key) === "symbol" ? key : String(key);}function GreyAbsorber_toPrimitive(input, hint) {if (GreyAbsorber_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (GreyAbsorber_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}




var Absorb = /*#__PURE__*/GreyAbsorber_createClass(function Absorb() {GreyAbsorber_classCallCheck(this, Absorb);GreyAbsorber_defineProperty(this, "monster", void 0);GreyAbsorber_defineProperty(this, "skill", void 0);GreyAbsorber_defineProperty(this, "adventures",


  0);GreyAbsorber_defineProperty(this, "mus",
  0);GreyAbsorber_defineProperty(this, "mys",
  0);GreyAbsorber_defineProperty(this, "mox",
  0);GreyAbsorber_defineProperty(this, "hp",
  0);GreyAbsorber_defineProperty(this, "mp",
  0);});


function getAbsorbedAdventuresRemaining() {
  var absorbs = GreyAbsorber_AbsorbsProvider.loadAbsorbs();

  var monsters = [].concat(GreyAbsorber_toConsumableArray(
  GreyAbsorber_AbsorbsProvider.getAbsorbedMonsters()), GreyAbsorber_toConsumableArray(
  GreyAbsorber_AbsorbsProvider.getReabsorbedMonsters()));


  var advs = 0;var _iterator = GreyAbsorber_createForOfIteratorHelper(

    monsters),_step;try {var _loop = function _loop() {var monster = _step.value;
      var absorb = absorbs.find(function (a) {return a.monster == monster;});

      if (absorb == null || absorb.adventures == null || absorb.adventures <= 0) {return "continue";

      }

      advs += absorb.adventures;
    };for (_iterator.s(); !(_step = _iterator.n()).done;) {var _ret = _loop();if (_ret === "continue") continue;}

    // Because something is tracking wrong
  } catch (err) {_iterator.e(err);} finally {_iterator.f();}return 480 - advs;
}

var GreyAbsorber_AbsorbsProvider = /*#__PURE__*/function () {function AbsorbsProvider() {GreyAbsorber_classCallCheck(this, AbsorbsProvider);}GreyAbsorber_createClass(AbsorbsProvider, [{ key: "getRolloverAdvs", value:






    function getRolloverAdvs() {
      return new Map(
      [
      ["Subatomic Tango", 15],
      ["Solid Fuel", 10],
      ["Autochrony", 10],
      ["Temporal Hyperextension", 10],
      ["Spooky Veins", 10],
      ["Extra Innings", 5],
      ["Reloading", 5],
      ["Harried", 5],
      ["Temporal Bent", 5],
      ["Provably Efficient", 5],
      ["Basic Improvements", 5],
      ["Shifted About", 5],
      ["Seven Foot Feelings", 5],
      ["Self-Actualized", 5]].
      map(function (s) {return [(0,external_kolmafia_.toSkill)(s[0]), s[1] + " Rollover Adventures"];}));

    } }, { key: "shouldGrabSkill", value:

    function shouldGrabSkill(skill) {
      if (skill == AbsorbsProvider.meatSkill) {
        return GreySettings_GreySettings.greyMeatSkill != "No";
      }

      return this.getMustHaveSkills().has(skill);
    } }, { key: "getMustHaveSkills", value:

    function getMustHaveSkills() {
      if ((0,external_kolmafia_.getProperty)("questL13Final") != "unstarted") {
        return new Map();
      }

      var array = [
      //  ["Propagation Drive", "20% Item Drops"],
      ["Overclocking", "Scaling +init"],
      ["Ponzi Apparatus", "Scaling meat%"],
      ["Advanced Exo-Alloy", "100 DA"],
      //["Subatomic Hardening", "Scaling DR"],
      ["Fluid Dynamics Simulation", "Scaling HP Regen"],
      ["Infinite Loop", "Fast Leveling"],
      ["Gravitational Compression", "Scaling Item Drop"],
      ["Hivemindedness", "Scaling MP Regen"],
      ["Photonic Shroud", "-10 Combat"],
      ["Piezoelectric Honk", "+10 Combat"],
      ["Phase Shift", "-10 Combat"],
      ["Ponzi Apparatus", "Scaling Meat Drop"]];


      if (GreySettings_GreySettings.greyMeatSkill == "Yes") {
        array.push(["Financial Spreadsheets", "+40% Meat from Monsters"]);
      }

      return new Map(array.map(function (s) {return [(0,external_kolmafia_.toSkill)(s[0]), s[1]];}));
    } }, { key: "getAbsorb", value:

    function getAbsorb(monster) {
      return AbsorbsProvider.loadAbsorbs().find(function (a) {return a.monster == monster;});
    } }, { key: "getAbsorbsInLocation", value:

    function getAbsorbsInLocation(location) {
      var absorbs = [];

      if (location == null) {
        return absorbs;
      }

      var monsters = (0,external_kolmafia_.getMonsters)(location);var _iterator2 = GreyAbsorber_createForOfIteratorHelper(

        AbsorbsProvider.loadAbsorbs()),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var absorb = _step2.value;
          if (!monsters.includes(absorb.monster)) {
            continue;
          }

          absorbs.push(absorb);
        }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}

      return absorbs;
    } }, { key: "getMultiplier", value:

    function getMultiplier(monster, defeated) {
      if (
      defeated.has(monster) &&
      defeated.get(monster) === Reabsorbed.REABSORBED)
      {
        return 0;
      }

      var mult = defeated.get(monster) == null ? 1 : 0;

      if ((0,external_kolmafia_.familiarWeight)(external_kolmafia_.Familiar.get("Grey Goose")) >= 6) {
        mult += 1;
      }

      return mult;
    } }, { key: "getAdventuresByAbsorbs", value:

    function getAdventuresByAbsorbs(
    defeated,
    monsters)

    {var _this = this;var includeSkills = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;
      var skills = this.getMustHaveSkills();

      var absorbs = monsters.
      map(function (m) {return AbsorbsProvider.getAbsorb(m);}).
      filter(function (a) {
        if (
        a.adventures <= 0 && (
        a.skill == null || !includeSkills || !skills.has(a.skill)))
        {
          return false;
        }

        if (a.adventures > 0 && defeated.has(a.monster)) {
          return false;
        }

        if (a.skill != null && (0,external_kolmafia_.haveSkill)(a.skill)) {
          return false;
        }

        return true;
      });

      if (absorbs.length == 0) {
        return null;
      }

      var advsSpent = 1;

      var totalAdvs = absorbs.reduce(
      function (p, a) {return (
          Math.max(0, a.adventures) * _this.getMultiplier(a.monster, defeated) + p);},
      0);

      var newSkills = new Map();var _iterator3 = GreyAbsorber_createForOfIteratorHelper(

        absorbs),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var a = _step3.value;
          if (!skills.has(a.skill)) {
            continue;
          }

          newSkills.set(a, skills.get(a.skill));
        }} catch (err) {_iterator3.e(err);} finally {_iterator3.f();}

      var profit =
      totalAdvs - (advsSpent + Math.max(2, Math.ceil(advsSpent * 0.2)));

      return {
        turnsToGain: totalAdvs,
        expectedTurnsProfit: profit,
        monsters: absorbs.map(function (a) {return a.monster;}),
        skills: newSkills,
        weight: profit + this.generateWeights(newSkills),
        reabsorb:
        absorbs.find(
        function (a) {return (
            a.adventures > 0 && defeated.get(a.monster) != Reabsorbed.REABSORBED);}) !=
        null
      };
    } }, { key: "generateWeights", value:

    function generateWeights(skills) {
      var weight = 0;
      var mustHave = this.getMustHaveSkills();var _iterator4 = GreyAbsorber_createForOfIteratorHelper(

        skills.keys()),_step4;try {for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {var k = _step4.value;
          var w = 0;

          if (mustHave.has(k.skill)) {
            w = GreySettings_GreySettings.usefulSkillsWeight;
          } else {
            continue;
          }

          weight += w;
        }} catch (err) {_iterator4.e(err);} finally {_iterator4.f();}

      return weight;
    } }, { key: "getAdventuresInLocation", value:

    function getAdventuresInLocation(
    ignoreAdventures,
    defeated,
    location)

    {var _this2 = this;var includeSkills = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;
      var skills = this.getMustHaveSkills();
      var advsRemaining = getAbsorbedAdventuresRemaining();

      // for (let entry of this.getRolloverAdvs()) {
      //   skills.set(entry[0], entry[1]);
      // }

      var absorbs = this.getAbsorbsInLocation(location).filter(function (a) {
        if (a.adventures > 0 && (ignoreAdventures || advsRemaining <= 0)) {
          return false;
        }

        if (
        a.adventures <= 0 && (
        a.skill == null || !includeSkills || !skills.has(a.skill)))
        {
          return false;
        }

        if (a.adventures > 0 && defeated.has(a.monster)) {
          return false;
        }

        if (a.skill != null && (0,external_kolmafia_.haveSkill)(a.skill)) {
          return false;
        }

        return true;
      });

      if (absorbs.length == 0) {
        return null;
      }

      var appearRates = (0,external_kolmafia_.appearanceRates)(location);

      // Special workaround for screambat making appearance rates of non-screambats zero
      if (appearRates["screambat"] == 100) {
        for (var _i = 0, _Object$keys = Object.keys(appearRates); _i < _Object$keys.length; _i++) {var key = _Object$keys[_i];
          if (key == "none") {
            continue;
          }

          appearRates[key] = 20;
        }
      }

      var advsSpent = 0;
      var rates = [];
      var combatPercent =
      location == external_kolmafia_.Location.get("Twin Peak") ? 100 : location.combatPercent;

      Object.entries(appearRates).forEach(function (v) {
        var monster = external_kolmafia_.Monster.get(v[0]);
        var rate = v[1];

        if (rate <= 0 || combatPercent <= 0) {
          return;
        }

        rates.push([monster, rate * (combatPercent / 100)]);
      });

      if (location == external_kolmafia_.Location.get("Oil Peak")) {
        rates.push([external_kolmafia_.Monster.get("Oil Baron"), 100]);
      }

      absorbs = absorbs.filter(
      function (a) {return rates.find(function (r) {return r[0] == a.monster;}) != null;});


      if (absorbs.length == 0) {
        return null;
      }

      while (
      rates.filter(
      function (r) {return (
          r[1] * advsSpent < 100 &&
          absorbs.filter(function (a) {return a.monster == r[0];}).length > 0);}).
      length > 0)
      {
        advsSpent++;
      }

      if (AbsorbsProvider.hasBall) {
        advsSpent = Math.floor(advsSpent / 2);
      }

      var totalAdvs = absorbs.reduce(
      function (p, a) {return (
          Math.max(0, a.adventures) * _this2.getMultiplier(a.monster, defeated) + p);},
      0);

      var newSkills = new Map();var _iterator5 = GreyAbsorber_createForOfIteratorHelper(

        absorbs),_step5;try {for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {var a = _step5.value;
          if (!skills.has(a.skill)) {
            continue;
          }

          newSkills.set(a, skills.get(a.skill));
        }} catch (err) {_iterator5.e(err);} finally {_iterator5.f();}

      var profit =
      totalAdvs - (advsSpent + Math.max(2, Math.ceil(advsSpent * 0.2)));

      return {
        turnsToGain: totalAdvs,
        expectedTurnsProfit: profit,
        monsters: absorbs.map(function (a) {return a.monster;}),
        skills: newSkills,
        weight: profit + this.generateWeights(newSkills),
        reabsorb:
        absorbs.find(
        function (a) {return (
            a.adventures > 0 && defeated.get(a.monster) != Reabsorbed.REABSORBED);}) !=
        null
      };
    } }, { key: "getOnlyUsefulAbsorbs", value:

    function getOnlyUsefulAbsorbs(absorbs) {
      var usefulSkills = GreyAbsorber_toConsumableArray(this.getMustHaveSkills().keys());

      return absorbs.filter(function (a) {
        return (
          a.adventures > 0 ||
          a.mp > 0 ||
          a.skill != null && usefulSkills.includes(a.skill));

      });
    } }, { key: "getAbsorbedMonstersFromInstance", value:





































































    function getAbsorbedMonstersFromInstance() {
      var monsters = new Map();
      var absorbed = AbsorbsProvider.getAbsorbedMonsters();
      var reabsorbed = AbsorbsProvider.getReabsorbedMonsters();

      reabsorbed.forEach(function (m) {
        monsters.set(m, Reabsorbed.REABSORBED);
      });

      absorbed.forEach(function (m) {
        if (reabsorbed.includes(m)) {
          return;
        }

        monsters.set(m, Reabsorbed.NOT_REABSORBED);
      });

      return monsters;
    } }, { key: "getExtraAdventures", value:












    function getExtraAdventures(
    ignoreAdventures,
    defeated)

    {var includeSkills = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
      var map = new Map();
      var advsRemaining = getAbsorbedAdventuresRemaining();var _iterator6 = GreyAbsorber_createForOfIteratorHelper(

        AbsorbsProvider.loadAbsorbs().filter(
        function (a) {return (
            (includeSkills ||
            !ignoreAdventures && a.adventures > 0 && advsRemaining > 0) &&
            !defeated.has(a.monster));})),_step6;try {for (_iterator6.s(); !(_step6 = _iterator6.n()).done;)
        {var absorb = _step6.value;var _iterator7 = GreyAbsorber_createForOfIteratorHelper(
            getLocations(absorb.monster)),_step7;try {for (_iterator7.s(); !(_step7 = _iterator7.n()).done;) {var l = _step7.value;
              if (map.has(l)) {
                continue;
              }

              map.set(
              l,
              this.getAdventuresInLocation(
              ignoreAdventures,
              defeated,
              l,
              includeSkills));


            }} catch (err) {_iterator7.e(err);} finally {_iterator7.f();}
        }} catch (err) {_iterator6.e(err);} finally {_iterator6.f();}

      return GreyAbsorber_toConsumableArray(map.entries()).filter(function (_ref) {var _ref2 = GreyAbsorber_slicedToArray(_ref, 2),abs = _ref2[1];return abs != null;});
    } }, { key: "printRemainingAbsorbs", value:

    function printRemainingAbsorbs() {
      var defeated = this.getAbsorbedMonstersFromInstance();
      var absorbs = AbsorbsProvider.loadAbsorbs().filter(
      function (a) {return (
          a.adventures > 0 && defeated.get(a.monster) != Reabsorbed.REABSORBED);});


      absorbs.sort(function (a1, a2) {return a2.adventures - a1.adventures;});

      if (absorbs.length == 0) {
        (0,external_kolmafia_.print)("No adventures to absorb!", "blue");
        return;
      }

      if (
      (0,external_kolmafia_.familiarWeight)(external_kolmafia_.Familiar.get("Grey Goose")) >= 6 &&
      getQuestStatus("questL13Final") > 11)
      {
        (0,external_kolmafia_.print)(
        "The remaining absorbs are likely either out of reach or judged to be wasteful to acquire",
        "red");

      }

      (0,external_kolmafia_.printHtml)(
      "<font color='blue'>Absorbs:</font> " +
      absorbs.
      map(
      function (a) {return (
          a.monster.name +
          " <font color='gray'>(" +
          a.adventures +
          " advs, Absorb x " + (
          defeated.has(a.monster) ? "1" : "2") +
          ")</font>");}).

      join(", "));

    } }], [{ key: "getAbsorb", value: function getAbsorb(monster) {var _iterator8 = GreyAbsorber_createForOfIteratorHelper(AbsorbsProvider.loadAbsorbs()),_step8;try {for (_iterator8.s(); !(_step8 = _iterator8.n()).done;) {var absorb = _step8.value;if (absorb.monster != monster) {continue;}return absorb;}} catch (err) {_iterator8.e(err);} finally {_iterator8.f();}return null;} }, { key: "loadAbsorbs", value: function loadAbsorbs() {var includeBanished = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;if (AbsorbsProvider.allAbsorbs == null) {AbsorbsProvider.allAbsorbs = [];var _iterator9 = GreyAbsorber_createForOfIteratorHelper((0,external_kolmafia_.fileToBuffer)("data/grey_you_data.txt").split("\n")),_step9;try {for (_iterator9.s(); !(_step9 = _iterator9.n()).done;) {var line = _step9.value;var spl = line.replace("\r", "").split("\t");if (spl.length != 2 || spl[1] == null || spl[1].length == 0) {continue;}var mons = (0,external_kolmafia_.toMonster)(spl[0]);if (mons == external_kolmafia_.Monster.none) {(0,external_kolmafia_.print)("Unknown " + spl[0]);continue;}var absorb = new Absorb();absorb.monster = mons;if (spl[1].endsWith("adventures")) {absorb.adventures = (0,external_kolmafia_.toInt)(spl[1].substring(0, spl[1].lastIndexOf(" ")));} else if (spl[1].endsWith("muscle")) {absorb.mus = (0,external_kolmafia_.toInt)(spl[1].substring(0, spl[1].lastIndexOf(" ")));} else if (spl[1].endsWith("mysticality")) {absorb.mys = (0,external_kolmafia_.toInt)(spl[1].substring(0, spl[1].lastIndexOf(" ")));} else if (spl[1].endsWith("moxie")) {absorb.mox = (0,external_kolmafia_.toInt)(spl[1].substring(0, spl[1].lastIndexOf(" ")));} else if (spl[1].endsWith("maximum hp")) {absorb.hp = (0,external_kolmafia_.toInt)(spl[1].substring(0, spl[1].indexOf(" ")));} else if (spl[1].endsWith("maximum mp")) {absorb.mp = (0,external_kolmafia_.toInt)(spl[1].substring(0, spl[1].indexOf(" ")));} else {absorb.skill = (0,external_kolmafia_.toSkill)(spl[1]);if (absorb.skill == external_kolmafia_.Skill.none) {throw "Unknown line '" + spl[1] + "' in absorb data";}}AbsorbsProvider.allAbsorbs.push(absorb);}} catch (err) {_iterator9.e(err);} finally {_iterator9.f();}this.remainingAdvAbsorbs = AbsorbsProvider.allAbsorbs.filter(function (a) {return a.adventures > 0;}).map(function (a) {return a.monster;});}return AbsorbsProvider.allAbsorbs.filter(function (a) {return includeBanished || !(0,external_kolmafia_.isBanished)(a.monster);});} }, { key: "getAbsorbedMonsters", value: function getAbsorbedMonsters() {return Object.keys((0,external_kolmafia_.absorbedMonsters)()).map(function (m) {return external_kolmafia_.Monster.get(m);});} }, { key: "getReabsorbedMonsters", value: function getReabsorbedMonsters() {return (0,external_kolmafia_.getProperty)("gooseReprocessed").split(",").filter(function (s) {return s != "";}).map(function (m) {return (0,external_kolmafia_.toMonster)((0,external_kolmafia_.toInt)(m));});} }]);return AbsorbsProvider;}();GreyAbsorber_defineProperty(GreyAbsorber_AbsorbsProvider, "allAbsorbs", void 0);GreyAbsorber_defineProperty(GreyAbsorber_AbsorbsProvider, "remainingAdvAbsorbs", void 0);GreyAbsorber_defineProperty(GreyAbsorber_AbsorbsProvider, "hasBall", (0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("miniature crystal ball")) > 0);GreyAbsorber_defineProperty(GreyAbsorber_AbsorbsProvider, "meatSkill", external_kolmafia_.Skill.get("Financial Spreadsheets"));











var Reabsorbed;(function (Reabsorbed) {Reabsorbed[Reabsorbed["REABSORBED"] = 0] = "REABSORBED";Reabsorbed[Reabsorbed["NOT_REABSORBED"] = 1] = "NOT_REABSORBED";})(Reabsorbed || (Reabsorbed = {}));
;// CONCATENATED MODULE: ./src/utils/Banishers.ts
function Banishers_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, Banishers_toPropertyKey(descriptor.key), descriptor);}}function Banishers_createClass(Constructor, protoProps, staticProps) {if (protoProps) Banishers_defineProperties(Constructor.prototype, protoProps);if (staticProps) Banishers_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function Banishers_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function Banishers_defineProperty(obj, key, value) {key = Banishers_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function Banishers_toPropertyKey(arg) {var key = Banishers_toPrimitive(arg, "string");return Banishers_typeof(key) === "symbol" ? key : String(key);}function Banishers_toPrimitive(input, hint) {if (Banishers_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (Banishers_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}function Banishers_typeof(obj) {"@babel/helpers - typeof";return Banishers_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, Banishers_typeof(obj);}function Banishers_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = Banishers_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function Banishers_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return Banishers_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return Banishers_arrayLikeToArray(o, minLen);}function Banishers_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}

function hasBanished(location, banish) {
  var banished = Banishers_getBanished().filter(function (b) {return b.banisher.type == banish;});

  if (banish.length == 0) {
    return false;
  }

  if (location == null) {
    return true;
  }var _iterator = Banishers_createForOfIteratorHelper(

    Object.keys((0,external_kolmafia_.getLocationMonsters)(location)).map(function (m) {return (
        external_kolmafia_.Monster.get(m));})),_step;try {var _loop = function _loop()
    {var mob = _step.value;
      if (banished.filter(function (b) {return b.monster == mob;}).length == 0) {return "continue";

      }return { v:

        true };
    };for (_iterator.s(); !(_step = _iterator.n()).done;) {var _ret = _loop();if (_ret === "continue") continue;if (Banishers_typeof(_ret) === "object") return _ret.v;}} catch (err) {_iterator.e(err);} finally {_iterator.f();}

  return false;
}

var BanishReason;(function (BanishReason) {BanishReason[BanishReason["QUEST"] = 0] = "QUEST";BanishReason[BanishReason["REASBORB"] = 1] = "REASBORB";BanishReason[BanishReason["UNKNOWN"] = 2] = "UNKNOWN";})(BanishReason || (BanishReason = {}));





var Banishers_BanishType;(function (BanishType) {BanishType["BALEFUL_HOWL"] = "baleful howl";BanishType["BANISHING_SHOUT"] = "banishing shout";BanishType["BATTER_UP"] = "batter up!";BanishType["BEANCANNON"] = "beancannon";BanishType["BE_A_MIND_MASTER"] = "Be a Mind Master";BanishType["BLART_SPRAY_WIDE"] = "B. L. A. R. T. Spray (wide)";BanishType["BOWL_A_CURVEBALL"] = "Bowl a Curveball";BanishType["BREATHE_OUT"] = "breathe out";BanishType["BUNDLE_OF_FRAGRANT_HERBS"] = "bundle of &quot;fragrant&quot; herbs";BanishType["CHATTERBOXING"] = "chatterboxing";BanishType["CLASSY_MONKEY"] = "classy monkey";BanishType["COCKTAIL_NAPKIN"] = "cocktail napkin";BanishType["CRYSTAL_SKULL"] = "crystal skull";BanishType["CURSE_OF_VACATION"] = "curse of vacation";BanishType["DEATHCHUCKS"] = "deathchucks";BanishType["DIRTY_STINKBOMB"] = "dirty stinkbomb";BanishType["DIVINE_CHAMPAGNE_POPPER"] = "divine champagne popper";BanishType["FEEL_HATRED"] = "Feel Hatred";BanishType["GINGERBREAD_RESTRAINING_ORDER"] = "gingerbread restraining order";BanishType["HAROLDS_BELL"] = "harold's bell";BanishType["HOWL_OF_THE_ALPHA"] = "howl of the alpha";BanishType["HUMAN_MUSK"] = "human musk";BanishType["ICE_HOTEL_BELL"] = "ice hotel bell";BanishType["ICE_HOUSE"] = "ice house";BanishType["KGB_TRANQUILIZER_DART"] = "KGB tranquilizer dart";BanishType["LICORICE_ROPE"] = "licorice rope";BanishType["LOUDER_THAN_BOMB"] = "louder than bomb";BanishType["MAFIA_MIDDLEFINGER_RING"] = "mafia middle finger ring";BanishType["NANORHINO"] = "nanorhino";BanishType["PANTSGIVING"] = "pantsgiving";BanishType["PEEL_OUT"] = "peel out";BanishType["PULLED_INDIGO_TAFFY"] = "pulled indigo taffy";BanishType["REFLEX_HAMMER"] = "Reflex Hammer";BanishType["SABER_FORCE"] = "Saber Force";BanishType["SHOW_YOUR_BORING_FAMILIAR_PICTURES"] = "Show your boring familiar pictures";BanishType["SMOKE_GRENADE"] = "smoke grenade";BanishType["SNOKEBOMB"] = "snokebomb";BanishType["SPOOKY_MUSIC_BOX_MECHANISM"] = "spooky music box mechanism";BanishType["SPRING_LOADED_FRONT_BUMPER"] = "Spring-Loaded Front Bumper";BanishType["STAFF_OF_THE_STANDALONE_CHEESE"] = "staff of the standalone cheese";BanishType["STINKY_CHEESE_EYE"] = "stinky cheese eye";BanishType["SYSTEM_SWEEP"] = "System Sweep";BanishType["TENNIS_BALL"] = "tennis ball";BanishType["THROW_LATTE_ON_OPPONENT"] = "Throw Latte on Opponent";BanishType["THUNDER_CLAP"] = "thunder clap";BanishType["TRYPTOPHAN_DART"] = "tryptophan dart";BanishType["ULTRA_HAMMER"] = "Ultra Hammer";BanishType["V_FOR_VIVALA_MASK"] = "v for vivala mask";BanishType["WALK_AWAY_FROM_EXPLOSION"] = "walk away from explosion";})(Banishers_BanishType || (Banishers_BanishType = {}));var



















































Banisher = /*#__PURE__*/Banishers_createClass(function Banisher() {Banishers_classCallCheck(this, Banisher);Banishers_defineProperty(this, "item", void 0);Banishers_defineProperty(this, "turnsBanish", void 0);Banishers_defineProperty(this, "type", void 0);});





var Banish = /*#__PURE__*/Banishers_createClass(function Banish() {Banishers_classCallCheck(this, Banish);Banishers_defineProperty(this, "monster", void 0);Banishers_defineProperty(this, "turnBanished", void 0);Banishers_defineProperty(this, "banisher", void 0);Banishers_defineProperty(this, "reason", void 0);});












function Banishers_getBanished() {
  var prop = (0,external_kolmafia_.getProperty)("banishedMonsters").split(":");
  var banishes = [];
  var banishers = getBanishers();var _loop2 = function _loop2()

  {
    var monsterName = (0,external_kolmafia_.toMonster)(prop[i]);
    var banisherName = prop[i + 1];
    var turnBanished = (0,external_kolmafia_.toInt)(prop[i + 2]);

    var banisher = new Banish();
    banisher.monster = monsterName;
    var banishType =
    Banishers_BanishType[getEnumKeyByEnumValue(Banishers_BanishType, banisherName)];
    banisher.banisher = banishers.find(function (b) {return b.type == banishType;});
    banisher.turnBanished = turnBanished;

    if (banisher.banisher == null) {
      banisher.banisher = new Banisher();
      banisher.banisher.type = banishType;
    }

    banishes.push(banisher);
  };for (var i = 0; i + 2 < prop.length; i += 3) {_loop2();}

  return banishes;
}

function getEnumKeyByEnumValue(myEnum, enumValue) {
  var keys = Object.keys(myEnum).filter(function (x) {return myEnum[x] == enumValue;});

  return keys.length > 0 ? keys[0] : null;
}

var BanishManager = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {function BanishManager() {Banishers_classCallCheck(this, BanishManager);}Banishers_createClass(BanishManager, [{ key: "getGoodBanishers", value:
    function getGoodBanishers(
    location)

    {var _this = this;var turnsSpendingInZone = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : myAdventures();
      var banishers = getBanishers().filter(
      function (b) {return !_this.isInUse(b, location);});


      if (
      choiceFollowsFight() ||
      currentRound() != 0 ||
      fightFollowsChoice() ||
      handlingChoice() ||
      !canInteract())
      {
        banishers = banishers.filter(function (b) {return availableAmount(b.item) > 0;});
      }

      banishers.sort(function (b1, b2) {
        return (
          _this.getTotalCost(b1, turnsSpendingInZone) -
          _this.getTotalCost(b2, turnsSpendingInZone));

      });

      return banishers;
    } }, { key: "getTotalCost", value:

    function getTotalCost(banisher, turnsToSpend) {
      var cost = mallPrice(banisher.item);

      if (banisher.turnsBanish == -1) {
        return cost;
      }

      var itemsToBuy = Math.ceil(turnsToSpend / banisher.turnsBanish);

      return cost * itemsToBuy;
    } }, { key: "getMonsterLocations", value:

    function getMonsterLocations(monster) {
      var locations = [];var _iterator2 = Banishers_createForOfIteratorHelper(

        Location.all()),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var location = _step2.value;
          var monsters = this.getMonstersAtLocation(location);

          if (!monsters.includes(monster)) {
            continue;
          }

          locations.push(location);
        }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}

      return locations;
    } }, { key: "getMonstersAtLocation", value:

    function getMonstersAtLocation(location) {
      return Object.keys(getLocationMonsters(location)).map(function (s) {return toMonster(s);});
    } }, { key: "isInUse", value:

    function isInUse(banisher, location) {var _this2 = this;
      return (
        Banishers_getBanished().find(
        function (b) {return (
            b.banisher.type == banisher.type &&
            _this2.getMonsterLocations(b.monster).includes(location));}) !=
        null);

    } }]);return BanishManager;}()));


function getBanishers() {
  var banishers = [
  [Banishers_BanishType.HUMAN_MUSK, "Human Musk", -1],
  [Banishers_BanishType.BE_A_MIND_MASTER, "Daily Affirmation: Be a Mind Master", 80],
  [Banishers_BanishType.TENNIS_BALL, "Tennis Ball", 30],
  [Banishers_BanishType.LOUDER_THAN_BOMB, "Louder Than Bomb", 20],
  [Banishers_BanishType.CRYSTAL_SKULL, "Crystal Skull", 20],
  [Banishers_BanishType.DIVINE_CHAMPAGNE_POPPER, "Divine Champagne Popper", 5],
  [Banishers_BanishType.ICE_HOUSE, "Ice House", -1]];


  return banishers.map(function (b) {
    var banish = new Banisher();
    banish.item = (0,external_kolmafia_.toItem)(b[1]);
    banish.turnsBanish = b[2];
    banish.type = b[0];

    return banish;
  });
}
;// CONCATENATED MODULE: ./src/utils/GreyCombat.ts









var poisonousMonsters = [
"Black Adder",
"Black Widow",
"tomb asp",
"big creepy spider",
"completely different spider",
"Stone temple pirate",
"spectral jellyfish",
"Stephen Spookyraven",
"Swarm of killer bees",
"whitesnake",
"Mayonnaise wasp",
"Dodecapede",
"Quantum Mechanic",
"Protagonist",
"ninja snowman assassin"].
map(function (s) {return external_kolmafia_.Monster.get(s);});

var flyers = external_kolmafia_.Item.get("Rockband Flyers");
var pantsgiving = external_kolmafia_.Item.get("Pantsgiving");
var cosmicBall = external_kolmafia_.Item.get("Cosmic Bowling Ball");
var GreyCombat_goose = external_kolmafia_.Familiar.get("Grey Goose");

function greyDuringFightMacro(settings) {
  var macro = new Macro();

  var monster = (0,external_kolmafia_.lastMonster)();
  var absorb = GreyAbsorber_AbsorbsProvider.getAbsorb(monster);
  var hasAbsorbed = GreyAbsorber_AbsorbsProvider.getReabsorbedMonsters().includes(monster);

  if (
  (0,external_kolmafia_.myFamiliar)() == external_kolmafia_.Familiar.get("Space Jellyfish") &&
  (0,external_kolmafia_.monsterElement)(monster) == external_kolmafia_.Element.get("stench"))
  {
    macro.trySkill(external_kolmafia_.Skill.get("Extract Jelly"));
  }

  // If low weight fam, but not too high. Let them try to dupe.
  if (
  (0,external_kolmafia_.myLevel)() >= 6 &&
  monster == external_kolmafia_.Monster.get("Sausage Goblin") &&
  !GreySettings_GreySettings.isHardcoreMode() &&
  (0,external_kolmafia_.familiarWeight)(GreyCombat_goose) >= 6 &&
  (0,external_kolmafia_.familiarWeight)(GreyCombat_goose) < 9)
  {
    macro = macro.trySkill(external_kolmafia_.Skill.get("Emit Matter Duplicating Drones"));
  } else if (
  absorb != null && (
  (0,external_kolmafia_.myAdventures)() > 20 && absorb.mp > 0 ||
  absorb.adventures > 0 && getAbsorbedAdventuresRemaining() > 0) &&
  !hasAbsorbed)
  {
    if (absorb.adventures > 0 && getAbsorbedAdventuresRemaining() > 0) {
      macro = macro.trySkill(external_kolmafia_.Skill.get("Re-Process Matter"));
    }
  } else if (isBanishable(settings, monster)) {
    // If they have no good absorbs, or we've already absorbed them
    if (
    absorb == null ||
    hasAbsorbed != null ||
    absorb.hp == 0 &&
    absorb.mp == 0 && (
    absorb.skill == null || (0,external_kolmafia_.haveSkill)(absorb.skill)))
    {
      // If the script explicitly wanted to banish these and this isn't a non-quest
      if (
      !settings.nonquest && (
      settings.banishThese != null || settings.dontBanishThese != null))
      {
        if (
        !hasBanished((0,external_kolmafia_.myLocation)(), Banishers_BanishType.SPRING_LOADED_FRONT_BUMPER) &&
        (0,external_kolmafia_.getFuel)() >= 50)
        {
          macro.trySkill("Asdon Martin: Spring-Loaded Front Bumper");
        }

        if (
        !hasBanished((0,external_kolmafia_.myLocation)(), Banishers_BanishType.BOWL_A_CURVEBALL) &&
        (0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("Cosmic bowling ball")) > 0)
        {
          macro.trySkill("Bowl a Curveball");
        }
      }

      if (
      !hasBanished((0,external_kolmafia_.myLocation)(), Banishers_BanishType.SYSTEM_SWEEP) &&
      (0,external_kolmafia_.haveSkill)(external_kolmafia_.Skill.get("System Sweep")) &&
      (0,external_kolmafia_.getMonsters)((0,external_kolmafia_.myLocation)()).includes(monster))
      {
        // We want to banish always on quests, but not on non-quests which we're likely to be wasting a banish in
        var wastedBanish =
        settings.nonquest &&
        Banishers_getBanished().filter(
        function (b) {return (
            b.banisher.type == Banishers_BanishType.SYSTEM_SWEEP &&
            b.turnBanished + 1 >= (0,external_kolmafia_.myTurncount)());}).
        length > 0;

        // If we're using crystal ball on a non-quest and we're only aiming to hit one banish
        if (
        !wastedBanish &&
        settings.nonquest &&
        (0,external_kolmafia_.equippedAmount)(external_kolmafia_.Item.get("miniature crystal ball")) > 0 &&
        settings.dontBanishThese != null &&
        settings.dontBanishThese.length == 1)
        {
          // If our next monster is a monster we're aiming to hit.
          var nextMonster = currentPredictions().get((0,external_kolmafia_.myLocation)());

          // If our next predicted combat is against a monster we specifically don't want to banish.
          wastedBanish =
          nextMonster != null && !isBanishable(settings, nextMonster);
        }

        if (!wastedBanish) {
          // If we do want to banish something..
          macro.trySkill(external_kolmafia_.Skill.get("System Sweep"));
        }
      }
    }
  }

  if (
  (0,external_kolmafia_.haveSkill)(external_kolmafia_.Skill.get("Fluid Dynamics Simulation")) &&
  /*toInt(getProperty("flyeredML")) <= 10000 && */monster.baseHp < 300 &&
  (0,external_kolmafia_.expectedDamage)(monster) < Math.min(200, (0,external_kolmafia_.myHp)() * 0.9) &&
  !monster.attributes.includes("FREE") &&
  !poisonousMonsters.includes(monster) &&
  (0,external_kolmafia_.itemAmount)(flyers) > 0)
  {
    macro.tryItem(flyers);
  }

  if ((0,external_kolmafia_.equippedAmount)(pantsgiving) > 0) {
    macro.trySkill(external_kolmafia_.Skill.get("Pocket Crumbs"));
  }

  if (
  (0,external_kolmafia_.myHp)() > monster.baseAttack * 2 &&
  Math.max(monster.baseAttack, monster.baseHp) * 1.1 <
  (0,external_kolmafia_.myBasestat)(external_kolmafia_.Stat.get("Moxie")) &&
  (0,external_kolmafia_.getProperty)("boomBoxSong") == "Total Eclipse of Your Meat")
  {
    // Always try to sing along if the mob is weak enough
    macro.trySkill(external_kolmafia_.Skill.get("Sing Along"));
  }

  return macro;
}

function isBanishable(
settings,
monster)
{
  if (settings.banishThese == null && settings.dontBanishThese == null) {
    return false;
  }

  if (settings.banishThese != null) {
    return settings.banishThese.includes(monster);
  } else if (!settings.dontBanishThese.includes(monster) && !monster.boss) {
    var loc = (0,external_kolmafia_.myLocation)();
    var rates = (0,external_kolmafia_.appearanceRates)(loc);

    if (rates[monster.name] > 5) {
      return true;
    }
  }

  return false;
}
var toRemove = [
"Really Quite Poisoned",
"Majorly Poisoned",
"Somewhat Poisoned",
"A Little Bit Poisoned",
"Hardly Poisoned at All"].
map(function (s) {return external_kolmafia_.Effect.get(s);});
var antidote = external_kolmafia_.Item.get("anti-anti-antidote");
var cape = external_kolmafia_.Item.get("Unwrapped knock-off retro superhero cape");
var beehive = external_kolmafia_.Item.get("Beehive");

function greyKillingBlow(outfit) {
  var macro = new Macro();
  var healthPerc = Math.min(Math.floor((0,external_kolmafia_.myHp)() / (0,external_kolmafia_.myMaxhp)() * 100) - 5, 30);

  if (toRemove.find(function (e) {return (0,external_kolmafia_.haveEffect)(e) > 0;}) && (0,external_kolmafia_.itemAmount)(antidote) > 0) {
    (0,external_kolmafia_.use)(antidote);
  }

  if (
  (0,external_kolmafia_.myMeat)() < 500 &&
  (0,external_kolmafia_.getProperty)("hasMaydayContract") == "true" &&
  (0,external_kolmafia_.getProperty)("_maydayDropped") == "false")
  {
    macro = macro.attack().repeat();
  }

  if ((0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("Temporary Amnesia")) == 0) {
    if (
    (0,external_kolmafia_.getProperty)("retroCapeSuperhero") == "vampire" &&
    (0,external_kolmafia_.getProperty)("retroCapeWashingInstructions") == "kill" &&
    (0,external_kolmafia_.equippedAmount)(cape) > 0 && (
    (0,external_kolmafia_.currentRound)() == 0 || (0,external_kolmafia_.lastMonster)().phylum == external_kolmafia_.Phylum.get("undead")))
    {
      macro = macro.trySkillRepeat("Slay the dead");
    }

    if (
    ((0,external_kolmafia_.lastMonster)().baseHp < 2 || (0,external_kolmafia_.lastMonster)().physicalResistance < 70) &&
    (0,external_kolmafia_.myMp)() >= 20)
    {
      var nano = external_kolmafia_.Skill.get("Double Nanovision");
      var loop = external_kolmafia_.Skill.get("Infinite Loop");
      var attackSkill = null;

      if ((0,external_kolmafia_.haveSkill)(nano) && (outfit.itemDropWeight >= 1 || (0,external_kolmafia_.myLevel)() >= 17)) {
        attackSkill = nano;
      }

      if ((0,external_kolmafia_.haveSkill)(loop)) {
        // If we're underleveled or don't intend to use nanovision
        if ((0,external_kolmafia_.myLevel)() <= 10 || attackSkill == null) {
          attackSkill = loop;
        } else if (
        // If we failed to stay underleveled for hippies, or don't need to stay underleveled
        (0,external_kolmafia_.myLevel)() >= 12 &&
        GreySettings_GreySettings.isHippyMode() &&
        !(
        (0,external_kolmafia_.haveOutfit)("Filthy Hippy Disguise") ||
        (0,external_kolmafia_.haveOutfit)("Frat Warrior Fatigues")))

        {
          attackSkill = loop;
        }
      } else if ((0,external_kolmafia_.haveSkill)(nano)) {
        attackSkill = nano;
      }

      if (attackSkill == null) {
        attackSkill = (0,external_kolmafia_.haveSkill)(nano) ? nano : (0,external_kolmafia_.haveSkill)(loop) ? loop : null;
      }

      if (attackSkill != null) {
        macro.trySkill(attackSkill);

        macro.while_("!pastround 15 && !hppercentbelow ".concat(
        healthPerc, " && hasskill ").concat(attackSkill.name),
        Macro.skill(attackSkill));

      }
    }
  }

  if ((0,external_kolmafia_.itemAmount)(beehive) > 0) {
    macro.if_("!pastround 15 && !hppercentbelow ".concat(
    healthPerc),
    Macro.tryItem(beehive));

  }

  if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("cosmicBowlingBallReturnCombats")) <= 1) {
    macro.tryItem(cosmicBall);
  }

  macro.while_("!pastround 15 && !hppercentbelow ".concat(
  healthPerc),
  Macro.attack());

  macro.abort();

  return macro;
}
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/desert/QuestL11DesertExplore.ts
function QuestL11DesertExplore_typeof(obj) {"@babel/helpers - typeof";return QuestL11DesertExplore_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11DesertExplore_typeof(obj);}function QuestL11DesertExplore_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11DesertExplore_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11DesertExplore_toPropertyKey(descriptor.key), descriptor);}}function QuestL11DesertExplore_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11DesertExplore_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11DesertExplore_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11DesertExplore_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestL11DesertExplore_setPrototypeOf(subClass, superClass);}function QuestL11DesertExplore_setPrototypeOf(o, p) {QuestL11DesertExplore_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestL11DesertExplore_setPrototypeOf(o, p);}function QuestL11DesertExplore_createSuper(Derived) {var hasNativeReflectConstruct = QuestL11DesertExplore_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestL11DesertExplore_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestL11DesertExplore_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestL11DesertExplore_possibleConstructorReturn(this, result);};}function QuestL11DesertExplore_possibleConstructorReturn(self, call) {if (call && (QuestL11DesertExplore_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestL11DesertExplore_assertThisInitialized(self);}function QuestL11DesertExplore_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestL11DesertExplore_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestL11DesertExplore_getPrototypeOf(o) {QuestL11DesertExplore_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestL11DesertExplore_getPrototypeOf(o);}function QuestL11DesertExplore_defineProperty(obj, key, value) {key = QuestL11DesertExplore_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11DesertExplore_toPropertyKey(arg) {var key = QuestL11DesertExplore_toPrimitive(arg, "string");return QuestL11DesertExplore_typeof(key) === "symbol" ? key : String(key);}function QuestL11DesertExplore_toPrimitive(input, hint) {if (QuestL11DesertExplore_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11DesertExplore_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}













var QuestL11DesertExplore = /*#__PURE__*/function (_TaskInfo) {QuestL11DesertExplore_inherits(QuestL11DesertExplore, _TaskInfo);var _super = QuestL11DesertExplore_createSuper(QuestL11DesertExplore);function QuestL11DesertExplore() {var _this;QuestL11DesertExplore_classCallCheck(this, QuestL11DesertExplore);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestL11DesertExplore_defineProperty(QuestL11DesertExplore_assertThisInitialized(_this), "hydrated",
    external_kolmafia_.Effect.get("Ultrahydrated"));QuestL11DesertExplore_defineProperty(QuestL11DesertExplore_assertThisInitialized(_this), "oasis",
    external_kolmafia_.Location.get("Oasis"));QuestL11DesertExplore_defineProperty(QuestL11DesertExplore_assertThisInitialized(_this), "desert",
    external_kolmafia_.Location.get("The Arid, Extra-Dry Desert"));QuestL11DesertExplore_defineProperty(QuestL11DesertExplore_assertThisInitialized(_this), "compass",
    external_kolmafia_.Item.get("UV-resistant compass"));QuestL11DesertExplore_defineProperty(QuestL11DesertExplore_assertThisInitialized(_this), "knife",
    external_kolmafia_.Item.get("survival knife"));QuestL11DesertExplore_defineProperty(QuestL11DesertExplore_assertThisInitialized(_this), "toAbsorb", void 0);QuestL11DesertExplore_defineProperty(QuestL11DesertExplore_assertThisInitialized(_this), "camel",

    external_kolmafia_.Familiar.get("Melodramedary"));QuestL11DesertExplore_defineProperty(QuestL11DesertExplore_assertThisInitialized(_this), "ball",
    external_kolmafia_.Item.get("miniature crystal ball"));QuestL11DesertExplore_defineProperty(QuestL11DesertExplore_assertThisInitialized(_this), "page",
    external_kolmafia_.Item.get("worm-riding manual page"));QuestL11DesertExplore_defineProperty(QuestL11DesertExplore_assertThisInitialized(_this), "goose",
    external_kolmafia_.Familiar.get("Grey Goose"));QuestL11DesertExplore_defineProperty(QuestL11DesertExplore_assertThisInitialized(_this), "rose",
    external_kolmafia_.Item.get("Stone Rose"));QuestL11DesertExplore_defineProperty(QuestL11DesertExplore_assertThisInitialized(_this), "nanovision",
    external_kolmafia_.Skill.get("Double Nanovision"));QuestL11DesertExplore_defineProperty(QuestL11DesertExplore_assertThisInitialized(_this), "lefthand",
    external_kolmafia_.Familiar.get("Left-Hand Man"));QuestL11DesertExplore_defineProperty(QuestL11DesertExplore_assertThisInitialized(_this), "extingusherProp",
    "fireExtinguisherDesertUsed");QuestL11DesertExplore_defineProperty(QuestL11DesertExplore_assertThisInitialized(_this), "kramco",
    external_kolmafia_.Item.get("Kramco Sausage-o-Matic&trade;"));QuestL11DesertExplore_defineProperty(QuestL11DesertExplore_assertThisInitialized(_this), "paths",
    []);QuestL11DesertExplore_defineProperty(QuestL11DesertExplore_assertThisInitialized(_this), "curse1",
    external_kolmafia_.Effect.get("Once-Cursed"));QuestL11DesertExplore_defineProperty(QuestL11DesertExplore_assertThisInitialized(_this), "curse2",
    external_kolmafia_.Effect.get("Twice-Cursed"));QuestL11DesertExplore_defineProperty(QuestL11DesertExplore_assertThisInitialized(_this), "curse3",
    external_kolmafia_.Effect.get("Thrice-Cursed"));QuestL11DesertExplore_defineProperty(QuestL11DesertExplore_assertThisInitialized(_this), "blur",
    external_kolmafia_.Monster.get("Blur"));QuestL11DesertExplore_defineProperty(QuestL11DesertExplore_assertThisInitialized(_this), "hooks",
    external_kolmafia_.Item.get("worm-riding hooks"));QuestL11DesertExplore_defineProperty(QuestL11DesertExplore_assertThisInitialized(_this), "stillsuit",
    external_kolmafia_.Item.get("tiny stillsuit"));return _this;}QuestL11DesertExplore_createClass(QuestL11DesertExplore, [{ key: "createPaths", value:

    function createPaths(assumeUnstarted) {
      this.paths = [];
      // Shitty math
      var turnsLeft = (assumeUnstarted ? 100 : this.getExploredRemaining()) / 5;

      var withoutExtingusher = new PossiblePath(turnsLeft);
      this.paths.push(withoutExtingusher);

      if (assumeUnstarted || (0,external_kolmafia_.getProperty)(this.extingusherProp) != "true") {
        var withExtingusher = new PossiblePath(turnsLeft - 3).add(
        ResourceCategory.FIRE_EXTINGUSHER_ZONE);


        this.paths.push(withExtingusher);
      }
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Desert / Explore";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "getGnome", value:

    function getGnome() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("gnasirProgress"));
    } }, { key: "wantsGnomeRose", value:

    function wantsGnomeRose() {
      return (this.getGnome() & 1) != 1;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      if ((0,external_kolmafia_.haveEffect)(this.hydrated) == 0 || this.getExploredRemaining() <= 0) {
        return false;
      }

      if ((0,external_kolmafia_.availableAmount)(this.hooks) > 0) {
        return false;
      }

      if (
      this.toAbsorb.length == 0 &&
      canGreyAdventure(this.oasis) &&
      (0,external_kolmafia_.getProperty)("_gnasirAvailable") == "true" &&
      this.wantsGnomeRose() &&
      (0,external_kolmafia_.availableAmount)(this.rose) == 0 && (
      (0,external_kolmafia_.familiarWeight)(this.goose) >= 6 ||
      GreyAbsorber_AbsorbsProvider.getAbsorbedMonsters().includes(this.blur)))
      {
        return false;
      }

      return true;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Desert");

      if (status < 0) {
        return QuestStatus.NOT_READY;
      }

      if (status > 0) {
        return QuestStatus.COMPLETED;
      }

      if (
      !(0,external_kolmafia_.haveFamiliar)(this.camel) && (0,external_kolmafia_.availableAmount)(this.compass) == 0 ||
      !(0,external_kolmafia_.haveSkill)(this.nanovision))
      {
        return QuestStatus.NOT_READY;
      }

      if (
      (0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("Tenuous Grip on Reality")) ||
      (0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("Barking Dogs")))
      {
        return QuestStatus.NOT_READY;
      }

      if (
      (0,external_kolmafia_.haveEffect)(this.hydrated) == 0 &&
      (0,external_kolmafia_.haveEffect)(this.curse1) +
      (0,external_kolmafia_.haveEffect)(this.curse2) +
      (0,external_kolmafia_.haveEffect)(this.curse3) >
      0)
      {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.haveEffect)(this.hydrated) == 0 && (0,external_kolmafia_.familiarWeight)(this.goose) < 6) {
        return QuestStatus.FASTER_LATER;
      }

      if (
      getQuestStatus("questM20Necklace") < 4 &&
      this.getExplored() > 40 &&
      (0,external_kolmafia_.haveEffect)(this.hydrated) == 0)
      {
        return QuestStatus.FASTER_LATER;
      }

      if ((0,external_kolmafia_.myAdventures)() < 70) {
        //|| !haveEffect(this.hydrated)) {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      var pred = currentPredictions().get(this.desert);
      var fireExtingusherResource =
      (0,external_kolmafia_.toBoolean)((0,external_kolmafia_.getProperty)("_gnasirAvailable")) &&
      (0,external_kolmafia_.familiarWeight)(this.goose) >= 6 ?
      path.getResource(ResourceCategory.FIRE_EXTINGUSHER_ZONE) :
      null;

      if (
      fireExtingusherResource == null && (
      pred == null || !this.toAbsorb.includes(pred)))
      {
        if (
        canGreyAdventure(this.oasis) &&
        (0,external_kolmafia_.haveEffect)(this.hydrated) == 0 &&
        this.getExploredRemaining() > 3)
        {
          return {
            location: this.desert,
            outfit: GreyOutfit.IGNORE_OUTFIT,
            run: function run() {
              greyAdv(_this2.oasis);
            }
          };
        }
      }

      var outfit = new GreyOutfit();
      outfit.addWeight(this.compass); // Compass
      outfit.addWeight(this.knife);

      if (fireExtingusherResource != null) {
        fireExtingusherResource.prepare(outfit);
      }

      if (this.toAbsorb.length > 0) {
        outfit.addIgnored(this.kramco);
      }

      var crystalBall = currentPredictions();
      var fam = (0,external_kolmafia_.haveFamiliar)(this.camel) ? this.camel : null;
      var forceFam = fam != null && this.toAbsorb.length == 0;
      var predictAbsorb = this.toAbsorb.includes(crystalBall.get(this.desert));

      if (fam != null) {
        if (!crystalBall.has(this.desert) || !predictAbsorb) {
          forceFam = true;
        }

        if (this.getExplored() < 10) {
          forceFam = true;
        }
      }

      if (fireExtingusherResource == null && this.toAbsorb.length == 0) {
        outfit.addDelayer(
        DelayCriteria().
        withForcedFights(
        this.getExplored() >= 98 ||
        this.getExplored() >= 8 &&
        !(0,external_kolmafia_.toBoolean)((0,external_kolmafia_.getProperty)("_gnasirAvailable")) ?
        false :
        null).

        withFreeFights(null).
        withAtLeastCombatChance(0.3));

      }

      return {
        outfit: outfit,
        location: this.desert,
        familiar: fam,
        disableFamOverride: forceFam,
        run: function run() {
          var killing = Macro.if_(
          external_kolmafia_.Effect.get("Tenuous Grip on Reality"),
          Macro.attack().repeat()).
          step(greyKillingBlow(outfit));

          // If we're looking for an absorb, have the crystal ball and have the camel and explored is >= 10
          if (
          _this2.toAbsorb.length > 0 &&
          (0,external_kolmafia_.availableAmount)(_this2.ball) > 0 &&
          fam != null)
          {
            // If we have a prediction
            if (crystalBall.has(_this2.desert)) {
              // If we predict an absorb
              if (predictAbsorb) {
                // If we are still doing the first 10 explores
                if (_this2.getExplored() < 10) {
                  // We don't want to wear the ball, we'll do that when we do the absorb
                  if ((0,external_kolmafia_.availableAmount)(_this2.stillsuit) > 0) {
                    (0,external_kolmafia_.cliExecute)("equip " + _this2.stillsuit);
                  } else {
                    (0,external_kolmafia_.equip)(external_kolmafia_.Slot.get("familiar"), external_kolmafia_.Item.none);

                    (0,external_kolmafia_.maximize)("familiar -equip " + _this2.ball, false);
                  }
                } else if (
                (0,external_kolmafia_.equippedAmount)(_this2.ball) == 0 &&
                (0,external_kolmafia_.familiarWeight)(_this2.goose) >= 6)
                {
                  (0,external_kolmafia_.equip)(_this2.ball);
                }
              } else {
                // Force them to wear the ball to change our prediction
                (0,external_kolmafia_.equip)(_this2.ball);
              }
            } else {
              // Force the ball to be worn to make a prediction
              (0,external_kolmafia_.equip)(_this2.ball);
            }
          }

          if (fireExtingusherResource != null) {
            var macro = fireExtingusherResource.macro();

            if ((0,external_kolmafia_.myFamiliar)() == _this2.goose && _this2.toAbsorb.length > 0) {
              macro = Macro.ifNot_(_this2.toAbsorb[0], macro);
            }

            killing = macro.step(killing);
          } else if (_this2.toAbsorb.length == 0) {
            // If the compass is not equipped, and we don't own camel, but we do own left-hand man.
            // Then it's worth it.
            if (
            (0,external_kolmafia_.itemAmount)(_this2.compass) > 0 &&
            (0,external_kolmafia_.equippedAmount)(_this2.compass) == 0 &&
            (0,external_kolmafia_.haveFamiliar)(_this2.lefthand) &&
            (0,external_kolmafia_.myFamiliar)() != _this2.camel)
            {
              (0,external_kolmafia_.useFamiliar)(_this2.lefthand);
              (0,external_kolmafia_.equip)(_this2.compass, external_kolmafia_.Slot.get("familiar"));
            }
          }

          var explored = _this2.getExplored();
          var props = new Properties_PropertyManager();
          props.setChoice(805, 1);

          try {
            greyAdv(
            _this2.desert,
            outfit,
            new AdventureSettings().setFinishingBlowMacro(killing));

          } finally {
            props.resetAll();
          }

          if ((0,external_kolmafia_.getProperty)("lastEncounter") == "A Sietch in Time") {
            (0,external_kolmafia_.visitUrl)("place.php?whichplace=desertbeach", false);
          } else if (explored == _this2.getExplored()) {
            (0,external_kolmafia_.print)("Checking explored..", "blue");
            (0,external_kolmafia_.visitUrl)("place.php?whichplace=desertbeach", false);
          } else if (
          explored >= 10 &&
          ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("gnasirProgress")) & 8) != 8)
          {
            (0,external_kolmafia_.print)("Worm Pages: " + (0,external_kolmafia_.availableAmount)(_this2.page) + " / 15", "blue");
          }
          (0,external_kolmafia_.print)("Desert Explored: " + _this2.getExplored() + " / 100", "blue");
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.desert];
    } }, { key: "getExplored", value:

    function getExplored() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("desertExploration"));
    } }, { key: "getExploredRemaining", value:

    function getExploredRemaining() {
      return 100 - this.getExplored();
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestL11DesertExplore;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/desert/QuestL11DesertGnome.ts
function QuestL11DesertGnome_typeof(obj) {"@babel/helpers - typeof";return QuestL11DesertGnome_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11DesertGnome_typeof(obj);}function QuestL11DesertGnome_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11DesertGnome_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11DesertGnome_toPropertyKey(descriptor.key), descriptor);}}function QuestL11DesertGnome_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11DesertGnome_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11DesertGnome_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11DesertGnome_defineProperty(obj, key, value) {key = QuestL11DesertGnome_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11DesertGnome_toPropertyKey(arg) {var key = QuestL11DesertGnome_toPrimitive(arg, "string");return QuestL11DesertGnome_typeof(key) === "symbol" ? key : String(key);}function QuestL11DesertGnome_toPrimitive(input, hint) {if (QuestL11DesertGnome_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11DesertGnome_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}




var QuestL11DesertGnome = /*#__PURE__*/function () {function QuestL11DesertGnome() {QuestL11DesertGnome_classCallCheck(this, QuestL11DesertGnome);QuestL11DesertGnome_defineProperty(this, "availableProp",
    "_gnasirAvailable");QuestL11DesertGnome_defineProperty(this, "hooks",
    external_kolmafia_.Item.get("worm-riding hooks"));QuestL11DesertGnome_defineProperty(this, "drum",
    external_kolmafia_.Item.get("Drum Machine"));QuestL11DesertGnome_defineProperty(this, "killingJar",
    external_kolmafia_.Item.get("Killing Jar"));QuestL11DesertGnome_defineProperty(this, "rose",
    external_kolmafia_.Item.get("Stone Rose"));}QuestL11DesertGnome_createClass(QuestL11DesertGnome, [{ key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Desert / Gnome";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Desert");

      if (status < 0) {
        return QuestStatus.NOT_READY;
      }

      if (status > 0) {
        return QuestStatus.COMPLETED;
      }

      // Can gnome be turned in
      if (!this.isAvailable()) {
        return QuestStatus.NOT_READY;
      }

      if (this.wantsGnomeKillingJar() && (0,external_kolmafia_.availableAmount)(this.killingJar) > 0) {
        return QuestStatus.READY;
      }

      if (this.wantsGnomePaint() && (0,external_kolmafia_.myMeat)() > 1000) {
        return QuestStatus.READY;
      }

      if (this.wantsGnomeRose() && (0,external_kolmafia_.availableAmount)(this.rose) > 0) {
        return QuestStatus.READY;
      }

      if (this.wantsWormPages() && !this.needsMorePages()) {
        return QuestStatus.READY;
      }

      return QuestStatus.NOT_READY;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return true;
    } }, { key: "free", value:

    function free() {
      return true;
    } }, { key: "run", value:

    function run() {var _this = this;
      if (this.wantsGnomePaint() && (0,external_kolmafia_.myMeat)() >= 1000) {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {
            var paint = external_kolmafia_.Item.get("Can of black paint");

            if ((0,external_kolmafia_.itemAmount)(paint) == 0) {
              (0,external_kolmafia_.retrieveItem)(paint);
            }

            (0,external_kolmafia_.print)("Giving gnome their black paint");
            _this.turnInItem();
          }
        };
      }

      if (this.wantsGnomeKillingJar() && (0,external_kolmafia_.availableAmount)(this.killingJar) > 0) {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {
            (0,external_kolmafia_.print)("Giving gnome their killing jar");

            _this.turnInItem();
          }
        };
      }

      if (this.wantsWormPages() && !this.needsMorePages()) {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {
            (0,external_kolmafia_.print)("Giving gnome their pages");
            _this.turnInItem();
          }
        };
      }

      if (this.wantsGnomeRose() && (0,external_kolmafia_.availableAmount)(this.rose) > 0) {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {
            (0,external_kolmafia_.print)("Giving gnome their rose");
            _this.turnInItem();
          }
        };
      }

      return {
        location: null,
        run: function run() {
          throw "Not sure why we got to this state";
        }
      };
    } }, { key: "turnInItem", value:

    function turnInItem() {
      var gnome = this.getGnome();

      (0,external_kolmafia_.visitUrl)("place.php?whichplace=desertbeach&action=db_gnasir");
      (0,external_kolmafia_.visitUrl)("choice.php?whichchoice=805&option=1&pwd=");
      (0,external_kolmafia_.visitUrl)("choice.php?whichchoice=805&option=2&pwd=");
      (0,external_kolmafia_.visitUrl)("choice.php?whichchoice=805&option=1&pwd=");

      var item = external_kolmafia_.Item.get("desert sightseeing pamphlet");

      if ((0,external_kolmafia_.availableAmount)(item) > 0) {
        (0,external_kolmafia_.use)(item, (0,external_kolmafia_.availableAmount)(item));
      }

      if (gnome == this.getGnome()) {
        throw "Failed to progress gnome";
      }
    } }, { key: "needsMorePages", value:

    function needsMorePages() {
      return (0,external_kolmafia_.itemAmount)(external_kolmafia_.Item.get("Worm-Riding Manual Page")) < 15;
    } }, { key: "isAvailable", value:

    function isAvailable() {
      if ((0,external_kolmafia_.getProperty)("gnasirProgress") != "0") {
        return true;
      }

      if ((0,external_kolmafia_.getProperty)("lastEncounter") == "A Sietch in Time") {
        (0,external_kolmafia_.setProperty)(this.availableProp, "true");
      }

      if ((0,external_kolmafia_.getProperty)(this.availableProp) == "true") {
        return true;
      }

      if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("desertExploration")) <= 10) {
        return false;
      }

      var page = (0,external_kolmafia_.visitUrl)("place.php?whichplace=desertbeach");

      if (!page.includes("place.php?whichplace=desertbeach&action=db_gnasir")) {
        return false;
      }

      (0,external_kolmafia_.setProperty)(this.availableProp, "true");
      return true;
    } }, { key: "getGnome", value:

    function getGnome() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("gnasirProgress"));
    } }, { key: "wantsGnomeRose", value:

    function wantsGnomeRose() {
      return (this.getGnome() & 1) != 1;
    } }, { key: "wantsGnomePaint", value:

    function wantsGnomePaint() {
      return (this.getGnome() & 2) != 2;
    } }, { key: "wantsGnomeKillingJar", value:

    function wantsGnomeKillingJar() {
      return (this.getGnome() & 4) != 4;
    } }, { key: "wantsWormPages", value:

    function wantsWormPages() {
      return (this.getGnome() & 8) != 8;
    } }, { key: "wantsToWormRide", value:

    function wantsToWormRide() {
      return (this.getGnome() & 16) != 16;
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestL11DesertGnome;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/desert/QuestL11DesertStoneRose.ts
function QuestL11DesertStoneRose_typeof(obj) {"@babel/helpers - typeof";return QuestL11DesertStoneRose_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11DesertStoneRose_typeof(obj);}function QuestL11DesertStoneRose_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11DesertStoneRose_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11DesertStoneRose_toPropertyKey(descriptor.key), descriptor);}}function QuestL11DesertStoneRose_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11DesertStoneRose_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11DesertStoneRose_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11DesertStoneRose_defineProperty(obj, key, value) {key = QuestL11DesertStoneRose_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11DesertStoneRose_toPropertyKey(arg) {var key = QuestL11DesertStoneRose_toPrimitive(arg, "string");return QuestL11DesertStoneRose_typeof(key) === "symbol" ? key : String(key);}function QuestL11DesertStoneRose_toPrimitive(input, hint) {if (QuestL11DesertStoneRose_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11DesertStoneRose_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestL11DesertStoneRose = /*#__PURE__*/function () {function QuestL11DesertStoneRose() {QuestL11DesertStoneRose_classCallCheck(this, QuestL11DesertStoneRose);QuestL11DesertStoneRose_defineProperty(this, "hydrated",
    external_kolmafia_.Effect.get("Ultrahydrated"));QuestL11DesertStoneRose_defineProperty(this, "oasis",
    external_kolmafia_.Location.get("Oasis"));QuestL11DesertStoneRose_defineProperty(this, "rose",
    external_kolmafia_.Item.get("Stone Rose"));QuestL11DesertStoneRose_defineProperty(this, "blur",
    external_kolmafia_.Monster.get("Blur"));QuestL11DesertStoneRose_defineProperty(this, "toAbsorb", void 0);QuestL11DesertStoneRose_defineProperty(this, "fam",

    external_kolmafia_.Familiar.get("Grey Goose"));QuestL11DesertStoneRose_defineProperty(this, "swarm",
    external_kolmafia_.Monster.get("Swarm of fire ants"));QuestL11DesertStoneRose_defineProperty(this, "curse1",
    external_kolmafia_.Effect.get("Once-Cursed"));QuestL11DesertStoneRose_defineProperty(this, "curse2",
    external_kolmafia_.Effect.get("Twice-Cursed"));QuestL11DesertStoneRose_defineProperty(this, "curse3",
    external_kolmafia_.Effect.get("Thrice-Cursed"));}QuestL11DesertStoneRose_createClass(QuestL11DesertStoneRose, [{ key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Desert / StoneRose";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Desert");

      if (status > 0) {
        return QuestStatus.COMPLETED;
      }

      if (!this.wantsGnomeRose() || (0,external_kolmafia_.availableAmount)(this.rose) > 0) {
        return QuestStatus.COMPLETED;
      }

      if (
      (0,external_kolmafia_.haveEffect)(this.hydrated) == 0 &&
      (0,external_kolmafia_.haveEffect)(this.curse1) +
      (0,external_kolmafia_.haveEffect)(this.curse2) +
      (0,external_kolmafia_.haveEffect)(this.curse3) >
      0)
      {
        return QuestStatus.NOT_READY;
      }

      if (status < 0 || !canGreyAdventure(this.oasis)) {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.getProperty)("_gnasirAvailable") != "true") {
        return QuestStatus.NOT_READY;
      }

      if (!GreyAbsorber_AbsorbsProvider.getReabsorbedMonsters().includes(this.swarm)) {
        return QuestStatus.NOT_READY;
      }

      if (this.toAbsorb.length > 0) {
        if ((0,external_kolmafia_.familiarWeight)(this.fam) < 6) {
          return QuestStatus.NOT_READY;
        }
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      return {
        location: this.oasis,
        mayFreeRun: true,
        freeRun: function freeRun(monster) {return monster != _this.blur;},
        run: function run() {
          var settings = new AdventureSettings();

          if (!(0,external_kolmafia_.absorbedMonsters)()[_this.blur.name]) {
            settings.addNoBanish(_this.blur);
          }

          greyAdv(_this.oasis, null, settings);
        }
      };
    } }, { key: "getGnome", value:

    function getGnome() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("gnasirProgress"));
    } }, { key: "wantsGnomeRose", value:

    function wantsGnomeRose() {
      return (this.getGnome() & 1) != 1;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.oasis];
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return (0,external_kolmafia_.haveEffect)(this.hydrated) > 0;
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestL11DesertStoneRose;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/desert/QuestL11DesertWormRide.ts
function QuestL11DesertWormRide_typeof(obj) {"@babel/helpers - typeof";return QuestL11DesertWormRide_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11DesertWormRide_typeof(obj);}function QuestL11DesertWormRide_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11DesertWormRide_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11DesertWormRide_toPropertyKey(descriptor.key), descriptor);}}function QuestL11DesertWormRide_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11DesertWormRide_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11DesertWormRide_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11DesertWormRide_defineProperty(obj, key, value) {key = QuestL11DesertWormRide_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11DesertWormRide_toPropertyKey(arg) {var key = QuestL11DesertWormRide_toPrimitive(arg, "string");return QuestL11DesertWormRide_typeof(key) === "symbol" ? key : String(key);}function QuestL11DesertWormRide_toPrimitive(input, hint) {if (QuestL11DesertWormRide_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11DesertWormRide_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestL11DesertWormRide = /*#__PURE__*/function () {function QuestL11DesertWormRide() {QuestL11DesertWormRide_classCallCheck(this, QuestL11DesertWormRide);QuestL11DesertWormRide_defineProperty(this, "hooks",
    external_kolmafia_.Item.get("worm-riding hooks"));QuestL11DesertWormRide_defineProperty(this, "drum",
    external_kolmafia_.Item.get("Drum Machine"));QuestL11DesertWormRide_defineProperty(this, "oasis",
    external_kolmafia_.Location.get("Oasis"));QuestL11DesertWormRide_defineProperty(this, "toAbsorb", void 0);QuestL11DesertWormRide_defineProperty(this, "fam",

    external_kolmafia_.Familiar.get("Grey Goose"));QuestL11DesertWormRide_defineProperty(this, "curse1",
    external_kolmafia_.Effect.get("Once-Cursed"));QuestL11DesertWormRide_defineProperty(this, "curse2",
    external_kolmafia_.Effect.get("Twice-Cursed"));QuestL11DesertWormRide_defineProperty(this, "curse3",
    external_kolmafia_.Effect.get("Thrice-Cursed"));QuestL11DesertWormRide_defineProperty(this, "hydrated",
    external_kolmafia_.Effect.get("Ultrahydrated"));QuestL11DesertWormRide_defineProperty(this, "blur",
    external_kolmafia_.Monster.get("Blur"));}QuestL11DesertWormRide_createClass(QuestL11DesertWormRide, [{ key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Desert / WormRide";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Desert");

      if (status < 0) {
        return QuestStatus.NOT_READY;
      }

      if (status > 0 || !this.wantsToWormRide()) {
        return QuestStatus.COMPLETED;
      }

      if (this.toAbsorb.length > 0 && (0,external_kolmafia_.availableAmount)(this.hooks) == 0) {
        if ((0,external_kolmafia_.familiarWeight)(this.fam) < 6) {
          return QuestStatus.NOT_READY;
        }

        if (status > 0) {
          return QuestStatus.READY;
        }
      }

      if ((0,external_kolmafia_.availableAmount)(this.hooks) == 0) {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.availableAmount)(this.drum) == 0) {
        if (
        (0,external_kolmafia_.haveEffect)(this.hydrated) == 0 &&
        (0,external_kolmafia_.haveEffect)(this.curse1) +
        (0,external_kolmafia_.haveEffect)(this.curse2) +
        (0,external_kolmafia_.haveEffect)(this.curse3) >
        0)
        {
          return QuestStatus.NOT_READY;
        }

        if (this.getExploredRemaining() < 6) {
          return QuestStatus.NOT_READY;
        }
      }

      return QuestStatus.READY;
    } }, { key: "getGnome", value:

    function getGnome() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("gnasirProgress"));
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      var pred = currentPredictions();

      return !pred.has(this.oasis) || pred.get(this.oasis) == this.blur;
    } }, { key: "free", value:

    function free() {
      return (0,external_kolmafia_.availableAmount)(this.drum) > 0 && (0,external_kolmafia_.availableAmount)(this.hooks) > 0;
    } }, { key: "wantsToWormRide", value:

    function wantsToWormRide() {
      return (this.getGnome() & 16) != 16;
    } }, { key: "run", value:

    function run() {var _this = this;
      if ((0,external_kolmafia_.availableAmount)(this.drum) == 0) {
        var outfit = new GreyOutfit();
        outfit.setItemDrops();

        return {
          outfit: outfit,
          location: this.oasis,
          orbs: [this.blur],
          run: function run() {
            greyAdv(_this.oasis, outfit);
          }
        };
      }

      return {
        location: null,
        run: function run() {
          (0,external_kolmafia_.equip)(_this.hooks);
          (0,external_kolmafia_.use)(_this.drum);
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.oasis];
    } }, { key: "getExplored", value:

    function getExplored() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("desertExploration"));
    } }, { key: "getExploredRemaining", value:

    function getExploredRemaining() {
      return 100 - this.getExplored();
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestL11DesertWormRide;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/QuestL11Desert.ts
function QuestL11Desert_typeof(obj) {"@babel/helpers - typeof";return QuestL11Desert_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11Desert_typeof(obj);}function QuestL11Desert_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11Desert_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11Desert_toPropertyKey(descriptor.key), descriptor);}}function QuestL11Desert_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11Desert_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11Desert_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11Desert_defineProperty(obj, key, value) {key = QuestL11Desert_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11Desert_toPropertyKey(arg) {var key = QuestL11Desert_toPrimitive(arg, "string");return QuestL11Desert_typeof(key) === "symbol" ? key : String(key);}function QuestL11Desert_toPrimitive(input, hint) {if (QuestL11Desert_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11Desert_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}








var QuestL11Desert = /*#__PURE__*/function () {


  function QuestL11Desert() {QuestL11Desert_classCallCheck(this, QuestL11Desert);QuestL11Desert_defineProperty(this, "children", []);
    this.children.push(new QuestL11DesertCompass());
    this.children.push(new QuestL11DesertExplore());
    this.children.push(new QuestL11DesertGnome());
    this.children.push(new QuestL11DesertStoneRose());
    this.children.push(new QuestL11DesertWormRide());
  }QuestL11Desert_createClass(QuestL11Desert, [{ key: "getChildren", value:

    function getChildren() {
      return this.children;
    } }, { key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Desert / Parent";
    } }, { key: "level", value:

    function level() {
      return -1;
    } }, { key: "status", value:

    function status() {
      return QuestStatus.COMPLETED;
    } }, { key: "run", value:

    function run() {
      throw new Error("Method not implemented.");
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }]);return QuestL11Desert;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/manor/QuestL11ManorBomb.ts
function QuestL11ManorBomb_typeof(obj) {"@babel/helpers - typeof";return QuestL11ManorBomb_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11ManorBomb_typeof(obj);}function QuestL11ManorBomb_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11ManorBomb_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11ManorBomb_toPropertyKey(descriptor.key), descriptor);}}function QuestL11ManorBomb_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11ManorBomb_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11ManorBomb_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11ManorBomb_defineProperty(obj, key, value) {key = QuestL11ManorBomb_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11ManorBomb_toPropertyKey(arg) {var key = QuestL11ManorBomb_toPrimitive(arg, "string");return QuestL11ManorBomb_typeof(key) === "symbol" ? key : String(key);}function QuestL11ManorBomb_toPrimitive(input, hint) {if (QuestL11ManorBomb_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11ManorBomb_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}





var QuestL11ManorBomb = /*#__PURE__*/function () {function QuestL11ManorBomb() {QuestL11ManorBomb_classCallCheck(this, QuestL11ManorBomb);QuestL11ManorBomb_defineProperty(this, "soda",
    external_kolmafia_.Item.get("blasting soda"));QuestL11ManorBomb_defineProperty(this, "wine",
    external_kolmafia_.Item.get("bottle of Chateau de Vinegar"));QuestL11ManorBomb_defineProperty(this, "unstable",
    external_kolmafia_.Item.get("unstable fulminate"));QuestL11ManorBomb_defineProperty(this, "bomb",
    external_kolmafia_.Item.get("Wine Bomb"));QuestL11ManorBomb_defineProperty(this, "boiler",
    external_kolmafia_.Location.get("The Haunted Boiler Room"));QuestL11ManorBomb_defineProperty(this, "monster",
    external_kolmafia_.Monster.get("Monstrous boiler"));QuestL11ManorBomb_defineProperty(this, "snapper",
    external_kolmafia_.Familiar.get("Red-Nosed Snapper"));}QuestL11ManorBomb_createClass(QuestL11ManorBomb, [{ key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Manor / Bomb";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Manor");

      if (status < 2) {
        return QuestStatus.NOT_READY;
      }

      if (status > 3) {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.availableAmount)(this.bomb) > 0) {
        return QuestStatus.READY;
      }

      if (
      (0,external_kolmafia_.availableAmount)(this.unstable) == 0 && (
      (0,external_kolmafia_.availableAmount)(this.soda) == 0 || (0,external_kolmafia_.availableAmount)(this.wine) == 0))
      {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      if ((0,external_kolmafia_.availableAmount)(this.bomb) > 0) {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {
            (0,external_kolmafia_.visitUrl)("place.php?whichplace=manor4&action=manor4_chamberwall");
          }
        };
      }

      if ((0,external_kolmafia_.availableAmount)(this.unstable) == 0) {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {
            (0,external_kolmafia_.cliExecute)("create Unstable Fulminate");

            if ((0,external_kolmafia_.availableAmount)(_this.unstable) == 0) {
              throw "Expected to have created " + _this.unstable + " but failed";
            }
          }
        };
      }

      var outfit = new GreyOutfit().addWeight(this.unstable);
      outfit.addWeight("ML", 5, null, 81);

      return {
        location: this.boiler,
        outfit: outfit,
        orbs: [this.monster],
        familiar: (0,external_kolmafia_.haveFamiliar)(this.snapper) ? this.snapper : null,
        run: function run() {
          var settings = new AdventureSettings();
          settings.addNoBanish(_this.monster);

          if (
          (0,external_kolmafia_.myFamiliar)() == _this.snapper &&
          (0,external_kolmafia_.getProperty)("redSnapperPhylum") != "construct")
          {
            (0,external_kolmafia_.cliExecute)("snapper construct");
          }

          greyAdv(_this.boiler, outfit, settings);

          if ((0,external_kolmafia_.availableAmount)(_this.bomb) > 0) {
            (0,external_kolmafia_.visitUrl)("place.php?whichplace=manor4&action=manor4_chamberwall");
          }
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.boiler];
    } }]);return QuestL11ManorBomb;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/manor/QuestL11ManorBoss.ts
function QuestL11ManorBoss_typeof(obj) {"@babel/helpers - typeof";return QuestL11ManorBoss_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11ManorBoss_typeof(obj);}function QuestL11ManorBoss_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11ManorBoss_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11ManorBoss_toPropertyKey(descriptor.key), descriptor);}}function QuestL11ManorBoss_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11ManorBoss_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11ManorBoss_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11ManorBoss_defineProperty(obj, key, value) {key = QuestL11ManorBoss_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11ManorBoss_toPropertyKey(arg) {var key = QuestL11ManorBoss_toPrimitive(arg, "string");return QuestL11ManorBoss_typeof(key) === "symbol" ? key : String(key);}function QuestL11ManorBoss_toPrimitive(input, hint) {if (QuestL11ManorBoss_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11ManorBoss_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}





var QuestL11ManorBoss = /*#__PURE__*/function () {function QuestL11ManorBoss() {QuestL11ManorBoss_classCallCheck(this, QuestL11ManorBoss);QuestL11ManorBoss_defineProperty(this, "summoning",
    external_kolmafia_.Location.get("Summoning Chamber"));}QuestL11ManorBoss_createClass(QuestL11ManorBoss, [{ key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Manor / Boss";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Manor");

      if (status < 3) {
        return QuestStatus.NOT_READY;
      }

      if (status > 3) {
        return QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {
      return {
        location: this.summoning,
        run: function run() {
          greyAdv(
          "place.php?whichplace=manor4&action=manor4_chamberboss",
          null,
          new AdventureSettings().setStartOfFightMacro(
          Macro.skill(external_kolmafia_.Skill.get("Infinite Loop"))));


        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }]);return QuestL11ManorBoss;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/manor/QuestL11ManorRecipe.ts
function QuestL11ManorRecipe_typeof(obj) {"@babel/helpers - typeof";return QuestL11ManorRecipe_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11ManorRecipe_typeof(obj);}function QuestL11ManorRecipe_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11ManorRecipe_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11ManorRecipe_toPropertyKey(descriptor.key), descriptor);}}function QuestL11ManorRecipe_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11ManorRecipe_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11ManorRecipe_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11ManorRecipe_defineProperty(obj, key, value) {key = QuestL11ManorRecipe_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11ManorRecipe_toPropertyKey(arg) {var key = QuestL11ManorRecipe_toPrimitive(arg, "string");return QuestL11ManorRecipe_typeof(key) === "symbol" ? key : String(key);}function QuestL11ManorRecipe_toPrimitive(input, hint) {if (QuestL11ManorRecipe_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11ManorRecipe_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}



var QuestL11ManorRecipe = /*#__PURE__*/function () {function QuestL11ManorRecipe() {QuestL11ManorRecipe_classCallCheck(this, QuestL11ManorRecipe);QuestL11ManorRecipe_defineProperty(this, "glasses",
    external_kolmafia_.Item.get("Lord Spookyraven's Spectacles"));}QuestL11ManorRecipe_createClass(QuestL11ManorRecipe, [{ key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Manor / Recipe";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Manor");

      if (status < 1) {
        return QuestStatus.NOT_READY;
      }

      if (status > 1) {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.availableAmount)(this.glasses) == 0) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      return {
        location: null,
        run: function run() {
          (0,external_kolmafia_.equip)(_this.glasses);
          (0,external_kolmafia_.visitUrl)("place.php?whichplace=manor4&action=manor4_chamberwall");
          (0,external_kolmafia_.use)(external_kolmafia_.Item.get("recipe: mortar-dissolving solution"));
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }]);return QuestL11ManorRecipe;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/manor/QuestL11ManorSoda.ts
function QuestL11ManorSoda_typeof(obj) {"@babel/helpers - typeof";return QuestL11ManorSoda_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11ManorSoda_typeof(obj);}function QuestL11ManorSoda_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11ManorSoda_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11ManorSoda_toPropertyKey(descriptor.key), descriptor);}}function QuestL11ManorSoda_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11ManorSoda_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11ManorSoda_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11ManorSoda_defineProperty(obj, key, value) {key = QuestL11ManorSoda_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11ManorSoda_toPropertyKey(arg) {var key = QuestL11ManorSoda_toPrimitive(arg, "string");return QuestL11ManorSoda_typeof(key) === "symbol" ? key : String(key);}function QuestL11ManorSoda_toPrimitive(input, hint) {if (QuestL11ManorSoda_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11ManorSoda_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestL11ManorSoda = /*#__PURE__*/function () {function QuestL11ManorSoda() {QuestL11ManorSoda_classCallCheck(this, QuestL11ManorSoda);QuestL11ManorSoda_defineProperty(this, "soda",
    external_kolmafia_.Item.get("blasting soda"));QuestL11ManorSoda_defineProperty(this, "laundry",
    external_kolmafia_.Location.get("The Haunted Laundry Room"));QuestL11ManorSoda_defineProperty(this, "unstable",
    external_kolmafia_.Item.get("unstable fulminate"));QuestL11ManorSoda_defineProperty(this, "bomb",
    external_kolmafia_.Item.get("Wine Bomb"));QuestL11ManorSoda_defineProperty(this, "monster",
    external_kolmafia_.Monster.get("cabinet of Dr. Limpieza"));}QuestL11ManorSoda_createClass(QuestL11ManorSoda, [{ key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Manor / Soda";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Manor");

      if (status < 2) {
        return QuestStatus.NOT_READY;
      }

      if (
      status > 2 ||
      (0,external_kolmafia_.availableAmount)(this.soda) > 0 ||
      (0,external_kolmafia_.availableAmount)(this.unstable) > 0 ||
      (0,external_kolmafia_.availableAmount)(this.bomb) > 0)
      {
        return QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit().setItemDrops();

      if (
      this.laundry.combatQueue.split("; ").filter(function (s) {return s == _this.monster.name;}).
      length > 1 &&
      currentPredictions().get(this.laundry) == this.monster)
      {
        outfit.setChampagneBottle();
      }

      return {
        location: this.laundry,
        outfit: outfit,
        olfaction: [this.monster],
        run: function run() {
          var settings = new AdventureSettings();
          settings.addNoBanish(_this.monster);

          greyAdv(_this.laundry, outfit, settings);
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.laundry];
    } }]);return QuestL11ManorSoda;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/manor/QuestL11ManorWine.ts
function QuestL11ManorWine_typeof(obj) {"@babel/helpers - typeof";return QuestL11ManorWine_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11ManorWine_typeof(obj);}function QuestL11ManorWine_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11ManorWine_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11ManorWine_toPropertyKey(descriptor.key), descriptor);}}function QuestL11ManorWine_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11ManorWine_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11ManorWine_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11ManorWine_defineProperty(obj, key, value) {key = QuestL11ManorWine_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11ManorWine_toPropertyKey(arg) {var key = QuestL11ManorWine_toPrimitive(arg, "string");return QuestL11ManorWine_typeof(key) === "symbol" ? key : String(key);}function QuestL11ManorWine_toPrimitive(input, hint) {if (QuestL11ManorWine_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11ManorWine_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestL11ManorWine = /*#__PURE__*/function () {function QuestL11ManorWine() {QuestL11ManorWine_classCallCheck(this, QuestL11ManorWine);QuestL11ManorWine_defineProperty(this, "wine",
    external_kolmafia_.Item.get("bottle of Chateau de Vinegar"));QuestL11ManorWine_defineProperty(this, "celler",
    external_kolmafia_.Location.get("The Haunted Wine Cellar"));QuestL11ManorWine_defineProperty(this, "unstable",
    external_kolmafia_.Item.get("unstable fulminate"));QuestL11ManorWine_defineProperty(this, "bomb",
    external_kolmafia_.Item.get("Wine Bomb"));QuestL11ManorWine_defineProperty(this, "monster",
    external_kolmafia_.Monster.get("possessed wine rack"));}QuestL11ManorWine_createClass(QuestL11ManorWine, [{ key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Manor / Wine";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Manor");

      if (status < 2) {
        return QuestStatus.NOT_READY;
      }

      if (
      status > 2 ||
      (0,external_kolmafia_.availableAmount)(this.wine) > 0 ||
      (0,external_kolmafia_.availableAmount)(this.unstable) > 0 ||
      (0,external_kolmafia_.availableAmount)(this.bomb) > 0)
      {
        return QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit().setItemDrops();

      if (
      this.celler.combatQueue.split("; ").filter(function (s) {return s == _this.monster.name;}).
      length > 1 &&
      currentPredictions().get(this.celler) == this.monster)
      {
        outfit.setChampagneBottle();
      }

      return {
        location: this.celler,
        outfit: outfit,
        olfaction: [this.monster],
        run: function run() {
          var settings = new AdventureSettings();
          settings.addNoBanish(_this.monster);

          greyAdv(_this.celler, outfit, settings);
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.celler];
    } }]);return QuestL11ManorWine;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/QuestL11Manor.ts
function QuestL11Manor_typeof(obj) {"@babel/helpers - typeof";return QuestL11Manor_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11Manor_typeof(obj);}function QuestL11Manor_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11Manor_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11Manor_toPropertyKey(descriptor.key), descriptor);}}function QuestL11Manor_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11Manor_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11Manor_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11Manor_defineProperty(obj, key, value) {key = QuestL11Manor_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11Manor_toPropertyKey(arg) {var key = QuestL11Manor_toPrimitive(arg, "string");return QuestL11Manor_typeof(key) === "symbol" ? key : String(key);}function QuestL11Manor_toPrimitive(input, hint) {if (QuestL11Manor_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11Manor_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}













var QuestL11Manor = /*#__PURE__*/function () {



  function QuestL11Manor() {QuestL11Manor_classCallCheck(this, QuestL11Manor);QuestL11Manor_defineProperty(this, "ballroom", external_kolmafia_.Location.get("The Haunted Ballroom"));QuestL11Manor_defineProperty(this, "children", []);
    this.children.push(new QuestL11ManorBomb());
    this.children.push(new QuestL11ManorBoss());
    this.children.push(new QuestL11ManorRecipe());
    this.children.push(new QuestL11ManorSoda());
    this.children.push(new QuestL11ManorWine());
  }QuestL11Manor_createClass(QuestL11Manor, [{ key: "getChildren", value:

    function getChildren() {
      return this.children;
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Manor / Ballroom";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.ballroom];
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Manor");

      if (status < 0 || !canGreyAdventure(this.ballroom)) {
        return QuestStatus.NOT_READY;
      }

      if (status > 0) {
        return QuestStatus.COMPLETED;
      }

      if (!hasNonCombatSkillsReady(false)) {
        return QuestStatus.NOT_READY;
      }

      if (!hasNonCombatSkillsReady()) {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit().setNoCombat();

      return {
        location: this.ballroom,
        outfit: outfit,
        freeRun: function freeRun() {return true;},
        run: function run() {
          var props = new Properties_PropertyManager();

          try {
            props.setChoice(921, 1); // Play da music
            props.setChoice(106, 3);
            props.setChoice(90, 3);
            greyAdv(_this.ballroom, outfit);
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "getStatus", value:

    function getStatus() {
      return ManorStatus[(0,external_kolmafia_.getProperty)("questL11Manor")];
    } }]);return QuestL11Manor;}();var


ManorStatus;(function (ManorStatus) {ManorStatus["unstarted"] = "unstarted";ManorStatus["started"] = "started";ManorStatus["step1"] = "CELLER_OPENED";ManorStatus["step2"] = "RECIPE_ACQUIRED";ManorStatus["step3"] = "WALL_BROKEN";ManorStatus["finished"] = "finished";})(ManorStatus || (ManorStatus = {}));
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/palin/QuestL11PalinStew.ts
function QuestL11PalinStew_typeof(obj) {"@babel/helpers - typeof";return QuestL11PalinStew_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11PalinStew_typeof(obj);}function QuestL11PalinStew_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11PalinStew_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11PalinStew_toPropertyKey(descriptor.key), descriptor);}}function QuestL11PalinStew_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11PalinStew_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11PalinStew_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11PalinStew_defineProperty(obj, key, value) {key = QuestL11PalinStew_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11PalinStew_toPropertyKey(arg) {var key = QuestL11PalinStew_toPrimitive(arg, "string");return QuestL11PalinStew_typeof(key) === "symbol" ? key : String(key);}function QuestL11PalinStew_toPrimitive(input, hint) {if (QuestL11PalinStew_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11PalinStew_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestL11PalinStew = /*#__PURE__*/function () {function QuestL11PalinStew() {QuestL11PalinStew_classCallCheck(this, QuestL11PalinStew);QuestL11PalinStew_defineProperty(this, "wetStew",
    external_kolmafia_.Item.get("Wet Stew"));QuestL11PalinStew_defineProperty(this, "stuntNuts",
    external_kolmafia_.Item.get("Stunt Nuts"));QuestL11PalinStew_defineProperty(this, "talisman",
    external_kolmafia_.Item.get("Talisman o' Namsilat"));QuestL11PalinStew_defineProperty(this, "stuntNutStew",
    external_kolmafia_.Item.get("Wet stunt nut stew"));QuestL11PalinStew_defineProperty(this, "rib",
    external_kolmafia_.Item.get("Bird Rib"));QuestL11PalinStew_defineProperty(this, "lionOil",
    external_kolmafia_.Item.get("lion oil"));QuestL11PalinStew_defineProperty(this, "grove",
    external_kolmafia_.Location.get("Whitey's Grove"));QuestL11PalinStew_defineProperty(this, "lion",
    external_kolmafia_.Monster.get("white lion"));QuestL11PalinStew_defineProperty(this, "snake",
    external_kolmafia_.Monster.get("whitesnake"));}QuestL11PalinStew_createClass(QuestL11PalinStew, [{ key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Palin / WetStew";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Palindome");

      if (status < 3) {
        return QuestStatus.NOT_READY;
      }

      if (status > 4) {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.availableAmount)(this.stuntNuts) == 0) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit().setItemDrops().setPlusCombat();
      var orbs = [];

      if ((0,external_kolmafia_.availableAmount)(this.rib) == 0) {
        orbs.push(this.snake);
      }

      if ((0,external_kolmafia_.availableAmount)(this.lionOil) == 0) {
        orbs.push(this.lion);
      }

      return {
        location: this.grove,
        outfit: outfit,
        orbs: orbs,
        run: function run() {
          var settings = new AdventureSettings();
          settings.addNoBanish(_this.lion);
          settings.addNoBanish(_this.snake);

          var props = new Properties_PropertyManager();
          props.setChoice(73, 3);
          props.setChoice(74, 2);
          props.setChoice(75, 2);

          try {
            greyAdv(_this.grove, outfit, settings);
          } finally {
            props.resetAll();
          }

          if (
          (0,external_kolmafia_.availableAmount)(_this.rib) > 0 &&
          (0,external_kolmafia_.availableAmount)(_this.lionOil) > 0)
          {
            (0,external_kolmafia_.cliExecute)("create " + _this.stuntNutStew.name);
            (0,external_kolmafia_.equip)(_this.talisman);

            (0,external_kolmafia_.visitUrl)("place.php?whichplace=palindome&action=pal_mrlabel");
          }
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.grove];
    } }]);return QuestL11PalinStew;}();
;// CONCATENATED MODULE: ./src/quests/custom/QuestTrapGhost.ts
function QuestTrapGhost_typeof(obj) {"@babel/helpers - typeof";return QuestTrapGhost_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestTrapGhost_typeof(obj);}function QuestTrapGhost_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestTrapGhost_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestTrapGhost_toPropertyKey(descriptor.key), descriptor);}}function QuestTrapGhost_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestTrapGhost_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestTrapGhost_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestTrapGhost_defineProperty(obj, key, value) {key = QuestTrapGhost_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestTrapGhost_toPropertyKey(arg) {var key = QuestTrapGhost_toPrimitive(arg, "string");return QuestTrapGhost_typeof(key) === "symbol" ? key : String(key);}function QuestTrapGhost_toPrimitive(input, hint) {if (QuestTrapGhost_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestTrapGhost_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var QuestTrapGhost = /*#__PURE__*/function () {function QuestTrapGhost() {QuestTrapGhost_classCallCheck(this, QuestTrapGhost);QuestTrapGhost_defineProperty(this, "pack",
    external_kolmafia_.Item.get("protonic accelerator pack"));QuestTrapGhost_defineProperty(this, "sweatpants",
    external_kolmafia_.Item.get("Designer Sweatpants"));QuestTrapGhost_defineProperty(this, "gallery",
    external_kolmafia_.Location.get("The Haunted Gallery"));QuestTrapGhost_defineProperty(this, "icyPeak",
    external_kolmafia_.Location.get("The Icy Peak"));QuestTrapGhost_defineProperty(this, "palindome",
    external_kolmafia_.Location.get("Inside the Palindome"));QuestTrapGhost_defineProperty(this, "smutOrcs",
    external_kolmafia_.Location.get("The Smut Orc Logging Camp"));QuestTrapGhost_defineProperty(this, "spookyForest",
    external_kolmafia_.Location.get("The Spooky Forest"));QuestTrapGhost_defineProperty(this, "talisman",
    external_kolmafia_.Item.get("Talisman o' Namsilat"));QuestTrapGhost_defineProperty(this, "hasColdRes", void 0);QuestTrapGhost_defineProperty(this, "lastColdResCheck", void 0);}QuestTrapGhost_createClass(QuestTrapGhost, [{ key: "getId", value:



    function getId() {
      return "Misc / Ghost Buster";
    } }, { key: "level", value:

    function level() {
      return 3;
    } }, { key: "isReady", value:

    function isReady() {
      return (0,external_kolmafia_.getProperty)("ghostLocation") != "";
    } }, { key: "getLocation", value:

    function getLocation() {
      return external_kolmafia_.Location.get((0,external_kolmafia_.getProperty)("ghostLocation"));
    } }, { key: "isBadLocation", value:

    function isBadLocation() {
      var loc = this.getLocation();

      switch (loc) {
        case this.gallery:
          return getQuestStatus("questM21Dance") <= 1;
        case this.palindome:
          return getQuestStatus("questL11Palindome") <= 1;
        case this.smutOrcs:
          if (getQuestStatus("questL09Topping") > 0) {
            return false;
          }

          var progress = (0,external_kolmafia_.getProperty)("smutOrcNoncombatProgress");

          if (progress == "") {
            return false;
          }

          return (0,external_kolmafia_.toInt)(progress) >= 15;
        case this.spookyForest:
          return (
            (0,external_kolmafia_.myLevel)() >= 6 && (0,external_kolmafia_.getProperty)("questM16Temple") != "finished" ||
            (0,external_kolmafia_.getProperty)("questL02Larva") != "finished");

        case this.icyPeak:
          if (getQuestStatus("questL08Trapper") < 100) {
            return true;
          }

          if (this.lastColdResCheck + 5 >= (0,external_kolmafia_.totalTurnsPlayed)()) {
            return !this.hasColdRes;
          }

          (0,external_kolmafia_.maximize)("cold res 5 min +equip ".concat(
          this.pack.name).concat(
          (0,external_kolmafia_.availableAmount)(this.sweatpants) > 0 ?
          " +equip designer sweatpants" :
          "", " -tie"),

          true);


          var res = (0,external_kolmafia_.numericModifier)("Generated:_spec", "Cold Resistance");
          this.lastColdResCheck = (0,external_kolmafia_.totalTurnsPlayed)();
          this.hasColdRes = res >= 5;

          return !this.hasColdRes;}


      return false;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.availableAmount)(this.pack) == 0) {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.myHp)() < 10) {
        return QuestStatus.NOT_READY;
      }

      if (!this.isReady()) {
        return QuestStatus.NOT_READY;
      }

      if (
      (0,external_kolmafia_.availableAmount)(this.sweatpants) > 0 &&
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("sweat")) < 5)
      {
        return QuestStatus.NOT_READY;
      }

      var loc = this.getLocation();

      if (!canGreyAdventure(loc)) {
        return QuestStatus.NOT_READY;
      }

      if (this.isBadLocation()) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = getGhostBustingOutfit();

      if (this.isReady() && this.getLocation() == this.icyPeak) {
        outfit.addWeight("cold res", 10, 5);
      } else if (this.isReady() && this.getLocation() == this.palindome) {
        outfit.addWeight(this.talisman);
      }

      return {
        outfit: outfit,
        location: null,
        run: function run() {
          greyAdv(
          _this.getLocation(),
          outfit,
          new AdventureSettings().setStartOfFightMacro(getGhostBustingMacro()));

        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "mustBeDone", value:

    function mustBeDone(reallyMustBeDone) {
      return !reallyMustBeDone;
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestTrapGhost;}();


var sweatpants = external_kolmafia_.Item.get("Designer Sweatpants");
var pack = external_kolmafia_.Item.get("protonic accelerator pack");

function getGhostBustingOutfit() {
  var outfit = new GreyOutfit();

  outfit.addWeight(pack);

  if ((0,external_kolmafia_.availableAmount)(sweatpants) > 0) {
    outfit.addWeight(sweatpants);
  } else {
    outfit.addWeight("DA").addWeight("DR");
  }

  return outfit;
}

function isGhostBustingTime(loc) {
  return (
    (0,external_kolmafia_.getProperty)("ghostLocation") != "" &&
    loc == external_kolmafia_.Location.get((0,external_kolmafia_.getProperty)("ghostLocation")));

}

function shouldAvoidGhosts() {
  return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("sweat")) < 5 && (0,external_kolmafia_.availableAmount)(sweatpants) > 0;
}

function getGhostBustingMacro() {
  var macro = new Macro();

  if ((0,external_kolmafia_.availableAmount)(sweatpants) > 0) {
    macro.skill(external_kolmafia_.Skill.get("Sweat Flood"));
  }

  for (var i = 0; i < 3; i++) {
    macro.skill(external_kolmafia_.Skill.get("Shoot Ghost"));
  }

  macro.skill(external_kolmafia_.Skill.get("Trap Ghost"));

  return macro;
}
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/palin/QuestL11PalinBook.ts
function QuestL11PalinBook_typeof(obj) {"@babel/helpers - typeof";return QuestL11PalinBook_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11PalinBook_typeof(obj);}function QuestL11PalinBook_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11PalinBook_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11PalinBook_toPropertyKey(descriptor.key), descriptor);}}function QuestL11PalinBook_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11PalinBook_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11PalinBook_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11PalinBook_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestL11PalinBook_setPrototypeOf(subClass, superClass);}function QuestL11PalinBook_setPrototypeOf(o, p) {QuestL11PalinBook_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestL11PalinBook_setPrototypeOf(o, p);}function QuestL11PalinBook_createSuper(Derived) {var hasNativeReflectConstruct = QuestL11PalinBook_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestL11PalinBook_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestL11PalinBook_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestL11PalinBook_possibleConstructorReturn(this, result);};}function QuestL11PalinBook_possibleConstructorReturn(self, call) {if (call && (QuestL11PalinBook_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestL11PalinBook_assertThisInitialized(self);}function QuestL11PalinBook_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestL11PalinBook_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestL11PalinBook_getPrototypeOf(o) {QuestL11PalinBook_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestL11PalinBook_getPrototypeOf(o);}function QuestL11PalinBook_defineProperty(obj, key, value) {key = QuestL11PalinBook_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11PalinBook_toPropertyKey(arg) {var key = QuestL11PalinBook_toPrimitive(arg, "string");return QuestL11PalinBook_typeof(key) === "symbol" ? key : String(key);}function QuestL11PalinBook_toPrimitive(input, hint) {if (QuestL11PalinBook_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11PalinBook_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}













var QuestL11PalinBook = /*#__PURE__*/function (_TaskInfo) {QuestL11PalinBook_inherits(QuestL11PalinBook, _TaskInfo);var _super = QuestL11PalinBook_createSuper(QuestL11PalinBook);function QuestL11PalinBook() {var _this;QuestL11PalinBook_classCallCheck(this, QuestL11PalinBook);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestL11PalinBook_defineProperty(QuestL11PalinBook_assertThisInitialized(_this), "camera",
    external_kolmafia_.Item.get("Disposable Instant Camera"));QuestL11PalinBook_defineProperty(QuestL11PalinBook_assertThisInitialized(_this), "stuntNuts",
    external_kolmafia_.Item.get("Stunt Nuts"));QuestL11PalinBook_defineProperty(QuestL11PalinBook_assertThisInitialized(_this), "talisman",
    external_kolmafia_.Item.get("Talisman o' Namsilat"));QuestL11PalinBook_defineProperty(QuestL11PalinBook_assertThisInitialized(_this), "loveBook1",
    external_kolmafia_.Item.get('"I Love Me, Vol. I"'));QuestL11PalinBook_defineProperty(QuestL11PalinBook_assertThisInitialized(_this), "loveBook2",
    external_kolmafia_.Item.get('"2 Love Me, Vol. 2"'));QuestL11PalinBook_defineProperty(QuestL11PalinBook_assertThisInitialized(_this), "palindome",
    external_kolmafia_.Location.get("Inside the Palindome"));QuestL11PalinBook_defineProperty(QuestL11PalinBook_assertThisInitialized(_this), "ncPhotos",
    [
    "photograph of an ostrich egg",
    "photograph of a red nugget",
    "photograph of God"].
    map(function (s) {return external_kolmafia_.Item.get(s);}));QuestL11PalinBook_defineProperty(QuestL11PalinBook_assertThisInitialized(_this), "dogPhoto",
    external_kolmafia_.Item.get("photograph of a dog"));QuestL11PalinBook_defineProperty(QuestL11PalinBook_assertThisInitialized(_this), "bobRace",
    external_kolmafia_.Monster.get("Bob Racecar"));QuestL11PalinBook_defineProperty(QuestL11PalinBook_assertThisInitialized(_this), "raceBob",
    external_kolmafia_.Monster.get("Racecar Bob"));QuestL11PalinBook_defineProperty(QuestL11PalinBook_assertThisInitialized(_this), "drab",
    external_kolmafia_.Monster.get("Drab Bard"));QuestL11PalinBook_defineProperty(QuestL11PalinBook_assertThisInitialized(_this), "paths", void 0);QuestL11PalinBook_defineProperty(QuestL11PalinBook_assertThisInitialized(_this), "toAbsorb", void 0);QuestL11PalinBook_defineProperty(QuestL11PalinBook_assertThisInitialized(_this), "humanCandle",


    external_kolmafia_.Item.get("Scent of a Human candle"));QuestL11PalinBook_defineProperty(QuestL11PalinBook_assertThisInitialized(_this), "snapper",
    external_kolmafia_.Familiar.get("Red-Nosed Snapper"));return _this;}QuestL11PalinBook_createClass(QuestL11PalinBook, [{ key: "createPaths", value:

    function createPaths(assumeUnused) {
      this.paths = [new PossiblePath(0).addMeat(1000)];

      if (!assumeUnused && getQuestStatus("questL11Palindome") > 1) {
        return;
      }

      this.paths.push(new PossiblePath(0).add(ResourceCategory.HOT_TUB));
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Palin / Book";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Palindome");

      if (status > 1) {
        return QuestStatus.COMPLETED;
      }

      if (
      isGhostBustingTime(this.palindome) &&
      (0,external_kolmafia_.availableAmount)(this.talisman) > 0 &&
      !shouldAvoidGhosts())
      {
        return QuestStatus.READY;
      }

      if (GreySettings_GreySettings.greySkipPalindome && !this.isFarmDudes()) {
        return QuestStatus.COMPLETED;
      }

      if (
      (0,external_kolmafia_.myMeat)() < 1000 ||
      (0,external_kolmafia_.availableAmount)(this.talisman) == 0 ||
      status < 0 ||
      this.needDogPhoto() && (0,external_kolmafia_.availableAmount)(this.camera) == 0)
      {
        return QuestStatus.NOT_READY;
      }

      if (!hasNonCombatSkillsReady()) {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "needDogPhoto", value:

    function needDogPhoto() {
      return (0,external_kolmafia_.availableAmount)(this.dogPhoto) == 0;
    } }, { key: "isFarmDudes", value:

    function isFarmDudes() {
      return (
        (0,external_kolmafia_.availableAmount)(this.stuntNuts) == 0 ||
        this.needDogPhoto() ||
        this.ncPhotos.filter(function (i) {return (0,external_kolmafia_.availableAmount)(i) == 0;}).length > 0 ||
        (0,external_kolmafia_.availableAmount)(this.loveBook1) == 0);

    } }, { key: "run", value:

    function run(path) {
      // Workaround for some weird bug I had
      if (
      (0,external_kolmafia_.availableAmount)(this.loveBook1) == 0 &&
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("palindomeDudesDefeated")) >= 5)
      {
        (0,external_kolmafia_.cliExecute)("refresh inventory");
      }

      if (this.isFarmDudes()) {
        return this.farmDudes();
      }

      return this.turnInStuff(path);
    } }, { key: "turnInStuff", value:

    function turnInStuff(path) {var _this2 = this;
      return {
        location: null,
        outfit: new GreyOutfit().addWeight(this.talisman),
        run: function run() {
          (0,external_kolmafia_.use)(_this2.loveBook1);
          (0,external_kolmafia_.visitUrl)("place.php?whichplace=palindome&action=pal_drlabel");
          (0,external_kolmafia_.visitUrl)(
          "choice.php?pwd=&whichchoice=872&option=1&photo1=2259&photo2=7264&photo3=7263&photo4=7265");


          if (path.canUse(ResourceCategory.HOT_TUB)) {
            (0,external_kolmafia_.cliExecute)("hottub");
            path.addUsed(ResourceCategory.HOT_TUB);
          } else {
            restoreHPTo(Math.min((0,external_kolmafia_.myMaxhp)(), 120));
          }

          (0,external_kolmafia_.use)(_this2.loveBook2);
          (0,external_kolmafia_.visitUrl)("place.php?whichplace=palindome&action=pal_mroffice");
        }
      };
    } }, { key: "farmDudes", value:

    function farmDudes() {var _this3 = this;
      var outfit = isGhostBustingTime(this.palindome) ?
      getGhostBustingOutfit() :
      new GreyOutfit();

      if ((0,external_kolmafia_.availableAmount)(this.stuntNuts) == 0) {
        outfit.setItemDrops();
      }

      if (this.ncPhotos.filter(function (i) {return (0,external_kolmafia_.availableAmount)(i) == 0;}).length > 0) {
        outfit.setNoCombat();
      }

      var orbs = [];

      if (
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("palindomeDudesDefeated")) <
      5 - this.toAbsorb.length)
      {
        orbs.push(this.drab);
        orbs.push(this.bobRace);
        orbs.push(this.raceBob);
      } else if (this.toAbsorb.length == 0 && this.needDogPhoto()) {
        orbs.push(this.bobRace);
        orbs.push(this.raceBob);
      }

      // No NCs to be hit other than quest so no need to +combat

      outfit.addWeight(this.talisman);

      return {
        outfit: outfit,
        location: isGhostBustingTime(this.palindome) ? null : this.palindome,
        orbs: orbs,
        mayFreeRun: true,
        familiar:
        (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("palindomeDudesDefeated")) < 5 &&
        !isGhostBustingTime(this.palindome) &&
        (0,external_kolmafia_.haveFamiliar)(this.snapper) ?
        this.snapper :
        null,
        freeRun: function freeRun(monster) {return !orbs.includes(monster);},
        run: function run() {
          var macro = null;

          if (isGhostBustingTime(_this3.palindome)) {
            macro = getGhostBustingMacro();
          } else if (_this3.needDogPhoto()) {
            macro = new Macro().
            if_(_this3.bobRace, Macro.tryItem(_this3.camera)).
            if_(_this3.raceBob, Macro.tryItem(_this3.camera));

            if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("palindomeDudesDefeated")) < 5) {
              if (
              (0,external_kolmafia_.availableAmount)(_this3.humanCandle) > 0 &&
              (0,external_kolmafia_.haveEffect)((0,external_kolmafia_.effectModifier)(_this3.humanCandle, "Effect")) <= 0)
              {
                (0,external_kolmafia_.use)(_this3.humanCandle);
              }
            }
          }

          if (
          (0,external_kolmafia_.myFamiliar)() == _this3.snapper &&
          (0,external_kolmafia_.getProperty)("redSnapperPhylum") != "dude")
          {
            (0,external_kolmafia_.cliExecute)("snapper dude");
          }

          var settings = new AdventureSettings().setStartOfFightMacro(macro);
          settings.addBanish(external_kolmafia_.Monster.get("Evil Olive"));
          settings.addBanish(external_kolmafia_.Monster.get("Flock of Stab-bats"));
          settings.addBanish(external_kolmafia_.Monster.get("Taco Cat"));
          settings.addBanish(external_kolmafia_.Monster.get("Tan Gnat"));

          var props = new Properties_PropertyManager();
          props.setChoice(129, 1);
          props.setChoice(873, 1);

          try {
            greyAdv(_this3.palindome, outfit, settings);
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      if (this.isFarmDudes()) {
        return [this.palindome];
      }

      return [];
    } }, { key: "free", value:

    function free() {
      return !this.isFarmDudes();
    } }, { key: "mustBeDone", value:

    function mustBeDone(reallyMustBeDone) {
      if (!this.isFarmDudes()) {
        return true;
      }

      if (reallyMustBeDone) {
        return false;
      }

      return isGhostBustingTime(this.palindome);
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return this.isFarmDudes();
    } }]);return QuestL11PalinBook;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/QuestL11Palindome.ts
function QuestL11Palindome_typeof(obj) {"@babel/helpers - typeof";return QuestL11Palindome_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11Palindome_typeof(obj);}function QuestL11Palindome_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11Palindome_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11Palindome_toPropertyKey(descriptor.key), descriptor);}}function QuestL11Palindome_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11Palindome_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11Palindome_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11Palindome_defineProperty(obj, key, value) {key = QuestL11Palindome_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11Palindome_toPropertyKey(arg) {var key = QuestL11Palindome_toPrimitive(arg, "string");return QuestL11Palindome_typeof(key) === "symbol" ? key : String(key);}function QuestL11Palindome_toPrimitive(input, hint) {if (QuestL11Palindome_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11Palindome_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}








var QuestL11Palin = /*#__PURE__*/function () {




  function QuestL11Palin() {QuestL11Palindome_classCallCheck(this, QuestL11Palin);QuestL11Palindome_defineProperty(this, "megagem", external_kolmafia_.Item.get("Mega Gem"));QuestL11Palindome_defineProperty(this, "talisman", external_kolmafia_.Item.get("Talisman o' Namsilat"));QuestL11Palindome_defineProperty(this, "children", []);
    this.children.push(new QuestL11PalinStew());
    this.children.push(new QuestL11PalinBook());
  }QuestL11Palindome_createClass(QuestL11Palin, [{ key: "getChildren", value:

    function getChildren() {
      return this.children;
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Palin / Boss";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Palindome");

      if (status == 100) {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.availableAmount)(this.megagem) == 0) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {
      var outfit = new GreyOutfit().
      addWeight(this.talisman).
      addWeight(this.megagem);

      return {
        outfit: outfit,
        location: null,
        run: function run() {
          var props = new Properties_PropertyManager();
          props.setChoice(131, 1);

          try {
            greyAdv("place.php?whichplace=palindome&action=pal_drlabel", outfit);
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestL11Palin;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/pyramid/QuestL11PyramidControl.ts
function QuestL11PyramidControl_typeof(obj) {"@babel/helpers - typeof";return QuestL11PyramidControl_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11PyramidControl_typeof(obj);}function QuestL11PyramidControl_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11PyramidControl_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11PyramidControl_toPropertyKey(descriptor.key), descriptor);}}function QuestL11PyramidControl_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11PyramidControl_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11PyramidControl_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11PyramidControl_defineProperty(obj, key, value) {key = QuestL11PyramidControl_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11PyramidControl_toPropertyKey(arg) {var key = QuestL11PyramidControl_toPrimitive(arg, "string");return QuestL11PyramidControl_typeof(key) === "symbol" ? key : String(key);}function QuestL11PyramidControl_toPrimitive(input, hint) {if (QuestL11PyramidControl_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11PyramidControl_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}




var QuestL11PyramidControl = /*#__PURE__*/function () {function QuestL11PyramidControl() {QuestL11PyramidControl_classCallCheck(this, QuestL11PyramidControl);QuestL11PyramidControl_defineProperty(this, "wheel",
    external_kolmafia_.Item.get("Crumbling Wooden Wheel"));QuestL11PyramidControl_defineProperty(this, "ratchet",
    external_kolmafia_.Item.get("Tomb Ratchet"));}QuestL11PyramidControl_createClass(QuestL11PyramidControl, [{ key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Pyramid / Wheel";
    } }, { key: "status", value:

    function status() {
      if (
      (0,external_kolmafia_.getProperty)("lowerChamberUnlock") != "true" ||
      (0,external_kolmafia_.getProperty)("controlRoomUnlock") != "true")
      {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.getProperty)("pyramidBombUsed") == "true") {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.availableAmount)(this.wheel) + (0,external_kolmafia_.availableAmount)(this.ratchet) < 10) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      if ((0,external_kolmafia_.getProperty)("pyramidPosition") != "1") {
        throw "Shouldn't have used any wheels or ratchets yet!";
      }

      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          (0,external_kolmafia_.visitUrl)("place.php?whichplace=pyramid&action=pyramid_control");

          for (var wheel = 1; wheel <= 10; wheel++) {
            if ((0,external_kolmafia_.itemAmount)(_this.wheel) > 0) {
              (0,external_kolmafia_.visitUrl)(
              "choice.php?pwd=&whichchoice=929&option=1&choiceform1=Use+a+wheel+on+the+peg&pwd=" +
              (0,external_kolmafia_.myHash)());

            } else {
              (0,external_kolmafia_.visitUrl)("choice.php?whichchoice=929&option=2&pwd");
            }

            if (wheel == 3 || wheel == 7 || wheel == 10) {
              (0,external_kolmafia_.visitUrl)(
              "choice.php?pwd=&whichchoice=929&option=5&choiceform5=Head+down+to+the+Lower+Chambers+%281%29&pwd=" +
              (0,external_kolmafia_.myHash)());

            }

            if (wheel == 3 || wheel == 7) {
              (0,external_kolmafia_.visitUrl)("place.php?whichplace=pyramid&action=pyramid_control");
            }
          }

          if ((0,external_kolmafia_.getProperty)("pyramidBombUsed") != "true") {
            throw "Bomb should've been used in the pyramid!";
          }
        }
      };
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestL11PyramidControl;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/pyramid/QuestL11PyramidMiddle.ts
function QuestL11PyramidMiddle_typeof(obj) {"@babel/helpers - typeof";return QuestL11PyramidMiddle_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11PyramidMiddle_typeof(obj);}function QuestL11PyramidMiddle_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11PyramidMiddle_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11PyramidMiddle_toPropertyKey(descriptor.key), descriptor);}}function QuestL11PyramidMiddle_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11PyramidMiddle_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11PyramidMiddle_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11PyramidMiddle_defineProperty(obj, key, value) {key = QuestL11PyramidMiddle_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11PyramidMiddle_toPropertyKey(arg) {var key = QuestL11PyramidMiddle_toPrimitive(arg, "string");return QuestL11PyramidMiddle_typeof(key) === "symbol" ? key : String(key);}function QuestL11PyramidMiddle_toPrimitive(input, hint) {if (QuestL11PyramidMiddle_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11PyramidMiddle_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var QuestL11PyramidMiddle = /*#__PURE__*/function () {function QuestL11PyramidMiddle() {QuestL11PyramidMiddle_classCallCheck(this, QuestL11PyramidMiddle);QuestL11PyramidMiddle_defineProperty(this, "ratTangle",
    external_kolmafia_.Item.get("Tangle of rat tails"));QuestL11PyramidMiddle_defineProperty(this, "tombRat",
    external_kolmafia_.Monster.get("Tomb Rat"));QuestL11PyramidMiddle_defineProperty(this, "middleLoc",
    external_kolmafia_.Location.get("The Middle Chamber"));QuestL11PyramidMiddle_defineProperty(this, "wheel",
    external_kolmafia_.Item.get("Crumbling Wooden Wheel"));QuestL11PyramidMiddle_defineProperty(this, "ratchet",
    external_kolmafia_.Item.get("Tomb Ratchet"));QuestL11PyramidMiddle_defineProperty(this, "servant",
    external_kolmafia_.Monster.get("Tomb Servant"));QuestL11PyramidMiddle_defineProperty(this, "toAbsorb", void 0);}QuestL11PyramidMiddle_createClass(QuestL11PyramidMiddle, [{ key: "getId", value:


    function getId() {
      return "Council / MacGruffin / Pyramid / Middle";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.getProperty)("pyramidBombUsed") == "true") {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.getProperty)("middleChamberUnlock") == "false") {
        return QuestStatus.NOT_READY;
      }

      if (
      (0,external_kolmafia_.getProperty)("lowerChamberUnlock") == "true" &&
      (0,external_kolmafia_.getProperty)("controlRoomUnlock") == "true" &&
      this.haveEnough())
      {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.getProperty)("questL03Rat") != "finished") {
        return QuestStatus.NOT_READY;
      }

      if (this.toAbsorb.length == 0 && this.haveEnough()) {
        if (DelayBurners.isDelayBurnerReady()) {
          return QuestStatus.READY;
        }

        if (DelayBurners.isDelayBurnerFeasible()) {
          return QuestStatus.FASTER_LATER;
        }
      }

      return QuestStatus.READY;
    } }, { key: "haveEnough", value:

    function haveEnough() {
      return (0,external_kolmafia_.availableAmount)(this.wheel) + (0,external_kolmafia_.availableAmount)(this.ratchet) >= 10;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();

      if (!this.haveEnough()) {
        outfit.setItemDrops();
      } else if (
      (0,external_kolmafia_.availableAmount)(this.ratTangle) > 0 &&
      this.toAbsorb.length == 0)
      {
        outfit.addDelayer();
      }

      return {
        location: this.middleLoc,
        outfit: outfit,
        orbs: this.haveEnough() ? null : [this.tombRat],
        mayFreeRun: true,
        freeRun: function freeRun(monster) {return _this.haveEnough() || _this.tombRat != monster;},
        run: function run() {
          var settings = new AdventureSettings();

          var startMacro = new Macro();

          if ((0,external_kolmafia_.availableAmount)(_this.ratTangle) > 0) {
            startMacro.if_(_this.tombRat, Macro.item(_this.ratTangle));
          }

          if (DelayBurners.isTryingForDupeableGoblin()) {
            (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Grey Goose"));
          }

          settings.addNoBanish(_this.tombRat);

          settings.setStartOfFightMacro(startMacro);
          greyAdv(_this.middleLoc, outfit, settings);
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.middleLoc];
    } }]);return QuestL11PyramidMiddle;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/pyramid/QuestL11PyramidTop.ts
function QuestL11PyramidTop_typeof(obj) {"@babel/helpers - typeof";return QuestL11PyramidTop_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11PyramidTop_typeof(obj);}function QuestL11PyramidTop_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11PyramidTop_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11PyramidTop_toPropertyKey(descriptor.key), descriptor);}}function QuestL11PyramidTop_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11PyramidTop_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11PyramidTop_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11PyramidTop_defineProperty(obj, key, value) {key = QuestL11PyramidTop_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11PyramidTop_toPropertyKey(arg) {var key = QuestL11PyramidTop_toPrimitive(arg, "string");return QuestL11PyramidTop_typeof(key) === "symbol" ? key : String(key);}function QuestL11PyramidTop_toPrimitive(input, hint) {if (QuestL11PyramidTop_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11PyramidTop_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestL11PyramidTop = /*#__PURE__*/function () {function QuestL11PyramidTop() {QuestL11PyramidTop_classCallCheck(this, QuestL11PyramidTop);QuestL11PyramidTop_defineProperty(this, "topLoc",
    external_kolmafia_.Location.get("The Upper Chamber"));QuestL11PyramidTop_defineProperty(this, "eye",
    external_kolmafia_.Item.get("Eye of Ed"));QuestL11PyramidTop_defineProperty(this, "amulet",
    external_kolmafia_.Item.get("ancient amulet"));QuestL11PyramidTop_defineProperty(this, "headpiece",
    external_kolmafia_.Item.get("headpiece of the Staff of Ed"));QuestL11PyramidTop_defineProperty(this, "staff",
    external_kolmafia_.Item.get("Staff of Fats"));QuestL11PyramidTop_defineProperty(this, "staff2",
    external_kolmafia_.Item.get("[2325]Staff Of Ed"));QuestL11PyramidTop_defineProperty(this, "toAbsorb", void 0);}QuestL11PyramidTop_createClass(QuestL11PyramidTop, [{ key: "getId", value:


    function getId() {
      return "Council / MacGruffin / Pyramid / Top";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Pyramid");

      if (status <= 0 && !this.isUnlockable()) {
        return QuestStatus.NOT_READY;
      }

      if (this.isMiddleUnlocked() || status > 1) {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.getProperty)("questL11Desert") != "finished") {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "isMiddleUnlocked", value:

    function isMiddleUnlocked() {
      return (0,external_kolmafia_.getProperty)("middleChamberUnlock") == "true";
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return (
        this.isUnlockable() &&
        (0,external_kolmafia_.getProperty)("questL11Desert") == "finished" &&
        (0,external_kolmafia_.getProperty)("questL11Pyramid") == "unstarted");

    } }, { key: "free", value:

    function free() {
      return this.mustBeDone();
    } }, { key: "run", value:

    function run() {var _this = this;
      if (this.mustBeDone()) {
        return {
          location: null,
          run: function run() {
            // Unlock
            (0,external_kolmafia_.visitUrl)("place.php?whichplace=desertbeach&action=db_pyramid1");
          }
        };
      }

      var outfit = new GreyOutfit().setNoCombat();

      if (this.toAbsorb.length == 0 && this.topLoc.turnsSpent < 5) {
        outfit.addDelayer(DelayCriteria().withForcedFights(null));
      }

      return {
        location: this.topLoc,
        outfit: outfit,
        freeRun: function freeRun() {return true;},
        run: function run() {
          if (DelayBurners.isTryingForDupeableGoblin()) {
            (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Grey Goose"));
          }

          greyAdv(_this.topLoc, outfit);
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.topLoc];
    } }, { key: "isUnlockable", value:

    function isUnlockable() {
      if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("desertExploration")) < 100) {
        return false;
      }

      if ((0,external_kolmafia_.getProperty)("questL11Palindome") != "finished") {
        return false;
      }

      if ((0,external_kolmafia_.getProperty)("questL11Manor") != "finished") {
        return false;
      }

      if ((0,external_kolmafia_.getProperty)("questL11Worship") != "finished") {
        return false;
      }

      return true;
    } }]);return QuestL11PyramidTop;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/QuestL11Pyramid.ts
function QuestL11Pyramid_typeof(obj) {"@babel/helpers - typeof";return QuestL11Pyramid_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11Pyramid_typeof(obj);}function QuestL11Pyramid_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11Pyramid_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11Pyramid_toPropertyKey(descriptor.key), descriptor);}}function QuestL11Pyramid_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11Pyramid_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11Pyramid_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11Pyramid_defineProperty(obj, key, value) {key = QuestL11Pyramid_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11Pyramid_toPropertyKey(arg) {var key = QuestL11Pyramid_toPrimitive(arg, "string");return QuestL11Pyramid_typeof(key) === "symbol" ? key : String(key);}function QuestL11Pyramid_toPrimitive(input, hint) {if (QuestL11Pyramid_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11Pyramid_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var QuestL11Pyramid = /*#__PURE__*/function () {



  function QuestL11Pyramid() {QuestL11Pyramid_classCallCheck(this, QuestL11Pyramid);QuestL11Pyramid_defineProperty(this, "edUndying", external_kolmafia_.Location.get("The Lower Chambers"));QuestL11Pyramid_defineProperty(this, "children", []);
    this.children.push(new QuestL11PyramidControl());
    this.children.push(new QuestL11PyramidTop());
    this.children.push(new QuestL11PyramidMiddle());
  }QuestL11Pyramid_createClass(QuestL11Pyramid, [{ key: "getChildren", value:

    function getChildren() {
      return this.children;
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Pyramid / EdUndying";
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Pyramid");

      if (status < 3 || (0,external_kolmafia_.getProperty)("pyramidBombUsed") == "false") {
        return QuestStatus.NOT_READY;
      }

      if (status > 3) {
        return QuestStatus.COMPLETED;
      }

      var fam = external_kolmafia_.Familiar.get("Grey Goose");

      if ((0,external_kolmafia_.familiarWeight)(fam) >= 3) {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {
      return {
        location: this.edUndying,
        run: function run() {
          for (var i = 0; i < 7; i++) {
            greyAdv("place.php?whichplace=pyramid&action=pyramid_state1a");
          }

          (0,external_kolmafia_.council)();
        }
      };
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestL11Pyramid;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/ron/QuestL11RonAirship.ts
function QuestL11RonAirship_typeof(obj) {"@babel/helpers - typeof";return QuestL11RonAirship_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11RonAirship_typeof(obj);}function QuestL11RonAirship_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11RonAirship_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11RonAirship_toPropertyKey(descriptor.key), descriptor);}}function QuestL11RonAirship_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11RonAirship_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11RonAirship_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11RonAirship_defineProperty(obj, key, value) {key = QuestL11RonAirship_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11RonAirship_toPropertyKey(arg) {var key = QuestL11RonAirship_toPrimitive(arg, "string");return QuestL11RonAirship_typeof(key) === "symbol" ? key : String(key);}function QuestL11RonAirship_toPrimitive(input, hint) {if (QuestL11RonAirship_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11RonAirship_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var QuestL11RonAirship = /*#__PURE__*/function () {function QuestL11RonAirship() {QuestL11RonAirship_classCallCheck(this, QuestL11RonAirship);QuestL11RonAirship_defineProperty(this, "ticket",
    external_kolmafia_.Item.get("Red Zeppelin Ticket"));QuestL11RonAirship_defineProperty(this, "ron",
    external_kolmafia_.Monster.get('Ron "The Weasel" Copperhead'));QuestL11RonAirship_defineProperty(this, "airship",
    external_kolmafia_.Location.get("The Red Zeppelin"));QuestL11RonAirship_defineProperty(this, "butler",
    external_kolmafia_.Monster.get("Red Butler"));QuestL11RonAirship_defineProperty(this, "skeleton",
    external_kolmafia_.Monster.get("Red Skeleton"));QuestL11RonAirship_defineProperty(this, "buttons",
    external_kolmafia_.Monster.get("Man with the red buttons"));}QuestL11RonAirship_createClass(QuestL11RonAirship, [{ key: "getLocations", value:

    function getLocations() {
      return [this.airship];
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Ron / Zepp";
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Ron");

      if (status < 2) {
        return QuestStatus.NOT_READY;
      }

      if (status > 4) {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.availableAmount)(this.ticket) == 0 && (0,external_kolmafia_.myMeat)() <= 5000) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit().setItemDrops();
      var orbs = [this.skeleton, this.butler, this.buttons];

      return {
        location: this.airship,
        outfit: outfit,
        orbs: orbs,
        olfaction: [this.butler],
        freeRun: function freeRun(monster) {return !orbs.includes(monster);},
        run: function run() {
          if ((0,external_kolmafia_.availableAmount)(_this.ticket) == 0) {
            (0,external_kolmafia_.retrieveItem)(_this.ticket);
          }

          var macro = greyKillingBlow(outfit);

          if (
          (0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("Glark Cable")) > 0 &&
          (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_glarkCableUses")) < 5)
          {
            macro = Macro.if_(_this.ron, macro).
            step(Macro.tryItem(external_kolmafia_.Item.get("Glark Cable"))).
            step(macro);
          }

          var settings = new AdventureSettings();
          settings.setFinishingBlowMacro(macro);
          settings.addNoBanish(external_kolmafia_.Monster.get("Red Skeleton"));
          settings.addNoBanish(external_kolmafia_.Monster.get("Red Butler"));

          greyAdv(_this.airship, outfit, settings);
        }
      };
    } }]);return QuestL11RonAirship;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/ron/QuestL11RonProtesters.ts
function QuestL11RonProtesters_typeof(obj) {"@babel/helpers - typeof";return QuestL11RonProtesters_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11RonProtesters_typeof(obj);}function QuestL11RonProtesters_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestL11RonProtesters_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestL11RonProtesters_toConsumableArray(arr) {return QuestL11RonProtesters_arrayWithoutHoles(arr) || QuestL11RonProtesters_iterableToArray(arr) || QuestL11RonProtesters_unsupportedIterableToArray(arr) || QuestL11RonProtesters_nonIterableSpread();}function QuestL11RonProtesters_nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function QuestL11RonProtesters_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestL11RonProtesters_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestL11RonProtesters_arrayLikeToArray(o, minLen);}function QuestL11RonProtesters_iterableToArray(iter) {if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);}function QuestL11RonProtesters_arrayWithoutHoles(arr) {if (Array.isArray(arr)) return QuestL11RonProtesters_arrayLikeToArray(arr);}function QuestL11RonProtesters_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestL11RonProtesters_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11RonProtesters_toPropertyKey(descriptor.key), descriptor);}}function QuestL11RonProtesters_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11RonProtesters_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11RonProtesters_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11RonProtesters_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11RonProtesters_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestL11RonProtesters_setPrototypeOf(subClass, superClass);}function QuestL11RonProtesters_setPrototypeOf(o, p) {QuestL11RonProtesters_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestL11RonProtesters_setPrototypeOf(o, p);}function QuestL11RonProtesters_createSuper(Derived) {var hasNativeReflectConstruct = QuestL11RonProtesters_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestL11RonProtesters_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestL11RonProtesters_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestL11RonProtesters_possibleConstructorReturn(this, result);};}function QuestL11RonProtesters_possibleConstructorReturn(self, call) {if (call && (QuestL11RonProtesters_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestL11RonProtesters_assertThisInitialized(self);}function QuestL11RonProtesters_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestL11RonProtesters_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestL11RonProtesters_getPrototypeOf(o) {QuestL11RonProtesters_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestL11RonProtesters_getPrototypeOf(o);}function QuestL11RonProtesters_defineProperty(obj, key, value) {key = QuestL11RonProtesters_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11RonProtesters_toPropertyKey(arg) {var key = QuestL11RonProtesters_toPrimitive(arg, "string");return QuestL11RonProtesters_typeof(key) === "symbol" ? key : String(key);}function QuestL11RonProtesters_toPrimitive(input, hint) {if (QuestL11RonProtesters_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11RonProtesters_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}










var


PossiblePathExtra = /*#__PURE__*/function (_PossiblePath) {QuestL11RonProtesters_inherits(PossiblePathExtra, _PossiblePath);var _super = QuestL11RonProtesters_createSuper(PossiblePathExtra);function PossiblePathExtra() {var _this;QuestL11RonProtesters_classCallCheck(this, PossiblePathExtra);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this), "equips",
    []);return _this;}return QuestL11RonProtesters_createClass(PossiblePathExtra);}(PossiblePath);


var QuestL11RonProtesters = /*#__PURE__*/function (_TaskInfo) {QuestL11RonProtesters_inherits(QuestL11RonProtesters, _TaskInfo);var _super2 = QuestL11RonProtesters_createSuper(QuestL11RonProtesters);function QuestL11RonProtesters() {var _this2;QuestL11RonProtesters_classCallCheck(this, QuestL11RonProtesters);for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {args[_key2] = arguments[_key2];}_this2 = _super2.call.apply(_super2, [this].concat(args));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "proLoc",
    external_kolmafia_.Location.get("A Mob Of Zeppelin Protesters"));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "deck",
    external_kolmafia_.Item.get("deck of lewd playing cards"));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "sleazeBook",
    external_kolmafia_.Item.get("Disturbing Fanfic"));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "lyrndHat",
    external_kolmafia_.Item.get("lynyrdskin cap"));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "lyrndPants",
    external_kolmafia_.Item.get("lynyrdskin breeches"));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "lyrndShirt",
    external_kolmafia_.Item.get("lynyrdskin tunic"));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "lyrndCostume",
    [_this2.lyrndHat, _this2.lyrndPants, _this2.lyrndShirt]);QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "musk",
    external_kolmafia_.Item.get("lynyrd musk"));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "cig",
    external_kolmafia_.Item.get("cigarette lighter"));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "cultist",
    external_kolmafia_.Monster.get("Blue Oyster Cultist"));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "flaming",
    external_kolmafia_.Item.get("Flamin' Whatshisname"));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "musky",
    external_kolmafia_.Effect.get("Musky"));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "toAbsorb", void 0);QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "torsoAwareness",

    external_kolmafia_.Skill.get("Torso Awareness"));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "smutSleazeSkill",
    external_kolmafia_.Skill.get("Procgen Ribaldry"));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "sleazeSkill2",
    external_kolmafia_.Skill.get("Innuendo Circuitry"));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "starChart",
    external_kolmafia_.Item.get("Star Chart"));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "sweatpants",
    external_kolmafia_.Item.get("designer sweatpants"));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "spoon",
    external_kolmafia_.Item.get("hewn moon-rune spoon"));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "umbrella",
    external_kolmafia_.Item.get("Unbreakable Umbrella"));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "vipInvitation",

    external_kolmafia_.Item.get("Clan VIP Lounge key"));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "transparentPants",
    external_kolmafia_.Item.get("Transparent pants"));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "parka",
    external_kolmafia_.Item.get("Jurassic Parka"));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "clover",
    external_kolmafia_.Item.get("11-Leaf Clover"));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "lucky",
    external_kolmafia_.Effect.get("Lucky!"));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "paths",
    []);QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "lefthandMan",
    external_kolmafia_.Familiar.get("left-hand man"));QuestL11RonProtesters_defineProperty(QuestL11RonProtesters_assertThisInitialized(_this2), "sleazeEquips",



    [
    _this2.deck,
    (0,external_kolmafia_.availableAmount)(_this2.sweatpants) > 0 ?
    _this2.sweatpants :
    external_kolmafia_.Item.get("Transparent pants"),
    _this2.parka]);return _this2;}QuestL11RonProtesters_createClass(QuestL11RonProtesters, [{ key: "getOutfit", value:


    function getOutfit() {var _this3 = this;
      return this.lyrndCostume.filter(
      function (i) {return i != _this3.lyrndShirt || (0,external_kolmafia_.haveSkill)(_this3.torsoAwareness);});

    } }, { key: "getRelation", value:

    function getRelation(id) {
      if (id == "Council / Peaks / Orcs" && !(0,external_kolmafia_.haveSkill)(this.smutSleazeSkill)) {
        return TaskRelation.WAIT_FOR;
      }

      if (
      id == "Council / Tower / Keys / Star" &&
      !GreySettings_GreySettings.shouldAvoidTowerRequirements() &&
      !(0,external_kolmafia_.haveSkill)(this.sleazeSkill2) &&
      (0,external_kolmafia_.availableAmount)(this.starChart) == 0)
      {
        return TaskRelation.WAIT_FOR;
      }

      return TaskRelation.UNRELATED;
    } }, { key: "createPaths", value:

    function createPaths(assumeUnstarted) {var _this4 = this;
      var paths = [];

      // Combinations of sleaze equips, clover, costume
      var allPossible = [].concat(QuestL11RonProtesters_toConsumableArray(
      this.sleazeEquips.filter(
      function (i) {return (
          (i != _this4.parka || (0,external_kolmafia_.haveSkill)(external_kolmafia_.Skill.get("Torso Awareness"))) && (
          (0,external_kolmafia_.storageAmount)(i) > 0 || (0,external_kolmafia_.availableAmount)(i) > 0));})), QuestL11RonProtesters_toConsumableArray(

      this.lyrndCostume), [
      "Clover",
      "Clover",
      "Clover"]);


      if (!this.willHaveShirt()) {
        allPossible = allPossible.filter(function (i) {return i != _this4.lyrndShirt;});
      }var _iterator = QuestL11RonProtesters_createForOfIteratorHelper(

        getAllCombinations(allPossible)),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var combination = _step.value;
          if (
          (combination.includes(this.sweatpants) ||
          combination.includes(this.transparentPants)) &&
          combination.includes(this.lyrndPants))
          {
            continue;
          }

          if (
          combination.includes(this.lyrndShirt) &&
          combination.includes(this.parka))
          {
            continue;
          }

          var items = combination.filter(
          function (i) {return i instanceof external_kolmafia_.Item;});

          var clovers = combination.filter(function (i) {return i == "Clover";}).length;
          var toPull = items.filter(
          function (i) {return (
              _this4.lyrndCostume.includes(i) ||
              i == _this4.deck ||
              i == _this4.transparentPants);});


          var turns = this.getEstimatedTurns(assumeUnstarted, clovers, items);

          var path = new PossiblePathExtra(turns);

          for (var clover = 0; clover < clovers; clover++) {
            path.add(ResourceCategory.CLOVER);
          }var _iterator2 = QuestL11RonProtesters_createForOfIteratorHelper(

            toPull),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var item = _step2.value;
              if (assumeUnstarted || (0,external_kolmafia_.availableAmount)(item) == 0) {
                path.addPull(item);
              }
            }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}var _iterator3 = QuestL11RonProtesters_createForOfIteratorHelper(

            items),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var _item = _step3.value;
              path.equips.push(_item);
            }} catch (err) {_iterator3.e(err);} finally {_iterator3.f();}

          paths.push(path);
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

      this.paths = paths;
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "getEstimatedTurns", value:

    function getEstimatedTurns(
    assumeUnstarted,
    clovers,
    item)
    {var _this5 = this;
      var estimatedFires = 2;
      var lynyrdScares =
      3 + this.lyrndCostume.filter(function (i) {return item.includes(i);}).length * 5; // Do calcs without musk
      var sleazeScares = item.
      map(function (i) {return (
          i == _this5.sweatpants ?
          (0,external_kolmafia_.availableAmount)(_this5.sweatpants) > 0 ?
          120 :
          0 :
          i == _this5.parka ?
          (0,external_kolmafia_.haveSkill)(_this5.torsoAwareness) ?
          40 :
          0 :
          (0,external_kolmafia_.numericModifier)(i, "Sleaze Damage") +
          (0,external_kolmafia_.numericModifier)(i, "Sleaze Spell Damage"));}).

      reduce(function (p, n) {return p + n;}, 0);

      sleazeScares = Math.floor(Math.pow(sleazeScares, 0.5));
      // Assume we're running -20 so 65% chance of a combat
      var ncModifier = 0;
      // Minus 20 for skills
      ncModifier += 20;
      // Minus 5 if we're not wearing lynrd cap and can wear -5 hat
      if (
      !item.includes(this.lyrndHat) &&
      (0,external_kolmafia_.availableAmount)(this.vipInvitation) > 0)
      {
        ncModifier += 5;
      }
      // Minus 10 if we're not wearing sleaze deck and have umbrella
      if (!item.includes(this.deck) && (0,external_kolmafia_.availableAmount)(this.umbrella) > 0) {
        ncModifier += 10;
      }
      // Cap it
      if (ncModifier > 25) {
        ncModifier = 25 + (ncModifier - 25) / 5;
      }

      var toScare = assumeUnstarted ?
      80 :
      Math.max(0, this.getProtestersRemaining());

      var ncs = [
      function () {return sleazeScares;},
      function () {
        return estimatedFires-- > 0 ? 10 : 3;
      },
      function () {return lynyrdScares;}];

      // 1.5 instead of 1 for bad luck
      var ncEveryXTurns = Math.ceil(1.5 / (1 - (85 - ncModifier) / 100));
      var turnsTaken = 0;

      for (var c = 0; c < clovers; c++) {
        toScare -= Math.max(sleazeScares, lynyrdScares + 3); // 3 cos I assume we have musk
        turnsTaken++;
      }

      var turnsToNC = ncEveryXTurns;
      var nc = 0;
      while (toScare > 0) {
        turnsToNC--;
        turnsTaken++;

        if (turnsToNC <= 0) {
          toScare -= ncs[nc++ % 3]();
          turnsToNC = ncEveryXTurns;
        } else {
          toScare -= 1.1; // Assume cig lighter
        }
      }

      return turnsTaken;
    } }, { key: "isReady", value:

    function isReady() {
      return (
        (0,external_kolmafia_.getProperty)("questL11Ron") == "started" ||
        (0,external_kolmafia_.getProperty)("questL11Ron") == "step1" ||
        (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("zeppelinProtestors")) <= 80);

    } }, { key: "willHaveShirt", value:

    function willHaveShirt() {
      return (
        (0,external_kolmafia_.gnomadsAvailable)() ||
        (0,external_kolmafia_.availableAmount)(this.spoon) > 0 &&
        getMoonZone(GreySettings_GreySettings.greyTuneMoonSpoon) == "Gnomad" &&
        (0,external_kolmafia_.getProperty)("moonTuned") != "true");

    } }, { key: "waitingForShirt", value:

    function waitingForShirt() {
      return !(0,external_kolmafia_.haveSkill)(this.torsoAwareness) && this.willHaveShirt();
    } }, { key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Ron / Crowd";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Ron");

      if (status > 1) {
        return QuestStatus.COMPLETED;
      }

      if (status < 0) {
        return QuestStatus.NOT_READY;
      }

      if (!GreySettings_GreySettings.isHardcoreMode() && this.waitingForShirt()) {
        return QuestStatus.NOT_READY;
      }

      if (
      (0,external_kolmafia_.gnomadsAvailable)() &&
      !(0,external_kolmafia_.haveSkill)(this.torsoAwareness) &&
      !GreySettings_GreySettings.isHardcoreMode())
      {
        return QuestStatus.NOT_READY;
      }

      // If we don't have max flaming boozes
      if (getQuestStatus("questL11Shen") <= 6) {
        return QuestStatus.NOT_READY;
      }

      if (
      !(0,external_kolmafia_.haveSkill)(this.sleazeSkill2) &&
      (0,external_kolmafia_.availableAmount)(this.starChart) == 0 &&
      !GreySettings_GreySettings.shouldAvoidTowerRequirements())
      {

        //   return QuestStatus.NOT_READY;
      }
      if (
      !(0,external_kolmafia_.haveSkill)(this.smutSleazeSkill) &&
      getQuestStatus("questL09Topping") < 1)
      {
        return QuestStatus.NOT_READY;
      }

      if (
      (0,external_kolmafia_.availableAmount)(this.sweatpants) + (0,external_kolmafia_.equippedAmount)(this.sweatpants) > 0 &&
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("sweat")) < 95)
      {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "getLynyrdScares", value:

    function getLynyrdScares() {
      return (
        3 + (
        (0,external_kolmafia_.availableAmount)(this.musk) + (0,external_kolmafia_.haveEffect)(this.musky) > 0 ? 3 : 0) +
        this.getOutfit().filter(function (i) {return (0,external_kolmafia_.availableAmount)(i) > 0;}).length * 5);

    } }, { key: "getSleazeScares", value:

    function getSleazeScares() {
      return Math.floor(
      Math.pow(
      this.sleazeEquips.
      map(function (i) {return (
          (0,external_kolmafia_.availableAmount)(i) == 0 || (0,external_kolmafia_.equippedAmount)(i) > 0 ?
          0 :
          (0,external_kolmafia_.numericModifier)(i, "Sleaze Damage") +
          (0,external_kolmafia_.numericModifier)(i, "Sleaze Spell Damage"));}).

      reduce(
      function (p, n) {return p + n;},
      (0,external_kolmafia_.numericModifier)("Sleaze Damage") +
      (0,external_kolmafia_.numericModifier)("Sleaze Spell Damage")),

      0.5));


    } }, { key: "runClover", value:

    function runClover(path) {var _this6 = this;
      var runSleaze = this.getSleazeScares() >= this.getLynyrdScares();
      var str = runSleaze ?
      "Sleaze Spell Damage +Sleaze Damage" :
      this.getOutfit().
      filter(function (i) {return (0,external_kolmafia_.availableAmount)(i) > 0;}).
      map(function (i) {return "+equip " + i;}).
      join(" ") + (
      (0,external_kolmafia_.haveFamiliar)(this.lefthandMan) ? " +switch left-hand man" : "");
      var outfit = new GreyOutfit(str + " -tie");

      return {
        location: null,
        outfit: outfit,
        familiar: (0,external_kolmafia_.haveFamiliar)(this.lefthandMan) ? this.lefthandMan : null,
        disableFamOverride: (0,external_kolmafia_.haveFamiliar)(this.lefthandMan),
        run: function run() {
          var used = 0;

          while (
          used < path.canUse(ResourceCategory.CLOVER) &&
          _this6.getProtestersRemaining() > 1)
          {
            var props = new Properties_PropertyManager();

            if (runSleaze) {
              props.setChoice(866, 2); // Clover
              props.setChoice(857, 1); // Sleaze
            } else {
              if (!(0,external_kolmafia_.haveEffect)(_this6.musky) && (0,external_kolmafia_.availableAmount)(_this6.musk) > 0) {
                (0,external_kolmafia_.use)(_this6.musk);
              }

              props.setChoice(866, 1); // Clover
              props.setChoice(856, 1); // Scare
            }

            used++;
            (0,external_kolmafia_.use)(_this6.clover);

            if (!(0,external_kolmafia_.haveEffect)(_this6.lucky)) {
              throw "Expected lucky effect";
            }

            try {
              greyAdv(_this6.proLoc, outfit);

              // Dumb workaround
              if ((0,external_kolmafia_.haveEffect)(_this6.lucky)) {
                greyAdv(_this6.proLoc, outfit);
              }
            } finally {
              props.resetAll();
            }

            if ((0,external_kolmafia_.haveEffect)(_this6.lucky)) {
              throw "Expected not to have lucky effect";
            }
          }
        }
      };
    } }, { key: "run", value:

    function run(path) {var _this7 = this;
      if (path.canUse(ResourceCategory.PULL)) {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {var _iterator4 = QuestL11RonProtesters_createForOfIteratorHelper(
              path.pulls.filter(
              function (i) {return (0,external_kolmafia_.availableAmount)(i) == 0;})),_step4;try {for (_iterator4.s(); !(_step4 = _iterator4.n()).done;)
              {var item = _step4.value;
                GreyPulls.tryPull(item);
                path.addUsed(ResourceCategory.PULL);
              }} catch (err) {_iterator4.e(err);} finally {_iterator4.f();}
          }
        };
      }

      if (
      this.getProtestersRemaining() > 1 &&
      path.canUse(ResourceCategory.CLOVER) &&
      this.toAbsorb.length == 0)
      {
        return this.runClover(path);
      }

      // If we can get more than 6
      var lynyrdScares = this.getLynyrdScares();
      // Calculate sleaze scares using our current sleaze stuff, skip equipped items so we can do our baseline
      var sleazeScares = this.getSleazeScares();

      var outfit = new GreyOutfit().setNoCombat().setNoCombat().setItemDrops();
      outfit.addDelayer();

      path.equips.forEach(function (i) {return outfit.addWeight(i);});

      if (sleazeScares * 2 >= lynyrdScares) {
        outfit.addWeight("sleaze dmg", 2).addWeight("sleaze spell dmg", 2);
      }

      var forceMan =
      this.toAbsorb.length == 0 &&
      (0,external_kolmafia_.haveFamiliar)(this.lefthandMan) &&
      (0,external_kolmafia_.availableAmount)(this.umbrella) +
      (0,external_kolmafia_.availableAmount)(this.deck) +
      Math.min(1, (0,external_kolmafia_.availableAmount)(this.sleazeBook)) >=
      2;

      if (forceMan) {
        if ((0,external_kolmafia_.availableAmount)(this.umbrella) > 0) {
          outfit.addWeight(this.umbrella);
        }
      } else if (
      (0,external_kolmafia_.availableAmount)(this.umbrella) > 0 &&
      !path.equips.includes(this.deck))
      {
        outfit.addWeight(this.umbrella);
      }

      // TODO Run left hand man?

      return {
        location: this.proLoc,
        outfit: outfit,
        olfaction: forceMan ? null : [this.cultist],
        mayFreeRun: false,
        familiar: forceMan ? this.lefthandMan : null,
        disableFamOverride: forceMan,
        run: function run() {
          var props = new Properties_PropertyManager();

          try {
            if (
            //    lynyrdScares > 3 &&
            (0,external_kolmafia_.haveEffect)(_this7.musky) <= 0 &&
            (0,external_kolmafia_.availableAmount)(_this7.musk) > 0)
            {
              (0,external_kolmafia_.use)(_this7.musk);
            }

            var doLynrd =
             true || 0;
            var doSleaze =  true || 0;
            var doFire =
             true ||
            0;

            props.setChoice(856, doLynrd ? 1 : 2); // Lynrd
            props.setChoice(857, doSleaze ? 1 : 2); // Bench warrent
            props.setChoice(858, doFire ? 1 : 2);

            var settings = new AdventureSettings();
            settings.setFinishingBlowMacro(
            new Macro().tryItem(_this7.cig).step(greyKillingBlow(outfit)));

            settings.addNoBanish(_this7.cultist);
            settings.addNoBanish(external_kolmafia_.Monster.get("Lynyrd Skinner"));

            greyAdv(_this7.proLoc, outfit, settings);
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "getProtestersRemaining", value:

    function getProtestersRemaining() {
      return 80 - (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("zeppelinProtestors"));
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.proLoc];
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestL11RonProtesters;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/QuestL11Ron.ts
function QuestL11Ron_typeof(obj) {"@babel/helpers - typeof";return QuestL11Ron_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11Ron_typeof(obj);}function QuestL11Ron_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11Ron_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11Ron_toPropertyKey(descriptor.key), descriptor);}}function QuestL11Ron_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11Ron_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11Ron_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11Ron_defineProperty(obj, key, value) {key = QuestL11Ron_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11Ron_toPropertyKey(arg) {var key = QuestL11Ron_toPrimitive(arg, "string");return QuestL11Ron_typeof(key) === "symbol" ? key : String(key);}function QuestL11Ron_toPrimitive(input, hint) {if (QuestL11Ron_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11Ron_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}





var QuestL11Ron = /*#__PURE__*/function () {


  function QuestL11Ron() {QuestL11Ron_classCallCheck(this, QuestL11Ron);QuestL11Ron_defineProperty(this, "children", []);
    this.children.push(new QuestL11RonProtesters());
    this.children.push(new QuestL11RonAirship());
  }QuestL11Ron_createClass(QuestL11Ron, [{ key: "getChildren", value:

    function getChildren() {
      return this.children;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "level", value:

    function level() {
      return -1;
    } }, { key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Ron / Parent";
    } }, { key: "status", value:

    function status() {
      return QuestStatus.COMPLETED;
    } }, { key: "run", value:

    function run() {
      throw new Error("Method not implemented.");
    } }]);return QuestL11Ron;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/shen/QuestL11ShenBats.ts
function QuestL11ShenBats_typeof(obj) {"@babel/helpers - typeof";return QuestL11ShenBats_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11ShenBats_typeof(obj);}function QuestL11ShenBats_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11ShenBats_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11ShenBats_toPropertyKey(descriptor.key), descriptor);}}function QuestL11ShenBats_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11ShenBats_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11ShenBats_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11ShenBats_defineProperty(obj, key, value) {key = QuestL11ShenBats_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11ShenBats_toPropertyKey(arg) {var key = QuestL11ShenBats_toPrimitive(arg, "string");return QuestL11ShenBats_typeof(key) === "symbol" ? key : String(key);}function QuestL11ShenBats_toPrimitive(input, hint) {if (QuestL11ShenBats_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11ShenBats_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}





var QuestL11ShenBats = /*#__PURE__*/function () {function QuestL11ShenBats() {QuestL11ShenBats_classCallCheck(this, QuestL11ShenBats);QuestL11ShenBats_defineProperty(this, "location",
    external_kolmafia_.Location.get("The Batrat and Ratbat Burrow"));}QuestL11ShenBats_createClass(QuestL11ShenBats, [{ key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Shen / Bats";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Shen");

      if (status > 1) {
        return QuestStatus.COMPLETED;
      }

      if (status < 1) {
        return QuestStatus.NOT_READY;
      }

      if (getQuestStatus("questL04Bat") < 1) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();

      if (getQuestStatus("questL04Bat") <= 3) {
        outfit.setItemDrops();
      }

      return {
        location: this.location,
        outfit: outfit,
        freeRun: function freeRun() {return getQuestStatus("questL04Bat") > 3;},
        run: function run() {
          greyAdv(_this.location, outfit);
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.location];
    } }]);return QuestL11ShenBats;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/shen/QuestL11ShenGiants.ts
function QuestL11ShenGiants_typeof(obj) {"@babel/helpers - typeof";return QuestL11ShenGiants_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11ShenGiants_typeof(obj);}function QuestL11ShenGiants_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11ShenGiants_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11ShenGiants_toPropertyKey(descriptor.key), descriptor);}}function QuestL11ShenGiants_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11ShenGiants_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11ShenGiants_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11ShenGiants_defineProperty(obj, key, value) {key = QuestL11ShenGiants_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11ShenGiants_toPropertyKey(arg) {var key = QuestL11ShenGiants_toPrimitive(arg, "string");return QuestL11ShenGiants_typeof(key) === "symbol" ? key : String(key);}function QuestL11ShenGiants_toPrimitive(input, hint) {if (QuestL11ShenGiants_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11ShenGiants_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestL11ShenGiants = /*#__PURE__*/function () {function QuestL11ShenGiants() {QuestL11ShenGiants_classCallCheck(this, QuestL11ShenGiants);QuestL11ShenGiants_defineProperty(this, "modelAirShip",
    external_kolmafia_.Item.get("Model airship"));QuestL11ShenGiants_defineProperty(this, "wig",
    external_kolmafia_.Item.get("Mohawk Wig"));QuestL11ShenGiants_defineProperty(this, "record",
    external_kolmafia_.Item.get("drum 'n' bass 'n' drum 'n' bass record"));QuestL11ShenGiants_defineProperty(this, "rocketToStars",
    external_kolmafia_.Item.get("steam-powered model rocketship"));QuestL11ShenGiants_defineProperty(this, "loc",
    external_kolmafia_.Location.get(
    "The Castle in the Clouds in the Sky (Top Floor)"));QuestL11ShenGiants_defineProperty(this, "steamNC",

    677);QuestL11ShenGiants_defineProperty(this, "raverNC",
    676);QuestL11ShenGiants_defineProperty(this, "punkNC",
    678);QuestL11ShenGiants_defineProperty(this, "gothNC",
    675);}QuestL11ShenGiants_createClass(QuestL11ShenGiants, [{ key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();

      if (
      (0,external_kolmafia_.availableAmount)(this.rocketToStars) == 0 ||
      (0,external_kolmafia_.getProperty)("questL10Garbage") != "finished")
      {
        outfit.setNoCombat();
      }

      if ((0,external_kolmafia_.availableAmount)(this.wig) > 0) {
        outfit.addWeight(this.wig);
      }

      return {
        location: this.loc,
        outfit: outfit,
        freeRun: function freeRun() {return true;},
        run: function run() {
          var props = new Properties_PropertyManager();

          try {
            // Goth and steam love each other
            if ((0,external_kolmafia_.availableAmount)(_this.modelAirShip) > 0) {
              props.setChoice(_this.steamNC, 1); // Use model ship
              props.setChoice(_this.gothNC, 4); // Crawl to copper
            } else if ((0,external_kolmafia_.availableAmount)(_this.record) > 0) {
              // We have the record, lets end this.
              props.setChoice(_this.steamNC, 4); // Crawl to goth
              props.setChoice(_this.gothNC, 2); // Grab record
            } else if ((0,external_kolmafia_.availableAmount)(_this.rocketToStars) == 0) {
              // We don't have airship or record, to avoid fighting lets just grab the rocket if we can
              props.setChoice(_this.steamNC, 2); // Grab rocket
              props.setChoice(_this.gothNC, 4); // Crawl to steam
            } else {
              // This adv is a waste, just fight.
              props.setChoice(_this.steamNC, 1); // Fight steam
              props.setChoice(_this.gothNC, 1); // Fight goth
            }

            // Punk and raver love each other
            if ((0,external_kolmafia_.equippedAmount)(_this.wig) > 0) {
              // If we can end this with the wig
              props.setChoice(_this.punkNC, 1); // Use wig
              props.setChoice(_this.raverNC, 4); // Crawl to punk rock
            } else if ((0,external_kolmafia_.availableAmount)(_this.record) == 0) {
              // If we can grab a record
              props.setChoice(_this.punkNC, 4); // Crawl to raver
              props.setChoice(_this.raverNC, 3); // Grab record
            } else {
              // We're going to waste an adventure
              props.setChoice(_this.punkNC, 4); // Crawl to raver
              props.setChoice(_this.raverNC, 1); // Fight the raver for their advs
            }

            props.setChoice(679, 1); // Turn dat wheel

            greyAdv(_this.loc, outfit);

            if ((0,external_kolmafia_.lastChoice)() == 679) {
              (0,external_kolmafia_.council)();
            }
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Shen / Giants";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Shen");

      if (status > 5) {
        return QuestStatus.COMPLETED;
      }

      if (status < 5) {
        return QuestStatus.NOT_READY;
      }

      if (getQuestStatus("questL10Garbage") < 9) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }]);return QuestL11ShenGiants;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/shen/QuestL11ShenNinja.ts
function QuestL11ShenNinja_typeof(obj) {"@babel/helpers - typeof";return QuestL11ShenNinja_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11ShenNinja_typeof(obj);}function QuestL11ShenNinja_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11ShenNinja_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11ShenNinja_toPropertyKey(descriptor.key), descriptor);}}function QuestL11ShenNinja_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11ShenNinja_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11ShenNinja_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11ShenNinja_defineProperty(obj, key, value) {key = QuestL11ShenNinja_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11ShenNinja_toPropertyKey(arg) {var key = QuestL11ShenNinja_toPrimitive(arg, "string");return QuestL11ShenNinja_typeof(key) === "symbol" ? key : String(key);}function QuestL11ShenNinja_toPrimitive(input, hint) {if (QuestL11ShenNinja_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11ShenNinja_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestL11ShenNinja = /*#__PURE__*/function () {function QuestL11ShenNinja() {QuestL11ShenNinja_classCallCheck(this, QuestL11ShenNinja);QuestL11ShenNinja_defineProperty(this, "location",
    external_kolmafia_.Location.get("Lair of the Ninja Snowmen"));QuestL11ShenNinja_defineProperty(this, "assassin",

    external_kolmafia_.Monster.get("Ninja Snowman Assassin"));}QuestL11ShenNinja_createClass(QuestL11ShenNinja, [{ key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Shen / Ninjas";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Shen");

      if (status > 3) {
        return QuestStatus.COMPLETED;
      }

      if (status < 3) {
        return QuestStatus.NOT_READY;
      }

      if (getQuestStatus("questL08Trapper") < 2) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();

      if (getQuestStatus("questL08Trapper") <= 2) {
        outfit.setPlusCombat();
      }

      outfit.addDelayer(DelayCriteria().withForcedFights(null));

      return {
        location: this.location,
        outfit: outfit,
        freeRun: function freeRun(monster) {return monster != _this.assassin;},
        run: function run() {
          if (DelayBurners.isTryingForDupeableGoblin()) {
            (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Grey Goose"));
          }

          greyAdv(_this.location, outfit);
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.location];
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return getQuestStatus("questL08Trapper") > 2;
    } }]);return QuestL11ShenNinja;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/shen/QuestL11ShenTurnIn.ts
function QuestL11ShenTurnIn_typeof(obj) {"@babel/helpers - typeof";return QuestL11ShenTurnIn_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11ShenTurnIn_typeof(obj);}function QuestL11ShenTurnIn_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestL11ShenTurnIn_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestL11ShenTurnIn_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestL11ShenTurnIn_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestL11ShenTurnIn_arrayLikeToArray(o, minLen);}function QuestL11ShenTurnIn_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestL11ShenTurnIn_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11ShenTurnIn_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11ShenTurnIn_toPropertyKey(descriptor.key), descriptor);}}function QuestL11ShenTurnIn_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11ShenTurnIn_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11ShenTurnIn_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11ShenTurnIn_defineProperty(obj, key, value) {key = QuestL11ShenTurnIn_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11ShenTurnIn_toPropertyKey(arg) {var key = QuestL11ShenTurnIn_toPrimitive(arg, "string");return QuestL11ShenTurnIn_typeof(key) === "symbol" ? key : String(key);}function QuestL11ShenTurnIn_toPrimitive(input, hint) {if (QuestL11ShenTurnIn_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11ShenTurnIn_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}








var QuestL11ShenTurnIn = /*#__PURE__*/function () {function QuestL11ShenTurnIn() {QuestL11ShenTurnIn_classCallCheck(this, QuestL11ShenTurnIn);QuestL11ShenTurnIn_defineProperty(this, "disguise",
    external_kolmafia_.Item.get("Crappy Waiter Disguise"));QuestL11ShenTurnIn_defineProperty(this, "shenClub",
    external_kolmafia_.Location.get("The Copperhead Club"));QuestL11ShenTurnIn_defineProperty(this, "crappy",
    external_kolmafia_.Effect.get("Crappily Disguised as a Waiter"));QuestL11ShenTurnIn_defineProperty(this, "crappyDisguises",
    [
    "Waiter dressed as a ninja",
    "Ninja dressed as a waiter"].
    map(function (s) {return external_kolmafia_.Monster.get(s);}));QuestL11ShenTurnIn_defineProperty(this, "toAbsorb", void 0);QuestL11ShenTurnIn_defineProperty(this, "nanovision",

    external_kolmafia_.Skill.get("Double Nanovision"));QuestL11ShenTurnIn_defineProperty(this, "cocktail",
    external_kolmafia_.Item.get("Unnamed cocktail"));QuestL11ShenTurnIn_defineProperty(this, "penguin",
    external_kolmafia_.Monster.get("Mob Penguin Capo"));QuestL11ShenTurnIn_defineProperty(this, "robor",
    external_kolmafia_.Familiar.get("Robortender"));QuestL11ShenTurnIn_defineProperty(this, "ball",
    external_kolmafia_.Item.get("miniature crystal ball"));QuestL11ShenTurnIn_defineProperty(this, "snapper",
    external_kolmafia_.Familiar.get("Red-Nosed Snapper"));}QuestL11ShenTurnIn_createClass(QuestL11ShenTurnIn, [{ key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Shen / TurnIn";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return this.haveEffect();
    } }, { key: "free", value:

    function free() {
      return this.haveEffect();
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Shen");

      if (status > 6) {
        return QuestStatus.COMPLETED;
      }

      if (
      currentPredictions().get(this.shenClub) == this.penguin && (
      this.toAbsorb.includes(this.penguin) || (0,external_kolmafia_.haveFamiliar)(this.robor)))
      {
        return QuestStatus.READY;
      }

      if (status < 2) {
        return QuestStatus.NOT_READY;
      }

      if (status % 2 == 1) {
        return QuestStatus.NOT_READY;
      }

      if (!(0,external_kolmafia_.haveSkill)(this.nanovision)) {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "needToDeliver", value:

    function needToDeliver() {
      var prop = (0,external_kolmafia_.getProperty)("questL11Shen");

      return prop == "step2" || prop == "step4" || prop == "step6";
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();

      /*  if (
        getProperty("copperheadClubHazard") != "lantern" ||
        availableAmount(this.cocktail) < 2
      )*/{
        outfit.setItemDrops();
      }

      var fishHuntTime =
      (0,external_kolmafia_.haveFamiliar)(this.robor) &&
      !(0,external_kolmafia_.isBanished)(this.penguin) &&
      this.toAbsorb.length == 0;
      var roboTime =
      fishHuntTime && currentPredictions().get(this.shenClub) == this.penguin;
      var snapperTime =
      (fishHuntTime && !roboTime ||
      currentPredictions().get(this.shenClub) != this.penguin &&
      this.toAbsorb.includes(this.penguin)) &&
      (0,external_kolmafia_.haveFamiliar)(this.snapper) &&
      (0,external_kolmafia_.availableAmount)(this.ball) > 0;

      if (
      this.toAbsorb.length == 0 &&
      currentPredictions().get(this.shenClub) != this.penguin)
      {
        outfit.addDelayer();
      }

      return {
        location: this.shenClub,
        outfit: outfit,
        familiar: snapperTime ? this.snapper : roboTime ? this.robor : null,
        olfaction: (0,external_kolmafia_.haveFamiliar)(this.robor) ? [this.penguin] : null,
        mayFreeRun: false,
        run: function run() {
          if (!_this.hittingNC()) {
            if (!_this.haveEffect() && (0,external_kolmafia_.availableAmount)(_this.disguise) > 0) {
              (0,external_kolmafia_.use)(_this.disguise);
            }
          }

          if (
          !roboTime &&
          _this.toAbsorb.length == 0 &&
          DelayBurners.isTryingForDupeableGoblin())
          {
            (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Grey Goose"));
          }

          if (
          (0,external_kolmafia_.myFamiliar)() == _this.snapper &&
          (0,external_kolmafia_.getProperty)("redSnapperPhylum") != "penguin")
          {
            (0,external_kolmafia_.cliExecute)("snapper penguin");
          }

          var props = new Properties_PropertyManager();

          try {
            if ((0,external_kolmafia_.getProperty)("copperheadClubHazard") != "lantern") {
              props.setChoice(855, 3); // Light lanterns on fire
            } else {
              props.setChoice(855, 4); // Get unnamed cocktails
            }

            props.setChoice(1074, 1); // Approach table
            props.setChoice(851, 1); // Sip poison
            props.setChoice(852, 1); // Sip poison
            props.setChoice(853, 1); // Sip poison
            props.setChoice(854, 1); // Sip poison

            var settings = new AdventureSettings();var _iterator = QuestL11ShenTurnIn_createForOfIteratorHelper(

              _this.crappyDisguises),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var m = _step.value;
                settings.addNoBanish(m);
              }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

            if ((0,external_kolmafia_.haveFamiliar)(_this.robor)) {
              settings.addNoBanish(_this.penguin);
            }

            greyAdv(_this.shenClub, outfit, settings);

            if (_this.haveEffect()) {
              (0,external_kolmafia_.refreshStatus)();

              if (_this.haveEffect()) {
                greyAdv(_this.shenClub, outfit, settings);
              }
            }
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "hittingNC", value:

    function hittingNC() {
      var turnsSpent = this.shenClub.turnsSpent;
      var nextMeeting = Math.floor(getQuestStatus("questL11Shen") / 2) * 5;

      return turnsSpent > nextMeeting - 1;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.shenClub];
    } }, { key: "haveEffect", value:

    function haveEffect() {
      return (0,external_kolmafia_.haveEffect)(this.crappy) > 0;
    } }]);return QuestL11ShenTurnIn;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/QuestL11Shen.ts
function QuestL11Shen_typeof(obj) {"@babel/helpers - typeof";return QuestL11Shen_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11Shen_typeof(obj);}function QuestL11Shen_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11Shen_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11Shen_toPropertyKey(descriptor.key), descriptor);}}function QuestL11Shen_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11Shen_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11Shen_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11Shen_defineProperty(obj, key, value) {key = QuestL11Shen_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11Shen_toPropertyKey(arg) {var key = QuestL11Shen_toPrimitive(arg, "string");return QuestL11Shen_typeof(key) === "symbol" ? key : String(key);}function QuestL11Shen_toPrimitive(input, hint) {if (QuestL11Shen_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11Shen_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}










var QuestL11Shen = /*#__PURE__*/function () {








  function QuestL11Shen() {QuestL11Shen_classCallCheck(this, QuestL11Shen);QuestL11Shen_defineProperty(this, "shenClub", external_kolmafia_.Location.get("The Copperhead Club"));QuestL11Shen_defineProperty(this, "shenItems", new Map());QuestL11Shen_defineProperty(this, "children", []);
    this.children.push(new QuestL11ShenTurnIn());
    this.children.push(new QuestL11ShenGiants());
    this.children.push(new QuestL11ShenNinja());
    this.children.push(new QuestL11ShenBats());
  }QuestL11Shen_createClass(QuestL11Shen, [{ key: "getLocations", value: function getLocations() {return [];} }, { key: "getChildren", value:

    function getChildren() {
      return this.children;
    } }, { key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Shen / Meet";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Shen");

      if (status > 0) {
        return QuestStatus.COMPLETED;
      }

      if (status < 0) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          var props = new Properties_PropertyManager();
          props.setChoice(1074, 1); // Approach table
          props.setChoice(851, 1);

          try {
            greyAdv(_this.shenClub);
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return true;
    } }, { key: "free", value:

    function free() {
      return true;
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestL11Shen;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/hiddencity/shrines/QuestL11TempleBowling.ts
function QuestL11TempleBowling_typeof(obj) {"@babel/helpers - typeof";return QuestL11TempleBowling_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11TempleBowling_typeof(obj);}function QuestL11TempleBowling_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11TempleBowling_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11TempleBowling_toPropertyKey(descriptor.key), descriptor);}}function QuestL11TempleBowling_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11TempleBowling_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11TempleBowling_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11TempleBowling_defineProperty(obj, key, value) {key = QuestL11TempleBowling_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11TempleBowling_toPropertyKey(arg) {var key = QuestL11TempleBowling_toPrimitive(arg, "string");return QuestL11TempleBowling_typeof(key) === "symbol" ? key : String(key);}function QuestL11TempleBowling_toPrimitive(input, hint) {if (QuestL11TempleBowling_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11TempleBowling_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var QuestL11Bowling = /*#__PURE__*/function () {function QuestL11Bowling() {QuestL11TempleBowling_classCallCheck(this, QuestL11Bowling);QuestL11TempleBowling_defineProperty(this, "bowl",
    external_kolmafia_.Item.get("Bowl of Scorpions"));QuestL11TempleBowling_defineProperty(this, "loc",
    external_kolmafia_.Location.get("The Hidden Bowling Alley"));QuestL11TempleBowling_defineProperty(this, "bowlingBall",
    external_kolmafia_.Item.get("Bowling Ball"));QuestL11TempleBowling_defineProperty(this, "cosmicBall",
    external_kolmafia_.Item.get("Cosmic Bowling Ball"));QuestL11TempleBowling_defineProperty(this, "goose",
    external_kolmafia_.Familiar.get("Grey Goose"));QuestL11TempleBowling_defineProperty(this, "cosmicBowled",
    "_greyCosmicBowled");QuestL11TempleBowling_defineProperty(this, "nanovision",
    external_kolmafia_.Skill.get("Double Nanovision"));QuestL11TempleBowling_defineProperty(this, "drunk",
    external_kolmafia_.Monster.get("Drunk pygmy"));QuestL11TempleBowling_defineProperty(this, "book",
    external_kolmafia_.Item.get("Book of matches"));QuestL11TempleBowling_defineProperty(this, "bowler",
    external_kolmafia_.Monster.get("Pygmy Bowler"));QuestL11TempleBowling_defineProperty(this, "sweep",
    external_kolmafia_.Skill.get("System Sweep"));QuestL11TempleBowling_defineProperty(this, "toAbsorb", void 0);}QuestL11TempleBowling_createClass(QuestL11Bowling, [{ key: "hasCosmicBowled", value:


    function hasCosmicBowled() {
      return (0,external_kolmafia_.getProperty)(this.cosmicBowled) == "true";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "ownCosmicBall", value:

    function ownCosmicBall() {
      return (0,external_kolmafia_.getProperty)("hasCosmicBowlingBall") == "true";
    } }, { key: "getId", value:

    function getId() {
      return "Council / MacGruffin / HiddenCity / Bowling";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }, { key: "getProgress", value:

    function getProgress() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("hiddenBowlingAlleyProgress"));
    } }, { key: "isCosmicBallNextCombat", value:

    function isCosmicBallNextCombat() {
      return (
        (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("cosmicBowlingBallReturnCombats")) <= 0 ||
        (0,external_kolmafia_.availableAmount)(this.cosmicBall) > 0);

    } }, { key: "mustBeDone", value:

    function mustBeDone(insists) {
      if (insists) {
        return false;
      }

      if (this.toAbsorb.length > 0 && (0,external_kolmafia_.familiarWeight)(this.goose) < 6) {
        return false;
      }

      if (!this.ownCosmicBall()) {
        return false;
      }

      if ((0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("Ultrahydrated"))) {
        return false;
      }

      if (this.status() != QuestStatus.READY) {
        return false;
      }

      if (this.getProgress() != 1 || !this.isCosmicBallNextCombat()) {
        return false;
      }

      return true;
    } }, { key: "status", value:

    function status() {
      var status = (0,external_kolmafia_.getProperty)("questL11Spare");

      if (status == "finished") {
        return QuestStatus.COMPLETED;
      }

      if (status == "unstarted") {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.getProperty)("questL11Worship") != "step3") {
        return QuestStatus.NOT_READY;
      }

      if (!this.barUnlocked() && (0,external_kolmafia_.haveSkill)(this.nanovision)) {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.availableAmount)(this.bowlingBall) > 0) {
        return QuestStatus.READY;
      }

      // If we don't have nanovision yet
      if (!(0,external_kolmafia_.haveSkill)(this.nanovision) && !(0,external_kolmafia_.isBanished)(this.drunk)) {
        return QuestStatus.READY;
      }

      // If we have the cosmic ball, but have not bowled yet. Lets delay this until we can definitely score some progress.
      if (
      this.ownCosmicBall() &&
      !this.hasCosmicBowled() &&
      this.getProgress() <= 3 &&
      !this.isCosmicBallNextCombat())
      {
        return QuestStatus.NOT_READY;
      }

      // If we can't skip a drunk, faster later
      if ((0,external_kolmafia_.myMeat)() < 1000 && (0,external_kolmafia_.availableAmount)(this.bowl) == 0) {
        return QuestStatus.FASTER_LATER;
      }

      if (this.getProgress() > 6) {
        throw "Shouldn't be at this point for bowling. Did we cosmic ball late?";
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();

      if (this.getProgress() >= 5 && (0,external_kolmafia_.availableAmount)(this.bowlingBall) > 0) {
        outfit.addWeight("elemental dmg", 1, null, 0.1);
      } else {
        outfit.setItemDrops();
      }

      var orbs = [];

      var cosmicBall =
      !this.hasCosmicBowled() &&
      this.ownCosmicBall() &&
      this.isCosmicBallNextCombat();
      var bowlingBall = !cosmicBall && (0,external_kolmafia_.closetAmount)(this.bowlingBall) > 0;

      if (!(0,external_kolmafia_.haveSkill)(this.sweep)) {
        orbs.push(this.drunk);
      }

      // Banishers
      return {
        location: this.loc,
        outfit: outfit,
        orbs: orbs,
        olfaction: [this.bowler],
        freeRun: function freeRun() {return true;},
        run: function run() {
          var macro = null;
          var couldBeBowling = false;

          if (cosmicBall) {
            macro = new Macro().item(_this.cosmicBall);
            couldBeBowling = true;

            if ((0,external_kolmafia_.itemAmount)(_this.bowlingBall) > 0) {
              (0,external_kolmafia_.putCloset)(_this.bowlingBall, (0,external_kolmafia_.availableAmount)(_this.bowlingBall));
            }
          } else if (bowlingBall) {
            (0,external_kolmafia_.takeCloset)(_this.bowlingBall, (0,external_kolmafia_.closetAmount)(_this.bowlingBall));
          }

          if ((0,external_kolmafia_.availableAmount)(_this.book) > 0 && !_this.barUnlocked()) {
            (0,external_kolmafia_.use)(_this.book);
          }

          if ((0,external_kolmafia_.itemAmount)(_this.bowlingBall) == 0 && _this.barUnlocked()) {
            (0,external_kolmafia_.retrieveItem)(_this.bowl);
          }

          var progressPrior = _this.getProgress();

          var props = new Properties_PropertyManager();
          props.setChoice(788, 1);

          try {
            var settings = new AdventureSettings();
            settings.setStartOfFightMacro(macro);
            settings.addNoBanish(_this.bowler);

            if (!(0,external_kolmafia_.haveSkill)(_this.nanovision)) {
              settings.addNoBanish(_this.drunk);
            }

            greyAdv(_this.loc, outfit, settings);
          } finally {
            props.resetAll();
          }

          if (couldBeBowling && _this.getProgress() > progressPrior) {
            (0,external_kolmafia_.setProperty)(_this.cosmicBowled, "true");
          }
        }
      };
    } }, { key: "barUnlocked", value:

    function barUnlocked() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("hiddenTavernUnlock")) == (0,external_kolmafia_.myAscensions)();
    } }]);return QuestL11Bowling;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/hiddencity/shrines/QuestL11TempleBusiness.ts
function QuestL11TempleBusiness_typeof(obj) {"@babel/helpers - typeof";return QuestL11TempleBusiness_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11TempleBusiness_typeof(obj);}function QuestL11TempleBusiness_slicedToArray(arr, i) {return QuestL11TempleBusiness_arrayWithHoles(arr) || QuestL11TempleBusiness_iterableToArrayLimit(arr, i) || QuestL11TempleBusiness_unsupportedIterableToArray(arr, i) || QuestL11TempleBusiness_nonIterableRest();}function QuestL11TempleBusiness_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function QuestL11TempleBusiness_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function QuestL11TempleBusiness_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function QuestL11TempleBusiness_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestL11TempleBusiness_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestL11TempleBusiness_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestL11TempleBusiness_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestL11TempleBusiness_arrayLikeToArray(o, minLen);}function QuestL11TempleBusiness_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestL11TempleBusiness_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11TempleBusiness_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11TempleBusiness_toPropertyKey(descriptor.key), descriptor);}}function QuestL11TempleBusiness_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11TempleBusiness_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11TempleBusiness_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11TempleBusiness_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestL11TempleBusiness_setPrototypeOf(subClass, superClass);}function QuestL11TempleBusiness_setPrototypeOf(o, p) {QuestL11TempleBusiness_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestL11TempleBusiness_setPrototypeOf(o, p);}function QuestL11TempleBusiness_createSuper(Derived) {var hasNativeReflectConstruct = QuestL11TempleBusiness_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestL11TempleBusiness_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestL11TempleBusiness_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestL11TempleBusiness_possibleConstructorReturn(this, result);};}function QuestL11TempleBusiness_possibleConstructorReturn(self, call) {if (call && (QuestL11TempleBusiness_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestL11TempleBusiness_assertThisInitialized(self);}function QuestL11TempleBusiness_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestL11TempleBusiness_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestL11TempleBusiness_getPrototypeOf(o) {QuestL11TempleBusiness_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestL11TempleBusiness_getPrototypeOf(o);}function QuestL11TempleBusiness_defineProperty(obj, key, value) {key = QuestL11TempleBusiness_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11TempleBusiness_toPropertyKey(arg) {var key = QuestL11TempleBusiness_toPrimitive(arg, "string");return QuestL11TempleBusiness_typeof(key) === "symbol" ? key : String(key);}function QuestL11TempleBusiness_toPrimitive(input, hint) {if (QuestL11TempleBusiness_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11TempleBusiness_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}










var QuestL11Business = /*#__PURE__*/function (_TaskInfo) {QuestL11TempleBusiness_inherits(QuestL11Business, _TaskInfo);var _super = QuestL11TempleBusiness_createSuper(QuestL11Business);function QuestL11Business() {var _this;QuestL11TempleBusiness_classCallCheck(this, QuestL11Business);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestL11TempleBusiness_defineProperty(QuestL11TempleBusiness_assertThisInitialized(_this), "files",
    [
    "McClusky file (page 1)",
    "McClusky file (page 2)",
    "McClusky file (page 3)",
    "McClusky file (page 4)",
    "McClusky file (page 5)"].
    map(function (s) {return external_kolmafia_.Item.get(s);}));QuestL11TempleBusiness_defineProperty(QuestL11TempleBusiness_assertThisInitialized(_this), "completeFile",
    external_kolmafia_.Item.get("McClusky file (complete)"));QuestL11TempleBusiness_defineProperty(QuestL11TempleBusiness_assertThisInitialized(_this), "binderClip",
    external_kolmafia_.Item.get("Boring Binder Clip"));QuestL11TempleBusiness_defineProperty(QuestL11TempleBusiness_assertThisInitialized(_this), "loc",
    external_kolmafia_.Location.get("the hidden office building"));QuestL11TempleBusiness_defineProperty(QuestL11TempleBusiness_assertThisInitialized(_this), "apartment",
    external_kolmafia_.Location.get("The Hidden Apartment Building"));QuestL11TempleBusiness_defineProperty(QuestL11TempleBusiness_assertThisInitialized(_this), "accountant",
    external_kolmafia_.Monster.get("Pygmy witch accountant"));QuestL11TempleBusiness_defineProperty(QuestL11TempleBusiness_assertThisInitialized(_this), "spirit",
    (0,external_kolmafia_.toMonster)(444));QuestL11TempleBusiness_defineProperty(QuestL11TempleBusiness_assertThisInitialized(_this), "toAbsorb", void 0);QuestL11TempleBusiness_defineProperty(QuestL11TempleBusiness_assertThisInitialized(_this), "paths", void 0);QuestL11TempleBusiness_defineProperty(QuestL11TempleBusiness_assertThisInitialized(_this), "savedEncounters",


    []);QuestL11TempleBusiness_defineProperty(QuestL11TempleBusiness_assertThisInitialized(_this), "encountersSaved",
    0);return _this;}QuestL11TempleBusiness_createClass(QuestL11Business, [{ key: "getId", value:

    function getId() {
      return "Council / MacGruffin / HiddenCity / Accountants";
    } }, { key: "createPaths", value:

    function createPaths(assumeUnstarted) {
      var firstTurns = this.hasFirstNC() ?
      0 :
      assumeUnstarted ?
      5 :
      this.delayUntilNextNC();
      var secondTurns =
      !this.hasFirstNC() || assumeUnstarted ? 4 : this.delayUntilNextNC();

      this.paths = [new PossiblePath(firstTurns + secondTurns)];

      var combos = [];

      if (firstTurns > 0) {
        combos.push([ResourceCategory.FORCE_NC, 0]);
        combos.push([null, firstTurns]);
      }

      if (secondTurns > 0) {
        combos.push([ResourceCategory.FORCE_NC, 0]);
        combos.push([null, secondTurns]);
      }

      if (combos.length == 0) {
        return;
      }var _iterator = QuestL11TempleBusiness_createForOfIteratorHelper(

        getAllCombinations(combos)),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var combo = _step.value;
          if (combo.length != combos.length / 2) {
            continue;
          }

          var path = new PossiblePath(
          combo.map(function (_ref) {var _ref2 = QuestL11TempleBusiness_slicedToArray(_ref, 2),t = _ref2[1];return t;}).reduce(function (p, v) {return p + v;}, 0));var _iterator2 = QuestL11TempleBusiness_createForOfIteratorHelper(


            combo),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var _step2$value = QuestL11TempleBusiness_slicedToArray(_step2.value, 1),res = _step2$value[0];
              if (res == null) {
                continue;
              }

              path.add(res);
            }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}

          this.paths.push(path);
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc, this.apartment];
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "delayUntilNextNC", value:

    function delayUntilNextNC() {
      if (this.encountersSaved != this.loc.turnsSpent) {
        this.encountersSaved = this.loc.turnsSpent;
        this.savedEncounters = getEncounters("The Hidden Office Building", [
        "Working Holiday"]).
        reverse();
      }

      var turnsSpent = 0;
      var lastTurnSpent = -1;
      var ncAfter = 5;var _iterator3 = QuestL11TempleBusiness_createForOfIteratorHelper(

        this.savedEncounters),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var _step3$value = QuestL11TempleBusiness_slicedToArray(_step3.value, 2),encounter = _step3$value[0],turn = _step3$value[1];
          if (encounter == "Working Holiday") {
            ncAfter = 4;

            if (turn == lastTurnSpent) {
              turnsSpent--;
            }

            break;
          }

          turnsSpent++;
          lastTurnSpent = turn;
        }} catch (err) {_iterator3.e(err);} finally {_iterator3.f();}

      if (turnsSpent > ncAfter) {
        (0,external_kolmafia_.print)(
        "Weird. Parsing is wrong. Expected to hit the apartment NC after " +
        ncAfter +
        " delay, but we have " +
        turnsSpent +
        " spent.. Encounters: " +
        this.savedEncounters.map(function (_ref3) {var _ref4 = QuestL11TempleBusiness_slicedToArray(_ref3, 2),e = _ref4[0],turn = _ref4[1];return e + ": " + turn;}).join(", "),
        "red");

      }

      var delay = Math.max(0, ncAfter - turnsSpent);

      return delay;
    } }, { key: "isDelayBurning", value:

    function isDelayBurning() {
      return (
        this.delayUntilNextNC() > 0 && (
        (0,external_kolmafia_.availableAmount)(this.completeFile) > 0 || this.filesRemaining() == 0));

    } }, { key: "hasFirstNC", value:

    function hasFirstNC() {
      return (
        (0,external_kolmafia_.availableAmount)(this.binderClip) + (0,external_kolmafia_.availableAmount)(this.completeFile) > 0);

    } }, { key: "canRun", value:

    function canRun() {
      return (
        (0,external_kolmafia_.getProperty)("questL11Business") != "unstarted" &&
        (0,external_kolmafia_.getProperty)("questL11Worship") == "step3");

    } }, { key: "status", value:

    function status(path) {
      var status = (0,external_kolmafia_.getProperty)("questL11Business");

      if (status == "finished") {
        return QuestStatus.COMPLETED;
      }

      if (path == null || !this.canRun()) {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.availableAmount)(this.binderClip) > 0 && this.filesRemaining() == 0) {
        return QuestStatus.READY;
      }

      if ((0,external_kolmafia_.getProperty)("questL11Curses") != "finished" && this.goCurses()) {
        return QuestStatus.NOT_READY;
      }

      if (this.wantToForceNextNC(path)) {
        if (path.getResource(ResourceCategory.FORCE_NC).primed()) {
          return QuestStatus.READY;
        }

        // Only run the first NC when primed
        if (!this.hasFirstNC()) {
          return QuestStatus.NOT_READY;
        }

        // Only run the second NC when primed and no files remaining
        if (this.toAbsorb.length == 0 && (0,external_kolmafia_.availableAmount)(this.completeFile) > 0) {
          return QuestStatus.NOT_READY;
        }
      }

      if ((0,external_kolmafia_.isBanished)(this.accountant)) {
        return QuestStatus.NOT_READY;
      }

      if (this.isDelayBurning()) {
        if (DelayBurners.isDelayBurnerReady()) {
          return QuestStatus.READY;
        }

        if (DelayBurners.isDelayBurnerFeasible()) {
          return QuestStatus.FASTER_LATER;
        }
      }

      return QuestStatus.READY;
    } }, { key: "goCurses", value:

    function goCurses() {
      return this.farmFiles() && this.delayUntilNextNC() == 0;
    } }, { key: "farmFiles", value:

    function farmFiles() {
      return (0,external_kolmafia_.availableAmount)(this.binderClip) > 0 && this.filesRemaining() > 0;
    } }, { key: "wantToForceNextNC", value:

    function wantToForceNextNC(path) {
      if (path.canUse(ResourceCategory.FORCE_NC) == 0) {
        return false;
      }

      if (this.delayUntilNextNC() == 0) {
        return false;
      }

      // If we haven't had our first NC, force that
      if (!this.hasFirstNC()) {
        return true;
      }

      // If we've picked up our absorb
      return this.toAbsorb.length == 0;
    } }, { key: "readyToForceNC", value:

    function readyToForceNC() {
      return !this.hasFirstNC() ?
      !this.farmFiles() :
      (0,external_kolmafia_.availableAmount)(this.completeFile) > 0 && this.toAbsorb.length == 0;
    } }, { key: "attemptPrime", value:

    function attemptPrime(path) {
      if (!this.wantToForceNextNC(path) || !this.canRun()) {
        return false;
      }

      if (!this.readyToForceNC()) {
        return false;
      }

      setPrimedResource(this, path, path.getResource(ResourceCategory.FORCE_NC));

      return true;
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      if ((0,external_kolmafia_.availableAmount)(this.binderClip) > 0 && this.filesRemaining() == 0) {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {
            _this2.tryCreate();
          }
        };
      }

      if (path != null && this.goCurses()) {
        //
        return {
          location: this.apartment,
          orbs: [this.accountant],
          run: function run() {
            var props = new Properties_PropertyManager();

            props.setChoice(780, 6); // Skip
            var settings = new AdventureSettings().addBanish(
            external_kolmafia_.Monster.get("pygmy witch lawyer"));


            try {
              greyAdv(_this2.apartment, null, settings);

              _this2.tryCreate();
            } finally {
              props.resetAll();
            }
          }
        };
      }

      var outfit = new GreyOutfit();

      if (
      (0,external_kolmafia_.availableAmount)(this.completeFile) > 0 &&
      this.filesRemaining() == 0 &&
      this.delayUntilNextNC() > 0)
      {
        outfit.addDelayer();
      }

      return {
        location:
        path.canUse(ResourceCategory.FORCE_NC) &&
        path.getResource(ResourceCategory.FORCE_NC).primed() ?
        null :
        this.loc,
        orbs: this.filesRemaining() > 0 ? [this.accountant] : null,
        forcedFight:
        (0,external_kolmafia_.availableAmount)(this.completeFile) > 0 ?
        [this.delayUntilNextNC(), this.spirit] :
        null,
        mayFreeRun: this.delayUntilNextNC() > 0,
        freeRun: function freeRun(monster) {return (
            _this2.filesRemaining() == 0 || monster != _this2.accountant);},
        outfit: outfit,
        run: function run() {
          var props = new Properties_PropertyManager();

          try {
            if ((0,external_kolmafia_.availableAmount)(_this2.completeFile) > 0) {
              props.setChoice(786, 1); // Have complete file, fight
            } else if ((0,external_kolmafia_.availableAmount)(_this2.binderClip) == 0) {
              props.setChoice(786, 2); // Get binder clip
            } else {
              props.setChoice(786, 3); // Fight accountant
            }

            if (DelayBurners.isTryingForDupeableGoblin()) {
              (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Grey Goose"));
            }

            var settings = new AdventureSettings().addBanish(
            external_kolmafia_.Monster.get("pygmy headhunter"));


            greyAdv(_this2.loc, null, settings);

            _this2.tryCreate();
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "tryCreate", value:

    function tryCreate() {
      if (this.filesRemaining() > 0 || (0,external_kolmafia_.availableAmount)(this.binderClip) == 0) {
        return;
      }

      (0,external_kolmafia_.use)(this.binderClip);
    } }, { key: "filesRemaining", value:

    function filesRemaining() {
      return (0,external_kolmafia_.availableAmount)(this.completeFile) > 0 ?
      0 :
      this.files.filter(function (f) {return (0,external_kolmafia_.availableAmount)(f) == 0;}).length;
    } }]);return QuestL11Business;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/hiddencity/shrines/QuestL11TempleCurses.ts
function QuestL11TempleCurses_typeof(obj) {"@babel/helpers - typeof";return QuestL11TempleCurses_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11TempleCurses_typeof(obj);}function QuestL11TempleCurses_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11TempleCurses_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11TempleCurses_toPropertyKey(descriptor.key), descriptor);}}function QuestL11TempleCurses_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11TempleCurses_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11TempleCurses_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11TempleCurses_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestL11TempleCurses_setPrototypeOf(subClass, superClass);}function QuestL11TempleCurses_setPrototypeOf(o, p) {QuestL11TempleCurses_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestL11TempleCurses_setPrototypeOf(o, p);}function QuestL11TempleCurses_createSuper(Derived) {var hasNativeReflectConstruct = QuestL11TempleCurses_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestL11TempleCurses_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestL11TempleCurses_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestL11TempleCurses_possibleConstructorReturn(this, result);};}function QuestL11TempleCurses_possibleConstructorReturn(self, call) {if (call && (QuestL11TempleCurses_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestL11TempleCurses_assertThisInitialized(self);}function QuestL11TempleCurses_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestL11TempleCurses_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestL11TempleCurses_getPrototypeOf(o) {QuestL11TempleCurses_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestL11TempleCurses_getPrototypeOf(o);}function QuestL11TempleCurses_defineProperty(obj, key, value) {key = QuestL11TempleCurses_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11TempleCurses_toPropertyKey(arg) {var key = QuestL11TempleCurses_toPrimitive(arg, "string");return QuestL11TempleCurses_typeof(key) === "symbol" ? key : String(key);}function QuestL11TempleCurses_toPrimitive(input, hint) {if (QuestL11TempleCurses_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11TempleCurses_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}











var QuestL11Curses = /*#__PURE__*/function (_TaskInfo) {QuestL11TempleCurses_inherits(QuestL11Curses, _TaskInfo);var _super = QuestL11TempleCurses_createSuper(QuestL11Curses);function QuestL11Curses() {var _this;QuestL11TempleCurses_classCallCheck(this, QuestL11Curses);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestL11TempleCurses_defineProperty(QuestL11TempleCurses_assertThisInitialized(_this), "curse1",
    external_kolmafia_.Effect.get("Once-Cursed"));QuestL11TempleCurses_defineProperty(QuestL11TempleCurses_assertThisInitialized(_this), "curse2",
    external_kolmafia_.Effect.get("Twice-Cursed"));QuestL11TempleCurses_defineProperty(QuestL11TempleCurses_assertThisInitialized(_this), "curse3",
    external_kolmafia_.Effect.get("Thrice-Cursed"));QuestL11TempleCurses_defineProperty(QuestL11TempleCurses_assertThisInitialized(_this), "apartment",
    external_kolmafia_.Location.get("The Hidden Apartment Building"));QuestL11TempleCurses_defineProperty(QuestL11TempleCurses_assertThisInitialized(_this), "shaman",
    external_kolmafia_.Monster.get("pygmy shaman"));QuestL11TempleCurses_defineProperty(QuestL11TempleCurses_assertThisInitialized(_this), "spirit",
    (0,external_kolmafia_.toMonster)(442));QuestL11TempleCurses_defineProperty(QuestL11TempleCurses_assertThisInitialized(_this), "toAbsorb", void 0);QuestL11TempleCurses_defineProperty(QuestL11TempleCurses_assertThisInitialized(_this), "files",

    [
    "McClusky file (page 1)",
    "McClusky file (page 2)",
    "McClusky file (page 3)",
    "McClusky file (page 4)",
    "McClusky file (page 5)"].
    map(function (s) {return external_kolmafia_.Item.get(s);}));QuestL11TempleCurses_defineProperty(QuestL11TempleCurses_assertThisInitialized(_this), "completeFile",
    external_kolmafia_.Item.get("McClusky file (complete)"));QuestL11TempleCurses_defineProperty(QuestL11TempleCurses_assertThisInitialized(_this), "accountant",
    external_kolmafia_.Monster.get("Pygmy witch accountant"));QuestL11TempleCurses_defineProperty(QuestL11TempleCurses_assertThisInitialized(_this), "paths", void 0);QuestL11TempleCurses_defineProperty(QuestL11TempleCurses_assertThisInitialized(_this), "needRecalculate", void 0);return _this;}QuestL11TempleCurses_createClass(QuestL11Curses, [{ key: "getPossiblePaths", value:



    function getPossiblePaths() {
      return this.paths;
    } }, { key: "createPaths", value:

    function createPaths(assumeUnstarted) {
      this.paths = [];

      if (assumeUnstarted || !this.shouldLookAtForcingNC()) {
        this.paths.push(new PossiblePath(0));
        return;
      }

      this.paths.push(
      new PossiblePath(this.filesRemaining() == 0 ? this.delayForNextNC() : 7));

      this.paths.push(new PossiblePath(0).add(ResourceCategory.FORCE_NC));
    } }, { key: "shouldLookAtForcingNC", value:

    function shouldLookAtForcingNC() {
      var turns = this.delayForNextNC();

      if (turns <= 1) {
        return false;
      }

      var effect = (0,external_kolmafia_.haveEffect)(this.curse3);

      if (effect == 0) {
        return false;
      }

      if (effect < turns) {
        return true;
      }

      return this.filesRemaining() == 0;
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.apartment];
    } }, { key: "getId", value:

    function getId() {
      return "Council / MacGruffin / HiddenCity / Curses";
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      var turns =
      (0,external_kolmafia_.haveEffect)(this.curse1) +
      (0,external_kolmafia_.haveEffect)(this.curse2) +
      (0,external_kolmafia_.haveEffect)(this.curse3);

      if (turns == 0) {
        return false;
      }

      var delay = this.delayForNextNC();
      var hasGracePeriod = delay < turns;
      var mayAsWellResetOrb =
      hasGracePeriod && currentPredictions().has(this.apartment);

      if (!(0,external_kolmafia_.haveEffect)(this.curse3) && mayAsWellResetOrb) {
        return false;
      }

      return turns <= delay + 4;
    } }, { key: "canRun", value:

    function canRun() {
      return (
        (0,external_kolmafia_.getProperty)("questL11Curses") != "unstarted" &&
        (0,external_kolmafia_.getProperty)("questL11Worship") == "step3");

    } }, { key: "status", value:

    function status(path) {
      var status = (0,external_kolmafia_.getProperty)("questL11Curses");

      if (status == "finished") {
        return QuestStatus.COMPLETED;
      }

      if (path == null || !this.canRun()) {
        return QuestStatus.NOT_READY;
      }

      if (
      path.canUse(ResourceCategory.FORCE_NC) &&
      path.getResource(ResourceCategory.FORCE_NC).primed())
      {
        return QuestStatus.READY;
      }

      if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("hiddenBowlingAlleyProgress")) <= 1) {
        return QuestStatus.NOT_READY;
      }

      if (this.needRecalculate == null && this.shouldLookAtForcingNC()) {
        this.needRecalculate = true;
      }

      if (this.needRecalculate || path == null) {
        return QuestStatus.READY;
      }

      if (path.canUse(ResourceCategory.FORCE_NC)) {
        if (path.getResource(ResourceCategory.FORCE_NC).primed()) {
          return QuestStatus.READY;
        }

        if (!this.mustBeDone()) {
          return QuestStatus.NOT_READY;
        }
      }

      if ((0,external_kolmafia_.haveEffect)(this.curse3) && this.delayForNextNC() == 0) {
        return QuestStatus.READY;
      }

      return QuestStatus.READY;
    } }, { key: "delayForNextNC", value:

    function delayForNextNC() {
      var totalTurns = this.apartment.turnsSpent;

      if (totalTurns < 9) {
        return 8 - totalTurns;
      }

      return 7 - (totalTurns - 9) % 8;
    } }, { key: "filesRemaining", value:

    function filesRemaining() {
      return (0,external_kolmafia_.availableAmount)(this.completeFile) > 0 ?
      0 :
      this.files.filter(function (f) {return (0,external_kolmafia_.availableAmount)(f) == 0;}).length;
    } }, { key: "attemptPrime", value:

    function attemptPrime(path) {
      if (
      !path.canUse(ResourceCategory.FORCE_NC) ||
      !this.shouldLookAtForcingNC())
      {
        return false;
      }

      setPrimedResource(this, path, path.getResource(ResourceCategory.FORCE_NC));

      return true;
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      if (this.needRecalculate) {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {
            _this2.needRecalculate = false;

            AdventureFinder.recalculatePath();
          }
        };
      }

      var needCurses = (0,external_kolmafia_.haveEffect)(this.curse3) <= this.delayForNextNC();
      var needFiles =
      (0,external_kolmafia_.getProperty)("questL11Business") != "finished" &&
      this.filesRemaining() > 0 &&
      (0,external_kolmafia_.availableAmount)(this.completeFile) == 0;

      var orb = [];

      if (needCurses) {
        orb.push(this.shaman);
      }

      if (needFiles && (0,external_kolmafia_.haveEffect)(this.curse3)) {
        orb.push(this.accountant);
      }

      var outfit = new GreyOutfit();

      if ((0,external_kolmafia_.haveEffect)(this.curse3) && this.delayForNextNC() > 0) {
        outfit.addDelayer();
      }

      return {
        outfit: outfit,
        location: this.apartment,
        orbs: orb,
        olfaction: needCurses ? [this.shaman] : null,
        forcedFight:
        (0,external_kolmafia_.haveEffect)(this.curse3) > 0 ?
        [this.delayForNextNC(), this.spirit] :
        null,
        mayFreeRun: true,
        freeRun: function freeRun(monster) {return (
            (monster != _this2.accountant || !needFiles) && (
            monster != _this2.shaman || !needCurses));},
        run: function run() {
          (0,external_kolmafia_.print)("Next curse NC in " + _this2.delayForNextNC(), "gray");

          var props = new Properties_PropertyManager();

          if ((0,external_kolmafia_.haveEffect)(_this2.curse3)) {
            props.setChoice(780, 1);
          } else {
            props.setChoice(780, 2);
          }

          if (DelayBurners.isTryingForDupeableGoblin()) {
            (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Grey Goose"));
          }

          var settings = new AdventureSettings().addBanish(
          external_kolmafia_.Monster.get("pygmy witch lawyer"));


          try {
            greyAdv(_this2.apartment, null, settings);
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes(quest) {
      if (quest == this) {
        return true;
      }

      var turns =
      (0,external_kolmafia_.haveEffect)(this.curse1) +
      (0,external_kolmafia_.haveEffect)(this.curse2) +
      (0,external_kolmafia_.haveEffect)(this.curse3);

      return turns == 0 || turns > 10;
    } }]);return QuestL11Curses;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/hiddencity/shrines/QuestL11TempleDoctor.ts
function QuestL11TempleDoctor_typeof(obj) {"@babel/helpers - typeof";return QuestL11TempleDoctor_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11TempleDoctor_typeof(obj);}function QuestL11TempleDoctor_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestL11TempleDoctor_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestL11TempleDoctor_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestL11TempleDoctor_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestL11TempleDoctor_arrayLikeToArray(o, minLen);}function QuestL11TempleDoctor_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestL11TempleDoctor_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11TempleDoctor_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11TempleDoctor_toPropertyKey(descriptor.key), descriptor);}}function QuestL11TempleDoctor_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11TempleDoctor_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11TempleDoctor_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11TempleDoctor_defineProperty(obj, key, value) {key = QuestL11TempleDoctor_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11TempleDoctor_toPropertyKey(arg) {var key = QuestL11TempleDoctor_toPrimitive(arg, "string");return QuestL11TempleDoctor_typeof(key) === "symbol" ? key : String(key);}function QuestL11TempleDoctor_toPrimitive(input, hint) {if (QuestL11TempleDoctor_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11TempleDoctor_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestL11Doctor = /*#__PURE__*/function () {function QuestL11Doctor() {QuestL11TempleDoctor_classCallCheck(this, QuestL11Doctor);QuestL11TempleDoctor_defineProperty(this, "equips",
    [
    "bloodied surgical dungarees",
    "half-size scalpel",
    "surgical apron",
    "head mirror",
    "surgical mask"].
    map(function (s) {return external_kolmafia_.Item.get(s);}));QuestL11TempleDoctor_defineProperty(this, "loc",
    external_kolmafia_.Location.get("The Hidden Hospital"));QuestL11TempleDoctor_defineProperty(this, "surgeon",
    external_kolmafia_.Monster.get("pygmy witch surgeon"));QuestL11TempleDoctor_defineProperty(this, "shirt",
    external_kolmafia_.Item.get("Surgical apron"));QuestL11TempleDoctor_defineProperty(this, "torso",
    external_kolmafia_.Skill.get("Torso Awareness"));}QuestL11TempleDoctor_createClass(QuestL11Doctor, [{ key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }, { key: "getId", value:

    function getId() {
      return "Council / MacGruffin / HiddenCity / Doctor";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "status", value:

    function status() {
      var status = (0,external_kolmafia_.getProperty)("questL11Doctor");

      if (status == "finished") {
        return QuestStatus.COMPLETED;
      }

      if (status == "unstarted") {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.getProperty)("questL11Worship") != "step3") {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();
      var seekingOutfit = false;var _iterator = QuestL11TempleDoctor_createForOfIteratorHelper(

        this.equips),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var i = _step.value;
          if (i == this.shirt && !(0,external_kolmafia_.haveSkill)(this.torso)) {
            continue;
          }

          if ((0,external_kolmafia_.availableAmount)(i) == 0) {
            seekingOutfit = true;
            continue;
          }

          outfit.addWeight(i);
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

      return {
        location: this.loc,
        outfit: outfit,
        olfaction: seekingOutfit ? [this.surgeon] : null,
        freeRun: function freeRun(mons) {return mons != _this.surgeon || !seekingOutfit;},
        run: function run() {
          var props = new Properties_PropertyManager();
          props.setChoice(784, 1);

          try {
            greyAdv(
            _this.loc,
            outfit,
            new AdventureSettings().addNoBanish(_this.surgeon));

          } finally {
            props.resetAll();
          }
        }
      };
    } }]);return QuestL11Doctor;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/hiddencity/QuestL11ShrineVines.ts
function QuestL11ShrineVines_typeof(obj) {"@babel/helpers - typeof";return QuestL11ShrineVines_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11ShrineVines_typeof(obj);}function QuestL11ShrineVines_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestL11ShrineVines_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestL11ShrineVines_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestL11ShrineVines_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestL11ShrineVines_arrayLikeToArray(o, minLen);}function QuestL11ShrineVines_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestL11ShrineVines_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11ShrineVines_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11ShrineVines_toPropertyKey(descriptor.key), descriptor);}}function QuestL11ShrineVines_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11ShrineVines_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11ShrineVines_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11ShrineVines_defineProperty(obj, key, value) {key = QuestL11ShrineVines_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11ShrineVines_toPropertyKey(arg) {var key = QuestL11ShrineVines_toPrimitive(arg, "string");return QuestL11ShrineVines_typeof(key) === "symbol" ? key : String(key);}function QuestL11ShrineVines_toPrimitive(input, hint) {if (QuestL11ShrineVines_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11ShrineVines_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestL11ShrineVines = /*#__PURE__*/function () {function QuestL11ShrineVines() {QuestL11ShrineVines_classCallCheck(this, QuestL11ShrineVines);QuestL11ShrineVines_defineProperty(this, "locs",
    [
    [
    "hiddenBowlingAlleyProgress",
    external_kolmafia_.Location.get("An Overgrown Shrine (Southeast)"),
    external_kolmafia_.Item.get("scorched stone sphere"),
    787],

    [
    "hiddenApartmentProgress",
    external_kolmafia_.Location.get("An Overgrown Shrine (Northwest)"),
    external_kolmafia_.Item.get("moss-covered stone sphere"),
    781],

    [
    "hiddenOfficeProgress",
    external_kolmafia_.Location.get("An Overgrown Shrine (Northeast)"),
    external_kolmafia_.Item.get("crackling stone sphere"),
    785],

    [
    "hiddenHospitalProgress",
    external_kolmafia_.Location.get("An Overgrown Shrine (Southwest)"),
    external_kolmafia_.Item.get("dripping stone sphere"),
    783],

    [null, external_kolmafia_.Location.get("A Massive Ziggurat"), null, null]]);QuestL11ShrineVines_defineProperty(this, "machete",

    external_kolmafia_.Item.get("Antique Machete"));}QuestL11ShrineVines_createClass(QuestL11ShrineVines, [{ key: "level", value:

    function level() {
      return 11;
    } }, { key: "getLocations", value:

    function getLocations() {
      return this.locs.map(function (l) {return l[1];});
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Worship");

      if (status > 4) {
        return QuestStatus.COMPLETED;
      }

      if (status < 3) {
        return QuestStatus.NOT_READY;
      }

      if (this.shrineNeedsDoing() == null) {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.availableAmount)(this.machete) == 0) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "getId", value:

    function getId() {
      return "Council / MacGruffin / HiddenCity / Vines";
    } }, { key: "lianaCleared", value:

    function lianaCleared(loc) {
      if (loc.noncombatQueue.includes("Legend of the Temple in the Hidden Cit")) {
        return true;
      }

      //need to check the combat names due to wanderers
      //we are assuming victory. you could have potentially fought liana without machete and then ran away. but you we are assuming you didn't
      var dense_liana_defeated = 0;
      var area_combats_seen = loc.combatQueue.split("; ");var _iterator = QuestL11ShrineVines_createForOfIteratorHelper(

        area_combats_seen),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var s = _step.value;
          if (s == "dense liana") {
            dense_liana_defeated += 1;
          }
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

      return dense_liana_defeated > 2;
    } }, { key: "run", value:

    function run() {
      var adv = this.shrineNeedsDoing();

      if (adv == null) {
        return {
          location: null,
          run: function run() {
            throw "??? Shrine not ready";
          }
        };
      }

      var outfit;

      if (adv[2]) {
        outfit = new GreyOutfit().addWeight(this.machete);
      } else {
        outfit = GreyOutfit.IGNORE_OUTFIT;
      }

      return {
        location: adv[0],
        outfit: outfit,
        run: function run() {
          var props = new Properties_PropertyManager();

          if (adv[1] != null) {
            props.setChoice(adv[1], adv[2] ? 1 : 2);
          }

          try {
            greyAdv(adv[0], outfit);
          } finally {
            props.resetAll();
          }
        }
      };
    }

    // Location, choice adv number, needs to clear vines
  }, { key: "shrineNeedsDoing", value: function shrineNeedsDoing() {var _iterator2 = QuestL11ShrineVines_createForOfIteratorHelper(
        this.locs),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var l = _step2.value;
          if (
          l[0] != null ? (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)(l[0])) <= 0 : !this.lianaCleared(l[1]))
          {
            return [l[1], l[3], true];
          }

          if (l[2] != null && (0,external_kolmafia_.availableAmount)(l[2]) > 0) {
            return [l[1], l[3], false];
          }
        }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}

      return null;
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestL11ShrineVines;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/hiddencity/QuestL11HiddenPark.ts
function QuestL11HiddenPark_typeof(obj) {"@babel/helpers - typeof";return QuestL11HiddenPark_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11HiddenPark_typeof(obj);}function QuestL11HiddenPark_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11HiddenPark_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11HiddenPark_toPropertyKey(descriptor.key), descriptor);}}function QuestL11HiddenPark_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11HiddenPark_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11HiddenPark_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11HiddenPark_defineProperty(obj, key, value) {key = QuestL11HiddenPark_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11HiddenPark_toPropertyKey(arg) {var key = QuestL11HiddenPark_toPrimitive(arg, "string");return QuestL11HiddenPark_typeof(key) === "symbol" ? key : String(key);}function QuestL11HiddenPark_toPrimitive(input, hint) {if (QuestL11HiddenPark_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11HiddenPark_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var QuestL11HiddenPark = /*#__PURE__*/function () {function QuestL11HiddenPark() {QuestL11HiddenPark_classCallCheck(this, QuestL11HiddenPark);QuestL11HiddenPark_defineProperty(this, "matches",
    external_kolmafia_.Item.get("Book of Matches"));QuestL11HiddenPark_defineProperty(this, "sword",
    external_kolmafia_.Item.get("Antique Machete"));QuestL11HiddenPark_defineProperty(this, "loc",
    external_kolmafia_.Location.get("The Hidden Park"));QuestL11HiddenPark_defineProperty(this, "book",
    external_kolmafia_.Item.get("Book of matches"));QuestL11HiddenPark_defineProperty(this, "janitor",
    external_kolmafia_.Monster.get("Pygmy Janitor"));}QuestL11HiddenPark_createClass(QuestL11HiddenPark, [{ key: "level", value:

    function level() {
      return 11;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Worship");

      if (status < 3) {
        return QuestStatus.NOT_READY;
      }

      if (status > 3) {
        return QuestStatus.COMPLETED;
      }

      if (!this.needsSword() && this.hasRelocatedJanitors()) {
        return QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }, { key: "getId", value:

    function getId() {
      return "Council / MacGruffin / HiddenCity / HiddenPark";
    } }, { key: "hasRelocatedJanitors", value:

    function hasRelocatedJanitors() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("relocatePygmyJanitor")) == (0,external_kolmafia_.myAscensions)();
    } }, { key: "barUnlocked", value:

    function barUnlocked() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("hiddenTavernUnlock")) == (0,external_kolmafia_.myAscensions)();
    } }, { key: "needsSword", value:

    function needsSword() {
      return (0,external_kolmafia_.availableAmount)(this.sword) <= 0;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit().setNoCombat().setItemDrops();
      var bottle =
      !this.barUnlocked() &&
      (0,external_kolmafia_.availableAmount)(this.book) == 0 &&
      this.hasRelocatedJanitors();

      var pred = currentPredictions().get(this.loc);

      if (bottle && (pred == null || pred == this.janitor)) {
        outfit.setChampagneBottle();
      }

      return {
        location: this.loc,
        outfit: outfit,
        mayFreeRun: true,
        freeRun: function freeRun(monster) {return bottle || monster != _this.janitor;},
        orbs: bottle ? [this.janitor] : null,
        run: function run() {
          var props = new Properties_PropertyManager();

          if (!_this.hasRelocatedJanitors()) {
            props.setChoice(789, 2);
          } else {
            props.setChoice(789, 1);
          }

          var settings = new AdventureSettings();

          if (bottle) {
            settings.addNoBanish(_this.janitor);
          }

          try {
            greyAdv(_this.loc, outfit, settings);
          } finally {
            props.resetAll();
          }
        }
      };
    } }]);return QuestL11HiddenPark;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/hiddencity/QuestL11HiddenBookMatches.ts
function QuestL11HiddenBookMatches_typeof(obj) {"@babel/helpers - typeof";return QuestL11HiddenBookMatches_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11HiddenBookMatches_typeof(obj);}function QuestL11HiddenBookMatches_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11HiddenBookMatches_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11HiddenBookMatches_toPropertyKey(descriptor.key), descriptor);}}function QuestL11HiddenBookMatches_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11HiddenBookMatches_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11HiddenBookMatches_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11HiddenBookMatches_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestL11HiddenBookMatches_setPrototypeOf(subClass, superClass);}function QuestL11HiddenBookMatches_setPrototypeOf(o, p) {QuestL11HiddenBookMatches_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestL11HiddenBookMatches_setPrototypeOf(o, p);}function QuestL11HiddenBookMatches_createSuper(Derived) {var hasNativeReflectConstruct = QuestL11HiddenBookMatches_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestL11HiddenBookMatches_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestL11HiddenBookMatches_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestL11HiddenBookMatches_possibleConstructorReturn(this, result);};}function QuestL11HiddenBookMatches_possibleConstructorReturn(self, call) {if (call && (QuestL11HiddenBookMatches_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestL11HiddenBookMatches_assertThisInitialized(self);}function QuestL11HiddenBookMatches_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestL11HiddenBookMatches_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestL11HiddenBookMatches_getPrototypeOf(o) {QuestL11HiddenBookMatches_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestL11HiddenBookMatches_getPrototypeOf(o);}function QuestL11HiddenBookMatches_defineProperty(obj, key, value) {key = QuestL11HiddenBookMatches_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11HiddenBookMatches_toPropertyKey(arg) {var key = QuestL11HiddenBookMatches_toPrimitive(arg, "string");return QuestL11HiddenBookMatches_typeof(key) === "symbol" ? key : String(key);}function QuestL11HiddenBookMatches_toPrimitive(input, hint) {if (QuestL11HiddenBookMatches_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11HiddenBookMatches_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}









var QuestL11HiddenBookMatches = /*#__PURE__*/function (_TaskInfo) {QuestL11HiddenBookMatches_inherits(QuestL11HiddenBookMatches, _TaskInfo);var _super = QuestL11HiddenBookMatches_createSuper(QuestL11HiddenBookMatches);function QuestL11HiddenBookMatches() {var _this;QuestL11HiddenBookMatches_classCallCheck(this, QuestL11HiddenBookMatches);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestL11HiddenBookMatches_defineProperty(QuestL11HiddenBookMatches_assertThisInitialized(_this), "book",
    external_kolmafia_.Item.get("Book of matches"));QuestL11HiddenBookMatches_defineProperty(QuestL11HiddenBookMatches_assertThisInitialized(_this), "monster",
    external_kolmafia_.Monster.get("pygmy janitor"));QuestL11HiddenBookMatches_defineProperty(QuestL11HiddenBookMatches_assertThisInitialized(_this), "location",
    external_kolmafia_.Location.get("The Hidden Park"));QuestL11HiddenBookMatches_defineProperty(QuestL11HiddenBookMatches_assertThisInitialized(_this), "nanovision",
    external_kolmafia_.Skill.get("Double Nanovision"));QuestL11HiddenBookMatches_defineProperty(QuestL11HiddenBookMatches_assertThisInitialized(_this), "sword",
    external_kolmafia_.Item.get("Antique Machete"));QuestL11HiddenBookMatches_defineProperty(QuestL11HiddenBookMatches_assertThisInitialized(_this), "toAbsorb", void 0);QuestL11HiddenBookMatches_defineProperty(QuestL11HiddenBookMatches_assertThisInitialized(_this), "noPull",

    new PossiblePath(5));QuestL11HiddenBookMatches_defineProperty(QuestL11HiddenBookMatches_assertThisInitialized(_this), "doPull", void 0);return _this;}QuestL11HiddenBookMatches_createClass(QuestL11HiddenBookMatches, [{ key: "getId", value:


    function getId() {
      return "Council / MacGruffin / HiddenCity / BookOfMatches";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "createPaths", value:

    function createPaths(assumeUnstarted) {
      this.noPull = new PossiblePath(5);
      this.doPull = new PossiblePath(0);

      if (
      assumeUnstarted ||
      (0,external_kolmafia_.availableAmount)(this.book) == 0 && !this.barUnlocked())
      {
        this.doPull.addConsumablePull(this.book);
      }
    } }, { key: "mustBeDone", value:

    function mustBeDone(reallyMustBeDone) {
      return (0,external_kolmafia_.availableAmount)(this.book) > 0;
    } }, { key: "free", value:

    function free() {
      return true;
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return [this.noPull, this.doPull];
    } }, { key: "status", value:

    function status() {
      if (this.barUnlocked() || (0,external_kolmafia_.getProperty)("questL11Spare") == "finished") {
        return QuestStatus.COMPLETED;
      }

      if (getQuestStatus("questL11Worship") < 3) {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.availableAmount)(this.book) > 0) {
        return QuestStatus.READY;
      }

      // Not until the bowling alley is accessible and the sword has been got
      if (
      (0,external_kolmafia_.availableAmount)(this.sword) == 0 ||
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("hiddenBowlingAlleyProgress")) <= 0)
      {
        return QuestStatus.NOT_READY;
      }

      // Might still hit the drop!
      if (
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("relocatePygmyJanitor")) < (0,external_kolmafia_.myAscensions)() &&
      //getProperty("questL11Business") != "finished" ||
      // getProperty("questL11Doctor") != "finished" ||
      (0,external_kolmafia_.getProperty)("questL11Curses") != "finished")
      {
        return QuestStatus.NOT_READY;
      }

      if (!(0,external_kolmafia_.haveSkill)(this.nanovision)) {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "barUnlocked", value:

    function barUnlocked() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("hiddenTavernUnlock")) == (0,external_kolmafia_.myAscensions)();
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      var outfit = new GreyOutfit();

      if (!path.canUse(ResourceCategory.PULL)) {
        outfit.setItemDrops();
        outfit.setPlusCombat();
        outfit.setChampagneBottle();
      } else {
        outfit = GreyOutfit.IGNORE_OUTFIT;
      }

      return {
        location: this.location,
        outfit: outfit,
        olfaction: [this.monster],
        run: function run() {
          if ((0,external_kolmafia_.availableAmount)(_this2.book) == 0) {
            if (path.canUse(ResourceCategory.PULL)) {
              GreyPulls.pullBoxOfMatches();
            } else {
              var settings = new AdventureSettings().addNoBanish(_this2.monster);

              greyAdv(_this2.location, outfit, settings);
            }
          }

          if ((0,external_kolmafia_.availableAmount)(_this2.book) > 0) {
            (0,external_kolmafia_.use)(_this2.book);

            if (!_this2.barUnlocked()) {
              throw "Bar should be unlocked";
            }
          }
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestL11HiddenBookMatches;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/temple/QuestL11TempleGrabWool.ts
function QuestL11TempleGrabWool_typeof(obj) {"@babel/helpers - typeof";return QuestL11TempleGrabWool_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11TempleGrabWool_typeof(obj);}function QuestL11TempleGrabWool_slicedToArray(arr, i) {return QuestL11TempleGrabWool_arrayWithHoles(arr) || QuestL11TempleGrabWool_iterableToArrayLimit(arr, i) || QuestL11TempleGrabWool_unsupportedIterableToArray(arr, i) || QuestL11TempleGrabWool_nonIterableRest();}function QuestL11TempleGrabWool_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function QuestL11TempleGrabWool_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function QuestL11TempleGrabWool_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function QuestL11TempleGrabWool_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestL11TempleGrabWool_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestL11TempleGrabWool_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestL11TempleGrabWool_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestL11TempleGrabWool_arrayLikeToArray(o, minLen);}function QuestL11TempleGrabWool_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestL11TempleGrabWool_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11TempleGrabWool_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11TempleGrabWool_toPropertyKey(descriptor.key), descriptor);}}function QuestL11TempleGrabWool_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11TempleGrabWool_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11TempleGrabWool_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11TempleGrabWool_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestL11TempleGrabWool_setPrototypeOf(subClass, superClass);}function QuestL11TempleGrabWool_setPrototypeOf(o, p) {QuestL11TempleGrabWool_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestL11TempleGrabWool_setPrototypeOf(o, p);}function QuestL11TempleGrabWool_createSuper(Derived) {var hasNativeReflectConstruct = QuestL11TempleGrabWool_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestL11TempleGrabWool_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestL11TempleGrabWool_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestL11TempleGrabWool_possibleConstructorReturn(this, result);};}function QuestL11TempleGrabWool_possibleConstructorReturn(self, call) {if (call && (QuestL11TempleGrabWool_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestL11TempleGrabWool_assertThisInitialized(self);}function QuestL11TempleGrabWool_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestL11TempleGrabWool_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestL11TempleGrabWool_getPrototypeOf(o) {QuestL11TempleGrabWool_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestL11TempleGrabWool_getPrototypeOf(o);}function QuestL11TempleGrabWool_defineProperty(obj, key, value) {key = QuestL11TempleGrabWool_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11TempleGrabWool_toPropertyKey(arg) {var key = QuestL11TempleGrabWool_toPrimitive(arg, "string");return QuestL11TempleGrabWool_typeof(key) === "symbol" ? key : String(key);}function QuestL11TempleGrabWool_toPrimitive(input, hint) {if (QuestL11TempleGrabWool_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11TempleGrabWool_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}










var QuestL11TempleGrabWool = /*#__PURE__*/function (_TaskInfo) {QuestL11TempleGrabWool_inherits(QuestL11TempleGrabWool, _TaskInfo);var _super = QuestL11TempleGrabWool_createSuper(QuestL11TempleGrabWool);function QuestL11TempleGrabWool() {var _this;QuestL11TempleGrabWool_classCallCheck(this, QuestL11TempleGrabWool);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestL11TempleGrabWool_defineProperty(QuestL11TempleGrabWool_assertThisInitialized(_this), "wool",
    external_kolmafia_.Item.get("Stone Wool"));QuestL11TempleGrabWool_defineProperty(QuestL11TempleGrabWool_assertThisInitialized(_this), "loc",
    external_kolmafia_.Location.get("The Hidden Temple"));QuestL11TempleGrabWool_defineProperty(QuestL11TempleGrabWool_assertThisInitialized(_this), "woolMonster",
    external_kolmafia_.Monster.get("Baa-relief sheep"));QuestL11TempleGrabWool_defineProperty(QuestL11TempleGrabWool_assertThisInitialized(_this), "luckyWoolMonster",
    external_kolmafia_.Monster.get("Baa'baa'bu'ran"));QuestL11TempleGrabWool_defineProperty(QuestL11TempleGrabWool_assertThisInitialized(_this), "deck",
    new PossiblePath(0).add(
    ResourceCategory.DECK_OF_EVERY_CARD));QuestL11TempleGrabWool_defineProperty(QuestL11TempleGrabWool_assertThisInitialized(_this), "paths",

    []);return _this;}QuestL11TempleGrabWool_createClass(QuestL11TempleGrabWool, [{ key: "createPaths", value:

    function createPaths(assumeUnstarted) {var _this2 = this;
      this.paths = []; //[this.clover, this.fax, this.deck];

      var amountNeeded = 2 - (assumeUnstarted ? 0 : (0,external_kolmafia_.availableAmount)(this.wool));

      if (amountNeeded <= 0) {
        this.paths.push(new PossiblePath(0));
        return;
      }

      var combos = [];
      combos.push([ResourceCategory.POLAR_VORTEX, 0]);
      combos.push([ResourceCategory.POLAR_VORTEX, 0]);
      combos.push([ResourceCategory.HUGS_AND_KISSES, 0]);
      combos.push([ResourceCategory.HUGS_AND_KISSES, 1]);
      combos.push([null, 4]);
      combos.push([null, 4]);var _iterator = QuestL11TempleGrabWool_createForOfIteratorHelper(

        getAllCombinations(combos, true)),_step;try {var _loop = function _loop() {var combination = _step.value;
          if (combination.length != amountNeeded) {return "continue";

          }

          var fightsNeeded =
          1 +
          combination.map(function (_ref) {var _ref2 = QuestL11TempleGrabWool_slicedToArray(_ref, 2),turns = _ref2[1];return turns;}).reduce(function (t1, t2) {return t1 + t2;}, 0);

          var path = new PossiblePath(fightsNeeded, fightsNeeded * 3);

          combination.filter(function (_ref3) {var _ref4 = QuestL11TempleGrabWool_slicedToArray(_ref3, 1),r = _ref4[0];return r != null;}).forEach(function (_ref5) {var _ref6 = QuestL11TempleGrabWool_slicedToArray(_ref5, 1),r = _ref6[0];return path.add(r);});

          _this2.paths.push(path);
        };for (_iterator.s(); !(_step = _iterator.n()).done;) {var _ret = _loop();if (_ret === "continue") continue;}} catch (err) {_iterator.e(err);} finally {_iterator.f();}
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Temple / GrabWool";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Worship");

      if (status > 1 || (0,external_kolmafia_.availableAmount)(this.wool) > 0) {
        return QuestStatus.COMPLETED;
      }

      if (status < 0 || !this.templeFound()) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "templeFound", value:

    function templeFound() {
      return (0,external_kolmafia_.getProperty)("questM16Temple") == "finished";
    } }, { key: "run", value:

    function run(path) {var _this3 = this;
      var outfit = new GreyOutfit().setItemDrops().setPlusCombat();
      var polarVortex = path.getResource(ResourceCategory.POLAR_VORTEX);

      if (polarVortex != null) {
        polarVortex.prepare(outfit);
      }

      var hugs = path.getResource(ResourceCategory.HUGS_AND_KISSES);

      return {
        location: this.loc,
        outfit: outfit,
        familiar: hugs === null || hugs === void 0 ? void 0 : hugs.familiar,
        disableFamOverride: (hugs === null || hugs === void 0 ? void 0 : hugs.familiar) != null,
        orbs: [this.woolMonster],
        olfaction: path.canUse(ResourceCategory.POLAR_VORTEX) ?
        null :
        [this.woolMonster],
        freeRun: function freeRun(monster) {return _this3.woolMonster != monster;},
        run: function run() {
          var settings = new AdventureSettings();
          settings.addNoBanish(_this3.woolMonster);

          if (polarVortex != null || hugs != null) {
            var macro = new Macro();

            if (hugs != null) {
              macro.step(hugs.macro());
            }

            if (polarVortex != null) {
              for (
              var i = 0;
              i < path.canUse(ResourceCategory.POLAR_VORTEX);
              i++)
              {
                macro.step(polarVortex.macro());
              }
            }

            settings.setStartOfFightMacro(Macro.if_(_this3.woolMonster, macro));
          }

          var props = new Properties_PropertyManager();
          props.setChoice(580, 1); // Hidden heart of temple
          props.setChoice(583, 1); // Such confusing buttons
          props.setChoice(581, 3); // Fight cave bears
          props.setChoice(579, 2); // Such great heights, grab the nostril

          try {
            greyAdv(_this3.loc, outfit, settings);
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }, { key: "shouldGrabWool", value:

    function shouldGrabWool() {
      return (0,external_kolmafia_.availableAmount)(this.wool) == 0;
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestL11TempleGrabWool;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/temple/QuestL11TempleNostril.ts
function QuestL11TempleNostril_typeof(obj) {"@babel/helpers - typeof";return QuestL11TempleNostril_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11TempleNostril_typeof(obj);}function QuestL11TempleNostril_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11TempleNostril_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11TempleNostril_toPropertyKey(descriptor.key), descriptor);}}function QuestL11TempleNostril_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11TempleNostril_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11TempleNostril_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11TempleNostril_defineProperty(obj, key, value) {key = QuestL11TempleNostril_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11TempleNostril_toPropertyKey(arg) {var key = QuestL11TempleNostril_toPrimitive(arg, "string");return QuestL11TempleNostril_typeof(key) === "symbol" ? key : String(key);}function QuestL11TempleNostril_toPrimitive(input, hint) {if (QuestL11TempleNostril_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11TempleNostril_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}





var QuestL11TempleNostril = /*#__PURE__*/function () {function QuestL11TempleNostril() {QuestL11TempleNostril_classCallCheck(this, QuestL11TempleNostril);QuestL11TempleNostril_defineProperty(this, "wool",
    external_kolmafia_.Item.get("Stone Wool"));QuestL11TempleNostril_defineProperty(this, "loc",
    external_kolmafia_.Location.get("The Hidden Temple"));QuestL11TempleNostril_defineProperty(this, "nostril",
    external_kolmafia_.Item.get("The Nostril of the Serpent"));QuestL11TempleNostril_defineProperty(this, "choices", void 0);}QuestL11TempleNostril_createClass(QuestL11TempleNostril, [{ key: "getId", value:


    function getId() {
      return "Council / MacGruffin / Temple / Nostril";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "templeFound", value:

    function templeFound() {
      return (0,external_kolmafia_.getProperty)("questM16Temple") == "finished";
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Worship");

      if (status > 1) {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.availableAmount)(this.nostril) > 0) {
        return QuestStatus.COMPLETED;
      }

      if (status < 0 || !this.templeFound()) {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.availableAmount)(this.wool) == 0) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      return {
        location: null,
        run: function run() {
          (0,external_kolmafia_.use)(_this.wool);

          _this.runTempleChoices();

          greyAdv(
          external_kolmafia_.Location.get("The Hidden Temple"),
          null,
          new AdventureSettings().setChoices(_this.choices));

        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "runTempleChoices", value:

    function runTempleChoices() {
      this.choices = new TempleChoices();

      this.choices.runChoice(582, 1); // Grab nostril
      this.choices.runChoice(579, 2); // Grab nostil
    } }]);return QuestL11TempleNostril;}();var


TempleChoices = /*#__PURE__*/function () {function TempleChoices() {QuestL11TempleNostril_classCallCheck(this, TempleChoices);QuestL11TempleNostril_defineProperty(this, "choices",
    []);}QuestL11TempleNostril_createClass(TempleChoices, [{ key: "calledOutOfScopeChoiceBehavior", value:

    function calledOutOfScopeChoiceBehavior(choiceNo) {
      return false;
    } }, { key: "runChoice", value:

    function runChoice(choiceNo, choicePick) {
      this.choices.push([choiceNo, choicePick]);
    } }, { key: "handleChoice", value:

    function handleChoice(choiceNo) {
      if (this.choices.length == 0) {
        throw "Expected to be handling a choice but uh, wasn't";
      }

      if (this.choices[0][0] != choiceNo) {
        return null;
        /*   throw (
          "Expected to be in choice " +
          this.choices[0][0] +
          " but instead was in choice " +
          choiceNo
        );*/
      }

      var toReturn = this.choices[0][1];
      this.choices.splice(0, 1);

      return toReturn;
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return TempleChoices;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/temple/QuestL11TempleUnlock.ts
function QuestL11TempleUnlock_typeof(obj) {"@babel/helpers - typeof";return QuestL11TempleUnlock_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11TempleUnlock_typeof(obj);}function QuestL11TempleUnlock_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11TempleUnlock_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11TempleUnlock_toPropertyKey(descriptor.key), descriptor);}}function QuestL11TempleUnlock_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11TempleUnlock_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11TempleUnlock_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11TempleUnlock_defineProperty(obj, key, value) {key = QuestL11TempleUnlock_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11TempleUnlock_toPropertyKey(arg) {var key = QuestL11TempleUnlock_toPrimitive(arg, "string");return QuestL11TempleUnlock_typeof(key) === "symbol" ? key : String(key);}function QuestL11TempleUnlock_toPrimitive(input, hint) {if (QuestL11TempleUnlock_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11TempleUnlock_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}










var QuestL11TempleUnlock = /*#__PURE__*/function () {function QuestL11TempleUnlock() {QuestL11TempleUnlock_classCallCheck(this, QuestL11TempleUnlock);QuestL11TempleUnlock_defineProperty(this, "coin",
    external_kolmafia_.Item.get("Tree-holed coin"));QuestL11TempleUnlock_defineProperty(this, "map",
    external_kolmafia_.Item.get("Spooky Temple Map"));QuestL11TempleUnlock_defineProperty(this, "fertilizer",
    external_kolmafia_.Item.get("Spooky-Gro Fertilizer"));QuestL11TempleUnlock_defineProperty(this, "sapling",
    external_kolmafia_.Item.get("Spooky Sapling"));QuestL11TempleUnlock_defineProperty(this, "spookyLoc",
    external_kolmafia_.Location.get("The Spooky Forest"));QuestL11TempleUnlock_defineProperty(this, "choices", void 0);QuestL11TempleUnlock_defineProperty(this, "latte",

    external_kolmafia_.Item.get("Latte lovers member's mug"));QuestL11TempleUnlock_defineProperty(this, "toAbsorb", void 0);}QuestL11TempleUnlock_createClass(QuestL11TempleUnlock, [{ key: "shouldWearLatte", value:


    function shouldWearLatte() {
      return (
        (0,external_kolmafia_.availableAmount)(this.latte) > 0 &&
        !hasUnlockedLatteFlavor(LatteFlavor.FAMILIAR_WEIGHT));

    } }, { key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Temple / Unlock";
    } }, { key: "level", value:

    function level() {
      return 6;
    } }, { key: "status", value:

    function status() {
      if (this.templeFound()) {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.getProperty)("questL02Larva") != "finished") {
        return QuestStatus.NOT_READY;
      }

      if (isGhostBustingTime(this.spookyLoc)) {
        if (shouldAvoidGhosts()) {
          return QuestStatus.NOT_READY;
        }

        return QuestStatus.READY;
      }

      if (!hasNonCombatSkillsReady(false) && (0,external_kolmafia_.myLevel)() >= 5) {
        return QuestStatus.NOT_READY;
      }

      if (!hasNonCombatSkillsReady(true)) {
        return QuestStatus.FASTER_LATER;
      }

      if ((0,external_kolmafia_.getProperty)("questM16Temple") == "unstarted") {

        //   return QuestStatus.NOT_READY;
      }
      if (this.isDelayBurning()) {
        if (DelayBurners.isDelayBurnerReady()) {
          return QuestStatus.READY;
        }

        if (DelayBurners.isDelayBurnerFeasible()) {
          return QuestStatus.FASTER_LATER;
        }
      }

      return QuestStatus.READY;
    } }, { key: "templeFound", value:

    function templeFound() {
      return (0,external_kolmafia_.getProperty)("questM16Temple") == "finished";
    } }, { key: "tryUnlockTemple", value:

    function tryUnlockTemple() {
      if (
      (0,external_kolmafia_.itemAmount)(this.sapling) == 0 ||
      (0,external_kolmafia_.itemAmount)(this.fertilizer) == 0 ||
      (0,external_kolmafia_.itemAmount)(this.map) == 0)
      {
        return;
      }

      (0,external_kolmafia_.use)(this.map);
    } }, { key: "runSpookyChoices", value:

    function runSpookyChoices() {
      this.choices = new QuestL11TempleUnlock_TempleChoices();

      if ((0,external_kolmafia_.itemAmount)(this.coin) == 0 && (0,external_kolmafia_.itemAmount)(this.map) == 0) {
        this.choices.runChoice(502, 2);
        this.choices.runChoice(505, 2);
      } else if ((0,external_kolmafia_.itemAmount)(this.map) == 0) {
        this.choices.runChoice(502, 3);
        this.choices.runChoice(506, 3);
        this.choices.runChoice(507, 1);
      } else if ((0,external_kolmafia_.itemAmount)(this.fertilizer) == 0) {
        this.choices.runChoice(502, 3);
        this.choices.runChoice(506, 3);
        this.choices.runChoice(506, 2);
      } else if ((0,external_kolmafia_.itemAmount)(this.sapling) == 0) {
        this.choices.runChoice(502, 1);
        this.choices.runChoice(503, 3);

        // Sell skins
        if ((0,external_kolmafia_.itemAmount)(external_kolmafia_.Item.get("bar skin")) > 1) {
          this.choices.runChoice(504, 2);
        } else if ((0,external_kolmafia_.itemAmount)(external_kolmafia_.Item.get("bar skin")) > 0) {
          this.choices.runChoice(504, 1);
        }

        this.choices.runChoice(504, 3);
        this.choices.runChoice(504, 4);
      }
    } }, { key: "isDelayBurning", value:

    function isDelayBurning() {
      return this.spookyLoc.turnsSpent < 5 && this.toAbsorb.length == 0;
    } }, { key: "mustBeDone", value:

    function mustBeDone(reallyMustBeDone) {
      if (reallyMustBeDone) {
        return false;
      }

      return isGhostBustingTime(this.spookyLoc);
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return !isGhostBustingTime(this.spookyLoc);
    } }, { key: "run", value:

    function run() {var _this = this;
      var ghostTime = isGhostBustingTime(this.spookyLoc);
      var outfit = ghostTime ? getGhostBustingOutfit() : new GreyOutfit();

      if (this.spookyLoc.turnsSpent >= 5) {
        outfit.setNoCombat();
      }

      if (!this.shouldWearLatte() && this.toAbsorb.length == 0) {
        outfit.addDelayer(
        DelayCriteria().withForcedFights(
        this.spookyLoc.turnsSpent >= 5 ? false : null));


      }

      return {
        location: ghostTime ? null : this.spookyLoc,
        outfit: outfit,
        freeRun: function freeRun() {return true;},
        run: function run() {
          _this.tryUnlockTemple();

          if (_this.templeFound()) {
            return;
          }

          var settings = new AdventureSettings();

          if (isGhostBustingTime(_this.spookyLoc)) {
            settings.setStartOfFightMacro(getGhostBustingMacro());
          }

          if (DelayBurners.isTryingForDupeableGoblin()) {
            (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Grey Goose"));
          }

          _this.runSpookyChoices();

          settings.setChoices(_this.choices);

          greyAdv(_this.spookyLoc, outfit, settings);

          _this.tryUnlockTemple();
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.spookyLoc];
    } }]);return QuestL11TempleUnlock;}();var


QuestL11TempleUnlock_TempleChoices = /*#__PURE__*/function () {function TempleChoices() {QuestL11TempleUnlock_classCallCheck(this, TempleChoices);QuestL11TempleUnlock_defineProperty(this, "choices",
    []);}QuestL11TempleUnlock_createClass(TempleChoices, [{ key: "calledOutOfScopeChoiceBehavior", value:

    function calledOutOfScopeChoiceBehavior(choiceNo) {
      return false;
    } }, { key: "runChoice", value:

    function runChoice(choiceNo, choicePick) {
      this.choices.push([choiceNo, choicePick]);
    } }, { key: "handleChoice", value:

    function handleChoice(choiceNo) {
      if (this.choices.length == 0) {
        throw "Expected to be handling a choice but uh, wasn't";
      }

      if (this.choices[0][0] != choiceNo) {
        return null;
        /*  throw (
          "Expected to be in choice " +
          this.choices[0][0] +
          " but instead was in choice " +
          choiceNo
        );*/
      }

      var toReturn = this.choices[0][1];
      this.choices.splice(0, 1);

      return toReturn;
    } }]);return TempleChoices;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/temple/QuestL11TempleHiddenCity.ts
function QuestL11TempleHiddenCity_typeof(obj) {"@babel/helpers - typeof";return QuestL11TempleHiddenCity_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11TempleHiddenCity_typeof(obj);}function QuestL11TempleHiddenCity_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11TempleHiddenCity_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11TempleHiddenCity_toPropertyKey(descriptor.key), descriptor);}}function QuestL11TempleHiddenCity_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11TempleHiddenCity_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11TempleHiddenCity_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11TempleHiddenCity_defineProperty(obj, key, value) {key = QuestL11TempleHiddenCity_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11TempleHiddenCity_toPropertyKey(arg) {var key = QuestL11TempleHiddenCity_toPrimitive(arg, "string");return QuestL11TempleHiddenCity_typeof(key) === "symbol" ? key : String(key);}function QuestL11TempleHiddenCity_toPrimitive(input, hint) {if (QuestL11TempleHiddenCity_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11TempleHiddenCity_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}





var QuestL11TempleHiddenCity = /*#__PURE__*/function () {function QuestL11TempleHiddenCity() {QuestL11TempleHiddenCity_classCallCheck(this, QuestL11TempleHiddenCity);QuestL11TempleHiddenCity_defineProperty(this, "wool",
    external_kolmafia_.Item.get("Stone Wool"));QuestL11TempleHiddenCity_defineProperty(this, "loc",
    external_kolmafia_.Location.get("The Hidden Temple"));QuestL11TempleHiddenCity_defineProperty(this, "nostril",
    external_kolmafia_.Item.get("The Nostril of the Serpent"));QuestL11TempleHiddenCity_defineProperty(this, "choices", void 0);}QuestL11TempleHiddenCity_createClass(QuestL11TempleHiddenCity, [{ key: "getId", value:


    function getId() {
      return "Council / MacGruffin / Temple / HiddenCity";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL11Worship");

      if (status > 1) {
        return QuestStatus.COMPLETED;
      }

      if (status < 0 || !this.templeFound()) {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.availableAmount)(this.wool) == 0) {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.availableAmount)(this.nostril) == 0) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "templeFound", value:

    function templeFound() {
      return (0,external_kolmafia_.getProperty)("questM16Temple") == "finished";
    } }, { key: "run", value:

    function run() {var _this = this;
      return {
        location: null,
        run: function run() {
          (0,external_kolmafia_.use)(_this.wool);

          _this.runTempleChoices();

          greyAdv(
          external_kolmafia_.Location.get("The Hidden Temple"),
          null,
          new AdventureSettings().setChoices(_this.choices));

        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "runTempleChoices", value:

    function runTempleChoices() {
      this.choices = new QuestL11TempleHiddenCity_TempleChoices();

      this.choices.runChoice(582, 2);
      this.choices.runChoice(580, 2);
      this.choices.runChoice(584, 4);
      this.choices.runChoice(580, 1);
      this.choices.runChoice(123, 2); // Go to puzzle
      // Script should run the banana solver
      this.choices.runChoice(125, 3); // Unlock city
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestL11TempleHiddenCity;}();var


QuestL11TempleHiddenCity_TempleChoices = /*#__PURE__*/function () {function TempleChoices() {QuestL11TempleHiddenCity_classCallCheck(this, TempleChoices);QuestL11TempleHiddenCity_defineProperty(this, "choices",
    []);}QuestL11TempleHiddenCity_createClass(TempleChoices, [{ key: "calledOutOfScopeChoiceBehavior", value:

    function calledOutOfScopeChoiceBehavior(choiceNo) {
      (0,external_kolmafia_.print)("Temple now has choice: " + choiceNo);
      if (choiceNo != 0) {
        return false;
      }

      //   let url = "choice.php?pwd=&whichchoice=" + 123 + "&option=" + 2;
      // visitUrl(url);
      (0,external_kolmafia_.cliExecute)("dvorak"); // Solve puzzle
    } }, { key: "runChoice", value:

    function runChoice(choiceNo, choicePick) {
      this.choices.push([choiceNo, choicePick]);
    } }, { key: "handleChoice", value:

    function handleChoice(choiceNo) {
      if (this.choices.length == 0) {
        throw "Expected to be handling a choice but uh, wasn't";
      }

      if (this.choices[0][0] != choiceNo) {
        return null;
        /*   throw (
          "Expected to be in choice " +
          this.choices[0][0] +
          " but instead was in choice " +
          choiceNo
        );*/
      }

      var toReturn = this.choices[0][1];
      this.choices.splice(0, 1);

      return toReturn;
    } }]);return TempleChoices;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/QuestL11Temple.ts
function QuestL11Temple_typeof(obj) {"@babel/helpers - typeof";return QuestL11Temple_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11Temple_typeof(obj);}function QuestL11Temple_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11Temple_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11Temple_toPropertyKey(descriptor.key), descriptor);}}function QuestL11Temple_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11Temple_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11Temple_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11Temple_defineProperty(obj, key, value) {key = QuestL11Temple_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11Temple_toPropertyKey(arg) {var key = QuestL11Temple_toPrimitive(arg, "string");return QuestL11Temple_typeof(key) === "symbol" ? key : String(key);}function QuestL11Temple_toPrimitive(input, hint) {if (QuestL11Temple_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11Temple_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}
















var QuestL11Temple = /*#__PURE__*/function () {


  function QuestL11Temple() {QuestL11Temple_classCallCheck(this, QuestL11Temple);QuestL11Temple_defineProperty(this, "buildings", []);
    this.buildings.push(new QuestL11Bowling());
    this.buildings.push(new QuestL11Curses());
    this.buildings.push(new QuestL11Business());
    this.buildings.push(new QuestL11Doctor());
    this.buildings.push(new QuestL11HiddenBookMatches());
    this.buildings.push(new QuestL11ShrineVines());
    this.buildings.push(new QuestL11TempleGrabWool());
    this.buildings.push(new QuestL11TempleNostril());
    this.buildings.push(new QuestL11TempleUnlock());
    this.buildings.push(new QuestL11TempleHiddenCity());
    this.buildings.push(new QuestL11HiddenPark());
  }QuestL11Temple_createClass(QuestL11Temple, [{ key: "level", value:

    function level() {
      return 11;
    } }, { key: "getId", value:

    function getId() {
      return "Council / MacGruffin / HiddenCity / Boss";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "getChildren", value:

    function getChildren() {
      return this.buildings;
    } }, { key: "status", value:

    function status() {
      var status = (0,external_kolmafia_.getProperty)("questL11Worship");

      if (status == "finished") {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.getProperty)("questL11MacGuffin") != "step2") {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.getProperty)("questM16Temple") == "unstarted" || this.bossReady()) {
        return QuestStatus.READY;
      }

      return QuestStatus.NOT_READY;
    } }, { key: "run", value:

    function run() {
      if (this.bossReady()) {
        return this.fightBoss();
      }

      return {
        location: null,
        run: function run() {
          (0,external_kolmafia_.visitUrl)("place.php?whichplace=woods&action=woods_dakota_anim");
        }
      };
    } }, { key: "bossReady", value:

    function bossReady() {
      return (0,external_kolmafia_.itemAmount)(external_kolmafia_.Item.get("stone triangle")) >= 4;
    } }, { key: "fightBoss", value:

    function fightBoss() {
      return {
        location: external_kolmafia_.Location.get("A Massive Ziggurat"),
        run: function run() {
          var props = new Properties_PropertyManager();
          props.setChoice(791, 1);

          try {
            greyAdv(external_kolmafia_.Location.get("A Massive Ziggurat"));
          } finally {
            props.resetAll();
          }
        }
      };
    } }]);return QuestL11Temple;}();
;// CONCATENATED MODULE: ./src/quests/council/macgruffin/QuestL11VacationAccess.ts
function QuestL11VacationAccess_typeof(obj) {"@babel/helpers - typeof";return QuestL11VacationAccess_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11VacationAccess_typeof(obj);}function QuestL11VacationAccess_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11VacationAccess_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11VacationAccess_toPropertyKey(descriptor.key), descriptor);}}function QuestL11VacationAccess_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11VacationAccess_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11VacationAccess_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11VacationAccess_toPropertyKey(arg) {var key = QuestL11VacationAccess_toPrimitive(arg, "string");return QuestL11VacationAccess_typeof(key) === "symbol" ? key : String(key);}function QuestL11VacationAccess_toPrimitive(input, hint) {if (QuestL11VacationAccess_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11VacationAccess_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}




var QuestL11ShoreAccess = /*#__PURE__*/function () {function QuestL11ShoreAccess() {QuestL11VacationAccess_classCallCheck(this, QuestL11ShoreAccess);}QuestL11VacationAccess_createClass(QuestL11ShoreAccess, [{ key: "getId", value:
    function getId() {
      return "Council / MacGruffin / Shore";
    } }, { key: "level", value:

    function level() {
      return 7;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastDesertUnlock")) == (0,external_kolmafia_.myAscensions)()) {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.myMeat)() < 6000 || (0,external_kolmafia_.knollAvailable)()) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          (0,external_kolmafia_.buy)(external_kolmafia_.Item.get("Desert Bus pass"));

          if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastDesertUnlock")) != (0,external_kolmafia_.myAscensions)()) {
            throw "Expected desert access";
          }
        }
      };
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }]);return QuestL11ShoreAccess;}();
;// CONCATENATED MODULE: ./src/quests/council/QuestL11MacGruffin.ts
function QuestL11MacGruffin_typeof(obj) {"@babel/helpers - typeof";return QuestL11MacGruffin_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11MacGruffin_typeof(obj);}function QuestL11MacGruffin_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11MacGruffin_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11MacGruffin_toPropertyKey(descriptor.key), descriptor);}}function QuestL11MacGruffin_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11MacGruffin_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11MacGruffin_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11MacGruffin_defineProperty(obj, key, value) {key = QuestL11MacGruffin_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11MacGruffin_toPropertyKey(arg) {var key = QuestL11MacGruffin_toPrimitive(arg, "string");return QuestL11MacGruffin_typeof(key) === "symbol" ? key : String(key);}function QuestL11MacGruffin_toPrimitive(input, hint) {if (QuestL11MacGruffin_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11MacGruffin_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}















var QuestL11MacGruffin = /*#__PURE__*/function () {





  function QuestL11MacGruffin() {QuestL11MacGruffin_classCallCheck(this, QuestL11MacGruffin);QuestL11MacGruffin_defineProperty(this, "questInfo", []);QuestL11MacGruffin_defineProperty(this, "forged", external_kolmafia_.Item.get("Forged Identification Documents"));QuestL11MacGruffin_defineProperty(this, "diary", external_kolmafia_.Item.get("Your Father's Macguffin Diary"));QuestL11MacGruffin_defineProperty(this, "holidaySale", external_kolmafia_.Item.get("post-holiday sale coupon"));
    // Register the subquests
    this.questInfo.push(new QuestL11ShoreAccess());
    this.questInfo.push(new QuestL11Black());
    this.questInfo.push(new QuestL11Palin());
    this.questInfo.push(new QuestL11Shen());
    this.questInfo.push(new QuestL11Desert());
    this.questInfo.push(new QuestL11Manor());
    this.questInfo.push(new QuestL11Pyramid());
    this.questInfo.push(new QuestL11Ron());
    this.questInfo.push(new QuestL11Temple());
  }QuestL11MacGruffin_createClass(QuestL11MacGruffin, [{ key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.getProperty)("questL11Black") == "finished") {
        return QuestStatus.COMPLETED;
      }

      if (
      (0,external_kolmafia_.getProperty)("questL11Black") != "step2" ||
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastDesertUnlock")) != (0,external_kolmafia_.myAscensions)())
      {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.myMeat)() <= 6000) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "getChildren", value:

    function getChildren() {
      return this.questInfo;
    } }, { key: "getId", value:

    function getId() {
      return "Council / MacGruffin / Vacation";
    } }, { key: "run", value:

    function run() {var _this = this;
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          if ((0,external_kolmafia_.availableAmount)(_this.diary) == 0) {
            if ((0,external_kolmafia_.availableAmount)(_this.forged) == 0) {
              // 10% off coupon from pantsgiving
              if ((0,external_kolmafia_.availableAmount)(_this.holidaySale) > 0) {
                (0,external_kolmafia_.use)(_this.holidaySale);
              }

              (0,external_kolmafia_.retrieveItem)(_this.forged);

              if ((0,external_kolmafia_.availableAmount)(_this.forged) == 0) {
                throw _this.forged + " wasn't acquired!";
              }
            }

            var props = new Properties_PropertyManager();

            try {
              props.setChoice(793, 1);

              greyAdv(external_kolmafia_.Location.get("The Shore, Inc. Travel Agency"));

              if ((0,external_kolmafia_.availableAmount)(_this.diary) == 0) {
                throw (
                  "Unexpectably, " +
                  _this.diary +
                  " was not available! Try refresh inventory? Maybe we don't have forged documents");

              }
            } finally {
              props.resetAll();
            }
          }

          if ((0,external_kolmafia_.getProperty)("questL11Desert") != "started") {
            (0,external_kolmafia_.use)(_this.diary);
          }
        }
      };
    } }]);return QuestL11MacGruffin;}();
;// CONCATENATED MODULE: ./src/quests/council/islandwar/QuestL12Battlefield.ts
function QuestL12Battlefield_typeof(obj) {"@babel/helpers - typeof";return QuestL12Battlefield_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL12Battlefield_typeof(obj);}function QuestL12Battlefield_slicedToArray(arr, i) {return QuestL12Battlefield_arrayWithHoles(arr) || QuestL12Battlefield_iterableToArrayLimit(arr, i) || QuestL12Battlefield_unsupportedIterableToArray(arr, i) || QuestL12Battlefield_nonIterableRest();}function QuestL12Battlefield_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function QuestL12Battlefield_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestL12Battlefield_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestL12Battlefield_arrayLikeToArray(o, minLen);}function QuestL12Battlefield_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestL12Battlefield_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function QuestL12Battlefield_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function QuestL12Battlefield_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL12Battlefield_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL12Battlefield_toPropertyKey(descriptor.key), descriptor);}}function QuestL12Battlefield_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL12Battlefield_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL12Battlefield_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL12Battlefield_defineProperty(obj, key, value) {key = QuestL12Battlefield_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL12Battlefield_toPropertyKey(arg) {var key = QuestL12Battlefield_toPrimitive(arg, "string");return QuestL12Battlefield_typeof(key) === "symbol" ? key : String(key);}function QuestL12Battlefield_toPrimitive(input, hint) {if (QuestL12Battlefield_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL12Battlefield_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}









var QuestL12Battlefield = /*#__PURE__*/function () {function QuestL12Battlefield() {QuestL12Battlefield_classCallCheck(this, QuestL12Battlefield);QuestL12Battlefield_defineProperty(this, "loc",
    external_kolmafia_.Location.get("The Battlefield (Frat Uniform)"));QuestL12Battlefield_defineProperty(this, "pole",
    external_kolmafia_.Item.get("eleven-foot pole"));QuestL12Battlefield_defineProperty(this, "ring",
    external_kolmafia_.Item.get("ring of Detect Boring Doors"));QuestL12Battlefield_defineProperty(this, "picklocks",
    external_kolmafia_.Item.get("Pick-O-Matic lockpicks"));QuestL12Battlefield_defineProperty(this, "gelCube",
    external_kolmafia_.Familiar.get("Gelatinous Cubeling"));QuestL12Battlefield_defineProperty(this, "jellyfish",
    external_kolmafia_.Familiar.get("Space Jellyfish"));QuestL12Battlefield_defineProperty(this, "goose",
    external_kolmafia_.Familiar.get("Grey Goose"));QuestL12Battlefield_defineProperty(this, "orchadAt",
    64);QuestL12Battlefield_defineProperty(this, "nunsAt",
    192);}QuestL12Battlefield_createClass(QuestL12Battlefield, [{ key: "level", value:

    function level() {
      return 12;
    } }, { key: "getTurnsInBattlefield", value:

    function getTurnsInBattlefield() {
      var completedTurns = [
      ["sidequestArenaCompleted", 0],
      ["sidequestLighthouseCompleted", 0],
      ["sidequestJunkyardCompleted", 0],
      ["sidequestOrchardCompleted", 64],
      ["sidequestNunsCompleted", 192]];


      var hippiesDefeated = this.getHippiesDefeated();
      var turns = 0;

      while (hippiesDefeated < 1000) {
        var defeatPerTurn = 1;
        var sidequests = completedTurns.filter(
        function (_ref) {var _ref2 = QuestL12Battlefield_slicedToArray(_ref, 2),turns = _ref2[1];return hippiesDefeated >= turns;}).
        length;

        for (var i = 0; i < sidequests; i++) {
          defeatPerTurn = defeatPerTurn * 2;
        }

        hippiesDefeated += defeatPerTurn;
        turns++;
      }

      return turns;
    } }, { key: "status", value:

    function status() {
      if (
      !this.isArenaDone() ||
      !this.isLobsterDone() ||
      !this.isGremlinsDone())
      {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.getProperty)("warProgress") == "finished") {
        return QuestStatus.COMPLETED;
      }

      var defeated = this.getHippiesDefeated();

      if (defeated >= 64 && !this.isFilthyDone()) {
        return QuestStatus.NOT_READY;
      }

      if (defeated >= 192 && !this.isNunsDone()) {
        return QuestStatus.NOT_READY;
      }

      if (defeated >= 1000) {
        return QuestStatus.COMPLETED;
      }

      if (
      getQuestStatus("questL11Pyramid") == 3 &&
      (0,external_kolmafia_.getProperty)("pyramidBombUsed") == "true")
      {
        return QuestStatus.READY;
      }

      return QuestStatus.FASTER_LATER;
    } }, { key: "getId", value:

    function getId() {
      return "Council / War / Battlefield";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();
      outfit.addWeight(external_kolmafia_.Item.get("Beer Helmet"));
      outfit.addWeight(external_kolmafia_.Item.get("distressed denim pants"));
      outfit.addWeight(external_kolmafia_.Item.get("bejeweled pledge pin"));

      var fam = null;

      if (
      (0,external_kolmafia_.haveFamiliar)(this.gelCube) && (
      (0,external_kolmafia_.availableAmount)(this.pole) == 0 ||
      (0,external_kolmafia_.availableAmount)(this.ring) == 0 ||
      (0,external_kolmafia_.availableAmount)(this.picklocks) == 0))
      {
        fam = this.gelCube;
      } else if (
      (0,external_kolmafia_.haveFamiliar)(this.jellyfish) && (
      !GreySettings_GreySettings.greyPrepareLevelingResources ||
      (0,external_kolmafia_.familiarWeight)(this.goose) >= 20 ||
      GreyAbsorber_AbsorbsProvider.remainingAdvAbsorbs == null ||
      GreyAbsorber_AbsorbsProvider.remainingAdvAbsorbs.length > 3))
      {
        fam = this.jellyfish;
      }

      return {
        outfit: outfit,
        location: this.loc,
        familiar: fam,
        disableFamOverride: fam == this.gelCube,
        mayFreeRun: false,
        run: function run() {
          if (fam == null && (0,external_kolmafia_.familiarWeight)(_this.goose) >= 6) {
            var burner = DelayBurners.getReadyDelayBurner();

            if (burner != null && burner instanceof DelayBurningKramco) {
              burner.doFightSetup();
            }

            if (DelayBurners.isTryingForDupeableGoblin()) {
              (0,external_kolmafia_.useFamiliar)(_this.goose);
            }
          }

          greyAdv(_this.loc, outfit);

          var turns = _this.getTurnsInBattlefield();
          if (turns > 0) {
            (0,external_kolmafia_.print)("".concat(
            turns, " turn").concat(
            turns == 1 ? "" : "s", " until the battlefield is cleared at current sidequest completion."),

            "blue");

          } else {
            (0,external_kolmafia_.print)(
            "Battlefield has been cleared! Hipster boss spotted eating BBQ'd sushi before it's cool! This (obviously) enrages you!",
            "blue");

          }
        }
      };
    } }, { key: "getHippiesDefeated", value:

    function getHippiesDefeated() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("hippiesDefeated"));
    } }, { key: "isGremlinsDone", value:

    function isGremlinsDone() {
      return (0,external_kolmafia_.getProperty)("sidequestJunkyardCompleted") != "none";
    } }, { key: "isArenaDone", value:

    function isArenaDone() {
      return (0,external_kolmafia_.getProperty)("sidequestArenaCompleted") != "none";
    } }, { key: "isLobsterDone", value:

    function isLobsterDone() {
      return (0,external_kolmafia_.getProperty)("sidequestLighthouseCompleted") != "none";
    } }, { key: "isFilthyDone", value:

    function isFilthyDone() {
      return (0,external_kolmafia_.getProperty)("sidequestOrchardCompleted") != "none";
    } }, { key: "isNunsDone", value:

    function isNunsDone() {
      return (0,external_kolmafia_.getProperty)("sidequestNunsCompleted") != "none";
    } }]);return QuestL12Battlefield;}();
;// CONCATENATED MODULE: ./src/quests/council/islandwar/QuestL12FratOutfit.ts
function QuestL12FratOutfit_typeof(obj) {"@babel/helpers - typeof";return QuestL12FratOutfit_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL12FratOutfit_typeof(obj);}function QuestL12FratOutfit_slicedToArray(arr, i) {return QuestL12FratOutfit_arrayWithHoles(arr) || QuestL12FratOutfit_iterableToArrayLimit(arr, i) || QuestL12FratOutfit_unsupportedIterableToArray(arr, i) || QuestL12FratOutfit_nonIterableRest();}function QuestL12FratOutfit_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function QuestL12FratOutfit_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function QuestL12FratOutfit_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function QuestL12FratOutfit_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestL12FratOutfit_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestL12FratOutfit_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestL12FratOutfit_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestL12FratOutfit_arrayLikeToArray(o, minLen);}function QuestL12FratOutfit_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestL12FratOutfit_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL12FratOutfit_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL12FratOutfit_toPropertyKey(descriptor.key), descriptor);}}function QuestL12FratOutfit_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL12FratOutfit_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL12FratOutfit_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL12FratOutfit_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestL12FratOutfit_setPrototypeOf(subClass, superClass);}function QuestL12FratOutfit_setPrototypeOf(o, p) {QuestL12FratOutfit_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestL12FratOutfit_setPrototypeOf(o, p);}function QuestL12FratOutfit_createSuper(Derived) {var hasNativeReflectConstruct = QuestL12FratOutfit_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestL12FratOutfit_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestL12FratOutfit_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestL12FratOutfit_possibleConstructorReturn(this, result);};}function QuestL12FratOutfit_possibleConstructorReturn(self, call) {if (call && (QuestL12FratOutfit_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestL12FratOutfit_assertThisInitialized(self);}function QuestL12FratOutfit_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestL12FratOutfit_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestL12FratOutfit_getPrototypeOf(o) {QuestL12FratOutfit_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestL12FratOutfit_getPrototypeOf(o);}function QuestL12FratOutfit_defineProperty(obj, key, value) {key = QuestL12FratOutfit_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL12FratOutfit_toPropertyKey(arg) {var key = QuestL12FratOutfit_toPrimitive(arg, "string");return QuestL12FratOutfit_typeof(key) === "symbol" ? key : String(key);}function QuestL12FratOutfit_toPrimitive(input, hint) {if (QuestL12FratOutfit_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL12FratOutfit_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}










var


WarTag;(function (WarTag) {WarTag["BEFORE_WAR"] = "Before War";WarTag["DURING_WAR"] = "During War";})(WarTag || (WarTag = {}));var



YROutfit;(function (YROutfit) {YROutfit["YR_HIPPY"] = "YR Hippy";YROutfit["YR_FRAT"] = "YR Frat";})(YROutfit || (YROutfit = {}));




var QuestL12FratOutfit = /*#__PURE__*/function (_TaskInfo) {QuestL12FratOutfit_inherits(QuestL12FratOutfit, _TaskInfo);var _super = QuestL12FratOutfit_createSuper(QuestL12FratOutfit);








  function QuestL12FratOutfit() {var _this;QuestL12FratOutfit_classCallCheck(this, QuestL12FratOutfit);
    _this = _super.call(this);QuestL12FratOutfit_defineProperty(QuestL12FratOutfit_assertThisInitialized(_this), "fratBoySpy", external_kolmafia_.Monster.get("Orcish Frat Boy Spy"));QuestL12FratOutfit_defineProperty(QuestL12FratOutfit_assertThisInitialized(_this), "hippyDisguise", "Filthy Hippy Disguise");QuestL12FratOutfit_defineProperty(QuestL12FratOutfit_assertThisInitialized(_this), "fratDisguise", "Frat Warrior Fatigues");QuestL12FratOutfit_defineProperty(QuestL12FratOutfit_assertThisInitialized(_this), "hippyCamp", external_kolmafia_.Location.get("Hippy Camp"));QuestL12FratOutfit_defineProperty(QuestL12FratOutfit_assertThisInitialized(_this), "fratCamp", external_kolmafia_.Location.get("Wartime Frat House (Hippy Disguise)"));QuestL12FratOutfit_defineProperty(QuestL12FratOutfit_assertThisInitialized(_this), "paths", void 0);QuestL12FratOutfit_defineProperty(QuestL12FratOutfit_assertThisInitialized(_this), "recalculateTime", void 0);return _this;
  }QuestL12FratOutfit_createClass(QuestL12FratOutfit, [{ key: "createPaths", value:

    function createPaths(assumeUnstarted) {
      this.recalculateTime = false;

      var hippyNeeded = (0,external_kolmafia_.outfitPieces)(this.hippyDisguise).filter(
      function (i) {return assumeUnstarted || (0,external_kolmafia_.availableAmount)(i) == 0;});

      var fratNeeded = (0,external_kolmafia_.outfitPieces)(this.fratDisguise).filter(
      function (i) {return assumeUnstarted || (0,external_kolmafia_.availableAmount)(i) == 0;});


      this.paths = [];

      var pullTask = new PossiblePath(0);var _iterator = QuestL12FratOutfit_createForOfIteratorHelper(

        fratNeeded),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var item = _step.value;
          pullTask.addPull(item);
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

      this.paths.push(pullTask);

      if (fratNeeded.length == 0) {
        return;
      }

      this.paths.push(
      new PossiblePath(1).
      addFax(this.fratBoySpy).
      add(ResourceCategory.YELLOW_RAY));

      this.paths.push(
      new PossiblePath(0).
      add(ResourceCategory.CARGO_SHORTS).
      add(ResourceCategory.YELLOW_RAY).
      addIgnored("Cosplay Saber"));


      // During the war, lets say 60% chance to hit a combat

      // Tag, Resources, Turns
      var type = [];
      var needHippies = hippyNeeded.length > 0;

      if (needHippies) {
        if (assumeUnstarted || (0,external_kolmafia_.myLevel)() < 12) {
          type.push(["Hippy", WarTag.BEFORE_WAR, YROutfit.YR_HIPPY, 1]);
        }

        type.push(["Hippy", WarTag.DURING_WAR, null, hippyNeeded.length * 6]);
        type.push(["Hippy", WarTag.DURING_WAR, YROutfit.YR_HIPPY, 3]);
      }

      type.push(["Frat", WarTag.DURING_WAR, YROutfit.YR_FRAT, 1]);
      type.push(["Frat", WarTag.DURING_WAR, null, fratNeeded.length * 6]);var _iterator2 = QuestL12FratOutfit_createForOfIteratorHelper(

        getAllCombinations(type, true)),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var combo = _step2.value;
          if (combo.length != (needHippies ? 2 : 1)) {
            continue;
          }

          if (needHippies && combo[0][0] == combo[1][0]) {
            continue;
          }

          var path = new PossiblePath(
          combo.map(function (_ref) {var _ref2 = QuestL12FratOutfit_slicedToArray(_ref, 4),turns = _ref2[3];return turns;}).reduce(function (t1, t2) {return t1 + t2;}, 0));var _iterator3 = QuestL12FratOutfit_createForOfIteratorHelper(


            combo),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var _step3$value = QuestL12FratOutfit_slicedToArray(_step3.value, 3),tag = _step3$value[1],resource = _step3$value[2];
              path.addTag(tag);

              if (resource != null) {
                path.add(ResourceCategory.YELLOW_RAY);
                path.addTag(resource);
              }
            }} catch (err) {_iterator3.e(err);} finally {_iterator3.f();}

          this.paths.push(path);
        }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "getId", value:

    function getId() {
      return "Council / War / Frat Outfit";
    } }, { key: "level", value:

    function level() {
      return 5;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return this.recalculateTime;
    } }, { key: "free", value:

    function free() {
      return this.recalculateTime;
    } }, { key: "status", value:

    function status(path) {
      GreySettings_GreySettings.greyHippyMode = false;

      if (this.haveOutfit(this.fratDisguise)) {
        return QuestStatus.COMPLETED;
      }

      if (path == null) {
        return QuestStatus.READY;
      }

      if (path.canUse(ResourceCategory.PULL)) {
        if ((0,external_kolmafia_.myLevel)() < 12) {
          return QuestStatus.NOT_READY;
        } else {
          return QuestStatus.READY;
        }
      }

      if (path.hasTag(WarTag.BEFORE_WAR)) {
        if (this.haveOutfit(this.hippyDisguise)) {
          path.removeTag(WarTag.BEFORE_WAR);
        } else if ((0,external_kolmafia_.myLevel)() >= 12) {
          this.recalculateTime = true;

          return QuestStatus.READY;
        }
      }

      GreySettings_GreySettings.greyHippyMode = path.hasTag(WarTag.BEFORE_WAR);

      if (
      path.canUse(ResourceCategory.YELLOW_RAY) &&
      !path.getResource(ResourceCategory.YELLOW_RAY).ready())
      {
        return QuestStatus.NOT_READY;
      }

      if (
      path.canUse(ResourceCategory.FAXER) ||
      path.canUse(ResourceCategory.CARGO_SHORTS))
      {
        return QuestStatus.READY;
      }

      if ((0,external_kolmafia_.myLevel)() >= 12 && (0,external_kolmafia_.getProperty)("questL12War") == "unstarted") {
        return QuestStatus.NOT_READY;
      }

      if (path.hasTag(WarTag.BEFORE_WAR) && (0,external_kolmafia_.myLevel)() >= 12) {
        this.recalculateTime = true;

        return QuestStatus.READY;
      }

      if (
      !path.hasTag(WarTag.BEFORE_WAR) &&
      path.hasTag(WarTag.DURING_WAR) &&
      (0,external_kolmafia_.getProperty)("questL12War") == "unstarted")
      {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastIslandUnlock")) != (0,external_kolmafia_.myAscensions)()) {
        return QuestStatus.NOT_READY;
      }

      if (!path.hasTag(WarTag.BEFORE_WAR) && (0,external_kolmafia_.myLevel)() < 12) {
        return QuestStatus.NOT_READY;
      }

      // Doesn't meet stat requirements
      if (
      this.haveOutfit(this.hippyDisguise) &&
      !(0,external_kolmafia_.haveOutfit)(this.hippyDisguise))
      {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run(path) {
      if (this.recalculateTime) {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {
            AdventureFinder.recalculatePath();
          }
        };
      }

      if (path.canUse(ResourceCategory.PULL)) {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {
            GreyPulls.pullFratWarOutfit();
          }
        };
      }

      if (
      path.canUse(ResourceCategory.FAXER) ||
      path.canUse(ResourceCategory.CARGO_SHORTS))
      {
        return this.runFaxFight(path);
      }

      if (path.hasTag(WarTag.BEFORE_WAR)) {
        if (this.haveOutfit(this.hippyDisguise) || (0,external_kolmafia_.myLevel)() >= 12) {
          throw "Unable to grab hippy disguise, war has already started";
        }

        return this.runPreWar(path);
      } else if ((0,external_kolmafia_.myLevel)() < 12) {
        throw "Eh? War hasn't started yet";
      }

      return this.runDuringWar(path);
    } }, { key: "runDuringWar", value:

    function runDuringWar(path) {var _this2 = this;
      var outfit = new GreyOutfit();
      outfit.setPlusCombat();

      var grabbingHippyOutfit = !this.haveOutfit(this.hippyDisguise);
      var grabbingFratOutfit = !grabbingHippyOutfit;

      if (grabbingFratOutfit) {
        outfit.addExtra("+outfit " + this.hippyDisguise);
      }

      var yellowRay = path.getResource(ResourceCategory.YELLOW_RAY);

      if (yellowRay != null) {
        if (!path.hasTag(YROutfit.YR_HIPPY) && !path.hasTag(YROutfit.YR_FRAT)) {
          yellowRay.prepare(outfit);
        } else if (path.hasTag(YROutfit.YR_HIPPY) && grabbingHippyOutfit) {
          yellowRay.prepare(outfit);
        } else if (path.hasTag(YROutfit.YR_FRAT) && grabbingFratOutfit) {
          yellowRay.prepare(outfit);
        } else {
          yellowRay = null;
        }
      }

      if (yellowRay == null) {
        outfit.setItemDrops();
      }

      var loc = grabbingFratOutfit ? this.fratCamp : this.hippyCamp;

      return {
        location: loc,
        outfit: outfit,
        run: function run() {
          if (grabbingFratOutfit && !(0,external_kolmafia_.isWearingOutfit)(_this2.hippyDisguise)) {
            throw "Expected to be dressed like a grubby hippy";
          }

          var props = new Properties_PropertyManager();

          props.setChoice(139, 3);
          props.setChoice(140, 3);
          props.setChoice(141, 3);
          props.setChoice(142, 4);

          props.setChoice(143, 3); // Fight
          props.setChoice(144, 3); // Fight
          props.setChoice(145, 2); // Items
          props.setChoice(146, 2); // Items

          try {
            var settings = new AdventureSettings();

            if (yellowRay != null) {
              yellowRay.prepare(null, props);
              var macro = new Macro();

              macro = macro.if_("monstername Hippy", yellowRay.macro());
              macro = macro.if_("monstername War Pledge", yellowRay.macro());
              macro = macro.if_(
              "monstername Frat Warrior drill sergeant",
              yellowRay.macro());

              settings.setStartOfFightMacro(macro);
            }

            greyAdv(loc, outfit, settings);
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "runPreWar", value:

    function runPreWar(path) {var _this3 = this;
      var outfit = new GreyOutfit();

      var yr = path.hasTag(YROutfit.YR_HIPPY) ?
      path.getResource(ResourceCategory.YELLOW_RAY) :
      null;

      if (yr != null) {
        yr.prepare(outfit, null);
      } else {
        outfit.setItemDrops();

        if ((0,external_kolmafia_.myLevel)() >= 9) {
          outfit.setNoCombat();
        }
      }

      return {
        location: this.hippyCamp,
        outfit: outfit,
        run: function run() {
          var props = new Properties_PropertyManager();

          var settings = new AdventureSettings();
          var hasPants = (0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("filthy corduroys")) > 0;

          props.setChoice(136, hasPants ? 2 : 1);
          props.setChoice(137, hasPants ? 1 : 2);

          if (yr != null) {
            yr.prepare(null, props);

            settings.setStartOfFightMacro(
            Macro.if_("monstername Hippy", yr.macro()));

          }

          try {
            greyAdv(_this3.hippyCamp, outfit, settings);
          } finally {
            props.resetAll();
          }

          if (_this3.haveOutfit(_this3.hippyDisguise)) {
            path.removeTag(WarTag.BEFORE_WAR);
          }
        }
      };
    } }, { key: "haveOutfit", value:

    function haveOutfit(outfit) {
      return (0,external_kolmafia_.outfitPieces)(outfit).find(function (i) {return (0,external_kolmafia_.availableAmount)(i) == 0;}) == null;
    } }, { key: "runFaxFight", value:

    function runFaxFight(path) {var _this4 = this;
      var outfit = new GreyOutfit();

      var yr = path.getResource(ResourceCategory.YELLOW_RAY);
      yr.prepare(outfit);

      var faxing = path.getResource(ResourceCategory.FAXER);

      if (faxing != null) {
        faxing.prepare(outfit);
      }

      return {
        location: null,
        outfit: outfit,
        run: function run() {
          var props = new Properties_PropertyManager();

          try {
            yr.prepare(null, props);

            if (faxing != null) {
              faxing.fax(_this4.fratBoySpy);
            } else {
              path.getResource(ResourceCategory.CARGO_SHORTS).pocket(568);
            }

            if ((0,external_kolmafia_.currentRound)() == 0) {
              throw "Expected to be in combat!";
            }

            path.getResource(ResourceCategory.YELLOW_RAY).macro().submit();

            greyAdv("main.php");

            if ((0,external_kolmafia_.currentRound)() != 0 || (0,external_kolmafia_.handlingChoice)()) {
              throw "Expected to have finished combat!";
            }

            if (!_this4.haveOutfit(_this4.fratDisguise)) {
              throw "Expected to have outfit!";
            }
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }]);return QuestL12FratOutfit;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/islandwar/QuestL12Nuns.ts
function QuestL12Nuns_typeof(obj) {"@babel/helpers - typeof";return QuestL12Nuns_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL12Nuns_typeof(obj);}function QuestL12Nuns_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestL12Nuns_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestL12Nuns_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestL12Nuns_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestL12Nuns_arrayLikeToArray(o, minLen);}function QuestL12Nuns_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestL12Nuns_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL12Nuns_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL12Nuns_toPropertyKey(descriptor.key), descriptor);}}function QuestL12Nuns_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL12Nuns_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL12Nuns_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL12Nuns_defineProperty(obj, key, value) {key = QuestL12Nuns_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL12Nuns_toPropertyKey(arg) {var key = QuestL12Nuns_toPrimitive(arg, "string");return QuestL12Nuns_typeof(key) === "symbol" ? key : String(key);}function QuestL12Nuns_toPrimitive(input, hint) {if (QuestL12Nuns_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL12Nuns_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var Quest12WarNuns = /*#__PURE__*/function () {function Quest12WarNuns() {QuestL12Nuns_classCallCheck(this, Quest12WarNuns);QuestL12Nuns_defineProperty(this, "loc",
    external_kolmafia_.Location.get("The Themthar Hills"));QuestL12Nuns_defineProperty(this, "lep",
    external_kolmafia_.Familiar.get("Leprechaun"));QuestL12Nuns_defineProperty(this, "hobo",
    external_kolmafia_.Familiar.get("Hobo Monkey"));QuestL12Nuns_defineProperty(this, "robor",
    external_kolmafia_.Familiar.get("Robortender"));QuestL12Nuns_defineProperty(this, "tot",
    external_kolmafia_.Familiar.get("Trick-or-Treating Tot"));QuestL12Nuns_defineProperty(this, "item",
    external_kolmafia_.Item.get("li'l pirate costume"));QuestL12Nuns_defineProperty(this, "hotness",

    external_kolmafia_.Item.get("Mick's IcyVapoHotness Inhaler"));QuestL12Nuns_defineProperty(this, "effect",
    (0,external_kolmafia_.effectModifier)(this.hotness, "Effect"));QuestL12Nuns_defineProperty(this, "winkles",
    external_kolmafia_.Effect.get("Winklered"));QuestL12Nuns_defineProperty(this, "bowlStraightUp",
    external_kolmafia_.Effect.get("Cosmic Ball in the Air"));QuestL12Nuns_defineProperty(this, "cosmicBall",
    external_kolmafia_.Item.get("Cosmic Bowling Ball"));QuestL12Nuns_defineProperty(this, "asdonMartin",
    external_kolmafia_.Item.get("Asdon Martin keyfob"));QuestL12Nuns_defineProperty(this, "driving",
    external_kolmafia_.Effect.get("Driving Observantly"));QuestL12Nuns_defineProperty(this, "meatPotions",
    [
    "Savings Bond",
    "Autumn Dollar",
    "Polka Pop",
    "Pink candy heart"].
    map(function (s) {return external_kolmafia_.Item.get(s);}));QuestL12Nuns_defineProperty(this, "fishHead",

    external_kolmafia_.Item.get("Fish Head"));QuestL12Nuns_defineProperty(this, "boxedWine",
    external_kolmafia_.Item.get("Boxed Wine"));QuestL12Nuns_defineProperty(this, "piscatini",
    external_kolmafia_.Item.get("Piscatini"));QuestL12Nuns_defineProperty(this, "grapefruit",
    external_kolmafia_.Item.get("Grapefruit"));QuestL12Nuns_defineProperty(this, "driveby",
    external_kolmafia_.Item.get("Drive-by shooting"));QuestL12Nuns_defineProperty(this, "grapes",
    external_kolmafia_.Item.get("Bunch of square grapes"));QuestL12Nuns_defineProperty(this, "roborDrinks",

    [this.fishHead, this.piscatini, this.driveby]);}QuestL12Nuns_createClass(Quest12WarNuns, [{ key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }, { key: "hasMeatBooze", value:

    function hasMeatBooze() {
      return this.roborDrinks.find(function (i) {return (0,external_kolmafia_.availableAmount)(i) > 0;}) != null;
    } }, { key: "hasDrunkMeat", value:

    function hasDrunkMeat() {
      return (0,external_kolmafia_.getProperty)("_roboDrinks").includes("drive-by shooting");
    } }, { key: "getFamiliarToUse", value:

    function getFamiliarToUse(allownNull) {
      if ((0,external_kolmafia_.haveFamiliar)(this.tot) && (0,external_kolmafia_.availableAmount)(this.item) > 0) {
        return this.tot;
      }

      if (
      (0,external_kolmafia_.haveFamiliar)(this.robor) && (
      this.hasMeatBooze() || this.hasDrunkMeat()))
      {
        return this.robor;
      }

      if (allownNull) {
        return null;
      }

      return (0,external_kolmafia_.haveFamiliar)(this.hobo) ?
      this.hobo :
      (0,external_kolmafia_.haveFamiliar)(this.lep) ?
      this.lep :
      null;
    } }, { key: "hasFamiliarRecommendation", value:

    function hasFamiliarRecommendation() {
      var toLevel = this.getFamiliarToUse(true);

      if (toLevel == this.tot) {
        return;
      }

      if (toLevel != null && (0,external_kolmafia_.familiarWeight)(toLevel) < 20) {
        return toLevel;
      }

      return null;
    } }, { key: "doRoboDrinks", value:

    function doRoboDrinks() {
      if (
      !(0,external_kolmafia_.haveFamiliar)(this.robor) ||
      this.hasDrunkMeat() ||
      !this.hasMeatBooze())
      {
        return;
      }

      // If no driveby on hand
      if ((0,external_kolmafia_.availableAmount)(this.driveby) == 0) {
        // If no way to get grapefruit
        if (
        (0,external_kolmafia_.availableAmount)(this.grapefruit) == 0 &&
        (0,external_kolmafia_.getProperty)("sidequestOrchardCompleted") == "none")
        {
          return;
        }

        // If we need pisc
        if ((0,external_kolmafia_.availableAmount)(this.piscatini) == 0) {
          // If we can't make pisc
          if (
          (0,external_kolmafia_.availableAmount)(this.fishHead) == 0 ||
          (0,external_kolmafia_.availableAmount)(this.boxedWine) == 0)
          {
            return;
          }
        }
      }

      // Now check if we can make this

      if ((0,external_kolmafia_.availableAmount)(this.driveby) == 0) {
        (0,external_kolmafia_.cliExecute)("create " + this.driveby.name);
      }

      (0,external_kolmafia_.useFamiliar)(this.robor);
      (0,external_kolmafia_.cliExecute)("robo drive-by shooting");
    } }, { key: "level", value:

    function level() {
      return 12;
    } }, { key: "getId", value:

    function getId() {
      return "Council / War / Nuns";
    } }, { key: "isBowlingBallNextCombat", value:

    function isBowlingBallNextCombat() {
      return (
        (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("cosmicBowlingBallReturnCombats")) <= 0 ||
        (0,external_kolmafia_.availableAmount)(this.cosmicBall) > 0);

    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.getProperty)("sidequestNunsCompleted") != "none") {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.availableAmount)(this.item) == 0) {
        this.doRoboDrinks();
      }

      if (
      (0,external_kolmafia_.getProperty)("warProgress") != "started" ||
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("hippiesDefeated")) < 192)
      {
        return QuestStatus.NOT_READY;
      }

      if (
      !(0,external_kolmafia_.haveSkill)(external_kolmafia_.Skill.get("Financial Spreadsheets")) &&
      GreySettings_GreySettings.greyMeatSkill != "No")
      {
        return QuestStatus.FASTER_LATER;
      }

      if (
      !this.mustBeDone() &&
      (0,external_kolmafia_.getProperty)("hasCosmicBowlingBall") == "true" &&
      !(0,external_kolmafia_.haveEffect)(this.bowlStraightUp) &&
      !this.isBowlingBallNextCombat())
      {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.FASTER_LATER;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();
      outfit.addWeight(external_kolmafia_.Item.get("Beer Helmet"));
      outfit.addWeight(external_kolmafia_.Item.get("distressed denim pants"));
      outfit.addWeight(external_kolmafia_.Item.get("bejeweled pledge pin"));
      outfit.meatDropWeight = 10;

      var fam = this.getFamiliarToUse(false);

      if (fam == this.tot) {
        outfit.addWeight(this.item);
      }

      return {
        familiar: fam,
        location: this.loc,
        outfit: outfit,
        disableFamOverride: fam != null,
        run: function run() {
          if (_this.getMeat() == 0) {
            _this.visitNuns();
            (0,external_kolmafia_.cliExecute)("boombox meat");
          }

          _this.tryToBuff();

          var meat = _this.getMeat();

          greyAdv(
          _this.loc,
          outfit,
          new AdventureSettings().setStartOfFightMacro(
          Macro.trySkill("sing along").trySkill(external_kolmafia_.Skill.get("Bowl Straight Up"))));



          if (meat >= _this.getMeat() || _this.getMeat() >= 100000) {
            _this.visitNuns();

            if (_this.status() == QuestStatus.COMPLETED) {
              (0,external_kolmafia_.cliExecute)("boombox food");
            }
          }

          (0,external_kolmafia_.print)("Turns Taken: ".concat(
          _this.loc.turnsSpent, ", that's approx ").concat(Math.round(
          _this.getMeat() / _this.loc.turnsSpent), " meat per adventure! ").concat(
          _this.getMeat(), " / 100,000 collected."),
          "blue");

        }
      };
    } }, { key: "visitNuns", value:

    function visitNuns() {
      (0,external_kolmafia_.visitUrl)("bigisland.php?place=nunnery");
    } }, { key: "getMeat", value:

    function getMeat() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("currentNunneryMeat"));
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return (0,external_kolmafia_.haveEffect)(this.effect) + (0,external_kolmafia_.haveEffect)(this.winkles) > 0;
    } }, { key: "tryToBuff", value:

    function tryToBuff() {
      if (
      (0,external_kolmafia_.getWorkshed)() == this.asdonMartin &&
      (0,external_kolmafia_.getFuel)() > 37 &&
      (0,external_kolmafia_.haveEffect)(this.driving) == 0)
      {
        (0,external_kolmafia_.cliExecute)("asdonmartin drive Observantly");
      }

      /* if (!this.hasAlreadyPulled()) {
        GreyPulls.pullMeatBuffers();
         use(this.hotness);
      }*/


      if (!(0,external_kolmafia_.toBoolean)((0,external_kolmafia_.getProperty)("concertVisited"))) {
        (0,external_kolmafia_.cliExecute)("concert 2"); // Feeling wrinkled
      }var _iterator = QuestL12Nuns_createForOfIteratorHelper(

        this.meatPotions),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var i = _step.value;
          if ((0,external_kolmafia_.itemAmount)(i) == 0) {
            continue;
          }

          var effect = (0,external_kolmafia_.effectModifier)(i, "Effect");

          if ((0,external_kolmafia_.haveEffect)(effect) > 0) {
            continue;
          }

          // How much meat will drop from this effect
          // Multiply by 10 to get 1k meat from 100% meat, then multiply by duration which is assumed to be 10
          var meatWorth = (0,external_kolmafia_.numericModifier)(effect, "Meat Drop") * 10 * 10;

          if (
          (0,external_kolmafia_.historicalPrice)(i) >
          GreySettings_GreySettings.greyValueOfAdventure * (meatWorth / 1000.0))
          {
            continue;
          }

          (0,external_kolmafia_.use)(i);
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return Quest12WarNuns;}();
;// CONCATENATED MODULE: ./src/quests/council/islandwar/QuestL12StartWar.ts
function QuestL12StartWar_typeof(obj) {"@babel/helpers - typeof";return QuestL12StartWar_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL12StartWar_typeof(obj);}function QuestL12StartWar_slicedToArray(arr, i) {return QuestL12StartWar_arrayWithHoles(arr) || QuestL12StartWar_iterableToArrayLimit(arr, i) || QuestL12StartWar_unsupportedIterableToArray(arr, i) || QuestL12StartWar_nonIterableRest();}function QuestL12StartWar_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function QuestL12StartWar_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function QuestL12StartWar_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function QuestL12StartWar_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestL12StartWar_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestL12StartWar_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestL12StartWar_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestL12StartWar_arrayLikeToArray(o, minLen);}function QuestL12StartWar_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestL12StartWar_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL12StartWar_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL12StartWar_toPropertyKey(descriptor.key), descriptor);}}function QuestL12StartWar_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL12StartWar_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL12StartWar_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL12StartWar_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestL12StartWar_setPrototypeOf(subClass, superClass);}function QuestL12StartWar_setPrototypeOf(o, p) {QuestL12StartWar_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestL12StartWar_setPrototypeOf(o, p);}function QuestL12StartWar_createSuper(Derived) {var hasNativeReflectConstruct = QuestL12StartWar_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestL12StartWar_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestL12StartWar_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestL12StartWar_possibleConstructorReturn(this, result);};}function QuestL12StartWar_possibleConstructorReturn(self, call) {if (call && (QuestL12StartWar_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestL12StartWar_assertThisInitialized(self);}function QuestL12StartWar_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestL12StartWar_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestL12StartWar_getPrototypeOf(o) {QuestL12StartWar_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestL12StartWar_getPrototypeOf(o);}function QuestL12StartWar_defineProperty(obj, key, value) {key = QuestL12StartWar_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL12StartWar_toPropertyKey(arg) {var key = QuestL12StartWar_toPrimitive(arg, "string");return QuestL12StartWar_typeof(key) === "symbol" ? key : String(key);}function QuestL12StartWar_toPrimitive(input, hint) {if (QuestL12StartWar_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL12StartWar_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}











var QuestL12StartWar = /*#__PURE__*/function (_TaskInfo) {QuestL12StartWar_inherits(QuestL12StartWar, _TaskInfo);var _super = QuestL12StartWar_createSuper(QuestL12StartWar);function QuestL12StartWar() {var _this;QuestL12StartWar_classCallCheck(this, QuestL12StartWar);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestL12StartWar_defineProperty(QuestL12StartWar_assertThisInitialized(_this), "loc",
    external_kolmafia_.Location.get("Hippy Camp"));QuestL12StartWar_defineProperty(QuestL12StartWar_assertThisInitialized(_this), "umbrella",
    external_kolmafia_.Item.get("Unbreakable Umbrella"));QuestL12StartWar_defineProperty(QuestL12StartWar_assertThisInitialized(_this), "familiar",
    external_kolmafia_.Familiar.get("Trick-or-Treating Tot"));QuestL12StartWar_defineProperty(QuestL12StartWar_assertThisInitialized(_this), "item",
    external_kolmafia_.Item.get("li'l pirate costume"));QuestL12StartWar_defineProperty(QuestL12StartWar_assertThisInitialized(_this), "paths", void 0);return _this;}QuestL12StartWar_createClass(QuestL12StartWar, [{ key: "createPaths", value:


    function createPaths(assumeUnstarted) {
      this.paths = [];

      var combos = [];

      for (var i = 0; i < 3; i++) {
        combos.push([null, 4]);
        combos.push([ResourceCategory.FORCE_NC, 1]);
      }var _iterator = QuestL12StartWar_createForOfIteratorHelper(

        getAllCombinations(combos)),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var combo = _step.value;
          if (combo.length != 3) {
            continue;
          }

          // Dumb queue manipulation, subtract 1 turn for every NC we hit on a non-forced
          var turns =
          combo.map(function (_ref) {var _ref2 = QuestL12StartWar_slicedToArray(_ref, 2),t = _ref2[1];return t;}).reduce(function (p, v) {return p + v;}, 0) -
          combo.filter(function (_ref3) {var _ref4 = QuestL12StartWar_slicedToArray(_ref3, 1),res = _ref4[0];return res == null;}).length;

          var path = new PossiblePath(turns);var _iterator2 = QuestL12StartWar_createForOfIteratorHelper(

            combo),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var _step2$value = QuestL12StartWar_slicedToArray(_step2.value, 1),res = _step2$value[0];
              if (res == null) {
                continue;
              }

              path.add(res);
            }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}

          this.paths.push(path);
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "attemptPrime", value:

    function attemptPrime(path) {
      if (!path.canUse(ResourceCategory.FORCE_NC) || !this.canStartWar()) {
        return false;
      }

      setPrimedResource(this, path, path.getResource(ResourceCategory.FORCE_NC));

      return true;
    } }, { key: "level", value:

    function level() {
      return 12;
    } }, { key: "canStartWar", value:

    function canStartWar() {
      if (!this.hasBoat() || !this.hasOutfit()) {
        return false;
      }

      if (external_kolmafia_.Stat.all().find(function (s) {return (0,external_kolmafia_.myBasestat)(s) < 70;}) != null) {
        return false;
      }

      return true;
    } }, { key: "status", value:

    function status(path) {
      if ((0,external_kolmafia_.getProperty)("warProgress") != "unstarted") {
        return QuestStatus.COMPLETED;
      }

      if (path == null || !this.canStartWar()) {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.haveFamiliar)(this.familiar) && (0,external_kolmafia_.availableAmount)(this.item) == 0) {
        return QuestStatus.NOT_READY;
      }

      if (path.canUse(ResourceCategory.FORCE_NC)) {
        if (path.getResource(ResourceCategory.FORCE_NC).primed()) {
          return QuestStatus.READY;
        }

        return QuestStatus.NOT_READY;
      }

      if (!hasNonCombatSkillsReady(true)) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "hasBoat", value:

    function hasBoat() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastIslandUnlock")) == (0,external_kolmafia_.myAscensions)();
    } }, { key: "hasOutfit", value:

    function hasOutfit() {
      return (0,external_kolmafia_.haveOutfit)("Frat Warrior Fatigues");
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      var outfit = new GreyOutfit();
      outfit.addWeight(external_kolmafia_.Item.get("Beer Helmet"));
      outfit.addWeight(external_kolmafia_.Item.get("distressed denim pants"));
      outfit.addWeight(external_kolmafia_.Item.get("bejeweled pledge pin"));

      var nc = path.getResource(ResourceCategory.FORCE_NC);

      if (nc == null) {
        outfit.setNoCombat().setNoCombat();

        if (
        (0,external_kolmafia_.availableAmount)(this.umbrella) > 0 &&
        !DelayBurners.isDelayBurnerReady())
        {
          outfit.addWeight(this.umbrella);
        }

        outfit.addDelayer(DelayCriteria().withFreeFights(null));
      }

      return {
        location: this.loc,
        outfit: outfit,
        freeRun: function freeRun() {return true;},
        run: function run() {
          if (DelayBurners.isTryingForDupeableGoblin()) {
            (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Grey Goose"));
          }

          var props = new Properties_PropertyManager();
          props.setChoice(139, 3);
          props.setChoice(140, 3);
          props.setChoice(141, 3);
          props.setChoice(142, 3);

          try {
            greyAdv(_this2.loc, outfit);
          } finally {
            props.resetAll();
          }

          if ((0,external_kolmafia_.getProperty)("warProgress") != "unstarted") {
            _this2.visitArena();
          }
        }
      };
    } }, { key: "getId", value:

    function getId() {
      return "Council / War / Start";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }, { key: "visitArena", value:

    function visitArena() {
      (0,external_kolmafia_.outfit)("Frat Warrior Fatigues");
      (0,external_kolmafia_.visitUrl)("bigisland.php?place=concert&pwd");
    } }]);return QuestL12StartWar;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/islandwar/QuestL12WarBoss.ts
function QuestL12WarBoss_typeof(obj) {"@babel/helpers - typeof";return QuestL12WarBoss_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL12WarBoss_typeof(obj);}function QuestL12WarBoss_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestL12WarBoss_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestL12WarBoss_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestL12WarBoss_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestL12WarBoss_arrayLikeToArray(o, minLen);}function QuestL12WarBoss_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestL12WarBoss_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL12WarBoss_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL12WarBoss_toPropertyKey(descriptor.key), descriptor);}}function QuestL12WarBoss_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL12WarBoss_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL12WarBoss_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL12WarBoss_toPropertyKey(arg) {var key = QuestL12WarBoss_toPrimitive(arg, "string");return QuestL12WarBoss_typeof(key) === "symbol" ? key : String(key);}function QuestL12WarBoss_toPrimitive(input, hint) {if (QuestL12WarBoss_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL12WarBoss_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var QuestL12WarBoss = /*#__PURE__*/function () {function QuestL12WarBoss() {QuestL12WarBoss_classCallCheck(this, QuestL12WarBoss);}QuestL12WarBoss_createClass(QuestL12WarBoss, [{ key: "getId", value:
    function getId() {
      return "Council / War / Boss";
    } }, { key: "level", value:

    function level() {
      return 12;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.getProperty)("warProgress") == "finished") {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("hippiesDefeated")) >= 1000) {
        return QuestStatus.READY;
      }

      return QuestStatus.NOT_READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();
      outfit.addWeight(external_kolmafia_.Item.get("Beer Helmet"));
      outfit.addWeight(external_kolmafia_.Item.get("distressed denim pants"));
      outfit.addWeight(external_kolmafia_.Item.get("bejeweled pledge pin"));

      return {
        outfit: outfit,
        location: null,
        run: function run() {
          _this.sellBuyCrap();

          (0,external_kolmafia_.visitUrl)("bigisland.php?place=camp&whichcamp=1");
          (0,external_kolmafia_.visitUrl)("bigisland.php?place=camp&whichcamp=2");

          greyAdv(
          "bigisland.php?action=bossfight&pwd",
          null,
          new AdventureSettings().setFinishingBlowMacro(Macro.attack().repeat()));


          (0,external_kolmafia_.council)();
        }
      };
    } }, { key: "sellBuyCrap", value:

    function sellBuyCrap() {
      var crap = [
      "pink clay bead",
      "purple clay bead",
      "green clay bead",
      "communications windchimes",
      "bullet-proof corduroys",
      "round purple sunglasses",
      "reinforced beaded headband"].
      map(function (s) {return external_kolmafia_.Item.get(s);});

      if ((0,external_kolmafia_.pullsRemaining)() >= 0) {var _iterator = QuestL12WarBoss_createForOfIteratorHelper(
          crap),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var s = _step.value;
            var keep = (0,external_kolmafia_.toSlot)(s) == (0,external_kolmafia_.toSlot)("none") ? 1 : 0;

            if ((0,external_kolmafia_.itemAmount)(s) <= keep) {
              continue;
            }

            (0,external_kolmafia_.sell)(s.buyer, (0,external_kolmafia_.itemAmount)(s) - keep, s);
          }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
      }

      var master = crap[0].buyer;
      var garter = external_kolmafia_.Item.get("gauze garter");
      var gartersHave = (0,external_kolmafia_.itemAmount)(garter);

      if (GreySettings_GreySettings.shouldAvoidTowerRequirements()) {
        gartersHave += (0,external_kolmafia_.storageAmount)(garter);
      }

      var needHealers = 10 - gartersHave;
      needHealers = Math.min(needHealers, Math.floor(master.availableTokens / 2));

      if (needHealers > 0) {
        (0,external_kolmafia_.cliExecute)("make " + needHealers + " gauze garter");
      }

      while (master.availableTokens >= 5) {
        (0,external_kolmafia_.cliExecute)(
        "make " +
        Math.floor(master.availableTokens / 5) +
        " commemorative war stein");

      }

      while (master.availableTokens >= 2) {
        (0,external_kolmafia_.cliExecute)(
        "make " + Math.floor(master.availableTokens / 2) + " gauze garter");

      }

      while (master.availableTokens >= 1) {
        (0,external_kolmafia_.cliExecute)("make " + master.availableTokens + " beer bomb");
      }
    } }]);return QuestL12WarBoss;}();
;// CONCATENATED MODULE: ./src/quests/council/islandwar/QuestL12WarFlyers.ts
function QuestL12WarFlyers_typeof(obj) {"@babel/helpers - typeof";return QuestL12WarFlyers_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL12WarFlyers_typeof(obj);}function QuestL12WarFlyers_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL12WarFlyers_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL12WarFlyers_toPropertyKey(descriptor.key), descriptor);}}function QuestL12WarFlyers_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL12WarFlyers_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL12WarFlyers_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL12WarFlyers_defineProperty(obj, key, value) {key = QuestL12WarFlyers_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL12WarFlyers_toPropertyKey(arg) {var key = QuestL12WarFlyers_toPrimitive(arg, "string");return QuestL12WarFlyers_typeof(key) === "symbol" ? key : String(key);}function QuestL12WarFlyers_toPrimitive(input, hint) {if (QuestL12WarFlyers_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL12WarFlyers_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}




var QuestL12WarFlyers = /*#__PURE__*/function () {function QuestL12WarFlyers() {QuestL12WarFlyers_classCallCheck(this, QuestL12WarFlyers);QuestL12WarFlyers_defineProperty(this, "flyers",
    external_kolmafia_.Item.get("Rock band flyers"));}QuestL12WarFlyers_createClass(QuestL12WarFlyers, [{ key: "getId", value:

    function getId() {
      return "Council / War / Flyers";
    } }, { key: "level", value:

    function level() {
      return 12;
    } }, { key: "status", value:

    function status() {
      if (this.isArenaDone()) {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.getProperty)("warProgress") != "started") {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.availableAmount)(this.flyers) == 0) {
        return QuestStatus.READY;
      }

      if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("flyeredML")) < 10000) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          _this.visitArena();
        }
      };
    } }, { key: "free", value:

    function free() {
      return true;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return true;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "isArenaDone", value:

    function isArenaDone() {
      return (0,external_kolmafia_.getProperty)("sidequestArenaCompleted") != "none";
    } }, { key: "visitArena", value:

    function visitArena() {
      (0,external_kolmafia_.outfit)("Frat Warrior Fatigues");
      (0,external_kolmafia_.visitUrl)("bigisland.php?place=concert&pwd");

      // If something borked, lets just make us flyer another
      if (
      (0,external_kolmafia_.availableAmount)(this.flyers) > 0 &&
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("flyeredML")) >= 10000)
      {
        (0,external_kolmafia_.setProperty)("flyeredML", "9900");
      }
    } }]);return QuestL12WarFlyers;}();
;// CONCATENATED MODULE: ./src/quests/council/islandwar/QuestL12WarGremlins.ts
function QuestL12WarGremlins_typeof(obj) {"@babel/helpers - typeof";return QuestL12WarGremlins_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL12WarGremlins_typeof(obj);}function QuestL12WarGremlins_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL12WarGremlins_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL12WarGremlins_toPropertyKey(descriptor.key), descriptor);}}function QuestL12WarGremlins_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL12WarGremlins_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL12WarGremlins_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL12WarGremlins_defineProperty(obj, key, value) {key = QuestL12WarGremlins_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL12WarGremlins_toPropertyKey(arg) {var key = QuestL12WarGremlins_toPrimitive(arg, "string");return QuestL12WarGremlins_typeof(key) === "symbol" ? key : String(key);}function QuestL12WarGremlins_toPrimitive(input, hint) {if (QuestL12WarGremlins_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL12WarGremlins_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var WarGremlins = /*#__PURE__*/function () {




  function WarGremlins() {QuestL12WarGremlins_classCallCheck(this, WarGremlins);QuestL12WarGremlins_defineProperty(this, "magnet", external_kolmafia_.Item.get("molybdenum magnet"));QuestL12WarGremlins_defineProperty(this, "sealTooth", external_kolmafia_.Item.get("Seal Tooth"));QuestL12WarGremlins_defineProperty(this, "children", []);
    this.children.push(
    new GremlinQuest(
    "Council / War / Gremlins / Burning Barrel",
    external_kolmafia_.Location.get("Next to that barrel with something burning in it"),
    external_kolmafia_.Monster.get("batwinged gremlin (tool)"),
    external_kolmafia_.Item.get("molybdenum hammer"),
    "It whips out a hammer"));


    this.children.push(
    new GremlinQuest(
    "Council / War / Gremlins / Abandoned Refrigerator",
    external_kolmafia_.Location.get("near an abandoned refrigerator"),
    external_kolmafia_.Monster.get("spider gremlin (tool)"),
    external_kolmafia_.Item.get("Molybdenum Pliers"),
    "It whips out a pair of pliers"));


    this.children.push(
    new GremlinQuest(
    "Council / War / Gremlins / Old Tires",
    external_kolmafia_.Location.get("over where the old tires are"),
    external_kolmafia_.Monster.get("erudite gremlin (tool)"),
    external_kolmafia_.Item.get("molybdenum crescent wrench"),
    "He whips out a crescent wrench"));


    this.children.push(
    new GremlinQuest(
    "Council / War / Gremlins / Rusted Car",
    external_kolmafia_.Location.get("Out by that rusted-out car"),
    external_kolmafia_.Monster.get("vegetable gremlin (tool)"),
    external_kolmafia_.Item.get("molybdenum screwdriver"),
    "It whips out a screwdriver"));


  }QuestL12WarGremlins_createClass(WarGremlins, [{ key: "getChildren", value:

    function getChildren() {
      return this.children;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return (0,external_kolmafia_.itemAmount)(this.magnet) == 0 || (0,external_kolmafia_.availableAmount)(this.sealTooth) == 0;
    } }, { key: "free", value:

    function free() {
      return this.mustBeDone();
    } }, { key: "run", value:

    function run() {
      if ((0,external_kolmafia_.itemAmount)(this.magnet) == 0) {
        return this.visitJunkman();
      }

      if ((0,external_kolmafia_.availableAmount)(this.sealTooth) == 0) {
        return this.getSealTooth();
      }

      return this.visitJunkman();
    } }, { key: "getSealTooth", value:

    function getSealTooth() {
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          (0,external_kolmafia_.retrieveItem)(external_kolmafia_.Item.get("Seal tooth"));
        }
      };
    } }, { key: "visitJunkman", value:

    function visitJunkman() {
      var outfit = new GreyOutfit();
      outfit.addWeight(external_kolmafia_.Item.get("Beer Helmet"));
      outfit.addWeight(external_kolmafia_.Item.get("distressed denim pants"));
      outfit.addWeight(external_kolmafia_.Item.get("bejeweled pledge pin"));
      outfit.addExtra("-tie");

      return {
        outfit: outfit,
        location: null,
        run: function run() {
          (0,external_kolmafia_.visitUrl)("bigisland.php?action=junkman&pwd");
        }
      };
    } }, { key: "level", value:

    function level() {
      return 12;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.getProperty)("sidequestJunkyardCompleted") != "none") {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.getProperty)("warProgress") != "started") {
        return QuestStatus.NOT_READY;
      }

      if (
      (0,external_kolmafia_.availableAmount)(this.sealTooth) > 0 &&
      (0,external_kolmafia_.availableAmount)(this.magnet) > 0 &&
      this.children.find(function (c) {return c.status() != QuestStatus.COMPLETED;}) != null)
      {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "getId", value:

    function getId() {
      return "Council / War / Gremlins";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }]);return WarGremlins;}();var


GremlinQuest = /*#__PURE__*/function () {










  function GremlinQuest(
  id,
  loc,
  monster,
  item,
  toolString)
  {QuestL12WarGremlins_classCallCheck(this, GremlinQuest);QuestL12WarGremlins_defineProperty(this, "id", void 0);QuestL12WarGremlins_defineProperty(this, "loc", void 0);QuestL12WarGremlins_defineProperty(this, "monster", void 0);QuestL12WarGremlins_defineProperty(this, "item", void 0);QuestL12WarGremlins_defineProperty(this, "toolString", void 0);QuestL12WarGremlins_defineProperty(this, "magnet", external_kolmafia_.Item.get("molybdenum magnet"));QuestL12WarGremlins_defineProperty(this, "flyers", external_kolmafia_.Item.get("Rock band flyers"));QuestL12WarGremlins_defineProperty(this, "sealTooth", external_kolmafia_.Item.get("Seal Tooth"));QuestL12WarGremlins_defineProperty(this, "pants", external_kolmafia_.Item.get("Greatest American Pants"));
    this.id = id;
    this.loc = loc;
    this.monster = monster;
    this.item = item;
    this.toolString = toolString;
  }QuestL12WarGremlins_createClass(GremlinQuest, [{ key: "getId", value:

    function getId() {
      return this.id;
    } }, { key: "level", value:

    function level() {
      return 12;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.getProperty)("sidequestJunkyardCompleted") != "none") {
        return QuestStatus.COMPLETED;
      }

      if (
      (0,external_kolmafia_.availableAmount)(this.sealTooth) == 0 ||
      (0,external_kolmafia_.availableAmount)(this.magnet) == 0)
      {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.availableAmount)(this.item) > 0) {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.getProperty)("warProgress") != "started") {
        return QuestStatus.NOT_READY;
      }

      if (!(0,external_kolmafia_.haveSkill)(external_kolmafia_.Skill.get("Subatomic Hardening"))) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit().
      addWeight("ML", -1, null, -70).
      addWeight("DA").
      addWeight("DR", 5);
      outfit.hpWeight = 1;

      if (
      (0,external_kolmafia_.availableAmount)(this.pants) > 0 &&
      currentPredictions().get(this.loc) != this.monster)
      {
        outfit.addWeight(this.pants);
      }

      var macro2 = Macro.if_(
      "match " + this.toolString,
      Macro.item(this.magnet).step("abort")).
      item(this.sealTooth);

      var macro = new Macro().if_(
      this.monster,
      Macro.while_("!pastround 25 && !hpbelow 50", macro2));


      var orbs = [
      this.monster,
      external_kolmafia_.Monster.get(this.monster.name.replace(" (tool)", ""))];


      return {
        location: this.loc,
        outfit: outfit,
        orbs: orbs,
        mayFreeRun: true,
        freeRun: function freeRun(mons) {return mons != _this.monster;},
        run: function run() {
          var settings = new AdventureSettings();
          settings.setDuringFightMacro(macro);

          settings.addBanish(external_kolmafia_.Monster.get("A.M.C Gremlin"));
          // settings.addBanish(Monster.get("vegetable gremlin"));
          // settings.addBanish(Monster.get("batwinged gremlin"));
          // settings.addBanish(Monster.get("spider gremlin"));
          // settings.addBanish(Monster.get("batwinged gremlin"));

          greyAdv(_this.loc, outfit, settings);
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }]);return GremlinQuest;}();
;// CONCATENATED MODULE: ./src/quests/council/islandwar/QuestL12WarLobster.ts
function QuestL12WarLobster_typeof(obj) {"@babel/helpers - typeof";return QuestL12WarLobster_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL12WarLobster_typeof(obj);}function QuestL12WarLobster_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestL12WarLobster_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestL12WarLobster_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestL12WarLobster_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestL12WarLobster_arrayLikeToArray(o, minLen);}function QuestL12WarLobster_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestL12WarLobster_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL12WarLobster_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL12WarLobster_toPropertyKey(descriptor.key), descriptor);}}function QuestL12WarLobster_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL12WarLobster_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL12WarLobster_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL12WarLobster_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestL12WarLobster_setPrototypeOf(subClass, superClass);}function QuestL12WarLobster_setPrototypeOf(o, p) {QuestL12WarLobster_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestL12WarLobster_setPrototypeOf(o, p);}function QuestL12WarLobster_createSuper(Derived) {var hasNativeReflectConstruct = QuestL12WarLobster_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestL12WarLobster_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestL12WarLobster_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestL12WarLobster_possibleConstructorReturn(this, result);};}function QuestL12WarLobster_possibleConstructorReturn(self, call) {if (call && (QuestL12WarLobster_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestL12WarLobster_assertThisInitialized(self);}function QuestL12WarLobster_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestL12WarLobster_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestL12WarLobster_getPrototypeOf(o) {QuestL12WarLobster_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestL12WarLobster_getPrototypeOf(o);}function QuestL12WarLobster_defineProperty(obj, key, value) {key = QuestL12WarLobster_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL12WarLobster_toPropertyKey(arg) {var key = QuestL12WarLobster_toPrimitive(arg, "string");return QuestL12WarLobster_typeof(key) === "symbol" ? key : String(key);}function QuestL12WarLobster_toPrimitive(input, hint) {if (QuestL12WarLobster_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL12WarLobster_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}













var QuestL12Lobster = /*#__PURE__*/function (_TaskInfo) {QuestL12WarLobster_inherits(QuestL12Lobster, _TaskInfo);var _super = QuestL12WarLobster_createSuper(QuestL12Lobster);











  function QuestL12Lobster() {var _this;QuestL12WarLobster_classCallCheck(this, QuestL12Lobster);
    _this = _super.call(this);QuestL12WarLobster_defineProperty(QuestL12WarLobster_assertThisInitialized(_this), "loc", external_kolmafia_.Location.get("Sonofa Beach"));QuestL12WarLobster_defineProperty(QuestL12WarLobster_assertThisInitialized(_this), "item", external_kolmafia_.Item.get("barrel of gunpowder"));QuestL12WarLobster_defineProperty(QuestL12WarLobster_assertThisInitialized(_this), "monster", external_kolmafia_.Monster.get("Lobsterfrogman"));QuestL12WarLobster_defineProperty(QuestL12WarLobster_assertThisInitialized(_this), "bossBat", external_kolmafia_.Monster.get("Boss Bat"));QuestL12WarLobster_defineProperty(QuestL12WarLobster_assertThisInitialized(_this), "powerfulGlove", external_kolmafia_.Item.get("Powerful Glove"));QuestL12WarLobster_defineProperty(QuestL12WarLobster_assertThisInitialized(_this), "backupCamera", external_kolmafia_.Item.get("Backup Camera"));QuestL12WarLobster_defineProperty(QuestL12WarLobster_assertThisInitialized(_this), "paths", []);QuestL12WarLobster_defineProperty(QuestL12WarLobster_assertThisInitialized(_this), "hasAutumn", (0,external_kolmafia_.getProperty)("hasAutumnaton") == "true");QuestL12WarLobster_defineProperty(QuestL12WarLobster_assertThisInitialized(_this), "fallbotTag", "Fallbot");QuestL12WarLobster_defineProperty(QuestL12WarLobster_assertThisInitialized(_this), "forcedFightTag", "ForcedFight");return _this;
  }QuestL12WarLobster_createClass(QuestL12Lobster, [{ key: "level", value:

    function level() {
      return this.hasAutumn ? 13 : 15;
    } }, { key: "getFriendsRemaining", value:

    function getFriendsRemaining() {
      if ((0,external_kolmafia_.toMonster)((0,external_kolmafia_.getProperty)("_saberForceMonster")) != this.monster) {
        return 0;
      }

      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_saberForceMonsterCount"));
    } }, { key: "createPaths", value:

    function createPaths(assumeUnstarted) {
      this.paths = [];

      if (this.hasAutumn) {
        for (var i = 0; i <= 1; i++) {
          var path = new PossiblePath(
          assumeUnstarted ? 1 : this.loc.turnsSpent > 0 ? 0 : 1).
          addTag(this.fallbotTag);

          if (i == 0) {
            if (this.loc.turnsSpent > 0) {
              continue;
            }

            path.add(ResourceCategory.FORCE_FIGHT);
            path.addMeat(-1000);
          }

          this.paths.push(path);
        }
        return;
      }

      var barrelsNeeded =
      5 - (assumeUnstarted ? 0 : (0,external_kolmafia_.availableAmount)(this.item));
      var turnsManual = 8;
      var possibleCombo = [];

      for (var _i = 0; _i < barrelsNeeded; _i++) {
        if (_i < this.getFriendsRemaining()) {
          possibleCombo.push("Friend");
        } else {
          possibleCombo.push("Manual");
        }

        possibleCombo.push(ResourceCategory.COPIER);

        if (_i <= 1) {
          possibleCombo.push(ResourceCategory.OLFACT_COPIER);
        }
      }

      // If we're doing voted, or mag class. Then we can do a replace
      if (
      (this.hasPortScan() ||
      DelayBurners.getCombatReplacers(
      DelayCriteria().showAll().withForcedFights(true)).
      length > 0) && (
      !this.isBackupReady() || this.getFriendsRemaining() == 0))
      {
        possibleCombo.push(ResourceCategory.GLOVE_REPLACE);
      }var _iterator = QuestL12WarLobster_createForOfIteratorHelper(

        getAllCombinations(possibleCombo)),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var combo = _step.value;
          // If a combo would do something silly, like request a glove replace when its not needed
          if (!assumeUnstarted && combo.includes(ResourceCategory.GLOVE_REPLACE)) {
            // If we'd ask for a replace when we're doing friends.. Or have a void copier
            if (this.getFriendsRemaining() > 0) {
              continue;
            }

            // If we'd ask for a replace when we can do backups
            if (
            this.lastMonster() == this.monster &&
            combo.includes(ResourceCategory.COPIER))
            {
              continue;
            }
          }

          // If a combo would do something silly, like expect lobster without a source
          if (
          !combo.includes("Manual") &&
          !combo.includes(ResourceCategory.GLOVE_REPLACE) && (
          assumeUnstarted ||
          this.getFriendsRemaining() == 0 &&
          !(
          combo.includes(ResourceCategory.COPIER) &&
          this.lastMonster() == this.monster)))

          {
            continue;
          }

          var turnsTaken = 0;
          var barrelsGained = 0;var _iterator2 = QuestL12WarLobster_createForOfIteratorHelper(

            combo),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var type = _step2.value;
              if (type == "Friend") {
                turnsTaken += 1;
                barrelsGained += 1;
              } else if (type == "Manual") {
                turnsTaken += turnsManual;
                barrelsGained++;
              } else if (type == ResourceCategory.COPIER) {
                // Skip turns taken as we're burning delay as a rule
                // turnsTaken++;
                barrelsGained++;
              } else if (type == ResourceCategory.OLFACT_COPIER) {
                // Each one of these gives us another 2 effectively
                // Since the first fight we'd saber on won't give us a barrel and is pretty much moved to the last fight
                turnsTaken += 2;
                barrelsGained += 2;
              } else if (type == ResourceCategory.GLOVE_REPLACE) {
                turnsTaken++;
                barrelsGained++;
              } else {
                throw "Lobster calcs didn't account for " + type;
              }
            }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}

          if (barrelsGained < barrelsNeeded) {
            continue;
          }

          // If we're doing olfact, then doing an extra copy when our saber would do it anyways is a waste
          var extraTurns = combo.filter(
          function (c) {return c == "Manual" || c == ResourceCategory.COPIER;}).
          length;
          var extraBarrels = barrelsGained - barrelsNeeded;

          if (extraBarrels > 0 && extraTurns > 1) {
            continue;
          }

          var _path = new PossiblePath(turnsTaken);var _iterator3 = QuestL12WarLobster_createForOfIteratorHelper(

            combo),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var _type = _step3.value;
              if (typeof _type != "number") {
                continue;
              }

              if (_type == ResourceCategory.GLOVE_REPLACE && this.hasPortScan()) {
                _path.add(ResourceCategory.FORCE_FIGHT);
              }

              _path.add(_type);
            }} catch (err) {_iterator3.e(err);} finally {_iterator3.f();}

          this.paths.push(_path);
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

      if (barrelsNeeded <= 0) {
        this.paths.push(new PossiblePath(0));
      }
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "status", value:

    function status(path) {
      var status = this.getStatus(path);

      if (
      (0,external_kolmafia_.getProperty)("sidequestLighthouseCompleted") != "none" &&
      status != null)
      {
        return status;
      }

      if (
      path != null &&
      path.canUse(ResourceCategory.FORCE_FIGHT) &&
      path.getResource(ResourceCategory.FORCE_FIGHT).primed())
      {
        return QuestStatus.READY;
      }

      if (status == null) {
        if (!path.canUse(ResourceCategory.FORCE_FIGHT)) {
          return QuestStatus.READY;
        }

        return QuestStatus.NOT_READY;
      }

      return status;
    } }, { key: "getStatus", value:

    function getStatus(path) {
      if ((0,external_kolmafia_.getProperty)("sidequestLighthouseCompleted") != "none") {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.getProperty)("warProgress") != "started") {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.availableAmount)(this.item) >= 5) {
        return QuestStatus.READY;
      }

      if ((0,external_kolmafia_.myAdventures)() < 22 || path == null) {
        return QuestStatus.NOT_READY;
      }

      if (path.hasTag(this.fallbotTag)) {
        if (this.loc.turnsSpent >= 1) {
          return QuestStatus.NOT_READY;
        }

        if (path.canUse(ResourceCategory.FORCE_FIGHT)) {
          return path.getResource(ResourceCategory.FORCE_FIGHT).primed() ?
          QuestStatus.READY :
          null;
        }

        var canForceFight = DelayBurners.getCombatReplacers(
        DelayCriteria().withForcedFights(true).withFreeFights(null).showAll());


        if (canForceFight.length > 0) {
          if (
          canForceFight.find(
          function (delayer) {return !delayer.isFree() && delayer.readyIn() == 0;}) ==
          null)
          {
            return QuestStatus.NOT_READY;
          }
        }

        return QuestStatus.READY;
      }

      if (this.getFriendsRemaining() > 0) {
        return QuestStatus.READY;
      }

      if (path.canUse(ResourceCategory.COPIER) && this.shouldDelayForBats()) {
        return QuestStatus.NOT_READY;
      }

      if (
      (0,external_kolmafia_.availableAmount)(this.backupCamera) > 0 &&
      this.isBackupReady() &&
      path.canUse(ResourceCategory.COPIER))
      {
        return QuestStatus.READY;
      }

      if (
      path.canUse(ResourceCategory.GLOVE_REPLACE) &&
      path.canUse(ResourceCategory.FORCE_FIGHT))
      {
        if (
        (0,external_kolmafia_.familiarWeight)(external_kolmafia_.Familiar.get("Grey Goose")) > 2 &&
        (0,external_kolmafia_.familiarWeight)(external_kolmafia_.Familiar.get("Grey Goose")) < 6)
        {
          return QuestStatus.NOT_READY;
        }

        return null;
      }

      if (path.canUse(ResourceCategory.GLOVE_REPLACE)) {
        var replacer = this.getMonsterReplacer();

        if (replacer == null || replacer.isFree() && (0,external_kolmafia_.turnsPlayed)() < 400) {
          return QuestStatus.NOT_READY;
        }
      } else if (!hasCombatSkillReady()) {
        return QuestStatus.FASTER_LATER;
      }

      if (
      (0,external_kolmafia_.familiarWeight)(external_kolmafia_.Familiar.get("Grey Goose")) > 2 &&
      (0,external_kolmafia_.familiarWeight)(external_kolmafia_.Familiar.get("Grey Goose")) < 6)
      {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "getId", value:

    function getId() {
      return "Council / War / Lobsters";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }, { key: "turnInQuest", value:

    function turnInQuest() {
      var outfit = new GreyOutfit();
      outfit.addWeight(external_kolmafia_.Item.get("Beer Helmet"));
      outfit.addWeight(external_kolmafia_.Item.get("distressed denim pants"));
      outfit.addWeight(external_kolmafia_.Item.get("bejeweled pledge pin"));

      return {
        location: null,
        outfit: outfit,
        run: function run() {
          (0,external_kolmafia_.visitUrl)("bigisland.php?place=lighthouse&action=pyro&pwd");
          (0,external_kolmafia_.visitUrl)("bigisland.php?place=lighthouse&action=pyro&pwd");
          (0,external_kolmafia_.visitUrl)("bigisland.php?place=lighthouse&action=pyro&pwd");
        }
      };
    } }, { key: "hasPortScan", value:

    function hasPortScan() {
      return (0,external_kolmafia_.getProperty)("sourceTerminalEducateKnown").includes("portscan");
    } }, { key: "getMonsterReplacer", value:

    function getMonsterReplacer() {
      var delayer = DelayBurners.getCombatReplacers(
      DelayCriteria().withForcedFights(true).withFreeFights(false)).
      filter(function (d) {return d.readyIn() == 0;});

      if (delayer.length == 0) {
        return null;
      }

      return delayer[0];
    } }, { key: "hasBackups", value:

    function hasBackups() {
      return 11 - (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_backUpUses"));
    } }, { key: "lastMonster", value:

    function lastMonster() {
      return (0,external_kolmafia_.getProperty)("lastCopyableMonster") == "" ?
      null :
      (0,external_kolmafia_.toMonster)((0,external_kolmafia_.getProperty)("lastCopyableMonster"));
    } }, { key: "isBackupReady", value:

    function isBackupReady() {
      return this.hasBackups() > 0 && this.lastMonster() == this.monster;
    } }, { key: "shouldDelayForBats", value:

    function shouldDelayForBats() {
      return getQuestStatus("questL04Bat") < 3;
    } }, { key: "isBatsAvailable", value:

    function isBatsAvailable() {
      var status = getQuestStatus("questL04Bat");

      return status >= 3 && status < 100;
    } }, { key: "runBackup", value:

    function runBackup(path) {var _this2 = this;
      var outfit = new GreyOutfit();
      outfit.addWeight("ML", -1);

      var copierResource = path.getResource(ResourceCategory.COPIER);
      copierResource.prepare(outfit);

      var loc;

      if (this.isBatsAvailable()) {
        loc = external_kolmafia_.Location.get("The Boss Bat's Lair");
      } else {
        loc = external_kolmafia_.Location.get("The Dire Warren");
      }

      return {
        outfit: outfit,
        location: loc,
        run: function run() {
          greyAdv(
          loc,
          outfit,
          new AdventureSettings().setStartOfFightMacro(
          new Macro().ifNot_(_this2.monster, copierResource.macro())));


        }
      };
    } }, { key: "runFriends", value:

    function runFriends(path) {var _this3 = this;
      var copier = path.getResource(ResourceCategory.OLFACT_COPIER);
      var makeMoreFriends =
      this.getFriendsRemaining() == 1 &&
      (0,external_kolmafia_.availableAmount)(this.item) < 4 &&
      copier != null;

      var outfit = new GreyOutfit();
      outfit.addWeight("ML", -1);

      if (makeMoreFriends) {
        copier.prepare(outfit);
      }

      return {
        outfit: outfit,
        location: this.loc,
        run: function run() {
          var props = new Properties_PropertyManager();
          var macro;

          if (makeMoreFriends) {
            copier.prepare(null, props);
            macro = Macro.if_(_this3.monster, copier.macro());
          }

          var uses = (0,external_kolmafia_.getProperty)("_saberForceUses");

          try {
            greyAdv(
            _this3.loc,
            outfit,
            new AdventureSettings().setStartOfFightMacro(macro));


            if (uses != (0,external_kolmafia_.getProperty)("_saberForceUses")) {
              if (_this3.getFriendsRemaining() <= 0) {
                throw "Used the force, but no friends? Something went wrong!";
              }
            }
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "attemptPrime", value:

    function attemptPrime(path) {
      if (!path.canUse(ResourceCategory.FORCE_FIGHT)) {
        return false;
      }

      var status = this.getStatus(path);

      if (status != null) {
        return false;
      }

      setPrimedResource(
      this,
      path,
      path.getResource(ResourceCategory.FORCE_FIGHT));


      return true;
    } }, { key: "run", value:

    function run(path) {var _this4 = this;
      // Try to turn in quest
      if ((0,external_kolmafia_.itemAmount)(this.item) >= 5) {
        return this.turnInQuest();
      }

      // Going here just to unlock fallbot~!
      if (path.hasTag(this.fallbotTag)) {
        var _outfit = new GreyOutfit();

        if (path.getResource(ResourceCategory.FORCE_FIGHT) == null) {
          var replacer = this.getMonsterReplacer();

          if (replacer != null) {var _iterator4 = QuestL12WarLobster_createForOfIteratorHelper(
              replacer.getFightSetup()),_step4;try {for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {var item = _step4.value;
                _outfit.addWeight(item);
              }} catch (err) {_iterator4.e(err);} finally {_iterator4.f();}
          }
        }

        return {
          location: this.loc,
          outfit: _outfit,
          run: function run() {
            greyAdv(_this4.loc);
          }
        };
      }

      if (this.getFriendsRemaining() > 0) {
        return this.runFriends(path);
      }

      if (this.isBackupReady() && path.canUse(ResourceCategory.COPIER)) {
        return this.runBackup(path);
      }

      var outfit = new GreyOutfit();

      var gloveReplace = path.getResource(ResourceCategory.GLOVE_REPLACE);

      var fightForcerResource = path.getResource(ResourceCategory.FORCE_FIGHT);

      if (fightForcerResource != null) {
        if (!fightForcerResource.primed()) {


          // Need to handle primed better, like resumes..
          //   throw "Unable to run lobster fights, we're supposed to prime it but it isn't primed!";
        }if (gloveReplace == null) {
          throw "Unable to run lobster fights, we're forcing a fight but don't have a replacer!";
        }
      }

      var replaceFight =
      fightForcerResource != null ||
      this.getMonsterReplacer() != null && gloveReplace != null;

      if (gloveReplace != null) {
        gloveReplace.prepare(outfit);

        if (fightForcerResource == null) {var _iterator5 = QuestL12WarLobster_createForOfIteratorHelper(
            this.getMonsterReplacer().getFightSetup()),_step5;try {for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {var _item = _step5.value;
              outfit.addWeight(_item);
            }} catch (err) {_iterator5.e(err);} finally {_iterator5.f();}
        }
      } else {
        outfit.setPlusCombat();
      }

      outfit.addWeight("ML", -1);

      var copier = path.getResource(ResourceCategory.OLFACT_COPIER);

      if (copier != null) {
        copier.prepare(outfit);
      }

      return {
        location: this.loc,
        outfit: outfit,
        run: function run() {
          var macro;
          var props = new Properties_PropertyManager();
          var uses = (0,external_kolmafia_.getProperty)("_saberForceUses");

          if (copier != null) {
            copier.prepare(null, props);

            if (macro == null) {
              macro = new Macro();
            }

            macro.if_(_this4.monster, copier.macro());
          }

          try {
            if (replaceFight) {
              (0,external_kolmafia_.visitUrl)("adventure.php?snarfblat=" + (0,external_kolmafia_.toInt)(_this4.loc));

              Macro.ifNot_(
              _this4.monster,
              Macro.ifNot_(_this4.bossBat, gloveReplace.macro())).
              submit();
            }

            greyAdv(
            _this4.loc,
            outfit,
            new AdventureSettings().setStartOfFightMacro(macro));


            if (uses != (0,external_kolmafia_.getProperty)("_saberForceUses")) {
              if (_this4.getFriendsRemaining() <= 0) {
                throw "Used the force, but no friends? Something went wrong!";
              }
            }
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      if ((0,external_kolmafia_.itemAmount)(this.item) >= 5) {
        if (
        (0,external_kolmafia_.getProperty)("sidequestLighthouseCompleted") == "none" &&
        (0,external_kolmafia_.getProperty)("warProgress") == "started")
        {
          return true;
        }

        return false;
      }

      if (this.getFriendsRemaining() > 0) {
        return false;
      }

      if (this.lastMonster() != this.monster) {
        return false;
      }

      if (this.hasBackups() <= 0) {
        return false;
      }

      return true;
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestL12Lobster;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/islandwar/QuestL12Worms.ts
function QuestL12Worms_typeof(obj) {"@babel/helpers - typeof";return QuestL12Worms_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL12Worms_typeof(obj);}function QuestL12Worms_slicedToArray(arr, i) {return QuestL12Worms_arrayWithHoles(arr) || QuestL12Worms_iterableToArrayLimit(arr, i) || QuestL12Worms_unsupportedIterableToArray(arr, i) || QuestL12Worms_nonIterableRest();}function QuestL12Worms_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function QuestL12Worms_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function QuestL12Worms_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function QuestL12Worms_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestL12Worms_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestL12Worms_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestL12Worms_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestL12Worms_arrayLikeToArray(o, minLen);}function QuestL12Worms_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestL12Worms_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL12Worms_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL12Worms_toPropertyKey(descriptor.key), descriptor);}}function QuestL12Worms_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL12Worms_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL12Worms_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL12Worms_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestL12Worms_setPrototypeOf(subClass, superClass);}function QuestL12Worms_setPrototypeOf(o, p) {QuestL12Worms_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestL12Worms_setPrototypeOf(o, p);}function QuestL12Worms_createSuper(Derived) {var hasNativeReflectConstruct = QuestL12Worms_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestL12Worms_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestL12Worms_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestL12Worms_possibleConstructorReturn(this, result);};}function QuestL12Worms_possibleConstructorReturn(self, call) {if (call && (QuestL12Worms_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestL12Worms_assertThisInitialized(self);}function QuestL12Worms_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestL12Worms_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestL12Worms_getPrototypeOf(o) {QuestL12Worms_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestL12Worms_getPrototypeOf(o);}function QuestL12Worms_defineProperty(obj, key, value) {key = QuestL12Worms_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL12Worms_toPropertyKey(arg) {var key = QuestL12Worms_toPrimitive(arg, "string");return QuestL12Worms_typeof(key) === "symbol" ? key : String(key);}function QuestL12Worms_toPrimitive(input, hint) {if (QuestL12Worms_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL12Worms_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}










var QuestL12Worms = /*#__PURE__*/function (_TaskInfo) {QuestL12Worms_inherits(QuestL12Worms, _TaskInfo);var _super = QuestL12Worms_createSuper(QuestL12Worms);





  function QuestL12Worms() {var _this;QuestL12Worms_classCallCheck(this, QuestL12Worms);
    _this = _super.call(this);QuestL12Worms_defineProperty(QuestL12Worms_assertThisInitialized(_this), "nanovision", external_kolmafia_.Skill.get("Double Nanovision"));QuestL12Worms_defineProperty(QuestL12Worms_assertThisInitialized(_this), "worms", []);QuestL12Worms_defineProperty(QuestL12Worms_assertThisInitialized(_this), "heart", external_kolmafia_.Item.get("heart of the filthworm queen"));QuestL12Worms_defineProperty(QuestL12Worms_assertThisInitialized(_this), "paths", []);

    _this.worms.push(
    new WormProgress(
    external_kolmafia_.Location.get("The Queen's Chamber"),
    external_kolmafia_.Item.get("filthworm royal guard scent gland"),
    false));


    _this.worms.push(
    new WormProgress(
    external_kolmafia_.Location.get("The Royal Guard Chamber"),
    external_kolmafia_.Item.get("filthworm drone scent gland")));


    _this.worms.push(
    new WormProgress(
    external_kolmafia_.Location.get("The Feeding Chamber"),
    external_kolmafia_.Item.get("Filthworm hatchling scent gland")));


    _this.worms.push(
    new WormProgress(external_kolmafia_.Location.get("The Hatching Chamber"), null));return _this;

  }QuestL12Worms_createClass(QuestL12Worms, [{ key: "createPaths", value:

    function createPaths(assumeUnstarted) {var _this2 = this;
      this.paths = [];

      // At turn in!
      if (!assumeUnstarted && (0,external_kolmafia_.availableAmount)(this.heart) > 0) {
        this.paths.push(new PossiblePath(0));
        return;
      }

      var wormsRemaining = [];var _iterator = QuestL12Worms_createForOfIteratorHelper(

        this.worms),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var worm = _step.value;
          wormsRemaining.push(worm);

          if (!assumeUnstarted && worm.isDoable()) {
            break;
          }
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

      var yrsNeeded = wormsRemaining.filter(function (w) {return w.dropsItem;}).length;
      var killsNeeded = wormsRemaining.length;

      var mixup = [];
      mixup.push([null, 1]);

      for (var i = 0; i < yrsNeeded; i++) {
        // So we run 300% item drop lets assume
        // That's 30 chance a fight. That's eh, 4 fights? Lets call it 6 cos we're bad luck.
        mixup.push([null, 6]);
        mixup.push([ResourceCategory.POLAR_VORTEX, 1]);
        mixup.push([ResourceCategory.HUGS_AND_KISSES, 1]);
        mixup.push([ResourceCategory.YELLOW_RAY, 1]);
      }var _iterator2 = QuestL12Worms_createForOfIteratorHelper(

        getAllCombinations(mixup)),_step2;try {var _loop = function _loop() {var combo = _step2.value;
          if (
          combo.length != killsNeeded ||
          combo.find(function (_ref) {var _ref2 = QuestL12Worms_slicedToArray(_ref, 2),res = _ref2[0],turn = _ref2[1];return res == null && turn == 1;}) == null)
          {return "continue";

          }

          var path = new PossiblePath(
          combo.map(function (_ref3) {var _ref4 = QuestL12Worms_slicedToArray(_ref3, 2),turns = _ref4[1];return turns;}).reduce(function (p, n) {return p + n;}, 0));


          path.addIgnored("Cosplay Saber");

          combo.forEach(function (_ref5) {var _ref6 = QuestL12Worms_slicedToArray(_ref5, 1),resource = _ref6[0];
            if (resource == null) {
              return;
            }

            path.add(resource);
          });

          _this2.paths.push(path);
        };for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var _ret = _loop();if (_ret === "continue") continue;}} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "getId", value:

    function getId() {
      return "Council / War / Filthworms";
    } }, { key: "getLocations", value:

    function getLocations() {
      return this.worms.map(function (e) {return e.location;});
    } }, { key: "level", value:

    function level() {
      return 12;
    } }, { key: "isHeistReady", value:

    function isHeistReady() {
      return (
        (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("catBurglarBankHeists")) > 0 ||
        (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_catBurglarCharge")) >= 10);

    } }, { key: "status", value:

    function status(path) {
      if ((0,external_kolmafia_.getProperty)("sidequestOrchardCompleted") != "none") {
        return QuestStatus.COMPLETED;
      }

      // If we can't access this place yet
      if ((0,external_kolmafia_.getProperty)("warProgress") != "started") {
        return QuestStatus.NOT_READY;
      }

      // If we can't turn this in
      if (
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("hippiesDefeated")) < 64 &&
      (0,external_kolmafia_.availableAmount)(this.heart) > 0)
      {
        return QuestStatus.NOT_READY;
      }

      if (this.isKillingQueen()) {
        return QuestStatus.FASTER_LATER;
      }

      if (path == null) {
        return QuestStatus.READY;
      }

      if (path.canUse(ResourceCategory.YELLOW_RAY)) {
        // If we're going to YR
        if (!path.getResource(ResourceCategory.YELLOW_RAY).ready()) {
          // If we can't afford to YR
          return QuestStatus.NOT_READY;
        }

        return QuestStatus.READY;
      }

      if (
      !path.canUse(ResourceCategory.POLAR_VORTEX) &&
      !path.canUse(ResourceCategory.HUGS_AND_KISSES) &&
      !(0,external_kolmafia_.haveSkill)(this.nanovision))
      {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.FASTER_LATER;
    } }, { key: "isKillingQueen", value:

    function isKillingQueen() {
      return (
        (0,external_kolmafia_.itemAmount)(external_kolmafia_.Item.get("filthworm royal guard scent gland")) > 0 ||
        (0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("Filthworm Guard Stench")) > 0);

    } }, { key: "run", value:

    function run(path) {var _resource,_resource2,_this3 = this;
      if ((0,external_kolmafia_.itemAmount)(this.heart) > 0) {
        var _outfit = new GreyOutfit();
        _outfit.addWeight(external_kolmafia_.Item.get("Beer Helmet"));
        _outfit.addWeight(external_kolmafia_.Item.get("distressed denim pants"));
        _outfit.addWeight(external_kolmafia_.Item.get("bejeweled pledge pin"));
        _outfit.addExtra("-tie");

        return {
          outfit: _outfit,
          location: null,
          run: function run() {
            (0,external_kolmafia_.visitUrl)("bigisland.php?place=orchard&action=stand&pwd=");
            (0,external_kolmafia_.visitUrl)("bigisland.php?place=orchard&action=stand&pwd=");
            (0,external_kolmafia_.visitUrl)("shop.php?whichshop=hippy");
          }
        };
      }

      var outfit = new GreyOutfit();

      var resource = path.getResource(ResourceCategory.YELLOW_RAY);

      if (resource == null) {
        resource = path.getResource(ResourceCategory.POLAR_VORTEX);
      }

      if (resource == null) {
        resource = path.getResource(ResourceCategory.HUGS_AND_KISSES);
      }

      if (this.isKillingQueen()) {
        outfit.meatDropWeight = 4;
      } else if (resource != null) {
        resource.prepare(outfit);
      } else {
        outfit.setItemDrops().setChampagneBottle();
      }

      var chamber = this.worms.find(function (worm) {return worm.isDoable();});

      return {
        location: chamber.location,
        outfit: outfit,
        familiar: (_resource = resource) === null || _resource === void 0 ? void 0 : _resource.familiar,
        disableFamOverride: ((_resource2 = resource) === null || _resource2 === void 0 ? void 0 : _resource2.familiar) != null,
        mayFreeRun:
        resource != null && resource.type != ResourceCategory.YELLOW_RAY,
        freeRun: function freeRun(monster) {return !monster.name.includes("filthworm");},
        run: function run() {
          if (chamber.effect != null && (0,external_kolmafia_.haveEffect)(chamber.effect) == 0) {
            (0,external_kolmafia_.use)(chamber.glandsRequired);
          }

          var tryRun =
          (0,external_kolmafia_.equippedAmount)(external_kolmafia_.Item.get("Greatest American Pants")) +
          (0,external_kolmafia_.equippedAmount)(external_kolmafia_.Item.get("navel ring of navel gazing")) >
          0;
          var killingBlow;
          var props = new Properties_PropertyManager();
          var killingSkill = (0,external_kolmafia_.haveSkill)(_this3.nanovision) ?
          _this3.nanovision :
          external_kolmafia_.Skill.get("Infinite Loop");

          if (resource != null && !_this3.isKillingQueen()) {
            resource.prepare(null, props);
            killingBlow = Macro.if_("monstername filthworm", resource.macro());

            if (tryRun) {
              killingBlow.runaway();
            } else {
              killingBlow.skill(killingSkill).repeat();
            }
          } else {
            killingBlow = Macro.skill(killingSkill).repeat();
          }

          try {
            greyAdv(
            chamber.location,
            outfit,
            new AdventureSettings().setFinishingBlowMacro(killingBlow));

          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "free", value:

    function free() {
      return (0,external_kolmafia_.availableAmount)(this.heart) > 0;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {var _iterator3 = QuestL12Worms_createForOfIteratorHelper(
        this.worms),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var worm = _step3.value;
          if (worm.effect == null) {
            continue;
          }

          // If the gland is in operation
          if ((0,external_kolmafia_.haveEffect)(worm.effect) > 0) {
            return true;
          }

          // If the gland is available
          if ((0,external_kolmafia_.availableAmount)(worm.glandsRequired) > 0) {
            return false;
          }
        }} catch (err) {_iterator3.e(err);} finally {_iterator3.f();}

      return false;
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestL12Worms;}(TaskInfo);var


WormProgress = /*#__PURE__*/function () {





  function WormProgress(
  location,
  itemRequired)

  {var dropsItem = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;QuestL12Worms_classCallCheck(this, WormProgress);QuestL12Worms_defineProperty(this, "glandsRequired", void 0);QuestL12Worms_defineProperty(this, "effect", void 0);QuestL12Worms_defineProperty(this, "location", void 0);QuestL12Worms_defineProperty(this, "dropsItem", void 0);
    this.location = location;
    this.glandsRequired = itemRequired;
    this.dropsItem = dropsItem;

    if (itemRequired == null) {
      return;
    }

    this.effect = (0,external_kolmafia_.effectModifier)(itemRequired, "Effect");
  }QuestL12Worms_createClass(WormProgress, [{ key: "isDoable", value:

    function isDoable() {
      return (
        this.glandsRequired == null ||
        (0,external_kolmafia_.haveEffect)(this.effect) > 0 ||
        (0,external_kolmafia_.availableAmount)(this.glandsRequired) > 0);

    } }]);return WormProgress;}();
;// CONCATENATED MODULE: ./src/quests/council/QuestL12War.ts
function QuestL12War_typeof(obj) {"@babel/helpers - typeof";return QuestL12War_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL12War_typeof(obj);}function QuestL12War_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL12War_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL12War_toPropertyKey(descriptor.key), descriptor);}}function QuestL12War_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL12War_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL12War_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL12War_defineProperty(obj, key, value) {key = QuestL12War_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL12War_toPropertyKey(arg) {var key = QuestL12War_toPrimitive(arg, "string");return QuestL12War_typeof(key) === "symbol" ? key : String(key);}function QuestL12War_toPrimitive(input, hint) {if (QuestL12War_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL12War_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}












var QuestL12War = /*#__PURE__*/function () {function QuestL12War() {QuestL12War_classCallCheck(this, QuestL12War);QuestL12War_defineProperty(this, "children",
    [
    new QuestL12Battlefield(),
    new WarGremlins(),
    new Quest12WarNuns(),
    new QuestL12Worms(),
    new QuestL12StartWar(),
    new QuestL12WarBoss(),
    new QuestL12Lobster(),
    new QuestL12WarFlyers(),
    new QuestL12FratOutfit()]);}QuestL12War_createClass(QuestL12War, [{ key: "getLocations", value:


    function getLocations() {
      return [];
    } }, { key: "getChildren", value:

    function getChildren() {
      return this.children;
    } }, { key: "getId", value:

    function getId() {
      return "Council / War / Parent";
    } }, { key: "level", value:

    function level() {
      return -1;
    } }, { key: "status", value:

    function status() {
      return QuestStatus.COMPLETED;
    } }, { key: "run", value:

    function run() {
      throw new Error("Method not implemented.");
    } }]);return QuestL12War;}();
;// CONCATENATED MODULE: ./src/quests/council/tower/keys/QuestSkeletonKey.ts
function QuestSkeletonKey_typeof(obj) {"@babel/helpers - typeof";return QuestSkeletonKey_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestSkeletonKey_typeof(obj);}function QuestSkeletonKey_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestSkeletonKey_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestSkeletonKey_toPropertyKey(descriptor.key), descriptor);}}function QuestSkeletonKey_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestSkeletonKey_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestSkeletonKey_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestSkeletonKey_defineProperty(obj, key, value) {key = QuestSkeletonKey_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestSkeletonKey_toPropertyKey(arg) {var key = QuestSkeletonKey_toPrimitive(arg, "string");return QuestSkeletonKey_typeof(key) === "symbol" ? key : String(key);}function QuestSkeletonKey_toPrimitive(input, hint) {if (QuestSkeletonKey_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestSkeletonKey_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestSkeletonKey = /*#__PURE__*/function () {function QuestSkeletonKey() {QuestSkeletonKey_classCallCheck(this, QuestSkeletonKey);QuestSkeletonKey_defineProperty(this, "key",
    external_kolmafia_.Item.get("Skeleton Key"));QuestSkeletonKey_defineProperty(this, "bone",
    external_kolmafia_.Item.get("skeleton bone"));QuestSkeletonKey_defineProperty(this, "teeth",
    external_kolmafia_.Item.get("loose teeth"));QuestSkeletonKey_defineProperty(this, "location",
    external_kolmafia_.Location.get(" The Skeleton Store"));QuestSkeletonKey_defineProperty(this, "priceTag",
    external_kolmafia_.Item.get("bone with a price tag on it"));}QuestSkeletonKey_createClass(QuestSkeletonKey, [{ key: "getId", value:

    function getId() {
      return "Council / Tower / Keys / Skeleton";
    } }, { key: "level", value:

    function level() {
      return 7;
    } }, { key: "status", value:

    function status() {
      if (
      getQuestStatus("questL13Final") > 5 ||
      (0,external_kolmafia_.availableAmount)(this.key) > 0 ||
      (0,external_kolmafia_.getProperty)("nsTowerDoorKeysUsed").includes(this.key.name))
      {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.availableAmount)(this.bone) > 0 && (0,external_kolmafia_.availableAmount)(this.teeth) > 0) {
        if ((0,external_kolmafia_.myMeat)() > 100) {
          return QuestStatus.READY;
        } else {
          return QuestStatus.NOT_READY;
        }
      }

      if ((0,external_kolmafia_.pullsRemaining)() == -1) {
        return QuestStatus.READY;
      }

      if (!canGreyAdventure(this.location)) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.FASTER_LATER;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return (
        (0,external_kolmafia_.pullsRemaining)() == -1 ||
        (0,external_kolmafia_.availableAmount)(this.bone) > 0 && (0,external_kolmafia_.availableAmount)(this.teeth) > 0);

    } }, { key: "free", value:

    function free() {
      return this.mustBeDone();
    } }, { key: "run", value:

    function run() {
      if (
      (0,external_kolmafia_.pullsRemaining)() == -1 ||
      (0,external_kolmafia_.availableAmount)(this.bone) > 0 && (0,external_kolmafia_.availableAmount)(this.teeth) > 0)
      {
        return this.craft();
      }

      return this.adventure();
    } }, { key: "craft", value:

    function craft() {var _this = this;
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          (0,external_kolmafia_.cliExecute)("acquire " + _this.key);

          if ((0,external_kolmafia_.availableAmount)(_this.key) == 0) {
            throw "Failed to acquire " + _this.key;
          }
        }
      };
    } }, { key: "adventure", value:

    function adventure() {var _this2 = this;
      var outfit = new GreyOutfit().setItemDrops();

      return {
        location: this.location,
        outfit: outfit,
        run: function run() {
          greyAdv(_this2.location, outfit);
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }]);return QuestSkeletonKey;}();
;// CONCATENATED MODULE: ./src/quests/council/tower/keys/QuestStarKey.ts
function QuestStarKey_typeof(obj) {"@babel/helpers - typeof";return QuestStarKey_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestStarKey_typeof(obj);}function QuestStarKey_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestStarKey_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestStarKey_toPropertyKey(descriptor.key), descriptor);}}function QuestStarKey_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestStarKey_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestStarKey_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestStarKey_defineProperty(obj, key, value) {key = QuestStarKey_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestStarKey_toPropertyKey(arg) {var key = QuestStarKey_toPrimitive(arg, "string");return QuestStarKey_typeof(key) === "symbol" ? key : String(key);}function QuestStarKey_toPrimitive(input, hint) {if (QuestStarKey_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestStarKey_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestStarKey = /*#__PURE__*/function () {function QuestStarKey() {QuestStarKey_classCallCheck(this, QuestStarKey);QuestStarKey_defineProperty(this, "location",
    external_kolmafia_.Location.get("The Hole in the sky"));QuestStarKey_defineProperty(this, "rocket",
    external_kolmafia_.Item.get("steam-powered model rocketship"));QuestStarKey_defineProperty(this, "star",
    external_kolmafia_.Item.get("Star"));QuestStarKey_defineProperty(this, "map",
    external_kolmafia_.Item.get("Star Chart"));QuestStarKey_defineProperty(this, "line",
    external_kolmafia_.Item.get("Line"));QuestStarKey_defineProperty(this, "key",
    external_kolmafia_.Item.get("Richard's star key"));QuestStarKey_defineProperty(this, "astromner",
    external_kolmafia_.Monster.get("Astronomer"));QuestStarKey_defineProperty(this, "toAbsorb", void 0);}QuestStarKey_createClass(QuestStarKey, [{ key: "level", value:


    function level() {
      return 8;
    } }, { key: "status", value:

    function status() {
      if (
      getQuestStatus("questL13Final") > 5 ||
      (0,external_kolmafia_.availableAmount)(this.key) > 0 ||
      (0,external_kolmafia_.getProperty)("nsTowerDoorKeysUsed").includes(this.key.name))
      {
        return QuestStatus.COMPLETED;
      }

      if (
      !this.hasEnoughMaterials() &&
      GreySettings_GreySettings.shouldAvoidTowerRequirements())
      {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.availableAmount)(this.rocket) == 0) {
        return QuestStatus.NOT_READY;
      }

      /*if (getQuestStatus("questL13Final") < 5) {
        return QuestStatus.NOT_READY;
      }*/

      if (
      this.toAbsorb.length == 0 &&
      GreySettings_GreySettings.shouldAvoidTowerRequirements() &&
      (0,external_kolmafia_.getProperty)("_greyReachedTower") != "true")
      {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "hasEnoughMaterials", value:

    function hasEnoughMaterials() {
      return (
        (0,external_kolmafia_.pullsRemaining)() == -1 ||
        (0,external_kolmafia_.availableAmount)(this.map) > 0 &&
        (0,external_kolmafia_.availableAmount)(this.line) >= 7 &&
        (0,external_kolmafia_.availableAmount)(this.star) >= 8);

    } }, { key: "run", value:

    function run() {var _this = this;
      if (this.hasEnoughMaterials()) {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {
            (0,external_kolmafia_.retrieveItem)(_this.key);
          }
        };
      }

      var outfit = new GreyOutfit().setItemDrops();

      return {
        location: this.location,
        outfit: outfit,
        orbs: (0,external_kolmafia_.availableAmount)(this.map) > 0 ? null : [this.astromner],
        run: function run() {
          greyAdv(_this.location, outfit);
        }
      };
    } }, { key: "getId", value:

    function getId() {
      return "Council / Tower / Keys / Star";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.location];
    } }]);return QuestStarKey;}();
;// CONCATENATED MODULE: ./src/quests/custom/QuestKeyStuffAbstract.ts
function QuestKeyStuffAbstract_typeof(obj) {"@babel/helpers - typeof";return QuestKeyStuffAbstract_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestKeyStuffAbstract_typeof(obj);}function QuestKeyStuffAbstract_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestKeyStuffAbstract_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestKeyStuffAbstract_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestKeyStuffAbstract_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestKeyStuffAbstract_arrayLikeToArray(o, minLen);}function QuestKeyStuffAbstract_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestKeyStuffAbstract_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestKeyStuffAbstract_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestKeyStuffAbstract_toPropertyKey(descriptor.key), descriptor);}}function QuestKeyStuffAbstract_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestKeyStuffAbstract_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestKeyStuffAbstract_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestKeyStuffAbstract_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestKeyStuffAbstract_setPrototypeOf(subClass, superClass);}function QuestKeyStuffAbstract_setPrototypeOf(o, p) {QuestKeyStuffAbstract_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestKeyStuffAbstract_setPrototypeOf(o, p);}function QuestKeyStuffAbstract_createSuper(Derived) {var hasNativeReflectConstruct = QuestKeyStuffAbstract_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestKeyStuffAbstract_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestKeyStuffAbstract_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestKeyStuffAbstract_possibleConstructorReturn(this, result);};}function QuestKeyStuffAbstract_possibleConstructorReturn(self, call) {if (call && (QuestKeyStuffAbstract_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestKeyStuffAbstract_assertThisInitialized(self);}function QuestKeyStuffAbstract_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestKeyStuffAbstract_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestKeyStuffAbstract_getPrototypeOf(o) {QuestKeyStuffAbstract_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestKeyStuffAbstract_getPrototypeOf(o);}function QuestKeyStuffAbstract_defineProperty(obj, key, value) {key = QuestKeyStuffAbstract_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestKeyStuffAbstract_toPropertyKey(arg) {var key = QuestKeyStuffAbstract_toPrimitive(arg, "string");return QuestKeyStuffAbstract_typeof(key) === "symbol" ? key : String(key);}function QuestKeyStuffAbstract_toPrimitive(input, hint) {if (QuestKeyStuffAbstract_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestKeyStuffAbstract_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}



var QuestKeyStuffAbstract = /*#__PURE__*/function (_TaskInfo) {QuestKeyStuffAbstract_inherits(QuestKeyStuffAbstract, _TaskInfo);var _super = QuestKeyStuffAbstract_createSuper(QuestKeyStuffAbstract);function QuestKeyStuffAbstract() {var _this;QuestKeyStuffAbstract_classCallCheck(this, QuestKeyStuffAbstract);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestKeyStuffAbstract_defineProperty(QuestKeyStuffAbstract_assertThisInitialized(_this), "keys",
    ["Boris's key", "Sneaky Pete's key", "Jarlsberg's key"].map(
    function (s) {return external_kolmafia_.Item.get(s);}));QuestKeyStuffAbstract_defineProperty(QuestKeyStuffAbstract_assertThisInitialized(_this), "zappables",

    []);QuestKeyStuffAbstract_defineProperty(QuestKeyStuffAbstract_assertThisInitialized(_this), "token",
    external_kolmafia_.Item.get("Fat loot token"));return _this;}QuestKeyStuffAbstract_createClass(QuestKeyStuffAbstract, [{ key: "getKeysUsed", value:

    function getKeysUsed() {var _this2 = this;
      return (0,external_kolmafia_.getProperty)("nsTowerDoorKeysUsed").
      split(",").
      filter(function (s) {return s.length > 0;}).
      map(function (s) {return external_kolmafia_.Item.get(s);}).
      filter(function (k) {return _this2.keys.includes(k);});
    } }, { key: "getUnusedKeys", value:



    function getUnusedKeys() {
      var used = this.getKeysUsed();

      return this.keys.filter(function (i) {return !used.includes(i);});
    } }, { key: "getKeysUnavailable", value:

    function getKeysUnavailable() {
      var used = this.getKeysUsed();

      return this.keys.filter(
      function (k) {return !used.includes(k) && (0,external_kolmafia_.availableAmount)(k) == 0;});

    } }, { key: "getOwnedZappables", value:

    function getOwnedZappables() {
      var owned = [];var _iterator = QuestKeyStuffAbstract_createForOfIteratorHelper(

        this.getZappableItems()),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var i = _step.value;
          for (var a = 0; a < (0,external_kolmafia_.availableAmount)(i); a++) {
            owned.push(i);
          }
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

      return owned;
    } }, { key: "getOwnedKeys", value:

    function getOwnedKeys() {
      return this.keys.filter(function (k) {return (0,external_kolmafia_.availableAmount)(k) > 0;});
    } }, { key: "getViableKeyCount", value:

    function getViableKeyCount() {
      var keys =
      (0,external_kolmafia_.availableAmount)(this.token) +
      this.getKeysUsed().length +
      this.getOwnedKeys().length;

      if ((0,external_kolmafia_.getProperty)("dailyDungeonDone") == "false") {
        keys += 1;

        if (
        !GreySettings_GreySettings.isHardcoreMode() &&
        (0,external_kolmafia_.getProperty)("dailyDungeonMalwareUsed") == "false")
        {
          keys += 1;
        }
      }

      /* // If we can fight bandit
      if (toInt(getProperty("_foughtFantasyRealm")) < 5) {
        // If we own fantasyrealm
        if (
          getProperty("frAlways") == "true" ||
          getProperty("_frToday") == "true"
        ) {
          keys++;
        } else if (
          canCombatLocket(Monster.get("Fantasy Bandit")) &&
          11 - toInt(getProperty("_backUpUses")) >= 4
        ) {
          keys += 1;
        }
      }*/

      return keys;
    } }, { key: "getZappableItems", value:

    function getZappableItems() {var _this3 = this;
      if (this.zappables.length == 0) {var _iterator2 = QuestKeyStuffAbstract_createForOfIteratorHelper(
          this.keys),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var i = _step2.value;
            Object.keys((0,external_kolmafia_.getRelated)(i, "zap")).forEach(function (s) {
              var i = external_kolmafia_.Item.get(s);

              if (_this3.zappables.includes(i) || _this3.keys.includes(i)) {
                return;
              }

              _this3.zappables.push(i);
            });
          }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}
      }

      return this.zappables;
    } }]);return QuestKeyStuffAbstract;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/tower/keys/heroes/QuestDailyDungeon.ts
function QuestDailyDungeon_typeof(obj) {"@babel/helpers - typeof";return QuestDailyDungeon_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestDailyDungeon_typeof(obj);}function QuestDailyDungeon_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestDailyDungeon_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestDailyDungeon_toPropertyKey(descriptor.key), descriptor);}}function QuestDailyDungeon_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestDailyDungeon_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestDailyDungeon_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestDailyDungeon_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestDailyDungeon_setPrototypeOf(subClass, superClass);}function QuestDailyDungeon_setPrototypeOf(o, p) {QuestDailyDungeon_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestDailyDungeon_setPrototypeOf(o, p);}function QuestDailyDungeon_createSuper(Derived) {var hasNativeReflectConstruct = QuestDailyDungeon_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestDailyDungeon_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestDailyDungeon_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestDailyDungeon_possibleConstructorReturn(this, result);};}function QuestDailyDungeon_possibleConstructorReturn(self, call) {if (call && (QuestDailyDungeon_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestDailyDungeon_assertThisInitialized(self);}function QuestDailyDungeon_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestDailyDungeon_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestDailyDungeon_getPrototypeOf(o) {QuestDailyDungeon_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestDailyDungeon_getPrototypeOf(o);}function QuestDailyDungeon_defineProperty(obj, key, value) {key = QuestDailyDungeon_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestDailyDungeon_toPropertyKey(arg) {var key = QuestDailyDungeon_toPrimitive(arg, "string");return QuestDailyDungeon_typeof(key) === "symbol" ? key : String(key);}function QuestDailyDungeon_toPrimitive(input, hint) {if (QuestDailyDungeon_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestDailyDungeon_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}












var QuestDailyDungeon = /*#__PURE__*/function (_TaskInfo) {QuestDailyDungeon_inherits(QuestDailyDungeon, _TaskInfo);var _super = QuestDailyDungeon_createSuper(QuestDailyDungeon);









  function QuestDailyDungeon(useMalware) {var _this;QuestDailyDungeon_classCallCheck(this, QuestDailyDungeon);
    _this = _super.call(this);QuestDailyDungeon_defineProperty(QuestDailyDungeon_assertThisInitialized(_this), "pole", external_kolmafia_.Item.get("eleven-foot pole"));QuestDailyDungeon_defineProperty(QuestDailyDungeon_assertThisInitialized(_this), "ring", external_kolmafia_.Item.get("ring of Detect Boring Doors"));QuestDailyDungeon_defineProperty(QuestDailyDungeon_assertThisInitialized(_this), "picklocks", external_kolmafia_.Item.get("Pick-O-Matic lockpicks"));QuestDailyDungeon_defineProperty(QuestDailyDungeon_assertThisInitialized(_this), "location", external_kolmafia_.Location.get("The Daily Dungeon"));QuestDailyDungeon_defineProperty(QuestDailyDungeon_assertThisInitialized(_this), "fam", external_kolmafia_.Familiar.get("Gelatinous Cubeling"));QuestDailyDungeon_defineProperty(QuestDailyDungeon_assertThisInitialized(_this), "malware", external_kolmafia_.Item.get("Daily dungeon malware"));QuestDailyDungeon_defineProperty(QuestDailyDungeon_assertThisInitialized(_this), "paths", void 0);QuestDailyDungeon_defineProperty(QuestDailyDungeon_assertThisInitialized(_this), "usingMalware", void 0);

    _this.usingMalware = useMalware;return _this;
  }QuestDailyDungeon_createClass(QuestDailyDungeon, [{ key: "getKeys", value:

    function getKeys() {
      return this.usingMalware && !this.isMalwareUsed() ? 2 : 1;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.location];
    } }, { key: "isDailyDoneToday", value:

    function isDailyDoneToday() {
      return (0,external_kolmafia_.getProperty)("dailyDungeonDone") == "true";
    } }, { key: "createPaths", value:

    function createPaths(assumeUnstarted) {
      if (
      !assumeUnstarted &&
      GreySettings_GreySettings.shouldAvoidTowerRequirements() &&
      !GreySettings_GreySettings.greyReachedTower)
      {
        this.paths = null;
        return;
      }

      var mustDoMalware = GreySettings_GreySettings.greyDailyMalware == "Always";
      var mustNeverDoMalware = GreySettings_GreySettings.greyDailyMalware == "Never";

      if (
      mustDoMalware && (
      GreySettings_GreySettings.isHardcoreMode() || !this.usingMalware))
      {
        this.paths = null;
        return;
      } else if (mustNeverDoMalware && this.usingMalware) {
        this.paths = null;
        return;
      }

      this.paths = [];

      var path = new PossiblePath(4);

      this.paths.push(path);

      if (!this.usingMalware) {
        return;
      }

      var usedMalware = (0,external_kolmafia_.toBoolean)((0,external_kolmafia_.getProperty)("_dailyDungeonMalwareUsed"));

      if (!assumeUnstarted && usedMalware) {
        return;
      }

      path.addConsumablePull(this.malware);
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "hasFamiliarRecommendation", value:

    function hasFamiliarRecommendation() {
      if (
      GreySettings_GreySettings.shouldAvoidTowerRequirements() ||
      !(0,external_kolmafia_.haveFamiliar)(this.fam))
      {
        return null;
      }

      if (
      (0,external_kolmafia_.availableAmount)(this.pole) > 0 &&
      (0,external_kolmafia_.availableAmount)(this.ring) > 0 &&
      (0,external_kolmafia_.availableAmount)(this.picklocks) > 0)
      {
        return null;
      }

      return this.fam;
    } }, { key: "level", value:

    function level() {
      return 7;
    } }, { key: "status", value:

    function status() {
      if (getQuestStatus("questL13Final") > 5 || this.isDailyDoneToday()) {
        return QuestStatus.COMPLETED;
      }

      if (this.usingMalware) {
        if (
        GreySettings_GreySettings.isHardcoreMode() ||
        GreySettings_GreySettings.greyDailyMalware == "Never")
        {
          return QuestStatus.COMPLETED;
        } else if (GreySettings_GreySettings.shouldAvoidTowerRequirements()) {
          if (GreySettings_GreySettings.greyReachedTower) {
            return QuestStatus.READY;
          }

          return QuestStatus.NOT_READY;
        }
      }

      if (this.hasFamiliarRecommendation() != null && (0,external_kolmafia_.pullsRemaining)() >= 0) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "isMalwareUsed", value:

    function isMalwareUsed() {
      return (0,external_kolmafia_.getProperty)("_dailyDungeonMalwareUsed") == "true";
    } }, { key: "grabMalware", value:

    function grabMalware(path) {
      if (
      (0,external_kolmafia_.itemAmount)(this.malware) != 0 ||
      this.isMalwareUsed() ||
      !path.canUse(ResourceCategory.PULL))
      {
        return;
      }

      if ((0,external_kolmafia_.pullsRemaining)() == -1) {
        (0,external_kolmafia_.cliExecute)("acquire " + this.malware);
      } else {
        GreyPulls.tryPull(this.malware, 80000);
        path.addUsed(ResourceCategory.PULL);
      }

      if ((0,external_kolmafia_.itemAmount)(this.malware) == 0) {
        throw (
          "Expected to have " +
          this.malware +
          " on hand, something went wrong obviously.");

      }
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      var outfit = new GreyOutfit();
      outfit.addWeight(this.ring);

      return {
        outfit: outfit,
        location: this.location,
        freeRun: function freeRun() {return (0,external_kolmafia_.itemAmount)(_this2.malware) == 0 || _this2.isMalwareUsed();},
        run: function run() {
          var dontHave = [_this2.ring, _this2.picklocks, _this2.pole].filter(
          function (i) {return (0,external_kolmafia_.itemAmount)(i) + (0,external_kolmafia_.equippedAmount)(i) == 0;});


          if ((0,external_kolmafia_.pullsRemaining)() == -1 && dontHave.length > 0) {
            dontHave.forEach(function (i) {
              GreyPulls.tryPull(i, 5000);
              path.addUsed(ResourceCategory.PULL);

              if ((0,external_kolmafia_.itemAmount)(i) == 0) {
                throw "Expected to have " + i;
              }
            });
            return;
          } /*else if (dontHave.length > 0) {
          print("Uh oh! Missing " + dontHave.join(", ") + "!", "red");
          throw "Expected to have dungeon items, didn't.";
          }*/

          var props = new Properties_PropertyManager();
          var settings = new AdventureSettings();

          if (_this2.usingMalware) {
            _this2.grabMalware(path);

            if ((0,external_kolmafia_.itemAmount)(_this2.malware) > 0 && !_this2.isMalwareUsed()) {
              settings.setStartOfFightMacro(Macro.item(_this2.malware));
            }
          }

          props.setChoice(689, 1);
          props.setChoice(690, 2);
          props.setChoice(691, 2);
          props.setChoice(692, 3);
          props.setChoice(693, 2);

          try {
            greyAdv(_this2.location, outfit, settings);
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "getId", value:

    function getId() {
      if (this.usingMalware) {
        return "Council / Tower / Keys / Heroes / DailyDungeon + Malware";
      }

      return "Council / Tower / Keys / Heroes / DailyDungeon";
    } }]);return QuestDailyDungeon;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/tower/keys/heroes/QuestFantasyBandits.ts
function QuestFantasyBandits_typeof(obj) {"@babel/helpers - typeof";return QuestFantasyBandits_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestFantasyBandits_typeof(obj);}function QuestFantasyBandits_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestFantasyBandits_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestFantasyBandits_toPropertyKey(descriptor.key), descriptor);}}function QuestFantasyBandits_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestFantasyBandits_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestFantasyBandits_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestFantasyBandits_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestFantasyBandits_setPrototypeOf(subClass, superClass);}function QuestFantasyBandits_setPrototypeOf(o, p) {QuestFantasyBandits_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestFantasyBandits_setPrototypeOf(o, p);}function QuestFantasyBandits_createSuper(Derived) {var hasNativeReflectConstruct = QuestFantasyBandits_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestFantasyBandits_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestFantasyBandits_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestFantasyBandits_possibleConstructorReturn(this, result);};}function QuestFantasyBandits_possibleConstructorReturn(self, call) {if (call && (QuestFantasyBandits_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestFantasyBandits_assertThisInitialized(self);}function QuestFantasyBandits_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestFantasyBandits_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestFantasyBandits_getPrototypeOf(o) {QuestFantasyBandits_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestFantasyBandits_getPrototypeOf(o);}function QuestFantasyBandits_defineProperty(obj, key, value) {key = QuestFantasyBandits_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestFantasyBandits_toPropertyKey(arg) {var key = QuestFantasyBandits_toPrimitive(arg, "string");return QuestFantasyBandits_typeof(key) === "symbol" ? key : String(key);}function QuestFantasyBandits_toPrimitive(input, hint) {if (QuestFantasyBandits_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestFantasyBandits_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}










var QuestFantasyBandit = /*#__PURE__*/function (_TaskInfo) {QuestFantasyBandits_inherits(QuestFantasyBandit, _TaskInfo);var _super = QuestFantasyBandits_createSuper(QuestFantasyBandit);function QuestFantasyBandit() {var _this;QuestFantasyBandits_classCallCheck(this, QuestFantasyBandit);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestFantasyBandits_defineProperty(QuestFantasyBandits_assertThisInitialized(_this), "fought",
    "_foughtFantasyRealm");QuestFantasyBandits_defineProperty(QuestFantasyBandits_assertThisInitialized(_this), "monster",
    external_kolmafia_.Monster.get("Fantasy Bandit"));QuestFantasyBandits_defineProperty(QuestFantasyBandits_assertThisInitialized(_this), "camera",
    external_kolmafia_.Item.get("Backup Camera"));QuestFantasyBandits_defineProperty(QuestFantasyBandits_assertThisInitialized(_this), "location",
    external_kolmafia_.Location.get("The Bandit Crossroads"));QuestFantasyBandits_defineProperty(QuestFantasyBandits_assertThisInitialized(_this), "equip",
    external_kolmafia_.Item.get("FantasyRealm G. E. M."));QuestFantasyBandits_defineProperty(QuestFantasyBandits_assertThisInitialized(_this), "token",
    external_kolmafia_.Item.get("fat loot token"));QuestFantasyBandits_defineProperty(QuestFantasyBandits_assertThisInitialized(_this), "path", void 0);return _this;}QuestFantasyBandits_createClass(QuestFantasyBandit, [{ key: "getKeys", value:


    function getKeys() {
      return 1;
    } }, { key: "createPaths", value:

    function createPaths(assumeUnstarted) {
      // We copy 4 times, fax 1 time
      // How many copies we want to perform
      var fightsRemaining = 5 - (assumeUnstarted ? 0 : this.getFoughtToday());

      this.path = new PossiblePath(fightsRemaining);

      // If we have realm access, no need for further resources.
      if (this.hasRealmAccess()) {
        return;
      }

      // If the last monster was is a bandit, no need to fax
      // But we still need to fight X more bandits.
      if (this.lastBackup() != this.monster || assumeUnstarted) {
        this.path.addFax(this.monster).addIgnored("Wish");
      } else {
        // We need to fax, so one of those copies is a fax and can be removed
        fightsRemaining--;
      }

      this.path.add(ResourceCategory.COPIER, fightsRemaining - 1);

      // If we're assuming we've unstarted, no need to add this stuff
      if (assumeUnstarted) {
        return;
      }

      // Assuming we're at fought = 1, so 4 bandits remaining.
      // If last monster is sheep, then we'd need to do a fax and 3 copies = 4
      // If last monster is bandit, then we'd need to do 4 copies
      for (var i = fightsRemaining; i < 4; i++) {

        //  this.path.addUsed(ResourceCategory.COPIER);
      }} }, { key: "grabFantasyGem", value:

    function grabFantasyGem() {var _this2 = this;
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          (0,external_kolmafia_.visitUrl)("place.php?whichplace=realm_fantasy&action=fr_initcenter");
          (0,external_kolmafia_.runChoice)(3);

          if ((0,external_kolmafia_.availableAmount)(_this2.equip) == 0) {
            throw "I unexpectedly didn't acquire the fantasyrealm gem!";
          }
        }
      };
    } }, { key: "runFantasyRealm", value:

    function runFantasyRealm() {var _this3 = this;
      if ((0,external_kolmafia_.availableAmount)(this.equip) == 0) {
        return this.grabFantasyGem();
      }

      var outfit = new GreyOutfit();
      // Try avoid exp stuff being added cos we're not running a fam
      outfit.addWeight("familiar exp", -100);
      outfit.addWeight(this.equip);

      return {
        location: this.location,
        familiar: external_kolmafia_.Familiar.none,
        disableFamOverride: true,
        outfit: outfit,
        run: function run() {
          var props = new Properties_PropertyManager();
          props.setChoice(1281, 0); // Don't handle

          if ((0,external_kolmafia_.myFamiliar)() != external_kolmafia_.Familiar.none) {
            (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.none);
          }

          var tokens = (0,external_kolmafia_.availableAmount)(_this3.token);

          try {
            greyAdv(_this3.location, outfit);
            _this3.addFought();
          } catch (e) {
            (0,external_kolmafia_.print)(
            "We errored, did we hit crossroads choice? We deliberately should not hit that if we still haven't finished fantasy bandits. You may need to set '_foughtFantasyRealm' to 5",
            "red");

            throw e;
          } finally {
            props.resetAll();
          }

          if (_this3.hasFoughtEnough() && (0,external_kolmafia_.availableAmount)(_this3.token) == tokens) {
            throw "Expected to have a fat loot token from fantasyland, didn't!";
          }
        }
      };
    } }, { key: "hasRealmAccess", value:

    function hasRealmAccess() {
      return (
        (0,external_kolmafia_.getProperty)("frAlways") == "true" || (0,external_kolmafia_.getProperty)("_frToday") == "true");

    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return [this.path];
    } }, { key: "getFoughtToday", value:

    function getFoughtToday() {
      var setting = (0,external_kolmafia_.getProperty)(this.fought);

      if (setting == "") {
        return 0;
      }

      return (0,external_kolmafia_.toInt)(setting);
    } }, { key: "addFought", value:

    function addFought() {
      (0,external_kolmafia_.setProperty)(this.fought, (this.getFoughtToday() + 1).toString());
    } }, { key: "getId", value:

    function getId() {
      return "Council / Tower / Keys / Heroes / FantasyBandit";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "hasFoughtEnough", value:

    function hasFoughtEnough() {
      return this.getFoughtToday() >= 5;
    } }, { key: "status", value:

    function status() {
      if (this.hasFoughtEnough()) {
        return QuestStatus.COMPLETED;
      }

      /*if (!GreySettings.greyFantasyBandits)
       {
        if (
          GreySettings.shouldAvoidTowerRequirements() ||
          GreySettings.isHardcoreMode()
        ) {
          return QuestStatus.NOT_READY;
        }
      }*/

      if (getQuestStatus("questL08Trapper") <= 1) {
        return QuestStatus.NOT_READY;
      }

      if (!this.hasRealmAccess() && this.lastBackup() == this.monster) {
        return QuestStatus.READY;
      }

      if ((0,external_kolmafia_.myAdventures)() < 30) {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "lastBackup", value:

    function lastBackup() {
      return (0,external_kolmafia_.getProperty)("lastCopyableMonster") == "" ?
      null :
      external_kolmafia_.Monster.get((0,external_kolmafia_.getProperty)("lastCopyableMonster"));
    } }, { key: "run", value:

    function run(path) {
      if (this.hasRealmAccess()) {
        return this.runFantasyRealm();
      }

      return this.doFaxingBandits(path);
    } }, { key: "doFaxingBandits", value:

    function doFaxingBandits(path) {var _this4 = this;
      if (
      !path.canUse(ResourceCategory.FAXER) &&
      this.lastBackup() != this.monster)
      {
        throw "Unable to do fantasy bandits";
      }

      if (
      path.canUse(ResourceCategory.FAXER) &&
      this.lastBackup() != this.monster)
      {
        var _resource = path.getResource(ResourceCategory.FAXER);

        return {
          location: null,
          run: function run() {
            _resource.fax(_this4.monster);

            greyAdv("main.php");

            _this4.addFought();
            path.addUsed(ResourceCategory.FAXER);
          }
        };
      }

      var outfit = new GreyOutfit();
      var loc = external_kolmafia_.Location.get("The Dire Warren");
      var resource = path.getResource(ResourceCategory.COPIER);
      resource.prepare(outfit);

      // TODO Backup and ruin other zones delay
      return {
        outfit: outfit,
        location: null,
        mayFreeRun: false,
        run: function run() {
          greyAdv(
          loc,
          outfit,
          new AdventureSettings().setStartOfFightMacro(
          new Macro().if_(external_kolmafia_.Monster.get("Fluffy Bunny"), resource.macro())));


          _this4.addFought();
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return (
        this.getFoughtToday() > 0 &&
        !this.hasFoughtEnough() &&
        !this.hasRealmAccess());

    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestFantasyBandit;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/tower/keys/heroes/QuestPackOfCardsKey.ts
function QuestPackOfCardsKey_typeof(obj) {"@babel/helpers - typeof";return QuestPackOfCardsKey_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestPackOfCardsKey_typeof(obj);}function QuestPackOfCardsKey_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestPackOfCardsKey_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestPackOfCardsKey_toPropertyKey(descriptor.key), descriptor);}}function QuestPackOfCardsKey_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestPackOfCardsKey_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestPackOfCardsKey_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestPackOfCardsKey_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestPackOfCardsKey_setPrototypeOf(subClass, superClass);}function QuestPackOfCardsKey_setPrototypeOf(o, p) {QuestPackOfCardsKey_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestPackOfCardsKey_setPrototypeOf(o, p);}function QuestPackOfCardsKey_createSuper(Derived) {var hasNativeReflectConstruct = QuestPackOfCardsKey_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestPackOfCardsKey_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestPackOfCardsKey_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestPackOfCardsKey_possibleConstructorReturn(this, result);};}function QuestPackOfCardsKey_possibleConstructorReturn(self, call) {if (call && (QuestPackOfCardsKey_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestPackOfCardsKey_assertThisInitialized(self);}function QuestPackOfCardsKey_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestPackOfCardsKey_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestPackOfCardsKey_getPrototypeOf(o) {QuestPackOfCardsKey_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestPackOfCardsKey_getPrototypeOf(o);}function QuestPackOfCardsKey_defineProperty(obj, key, value) {key = QuestPackOfCardsKey_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestPackOfCardsKey_toPropertyKey(arg) {var key = QuestPackOfCardsKey_toPrimitive(arg, "string");return QuestPackOfCardsKey_typeof(key) === "symbol" ? key : String(key);}function QuestPackOfCardsKey_toPrimitive(input, hint) {if (QuestPackOfCardsKey_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestPackOfCardsKey_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var QuestPackOfCardsKey = /*#__PURE__*/function (_TaskInfo) {QuestPackOfCardsKey_inherits(QuestPackOfCardsKey, _TaskInfo);var _super = QuestPackOfCardsKey_createSuper(QuestPackOfCardsKey);function QuestPackOfCardsKey() {var _this;QuestPackOfCardsKey_classCallCheck(this, QuestPackOfCardsKey);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestPackOfCardsKey_defineProperty(QuestPackOfCardsKey_assertThisInitialized(_this), "pickCard", void 0);return _this;}QuestPackOfCardsKey_createClass(QuestPackOfCardsKey, [{ key: "getKeys", value:


    function getKeys() {
      return 1;
    } }, { key: "createPaths", value:

    function createPaths(assumeUnstarted) {
      this.pickCard = new PossiblePath(0).add(
      ResourceCategory.DECK_OF_EVERY_CARD_CHEAT);

    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return [this.pickCard];
    } }, { key: "getId", value:

    function getId() {
      return "Council / Tower / Keys / Heroes / DeckOfCards";
    } }, { key: "level", value:

    function level() {
      return 13;
    } }, { key: "status", value:

    function status(path) {
      if ((0,external_kolmafia_.getProperty)("_deckCardsSeen").includes("XVI - The Tower")) {
        return QuestStatus.COMPLETED;
      }

      if (
      path != null &&
      !path.canUse(ResourceCategory.DECK_OF_EVERY_CARD_CHEAT))
      {
        return QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run(path) {
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          path.
          getResource(ResourceCategory.DECK_OF_EVERY_CARD_CHEAT).
          pickCard("XVI - The Tower");
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "needAdventures", value:

    function needAdventures() {
      return 0;
    } }]);return QuestPackOfCardsKey;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/tower/keys/heroes/QuestPullAndZapKeys.ts
function QuestPullAndZapKeys_typeof(obj) {"@babel/helpers - typeof";return QuestPullAndZapKeys_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestPullAndZapKeys_typeof(obj);}function QuestPullAndZapKeys_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestPullAndZapKeys_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestPullAndZapKeys_toConsumableArray(arr) {return QuestPullAndZapKeys_arrayWithoutHoles(arr) || QuestPullAndZapKeys_iterableToArray(arr) || QuestPullAndZapKeys_unsupportedIterableToArray(arr) || QuestPullAndZapKeys_nonIterableSpread();}function QuestPullAndZapKeys_nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function QuestPullAndZapKeys_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestPullAndZapKeys_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestPullAndZapKeys_arrayLikeToArray(o, minLen);}function QuestPullAndZapKeys_iterableToArray(iter) {if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);}function QuestPullAndZapKeys_arrayWithoutHoles(arr) {if (Array.isArray(arr)) return QuestPullAndZapKeys_arrayLikeToArray(arr);}function QuestPullAndZapKeys_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestPullAndZapKeys_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestPullAndZapKeys_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestPullAndZapKeys_toPropertyKey(descriptor.key), descriptor);}}function QuestPullAndZapKeys_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestPullAndZapKeys_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestPullAndZapKeys_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestPullAndZapKeys_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestPullAndZapKeys_setPrototypeOf(subClass, superClass);}function QuestPullAndZapKeys_setPrototypeOf(o, p) {QuestPullAndZapKeys_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestPullAndZapKeys_setPrototypeOf(o, p);}function QuestPullAndZapKeys_createSuper(Derived) {var hasNativeReflectConstruct = QuestPullAndZapKeys_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestPullAndZapKeys_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestPullAndZapKeys_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestPullAndZapKeys_possibleConstructorReturn(this, result);};}function QuestPullAndZapKeys_possibleConstructorReturn(self, call) {if (call && (QuestPullAndZapKeys_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestPullAndZapKeys_assertThisInitialized(self);}function QuestPullAndZapKeys_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestPullAndZapKeys_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestPullAndZapKeys_getPrototypeOf(o) {QuestPullAndZapKeys_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestPullAndZapKeys_getPrototypeOf(o);}function QuestPullAndZapKeys_defineProperty(obj, key, value) {key = QuestPullAndZapKeys_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestPullAndZapKeys_toPropertyKey(arg) {var key = QuestPullAndZapKeys_toPrimitive(arg, "string");return QuestPullAndZapKeys_typeof(key) === "symbol" ? key : String(key);}function QuestPullAndZapKeys_toPrimitive(input, hint) {if (QuestPullAndZapKeys_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestPullAndZapKeys_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}











var QuestPullAndZapKeys = /*#__PURE__*/function (_QuestKeyStuffAbstrac) {QuestPullAndZapKeys_inherits(QuestPullAndZapKeys, _QuestKeyStuffAbstrac);var _super = QuestPullAndZapKeys_createSuper(QuestPullAndZapKeys);






  function QuestPullAndZapKeys(keys) {var _this;QuestPullAndZapKeys_classCallCheck(this, QuestPullAndZapKeys);
    _this = _super.call(this);QuestPullAndZapKeys_defineProperty(QuestPullAndZapKeys_assertThisInitialized(_this), "paths", void 0);QuestPullAndZapKeys_defineProperty(QuestPullAndZapKeys_assertThisInitialized(_this), "keysToAcquire", void 0);

    if (keys > 2) {
      throw "We can't do more than 2 zaps!";
    }

    _this.keysToAcquire = keys;return _this;
  }QuestPullAndZapKeys_createClass(QuestPullAndZapKeys, [{ key: "getKeys", value:

    function getKeys() {
      return this.keysToAcquire;
    } }, { key: "getId", value:

    function getId() {
      return "Council / Tower / Keys / Heroes / Buy and Zap Keys";
    } }, { key: "createPaths", value:

    function createPaths(assumeUnstarted) {var _this2 = this;
      if (
      this.keysToAcquire == 0 ||
      !assumeUnstarted && GreySettings_GreySettings.isHardcoreMode())
      {
        this.paths = null;
        return;
      }

      var pullableKeys = GreyPulls.getPullableKeys();

      if (!assumeUnstarted && (0,external_kolmafia_.pullsRemaining)() >= 0) {
        pullableKeys = pullableKeys.filter(
        function (i) {return !hasPulled(i) || (0,external_kolmafia_.availableAmount)(i) > 0;});

      } else {
        // Since we have unlimited pulls..
        for (var i = 1; i < Math.min(2, this.keysToAcquire); i++) {var _pullableKeys;
          (_pullableKeys = pullableKeys).push.apply(_pullableKeys, QuestPullAndZapKeys_toConsumableArray(GreyPulls.getPullableKeys()));
        }
      }

      if (pullableKeys.length < this.keysToAcquire) {
        this.paths = null;
        return;
      }

      this.paths = [];var _iterator = QuestPullAndZapKeys_createForOfIteratorHelper(

        getAllCombinations(pullableKeys)),_step;try {var _loop = function _loop() {var combination = _step.value;
          if (combination.length != _this2.keysToAcquire) {return "continue";

          }

          var path = new PossiblePath(0);

          combination.forEach(function (i) {
            path.addConsumablePull(i);

            path.add(ResourceCategory.ZAP);
          });

          _this2.paths.push(path);
        };for (_iterator.s(); !(_step = _iterator.n()).done;) {var _ret = _loop();if (_ret === "continue") continue;}} catch (err) {_iterator.e(err);} finally {_iterator.f();}
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "level", value:

    function level() {
      return 8;
    } }, { key: "status", value:

    function status(path) {
      if (this.keysToAcquire == 0) {
        return QuestStatus.COMPLETED;
      }

      var status = getQuestStatus("questL13Final");

      if (status < 5 || path == null) {
        return QuestStatus.NOT_READY;
      }

      if (status > 5) {
        return QuestStatus.COMPLETED;
      }

      if (!path.canUse(ResourceCategory.PULL)) {
        return QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run(path) {var _this3 = this;
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          var wand = (0,external_kolmafia_.getZapWand)();

          if (wand == external_kolmafia_.Item.none) {
            throw "Expected a wand! What happened!";
          }

          var toPull = path.pulls.find(function (i) {return !hasPulled(i);});

          if (toPull == null) {
            throw "Failed to find a zappable key to pull?";
          }

          GreyPulls.tryRetrieve(toPull, 80000);

          if ((0,external_kolmafia_.itemAmount)(toPull) == 0) {
            throw "Expected to have a zappable key grabbed";
          }

          var toZap = _this3.getOwnedZappables();
          var zapped = (0,external_kolmafia_.zap)(toZap[0]);

          if (!_this3.keys.includes(zapped)) {
            throw (
              "Ugh, we failed to zap " +
              toZap[0] +
              " properly. We got " +
              zapped +
              " instead.");

          }
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }]);return QuestPullAndZapKeys;}(QuestKeyStuffAbstract);
;// CONCATENATED MODULE: ./src/quests/council/tower/keys/heroes/QuestHeroKeys.ts
function QuestHeroKeys_typeof(obj) {"@babel/helpers - typeof";return QuestHeroKeys_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestHeroKeys_typeof(obj);}function QuestHeroKeys_slicedToArray(arr, i) {return QuestHeroKeys_arrayWithHoles(arr) || QuestHeroKeys_iterableToArrayLimit(arr, i) || QuestHeroKeys_unsupportedIterableToArray(arr, i) || QuestHeroKeys_nonIterableRest();}function QuestHeroKeys_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function QuestHeroKeys_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function QuestHeroKeys_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function QuestHeroKeys_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestHeroKeys_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestHeroKeys_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestHeroKeys_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestHeroKeys_arrayLikeToArray(o, minLen);}function QuestHeroKeys_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestHeroKeys_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestHeroKeys_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestHeroKeys_toPropertyKey(descriptor.key), descriptor);}}function QuestHeroKeys_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestHeroKeys_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestHeroKeys_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestHeroKeys_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestHeroKeys_setPrototypeOf(subClass, superClass);}function QuestHeroKeys_setPrototypeOf(o, p) {QuestHeroKeys_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestHeroKeys_setPrototypeOf(o, p);}function QuestHeroKeys_createSuper(Derived) {var hasNativeReflectConstruct = QuestHeroKeys_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestHeroKeys_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestHeroKeys_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestHeroKeys_possibleConstructorReturn(this, result);};}function QuestHeroKeys_possibleConstructorReturn(self, call) {if (call && (QuestHeroKeys_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestHeroKeys_assertThisInitialized(self);}function QuestHeroKeys_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestHeroKeys_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestHeroKeys_getPrototypeOf(o) {QuestHeroKeys_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestHeroKeys_getPrototypeOf(o);}function QuestHeroKeys_defineProperty(obj, key, value) {key = QuestHeroKeys_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestHeroKeys_toPropertyKey(arg) {var key = QuestHeroKeys_toPrimitive(arg, "string");return QuestHeroKeys_typeof(key) === "symbol" ? key : String(key);}function QuestHeroKeys_toPrimitive(input, hint) {if (QuestHeroKeys_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestHeroKeys_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}












var QuestHeroKeys = /*#__PURE__*/function (_TaskInfo) {QuestHeroKeys_inherits(QuestHeroKeys, _TaskInfo);var _super = QuestHeroKeys_createSuper(QuestHeroKeys);














  function QuestHeroKeys() {var _this;QuestHeroKeys_classCallCheck(this, QuestHeroKeys);
    _this = _super.call(this);QuestHeroKeys_defineProperty(QuestHeroKeys_assertThisInitialized(_this), "keys", ["Boris's key", "Sneaky Pete's key", "Jarlsberg's key"].map(function (s) {return external_kolmafia_.Item.get(s);}));QuestHeroKeys_defineProperty(QuestHeroKeys_assertThisInitialized(_this), "token", external_kolmafia_.Item.get("Fat loot token"));QuestHeroKeys_defineProperty(QuestHeroKeys_assertThisInitialized(_this), "quests", []);QuestHeroKeys_defineProperty(QuestHeroKeys_assertThisInitialized(_this), "paths", void 0);QuestHeroKeys_defineProperty(QuestHeroKeys_assertThisInitialized(_this), "conflicts", [["Council / Tower / Keys / Heroes / DailyDungeon", "Council / Tower / Keys / Heroes / DailyDungeon + Malware"], ["Council / Tower / Keys / Heroes / Buy and Zap Keys"]]);

    _this.quests.push(new QuestDailyDungeon(true));
    _this.quests.push(new QuestDailyDungeon(false));
    _this.quests.push(new QuestFantasyBandit());
    _this.quests.push(new QuestPackOfCardsKey());

    for (var i = 1; i <= 2; i++) {
      _this.quests.push(new QuestPullAndZapKeys(i));
    }return _this;
  }QuestHeroKeys_createClass(QuestHeroKeys, [{ key: "getTokensAvailable", value:

    function getTokensAvailable() {
      return (
        (0,external_kolmafia_.itemAmount)(this.token) + (
        (0,external_kolmafia_.pullsRemaining)() == -1 ? (0,external_kolmafia_.storageAmount)(this.token) : 0));

    } }, { key: "getMissingKeys", value:

    function getMissingKeys() {
      return Math.max(
      0,
      3 - (
      this.getTokensAvailable() +
      this.keys.filter(function (i) {return (0,external_kolmafia_.availableAmount)(i) > 0;}).length));

    } }, { key: "createPaths", value:

    function createPaths(assumeUnstarted) {var _this2 = this;
      // If we're avoiding the tower requirements, and haven't reached tower yet.
      // Don't use our resources on key stuff
      if (
      !assumeUnstarted && (
      GreySettings_GreySettings.shouldAvoidTowerRequirements() &&
      !GreySettings_GreySettings.greyReachedTower ||
      getQuestStatus("questL13Final") > 5))
      {
        this.paths = null;
        return;
      }

      var allPaths = [];var _iterator = QuestHeroKeys_createForOfIteratorHelper(

        this.quests),_step;try {var _loop = function _loop() {var quest = _step.value;
          if (!(quest instanceof TaskInfo)) {
            (0,external_kolmafia_.print)("Unknown key path " + quest.getId(), "red");return "continue";

          }

          quest.createPaths(assumeUnstarted);

          var paths = quest.getPossiblePaths();

          // This shouldn't be done at this point
          if (paths == null) {
            //   print("Can't do " + quest.getId());
            return "continue";
          }

          if (paths.length == 0) {
            (0,external_kolmafia_.print)("Empty paths found for key path, " + quest.getId(), "red");return "continue";

          }

          paths = paths.filter(
          function (p) {return (
              assumeUnstarted ||
              quest.status(p) != QuestStatus.COMPLETED);});


          if (paths.length == 0) {return "continue";

          }

          quest.getPossiblePaths().forEach(function (path) {
            allPaths.push([quest, path]);
          });
        };for (_iterator.s(); !(_step = _iterator.n()).done;) {var _ret = _loop();if (_ret === "continue") continue;}} catch (err) {_iterator.e(err);} finally {_iterator.f();}

      if (getResourcesLeft("Pull", assumeUnstarted) <= 0) {
        allPaths = allPaths.filter(
        function (_ref) {var _ref2 = QuestHeroKeys_slicedToArray(_ref, 2),p = _ref2[1];return p.canUse(ResourceCategory.PULL) == 0;});

      }

      var keysNeeded = assumeUnstarted ? 3 : this.getMissingKeys();
      var shouldDoDaily =
      GreySettings_GreySettings.greyDailyDungeon && (
      assumeUnstarted || (0,external_kolmafia_.getProperty)("dailyDungeonDone") != "true");

      this.paths = [];

      if (keysNeeded <= 0 && !shouldDoDaily) {
        this.paths.push(new PossibleMultiPath(0));
        return;
      }var _iterator2 = QuestHeroKeys_createForOfIteratorHelper(

        getAllCombinations(allPaths)),_step2;try {var _loop2 = function _loop2() {var combination = _step2.value;
          // Detect conflicts
          var _iterator4 = QuestHeroKeys_createForOfIteratorHelper(_this2.conflicts),_step4;try {for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {var conflicts = _step4.value;
              var hits = conflicts.filter(function (c) {return (
                  combination.find(function (_ref9) {var _ref10 = QuestHeroKeys_slicedToArray(_ref9, 1),c1 = _ref10[0];return c1.getId() == c;}));}).
              length;

              if (hits > 1) {return "continue|loop";

              }
            }} catch (err) {_iterator4.e(err);} finally {_iterator4.f();}

          var hittingMalware =
          combination.find(
          function (_ref3) {var _ref4 = QuestHeroKeys_slicedToArray(_ref3, 1),q = _ref4[0];return (
              q.getId() ==
              "Council / Tower / Keys / Heroes / DailyDungeon + Malware");}) !=
          null;

          var keysGiven = combination.
          map(function (_ref5) {var _ref6 = QuestHeroKeys_slicedToArray(_ref5, 1),c = _ref6[0];return c.getKeys();}).
          reduce(function (r1, r2) {return r1 + r2;});

          // If we won't get enough keys
          if (keysGiven < keysNeeded) {return "continue";

          }

          var maxKeys = keysNeeded;

          if (hittingMalware) {
            maxKeys++;
          }

          // If we're getting too many keys
          if (keysGiven > maxKeys) {return "continue";

          }

          // If we need to do daily dungeon as per settings, and this combination doesn't let us do that..
          if (
          shouldDoDaily &&
          combination.find(function (_ref7) {var _ref8 = QuestHeroKeys_slicedToArray(_ref7, 1),q = _ref8[0];return q instanceof QuestDailyDungeon;}) == null)
          {return "continue";

          }

          var path = new PossibleMultiPath(0);
          path.printUsing = true;

          combination.forEach(function (c) {
            path.addPath(c[0], c[1]);
          });

          _this2.paths.push(path);
        };loop: for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var _ret2 = _loop2();if (_ret2 === "continue|loop") continue loop;if (_ret2 === "continue") continue;}} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}

      if (this.paths.length == 0) {
        (0,external_kolmafia_.print)(
        "Failed to find a way to do the hero keys! Looking for " + keysNeeded,
        "red");


        (0,external_kolmafia_.print)("Hero Key Sources..", "red");var _iterator3 = QuestHeroKeys_createForOfIteratorHelper(

          this.quests),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var quest = _step3.value;
            (0,external_kolmafia_.print)(
            quest.getId() +
            " - Gives " +
            quest.getKeys() +
            " keys. Doable? " + (
            quest.status() != QuestStatus.COMPLETED) +
            ". Possible path count: " +
            quest.getPossiblePaths().length,
            "red");

          }} catch (err) {_iterator3.e(err);} finally {_iterator3.f();}
      }
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "level", value:

    function level() {
      return -1;
    } }, { key: "status", value:

    function status(path) {
      throw new Error("Method not implemented.");
    } }, { key: "run", value:

    function run(path) {
      throw new Error("Method not implemented.");
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "getId", value:

    function getId() {
      return "Council / Tower / Keys / Heroes";
    } }]);return QuestHeroKeys;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/tower/stages/QuestTowerKeys.ts
function QuestTowerKeys_typeof(obj) {"@babel/helpers - typeof";return QuestTowerKeys_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestTowerKeys_typeof(obj);}function QuestTowerKeys_slicedToArray(arr, i) {return QuestTowerKeys_arrayWithHoles(arr) || QuestTowerKeys_iterableToArrayLimit(arr, i) || QuestTowerKeys_unsupportedIterableToArray(arr, i) || QuestTowerKeys_nonIterableRest();}function QuestTowerKeys_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function QuestTowerKeys_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function QuestTowerKeys_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function QuestTowerKeys_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestTowerKeys_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestTowerKeys_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestTowerKeys_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestTowerKeys_arrayLikeToArray(o, minLen);}function QuestTowerKeys_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestTowerKeys_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestTowerKeys_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestTowerKeys_toPropertyKey(descriptor.key), descriptor);}}function QuestTowerKeys_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestTowerKeys_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestTowerKeys_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestTowerKeys_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestTowerKeys_setPrototypeOf(subClass, superClass);}function QuestTowerKeys_setPrototypeOf(o, p) {QuestTowerKeys_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestTowerKeys_setPrototypeOf(o, p);}function QuestTowerKeys_createSuper(Derived) {var hasNativeReflectConstruct = QuestTowerKeys_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestTowerKeys_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestTowerKeys_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestTowerKeys_possibleConstructorReturn(this, result);};}function QuestTowerKeys_possibleConstructorReturn(self, call) {if (call && (QuestTowerKeys_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestTowerKeys_assertThisInitialized(self);}function QuestTowerKeys_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestTowerKeys_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestTowerKeys_getPrototypeOf(o) {QuestTowerKeys_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestTowerKeys_getPrototypeOf(o);}function QuestTowerKeys_defineProperty(obj, key, value) {key = QuestTowerKeys_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestTowerKeys_toPropertyKey(arg) {var key = QuestTowerKeys_toPrimitive(arg, "string");return QuestTowerKeys_typeof(key) === "symbol" ? key : String(key);}function QuestTowerKeys_toPrimitive(input, hint) {if (QuestTowerKeys_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestTowerKeys_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}









var QuestTowerKeys = /*#__PURE__*/function (_QuestKeyStuffAbstrac) {QuestTowerKeys_inherits(QuestTowerKeys, _QuestKeyStuffAbstrac);var _super = QuestTowerKeys_createSuper(QuestTowerKeys);function QuestTowerKeys() {var _this;QuestTowerKeys_classCallCheck(this, QuestTowerKeys);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestTowerKeys_defineProperty(QuestTowerKeys_assertThisInitialized(_this), "keyItems",
    [
    ["ns_lock1", external_kolmafia_.Item.get("Boris's Key")],
    ["ns_lock2", external_kolmafia_.Item.get("Jarlsberg's Key")],
    ["ns_lock3", external_kolmafia_.Item.get("Sneaky Pete's Key")],
    ["ns_lock4", external_kolmafia_.Item.get("Richard's Star Key")],
    ["ns_lock5", external_kolmafia_.Item.get("Digital Key")],
    ["ns_lock6", external_kolmafia_.Item.get("Skeleton Key")]]);QuestTowerKeys_defineProperty(QuestTowerKeys_assertThisInitialized(_this), "children",

    [
    new QuestSkeletonKey(),
    new QuestStarKey(),
    new QuestHeroKeys()]);QuestTowerKeys_defineProperty(QuestTowerKeys_assertThisInitialized(_this), "refreshedStorage",


    false);return _this;}QuestTowerKeys_createClass(QuestTowerKeys, [{ key: "getTokensAvailable", value:



    function getTokensAvailable() {
      if ((0,external_kolmafia_.pullsRemaining)() == -1 && !this.refreshedStorage) {
        (0,external_kolmafia_.cliExecute)("refresh storage");
        this.refreshedStorage = true;
      }

      return (
        (0,external_kolmafia_.itemAmount)(this.token) + (
        (0,external_kolmafia_.pullsRemaining)() == -1 ? (0,external_kolmafia_.storageAmount)(this.token) : 0));

    } }, { key: "isReadyToRedeemTokens", value:

    function isReadyToRedeemTokens() {
      var keysAvailable = this.keys.filter(
      function (k) {return (0,external_kolmafia_.availableAmount)(k) > 0;}).
      length;

      if (keysAvailable >= 3) {
        return false;
      }

      return keysAvailable + this.getTokensAvailable() >= 3;
    } }, { key: "redeemKeys", value:

    function redeemKeys() {
      var keys = this.keys.filter(function (k) {return (0,external_kolmafia_.availableAmount)(k) == 0;});

      return {
        location: null,
        run: function run() {var _iterator = QuestTowerKeys_createForOfIteratorHelper(
            keys),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var k = _step.value;
              (0,external_kolmafia_.retrieveItem)(k);
            }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
        }
      };
    } }, { key: "getId", value:

    function getId() {
      return "Council / Tower / KeyDoor";
    } }, { key: "getChildren", value:

    function getChildren() {
      return this.children;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "level", value:

    function level() {
      return 13;
    } }, { key: "getNotDone", value:

    function getNotDone() {
      var used = this.getKeysUsed();

      return this.keyItems.filter(function (k) {return !used.includes(k[1]);});
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL13Final");

      if (status < 5) {
        return QuestStatus.NOT_READY;
      }

      if (status > 5) {
        return QuestStatus.COMPLETED;
      }

      if (this.isReadyToRedeemTokens()) {
        return QuestStatus.READY;
      }

      if (this.getNotDone().find(function (_ref) {var _ref2 = QuestTowerKeys_slicedToArray(_ref, 2),item = _ref2[1];return (0,external_kolmafia_.itemAmount)(item) == 0;}) != null) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this2 = this;
      if (this.isReadyToRedeemTokens()) {
        return this.redeemKeys();
      }

      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          var notDone = _this2.getNotDone();var _iterator2 = QuestTowerKeys_createForOfIteratorHelper(

            notDone),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var s = _step2.value;
              if ((0,external_kolmafia_.availableAmount)(s[1]) == 0) {
                continue;
              }

              (0,external_kolmafia_.visitUrl)("place.php?whichplace=nstower_door&action=" + s[0]);
            }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}

          (0,external_kolmafia_.visitUrl)("place.php?whichplace=nstower_door&action=ns_doorknob");
        }
      };
    } }]);return QuestTowerKeys;}(QuestKeyStuffAbstract);
;// CONCATENATED MODULE: ./src/quests/council/tower/stages/QuestTowerContestants.ts
function QuestTowerContestants_typeof(obj) {"@babel/helpers - typeof";return QuestTowerContestants_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestTowerContestants_typeof(obj);}function QuestTowerContestants_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestTowerContestants_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestTowerContestants_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestTowerContestants_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestTowerContestants_arrayLikeToArray(o, minLen);}function QuestTowerContestants_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestTowerContestants_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestTowerContestants_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestTowerContestants_toPropertyKey(descriptor.key), descriptor);}}function QuestTowerContestants_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestTowerContestants_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestTowerContestants_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestTowerContestants_toPropertyKey(arg) {var key = QuestTowerContestants_toPrimitive(arg, "string");return QuestTowerContestants_typeof(key) === "symbol" ? key : String(key);}function QuestTowerContestants_toPrimitive(input, hint) {if (QuestTowerContestants_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestTowerContestants_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var QuestTowerContestants = /*#__PURE__*/function () {function QuestTowerContestants() {QuestTowerContestants_classCallCheck(this, QuestTowerContestants);}QuestTowerContestants_createClass(QuestTowerContestants, [{ key: "getId", value:
    function getId() {
      return "Council / Tower / Contests";
    } }, { key: "level", value:

    function level() {
      return 13;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL13Final");

      if (status < 0) {
        return QuestStatus.NOT_READY;
      }

      if (status > 3) {
        return QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {
      var status = getQuestStatus("questL13Final");

      if (status == 0) {
        return this.learnAndSetMyPlace();
      }

      if (status == 1) {
        return this.fightContests();
      }

      return this.claimPrize();
    } }, { key: "claimPrize", value:

    function claimPrize() {
      return {
        location: null,
        run: function run() {
          var props = new Properties_PropertyManager();

          try {
            props.setChoice(1020, 1);
            props.setChoice(1021, 1);
            props.setChoice(1022, 1);
            props.setChoice(1003, 4);

            (0,external_kolmafia_.visitUrl)("place.php?whichplace=nstower&action=ns_01_contestbooth");
            (0,external_kolmafia_.visitUrl)("choice.php?pwd=&whichchoice=1003&option=4", true);
            (0,external_kolmafia_.visitUrl)("place.php?whichplace=nstower&action=ns_02_coronation");
            (0,external_kolmafia_.visitUrl)("choice.php?pwd=&whichchoice=1020&option=1", true);
            (0,external_kolmafia_.visitUrl)("choice.php?pwd=&whichchoice=1021&option=1", true);
            (0,external_kolmafia_.visitUrl)("choice.php?pwd=&whichchoice=1022&option=1", true);
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "fightContests", value:

    function fightContests() {
      // place.php?whichplace=nstower&action=ns_01_crowd1
      var match = (0,external_kolmafia_.visitUrl)("place.php?whichplace=nstower").match(
      /(place.php\?whichplace=nstower&action=ns_01_crowd\d)/);


      return {
        location: null,
        run: function run() {
          if (match == null) {
            throw "Unable to parse the contestants which we shall be fighting.";
          }

          greyAdv(match[1]);
        }
      };
    } }, { key: "learnAndSetMyPlace", value:

    function learnAndSetMyPlace() {var _this = this;
      return {
        location: null,
        run: function run() {var _iterator = QuestTowerContestants_createForOfIteratorHelper(
            _this.getNeededQuests()),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var quest = _step.value;
              quest.call(_this);
            }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

          (0,external_kolmafia_.visitUrl)("place.php?whichplace=nstower");
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      if ((0,external_kolmafia_.getProperty)("questL13Final") != "step1") {
        return [];
      }

      var locs = [];

      var page = (0,external_kolmafia_.visitUrl)("place.php?whichplace=nstower");

      if (page.includes("ns_01_crowd1")) {
        locs.push(external_kolmafia_.Location.get("Fastest Adventurer Contest"));
      }

      if (page.includes("ns_01_crowd2")) {
        switch ((0,external_kolmafia_.getProperty)("nsChallenge1")) {
          case "Mysticality":
            locs.push(external_kolmafia_.Location.get("Smartest Adventurer Contest"));
            break;
          case "Moxie":
            locs.push(external_kolmafia_.Location.get("Smoothest Adventurer Contest"));
            break;
          case "Muscle":
            locs.push(external_kolmafia_.Location.get("Strongest Adventurer Contest"));
            break;}

      }

      if (page.includes("ns_01_crowd3")) {
        switch ((0,external_kolmafia_.getProperty)("nsChallenge2")) {
          case "cold":
            locs.push(external_kolmafia_.Location.get("Coldest Adventurer Contest"));
            break;
          case "hot":
            locs.push(external_kolmafia_.Location.get("Hottest Adventurer Contest"));
            break;
          case "sleaze":
            locs.push(external_kolmafia_.Location.get("Sleaziest Adventurer Contest"));
            break;
          case "spooky":
            locs.push(external_kolmafia_.Location.get("Spookiest Adventurer Contest"));
            break;
          case "stench":
            locs.push(external_kolmafia_.Location.get("Stinkiest Adventurer Contest"));
            break;}

      }

      return locs;
    } }, { key: "turnInQuest", value:

    function turnInQuest(questNo) {
      (0,external_kolmafia_.visitUrl)("place.php?whichplace=nstower&action=ns_01_contestbooth");
      (0,external_kolmafia_.visitUrl)("choice.php?pwd=&whichchoice=1003&option=" + questNo, true);
      (0,external_kolmafia_.visitUrl)("main.php");
    } }, { key: "getNeededQuests", value:

    function getNeededQuests() {
      if (
      (0,external_kolmafia_.getProperty)("nsChallenge1") == "none" ||
      (0,external_kolmafia_.getProperty)("nsChallenge2") == "none")
      {
        (0,external_kolmafia_.visitUrl)("place.php?whichplace=nstower&action=ns_01_contestbooth");
      }

      var quests = [];

      if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("nsContestants1")) == -1) {
        quests.push(this.doQuest1);
      }

      if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("nsContestants2")) == -1) {
        quests.push(this.doQuest2);
      }

      if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("nsContestants3")) == -1) {
        quests.push(this.doQuest3);
      }

      return quests;
    } }, { key: "doQuest1", value:

    function doQuest1() {
      (0,external_kolmafia_.maximize)(
      "init +switch left-hand man +switch Oily woim +switch Xiblaxian Holo-Companion -tie",
      false);

      this.turnInQuest(1);
    } }, { key: "doQuest2", value:

    function doQuest2() {
      (0,external_kolmafia_.maximize)(
      (0,external_kolmafia_.getProperty)("nsChallenge1") + " +switch left-hand man -tie",
      false);

      this.turnInQuest(2);
    } }, { key: "doQuest3", value:

    function doQuest3() {
      var element = (0,external_kolmafia_.getProperty)("nsChallenge2");

      (0,external_kolmafia_.maximize)(
      element + " dmg +" + element + " spell dmg +switch left-hand man -tie",
      false);

      this.turnInQuest(3);
    } }]);return QuestTowerContestants;}();
;// CONCATENATED MODULE: ./src/quests/council/tower/stages/QuestTowerMaze.ts
function QuestTowerMaze_typeof(obj) {"@babel/helpers - typeof";return QuestTowerMaze_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestTowerMaze_typeof(obj);}function QuestTowerMaze_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestTowerMaze_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestTowerMaze_toPropertyKey(descriptor.key), descriptor);}}function QuestTowerMaze_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestTowerMaze_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestTowerMaze_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestTowerMaze_toPropertyKey(arg) {var key = QuestTowerMaze_toPrimitive(arg, "string");return QuestTowerMaze_typeof(key) === "symbol" ? key : String(key);}function QuestTowerMaze_toPrimitive(input, hint) {if (QuestTowerMaze_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestTowerMaze_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}




var QuestTowerMaze = /*#__PURE__*/function () {function QuestTowerMaze() {QuestTowerMaze_classCallCheck(this, QuestTowerMaze);}QuestTowerMaze_createClass(QuestTowerMaze, [{ key: "getId", value:
    function getId() {
      return "Council / Tower / Maze";
    } }, { key: "level", value:

    function level() {
      return 13;
    } }, { key: "status", value:

    function status() {
      if (getQuestStatus("questL13Final") < 4) {
        return QuestStatus.NOT_READY;
      }

      if (getQuestStatus("questL13Final") > 4) {
        return QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {
      var outfit = new GreyOutfit("+hot res +spooky res +stench res -tie");

      return {
        location: null,
        outfit: outfit,
        run: function run() {
          (0,external_kolmafia_.visitUrl)("place.php?whichplace=nstower&action=ns_03_hedgemaze");
          (0,external_kolmafia_.runChoice)(2);
          (0,external_kolmafia_.runChoice)(2);
          (0,external_kolmafia_.runChoice)(2);
          (0,external_kolmafia_.runChoice)(1);
          (0,external_kolmafia_.visitUrl)("place.php?whichplace=nstower_door");
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestTowerMaze;}();
;// CONCATENATED MODULE: ./src/quests/council/tower/stages/QuestTowerWallMeat.ts
function QuestTowerWallMeat_typeof(obj) {"@babel/helpers - typeof";return QuestTowerWallMeat_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestTowerWallMeat_typeof(obj);}function QuestTowerWallMeat_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestTowerWallMeat_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestTowerWallMeat_toPropertyKey(descriptor.key), descriptor);}}function QuestTowerWallMeat_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestTowerWallMeat_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestTowerWallMeat_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestTowerWallMeat_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestTowerWallMeat_setPrototypeOf(subClass, superClass);}function QuestTowerWallMeat_setPrototypeOf(o, p) {QuestTowerWallMeat_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestTowerWallMeat_setPrototypeOf(o, p);}function QuestTowerWallMeat_createSuper(Derived) {var hasNativeReflectConstruct = QuestTowerWallMeat_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestTowerWallMeat_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestTowerWallMeat_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestTowerWallMeat_possibleConstructorReturn(this, result);};}function QuestTowerWallMeat_possibleConstructorReturn(self, call) {if (call && (QuestTowerWallMeat_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestTowerWallMeat_assertThisInitialized(self);}function QuestTowerWallMeat_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestTowerWallMeat_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestTowerWallMeat_getPrototypeOf(o) {QuestTowerWallMeat_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestTowerWallMeat_getPrototypeOf(o);}function QuestTowerWallMeat_defineProperty(obj, key, value) {key = QuestTowerWallMeat_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestTowerWallMeat_toPropertyKey(arg) {var key = QuestTowerWallMeat_toPrimitive(arg, "string");return QuestTowerWallMeat_typeof(key) === "symbol" ? key : String(key);}function QuestTowerWallMeat_toPrimitive(input, hint) {if (QuestTowerWallMeat_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestTowerWallMeat_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}









var QuestTowerWallMeat = /*#__PURE__*/function (_TaskInfo) {QuestTowerWallMeat_inherits(QuestTowerWallMeat, _TaskInfo);var _super = QuestTowerWallMeat_createSuper(QuestTowerWallMeat);function QuestTowerWallMeat() {var _this;QuestTowerWallMeat_classCallCheck(this, QuestTowerWallMeat);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestTowerWallMeat_defineProperty(QuestTowerWallMeat_assertThisInitialized(_this), "paths", void 0);return _this;}QuestTowerWallMeat_createClass(QuestTowerWallMeat, [{ key: "getId", value:


    function getId() {
      return "Council / Tower / WallOfMeat";
    } }, { key: "createPaths", value:

    function createPaths(assumeUnstarted) {
      this.paths = [
      new PossiblePath(0).addMeat(2000),
      new PossiblePath(0).add(ResourceCategory.HOT_TUB)];

    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "level", value:

    function level() {
      return 13;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL13Final");

      if (status < 7) {
        return QuestStatus.NOT_READY;
      }

      if (status > 7) {
        return QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }, { key: "hasDrunkMeat", value:

    function hasDrunkMeat() {
      return (0,external_kolmafia_.getProperty)("_roboDrinks").includes("drive-by shooting");
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      return {
        outfit: GreyOutfit.IGNORE_OUTFIT,
        location: null,
        run: function run() {
          var robo = external_kolmafia_.Familiar.get("Grey Goose");

          if ((0,external_kolmafia_.haveFamiliar)(robo) && _this2.hasDrunkMeat()) {
            (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Robortender"));
          } else if ((0,external_kolmafia_.haveFamiliar)(external_kolmafia_.Familiar.get("Hobo Monkey"))) {
            (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Hobo Monkey"));
          }

          (0,external_kolmafia_.cliExecute)("maximize +5 meat +0.03 moxie +100 hp 200 min 500 max");

          if ((0,external_kolmafia_.myMaxhp)() < 200) {
            throw "Max HP too low! Run +meat and kill the wall of meat yourself?";
          }

          if ((0,external_kolmafia_.myHp)() < (0,external_kolmafia_.myMaxhp)()) {
            if (path.canUse(ResourceCategory.HOT_TUB)) {
              (0,external_kolmafia_.cliExecute)("hottub");
            } else {
              restoreHPTo(Math.min((0,external_kolmafia_.myMaxhp)(), 600));
            }
          }

          if ((0,external_kolmafia_.myHp)() < 200) {
            throw "HP too low";
          }

          greyAdv(
          "place.php?whichplace=nstower&action=ns_06_monster2",
          null,
          new AdventureSettings().setFinishingBlowMacro(
          Macro.trySkillRepeat(external_kolmafia_.Skill.get("Infinite Loop"))));


        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestTowerWallMeat;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/tower/stages/QuestTowerWallBones.ts
function QuestTowerWallBones_typeof(obj) {"@babel/helpers - typeof";return QuestTowerWallBones_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestTowerWallBones_typeof(obj);}function QuestTowerWallBones_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestTowerWallBones_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestTowerWallBones_toPropertyKey(descriptor.key), descriptor);}}function QuestTowerWallBones_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestTowerWallBones_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestTowerWallBones_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestTowerWallBones_defineProperty(obj, key, value) {key = QuestTowerWallBones_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestTowerWallBones_toPropertyKey(arg) {var key = QuestTowerWallBones_toPrimitive(arg, "string");return QuestTowerWallBones_typeof(key) === "symbol" ? key : String(key);}function QuestTowerWallBones_toPrimitive(input, hint) {if (QuestTowerWallBones_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestTowerWallBones_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}








var QuestTowerWallBones = /*#__PURE__*/function () {function QuestTowerWallBones() {QuestTowerWallBones_classCallCheck(this, QuestTowerWallBones);QuestTowerWallBones_defineProperty(this, "knife",
    external_kolmafia_.Item.get("Electric Boning Knife"));QuestTowerWallBones_defineProperty(this, "killer",
    new QuestTowerKillBones());QuestTowerWallBones_defineProperty(this, "toAbsorb", void 0);QuestTowerWallBones_defineProperty(this, "groundFloor",

    external_kolmafia_.Location.get(
    "The Castle in the Clouds in the Sky (Ground Floor)"));}QuestTowerWallBones_createClass(QuestTowerWallBones, [{ key: "getId", value:


    function getId() {
      return "Council / Tower / WallOfBones";
    } }, { key: "level", value:

    function level() {
      return 13;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL13Final");

      if (status < 8) {
        return QuestStatus.NOT_READY;
      }

      if (status > 8) {
        return QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      if ((0,external_kolmafia_.availableAmount)(this.knife) == 0) {
        if (this.killer.isPossible()) {
          return this.killer.run();
        } else {
          return this.runKnife();
        }
      }

      return {
        location: null,
        run: function run() {
          var macro = new Macro().tryItem(_this.knife);

          greyAdv(
          "place.php?whichplace=nstower&action=ns_07_monster3",
          null,
          new AdventureSettings().setStartOfFightMacro(macro));

        }
      };
    } }, { key: "runKnife", value:

    function runKnife() {var _this2 = this;
      var outfit = new GreyOutfit().setNoCombat().setNoCombat();
      outfit.addDelayer(DelayCriteria().withFreeFights(null));

      return {
        location: this.groundFloor,
        outfit: outfit,
        run: function run() {
          var props = new Properties_PropertyManager();

          if (DelayBurners.isTryingForDupeableGoblin()) {
            (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Grey Goose"));
          }

          try {
            props.setChoice(672, 1);
            props.setChoice(673, 1);
            props.setChoice(674, 1);
            props.setChoice(1026, 2);

            greyAdv(_this2.groundFloor, outfit);
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestTowerWallBones;}();


var QuestTowerKillBones = /*#__PURE__*/function () {function QuestTowerKillBones() {QuestTowerWallBones_classCallCheck(this, QuestTowerKillBones);QuestTowerWallBones_defineProperty(this, "damageMultiplier",
    50.5);QuestTowerWallBones_defineProperty(this, "health",
    20000);QuestTowerWallBones_defineProperty(this, "drunkBell",
    external_kolmafia_.Item.get("Drunkula's bell"));QuestTowerWallBones_defineProperty(this, "rocket",
    external_kolmafia_.Item.get("Great Wolf's rocket launcher"));QuestTowerWallBones_defineProperty(this, "property",
    "_triedBossKillingBones");QuestTowerWallBones_defineProperty(this, "possible", void 0);}QuestTowerWallBones_createClass(QuestTowerKillBones, [{ key: "isRocketPossible", value:


    function isRocketPossible() {
      if ((0,external_kolmafia_.availableAmount)(this.rocket) == 0 && (0,external_kolmafia_.storageAmount)(this.rocket) == 0) {
        return false;
      }

      if (
      (0,external_kolmafia_.myPrimestat)() != external_kolmafia_.Stat.get("Moxie") &&
      !(0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("Cock of the Walk")) &&
      (0,external_kolmafia_.mallPrice)(external_kolmafia_.Item.get("Connery's Elixir of Audacity")) < 5000)
      {
        (0,external_kolmafia_.use)(external_kolmafia_.Item.get("Connery's Elixir of Audacity"));
      }

      (0,external_kolmafia_.maximize)("moxie +equip " + this.rocket.name, true);

      var moxie = (0,external_kolmafia_.numericModifier)("Generated:_spec", "Buffed Moxie");
      var damage = this.damageMultiplier * (moxie * 0.4);

      (0,external_kolmafia_.print)(
      "Using rocket, we predict " +
      Math.round(damage) +
      " / " +
      this.health +
      " damage (Worst scenario)",
      "blue");


      return damage > this.health;
    } }, { key: "isBellPossible", value:

    function isBellPossible() {
      if (
      (0,external_kolmafia_.availableAmount)(this.drunkBell) == 0 &&
      (0,external_kolmafia_.storageAmount)(this.drunkBell) == 0)
      {
        return false;
      }

      if (
      (0,external_kolmafia_.myPrimestat)() != external_kolmafia_.Stat.get("Mysticality") &&
      !(0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("On the Shoulders of Giants")) &&
      (0,external_kolmafia_.mallPrice)(external_kolmafia_.Item.get("Hawking's Elixir of Brilliance")) < 5000)
      {
        (0,external_kolmafia_.use)(external_kolmafia_.Item.get("Hawking's Elixir of Brilliance"));
      }

      (0,external_kolmafia_.maximize)("mys", true);

      var mys = (0,external_kolmafia_.numericModifier)("Generated:_spec", "Buffed Mysticality");
      var damage = this.damageMultiplier * (mys * 0.15);

      (0,external_kolmafia_.print)(
      "Using " +
      this.drunkBell.name +
      ", we predict " +
      Math.round(damage) +
      " / " +
      this.health +
      " damage (Worst scenario)",
      "blue");


      return damage > this.health;
    } }, { key: "isPossible", value:

    function isPossible() {
      if ((0,external_kolmafia_.pullsRemaining)() != -1 || (0,external_kolmafia_.getProperty)(this.property) == "true") {
        return false;
      }

      if (this.possible != null) {
        return this.possible;
      }

      return this.possible = this.isRocketPossible() || this.isBellPossible();
    } }, { key: "run", value:

    function run() {var _this3 = this;
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          var macro;
          (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.none);

          if (_this3.isRocketPossible()) {
            (0,external_kolmafia_.maximize)("moxie +equip " + _this3.rocket.name, false);

            if ((0,external_kolmafia_.equippedAmount)(_this3.rocket) == 0) {
              throw "We don't have the " + _this3.rocket.name + " on hand?";
            }

            macro = Macro.skill("Fire Rocket");
          } else {
            if ((0,external_kolmafia_.itemAmount)(_this3.drunkBell) == 0) {
              (0,external_kolmafia_.retrieveItem)(_this3.drunkBell);
            }

            if ((0,external_kolmafia_.itemAmount)(_this3.drunkBell) == 0) {
              throw "We don't have the " + _this3.drunkBell.name + " on hand?";
            }

            (0,external_kolmafia_.maximize)("mys", false);

            macro = Macro.item(_this3.drunkBell);
          }

          (0,external_kolmafia_.visitUrl)("place.php?whichplace=nstower&action=ns_07_monster3");

          if ((0,external_kolmafia_.currentRound)() == 0) {
            throw "Failed to start the bones attack";
          }

          (0,external_kolmafia_.setProperty)(_this3.property, "true");

          macro.submit();

          if ((0,external_kolmafia_.currentRound)() != 0) {
            throw "Failed to kill the wall of bones in a single hit.";
          }
        }
      };
    } }]);return QuestTowerKillBones;}();
;// CONCATENATED MODULE: ./src/quests/council/tower/stages/QuestTowerShadow.ts
function QuestTowerShadow_typeof(obj) {"@babel/helpers - typeof";return QuestTowerShadow_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestTowerShadow_typeof(obj);}function QuestTowerShadow_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestTowerShadow_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestTowerShadow_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestTowerShadow_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestTowerShadow_arrayLikeToArray(o, minLen);}function QuestTowerShadow_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestTowerShadow_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestTowerShadow_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestTowerShadow_toPropertyKey(descriptor.key), descriptor);}}function QuestTowerShadow_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestTowerShadow_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestTowerShadow_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestTowerShadow_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestTowerShadow_setPrototypeOf(subClass, superClass);}function QuestTowerShadow_setPrototypeOf(o, p) {QuestTowerShadow_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestTowerShadow_setPrototypeOf(o, p);}function QuestTowerShadow_createSuper(Derived) {var hasNativeReflectConstruct = QuestTowerShadow_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestTowerShadow_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestTowerShadow_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestTowerShadow_possibleConstructorReturn(this, result);};}function QuestTowerShadow_possibleConstructorReturn(self, call) {if (call && (QuestTowerShadow_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestTowerShadow_assertThisInitialized(self);}function QuestTowerShadow_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestTowerShadow_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestTowerShadow_getPrototypeOf(o) {QuestTowerShadow_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestTowerShadow_getPrototypeOf(o);}function QuestTowerShadow_defineProperty(obj, key, value) {key = QuestTowerShadow_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestTowerShadow_toPropertyKey(arg) {var key = QuestTowerShadow_toPrimitive(arg, "string");return QuestTowerShadow_typeof(key) === "symbol" ? key : String(key);}function QuestTowerShadow_toPrimitive(input, hint) {if (QuestTowerShadow_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestTowerShadow_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}









var QuestTowerShadow = /*#__PURE__*/function (_TaskInfo) {QuestTowerShadow_inherits(QuestTowerShadow, _TaskInfo);var _super = QuestTowerShadow_createSuper(QuestTowerShadow);function QuestTowerShadow() {var _this;QuestTowerShadow_classCallCheck(this, QuestTowerShadow);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestTowerShadow_defineProperty(QuestTowerShadow_assertThisInitialized(_this), "badge",
    external_kolmafia_.Item.get("Attorney's badge"));QuestTowerShadow_defineProperty(QuestTowerShadow_assertThisInitialized(_this), "potato",
    external_kolmafia_.Familiar.get("Levitating Potato"));QuestTowerShadow_defineProperty(QuestTowerShadow_assertThisInitialized(_this), "guaze",
    external_kolmafia_.Item.get("Gauze garter"));QuestTowerShadow_defineProperty(QuestTowerShadow_assertThisInitialized(_this), "cape",
    external_kolmafia_.Item.get("Unwrapped knock-off retro superhero cape"));QuestTowerShadow_defineProperty(QuestTowerShadow_assertThisInitialized(_this), "overclocking",
    external_kolmafia_.Skill.get("Overclocking"));QuestTowerShadow_defineProperty(QuestTowerShadow_assertThisInitialized(_this), "paths", void 0);return _this;}QuestTowerShadow_createClass(QuestTowerShadow, [{ key: "createPaths", value:


    function createPaths(assumeUnstarted) {
      this.paths = [
      new PossiblePath(0).addMeat(1000),
      new PossiblePath(0).add(ResourceCategory.HOT_TUB)];

    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "getId", value:

    function getId() {
      return "Council / Tower / Shadow";
    } }, { key: "level", value:

    function level() {
      return 13;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL13Final");

      if (status < 10) {
        return QuestStatus.NOT_READY;
      }

      if (status > 10) {
        return QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }, { key: "getBestEquips", value:

    function getBestEquips(modifier) {
      var equips = [];
      var none = (0,external_kolmafia_.toSlot)("none");
      var weapon = external_kolmafia_.Slot.get("weapon");var _iterator = QuestTowerShadow_createForOfIteratorHelper(

        external_kolmafia_.Item.all()),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var i = _step.value;
          if ((0,external_kolmafia_.availableAmount)(i) == 0) {
            continue;
          }

          var slot = (0,external_kolmafia_.toSlot)(i);

          if (slot == none || !(0,external_kolmafia_.canEquip)(i)) {
            continue;
          }

          if (slot == weapon && (0,external_kolmafia_.weaponHands)(i) > 1) {
            continue;
          }

          var mod = (0,external_kolmafia_.numericModifier)(i, modifier);

          if (mod <= 0) {
            continue;
          }

          equips.push([slot, i, mod]);
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

      equips.sort(function (e1, e2) {return e2[2] - e1[2];});
      var items = [];
      var toReturn = [];var _iterator2 = QuestTowerShadow_createForOfIteratorHelper(

        [
        "Hat",
        "Weapon",
        "Offhand",
        "Back",
        "Pants",
        "Acc1",
        "Acc2",
        "Acc3"].
        map(function (s) {return external_kolmafia_.Slot.get(s);})),_step2;try {var _loop = function _loop() {var slot = _step2.value;
          var lookFor = slot;

          if (slot == external_kolmafia_.Slot.get("acc2") || slot == external_kolmafia_.Slot.get("acc3")) {
            lookFor = external_kolmafia_.Slot.get("acc1");
          }

          var item = equips.reduce(function (p, i) {
            if (i[0] != lookFor || items.includes(i[1])) {
              return p;
            }

            if (p != null && p[2] > i[2]) {
              return p;
            }

            return i;
          }, null);

          if (item != null) {
            items.push(item[1]);
            toReturn.push([slot, item[1]]);
          }
        };for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {_loop();}} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}

      return toReturn;
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      var map = new Map();

      if ((0,external_kolmafia_.availableAmount)(this.badge) > 0) {
        map.set(external_kolmafia_.Slot.get("acc3"), this.badge);
      }

      if ((0,external_kolmafia_.availableAmount)(this.cape) > 0) {
        map.set(external_kolmafia_.Slot.get("back"), this.cape);
      }

      var outfit = new GreyOutfit();
      outfit.hpWeight = 0;
      outfit.addWeight("init", 500, null, 151);
      outfit.addWeight("hp", 100, null, 500);

      return {
        familiar: this.potato,
        outfit: outfit,
        location: null,
        run: function run() {
          if ((0,external_kolmafia_.equippedAmount)(_this2.cape) > 0) {
            (0,external_kolmafia_.cliExecute)("retrocape heck hold"); // Make sure we stun the shadow
          }

          if ((0,external_kolmafia_.itemAmount)(_this2.guaze) < 6) {
            if ((0,external_kolmafia_.pullsRemaining)() == -1 && (0,external_kolmafia_.storageAmount)(_this2.guaze) > 6) {
              (0,external_kolmafia_.cliExecute)(
              "pull " + (0,external_kolmafia_.storageAmount)(_this2.guaze) + " " + _this2.guaze.name);

            } else {
              throw (
                "We don't have enough " +
                _this2.guaze.name +
                " to take on the shadow!");

            }
          }

          if ((0,external_kolmafia_.myHp)() < (0,external_kolmafia_.myMaxhp)()) {
            if (path.canUse(ResourceCategory.HOT_TUB)) {
              (0,external_kolmafia_.cliExecute)("hottub");
              path.addUsed(ResourceCategory.HOT_TUB);
            } else {
              restoreHPTo((0,external_kolmafia_.myMaxhp)());
            }
          }

          if ((0,external_kolmafia_.myHp)() < (0,external_kolmafia_.myMaxhp)()) {
            throw "Expected full health";
          }

          var macro = Macro.item(_this2.guaze).repeat();

          greyAdv(
          "place.php?whichplace=nstower&action=ns_09_monster5",
          outfit,
          new AdventureSettings().setStartOfFightMacro(macro));

        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestTowerShadow;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/tower/stages/QuestTowerMirror.ts
function QuestTowerMirror_typeof(obj) {"@babel/helpers - typeof";return QuestTowerMirror_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestTowerMirror_typeof(obj);}function QuestTowerMirror_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestTowerMirror_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestTowerMirror_slicedToArray(arr, i) {return QuestTowerMirror_arrayWithHoles(arr) || QuestTowerMirror_iterableToArrayLimit(arr, i) || QuestTowerMirror_unsupportedIterableToArray(arr, i) || QuestTowerMirror_nonIterableRest();}function QuestTowerMirror_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function QuestTowerMirror_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestTowerMirror_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestTowerMirror_arrayLikeToArray(o, minLen);}function QuestTowerMirror_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestTowerMirror_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function QuestTowerMirror_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function QuestTowerMirror_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestTowerMirror_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestTowerMirror_toPropertyKey(descriptor.key), descriptor);}}function QuestTowerMirror_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestTowerMirror_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestTowerMirror_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestTowerMirror_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestTowerMirror_setPrototypeOf(subClass, superClass);}function QuestTowerMirror_setPrototypeOf(o, p) {QuestTowerMirror_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestTowerMirror_setPrototypeOf(o, p);}function QuestTowerMirror_createSuper(Derived) {var hasNativeReflectConstruct = QuestTowerMirror_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestTowerMirror_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestTowerMirror_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestTowerMirror_possibleConstructorReturn(this, result);};}function QuestTowerMirror_possibleConstructorReturn(self, call) {if (call && (QuestTowerMirror_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestTowerMirror_assertThisInitialized(self);}function QuestTowerMirror_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestTowerMirror_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestTowerMirror_getPrototypeOf(o) {QuestTowerMirror_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestTowerMirror_getPrototypeOf(o);}function QuestTowerMirror_defineProperty(obj, key, value) {key = QuestTowerMirror_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestTowerMirror_toPropertyKey(arg) {var key = QuestTowerMirror_toPrimitive(arg, "string");return QuestTowerMirror_typeof(key) === "symbol" ? key : String(key);}function QuestTowerMirror_toPrimitive(input, hint) {if (QuestTowerMirror_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestTowerMirror_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}









var QuestTowerMirror = /*#__PURE__*/function (_TaskInfo) {QuestTowerMirror_inherits(QuestTowerMirror, _TaskInfo);var _super = QuestTowerMirror_createSuper(QuestTowerMirror);function QuestTowerMirror() {var _this;QuestTowerMirror_classCallCheck(this, QuestTowerMirror);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestTowerMirror_defineProperty(QuestTowerMirror_assertThisInitialized(_this), "wand",
    external_kolmafia_.Item.get(" Wand of Nagamar"));QuestTowerMirror_defineProperty(QuestTowerMirror_assertThisInitialized(_this), "lW",
    external_kolmafia_.Item.get("ruby W"));QuestTowerMirror_defineProperty(QuestTowerMirror_assertThisInitialized(_this), "lA",
    external_kolmafia_.Item.get("metallic A"));QuestTowerMirror_defineProperty(QuestTowerMirror_assertThisInitialized(_this), "lN",
    external_kolmafia_.Item.get("lowercase N"));QuestTowerMirror_defineProperty(QuestTowerMirror_assertThisInitialized(_this), "lD",
    external_kolmafia_.Item.get("heavy D"));QuestTowerMirror_defineProperty(QuestTowerMirror_assertThisInitialized(_this), "wa",
    external_kolmafia_.Item.get("WA"));QuestTowerMirror_defineProperty(QuestTowerMirror_assertThisInitialized(_this), "nd",
    external_kolmafia_.Item.get("ND"));QuestTowerMirror_defineProperty(QuestTowerMirror_assertThisInitialized(_this), "locations",
    [
    ["Ruby W", "W imp", "Pandamonium Slums"],
    ["Metallic A", "MagiMechTech MechaMech", "The Penultimate Fantasy Airship"],
    ["lowercase N", "XXX pr0n", "The Valley of Rof L'm Fao"],
    [
    "heavy D",
    "Alphabet Giant",
    "The Castle in the Clouds in the Sky (Basement)"]].

    map(function (s) {return [external_kolmafia_.Item.get(s[0]), external_kolmafia_.Monster.get(s[1]), external_kolmafia_.Location.get(s[2])];}));QuestTowerMirror_defineProperty(QuestTowerMirror_assertThisInitialized(_this), "clover",
    external_kolmafia_.Item.get("11-leaf Clover"));QuestTowerMirror_defineProperty(QuestTowerMirror_assertThisInitialized(_this), "paths", void 0);return _this;}QuestTowerMirror_createClass(QuestTowerMirror, [{ key: "createPaths", value:


    function createPaths() {
      this.paths = [new PossiblePath(1).add(ResourceCategory.CLOVER)];
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "getId", value:

    function getId() {
      return "Council / Tower / Mirror";
    } }, { key: "level", value:

    function level() {
      return 13;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL13Final");

      if (status < 9) {
        return QuestStatus.NOT_READY;
      }

      if (status > 9) {
        return QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }, { key: "tryClover", value:

    function tryClover() {var _this2 = this;
      return {
        location: null,
        run: function run() {
          (0,external_kolmafia_.use)(_this2.clover);
          greyAdv(external_kolmafia_.Location.get("The Castle in the Clouds in the Sky (Basement)"));
        }
      };
    } }, { key: "run", value:

    function run() {
      if ((0,external_kolmafia_.availableAmount)(this.wand) == 0) {
        return this.createWand();
      }

      // Equip outfit early to try save some hp
      var outfit = GreyOutfit.IGNORE_OUTFIT;

      return {
        location: null,
        outfit: outfit,
        run: function run() {
          var props = new Properties_PropertyManager();
          props.setChoice(1015, 2); // Break mirror

          try {
            greyAdv("place.php?whichplace=nstower&action=ns_08_monster4", outfit);
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "createWand", value:

    function createWand() {var _this3 = this;
      var toGrab = this.locations.filter(function (_ref) {var _ref2 = QuestTowerMirror_slicedToArray(_ref, 1),i = _ref2[0];return (0,external_kolmafia_.availableAmount)(i) == 0;});

      if (
      toGrab.length > 0 && (
      GreySettings_GreySettings.isHardcoreMode() || (0,external_kolmafia_.pullsRemaining)() != -1))
      {var _iterator = QuestTowerMirror_createForOfIteratorHelper(
          toGrab),_step;try {var _loop = function _loop() {var _step$value = QuestTowerMirror_slicedToArray(_step.value, 3),monster = _step$value[1],loc = _step$value[2];
            if ((0,external_kolmafia_.availableAmount)(_this3.clover) > 0) {return { v:
                _this3.tryClover() };
            }

            var outfit = new GreyOutfit().setItemDrops();return { v:

              {
                location: loc,
                outfit: outfit,
                run: function run() {
                  var settings = new AdventureSettings();
                  settings.addNoBanish(monster);

                  greyAdv(loc, outfit, settings);
                }
              } };
          };for (_iterator.s(); !(_step = _iterator.n()).done;) {var _ret = _loop();if (QuestTowerMirror_typeof(_ret) === "object") return _ret.v;}} catch (err) {_iterator.e(err);} finally {_iterator.f();}
      }

      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          (0,external_kolmafia_.retrieveItem)(_this3.wand);
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestTowerMirror;}(TaskInfo);
;// CONCATENATED MODULE: ./src/typings/TaskManager.ts
function TaskManager_typeof(obj) {"@babel/helpers - typeof";return TaskManager_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, TaskManager_typeof(obj);}function TaskManager_toConsumableArray(arr) {return TaskManager_arrayWithoutHoles(arr) || TaskManager_iterableToArray(arr) || TaskManager_unsupportedIterableToArray(arr) || TaskManager_nonIterableSpread();}function TaskManager_nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function TaskManager_iterableToArray(iter) {if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);}function TaskManager_arrayWithoutHoles(arr) {if (Array.isArray(arr)) return TaskManager_arrayLikeToArray(arr);}function TaskManager_slicedToArray(arr, i) {return TaskManager_arrayWithHoles(arr) || TaskManager_iterableToArrayLimit(arr, i) || TaskManager_unsupportedIterableToArray(arr, i) || TaskManager_nonIterableRest();}function TaskManager_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function TaskManager_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function TaskManager_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function TaskManager_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = TaskManager_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function TaskManager_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return TaskManager_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return TaskManager_arrayLikeToArray(o, minLen);}function TaskManager_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function TaskManager_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function TaskManager_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, TaskManager_toPropertyKey(descriptor.key), descriptor);}}function TaskManager_createClass(Constructor, protoProps, staticProps) {if (protoProps) TaskManager_defineProperties(Constructor.prototype, protoProps);if (staticProps) TaskManager_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function TaskManager_defineProperty(obj, key, value) {key = TaskManager_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function TaskManager_toPropertyKey(arg) {var key = TaskManager_toPrimitive(arg, "string");return TaskManager_typeof(key) === "symbol" ? key : String(key);}function TaskManager_toPrimitive(input, hint) {if (TaskManager_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (TaskManager_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);} // The biggest failures are
// 1. Key sources, we want to get 3 key sources. Some key sources might return more than 1
// 2. Possible paths. Sometimes there's two questlines we can pick
// 3. Crypts, the boat technically means the boat should be in all four crypts or something
// 4. Giving negative adventures, if we provide -50 then we expect to save 50 advs.
// 5. Paths that have so many variables on what could be provided, but basically just initial pulls
// 6. Paths that are a one and done, but the quest can still be done
// 7. Quests that are optional, but entirely depend on the path being picked. We can either provide a dummy path, or something else







var SimmedPath = /*#__PURE__*/function () {








  function SimmedPath(assumeUnused) {var skip = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;TaskManager_classCallCheck(this, SimmedPath);TaskManager_defineProperty(this, "resourcesRemaining", new Map());TaskManager_defineProperty(this, "resourcesUsed", []);TaskManager_defineProperty(this, "thisPath", []);TaskManager_defineProperty(this, "totalCost", void 0);TaskManager_defineProperty(this, "advsSaved", void 0);TaskManager_defineProperty(this, "profitLost", void 0);TaskManager_defineProperty(this, "desiredYR", void 0);
    if (skip) {
      return;
    }var _iterator = TaskManager_createForOfIteratorHelper(

      ResourceTypes_getResources()),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var resource = _step.value;
        this.resourcesRemaining.set(
        resource.resource,
        getResourcesLeft(resource.resource, assumeUnused));

      }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
  }TaskManager_createClass(SimmedPath, [{ key: "isRecalculateNeeded", value:

    function isRecalculateNeeded() {
      var unused = this.thisPath.find(
      function (_ref) {var _ref2 = TaskManager_slicedToArray(_ref, 2),quest = _ref2[0],path = _ref2[1];return (
          path != null &&
          path.resourcesAvailable.length > 0 &&
          quest.status(path) == QuestStatus.COMPLETED);});


      if (unused == null) {
        if (
        this.desiredYR == null ||
        this.desiredYR > 0 && this.desiredYR > getResourcesLeft("Yellow Ray"))
        {
          this.desiredYR = 0;var _iterator2 = TaskManager_createForOfIteratorHelper(

            this.thisPath),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var _step2$value = TaskManager_slicedToArray(_step2.value, 2),path = _step2$value[1];
              if (path == null) {
                continue;
              }var _iterator3 = TaskManager_createForOfIteratorHelper(

                path.resourcesAvailable),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var _resource$resourcesUs;var resource = _step3.value;
                  if (resource.resource != "Yellow Ray") {
                    continue;
                  }

                  this.desiredYR += (_resource$resourcesUs = resource.resourcesUsed) !== null && _resource$resourcesUs !== void 0 ? _resource$resourcesUs : 1;
                }} catch (err) {_iterator3.e(err);} finally {_iterator3.f();}
            }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}

          if (
          this.desiredYR > 0 &&
          this.desiredYR > getResourcesLeft("Yellow Ray"))
          {
            (0,external_kolmafia_.print)("It appears that we do not have enough turns left for every Yellow Ray, wanted ".concat(

            this.desiredYR, " but have ").concat(
            getResourcesLeft("Yellow Ray"), ".. Recalculating.."),
            "red");


            return true;
          }
        }

        return false;
      }

      var resources = [];

      unused[1].resourcesAvailable.forEach(function (r) {
        var res = resources.find(
        function (_ref3) {var _ref4 = TaskManager_slicedToArray(_ref3, 2),r1 = _ref4[0],r2 = _ref4[1];return r1 == r.name && r2 == ResourceCategory[r.type];});


        if (res == null) {
          res = [r.name, ResourceCategory[r.type], 0];
          resources.push(res);
        }

        res[2] += 1;
      });

      (0,external_kolmafia_.print)(
      unused[0].getId() +
      " reports that it has resources left over despite being finished. This is not an error. Resources: " +
      resources.map(
      function (name, type, uses) {return name + " x " + type + " (Uses " + uses + ")";}),

      "red");


      (0,external_kolmafia_.print)(
      "Used resources: " +
      unused[1].resourceUsed.map(function (r) {return ResourceCategory[r];}).join(", "));


      return true;
    } }, { key: "isThisBetterThan", value:

    function isThisBetterThan(compareAgainst, eachTurnWorth) {
      var oldProfit = compareAgainst.getProfitLost(eachTurnWorth);
      var newProfit = this.getProfitLost(eachTurnWorth);

      if (oldProfit[0] + oldProfit[1] < newProfit[0] + newProfit[1]) {
        return false;
      }

      return true;
    } }, { key: "printInfo", value:

    function printInfo() {var _this = this;







      var used = new Map();var _iterator4 = TaskManager_createForOfIteratorHelper(

        this.resourcesUsed),_step4;try {var _loop = function _loop() {var _step4$value = TaskManager_slicedToArray(_step4.value, 2),quest = _step4$value[0],resource = _step4$value[1];
          var key = resource.name;

          if (!used.has(key)) {
            used.set(key, []);
          }

          var id = quest.getId();

          var pair = used.get(key).find(function (p) {return p.questName == id;});

          if (pair == null) {
            var path = _this.thisPath.find(
            function (_ref5) {var _ref6 = TaskManager_slicedToArray(_ref5, 2),questInfo = _ref6[0],possiblePath = _ref6[1];return questInfo.getId() === id;})[
            1];

            used.get(key).push(
            pair = {
              level: quest.level(),
              questName: id,
              resourcesUsed: 0,
              turnsSaved: path.getAverageTurns(),
              path: path
            });

          }

          pair.resourcesUsed++;
        };for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {_loop();}} catch (err) {_iterator4.e(err);} finally {_iterator4.f();}

      var index1 = 0;
      var lines = [];

      used.forEach(function (details, resourceName) {
        index1++;

        var resourcesUsed = details.
        map(function (d) {return d.resourcesUsed;}).
        reduce(function (p, n) {return p + n;}, 0);

        details.sort(function (d1, d2) {
          if (d1.level != d2.level) {
            return d1.level - d2.level;
          }

          return d1.questName.localeCompare(d2.questName);
        });

        var paths = details.
        map(
        function (d, index) {return "<font color='".concat(
          (index + index1) % 2 == 0 ? "gray" : "", "'>").concat(
          d.questName, " x ").concat(
          d.resourcesUsed, " (").concat(d.turnsSaved, " advs)").concat(
          resourceName == "Pull" && d.path.pulls.length > 0 ? " <font color='purple'>(".concat(
          d.path.pulls.join(", "), ")</font>") :
          "", "</font>");}).


        join(", ");

        lines.push("<font color='blue'>".concat(
        resourceName, " x ").concat(resourcesUsed, "</font> => ").concat(paths));

      });

      lines.sort(function (l1, l2) {return l1.localeCompare(l2);});

      lines.forEach(function (l) {return (0,external_kolmafia_.printHtml)(l, true);});

      var advs = this.getAdvs();

      (0,external_kolmafia_.print)(
      "With mpa of " +
      GreySettings_GreySettings.greyValueOfAdventure +
      " and using estimated " +
      Math.floor(this.getTotalCost()) +
      " meat of resources, save " +
      advs[0] +
      " to " +
      advs[1] +
      " adventures compared to the worst alternatives");

    } }, { key: "setPath", value:

    function setPath(paths) {
      this.thisPath = paths;
    } }, { key: "assignResources", value:

    function assignResources() {var _this2 = this;var _iterator5 = TaskManager_createForOfIteratorHelper(
        this.resourcesUsed),_step5;try {var _loop2 = function _loop2() {var _step5$value = TaskManager_slicedToArray(_step5.value, 2),quest = _step5$value[0],resource = _step5$value[1];
          var _this2$thisPath$find = _this2.thisPath.find(function (_ref7) {var _ref8 = TaskManager_slicedToArray(_ref7, 1),q = _ref8[0];return q === quest;}),_this2$thisPath$find2 = TaskManager_slicedToArray(_this2$thisPath$find, 2),path = _this2$thisPath$find2[1];

          path.resourcesAvailable.push(resource);
        };for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {_loop2();}} catch (err) {_iterator5.e(err);} finally {_iterator5.f();}
    } }, { key: "getAdvs", value:

    function getAdvs() {
      if (this.advsSaved == null) {
        this.advsSaved = [0, 0];var _iterator6 = TaskManager_createForOfIteratorHelper(

          this.thisPath),_step6;try {for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {var _step6$value = TaskManager_slicedToArray(_step6.value, 2),path = _step6$value[1];
            if (path == null) {
              continue;
            }

            this.advsSaved[0] += path.advsSavedMin;
            this.advsSaved[1] += path.advsSavedMax;
          }} catch (err) {_iterator6.e(err);} finally {_iterator6.f();}
      }

      return this.advsSaved;
    } }, { key: "clone", value:

    function clone() {
      var newPath = new SimmedPath(false, true);
      newPath.resourcesRemaining = new Map(this.resourcesRemaining);
      newPath.resourcesUsed = TaskManager_toConsumableArray(this.resourcesUsed);
      newPath.thisPath = TaskManager_toConsumableArray(this.thisPath);

      return newPath;
    } }, { key: "addUse", value:

    function addUse(quest, resource, chance) {
      this.resourcesUsed.push([quest, resource, chance]);
      this.resourcesRemaining.set(
      resource.resource,
      this.resourcesRemaining.get(resource.resource) - (
      resource.resourcesUsed || 1));

    } }, { key: "canUse", value:

    function canUse(resource) {
      return (
        this.resourcesRemaining.get(resource.resource) >= (
        resource.resourcesUsed || 1));

    } }, { key: "getTotalCost", value:

    function getTotalCost() {
      this.totalCost = this.thisPath.
      map(function (p) {return p[1] != null ? p[1].miscMeat : 0;}).
      reduce(function (p, n) {return p + n;}, 0);var _iterator7 = TaskManager_createForOfIteratorHelper(

        this.resourcesUsed),_step7;try {for (_iterator7.s(); !(_step7 = _iterator7.n()).done;) {var resource = _step7.value;
          this.totalCost += resource[1].worthInAftercore * 1; //resource[2];

          if (resource[1].freeTurn == true) {
            this.totalCost -= GreySettings_GreySettings.greyValueOfAdventure;
          }
        }} catch (err) {_iterator7.e(err);} finally {_iterator7.f();}

      return this.totalCost;
    }

    /**
     * Returns how much profit was lost following this path
     */ }, { key: "getProfitLost", value:
    function getProfitLost(advsWorth) {
      if (this.profitLost == null) {
        // Costs are a negative
        var meatGain = this.getTotalCost();

        this.profitLost = [
        meatGain - this.getAdvs()[0] * advsWorth,
        meatGain - this.getAdvs()[1] * advsWorth];

      }

      return this.profitLost;
    } }]);return SimmedPath;}();


var TaskManager_FigureOutPath = /*#__PURE__*/function () {function FigureOutPath() {TaskManager_classCallCheck(this, FigureOutPath);TaskManager_defineProperty(this, "resources",
    ResourceTypes_getResources());}TaskManager_createClass(FigureOutPath, [{ key: "getPaths", value:

    function getPaths(quests) {var _this3 = this;var assumeUnstarted = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
      (0,external_kolmafia_.print)(
      "Now calculating resources.. " + (
      GreySettings_GreySettings.greyBreakAtTower ?
      "" :
      "As you're not breaking at tower, this might take a while.."));

      var allPaths = [];
      var miscPaths = [];
      var uncompleteable = [];

      // What we need to do is sort the paths by the most profitable. Ideally we want to eliminate the ones that are just not feasible asap.
      // If it wants 2 faxes but we only want 1, then we can immediately eliminate the least profitable.
      var _iterator8 = TaskManager_createForOfIteratorHelper(quests),_step8;try {var _loop3 = function _loop3() {var quest = _step8.value;
          var q = quest;

          if (q.getPossiblePaths == null) {
            miscPaths.push(quest);return "continue";

          }

          if (q.createPaths != null) {
            q.createPaths(assumeUnstarted);
          }

          var paths = q.getPossiblePaths();

          if (paths == null) {
            //miscPaths.push(quest);
            return "continue";
          }

          if (paths.length == 0) {
            (0,external_kolmafia_.print)(
            "We should never have empty paths, assume this is a bug. If we want to avoid doing the quest, return null and status() instead.",
            "red");

          }

          if (
          paths.find(
          function (p) {return p.resourcesAvailable.length + p.resourceUsed.length > 0;}) !=
          null)
          {
            throw "Resources not cleared for " + quest.getId();
          }

          if (
          quest.level() >= 1 &&
          !assumeUnstarted &&
          quest.status() == QuestStatus.COMPLETED)
          {return "continue";

          }var _iterator10 = TaskManager_createForOfIteratorHelper(

            paths),_step10;try {var _loop4 = function _loop4() {var path = _step10.value;var _iterator12 = TaskManager_createForOfIteratorHelper(
                ResourceIds),_step12;try {var _loop5 = function _loop5() {var res = _step12.value;
                  if (path.ignoreResources.includes(res)) {return "continue";

                  }

                  var possibles = ResourceTypes_getResources().filter(
                  function (r) {return r.resource == res && path.canUse(r.type) > 0;});


                  if (possibles.length <= 1) {return "continue";

                  }

                  //print("Better check " + quest.getId() + " for " + res);
                };for (_iterator12.s(); !(_step12 = _iterator12.n()).done;) {var _ret2 = _loop5();if (_ret2 === "continue") continue;}} catch (err) {_iterator12.e(err);} finally {_iterator12.f();}
            };for (_iterator10.s(); !(_step10 = _iterator10.n()).done;) {_loop4();}} catch (err) {_iterator10.e(err);} finally {_iterator10.f();}

          paths = paths.filter(function (p) {
            var resources = new Map();var _iterator11 = TaskManager_createForOfIteratorHelper(

              ResourceIds),_step11;try {for (_iterator11.s(); !(_step11 = _iterator11.n()).done;) {var resourceId = _step11.value;
                resources.set(
                resourceId,
                getResourcesLeft(resourceId, assumeUnstarted));

              }} catch (err) {_iterator11.e(err);} finally {_iterator11.f();}

            var resourcesToComplete = _this3.getResourcesToComplete(
            resources,
            quest,
            p);


            if (resourcesToComplete == null) {
              return false;
            }

            p.setRoughPathCost(resourcesToComplete);

            return true;
          });

          if (paths.length == 0) {
            uncompleteable.push(quest);return "continue";

          }

          // Now we figure out how many advs each path would save compared to the other
          var mostAdvsCouldveUsed = paths.
          map(function (p) {return [p.advsSavedMin, p.advsSavedMax];}).
          reduce(function (p, n) {return [Math.max(p[0], n[0]), Math.max(p[1], n[1])];});

          paths.forEach(function (p) {
            // If this path would take 2 to 5 adventures
            // And the most adventures are 1 to 30
            // That means we would profit -1 to 25
            p.advsSavedMin = mostAdvsCouldveUsed[0] - p.advsSavedMin;
            p.advsSavedMax = mostAdvsCouldveUsed[1] - p.advsSavedMax;
          });

          // We want the cheapest paths to go first
          paths.sort(function (p1, p2) {
            var cost1 = p1.getCostOfPath();
            var cost2 = p2.getCostOfPath();

            if (cost1 == cost2) {
              return 0;
            }

            return cost1 - cost2;
          });

          var cheapestNoResource = paths.find(
          function (p) {return p.resourcesNeeded.length == 0;});


          if (cheapestNoResource != null) {
            var meatSavedOnPath =
            cheapestNoResource.pathCost -
            (cheapestNoResource.advsSavedMin + cheapestNoResource.advsSavedMax) /
            2 *
            GreySettings_GreySettings.greyValueOfAdventure;
          }

          allPaths.push([quest, paths]);
        };for (_iterator8.s(); !(_step8 = _iterator8.n()).done;) {var _ret = _loop3();if (_ret === "continue") continue;}} catch (err) {_iterator8.e(err);} finally {_iterator8.f();}

      if (uncompleteable.length > 0) {var _iterator9 = TaskManager_createForOfIteratorHelper(
          uncompleteable),_step9;try {for (_iterator9.s(); !(_step9 = _iterator9.n()).done;) {var q = _step9.value;
            (0,external_kolmafia_.print)(
            "Unable to plot a path! Not enough resources to complete `" +
            q.getId() +
            "`",
            "red");

            var combos = q.
            getPossiblePaths().
            map(function (p) {return (
                p.resourcesNeeded.map(
                function (_ref9) {var _ref10 = TaskManager_slicedToArray(_ref9, 2),r = _ref10[0],amount = _ref10[1];return ResourceCategory[r] + " x " + amount;}));});



            (0,external_kolmafia_.print)("Combinations of resources needed are: ".concat(combos.join(" OR ")));
          }} catch (err) {_iterator9.e(err);} finally {_iterator9.f();}

        return null;
      }

      // We want the most expensive paths to go first, the cheapest paths are always the first in each path
      allPaths.sort(function (_ref11, _ref12) {var _ref13 = TaskManager_slicedToArray(_ref11, 2),paths1 = _ref13[1];var _ref14 = TaskManager_slicedToArray(_ref12, 2),paths2 = _ref14[1];
        if (
        paths1.length != paths2.length &&
        Math.min(paths1.length, paths2.length) == 1)
        {
          return paths1.length - paths2.length;
        }

        var cost1 = paths1[0].getCostOfPath();
        var cost2 = paths2[0].getCostOfPath();

        if (cost1 == cost2) {
          return 0;
        }

        return cost1 - cost2;
      });

      var simmedPath = this.doAttempt(
      new SimmedPath(assumeUnstarted),
      0,
      allPaths);


      if (simmedPath == null) {
        return null;
      }

      simmedPath.assignResources();

      miscPaths.forEach(function (q) {
        simmedPath.thisPath.push([q, null]);
      });

      return simmedPath;
    } }, { key: "doAttempt", value:

    function doAttempt(
    currentPath,
    index,
    allPaths)
    {var _this4 = this;
      var _allPaths$index = TaskManager_slicedToArray(allPaths[index++], 2),quest = _allPaths$index[0],paths = _allPaths$index[1];

      var possible =



      [];var _iterator13 = TaskManager_createForOfIteratorHelper(

        paths),_step13;try {for (_iterator13.s(); !(_step13 = _iterator13.n()).done;) {var path = _step13.value;
          var resources =
          this.getResourcesToComplete(
          currentPath.resourcesRemaining,
          quest,
          path);


          if (resources == null) {
            continue;
          }

          var resourceCost = resources.
          map(
          function (r) {return (
              r[1].worthInAftercore * r[2] - (
              r[1].freeTurn == true ? GreySettings_GreySettings.greyValueOfAdventure : 0));}).

          reduce(function (p, n) {return p + n;}, 0);
          var extraAdvsWorth =
          GreySettings_GreySettings.greyValueOfAdventure * (
          (path.advsSavedMax - path.advsSavedMin) / 2 + path.advsSavedMin);

          possible.push([
          path,
          resources,
          path.miscMeat + resourceCost - extraAdvsWorth]);

        }} catch (err) {_iterator13.e(err);} finally {_iterator13.f();}

      possible.sort(function (_ref15, _ref16) {var _ref17 = TaskManager_slicedToArray(_ref15, 3),meat1 = _ref17[2];var _ref18 = TaskManager_slicedToArray(_ref16, 3),meat2 = _ref18[2];return meat1 - meat2;});

      var best;
      var addPath = function addPath(
      simmed,
      quest,
      path)
      {
        if (path instanceof PossibleMultiPath) {var _iterator14 = TaskManager_createForOfIteratorHelper(
            path.subpaths),_step14;try {for (_iterator14.s(); !(_step14 = _iterator14.n()).done;) {var _step14$value = TaskManager_slicedToArray(_step14.value, 2),_quest = _step14$value[0],p = _step14$value[1];
              addPath(simmed, _quest, p);
            }} catch (err) {_iterator14.e(err);} finally {_iterator14.f();}
        } else {
          simmed.thisPath.push([quest, path]);
        }
      };

      var tried = 0;var _loop6 = function _loop6()

      {var _possible$_i = TaskManager_slicedToArray(_possible[_i2], 2),path = _possible$_i[0],resources = _possible$_i[1];
        var simmed = currentPath.clone();

        addPath(simmed, quest, path);

        resources.forEach(function (_ref19) {var _ref20 = TaskManager_slicedToArray(_ref19, 3),quest = _ref20[0],resource = _ref20[1],amount = _ref20[2];
          simmed.addUse(quest, resource, amount);
        });

        tried++;

        if (index < allPaths.length) {
          simmed = _this4.doAttempt(simmed, index, allPaths);

          if (simmed == null) {return "continue";

          }
        }

        if (
        best == null ||
        simmed.isThisBetterThan(best, GreySettings_GreySettings.greyValueOfAdventure))
        {
          best = simmed;
        }

        if (tried >= (path.pathCost <= 5000 ? 1 : 2)) {return { v:
            best };
        }
      };for (var _i2 = 0, _possible = possible; _i2 < _possible.length; _i2++) {var _ret3 = _loop6();if (_ret3 === "continue") continue;if (TaskManager_typeof(_ret3) === "object") return _ret3.v;}

      return best;
    }

    /**
     * @returns [QuestInfo, Resource, Chance of use][]
     */ }, { key: "getResourcesToComplete", value:
    function getResourcesToComplete(
    resourcesAvailable,
    quest,
    path)
    {
      return this.doResourcesToComplete(
      quest,
      path,
      new Map(resourcesAvailable),
      []);

    } }, { key: "doResourcesToComplete", value:

    function doResourcesToComplete(
    quest,
    path,
    resourcesAvailable,
    resources)
    {
      if (path instanceof PossibleMultiPath) {var _iterator15 = TaskManager_createForOfIteratorHelper(
          path.subpaths),_step15;try {for (_iterator15.s(); !(_step15 = _iterator15.n()).done;) {var _step15$value = TaskManager_slicedToArray(_step15.value, 2),q = _step15$value[0],p = _step15$value[1];
            var result = this.doResourcesToComplete(
            q,
            p,
            resourcesAvailable,
            resources);


            if (result == null) {
              return null;
            }
          }} catch (err) {_iterator15.e(err);} finally {_iterator15.f();}
      } else {
        var skip = new Map();var _iterator16 = TaskManager_createForOfIteratorHelper(
          path.resourcesNeeded),_step16;try {for (_iterator16.s(); !(_step16 = _iterator16.n()).done;) {var _r$resourcesUsed;var _step16$value = TaskManager_slicedToArray(_step16.value, 2),res = _step16$value[0],chance = _step16$value[1];
            if (!skip.has(res)) {
              skip.set(res, path.getUsed(res));
            }

            if (skip.get(res) > 0) {
              skip.set(res, skip.get(res) - 1);
              continue;
            }

            var r = this.getResource(
            resourcesAvailable,
            res,
            path.ignoreResources);


            if (r == null) {
              return null;
            }

            resources.push([quest, r, chance]);
            resourcesAvailable.set(
            r.resource,
            resourcesAvailable.get(r.resource) - ((_r$resourcesUsed = r.resourcesUsed) !== null && _r$resourcesUsed !== void 0 ? _r$resourcesUsed : 1));

          }} catch (err) {_iterator16.e(err);} finally {_iterator16.f();}
      }

      return resources;
    } }, { key: "getResource", value:

    function getResource(
    used,
    resourceType,
    unsupported)
    {var _iterator17 = TaskManager_createForOfIteratorHelper(
        this.resources),_step17;try {for (_iterator17.s(); !(_step17 = _iterator17.n()).done;) {var resource = _step17.value;
          if (
          resource.type != resourceType ||
          unsupported.includes(resource.resource))
          {
            continue;
          }

          if (used.get(resource.resource) >= (resource.resourcesUsed || 1)) {
            return resource;
          }
        }} catch (err) {_iterator17.e(err);} finally {_iterator17.f();}

      return null;
    } }]);return FigureOutPath;}();
;// CONCATENATED MODULE: ./src/utils/GreyTimings.ts
function GreyTimings_typeof(obj) {"@babel/helpers - typeof";return GreyTimings_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, GreyTimings_typeof(obj);}function GreyTimings_slicedToArray(arr, i) {return GreyTimings_arrayWithHoles(arr) || GreyTimings_iterableToArrayLimit(arr, i) || GreyTimings_unsupportedIterableToArray(arr, i) || GreyTimings_nonIterableRest();}function GreyTimings_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function GreyTimings_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function GreyTimings_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function GreyTimings_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = GreyTimings_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function GreyTimings_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return GreyTimings_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return GreyTimings_arrayLikeToArray(o, minLen);}function GreyTimings_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function GreyTimings_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function GreyTimings_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, GreyTimings_toPropertyKey(descriptor.key), descriptor);}}function GreyTimings_createClass(Constructor, protoProps, staticProps) {if (protoProps) GreyTimings_defineProperties(Constructor.prototype, protoProps);if (staticProps) GreyTimings_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function GreyTimings_defineProperty(obj, key, value) {key = GreyTimings_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function GreyTimings_toPropertyKey(arg) {var key = GreyTimings_toPrimitive(arg, "string");return GreyTimings_typeof(key) === "symbol" ? key : String(key);}function GreyTimings_toPrimitive(input, hint) {if (GreyTimings_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (GreyTimings_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}

var GreyTimings_GreyTimings = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {function GreyTimings() {GreyTimings_classCallCheck(this, GreyTimings);GreyTimings_defineProperty(this, "prop",
    "_greyScriptTimings");GreyTimings_defineProperty(this, "expectingStart",
    true);}GreyTimings_createClass(GreyTimings, [{ key: "doStart", value:

    function doStart() {
      if (!this.expectingStart) {
        throw "Expected a end, not a start";
      }

      this.expectingStart = false;

      var times = getProperty(this.prop).
      split(",").
      filter(function (s) {return s.length > 0;});

      times.push(this.getTime().toString());

      setProperty(this.prop, times.join(","));
    } }, { key: "doEnd", value:

    function doEnd() {
      if (this.expectingStart) {
        throw "Expected a start, not a end";
      }

      this.expectingStart = true;

      var time = this.getTime();
      var prop = getProperty(this.prop) + ":" + time;
      var secs = this.getTotalSeconds(prop);

      setProperty(this.prop, time - secs + ":" + time);
    } }, { key: "getTimings", value:

    function getTimings(prop) {
      var timings = [];var _iterator = GreyTimings_createForOfIteratorHelper(

        prop.split(",").map(function (s) {return s.split(":");})),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var _step$value = GreyTimings_slicedToArray(_step.value, 2),t1 = _step$value[0],t2 = _step$value[1];
          timings.push([toInt(t1), t2 ? toInt(t2) : null]);
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

      return timings;
    } }, { key: "getTotalSeconds", value:

    function getTotalSeconds() {var prop = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : getProperty(this.prop);
      var timeTaken = 0;
      var timings = this.getTimings(prop);

      for (var i = 0; i < timings.length; i++) {
        var _timings$i = GreyTimings_slicedToArray(timings[i], 2),started = _timings$i[0],ended = _timings$i[1];

        if (!ended) {
          ended = i + 1 < timings.length ? timings[i + 1][1] : this.getTime();
        }

        timeTaken += ended - started;
      }

      return timeTaken;
    } }, { key: "getTime", value:

    function getTime() {
      return Math.round(Date.now() / 1000);
    } }, { key: "getTimeAsString", value:

    function getTimeAsString(time) {
      var hours = Math.floor(time / 3600).toString();
      var minutes = Math.floor(time % 3600 / 60).toString();
      var seconds = (time % 60).toString();

      if (hours.length <= 1) {
        hours = "0" + hours;
      }

      if (minutes.length <= 1) {
        minutes = "0" + minutes;
      }

      if (seconds.length <= 1) {
        seconds = "0" + seconds;
      }

      return "".concat(hours, ":").concat(minutes, ":").concat(seconds);
    } }]);return GreyTimings;}()));
;// CONCATENATED MODULE: ./src/GreyYouMain.ts
function GreyYouMain_typeof(obj) {"@babel/helpers - typeof";return GreyYouMain_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, GreyYouMain_typeof(obj);}function GreyYouMain_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = GreyYouMain_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function GreyYouMain_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return GreyYouMain_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return GreyYouMain_arrayLikeToArray(o, minLen);}function GreyYouMain_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function GreyYouMain_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function GreyYouMain_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, GreyYouMain_toPropertyKey(descriptor.key), descriptor);}}function GreyYouMain_createClass(Constructor, protoProps, staticProps) {if (protoProps) GreyYouMain_defineProperties(Constructor.prototype, protoProps);if (staticProps) GreyYouMain_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function GreyYouMain_defineProperty(obj, key, value) {key = GreyYouMain_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function GreyYouMain_toPropertyKey(arg) {var key = GreyYouMain_toPrimitive(arg, "string");return GreyYouMain_typeof(key) === "symbol" ? key : String(key);}function GreyYouMain_toPrimitive(input, hint) {if (GreyYouMain_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (GreyYouMain_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}












var

GreyYouMain = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {function GreyYouMain() {GreyYouMain_classCallCheck(this, GreyYouMain);GreyYouMain_defineProperty(this, "adventures", void 0);GreyYouMain_defineProperty(this, "svn_name",

    "libraryaddict-Greyday-branches-release");GreyYouMain_defineProperty(this, "git_name",
    "libraryaddict-Greyday-release");}GreyYouMain_createClass(GreyYouMain, [{ key: "isRevisionPass", value:

    function isRevisionPass() {
      var required = 27132;

      if (getRevision() > 0 && getRevision() < required) {
        print("Please update your mafia. You are using ".concat(
        getRevision(), " but we need at least ").concat(required),
        "red");

        return false;
      }

      return true;
    } }, { key: "getTick", value:

    function getTick() {
      return "<font color='green'></font>";
    } }, { key: "getCross", value:

    function getCross() {
      return "<font color='red'></font>";
    } }, { key: "doSettings", value:

    function doSettings() {
      var settings = getGreySettings();

      printHtml(centerText("====== Grey Settings ======", "blue"));

      var html = "";var _iterator = GreyYouMain_createForOfIteratorHelper(

        settings),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var setting = _step.value;
          if (setting.viable == false) {
            continue;
          }

          html += "<br>";

          var val = getProperty(setting.property);

          html += "<font color='blue'>".concat(setting.property, "</font> - <font color='gray'>").concat(setting.description, "</font>");
          html += "<br>";

          if (setting.valid(val)) {
            html += "".concat(this.getTick(), " <font color='green'>Setting '").concat(val, "' is valid</font>");
          } else if (val == "") {
            html += "".concat(this.getTick(), " <font color=>Using default").concat(
            setting["default"] != null ? " '".concat(setting["default"], "'") : "", "</font>");

          } else {
            html += "".concat(this.getCross(), " <font color='red'>Invalid setting '").concat(val, "'</font>");
          }
          html += "<br>";
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

      html += "<br>You can change these settings by using the following in CLI:";
      html += "<br>";
      html += "<font color='purple'>set settingName = value</font>";

      printHtml(centerText(html));

      print("");
      printHtml(
      "<div style=\"text-align: center;\" color='blue'>======================</div>");


      this.clickThis();
    } }, { key: "clickThis", value:

    function clickThis() {
      printHtml(
      "It's easiest to use the <a href='relay_Greyday.js?relay=true'><u>relay page</u></a>");

    } }, { key: "doHelp", value:

    function doHelp() {
      printHtml(centerText("======================================"));
      print("help - Shows this message", "blue");
      printHtml(
      "<font color='blue'>settings - Manage settings (Try the <a color='purple' href='relay_Greyday.js?relay=true'><u>relay page</u></a> instead!)</font>");

      print("required - Prints off a series of requirements.", "blue");
      print(
      "resources - A debug command that predicts what resources it would try to use in Grey You using your current settings",
      "blue");


      var color = myPath() == Path.get("Grey You") ? "blue" : "red";

      if (color == "red") {
        print("You are not in Grey You, and cannot use these commands.", "gray");
      }

      print(
      "run <Turns> - Run X amount of turns, or 999 if turns are not provided",
      color);

      print(
      "sim - Equips and gets ready to adventure, showing where it would go. But will not take the action.",
      color);

      print(
      "absorbs - Prints off what adventure absorbs have not yet been grabbed",
      color);

      printHtml(centerText("======================================"));
    } }, { key: "checkVersion", value:

    function checkVersion() {
      // Copied from Kasekopf's loopgyou
      print("Running Greyday version [".concat(

      lastCommitHash !== null && lastCommitHash !== void 0 ? lastCommitHash : "custom-built", "] in KoLmafia r").concat(
      getRevision()), "grey");



      if (
      lastCommitHash !== undefined && (
      svnExists(this.svn_name) || gitExists(this.git_name)))
      {
        if (
        gitExists(this.git_name) ?
        !gitAtHead(this.git_name) :
        !svnAtHead(this.svn_name))
        {
          print(
          'A newer version of this script is available and can be obtained with "git update".',
          "red");

        } else {
          print("This script is up to date.", "blue");
        }
      }
    } }, { key: "handleCommand", value:

    function handleCommand(command) {
      command = command.toLowerCase();

      if (!this.isRevisionPass()) {
        return;
      }

      this.checkVersion();

      if (
      currentRound() != 0 ||
      handlingChoice() ||
      choiceFollowsFight() ||
      fightFollowsChoice())
      {
        visitUrl("main.php");

        if (currentRound() != 0 || handlingChoice()) {
          print(
          "In a fight or in a choice, please resolve before continuing..",
          "red");

          return;
        }

        if (
        currentRound() == 0 &&
        !handlingChoice() &&
        !fightFollowsChoice() &&
        !fightFollowsChoice())
        {
          if (getProperty("lastIcehouseCheck") != gamedayToInt().toString()) {
            visitUrl("museum.php?action=icehouse");
            setProperty("lastIcehouseCheck", gamedayToInt().toString());
          }
        }
      }

      GreySettings.loadSettings();

      if (command == "resources") {
        var adv = new GreyAdventurer();
        var path = new FigureOutPath().getPaths(
        adv.adventureFinder.getAllRawQuests(),
        true);


        if (path == null) {
          print("Oh no! Path not found");
          return;
        }

        path.printInfo();
        return;
      }

      if (command == "" || command == "help") {
        this.doHelp();
        return;
      }

      var banishedAbsorbs = AbsorbsProvider.loadAbsorbs(true).filter(
      function (absorb) {return (
          getBanished().find(
          function (b) {return (
              b.banisher.type == BanishType.ICE_HOUSE &&
              b.monster == absorb.monster);}) !=
          null);});


      if (banishedAbsorbs.length > 0) {
        print(
        "Your Ice House contains a monster we'd like to absorb! Please release them.. " +
        banishedAbsorbs.map(function (a) {return a.monster;}).join(", "),
        "red");

        waitq(1);
      }

      if (command.includes("require")) {
        new GreyRequirements().hasRequired();
        return;
      }

      if (command == "settings") {
        this.doSettings();
        return;
      }

      if (command == "unprime") {var _iterator2 = GreyYouMain_createForOfIteratorHelper(
          getResources()),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var resource = _step2.value;
            if (resource.primed == null || !resource.primed()) {
              continue;
            }

            resource.unprime();
            print("Unprimed " + resource.name);
          }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}

        print("Unprimed resources.", "blue");
        return;
      }

      if (
      command != "absorbs" &&
      command != "run" &&
      !command.startsWith("run ") &&
      command != "sim" &&
      command != "status")
      {
        print("Unknown command.");
        return;
      }

      var settings = getGreySettings();
      var invalid = false;var _iterator3 = GreyYouMain_createForOfIteratorHelper(

        settings),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var setting = _step3.value;
          var val = getProperty(setting.property);

          if (val == "" || setting.valid(val)) {
            continue;
          }

          printHtml(
          "<font color='red'>The setting '" +
          setting.property +
          "' is invalid, please correct this or set it to empty. To reset it, use the CLI command <font color='blue'>set " +
          setting.property +
          " =</font></font>");

        }} catch (err) {_iterator3.e(err);} finally {_iterator3.f();}

      if (invalid) {
        return;
      }

      if (myPath() != Path.get("Grey You")) {
        print(
        "You're not in grey you. Use 'help' to see what you can use.",
        "red");

        return;
      }

      if (
      getProperty("greyBreakAtTower") == "" &&
      !GreySettings.isHardcoreMode())
      {
        print(
        "The 'greyBreakAtTower' setting has not been set, the script will break when it reaches the tower.",
        "red");

      }

      if (hasVIPInvitation() && !hasWhitelistToCurrentClan()) {
        print(
        "Do you not have a whitelist to your current clan, some VIP Invitation stuff will not work. You should ask for a whitelist so this script can switch clans as required.",
        "red");

      }

      if (
      GreySettings.greyValueOfAdventure < 1000 &&
      getProperty("greyValueOfAdventure") == "")
      {
        print(
        "Your value of a grey adventure is low.. It claims you value each adventure at " +
        GreySettings.greyValueOfAdventure +
        ", which means you'd be happier if you could trade each adventure for " +
        GreySettings.greyValueOfAdventure +
        " meat than run that adventure yourself. You can set `greyValueOfAdventure` if your valueOfAdventure is correct.",
        "red");

      }

      this.adventures = new GreyAdventurer();
      var s = command.split(" ");

      if (command == "absorbs") {
        this.adventures.adventureFinder.absorbs.printRemainingAbsorbs();
        return;
      }

      this.adventures.adventureFinder.calculatePath();

      if (this.adventures.adventureFinder.path == null) {
        print("Failed to find a way to accomplish Greyday!", "red");
        return;
      }

      if (command == "status") {
        this.adventures.adventureFinder.start(true);
        this.adventures.adventureFinder.possibleAdventures.sort(function (a1, a2) {
          if (a1.quest == null != (a2.quest == null)) {
            return a1.quest == null ? 1 : -1;
          }

          if (a1.quest != null) {
            return a1.quest.getId().localeCompare(a2.quest.getId());
          }

          if (a1.status != a2.status) {
            return a1.status - a2.status;
          }

          if (a1.considerPriority != a2.considerPriority) {
            return a1.considerPriority - a2.considerPriority;
          }

          return 0;
        });

        this.adventures.adventureFinder.printStatus(
        this.adventures.adventureFinder.possibleAdventures);

        return;
      } else if (command == "sim") {
        this.adventures.runTurn(false);
        return;
      } else if (s[0] == "go" || s[0] == "run") {
        var turns = toInt(s[1] || "999");

        var effect = Effect.get("Beaten Up");
        var lastBeaten = haveEffect(effect);

        var timings = new GreyTimings();
        var turnsRunAsFar = 0;

        if (turns > 0) {
          timings.doStart();
        }

        var pullsBeforeStart = getProperty("_roninStoragePulls");

        var props = new PropertyManager();

        try {
          props.setProperty("autoSatisfyWithNPCs", "true");
          props.setProperty("autoSatisfyWithMall", "true");
          props.setProperty("autoSatisfyWithStorage", "true");
          props.setProperty("autoSatisfyWithCoinmasters", "true");
          props.setProperty("requireBoxServants", "false");

          var autoAttack = getAutoAttack();

          if (autoAttack != 0) {
            props.addCleanup(function () {return setAutoAttack(autoAttack);});
            setAutoAttack(0);
          }

          if (!getIgnoreZoneWarnings()) {
            props.addCleanup(function () {return (
                visitUrl(
                "account.php?am=1&pwd&action=flag_ignorezonewarnings&value=0&ajax=1",
                true));});



            visitUrl(
            "account.php?am=1&pwd&action=flag_ignorezonewarnings&value=1&ajax=1",
            true);

          }

          for (;

          turnsRunAsFar < turns && haveEffect(effect) - lastBeaten != 3;
          turnsRunAsFar++)
          {
            if (shouldGreydayStop()) {
              return;
            }

            lastBeaten = haveEffect(effect);

            var run = this.adventures.runTurn(true);

            if (!run) {
              break;
            }

            if (handlingChoice() || currentRound() != 0) {
              visitUrl("main.php");
              if (handlingChoice() || currentRound() != 0) {
                print(
                "I'm currently in a choice or combat, this is unexpected!",
                "red");

                break;
              }
            }
          }
        } finally {
          if (turns > 0) {
            timings.doEnd();
          }

          props.resetAll();

          var extraPulls = getProperty(
          getProperty("_roninStoragePulls").replace(pullsBeforeStart, "")).

          split(",").
          filter(function (s) {return s.length > 0;});

          var greyPulls = getProperty("_greyPulls").
          split(",").
          filter(function (s) {return s.length > 0;});var _iterator4 = GreyYouMain_createForOfIteratorHelper(

            extraPulls),_step4;try {for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {var p = _step4.value;
              if (greyPulls.includes(p)) {
                continue;
              }

              greyPulls.push(p);
            }} catch (err) {_iterator4.e(err);} finally {_iterator4.f();}

          if (greyPulls.length > 0) {
            setProperty("_greyPulls", greyPulls.join(","));
          }

          print(
          "Time to run this script as far today is: " +
          timings.getTimeAsString(timings.getTotalSeconds()),
          "blue");

        }

        if (haveEffect(effect) - lastBeaten == 3) {
          print("Oh no! We were beaten up..", "red");
        }

        print("Done running", "blue");
        return;
      }
    } }]);return GreyYouMain;}()));


var stopped = false;
var reachedTower = "_greyReachedTower";

function shouldGreydayStop() {
  if (stopped) {
    return stopped;
  }

  if (
  GreySettings_GreySettings.greyBreakAtTower &&
  (0,external_kolmafia_.getProperty)(reachedTower) != "true" &&
  getQuestStatus("questL13Final") >= 0)
  {
    (0,external_kolmafia_.setProperty)(reachedTower, "true");
    (0,external_kolmafia_.visitUrl)("place.php?whichplace=nstower");

    (0,external_kolmafia_.print)(
    "We've reached the tower! Now aborting script as set by preference 'greyBreakAtTower'!",
    "blue");

    (0,external_kolmafia_.print)("The script will continue when you run the script again.");

    var turnsToFarmScore =
    (0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("digital key")) > 0 ||
    (0,external_kolmafia_.getProperty)("nsTowerDoorKeysUsed").includes("digital key") ?
    0 :
    Math.max(
    0,
    Math.ceil((10000 - (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("8BitScore"))) / 375));


    if (turnsToFarmScore > 0) {
      (0,external_kolmafia_.setProperty)("_greyPixelRealmAdventures", turnsToFarmScore.toString());

      (0,external_kolmafia_.print)("Please note that Greyday expects to take an extra ".concat(
      turnsToFarmScore, " adventures to finish farming a digital key up in 8 bit realm, which is generally faster with full equipment access."),
      "red");

    }

    printEndOfRun();
    stopped = true;
    return true;
  }

  if ((0,external_kolmafia_.getProperty)("greyday_interrupt") == "true") {
    (0,external_kolmafia_.setProperty)("greyday_interrupt", "false");
    (0,external_kolmafia_.print)("Interrupt requested as per relay page", "red");
    stopped = true;
    return true;
  }

  return false;
}

function printEndOfRun() {
  var pulls = (0,external_kolmafia_.getProperty)("_greyPulls").
  split(",").
  map(function (s) {return (0,external_kolmafia_.toItem)((0,external_kolmafia_.toInt)(s));});
  var playerPulls = (0,external_kolmafia_.getProperty)("_roninStoragePulls").
  split(",").
  map(function (s) {return (0,external_kolmafia_.toItem)((0,external_kolmafia_.toInt)(s));}).
  filter(function (i) {return !pulls.includes(i);});

  if (!GreySettings_GreySettings.isHardcoreMode()) {
    (0,external_kolmafia_.print)("Greyday pulled ".concat(
    pulls.length, " of allowed ").concat(
    GreySettings_GreySettings.greyPullsLimit, " pulls. ").concat(
    (0,external_kolmafia_.pullsRemaining)(), " total pull").concat(
    (0,external_kolmafia_.pullsRemaining)() == 1 ? "" : "s", " remain.."),

    "blue");

  }

  (0,external_kolmafia_.print)(
  "Took " +
  (0,external_kolmafia_.turnsPlayed)() +
  " turns this run! " +
  (0,external_kolmafia_.myAdventures)() +
  " turns left to play with!",
  "blue");

  new GreyAbsorber_AbsorbsProvider().printRemainingAbsorbs();

  if (playerPulls.length > 0) {
    (0,external_kolmafia_.print)("Player pulled: ".concat(
    playerPulls.length, " items, ").concat(playerPulls.join(", ")));

  }

  (0,external_kolmafia_.print)("Greyday Pulls: " + pulls.map(function (i) {return i.name;}).join(", "), "gray");
}

function main() {var parameter = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";
  new GreyYouMain().handleCommand(parameter);
}
;// CONCATENATED MODULE: ./src/quests/council/tower/stages/QuestTowerKillWitch.ts
function QuestTowerKillWitch_typeof(obj) {"@babel/helpers - typeof";return QuestTowerKillWitch_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestTowerKillWitch_typeof(obj);}function QuestTowerKillWitch_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestTowerKillWitch_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestTowerKillWitch_toPropertyKey(descriptor.key), descriptor);}}function QuestTowerKillWitch_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestTowerKillWitch_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestTowerKillWitch_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestTowerKillWitch_defineProperty(obj, key, value) {key = QuestTowerKillWitch_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestTowerKillWitch_toPropertyKey(arg) {var key = QuestTowerKillWitch_toPrimitive(arg, "string");return QuestTowerKillWitch_typeof(key) === "symbol" ? key : String(key);}function QuestTowerKillWitch_toPrimitive(input, hint) {if (QuestTowerKillWitch_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestTowerKillWitch_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestTowerKillWitch = /*#__PURE__*/function () {function QuestTowerKillWitch() {QuestTowerKillWitch_classCallCheck(this, QuestTowerKillWitch);QuestTowerKillWitch_defineProperty(this, "seasoning",
    external_kolmafia_.Item.get("Special Seasoning"));}QuestTowerKillWitch_createClass(QuestTowerKillWitch, [{ key: "getId", value:

    function getId() {
      return "Council / Tower / NaughtyBoss";
    } }, { key: "level", value:

    function level() {
      return 13;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL13Final");

      if (status < 11) {
        return QuestStatus.NOT_READY;
      }

      if (status > 11) {
        return QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {
      return this.doBoss();
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "doBoss", value:

    function doBoss() {var _this = this;
      return {
        location: null,
        run: function run() {
          for (var i = 0; i < 2; i++) {
            try {
              greyAdv(
              "place.php?whichplace=nstower&action=ns_10_sorcfight",
              null,
              new AdventureSettings().setFinishingBlowMacro(
              Macro.attack().repeat()));


              (0,external_kolmafia_.visitUrl)("choice.php");
            } catch (e) {}
          }

          greyAdv("choice.php"); // Final fight
          (0,external_kolmafia_.visitUrl)("place.php?whichplace=nstower");

          if ((0,external_kolmafia_.closetAmount)(_this.seasoning) > 0) {
            (0,external_kolmafia_.takeCloset)(_this.seasoning, (0,external_kolmafia_.closetAmount)(_this.seasoning));
          }

          (0,external_kolmafia_.print)("Should be all done", "blue");

          printEndOfRun();
        }
      };
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestTowerKillWitch;}();
;// CONCATENATED MODULE: ./src/quests/council/tower/keys/QuestDigitalKey.ts
function QuestDigitalKey_typeof(obj) {"@babel/helpers - typeof";return QuestDigitalKey_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestDigitalKey_typeof(obj);}function QuestDigitalKey_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestDigitalKey_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestDigitalKey_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestDigitalKey_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestDigitalKey_arrayLikeToArray(o, minLen);}function QuestDigitalKey_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestDigitalKey_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestDigitalKey_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestDigitalKey_toPropertyKey(descriptor.key), descriptor);}}function QuestDigitalKey_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestDigitalKey_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestDigitalKey_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestDigitalKey_defineProperty(obj, key, value) {key = QuestDigitalKey_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestDigitalKey_toPropertyKey(arg) {var key = QuestDigitalKey_toPrimitive(arg, "string");return QuestDigitalKey_typeof(key) === "symbol" ? key : String(key);}function QuestDigitalKey_toPrimitive(input, hint) {if (QuestDigitalKey_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestDigitalKey_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}
















var PixelZones = [
{
  loc: external_kolmafia_.Location.get("Vanya's Castle"),
  color: "black",
  maximize: "Initiative",
  capped: 600
},
{
  loc: external_kolmafia_.Location.get("Megalo-City"),
  color: "blue",
  maximize: "Damage Absorption",
  capped: 600
},
{
  loc: external_kolmafia_.Location.get("Hero's Field"),
  color: "green",
  maximize: "Item Drop",
  capped: 400
},
{
  loc: external_kolmafia_.Location.get("The Fungus Plains"),
  color: "red",
  maximize: "Meat Drop",
  capped: 450
}];


var QuestDigitalKey = /*#__PURE__*/function () {function QuestDigitalKey() {QuestDigitalKey_classCallCheck(this, QuestDigitalKey);QuestDigitalKey_defineProperty(this, "transfomer",
    external_kolmafia_.Item.get("continuum transfunctioner"));QuestDigitalKey_defineProperty(this, "key",
    external_kolmafia_.Item.get("Digital key"));QuestDigitalKey_defineProperty(this, "currentZone", void 0);QuestDigitalKey_defineProperty(this, "favorZone", void 0);QuestDigitalKey_defineProperty(this, "zoneScore", void 0);QuestDigitalKey_defineProperty(this, "zoneCalcedAt",



    0);QuestDigitalKey_defineProperty(this, "totMeatItem",
    external_kolmafia_.Item.get("li'l pirate costume"));QuestDigitalKey_defineProperty(this, "totItemItem",
    external_kolmafia_.Item.get("li'l ninja costume"));QuestDigitalKey_defineProperty(this, "tot",
    external_kolmafia_.Familiar.get("Trick-or-Treating Tot"));QuestDigitalKey_defineProperty(this, "nanovision",
    external_kolmafia_.Skill.get("Double Nanovision"));}QuestDigitalKey_createClass(QuestDigitalKey, [{ key: "level", value:

    function level() {
      return 4;
    } }, { key: "getEstimatedScore", value:

    function getEstimatedScore(zone) {
      (0,external_kolmafia_.maximize)(
      zone.maximize + (
      zone.maximize == "Meat Drop" || zone.maximize == "Item Drop" ?
      " +switch Trick-or-Treating Tot -equip broken champagne bottle" :
      "") +
      " -tie",
      true);


      var score =
      Math.min(
      zone.capped,
      (0,external_kolmafia_.numericModifier)("Generated:_spec", zone.maximize) + (
      zone.maximize == "Item Drop" && (0,external_kolmafia_.haveSkill)(this.nanovision) ? 200 : 0)) - (

      zone.capped - 300);

      if (this.currentZone != zone) {
        // Not sure its been spaded how it rounds
        score = Math.round(score / 2);
      }

      return Math.max(0, score);
    } }, { key: "getAdventureZone", value:

    function getAdventureZone() {var _this = this;
      var currentBonusZone = this.currentBonusZone();

      if (
      currentBonusZone == this.currentZone &&
      this.zoneCalcedAt + 50 >= (0,external_kolmafia_.turnsPlayed)())
      {
        return this.favorZone;
      }

      this.currentZone = currentBonusZone;
      this.zoneCalcedAt = (0,external_kolmafia_.turnsPlayed)();

      var zones = new Map([
      [currentBonusZone, this.getEstimatedScore(currentBonusZone)]]);


      var sortedZones = [];

      if (zones.get(currentBonusZone) < 300) {
        for (var _i = 0, _PixelZones = PixelZones; _i < _PixelZones.length; _i++) {var zone = _PixelZones[_i];
          sortedZones.push(zone);

          if (zones.has(zone)) {
            continue;
          }

          zones.set(zone, this.getEstimatedScore(zone));
        }
      } else {
        sortedZones.push(currentBonusZone);
      }

      sortedZones.sort(function (z1, z2) {
        return zones.get(z2) - zones.get(z1);
      });

      this.favorZone = sortedZones[0];
      this.zoneScore = zones.get(this.favorZone);

      (0,external_kolmafia_.printHtml)("Pixel Realm Scores: ".concat(
      sortedZones.
      map(
      function (z) {return "<font color=".concat(
        z == _this.currentZone ? "purple" : "gray", ">").concat(
        z.loc + ": " + (100 + zones.get(z)), "</font>");}).


      join(", ")));


      return this.favorZone;
    } }, { key: "currentBonusZone", value:

    function currentBonusZone() {
      var color = (0,external_kolmafia_.getProperty)("8BitColor") || "black";

      return PixelZones.find(function (z) {return z.color == color;});
    } }, { key: "status", value:

    function status() {
      if (
      getQuestStatus("questL13Final") > 5 ||
      (0,external_kolmafia_.availableAmount)(this.key) > 0 ||
      (0,external_kolmafia_.getProperty)("nsTowerDoorKeysUsed").includes(this.key.name))
      {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.availableAmount)(this.transfomer) == 0) {
        return QuestStatus.READY;
      }

      var status = getQuestStatus("questL13Final");

      if (this.getViableDelayBurners().length > 0 && this.zoneScore >= 390) {
        return QuestStatus.READY;
      }

      if (status < 0) {
        return QuestStatus.FASTER_LATER;
      }

      if (status == 0) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "redeemKey", value:

    function redeemKey() {
      var outfit = new GreyOutfit().addWeight(this.transfomer);

      return {
        location: null,
        outfit: outfit,
        run: function run() {
          (0,external_kolmafia_.visitUrl)("place.php?whichplace=8bit&action=8treasure");
          (0,external_kolmafia_.visitUrl)("choice.php?forceoption=0");
          (0,external_kolmafia_.visitUrl)("choice.php?pwd&whichchoice=1493&option=1", true);
        }
      };
    } }, { key: "run", value:

    function run() {var _this2 = this;
      if ((0,external_kolmafia_.availableAmount)(this.transfomer) == 0) {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {
            (0,external_kolmafia_.visitUrl)("place.php?whichplace=forestvillage&action=fv_mystic");

            while ((0,external_kolmafia_.handlingChoice)()) {
              (0,external_kolmafia_.runChoice)(1);
            }
            (0,external_kolmafia_.print)("Grabbed " + _this2.transfomer, "gray");
          }
        };
      }

      if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("8BitScore")) >= 10000) {
        return this.redeemKey();
      }

      var zone = this.getAdventureZone();

      var outfit = new GreyOutfit();
      outfit.addWeight(this.transfomer);
      outfit.addWeight(
      zone.maximize,
      5,
      null,
      zone.capped - (
      zone.maximize == "Item Drop" && (0,external_kolmafia_.haveSkill)(this.nanovision) ? 200 : 0));


      if (zone.maximize == "Item Drop") {
        outfit.setItemDrops();
      }

      var delayers = this.getViableDelayBurners();

      if (delayers.length > 0) {var _iterator = QuestDigitalKey_createForOfIteratorHelper(
          delayers[0].getFightSetup()),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var item = _step.value;
            outfit.addWeight(item);
          }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
      }

      var fam = null;

      if (zone.maximize == "Item Drop" && (0,external_kolmafia_.availableAmount)(this.totItemItem) > 0) {
        outfit.addWeight(this.totItemItem);
        fam = this.tot;
      } else if (
      zone.maximize == "Meat Drop" &&
      (0,external_kolmafia_.availableAmount)(this.totMeatItem) > 0)
      {
        outfit.addWeight(this.totMeatItem);
        fam = this.tot;
      }

      return {
        location: zone.loc,
        outfit: outfit,
        familiar: fam,
        disableFamOverride: fam != null,
        run: function run() {
          if (fam == null && DelayBurners.isTryingForDupeableGoblin()) {
            (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Grey Goose"));
          }

          greyAdv(zone.loc, outfit);
        }
      };
    } }, { key: "getViableDelayBurners", value:

    function getViableDelayBurners() {
      var burners = DelayBurners.getCombatReplacers(
      DelayCriteria().withFreeFights(null).withForcedFights(null));


      if (this.getAdventureZone().maximize != "Meat Drop") {
        return burners;
      }

      // Remove monsters that don't drop meat
      return burners.filter(function (d) {
        if (d instanceof DelayBurningCursedMagnifyingGlass) {
          return false;
        }

        if (d instanceof DelayBurningVoter) {
          if ((0,external_kolmafia_.getProperty)("_voteMonster") == "") {
            return false;
          }

          return external_kolmafia_.Monster.get((0,external_kolmafia_.getProperty)("_voteMonster")).minMeat > 0;
        }

        return true;
      });
    } }, { key: "getId", value:

    function getId() {
      return "Council / Tower / Keys / Digital";
    } }, { key: "getLocations", value:

    function getLocations() {
      return PixelZones.map(function (z) {return z.loc;});
    } }]);return QuestDigitalKey;}();
;// CONCATENATED MODULE: ./src/quests/council/QuestL13Tower.ts
function QuestL13Tower_typeof(obj) {"@babel/helpers - typeof";return QuestL13Tower_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL13Tower_typeof(obj);}function QuestL13Tower_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL13Tower_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL13Tower_toPropertyKey(descriptor.key), descriptor);}}function QuestL13Tower_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL13Tower_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL13Tower_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL13Tower_defineProperty(obj, key, value) {key = QuestL13Tower_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL13Tower_toPropertyKey(arg) {var key = QuestL13Tower_toPrimitive(arg, "string");return QuestL13Tower_typeof(key) === "symbol" ? key : String(key);}function QuestL13Tower_toPrimitive(input, hint) {if (QuestL13Tower_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL13Tower_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}













var QuestL13 = /*#__PURE__*/function () {function QuestL13() {QuestL13Tower_classCallCheck(this, QuestL13);QuestL13Tower_defineProperty(this, "sideQuests",




    [
    new QuestDigitalKey(),
    new QuestTowerKeys(),
    new QuestTowerContestants(),
    new QuestTowerMaze(),
    new QuestTowerWallSkin(),
    new QuestTowerWallMeat(),
    new QuestTowerWallBones(),
    new QuestTowerMirror(),
    new QuestTowerShadow(),
    new QuestTowerKillWitch()]);}QuestL13Tower_createClass(QuestL13, [{ key: "getLocations", value: function getLocations() {return [];} }, { key: "getChildren", value:


    function getChildren() {
      return this.sideQuests;
    } }, { key: "getId", value:

    function getId() {
      return "Council / Tower / Parent";
    } }, { key: "level", value:

    function level() {
      return -1;
    } }, { key: "status", value:

    function status() {
      return QuestStatus.COMPLETED;

      // Unstarted = Obvious
      // started= We've visited the booth? Not sure whats up there.
      // Step1 = We're fighting the contestants
      // Step2 = We've defeated the contestants
      // Step3 = Just got sash
      // Step4 = We're going into the maze
      // Step4 = We're in the maze
      // Step5 = We left the maze
      // Step6 = We've used all our keys
      // Step7 = Just killed wall of skin
      // Step8 = Just killed wall of meat
      // Step9 = Just killed wall of bones
      // Step10 = Just killed the shadow
      // Step11 = Just shattered the mirror, or didn't
      // Step12 = We've advanced to the 3rd stage of the witch and if you see this, you lost and can now find the wand NC
      // Step13 = Just killed the witch
    } }, { key: "run", value:

    function run() {
      throw "Not supported";
    } }]);return QuestL13;}();
;// CONCATENATED MODULE: ./src/utils/GreyTrainset.ts



var TrainsetPiece;(function (TrainsetPiece) {TrainsetPiece["UNKNOWN"] = "";TrainsetPiece["EMPTY"] = "empty";TrainsetPiece["GAIN_MEAT"] = "meat_mine";TrainsetPiece["EFFECT_MP"] = "tower_fizzy";TrainsetPiece["GAIN_STATS"] = "viewing_platform";TrainsetPiece["HOT_RES_COLD_DMG"] = "tower_frozen";TrainsetPiece["STENCH_RES_SPOOKY_DMG"] = "spooky_graveyard";TrainsetPiece["SMUT_BRIDGE_OR_STATS"] = "logging_mill";TrainsetPiece["CANDY"] = "candy_factory";TrainsetPiece["DOUBLE_NEXT_STATION"] = "coal_hopper";TrainsetPiece["COLD_RES_STENCH_DMG"] = "tower_sewage";TrainsetPiece["SPOOKY_RES_SLEAZE_DMG"] = "oil_refinery";TrainsetPiece["SLEAZE_RES_HOT_DMG"] = "oil_bridge";TrainsetPiece["MORE_ML"] = "water_bridge";TrainsetPiece["MOXIE_STATS"] = "groin_silo";TrainsetPiece["RANDOM_BOOZE"] = "grain_silo";TrainsetPiece["MYS_STATS"] = "brain_silo";TrainsetPiece["MUS_STATS"] = "brawn_silo";TrainsetPiece["BUFF_FOOD_DROP"] = "prawn_silo";TrainsetPiece["DROP_LAST_FOOD_OR_RANDOM"] = "trackside_diner";TrainsetPiece["ORE"] = "ore_hopper";})(TrainsetPiece || (TrainsetPiece = {}));























var pieces = [
TrainsetPiece.EMPTY,
TrainsetPiece.GAIN_MEAT,
TrainsetPiece.EFFECT_MP,
TrainsetPiece.GAIN_STATS,
TrainsetPiece.HOT_RES_COLD_DMG,
TrainsetPiece.STENCH_RES_SPOOKY_DMG,
TrainsetPiece.SMUT_BRIDGE_OR_STATS,
TrainsetPiece.CANDY,
TrainsetPiece.DOUBLE_NEXT_STATION,
TrainsetPiece.COLD_RES_STENCH_DMG,
TrainsetPiece.UNKNOWN,
TrainsetPiece.SPOOKY_RES_SLEAZE_DMG,
TrainsetPiece.SLEAZE_RES_HOT_DMG,
TrainsetPiece.MORE_ML,
TrainsetPiece.MOXIE_STATS,
TrainsetPiece.RANDOM_BOOZE,
TrainsetPiece.MYS_STATS,
TrainsetPiece.MUS_STATS,
TrainsetPiece.BUFF_FOOD_DROP,
TrainsetPiece.DROP_LAST_FOOD_OR_RANDOM,
TrainsetPiece.ORE];


var trainsetEffects = new Map([
[TrainsetPiece.EFFECT_MP, external_kolmafia_.Effect.get("Carbonated")],
[TrainsetPiece.HOT_RES_COLD_DMG, external_kolmafia_.Effect.get("Frozen")],
[TrainsetPiece.STENCH_RES_SPOOKY_DMG, external_kolmafia_.Effect.get("Shivering Spine")],
[TrainsetPiece.COLD_RES_STENCH_DMG, external_kolmafia_.Effect.get("Hot Soupy Garbage")],
[TrainsetPiece.SLEAZE_RES_HOT_DMG, external_kolmafia_.Effect.get("Burningly Oiled")],
[TrainsetPiece.SPOOKY_RES_SLEAZE_DMG, external_kolmafia_.Effect.get("Spookily Greasy")],
[TrainsetPiece.MORE_ML, external_kolmafia_.Effect.get("Troubled Waters")],
[TrainsetPiece.BUFF_FOOD_DROP, external_kolmafia_.Effect.get("Craving Prawns")]]);

var trainsetEffectsDoubled = new Map([
[TrainsetPiece.EFFECT_MP, external_kolmafia_.Effect.get("Double Carbonated")],
[TrainsetPiece.HOT_RES_COLD_DMG, external_kolmafia_.Effect.get("Double Frozen")],
[TrainsetPiece.STENCH_RES_SPOOKY_DMG, external_kolmafia_.Effect.get("Doubly Shivering Spine")],
[TrainsetPiece.COLD_RES_STENCH_DMG, external_kolmafia_.Effect.get("Double Hot Soupy Garbage")],
[TrainsetPiece.SLEAZE_RES_HOT_DMG, external_kolmafia_.Effect.get("Doubly Burningly Oiled")],
[TrainsetPiece.SPOOKY_RES_SLEAZE_DMG, external_kolmafia_.Effect.get("Doubly Spookily Greasy")],
[TrainsetPiece.MORE_ML, external_kolmafia_.Effect.get("Doubly Troubled Waters")],
[TrainsetPiece.BUFF_FOOD_DROP, external_kolmafia_.Effect.get("Doubly Craving Prawns")]]);


var trainset = external_kolmafia_.Item.get("model train set");

function isTrainsetInUse() {
  if ((0,external_kolmafia_.getWorkshed)() == trainset) {
    return true;
  }

  if (
  (0,external_kolmafia_.getWorkshed)() != external_kolmafia_.Item.none ||
  GreySettings_GreySettings.greyDefaultWorkshed != "Model train set" ||
  (0,external_kolmafia_.itemAmount)(trainset) == 0)
  {
    return false;
  }

  return true;
}

function getTrainsetEffect(piece) {
  return trainsetEffects.get(piece);
}

function getDoubledTrainsetEffect(piece) {
  return trainsetEffectsDoubled.get(piece);
}

function isTrainsetPieceEffectActive(piece) {
  return (
    trainsetEffects.has(piece) &&
    haveEffect(trainsetEffects.get(piece)) > 0 ||
    trainsetEffectsDoubled.has(piece) &&
    haveEffect(trainsetEffectsDoubled.get(piece)) > 0);

}

function getPieceId(piece) {
  return Math.max(0, pieces.indexOf(piece));
}

function getTrainsetConfiguration() {
  return (0,external_kolmafia_.getProperty)("trainsetConfiguration").split(",");
}

function getTrainsetPositionsUntilConfigurable() {
  var pos = (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("trainsetPosition"));
  var configured = (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastTrainsetConfiguration"));
  var turnsSinceConfigured = pos - configured;

  return Math.max(0, 40 - turnsSinceConfigured);
}

function isTrainsetConfigurable() {
  return (
    (0,external_kolmafia_.getWorkshed)() == trainset && getTrainsetPositionsUntilConfigurable() <= 0);

}

/**
 * Where [0] is your next encounter, [1] is the one after, [7] is the one you just had
 */
function getTrainsetEncounters() {
  var pieces = getTrainsetConfiguration();
  var newPieces = [];
  var offset = toInt(getProperty("trainsetPosition")) % 8;

  for (var i = 0; i < 8; i++) {
    var newPos = (i + offset) % 8;

    newPieces[newPos] = pieces[i];
  }

  return newPieces;
}

var foodProperty = "lastFoodDropped";

function trackLastFood(page) {
  if (getWorkshed() != trainset) {
    if (getProperty(foodProperty) != "") {
      setProperty(foodProperty, "");
    }

    return;
  }

  if (page.includes("<b>Trackside Diner.</b>")) {
    if (getProperty(foodProperty) != "") {
      setProperty(foodProperty, "");
    }

    // Remove the part of the page that lists what food dropped
    page = page.substring(
    page.indexOf("</table>", page.indexOf("<b>Trackside Diner.</b>")));

  }

  if (!page.includes("<!--WINWINWIN-->")) {
    return;
  }

  var items = extractItems(page);
  var food = null;

  for (var _i = 0, _Object$keys = Object.keys(items); _i < _Object$keys.length; _i++) {var key = _Object$keys[_i];
    var item = Item.get(key);

    if (item.fullness <= 0) {
      continue;
    }

    food = item;
  }

  if (food == null) {
    return;
  }

  setProperty(foodProperty, toInt(food).toString());
}

function getTrainsetFoodQueued() {
  // TODO Returns the food that will drop when we hit diner
  if (!propertyExists(foodProperty)) {
    return null;
  }

  var prop = getProperty(foodProperty);

  if (prop == "") {
    return null;
  }

  return Item.get(toInt(prop));
}

function setTrainsetConfiguration(pieces) {
  (0,external_kolmafia_.visitUrl)("campground.php?action=workshed");

  var pieceIds = pieces.
  map(function (p) {return getPieceId(p);}).
  map(function (pieceId, index) {return "slot[".concat(index, "]=").concat(pieceId);});

  // whichchoice=1485&option=1&pwd=86af819be25f6ee16d9b3736e362ef2b&slot%5B0%5D=12&slot%5B1%5D=0&slot%5B2%5D=0&slot%5B3%5D=0&slot%5B4%5D=0&slot%5B5%5D=0&slot%5B6%5D=0&slot%5B7%5D=0
  // choice.php?forceoption=0&whichchoice=1485&option=1&pwd&slot[0]=0&slot[1]=0&slot[2]=0&slot[3]=0&slot[4]=0&slot[5]=0&slot[6]=0&slot[7]=0

  var url = "choice.php?forceoption=0&whichchoice=1485&option=1&pwd&".concat(pieceIds.join(
  "&"));


  (0,external_kolmafia_.visitUrl)(url, true);
  (0,external_kolmafia_.visitUrl)("main.php");

  var expected = pieces.join(",");

  if (expected != (0,external_kolmafia_.getProperty)("trainsetConfiguration")) {
    throw "Expected trainset configuration to have changed, expected \"".concat(expected, "\" but instead got ").concat((0,external_kolmafia_.getProperty)(
    "trainsetConfiguration"));

  }
}
;// CONCATENATED MODULE: ./src/quests/council/QuestL1Toot.ts
function QuestL1Toot_typeof(obj) {"@babel/helpers - typeof";return QuestL1Toot_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL1Toot_typeof(obj);}function QuestL1Toot_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL1Toot_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL1Toot_toPropertyKey(descriptor.key), descriptor);}}function QuestL1Toot_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL1Toot_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL1Toot_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL1Toot_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestL1Toot_setPrototypeOf(subClass, superClass);}function QuestL1Toot_setPrototypeOf(o, p) {QuestL1Toot_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestL1Toot_setPrototypeOf(o, p);}function QuestL1Toot_createSuper(Derived) {var hasNativeReflectConstruct = QuestL1Toot_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestL1Toot_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestL1Toot_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestL1Toot_possibleConstructorReturn(this, result);};}function QuestL1Toot_possibleConstructorReturn(self, call) {if (call && (QuestL1Toot_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestL1Toot_assertThisInitialized(self);}function QuestL1Toot_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestL1Toot_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestL1Toot_getPrototypeOf(o) {QuestL1Toot_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestL1Toot_getPrototypeOf(o);}function QuestL1Toot_defineProperty(obj, key, value) {key = QuestL1Toot_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL1Toot_toPropertyKey(arg) {var key = QuestL1Toot_toPrimitive(arg, "string");return QuestL1Toot_typeof(key) === "symbol" ? key : String(key);}function QuestL1Toot_toPrimitive(input, hint) {if (QuestL1Toot_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL1Toot_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}









var QuestL1Toot = /*#__PURE__*/function (_TaskInfo) {QuestL1Toot_inherits(QuestL1Toot, _TaskInfo);var _super = QuestL1Toot_createSuper(QuestL1Toot);function QuestL1Toot() {var _this;QuestL1Toot_classCallCheck(this, QuestL1Toot);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestL1Toot_defineProperty(QuestL1Toot_assertThisInitialized(_this), "purq",
    external_kolmafia_.Item.get("porquoise"));QuestL1Toot_defineProperty(QuestL1Toot_assertThisInitialized(_this), "bacon",
    external_kolmafia_.Item.get("baconstone"));QuestL1Toot_defineProperty(QuestL1Toot_assertThisInitialized(_this), "ham",
    external_kolmafia_.Item.get("hamethyst"));QuestL1Toot_defineProperty(QuestL1Toot_assertThisInitialized(_this), "loop",
    external_kolmafia_.Skill.get("Infinite Loop"));QuestL1Toot_defineProperty(QuestL1Toot_assertThisInitialized(_this), "sellGems", void 0);QuestL1Toot_defineProperty(QuestL1Toot_assertThisInitialized(_this), "paths", void 0);QuestL1Toot_defineProperty(QuestL1Toot_assertThisInitialized(_this), "boombox",



    external_kolmafia_.Item.get("SongBoom&trade; BoomBox"));QuestL1Toot_defineProperty(QuestL1Toot_assertThisInitialized(_this), "deck",
    external_kolmafia_.Item.get("Deck of Every Card"));QuestL1Toot_defineProperty(QuestL1Toot_assertThisInitialized(_this), "ring",
    external_kolmafia_.Item.get("Gold Wedding Ring"));QuestL1Toot_defineProperty(QuestL1Toot_assertThisInitialized(_this), "gold",
    external_kolmafia_.Item.get("1,970 Carat Gold"));QuestL1Toot_defineProperty(QuestL1Toot_assertThisInitialized(_this), "mickyCard",
    external_kolmafia_.Item.get("1952 Mickey Mantle card"));QuestL1Toot_defineProperty(QuestL1Toot_assertThisInitialized(_this), "autosells",
    [_this.ring, _this.gold, _this.mickyCard]);QuestL1Toot_defineProperty(QuestL1Toot_assertThisInitialized(_this), "letter",
    external_kolmafia_.Item.get("Letter from King Ralph XI"));QuestL1Toot_defineProperty(QuestL1Toot_assertThisInitialized(_this), "sack",
    external_kolmafia_.Item.get("pork elf goodies sack"));return _this;}QuestL1Toot_createClass(QuestL1Toot, [{ key: "level", value:

    function level() {
      return 1;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.getProperty)("questM05Toot") == "finished") {
        if ((0,external_kolmafia_.pullsRemaining)() == -1) {
          return QuestStatus.COMPLETED;
        }

        if ((0,external_kolmafia_.turnsPlayed)() > 50) {
          return QuestStatus.COMPLETED;
        }

        if (
        (0,external_kolmafia_.availableAmount)(this.letter) + (0,external_kolmafia_.availableAmount)(this.sack) == 0 && (
        (0,external_kolmafia_.myMeat)() >= 300 || (0,external_kolmafia_.haveSkill)(this.loop)))
        {
          return QuestStatus.COMPLETED;
        }
      }

      return QuestStatus.READY;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return true;
    } }, { key: "free", value:

    function free() {
      return true;
    } }, { key: "createPaths", value:

    function createPaths(assumeUnstarted) {
      this.paths = [];

      var hasEnoughMeat = false;

      if (isTrainsetInUse()) {
        hasEnoughMeat = true;
      }

      if (this.autosells.find(function (i) {return (0,external_kolmafia_.itemAmount)(i) > 0;})) {
        hasEnoughMeat = true;
      }

      if ((0,external_kolmafia_.myMeat)() >= 5000) {
        hasEnoughMeat = true;
      }

      if (
      (0,external_kolmafia_.toBoolean)((0,external_kolmafia_.getProperty)("hasMaydayContract")) &&
      (0,external_kolmafia_.availableAmount)(this.boombox) > 0)
      {
        hasEnoughMeat = true;
      }

      if (hasEnoughMeat) {
        this.paths.push(new PossiblePath(0));
        return;
      }

      if (assumeUnstarted || !(0,external_kolmafia_.getProperty)("_deckCardsSeen").includes("Mickey")) {
        this.paths.push(
        new PossiblePath(0).add(ResourceCategory.DECK_OF_EVERY_CARD_CHEAT));

      }

      if (!assumeUnstarted && GreySettings_GreySettings.isHardcoreMode()) {
        this.paths.push(this.sellGems = new PossiblePath(20));
      }

      if (
      assumeUnstarted && (0,external_kolmafia_.availableAmount)(this.ring) > 0 ||
      (0,external_kolmafia_.storageAmount)(this.ring) > 0)
      {
        this.paths.push(new PossiblePath(0).addPull(this.ring));
      }

      this.paths.push(new PossiblePath(0).addPull(this.gold).addMeat(10000));
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          if ((0,external_kolmafia_.availableAmount)(_this2.letter) == 0) {
            (0,external_kolmafia_.council)();
            (0,external_kolmafia_.visitUrl)("tutorial.php?action=toot");
          }

          if ((0,external_kolmafia_.availableAmount)(_this2.letter) > 0) {
            (0,external_kolmafia_.use)(_this2.letter);
          }

          if ((0,external_kolmafia_.availableAmount)(_this2.sack) > 0) {
            (0,external_kolmafia_.use)(_this2.sack);
          }

          if (path.canUse(ResourceCategory.PULL)) {
            GreyPulls.tryPull(path.pulls[0]);
          } else if (path === _this2.sellGems) {
            for (var _i = 0, _arr = [_this2.purq, _this2.bacon, _this2.ham]; _i < _arr.length; _i++) {var i = _arr[_i];
              if ((0,external_kolmafia_.availableAmount)(i) > 0) {
                (0,external_kolmafia_.autosell)(i, (0,external_kolmafia_.availableAmount)(i));
              }
            }
          } else if (path.canUse(ResourceCategory.DECK_OF_EVERY_CARD_CHEAT)) {
            path.
            getResource(ResourceCategory.DECK_OF_EVERY_CARD_CHEAT).
            pickCard("Mickey");

            if ((0,external_kolmafia_.availableAmount)(_this2.mickyCard) > 0) {
              path.addUsed(ResourceCategory.DECK_OF_EVERY_CARD_CHEAT);
              (0,external_kolmafia_.autosell)(_this2.mickyCard, 1);
            } else {
              throw "Expected to have sold a " + _this2.mickyCard;
            }
          }

          _this2.autosells.
          filter(function (i) {return (0,external_kolmafia_.itemAmount)(i) > 0;}).
          forEach(function (i) {return (0,external_kolmafia_.autosell)(i, (0,external_kolmafia_.itemAmount)(i));});

          // If we're poor, sell one of the gems for some starting meat
          if ((0,external_kolmafia_.myMeat)() < 500) {
            // Sell one of the gems, with purq last
            for (var _i2 = 0, _arr2 = [_this2.bacon, _this2.ham, _this2.purq]; _i2 < _arr2.length; _i2++) {var item = _arr2[_i2];
              if ((0,external_kolmafia_.itemAmount)(item) == 0) {
                continue;
              }

              (0,external_kolmafia_.autosell)(item, 1);
              break;
            }
          }

          (0,external_kolmafia_.council)();
        }
      };
    } }, { key: "getId", value:

    function getId() {
      return "Council / Toot";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }]);return QuestL1Toot;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/QuestL2Larva.ts
function QuestL2Larva_typeof(obj) {"@babel/helpers - typeof";return QuestL2Larva_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL2Larva_typeof(obj);}function QuestL2Larva_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL2Larva_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL2Larva_toPropertyKey(descriptor.key), descriptor);}}function QuestL2Larva_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL2Larva_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL2Larva_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL2Larva_defineProperty(obj, key, value) {key = QuestL2Larva_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL2Larva_toPropertyKey(arg) {var key = QuestL2Larva_toPrimitive(arg, "string");return QuestL2Larva_typeof(key) === "symbol" ? key : String(key);}function QuestL2Larva_toPrimitive(input, hint) {if (QuestL2Larva_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL2Larva_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}










var QuestL2SpookyLarva = /*#__PURE__*/function () {function QuestL2SpookyLarva() {QuestL2Larva_classCallCheck(this, QuestL2SpookyLarva);QuestL2Larva_defineProperty(this, "location",
    external_kolmafia_.Location.get("The Spooky Forest"));QuestL2Larva_defineProperty(this, "latte",
    external_kolmafia_.Item.get("Latte lovers member's mug"));QuestL2Larva_defineProperty(this, "headless",
    external_kolmafia_.Monster.get("The Headless Horseman"));QuestL2Larva_defineProperty(this, "toAbsorb", void 0);}QuestL2Larva_createClass(QuestL2SpookyLarva, [{ key: "shouldWearLatte", value:


    function shouldWearLatte() {
      return (
        (0,external_kolmafia_.availableAmount)(this.latte) > 0 &&
        !hasUnlockedLatteFlavor(LatteFlavor.FAMILIAR_WEIGHT));

    } }, { key: "level", value:

    function level() {
      return 2;
    } }, { key: "getId", value:

    function getId() {
      return "Council / Larva";
    } }, { key: "delayCriteria", value:

    function delayCriteria() {
      return DelayCriteria().withForcedFights(
      !this.isDelayBurning() ? false : null);

    } }, { key: "status", value:

    function status() {
      var status = (0,external_kolmafia_.getProperty)("questL02Larva");

      if (status == "finished") {
        return QuestStatus.COMPLETED;
      }

      if (isGhostBustingTime(this.location)) {
        if (shouldAvoidGhosts()) {
          return QuestStatus.NOT_READY;
        }
      } else if (this.isDelayBurning()) {
        if (DelayBurners.isDelayBurnerReady(this.delayCriteria())) {
          return QuestStatus.READY;
        }

        if (DelayBurners.isDelayBurnerFeasible(this.delayCriteria())) {
          return QuestStatus.FASTER_LATER;
        }
      } else if (
      this.location.turnsSpent >= 5 &&
      !hasNonCombatSkillsReady(false) &&
      (0,external_kolmafia_.myLevel)() >= 5)
      {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "isDelayBurning", value:

    function isDelayBurning() {
      return this.location.turnsSpent < 5 && this.toAbsorb.length == 0;
    } }, { key: "run", value:

    function run() {var _this = this;
      var ghostTime = isGhostBustingTime(this.location);

      var outfit = ghostTime ? getGhostBustingOutfit() : new GreyOutfit();

      if (this.shouldWearLatte()) {
        outfit.addWeight(this.latte);
      }

      if (this.location.turnsSpent >= 5) {
        outfit.setNoCombat();
      }

      if (!ghostTime && !this.shouldWearLatte() && this.toAbsorb.length == 0) {
        outfit.addDelayer(this.delayCriteria());
      }

      return {
        location: isGhostBustingTime(this.location) ? null : this.location,
        outfit: outfit,
        forcedFight: isGhostBustingTime(this.location) ?
        [0, this.headless] :
        null,
        freeRun: function freeRun() {return true;},
        run: function run() {
          var props = new Properties_PropertyManager();
          var settings = new AdventureSettings();

          props.setChoice(502, 2);
          props.setChoice(505, 1);

          if (isGhostBustingTime(_this.location)) {
            settings.setStartOfFightMacro(getGhostBustingMacro());
          }

          if (
          _this.toAbsorb.length == 0 &&
          DelayBurners.isTryingForDupeableGoblin())
          {
            (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Grey Goose"));
          }

          try {
            greyAdv(_this.location, outfit, settings);
          } finally {
            props.resetAll();
          }

          if ((0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("mosquito larva")) > 0) {
            (0,external_kolmafia_.council)();
          }
        }
      };
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return !this.mustBeDone();
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return isGhostBustingTime(this.location);
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.location];
    } }]);return QuestL2SpookyLarva;}();
;// CONCATENATED MODULE: ./src/quests/council/QuestL3Tavern.ts
function QuestL3Tavern_typeof(obj) {"@babel/helpers - typeof";return QuestL3Tavern_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL3Tavern_typeof(obj);}function QuestL3Tavern_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestL3Tavern_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestL3Tavern_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestL3Tavern_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestL3Tavern_arrayLikeToArray(o, minLen);}function QuestL3Tavern_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestL3Tavern_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL3Tavern_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL3Tavern_toPropertyKey(descriptor.key), descriptor);}}function QuestL3Tavern_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL3Tavern_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL3Tavern_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL3Tavern_defineProperty(obj, key, value) {key = QuestL3Tavern_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL3Tavern_toPropertyKey(arg) {var key = QuestL3Tavern_toPrimitive(arg, "string");return QuestL3Tavern_typeof(key) === "symbol" ? key : String(key);}function QuestL3Tavern_toPrimitive(input, hint) {if (QuestL3Tavern_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL3Tavern_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var QuestL3Tavern = /*#__PURE__*/function () {function QuestL3Tavern() {QuestL3Tavern_classCallCheck(this, QuestL3Tavern);QuestL3Tavern_defineProperty(this, "layout",
    new TavernLayout());QuestL3Tavern_defineProperty(this, "location",
    external_kolmafia_.Location.get("The Typical Tavern Cellar"));QuestL3Tavern_defineProperty(this, "tangle",
    external_kolmafia_.Item.get("tangle of rat tails"));QuestL3Tavern_defineProperty(this, "teleportis",
    external_kolmafia_.Effect.get("Teleportitis"));QuestL3Tavern_defineProperty(this, "umbrella",
    external_kolmafia_.Item.get("Unbreakable Umbrella"));QuestL3Tavern_defineProperty(this, "king",
    external_kolmafia_.Monster.get("Drunken Rat King"));}QuestL3Tavern_createClass(QuestL3Tavern, [{ key: "level", value:

    function level() {
      return 3;
    } }, { key: "getId", value:

    function getId() {
      return "Council / Tavern";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.location];
    } }, { key: "status", value:

    function status() {
      var status = (0,external_kolmafia_.getProperty)("questL03Rat");

      if (status == "finished") {
        return QuestStatus.COMPLETED;
      }

      if (
      (0,external_kolmafia_.getProperty)("questL02Larva") != "finished" ||
      (0,external_kolmafia_.myLevel)() < 13 && (0,external_kolmafia_.haveEffect)(this.teleportis) == 0)
      {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.myLevel)() < 18) {
        return QuestStatus.FASTER_LATER;
      }

      if ((0,external_kolmafia_.getProperty)("middleChamberUnlock") == "true") {
        return QuestStatus.READY;
      }

      // Always put this off as long as possible, aka until every quest wants to delay
      return QuestStatus.READY;
    } }, { key: "free", value:

    function free() {
      return getQuestStatus("questL03Rat") > 1;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      if (getQuestStatus("questL03Rat") > 1) {
        return true;
      }

      if (
      (0,external_kolmafia_.haveEffect)(this.teleportis) == 0 ||
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastPlusSignUnlock")) != (0,external_kolmafia_.myAscensions)())
      {
        return false;
      }

      return true;
    } }, { key: "run", value:

    function run() {var _this = this;
      var advTime = getQuestStatus("questL03Rat") == 1;

      var outfit;

      if (!advTime) {
        outfit = GreyOutfit.IGNORE_OUTFIT;
      } else {
        outfit = new GreyOutfit();

        if ((0,external_kolmafia_.getProperty)("pyramidBombUsed") != "true") {
          outfit.setPlusCombat();
          outfit.umbrellaSetting = UmbrellaState.MONSTER_LEVEL;
          outfit.addWeight("ML", 10);
          outfit.addExtra("-offhand");

          // Boost our damage
          if ((0,external_kolmafia_.myLevel)() < 16) {
            outfit.addWeight("mox");
          }
        } else {
          outfit.setNoCombat();
          outfit.
          addWeight("hot dmg").
          addWeight("hot spell dmg").
          addWeight("cold dmg").
          addWeight("cold spell dmg").
          addWeight("spooky dmg").
          addWeight("spooky spell dmg").
          addWeight("stench dmg").
          addWeight("stench spell dmg");
        }
      }

      return {
        location: this.location,
        outfit: outfit,
        freeRun: function freeRun(monster) {return monster != _this.king;},
        run: function run() {
          if (!advTime) {
            (0,external_kolmafia_.visitUrl)("tavern.php?place=barkeep");
            (0,external_kolmafia_.visitUrl)("cellar.php");
            (0,external_kolmafia_.council)();
            return;
          }

          var props = new Properties_PropertyManager();
          var eles = [
          ["Cold", 513],
          ["Hot", 496],
          ["Spooky", 515],
          ["Stench", 514]];


          for (var _i = 0, _eles = eles; _i < _eles.length; _i++) {var e = _eles[_i];
            var choice = (0,external_kolmafia_.numericModifier)(e[0] + " Damage") >= 20 ? 2 : 1;

            props.setChoice(e[1], choice);
          }

          props.setChoice(509, 1);
          props.setChoice(510, 1);

          try {
            if (
            outfit.umbrellaSetting == UmbrellaState.MONSTER_LEVEL &&
            (0,external_kolmafia_.availableAmount)(_this.umbrella) > 0)
            {
              setUmbrella(UmbrellaState.MONSTER_LEVEL);
              (0,external_kolmafia_.equip)(_this.umbrella);
            }

            var layout = (0,external_kolmafia_.getProperty)("tavernLayout");
            var turns = (0,external_kolmafia_.turnsPlayed)();

            (0,external_kolmafia_.changeMcd)(10);
            greyAdv(_this.layout.getLocation(), outfit);
            (0,external_kolmafia_.changeMcd)(0);

            if (getQuestStatus("questL03Rat") != 1 && (0,external_kolmafia_.turnsPlayed)() == turns) {
              (0,external_kolmafia_.visitUrl)("cellar.php");

              if (layout == (0,external_kolmafia_.getProperty)("tavernLayout")) {
                (0,external_kolmafia_.print)(
                "Something went wrong with Tavern, resetting the layout. You may see a bunch of attempts to adventure that do nothing.",
                "blue");

                (0,external_kolmafia_.setProperty)("tavernLayout", "0000000000000000000000000");
              }
            }
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestL3Tavern;}();var


TavernLayout = /*#__PURE__*/function () {function TavernLayout() {QuestL3Tavern_classCallCheck(this, TavernLayout);QuestL3Tavern_defineProperty(this, "locations",
    [3, 2, 1, 0, 5, 10, 15, 20, 16, 21]);}QuestL3Tavern_createClass(TavernLayout, [{ key: "getLocation", value:

    function getLocation() {
      var prop = (0,external_kolmafia_.getProperty)("tavernLayout");

      if (prop == "0000000000000000000000000") {
        (0,external_kolmafia_.visitUrl)("cellar.php");
      }var _iterator = QuestL3Tavern_createForOfIteratorHelper(

        this.locations),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var i = _step.value;
          if (prop.charAt(i) != "0") {
            continue;
          }

          return "cellar.php?action=explore&whichspot=" + (i + 1);
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
    } }]);return TavernLayout;}();
;// CONCATENATED MODULE: ./src/quests/council/bats/QuestL4BatsBoss.ts
function QuestL4BatsBoss_typeof(obj) {"@babel/helpers - typeof";return QuestL4BatsBoss_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL4BatsBoss_typeof(obj);}function QuestL4BatsBoss_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL4BatsBoss_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL4BatsBoss_toPropertyKey(descriptor.key), descriptor);}}function QuestL4BatsBoss_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL4BatsBoss_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL4BatsBoss_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL4BatsBoss_defineProperty(obj, key, value) {key = QuestL4BatsBoss_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL4BatsBoss_toPropertyKey(arg) {var key = QuestL4BatsBoss_toPrimitive(arg, "string");return QuestL4BatsBoss_typeof(key) === "symbol" ? key : String(key);}function QuestL4BatsBoss_toPrimitive(input, hint) {if (QuestL4BatsBoss_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL4BatsBoss_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestL4BatsBoss = /*#__PURE__*/function () {function QuestL4BatsBoss() {QuestL4BatsBoss_classCallCheck(this, QuestL4BatsBoss);QuestL4BatsBoss_defineProperty(this, "loc",
    external_kolmafia_.Location.get("The Boss Bat's Lair"));QuestL4BatsBoss_defineProperty(this, "camera",
    external_kolmafia_.Item.get("Backup Camera"));QuestL4BatsBoss_defineProperty(this, "guard",
    external_kolmafia_.Monster.get("Beefy bodyguard bat"));}QuestL4BatsBoss_createClass(QuestL4BatsBoss, [{ key: "getId", value:

    function getId() {
      return "Council / Bats / Boss";
    } }, { key: "level", value:

    function level() {
      return 4;
    } }, { key: "shouldWaitForLobsters", value:

    function shouldWaitForLobsters() {
      return (
        (0,external_kolmafia_.getProperty)("sidequestLighthouseCompleted") == "none" &&
        (0,external_kolmafia_.availableAmount)(this.camera) > 0 &&
        getBackupsRemaining() > 0);

    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL04Bat");

      if (status < 3 || this.shouldWaitForLobsters()) {
        return QuestStatus.NOT_READY;
      }

      if (status == 100) {
        return QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();
      outfit.meatDropWeight = 2;
      outfit.addWeight("Stench Res", 100, 1, 1);

      return {
        location: this.loc,
        outfit: outfit,
        freeRun: function freeRun(monster) {return (0,external_kolmafia_.myMeat)() > 5000 && monster == _this.guard;},
        run: function run() {
          greyAdv(_this.loc, outfit);

          if ((0,external_kolmafia_.haveSkill)(external_kolmafia_.Skill.get("Grey Noise"))) {
            (0,external_kolmafia_.council)();
          }
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }]);return QuestL4BatsBoss;}();
;// CONCATENATED MODULE: ./src/quests/council/bats/QuestL4BatsCenter.ts
function QuestL4BatsCenter_typeof(obj) {"@babel/helpers - typeof";return QuestL4BatsCenter_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL4BatsCenter_typeof(obj);}function QuestL4BatsCenter_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL4BatsCenter_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL4BatsCenter_toPropertyKey(descriptor.key), descriptor);}}function QuestL4BatsCenter_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL4BatsCenter_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL4BatsCenter_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL4BatsCenter_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestL4BatsCenter_setPrototypeOf(subClass, superClass);}function QuestL4BatsCenter_setPrototypeOf(o, p) {QuestL4BatsCenter_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestL4BatsCenter_setPrototypeOf(o, p);}function QuestL4BatsCenter_createSuper(Derived) {var hasNativeReflectConstruct = QuestL4BatsCenter_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestL4BatsCenter_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestL4BatsCenter_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestL4BatsCenter_possibleConstructorReturn(this, result);};}function QuestL4BatsCenter_possibleConstructorReturn(self, call) {if (call && (QuestL4BatsCenter_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestL4BatsCenter_assertThisInitialized(self);}function QuestL4BatsCenter_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestL4BatsCenter_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestL4BatsCenter_getPrototypeOf(o) {QuestL4BatsCenter_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestL4BatsCenter_getPrototypeOf(o);}function QuestL4BatsCenter_defineProperty(obj, key, value) {key = QuestL4BatsCenter_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL4BatsCenter_toPropertyKey(arg) {var key = QuestL4BatsCenter_toPrimitive(arg, "string");return QuestL4BatsCenter_typeof(key) === "symbol" ? key : String(key);}function QuestL4BatsCenter_toPrimitive(input, hint) {if (QuestL4BatsCenter_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL4BatsCenter_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var QuestL4BatsCenter = /*#__PURE__*/function (_TaskInfo) {QuestL4BatsCenter_inherits(QuestL4BatsCenter, _TaskInfo);var _super = QuestL4BatsCenter_createSuper(QuestL4BatsCenter);function QuestL4BatsCenter() {var _this;QuestL4BatsCenter_classCallCheck(this, QuestL4BatsCenter);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestL4BatsCenter_defineProperty(QuestL4BatsCenter_assertThisInitialized(_this), "loc",
    external_kolmafia_.Location.get("Guano Junction"));QuestL4BatsCenter_defineProperty(QuestL4BatsCenter_assertThisInitialized(_this), "sonar",
    external_kolmafia_.Item.get("sonar-in-a-biscuit"));QuestL4BatsCenter_defineProperty(QuestL4BatsCenter_assertThisInitialized(_this), "goose",
    external_kolmafia_.Familiar.get("Grey Goose"));QuestL4BatsCenter_defineProperty(QuestL4BatsCenter_assertThisInitialized(_this), "paths",
    []);QuestL4BatsCenter_defineProperty(QuestL4BatsCenter_assertThisInitialized(_this), "vampBat",
    external_kolmafia_.Monster.get("vampire bat"));QuestL4BatsCenter_defineProperty(QuestL4BatsCenter_assertThisInitialized(_this), "hasStenchRes",
    false);QuestL4BatsCenter_defineProperty(QuestL4BatsCenter_assertThisInitialized(_this), "lastStenchCheck", void 0);return _this;}QuestL4BatsCenter_createClass(QuestL4BatsCenter, [{ key: "createPaths", value:


    function createPaths(assumeUnstarted) {
      this.paths = [];

      this.paths.push(new PossiblePath(3, Math.max(3, 8 - this.loc.turnsSpent)));

      if (
      assumeUnstarted ||
      (0,external_kolmafia_.getProperty)("fireExtinguisherBatHoleUsed") != "true")
      {
        this.paths.push(
        new PossiblePath(1).add(ResourceCategory.FIRE_EXTINGUSHER_ZONE));

      }
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "getId", value:

    function getId() {
      return "Council / Bats / UnlockLeft";
    } }, { key: "level", value:

    function level() {
      return 4;
    } }, { key: "status", value:

    function status(path) {
      var status = getQuestStatus("questL04Bat");

      if (status < 0 || path == null) {
        return QuestStatus.NOT_READY;
      }

      if (status > 0) {
        return QuestStatus.COMPLETED;
      }

      if (!this.hasStenchRes) {
        if (
        this.lastStenchCheck == null ||
        this.lastStenchCheck + 10 < (0,external_kolmafia_.turnsPlayed)())
        {
          this.lastStenchCheck = (0,external_kolmafia_.turnsPlayed)();

          var maximizerString = "stench res -tie";

          if (path.canUse(ResourceCategory.FIRE_EXTINGUSHER_ZONE)) {
            maximizerString += " +equip industrial fire extinguisher";
          }

          (0,external_kolmafia_.maximize)(maximizerString, true);

          this.hasStenchRes =
          (0,external_kolmafia_.numericModifier)("Generated:_spec", "Stench Resistance") -
          Object.keys((0,external_kolmafia_.myEffects)()).
          map(function (e) {return (0,external_kolmafia_.numericModifier)(external_kolmafia_.Effect.get(e), "Stench Resistance");}).
          reduce(function (r1, r2) {return r1 + r2;}, 0) >
          0;
        }

        if (!this.hasStenchRes) {
          return QuestStatus.NOT_READY;
        }
      }

      if ((0,external_kolmafia_.familiarWeight)(this.goose) >= 6) {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      var outfit = new GreyOutfit();

      var resource = path.getResource(ResourceCategory.FIRE_EXTINGUSHER_ZONE);

      if (resource != null) {
        resource.prepare(outfit);
      } else {
        outfit.setItemDrops();
      }

      outfit.addWeight("Stench Res", 100, 1, 1);

      return {
        outfit: outfit,
        location: this.loc,
        run: function run() {
          var settings = new AdventureSettings();

          if (resource != null) {
            settings.setStartOfFightMacro(
            resource.macro().trySkill(external_kolmafia_.Skill.get("Infinite Loop")).attack());

          }

          greyAdv(_this2.loc, outfit, settings);

          _this2.doSonars();
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }, { key: "doSonars", value:

    function doSonars() {
      while (
      (0,external_kolmafia_.availableAmount)(this.sonar) > 0 &&
      getQuestStatus("questL04Bat") < 3)
      {
        (0,external_kolmafia_.use)(this.sonar);
      }
    } }]);return QuestL4BatsCenter;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/bats/QuestL4BatsLeft.ts
function QuestL4BatsLeft_typeof(obj) {"@babel/helpers - typeof";return QuestL4BatsLeft_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL4BatsLeft_typeof(obj);}function QuestL4BatsLeft_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL4BatsLeft_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL4BatsLeft_toPropertyKey(descriptor.key), descriptor);}}function QuestL4BatsLeft_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL4BatsLeft_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL4BatsLeft_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL4BatsLeft_defineProperty(obj, key, value) {key = QuestL4BatsLeft_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL4BatsLeft_toPropertyKey(arg) {var key = QuestL4BatsLeft_toPrimitive(arg, "string");return QuestL4BatsLeft_typeof(key) === "symbol" ? key : String(key);}function QuestL4BatsLeft_toPrimitive(input, hint) {if (QuestL4BatsLeft_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL4BatsLeft_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}





var QuestL4BatsLeft = /*#__PURE__*/function () {function QuestL4BatsLeft() {QuestL4BatsLeft_classCallCheck(this, QuestL4BatsLeft);QuestL4BatsLeft_defineProperty(this, "location",
    external_kolmafia_.Location.get("The Batrat and Ratbat Burrow"));}QuestL4BatsLeft_createClass(QuestL4BatsLeft, [{ key: "getId", value:

    function getId() {
      return "Council / Bats / UnlockRight";
    } }, { key: "level", value:

    function level() {
      return 4;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL04Bat");

      // If right has been unlocked
      if (status > 1) {
        return QuestStatus.COMPLETED;
      }

      if (status < 1) {
        return QuestStatus.NOT_READY;
      }

      var statusShen = getQuestStatus("questL11Shen");

      if (statusShen <= 1) {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      return {
        outfit: new GreyOutfit().addWeight("Stench Res", 100, 1, 1),
        location: this.location,
        run: function run() {
          greyAdv(_this.location);
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.location];
    } }]);return QuestL4BatsLeft;}();
;// CONCATENATED MODULE: ./src/quests/council/bats/QuestL4BatsRight.ts
function QuestL4BatsRight_typeof(obj) {"@babel/helpers - typeof";return QuestL4BatsRight_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL4BatsRight_typeof(obj);}function QuestL4BatsRight_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL4BatsRight_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL4BatsRight_toPropertyKey(descriptor.key), descriptor);}}function QuestL4BatsRight_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL4BatsRight_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL4BatsRight_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL4BatsRight_defineProperty(obj, key, value) {key = QuestL4BatsRight_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL4BatsRight_toPropertyKey(arg) {var key = QuestL4BatsRight_toPrimitive(arg, "string");return QuestL4BatsRight_typeof(key) === "symbol" ? key : String(key);}function QuestL4BatsRight_toPrimitive(input, hint) {if (QuestL4BatsRight_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL4BatsRight_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestL4BatsRight = /*#__PURE__*/function () {function QuestL4BatsRight() {QuestL4BatsRight_classCallCheck(this, QuestL4BatsRight);QuestL4BatsRight_defineProperty(this, "loc",
    external_kolmafia_.Location.get("The Beanbat Chamber"));QuestL4BatsRight_defineProperty(this, "bean",
    external_kolmafia_.Item.get("Enchanted Bean"));QuestL4BatsRight_defineProperty(this, "monster",
    external_kolmafia_.Monster.get("beanbat"));QuestL4BatsRight_defineProperty(this, "toAbsorb", void 0);}QuestL4BatsRight_createClass(QuestL4BatsRight, [{ key: "getId", value:


    function getId() {
      return "Council / Bats / UnlockBoss";
    } }, { key: "level", value:

    function level() {
      return 4;
    } }, { key: "needsBean", value:

    function needsBean() {
      return (
        (0,external_kolmafia_.availableAmount)(this.bean) == 0 && getQuestStatus("questL10Garbage") <= 0);

    } }, { key: "status", value:

    function status() {
      if (getQuestStatus("questL04Bat") > 2 && !this.needsBean()) {
        return QuestStatus.COMPLETED;
      }

      if (getQuestStatus("questL04Bat") < 2) {
        return QuestStatus.NOT_READY;
      }

      if (
      this.toAbsorb.length == 0 &&
      (0,external_kolmafia_.getProperty)("autumnatonQuestLocation") == this.loc.toString() &&
      currentPredictions().get(this.loc) != this.monster)
      {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit().setItemDrops();
      outfit.addWeight("Stench Res", 100, 1, 1);

      return {
        location: this.loc,
        outfit: outfit,
        orbs: this.needsBean() ? [this.monster] : null,
        mayFreeRun: getQuestStatus("questL04Bat") > 2,
        freeRun: function freeRun(monster) {return (
            getQuestStatus("questL04Bat") > 2 && (
            monster != _this.monster || !_this.needsBean()));},
        run: function run() {
          greyAdv(_this.loc, outfit);
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }]);return QuestL4BatsRight;}();
;// CONCATENATED MODULE: ./src/quests/council/QuestL4Bats.ts
function QuestL4Bats_typeof(obj) {"@babel/helpers - typeof";return QuestL4Bats_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL4Bats_typeof(obj);}function QuestL4Bats_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL4Bats_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL4Bats_toPropertyKey(descriptor.key), descriptor);}}function QuestL4Bats_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL4Bats_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL4Bats_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL4Bats_defineProperty(obj, key, value) {key = QuestL4Bats_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL4Bats_toPropertyKey(arg) {var key = QuestL4Bats_toPrimitive(arg, "string");return QuestL4Bats_typeof(key) === "symbol" ? key : String(key);}function QuestL4Bats_toPrimitive(input, hint) {if (QuestL4Bats_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL4Bats_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}








var QuestL4Bats = /*#__PURE__*/function () {



  function QuestL4Bats() {QuestL4Bats_classCallCheck(this, QuestL4Bats);QuestL4Bats_defineProperty(this, "sonar", external_kolmafia_.Item.get("sonar-in-a-biscuit"));QuestL4Bats_defineProperty(this, "children", []);
    this.children.push(new QuestL4BatsCenter());
    this.children.push(new QuestL4BatsLeft());
    this.children.push(new QuestL4BatsRight());
    this.children.push(new QuestL4BatsBoss());
  }QuestL4Bats_createClass(QuestL4Bats, [{ key: "getChildren", value:

    function getChildren() {
      return this.children;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "level", value:

    function level() {
      return 4;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return true;
    } }, { key: "free", value:

    function free() {
      return true;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL04Bat");

      if (status >= 3) {
        return QuestStatus.COMPLETED;
      }

      if (status < 0 || (0,external_kolmafia_.availableAmount)(this.sonar) == 0) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          while (
          (0,external_kolmafia_.availableAmount)(_this.sonar) > 0 &&
          getQuestStatus("questL04Bat") < 3)
          {
            (0,external_kolmafia_.use)(_this.sonar);
          }
        }
      };
    } }, { key: "getId", value:

    function getId() {
      return "Council / Bats / Sonars";
    } }]);return QuestL4Bats;}();
;// CONCATENATED MODULE: ./src/quests/council/goblins/QuestL5GoblinOutskirts.ts
function QuestL5GoblinOutskirts_typeof(obj) {"@babel/helpers - typeof";return QuestL5GoblinOutskirts_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL5GoblinOutskirts_typeof(obj);}function QuestL5GoblinOutskirts_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL5GoblinOutskirts_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL5GoblinOutskirts_toPropertyKey(descriptor.key), descriptor);}}function QuestL5GoblinOutskirts_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL5GoblinOutskirts_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL5GoblinOutskirts_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL5GoblinOutskirts_defineProperty(obj, key, value) {key = QuestL5GoblinOutskirts_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL5GoblinOutskirts_toPropertyKey(arg) {var key = QuestL5GoblinOutskirts_toPrimitive(arg, "string");return QuestL5GoblinOutskirts_typeof(key) === "symbol" ? key : String(key);}function QuestL5GoblinOutskirts_toPrimitive(input, hint) {if (QuestL5GoblinOutskirts_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL5GoblinOutskirts_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var QuestL5GoblinOutskirts = /*#__PURE__*/function () {function QuestL5GoblinOutskirts() {QuestL5GoblinOutskirts_classCallCheck(this, QuestL5GoblinOutskirts);QuestL5GoblinOutskirts_defineProperty(this, "map",
    external_kolmafia_.Item.get("Cobb's Knob map"));QuestL5GoblinOutskirts_defineProperty(this, "key",
    external_kolmafia_.Item.get("knob goblin encryption key"));QuestL5GoblinOutskirts_defineProperty(this, "location",
    external_kolmafia_.Location.get("the outskirts of cobb's knob"));}QuestL5GoblinOutskirts_createClass(QuestL5GoblinOutskirts, [{ key: "getId", value:

    function getId() {
      return "Council / Goblins / Outskirts";
    } }, { key: "level", value:

    function level() {
      return this.location.turnsSpent < 10 ? 4 : 5;
    } }, { key: "mustBeDone", value:

    function mustBeDone(reallyMustBeDone) {
      return (
        getQuestStatus("questL05Goblin") == 0 &&
        (0,external_kolmafia_.itemAmount)(this.map) > 0 &&
        (0,external_kolmafia_.itemAmount)(this.key) > 0);

    } }, { key: "free", value:

    function free() {
      return this.mustBeDone();
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return true;
    } }, { key: "delayCriteria", value:

    function delayCriteria() {
      return DelayCriteria().withForcedFights(
      this.location.turnsSpent >= 10 ? false : null);

    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL05Goblin");

      if (status > 0) {
        return QuestStatus.COMPLETED;
      }

      if (status < 0) {
        return QuestStatus.NOT_READY;
      }

      if (this.location.turnsSpent < 10) {
        if (DelayBurners.isDelayBurnerReady(this.delayCriteria())) {
          return QuestStatus.READY;
        }

        if (DelayBurners.isDelayBurnerFeasible(this.delayCriteria())) {
          return QuestStatus.FASTER_LATER;
        }
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();

      if (this.location.turnsSpent < 10) {
        outfit.addDelayer(this.delayCriteria());
      }

      return {
        location: this.location,
        freeRun: function freeRun() {return true;},
        outfit: outfit,
        run: function run() {
          if ((0,external_kolmafia_.availableAmount)(_this.map) > 0 && (0,external_kolmafia_.availableAmount)(_this.key)) {
            (0,external_kolmafia_.use)(_this.map);
          } else {
            var props = new Properties_PropertyManager();
            props.setChoice(113, 2);
            props.setChoice(111, 3);
            props.setChoice(118, 2);

            if (DelayBurners.isTryingForDupeableGoblin()) {
              (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Grey Goose"));
            }

            try {
              greyAdv(_this.location, outfit);
            } finally {
              props.resetAll();
            }
          }
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.location];
    } }]);return QuestL5GoblinOutskirts;}();
;// CONCATENATED MODULE: ./src/quests/council/goblins/QuestL5GoblinHarem.ts
function QuestL5GoblinHarem_typeof(obj) {"@babel/helpers - typeof";return QuestL5GoblinHarem_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL5GoblinHarem_typeof(obj);}function QuestL5GoblinHarem_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestL5GoblinHarem_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestL5GoblinHarem_toConsumableArray(arr) {return QuestL5GoblinHarem_arrayWithoutHoles(arr) || QuestL5GoblinHarem_iterableToArray(arr) || QuestL5GoblinHarem_unsupportedIterableToArray(arr) || QuestL5GoblinHarem_nonIterableSpread();}function QuestL5GoblinHarem_nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function QuestL5GoblinHarem_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestL5GoblinHarem_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestL5GoblinHarem_arrayLikeToArray(o, minLen);}function QuestL5GoblinHarem_iterableToArray(iter) {if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);}function QuestL5GoblinHarem_arrayWithoutHoles(arr) {if (Array.isArray(arr)) return QuestL5GoblinHarem_arrayLikeToArray(arr);}function QuestL5GoblinHarem_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestL5GoblinHarem_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL5GoblinHarem_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL5GoblinHarem_toPropertyKey(descriptor.key), descriptor);}}function QuestL5GoblinHarem_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL5GoblinHarem_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL5GoblinHarem_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL5GoblinHarem_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestL5GoblinHarem_setPrototypeOf(subClass, superClass);}function QuestL5GoblinHarem_setPrototypeOf(o, p) {QuestL5GoblinHarem_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestL5GoblinHarem_setPrototypeOf(o, p);}function QuestL5GoblinHarem_createSuper(Derived) {var hasNativeReflectConstruct = QuestL5GoblinHarem_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestL5GoblinHarem_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestL5GoblinHarem_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestL5GoblinHarem_possibleConstructorReturn(this, result);};}function QuestL5GoblinHarem_possibleConstructorReturn(self, call) {if (call && (QuestL5GoblinHarem_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestL5GoblinHarem_assertThisInitialized(self);}function QuestL5GoblinHarem_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestL5GoblinHarem_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestL5GoblinHarem_getPrototypeOf(o) {QuestL5GoblinHarem_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestL5GoblinHarem_getPrototypeOf(o);}function QuestL5GoblinHarem_defineProperty(obj, key, value) {key = QuestL5GoblinHarem_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL5GoblinHarem_toPropertyKey(arg) {var key = QuestL5GoblinHarem_toPrimitive(arg, "string");return QuestL5GoblinHarem_typeof(key) === "symbol" ? key : String(key);}function QuestL5GoblinHarem_toPrimitive(input, hint) {if (QuestL5GoblinHarem_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL5GoblinHarem_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}










var QuestL5GoblinHarem = /*#__PURE__*/function (_TaskInfo) {QuestL5GoblinHarem_inherits(QuestL5GoblinHarem, _TaskInfo);var _super = QuestL5GoblinHarem_createSuper(QuestL5GoblinHarem);function QuestL5GoblinHarem() {var _this;QuestL5GoblinHarem_classCallCheck(this, QuestL5GoblinHarem);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestL5GoblinHarem_defineProperty(QuestL5GoblinHarem_assertThisInitialized(_this), "harem",
    external_kolmafia_.Location.get("Cobb's Knob Harem"));QuestL5GoblinHarem_defineProperty(QuestL5GoblinHarem_assertThisInitialized(_this), "toAbsorb", void 0);QuestL5GoblinHarem_defineProperty(QuestL5GoblinHarem_assertThisInitialized(_this), "haremGirl",


    external_kolmafia_.Monster.get("Knob Goblin Harem Girl"));QuestL5GoblinHarem_defineProperty(QuestL5GoblinHarem_assertThisInitialized(_this), "paths", void 0);return _this;}QuestL5GoblinHarem_createClass(QuestL5GoblinHarem, [{ key: "createPaths", value:


    function createPaths() {
      this.paths = [
      new PossiblePath(0).add(ResourceCategory.FIRE_EXTINGUSHER_ZONE),
      new PossiblePath(8, 12),
      new PossiblePath(2, 5).add(ResourceCategory.YELLOW_RAY)];

    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "getId", value:

    function getId() {
      return "Council / Goblins / HaremOutfit";
    } }, { key: "level", value:

    function level() {
      return 5;
    } }, { key: "status", value:

    function status(path) {
      if (
      (0,external_kolmafia_.outfitPieces)("knob Goblin Harem Girl Disguise").find(
      function (i) {return (0,external_kolmafia_.availableAmount)(i) == 0;}) ==
      null)
      {
        return QuestStatus.COMPLETED;
      }

      var status = getQuestStatus("questL05Goblin");

      if (status < 1) {
        return QuestStatus.NOT_READY;
      }

      if (status > 1) {
        return QuestStatus.COMPLETED;
      }

      if (!canGreyAdventure(this.harem)) {
        return QuestStatus.NOT_READY;
      }

      if (
      path != null &&
      path.canUse(ResourceCategory.YELLOW_RAY) &&
      !path.getResource(ResourceCategory.YELLOW_RAY).ready())
      {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      var outfit = new GreyOutfit();
      var resource = path.getResource(ResourceCategory.FIRE_EXTINGUSHER_ZONE);

      if (resource == null) {
        resource = path.getResource(ResourceCategory.YELLOW_RAY);
      }

      if (resource != null) {
        resource.prepare(outfit);
      } else {
        outfit.setItemDrops();
      }

      var pred = currentPredictions().get(this.harem);

      return {
        location: this.harem,
        outfit: outfit,
        orbs:
        (pred == null || !this.toAbsorb.includes(pred)) &&
        path.canUse(ResourceCategory.FIRE_EXTINGUSHER_ZONE) ?
        null : [
        this.haremGirl].concat(QuestL5GoblinHarem_toConsumableArray(this.toAbsorb)),
        mayFreeRun: true,
        freeRun: function freeRun(monster) {return monster != _this2.haremGirl;},
        run: function run() {
          // When we have access to the harem, blast it down
          var macro = new Macro();
          var props = new Properties_PropertyManager();

          try {
            if (resource != null) {
              resource.prepare(null, props);

              if (resource.type == ResourceCategory.FIRE_EXTINGUSHER_ZONE) {
                macro = resource.macro();

                // If its a monster we want to absorb, don't blast it down
                var _iterator = QuestL5GoblinHarem_createForOfIteratorHelper(_this2.toAbsorb),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var absorb = _step.value;
                    macro = Macro.ifNot_(absorb, macro);
                  }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

                macro = Macro.ifNot_(external_kolmafia_.Monster.get("Sausage Goblin"), macro);
              } else if (resource.type == ResourceCategory.YELLOW_RAY) {
                macro = Macro.if_(_this2.haremGirl, resource.macro());
              }
            }

            greyAdv(
            _this2.harem,
            outfit,
            new AdventureSettings().
            setStartOfFightMacro(macro).
            addNoBanish(_this2.haremGirl));

          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.harem];
    } }]);return QuestL5GoblinHarem;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/QuestL5Goblins.ts
function QuestL5Goblins_typeof(obj) {"@babel/helpers - typeof";return QuestL5Goblins_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL5Goblins_typeof(obj);}function QuestL5Goblins_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL5Goblins_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL5Goblins_toPropertyKey(descriptor.key), descriptor);}}function QuestL5Goblins_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL5Goblins_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL5Goblins_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL5Goblins_defineProperty(obj, key, value) {key = QuestL5Goblins_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL5Goblins_toPropertyKey(arg) {var key = QuestL5Goblins_toPrimitive(arg, "string");return QuestL5Goblins_typeof(key) === "symbol" ? key : String(key);}function QuestL5Goblins_toPrimitive(input, hint) {if (QuestL5Goblins_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL5Goblins_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var QuestL5Goblin = /*#__PURE__*/function () {function QuestL5Goblin() {QuestL5Goblins_classCallCheck(this, QuestL5Goblin);QuestL5Goblins_defineProperty(this, "perfume",
    external_kolmafia_.Item.get("knob goblin perfume"));QuestL5Goblins_defineProperty(this, "effect",
    external_kolmafia_.Effect.get("knob Goblin Perfume"));QuestL5Goblins_defineProperty(this, "harem",
    external_kolmafia_.Location.get("Cobb's Knob Harem"));QuestL5Goblins_defineProperty(this, "outskirts",
    new QuestL5GoblinOutskirts());QuestL5Goblins_defineProperty(this, "qHarem",
    new QuestL5GoblinHarem());}QuestL5Goblins_createClass(QuestL5Goblin, [{ key: "getId", value:

    function getId() {
      return "Council / Goblins / King";
    } }, { key: "level", value:

    function level() {
      return 5;
    } }, { key: "getChildren", value:

    function getChildren() {
      return [this.outskirts, this.qHarem];
    } }, { key: "getLocations", value:

    function getLocations() {
      return [external_kolmafia_.Location.get("Throne Room")];
    } }, { key: "status", value:

    function status() {
      var status = (0,external_kolmafia_.getProperty)("questL05Goblin");

      if (status == "finished") {
        return QuestStatus.COMPLETED;
      }

      if (status != "step1" || !(0,external_kolmafia_.haveOutfit)("knob Goblin Harem Girl Disguise")) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit().
      addWeight(external_kolmafia_.Item.get("Knob Goblin harem pants")).
      addWeight(external_kolmafia_.Item.get("Knob Goblin harem veil"));

      return {
        location: external_kolmafia_.Location.get("Throne Room"),
        outfit: outfit,
        run: function run() {
          if ((0,external_kolmafia_.haveEffect)(_this.effect) == 0) {
            if ((0,external_kolmafia_.itemAmount)(_this.perfume) > 0) {
              (0,external_kolmafia_.use)(_this.perfume);
            } else {
              greyAdv(_this.harem, outfit);
            }
          }

          greyAdv("cobbsknob.php?action=throneroom", outfit);
          (0,external_kolmafia_.autosell)(external_kolmafia_.Item.get("Dense Meat Stack"), 2);
          (0,external_kolmafia_.council)();
        }
      };
    } }]);return QuestL5Goblin;}();
;// CONCATENATED MODULE: ./src/quests/council/friars/QuestL6FriarElbow.ts
function QuestL6FriarElbow_typeof(obj) {"@babel/helpers - typeof";return QuestL6FriarElbow_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL6FriarElbow_typeof(obj);}function QuestL6FriarElbow_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL6FriarElbow_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL6FriarElbow_toPropertyKey(descriptor.key), descriptor);}}function QuestL6FriarElbow_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL6FriarElbow_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL6FriarElbow_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL6FriarElbow_defineProperty(obj, key, value) {key = QuestL6FriarElbow_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL6FriarElbow_toPropertyKey(arg) {var key = QuestL6FriarElbow_toPrimitive(arg, "string");return QuestL6FriarElbow_typeof(key) === "symbol" ? key : String(key);}function QuestL6FriarElbow_toPrimitive(input, hint) {if (QuestL6FriarElbow_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL6FriarElbow_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}









var QuestL6FriarElbow = /*#__PURE__*/function () {function QuestL6FriarElbow() {QuestL6FriarElbow_classCallCheck(this, QuestL6FriarElbow);QuestL6FriarElbow_defineProperty(this, "item",
    external_kolmafia_.Item.get("Eldritch butterknife"));QuestL6FriarElbow_defineProperty(this, "location",
    external_kolmafia_.Location.get("Dark Elbow of the Woods"));QuestL6FriarElbow_defineProperty(this, "absorbs",
    [external_kolmafia_.Monster.get("G imp"), external_kolmafia_.Monster.get("L imp")]);QuestL6FriarElbow_defineProperty(this, "latte",
    external_kolmafia_.Item.get("Latte lovers member's mug"));QuestL6FriarElbow_defineProperty(this, "umbrella",
    external_kolmafia_.Item.get("Unbreakable Umbrella"));QuestL6FriarElbow_defineProperty(this, "toAbsorb", void 0);QuestL6FriarElbow_defineProperty(this, "skill1",

    external_kolmafia_.Skill.get("Phase Shift"));QuestL6FriarElbow_defineProperty(this, "skill2",
    external_kolmafia_.Skill.get("Photonic Shroud"));}QuestL6FriarElbow_createClass(QuestL6FriarElbow, [{ key: "level", value:

    function level() {
      return 6;
    } }, { key: "shouldWearLatte", value:

    function shouldWearLatte() {
      return (
        (0,external_kolmafia_.availableAmount)(this.latte) > 0 &&
        !hasUnlockedLatteFlavor(LatteFlavor.FAM_EXP));

    } }, { key: "isAllAbsorbed", value:

    function isAllAbsorbed() {
      var absorbed = GreyAbsorber_AbsorbsProvider.getReabsorbedMonsters();

      return this.absorbs.find(function (a) {return !absorbed.includes(a);}) == null;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.location];
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.getProperty)("questL06Friar") == "unstarted") {
        return QuestStatus.NOT_READY;
      }

      if (
      (0,external_kolmafia_.getProperty)("questL06Friar") == "finished" ||
      (0,external_kolmafia_.availableAmount)(this.item) > 0)
      {
        return QuestStatus.COMPLETED;
      }

      if (
      this.shouldWearLatte() &&
      getCurrentLatteFlavors().includes(LatteFlavor.MEAT_DROP))
      {
        return QuestStatus.READY;
      }

      if (!(0,external_kolmafia_.haveSkill)(this.skill1) || !(0,external_kolmafia_.haveSkill)(this.skill2)) {
        return QuestStatus.NOT_READY;
      }

      if (
      !hasNonCombatSkillsReady((0,external_kolmafia_.myLevel)() >= 11 && !hasNonCombatSkillActive()))
      {
        return QuestStatus.NOT_READY;
      }

      if (!hasNonCombatSkillsReady()) {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit().setNoCombat().setNoCombat();

      if (this.shouldWearLatte()) {
        outfit.addWeight(this.latte);
      } else if (!this.isAllAbsorbed()) {
        outfit.addDelayer();
      }

      return {
        location: this.location,
        outfit: outfit,
        freeRun: function freeRun() {return true;},
        run: function run() {
          if (DelayBurners.isTryingForDupeableGoblin()) {
            (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Grey Goose"));
          }

          greyAdv(_this.location, outfit);
        }
      };
    } }, { key: "getId", value:

    function getId() {
      return "Council / Friars / Elbow";
    } }]);return QuestL6FriarElbow;}();
;// CONCATENATED MODULE: ./src/quests/council/friars/QuestL6FriarExp.ts
function QuestL6FriarExp_typeof(obj) {"@babel/helpers - typeof";return QuestL6FriarExp_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL6FriarExp_typeof(obj);}function QuestL6FriarExp_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL6FriarExp_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL6FriarExp_toPropertyKey(descriptor.key), descriptor);}}function QuestL6FriarExp_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL6FriarExp_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL6FriarExp_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL6FriarExp_defineProperty(obj, key, value) {key = QuestL6FriarExp_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL6FriarExp_toPropertyKey(arg) {var key = QuestL6FriarExp_toPrimitive(arg, "string");return QuestL6FriarExp_typeof(key) === "symbol" ? key : String(key);}function QuestL6FriarExp_toPrimitive(input, hint) {if (QuestL6FriarExp_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL6FriarExp_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}




var QuestL6FriarExp = /*#__PURE__*/function () {function QuestL6FriarExp() {QuestL6FriarExp_classCallCheck(this, QuestL6FriarExp);QuestL6FriarExp_defineProperty(this, "fam",
    external_kolmafia_.Familiar.get("Grey Goose"));}QuestL6FriarExp_createClass(QuestL6FriarExp, [{ key: "getId", value:

    function getId() {
      return "Misc / FriarExp";
    } }, { key: "level", value:

    function level() {
      return 6;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.toBoolean)((0,external_kolmafia_.getProperty)("friarsBlessingReceived"))) {
        return QuestStatus.COMPLETED;
      }

      if (!(0,external_kolmafia_.friarsAvailable)()) {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.myFamiliar)() != this.fam) {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.familiarWeight)(this.fam) > 2) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          (0,external_kolmafia_.cliExecute)("friars familiar");
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }]);return QuestL6FriarExp;}();
;// CONCATENATED MODULE: ./src/quests/council/friars/QuestL6FriarHeart.ts
function QuestL6FriarHeart_typeof(obj) {"@babel/helpers - typeof";return QuestL6FriarHeart_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL6FriarHeart_typeof(obj);}function QuestL6FriarHeart_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL6FriarHeart_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL6FriarHeart_toPropertyKey(descriptor.key), descriptor);}}function QuestL6FriarHeart_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL6FriarHeart_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL6FriarHeart_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL6FriarHeart_defineProperty(obj, key, value) {key = QuestL6FriarHeart_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL6FriarHeart_toPropertyKey(arg) {var key = QuestL6FriarHeart_toPrimitive(arg, "string");return QuestL6FriarHeart_typeof(key) === "symbol" ? key : String(key);}function QuestL6FriarHeart_toPrimitive(input, hint) {if (QuestL6FriarHeart_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL6FriarHeart_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}









var QuestL6FriarHeart = /*#__PURE__*/function () {function QuestL6FriarHeart() {QuestL6FriarHeart_classCallCheck(this, QuestL6FriarHeart);QuestL6FriarHeart_defineProperty(this, "item",
    external_kolmafia_.Item.get("box of birthday candles"));QuestL6FriarHeart_defineProperty(this, "location",
    external_kolmafia_.Location.get("Dark Heart of the Woods"));QuestL6FriarHeart_defineProperty(this, "absorbs",
    [external_kolmafia_.Monster.get("G imp"), external_kolmafia_.Monster.get("P imp")]);QuestL6FriarHeart_defineProperty(this, "latte",
    external_kolmafia_.Item.get("Latte lovers member's mug"));QuestL6FriarHeart_defineProperty(this, "umbrella",
    external_kolmafia_.Item.get("Unbreakable Umbrella"));QuestL6FriarHeart_defineProperty(this, "toAbsorb", void 0);QuestL6FriarHeart_defineProperty(this, "skill1",

    external_kolmafia_.Skill.get("Phase Shift"));QuestL6FriarHeart_defineProperty(this, "skill2",
    external_kolmafia_.Skill.get("Photonic Shroud"));}QuestL6FriarHeart_createClass(QuestL6FriarHeart, [{ key: "level", value:

    function level() {
      return 6;
    } }, { key: "shouldWearLatte", value:

    function shouldWearLatte() {
      return (
        (0,external_kolmafia_.availableAmount)(this.latte) > 0 &&
        !hasUnlockedLatteFlavor(LatteFlavor.PLUS_COMBAT));

    } }, { key: "isAllAbsorbed", value:

    function isAllAbsorbed() {
      var absorbed = GreyAbsorber_AbsorbsProvider.getReabsorbedMonsters();

      return this.absorbs.find(function (a) {return !absorbed.includes(a);}) == null;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.location];
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.getProperty)("questL06Friar") == "unstarted") {
        return QuestStatus.NOT_READY;
      }

      if (
      (0,external_kolmafia_.getProperty)("questL06Friar") == "finished" ||
      (0,external_kolmafia_.availableAmount)(this.item) > 0)
      {
        return QuestStatus.COMPLETED;
      }

      if (
      !hasNonCombatSkillsReady((0,external_kolmafia_.myLevel)() >= 11 && !hasNonCombatSkillActive()))
      {
        return QuestStatus.NOT_READY;
      }

      if (!(0,external_kolmafia_.haveSkill)(this.skill1) || !(0,external_kolmafia_.haveSkill)(this.skill2)) {
        return QuestStatus.NOT_READY;
      }

      if (!hasNonCombatSkillsReady()) {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit().setNoCombat().setNoCombat();

      if (this.shouldWearLatte()) {
        outfit.addWeight(this.latte);
      } else if (!this.isAllAbsorbed()) {
        outfit.addDelayer();
      }

      return {
        location: this.location,
        outfit: outfit,
        freeRun: function freeRun() {return true;},
        run: function run() {
          if (DelayBurners.isTryingForDupeableGoblin()) {
            (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Grey Goose"));
          }

          greyAdv(_this.location, outfit);
        }
      };
    } }, { key: "getId", value:

    function getId() {
      return "Council / Friars / Heart";
    } }]);return QuestL6FriarHeart;}();
;// CONCATENATED MODULE: ./src/quests/council/friars/QuestL6FriarNeck.ts
function QuestL6FriarNeck_typeof(obj) {"@babel/helpers - typeof";return QuestL6FriarNeck_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL6FriarNeck_typeof(obj);}function QuestL6FriarNeck_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL6FriarNeck_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL6FriarNeck_toPropertyKey(descriptor.key), descriptor);}}function QuestL6FriarNeck_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL6FriarNeck_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL6FriarNeck_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL6FriarNeck_defineProperty(obj, key, value) {key = QuestL6FriarNeck_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL6FriarNeck_toPropertyKey(arg) {var key = QuestL6FriarNeck_toPrimitive(arg, "string");return QuestL6FriarNeck_typeof(key) === "symbol" ? key : String(key);}function QuestL6FriarNeck_toPrimitive(input, hint) {if (QuestL6FriarNeck_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL6FriarNeck_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}









var QuestL6FriarNeck = /*#__PURE__*/function () {function QuestL6FriarNeck() {QuestL6FriarNeck_classCallCheck(this, QuestL6FriarNeck);QuestL6FriarNeck_defineProperty(this, "item",
    external_kolmafia_.Item.get("dodecagram"));QuestL6FriarNeck_defineProperty(this, "location",
    external_kolmafia_.Location.get("Dark Neck of the Woods"));QuestL6FriarNeck_defineProperty(this, "absorbs",
    [external_kolmafia_.Monster.get("P imp"), external_kolmafia_.Monster.get("W imp")]);QuestL6FriarNeck_defineProperty(this, "latte",
    external_kolmafia_.Item.get("Latte lovers member's mug"));QuestL6FriarNeck_defineProperty(this, "umbrella",
    external_kolmafia_.Item.get("Unbreakable Umbrella"));QuestL6FriarNeck_defineProperty(this, "toAbsorb", void 0);QuestL6FriarNeck_defineProperty(this, "skill1",

    external_kolmafia_.Skill.get("Phase Shift"));QuestL6FriarNeck_defineProperty(this, "skill2",
    external_kolmafia_.Skill.get("Photonic Shroud"));}QuestL6FriarNeck_createClass(QuestL6FriarNeck, [{ key: "level", value:

    function level() {
      return 6;
    } }, { key: "shouldWearLatte", value:

    function shouldWearLatte() {
      return (
        (0,external_kolmafia_.hippyStoneBroken)() &&
        (0,external_kolmafia_.availableAmount)(this.latte) > 0 &&
        !hasUnlockedLatteFlavor(LatteFlavor.PVP_FIGHTS));

    } }, { key: "isAllAbsorbed", value:

    function isAllAbsorbed() {
      var absorbed = GreyAbsorber_AbsorbsProvider.getReabsorbedMonsters();

      return this.absorbs.find(function (a) {return !absorbed.includes(a);}) == null;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.location];
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.getProperty)("questL06Friar") == "unstarted") {
        return QuestStatus.NOT_READY;
      }

      if (
      (0,external_kolmafia_.getProperty)("questL06Friar") == "finished" ||
      (0,external_kolmafia_.availableAmount)(this.item) > 0)
      {
        return QuestStatus.COMPLETED;
      }

      if (!(0,external_kolmafia_.haveSkill)(this.skill1) || !(0,external_kolmafia_.haveSkill)(this.skill2)) {
        return QuestStatus.NOT_READY;
      }

      if (
      !hasNonCombatSkillsReady((0,external_kolmafia_.myLevel)() >= 11 && !hasNonCombatSkillActive()))
      {
        return QuestStatus.NOT_READY;
      }

      if (!hasNonCombatSkillsReady()) {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit().setNoCombat().setNoCombat();

      if (this.shouldWearLatte()) {
        outfit.addWeight(this.latte);
      } else if (!this.isAllAbsorbed()) {
        outfit.addDelayer();
      }

      return {
        location: this.location,
        outfit: outfit,
        freeRun: function freeRun() {return true;},
        run: function run() {
          if (DelayBurners.isTryingForDupeableGoblin()) {
            (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Grey Goose"));
          }

          greyAdv(_this.location, outfit);
        }
      };
    } }, { key: "getId", value:

    function getId() {
      return "Council / Friars / Neck";
    } }]);return QuestL6FriarNeck;}();
;// CONCATENATED MODULE: ./src/quests/council/friars/QuestL6FriarsLatteElbow.ts
function QuestL6FriarsLatteElbow_typeof(obj) {"@babel/helpers - typeof";return QuestL6FriarsLatteElbow_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL6FriarsLatteElbow_typeof(obj);}function QuestL6FriarsLatteElbow_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL6FriarsLatteElbow_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL6FriarsLatteElbow_toPropertyKey(descriptor.key), descriptor);}}function QuestL6FriarsLatteElbow_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL6FriarsLatteElbow_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL6FriarsLatteElbow_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL6FriarsLatteElbow_defineProperty(obj, key, value) {key = QuestL6FriarsLatteElbow_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL6FriarsLatteElbow_toPropertyKey(arg) {var key = QuestL6FriarsLatteElbow_toPrimitive(arg, "string");return QuestL6FriarsLatteElbow_typeof(key) === "symbol" ? key : String(key);}function QuestL6FriarsLatteElbow_toPrimitive(input, hint) {if (QuestL6FriarsLatteElbow_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL6FriarsLatteElbow_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestL6LatteFamExp = /*#__PURE__*/function () {function QuestL6LatteFamExp() {QuestL6FriarsLatteElbow_classCallCheck(this, QuestL6LatteFamExp);QuestL6FriarsLatteElbow_defineProperty(this, "location",
    external_kolmafia_.Location.get("Dark Elbow of the Woods"));QuestL6FriarsLatteElbow_defineProperty(this, "latte",
    external_kolmafia_.Item.get("Latte lovers member's mug"));QuestL6FriarsLatteElbow_defineProperty(this, "flavor",
    LatteFlavor.FAM_EXP);QuestL6FriarsLatteElbow_defineProperty(this, "item",
    external_kolmafia_.Item.get("Eldritch butterknife"));}QuestL6FriarsLatteElbow_createClass(QuestL6LatteFamExp, [{ key: "level", value:

    function level() {
      return 6;
    } }, { key: "status", value:

    function status() {
      if (
      (0,external_kolmafia_.availableAmount)(this.latte) == 0 ||
      hasUnlockedLatteFlavor(this.flavor) ||
      (0,external_kolmafia_.getProperty)("questL06Friar") == "finished")
      {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.availableAmount)(this.item) == 0) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "getId", value:

    function getId() {
      return "Misc / Latte / Fam Exp";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.location];
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();
      outfit.addWeight(this.latte);

      return {
        outfit: outfit,
        location: this.location,
        run: function run() {
          greyAdv(_this.location, outfit);
        }
      };
    } }]);return QuestL6LatteFamExp;}();
;// CONCATENATED MODULE: ./src/quests/council/friars/QuestL6FriarsLatteHeart.ts
function QuestL6FriarsLatteHeart_typeof(obj) {"@babel/helpers - typeof";return QuestL6FriarsLatteHeart_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL6FriarsLatteHeart_typeof(obj);}function QuestL6FriarsLatteHeart_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL6FriarsLatteHeart_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL6FriarsLatteHeart_toPropertyKey(descriptor.key), descriptor);}}function QuestL6FriarsLatteHeart_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL6FriarsLatteHeart_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL6FriarsLatteHeart_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL6FriarsLatteHeart_defineProperty(obj, key, value) {key = QuestL6FriarsLatteHeart_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL6FriarsLatteHeart_toPropertyKey(arg) {var key = QuestL6FriarsLatteHeart_toPrimitive(arg, "string");return QuestL6FriarsLatteHeart_typeof(key) === "symbol" ? key : String(key);}function QuestL6FriarsLatteHeart_toPrimitive(input, hint) {if (QuestL6FriarsLatteHeart_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL6FriarsLatteHeart_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestL6LattePlusCombat = /*#__PURE__*/function () {function QuestL6LattePlusCombat() {QuestL6FriarsLatteHeart_classCallCheck(this, QuestL6LattePlusCombat);QuestL6FriarsLatteHeart_defineProperty(this, "location",
    external_kolmafia_.Location.get("Dark Heart of the Woods"));QuestL6FriarsLatteHeart_defineProperty(this, "latte",
    external_kolmafia_.Item.get("Latte lovers member's mug"));QuestL6FriarsLatteHeart_defineProperty(this, "flavor",
    LatteFlavor.PLUS_COMBAT);QuestL6FriarsLatteHeart_defineProperty(this, "item",
    external_kolmafia_.Item.get("box of birthday candles"));}QuestL6FriarsLatteHeart_createClass(QuestL6LattePlusCombat, [{ key: "level", value:

    function level() {
      return 6;
    } }, { key: "status", value:

    function status() {
      if (
      (0,external_kolmafia_.availableAmount)(this.latte) == 0 ||
      hasUnlockedLatteFlavor(this.flavor) ||
      (0,external_kolmafia_.getProperty)("questL06Friar") == "finished")
      {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.availableAmount)(this.item) == 0) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "getId", value:

    function getId() {
      return "Misc / Latte / Plus Combat";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.location];
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();
      outfit.addWeight(this.latte);

      return {
        outfit: outfit,
        location: this.location,
        run: function run() {
          greyAdv(_this.location, outfit);
        }
      };
    } }]);return QuestL6LattePlusCombat;}();
;// CONCATENATED MODULE: ./src/quests/council/QuestL6Friars.ts
function QuestL6Friars_typeof(obj) {"@babel/helpers - typeof";return QuestL6Friars_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL6Friars_typeof(obj);}function QuestL6Friars_toConsumableArray(arr) {return QuestL6Friars_arrayWithoutHoles(arr) || QuestL6Friars_iterableToArray(arr) || QuestL6Friars_unsupportedIterableToArray(arr) || QuestL6Friars_nonIterableSpread();}function QuestL6Friars_nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function QuestL6Friars_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestL6Friars_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestL6Friars_arrayLikeToArray(o, minLen);}function QuestL6Friars_iterableToArray(iter) {if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);}function QuestL6Friars_arrayWithoutHoles(arr) {if (Array.isArray(arr)) return QuestL6Friars_arrayLikeToArray(arr);}function QuestL6Friars_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestL6Friars_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL6Friars_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL6Friars_toPropertyKey(descriptor.key), descriptor);}}function QuestL6Friars_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL6Friars_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL6Friars_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL6Friars_defineProperty(obj, key, value) {key = QuestL6Friars_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL6Friars_toPropertyKey(arg) {var key = QuestL6Friars_toPrimitive(arg, "string");return QuestL6Friars_typeof(key) === "symbol" ? key : String(key);}function QuestL6Friars_toPrimitive(input, hint) {if (QuestL6Friars_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL6Friars_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}










var QuestL6Friar = /*#__PURE__*/function () {function QuestL6Friar() {QuestL6Friars_classCallCheck(this, QuestL6Friar);QuestL6Friars_defineProperty(this, "woods",
    [
    new QuestL6FriarElbow(),
    new QuestL6FriarHeart(),
    new QuestL6FriarNeck(),
    new QuestL6LatteFamExp(),
    new QuestL6LattePlusCombat()]);QuestL6Friars_defineProperty(this, "exp",

    new QuestL6FriarExp());QuestL6Friars_defineProperty(this, "absorbs",
    ["G", "L", "P", "W"].map(function (s) {return external_kolmafia_.Monster.get(s + " Imp");}));}QuestL6Friars_createClass(QuestL6Friar, [{ key: "canTurnIn", value:

    function canTurnIn() {
      return this.absorbs.find(function (m) {return !(0,external_kolmafia_.absorbedMonsters)()[m.name];}) == null;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "level", value:

    function level() {
      return 6;
    } }, { key: "getId", value:

    function getId() {
      return "Council / Friars / TurnIn";
    } }, { key: "getChildren", value:

    function getChildren() {
      return [this.exp].concat(QuestL6Friars_toConsumableArray(this.woods));
    } }, { key: "status", value:

    function status() {
      var status = (0,external_kolmafia_.getProperty)("questL06Friar");

      if (status == "finished") {
        return QuestStatus.COMPLETED;
      }

      if (
      this.woods.filter(function (c) {return c.status() != QuestStatus.COMPLETED;}).length > 0)
      {
        return QuestStatus.NOT_READY;
      }

      if (!this.canTurnIn()) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return true;
    } }, { key: "free", value:

    function free() {
      return true;
    } }, { key: "run", value:

    function run() {
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          (0,external_kolmafia_.visitUrl)("friars.php?action=ritual&pwd");
          (0,external_kolmafia_.visitUrl)("pandamonium.php");
          (0,external_kolmafia_.council)();
        }
      };
    } }]);return QuestL6Friar;}();
;// CONCATENATED MODULE: ./src/quests/council/crypts/CryptTemplate.ts
function CryptTemplate_typeof(obj) {"@babel/helpers - typeof";return CryptTemplate_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, CryptTemplate_typeof(obj);}function CryptTemplate_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function CryptTemplate_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, CryptTemplate_toPropertyKey(descriptor.key), descriptor);}}function CryptTemplate_createClass(Constructor, protoProps, staticProps) {if (protoProps) CryptTemplate_defineProperties(Constructor.prototype, protoProps);if (staticProps) CryptTemplate_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function CryptTemplate_defineProperty(obj, key, value) {key = CryptTemplate_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function CryptTemplate_toPropertyKey(arg) {var key = CryptTemplate_toPrimitive(arg, "string");return CryptTemplate_typeof(key) === "symbol" ? key : String(key);}function CryptTemplate_toPrimitive(input, hint) {if (CryptTemplate_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (CryptTemplate_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var CryptL7Template = /*#__PURE__*/function () {function CryptL7Template() {CryptTemplate_classCallCheck(this, CryptL7Template);CryptTemplate_defineProperty(this, "swords",
    [
    "ebony epee",
    "antique machete",
    "black sword",
    "broken sword",
    "cardboard katana",
    "cardboard wakizashi",
    "knob goblin deluxe scimitar",
    "knob goblin scimitar",
    "lupine sword",
    "muculent machete",
    "serpentine sword",
    "vorpal blade",
    "white sword",
    "sweet ninja sword"].
    map(function (s) {return external_kolmafia_.Item.get(s);}));CryptTemplate_defineProperty(this, "cape",
    external_kolmafia_.Item.get("Unwrapped knock-off retro superhero cape"));CryptTemplate_defineProperty(this, "gravyboat",
    external_kolmafia_.Item.get("Gravy Boat"));}CryptTemplate_createClass(CryptL7Template, [{ key: "getSword", value:

    function getSword() {
      var items = this.swords.filter(function (i) {return (0,external_kolmafia_.availableAmount)(i) > 0;});

      if (items.length == 0 && (0,external_kolmafia_.myMeat)() >= 100) {
        (0,external_kolmafia_.retrieveItem)(external_kolmafia_.Item.get("sweet ninja sword"));

        return this.getSword();
      }

      return items[0];
    } }, { key: "level", value:

    function level() {
      return (0,external_kolmafia_.availableAmount)(this.cape) > 0 ? 7 : 9;
    } }, { key: "addRetroSword", value:



    function addRetroSword() {var outfit = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new GreyOutfit();
      outfit.addWeight(this.gravyboat, 99999);

      if ((0,external_kolmafia_.availableAmount)(this.cape) > 0) {
        outfit.addWeight(this.getSword(), 99999);
        outfit.addExtra("-back");
      }

      return outfit;
    } }, { key: "adjustRetroCape", value:

    function adjustRetroCape() {
      if ((0,external_kolmafia_.availableAmount)(this.cape) == 0) {
        return;
      }

      (0,external_kolmafia_.equip)(this.cape);

      if (
      (0,external_kolmafia_.getProperty)("retroCapeSuperhero") == "vampire" &&
      (0,external_kolmafia_.getProperty)("retroCapeWashingInstructions") == "kill")
      {
        return;
      }

      (0,external_kolmafia_.cliExecute)("retrocape vampire kill");
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.getProperty)("questL07Cyrptic") == "unstarted") {
        return QuestStatus.NOT_READY;
      }

      if (this.getStatus() == CryptStatus.FINISHED) {
        return QuestStatus.COMPLETED;
      }

      if (this.getSword() == null && (0,external_kolmafia_.myMeat)() < 300) {
        return QuestStatus.NOT_READY;
      }

      return this.cryptStatus();
    } }, { key: "getStatus", value:









    function getStatus() {
      var num = (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)(this.getProperty()));

      if (num > 50 - 37) {
        return CryptStatus.FIGHT;
      }

      // Workaround for a kol bug
      if (
      num == 0 &&
      this.getProperty() == "cyrptCrannyEvilness" &&
      !external_kolmafia_.Location.get("The Defiled Cranny").combatQueue.includes("huge ghuol"))
      {
        return CryptStatus.FIGHT;
      }

      if (num <= 0) {
        return CryptStatus.FINISHED;
      }

      return CryptStatus.BOSS;
    } }]);return CryptL7Template;}();
;// CONCATENATED MODULE: ./src/quests/council/crypts/QuestL7CryptDirtyMan.ts
function QuestL7CryptDirtyMan_typeof(obj) {"@babel/helpers - typeof";return QuestL7CryptDirtyMan_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL7CryptDirtyMan_typeof(obj);}function QuestL7CryptDirtyMan_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL7CryptDirtyMan_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL7CryptDirtyMan_toPropertyKey(descriptor.key), descriptor);}}function QuestL7CryptDirtyMan_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL7CryptDirtyMan_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL7CryptDirtyMan_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL7CryptDirtyMan_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestL7CryptDirtyMan_setPrototypeOf(subClass, superClass);}function QuestL7CryptDirtyMan_setPrototypeOf(o, p) {QuestL7CryptDirtyMan_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestL7CryptDirtyMan_setPrototypeOf(o, p);}function QuestL7CryptDirtyMan_createSuper(Derived) {var hasNativeReflectConstruct = QuestL7CryptDirtyMan_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestL7CryptDirtyMan_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestL7CryptDirtyMan_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestL7CryptDirtyMan_possibleConstructorReturn(this, result);};}function QuestL7CryptDirtyMan_possibleConstructorReturn(self, call) {if (call && (QuestL7CryptDirtyMan_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestL7CryptDirtyMan_assertThisInitialized(self);}function QuestL7CryptDirtyMan_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestL7CryptDirtyMan_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestL7CryptDirtyMan_getPrototypeOf(o) {QuestL7CryptDirtyMan_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestL7CryptDirtyMan_getPrototypeOf(o);}function QuestL7CryptDirtyMan_defineProperty(obj, key, value) {key = QuestL7CryptDirtyMan_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL7CryptDirtyMan_toPropertyKey(arg) {var key = QuestL7CryptDirtyMan_toPrimitive(arg, "string");return QuestL7CryptDirtyMan_typeof(key) === "symbol" ? key : String(key);}function QuestL7CryptDirtyMan_toPrimitive(input, hint) {if (QuestL7CryptDirtyMan_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL7CryptDirtyMan_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}










var CryptL7DirtyMan = /*#__PURE__*/function (_CryptL7Template) {QuestL7CryptDirtyMan_inherits(CryptL7DirtyMan, _CryptL7Template);var _super = QuestL7CryptDirtyMan_createSuper(CryptL7DirtyMan);function CryptL7DirtyMan() {var _this;QuestL7CryptDirtyMan_classCallCheck(this, CryptL7DirtyMan);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestL7CryptDirtyMan_defineProperty(QuestL7CryptDirtyMan_assertThisInitialized(_this), "loc",
    external_kolmafia_.Location.get("The Defiled Niche"));QuestL7CryptDirtyMan_defineProperty(QuestL7CryptDirtyMan_assertThisInitialized(_this), "sniffer",
    external_kolmafia_.Familiar.get("Nosy Nose"));QuestL7CryptDirtyMan_defineProperty(QuestL7CryptDirtyMan_assertThisInitialized(_this), "dirty",
    external_kolmafia_.Monster.get("dirty old lihc"));QuestL7CryptDirtyMan_defineProperty(QuestL7CryptDirtyMan_assertThisInitialized(_this), "sniff",
    external_kolmafia_.Skill.get("Get a Good Whiff of This Guy"));QuestL7CryptDirtyMan_defineProperty(QuestL7CryptDirtyMan_assertThisInitialized(_this), "banisher",
    external_kolmafia_.Skill.get("System Sweep"));QuestL7CryptDirtyMan_defineProperty(QuestL7CryptDirtyMan_assertThisInitialized(_this), "spray",
    new PossiblePath(8).add(
    ResourceCategory.FIRE_EXTINGUSHER_ZONE));QuestL7CryptDirtyMan_defineProperty(QuestL7CryptDirtyMan_assertThisInitialized(_this), "nonSpray",

    new PossiblePath(16));QuestL7CryptDirtyMan_defineProperty(QuestL7CryptDirtyMan_assertThisInitialized(_this), "paths",
    []);QuestL7CryptDirtyMan_defineProperty(QuestL7CryptDirtyMan_assertThisInitialized(_this), "advsAbsorb",
    external_kolmafia_.Monster.get("basic lihc"));return _this;}QuestL7CryptDirtyMan_createClass(CryptL7DirtyMan, [{ key: "createPaths", value:

    function createPaths(assumeUnused) {
      this.paths = [];

      var evilRemaining =
      (assumeUnused || (0,external_kolmafia_.getProperty)("questL07Cyrptic") == "unstarted" ?
      50 :
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)(this.getProperty()))) - 37;

      // Need to do this better, with actual math for retro/gravy
      this.nonSpray = new PossiblePath(Math.ceil(evilRemaining / 2));

      if (assumeUnused || (0,external_kolmafia_.getProperty)("fireExtinguisherCyrptUsed") != "true") {
        this.spray = new PossiblePath(Math.ceil((evilRemaining - 10) / 2)).add(
        ResourceCategory.FIRE_EXTINGUSHER_ZONE);


        this.paths.push(this.spray);
      }

      this.paths.push(this.nonSpray);
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      var outfit = this.addRetroSword();

      var hasAbsorbed = GreyAbsorber_AbsorbsProvider.getReabsorbedMonsters().includes(
      this.advsAbsorb);


      if (hasAbsorbed && path.canUse(ResourceCategory.FIRE_EXTINGUSHER_ZONE)) {
        path.getResource(ResourceCategory.FIRE_EXTINGUSHER_ZONE).prepare(outfit);
      }

      var fam = null;
      /*  toInt(getProperty(this.getProperty())) >
        (getProperty("nosyNoseMonster") != "dirty old lihc" ? 31 : 27)
          ? this.sniffer
          : null;*/

      return {
        familiar: fam,
        location: this.loc,
        outfit: outfit,
        olfaction: [this.dirty],
        run: function run() {
          _this2.adjustRetroCape();

          var avoid;

          if (
          hasAbsorbed &&
          path.canUse(ResourceCategory.FIRE_EXTINGUSHER_ZONE))
          {
            // If its a dirty lich, don't spray down
            avoid = Macro.ifNot_(
            _this2.dirty,
            path.getResource(ResourceCategory.FIRE_EXTINGUSHER_ZONE).macro());

          }

          var start;

          if (
          (0,external_kolmafia_.myFamiliar)() == fam &&
          (0,external_kolmafia_.getProperty)("nosyNoseMonster") != "dirty old lihc")
          {
            start = Macro.step("if monsterid 1071;skill 7166;endif");

            if (avoid != null) {
              start = start.step(avoid);
            }
          } else if (avoid != null) {
            start = avoid;
          }

          var props = new Properties_PropertyManager();
          props.setChoice(157, 4);

          try {
            greyAdv(
            _this2.loc,
            outfit,
            new AdventureSettings().
            addNoBanish(_this2.dirty).
            setStartOfFightMacro(start));

          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "getProperty", value:

    function getProperty() {
      return "cyrptNicheEvilness";
    } }, { key: "cryptStatus", value:

    function cryptStatus() {
      if (!(0,external_kolmafia_.haveSkill)(this.banisher)) {

        // return QuestStatus.FASTER_LATER;
      }
      return QuestStatus.READY;
    } }, { key: "getId", value:

    function getId() {
      return "Council / Crypt / DirtyMan";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }]);return CryptL7DirtyMan;}(CryptL7Template);
;// CONCATENATED MODULE: ./src/quests/council/crypts/QuestL7CryptEyes.ts
function QuestL7CryptEyes_typeof(obj) {"@babel/helpers - typeof";return QuestL7CryptEyes_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL7CryptEyes_typeof(obj);}function QuestL7CryptEyes_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL7CryptEyes_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL7CryptEyes_toPropertyKey(descriptor.key), descriptor);}}function QuestL7CryptEyes_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL7CryptEyes_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL7CryptEyes_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL7CryptEyes_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestL7CryptEyes_setPrototypeOf(subClass, superClass);}function QuestL7CryptEyes_setPrototypeOf(o, p) {QuestL7CryptEyes_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestL7CryptEyes_setPrototypeOf(o, p);}function QuestL7CryptEyes_createSuper(Derived) {var hasNativeReflectConstruct = QuestL7CryptEyes_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestL7CryptEyes_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestL7CryptEyes_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestL7CryptEyes_possibleConstructorReturn(this, result);};}function QuestL7CryptEyes_possibleConstructorReturn(self, call) {if (call && (QuestL7CryptEyes_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestL7CryptEyes_assertThisInitialized(self);}function QuestL7CryptEyes_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestL7CryptEyes_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestL7CryptEyes_getPrototypeOf(o) {QuestL7CryptEyes_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestL7CryptEyes_getPrototypeOf(o);}function QuestL7CryptEyes_defineProperty(obj, key, value) {key = QuestL7CryptEyes_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL7CryptEyes_toPropertyKey(arg) {var key = QuestL7CryptEyes_toPrimitive(arg, "string");return QuestL7CryptEyes_typeof(key) === "symbol" ? key : String(key);}function QuestL7CryptEyes_toPrimitive(input, hint) {if (QuestL7CryptEyes_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL7CryptEyes_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var CryptL7Eyes = /*#__PURE__*/function (_CryptL7Template) {QuestL7CryptEyes_inherits(CryptL7Eyes, _CryptL7Template);var _super = QuestL7CryptEyes_createSuper(CryptL7Eyes);function CryptL7Eyes() {var _this;QuestL7CryptEyes_classCallCheck(this, CryptL7Eyes);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestL7CryptEyes_defineProperty(QuestL7CryptEyes_assertThisInitialized(_this), "loc",
    external_kolmafia_.Location.get("The Defiled Nook"));return _this;}QuestL7CryptEyes_createClass(CryptL7Eyes, [{ key: "run", value:

    function run() {var _this2 = this;
      var outfit = new GreyOutfit().setItemDrops().setChampagneBottle();
      this.addRetroSword(outfit);

      return {
        location: this.loc,
        outfit: outfit,
        mayFreeRun: false,
        run: function run() {
          _this2.adjustRetroCape();

          var props = new Properties_PropertyManager();
          props.setChoice(155, 5);

          try {
            greyAdv(
            _this2.loc,
            outfit,
            new AdventureSettings().addBanish(external_kolmafia_.Monster.get("party skelteon")));

          } finally {
            props.resetAll();
          }

          (0,external_kolmafia_.cliExecute)("refresh inventory");

          var item = external_kolmafia_.Item.get("Evil Eye");

          if ((0,external_kolmafia_.availableAmount)(item) > 0) {
            (0,external_kolmafia_.use)(item, (0,external_kolmafia_.availableAmount)(item));
          }
        }
      };
    } }, { key: "getProperty", value:

    function getProperty() {
      return "cyrptNookEvilness";
    } }, { key: "cryptStatus", value:

    function cryptStatus() {
      return QuestStatus.READY;
    } }, { key: "getId", value:

    function getId() {
      return "Council / Crypt / Eyes";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }]);return CryptL7Eyes;}(CryptL7Template);
;// CONCATENATED MODULE: ./src/quests/council/crypts/QuestL7CryptRattling.ts
function QuestL7CryptRattling_typeof(obj) {"@babel/helpers - typeof";return QuestL7CryptRattling_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL7CryptRattling_typeof(obj);}function QuestL7CryptRattling_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL7CryptRattling_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL7CryptRattling_toPropertyKey(descriptor.key), descriptor);}}function QuestL7CryptRattling_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL7CryptRattling_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL7CryptRattling_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL7CryptRattling_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestL7CryptRattling_setPrototypeOf(subClass, superClass);}function QuestL7CryptRattling_setPrototypeOf(o, p) {QuestL7CryptRattling_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestL7CryptRattling_setPrototypeOf(o, p);}function QuestL7CryptRattling_createSuper(Derived) {var hasNativeReflectConstruct = QuestL7CryptRattling_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestL7CryptRattling_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestL7CryptRattling_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestL7CryptRattling_possibleConstructorReturn(this, result);};}function QuestL7CryptRattling_possibleConstructorReturn(self, call) {if (call && (QuestL7CryptRattling_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestL7CryptRattling_assertThisInitialized(self);}function QuestL7CryptRattling_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestL7CryptRattling_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestL7CryptRattling_getPrototypeOf(o) {QuestL7CryptRattling_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestL7CryptRattling_getPrototypeOf(o);}function QuestL7CryptRattling_defineProperty(obj, key, value) {key = QuestL7CryptRattling_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL7CryptRattling_toPropertyKey(arg) {var key = QuestL7CryptRattling_toPrimitive(arg, "string");return QuestL7CryptRattling_typeof(key) === "symbol" ? key : String(key);}function QuestL7CryptRattling_toPrimitive(input, hint) {if (QuestL7CryptRattling_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL7CryptRattling_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}










var CryptL7Rattling = /*#__PURE__*/function (_CryptL7Template) {QuestL7CryptRattling_inherits(CryptL7Rattling, _CryptL7Template);var _super = QuestL7CryptRattling_createSuper(CryptL7Rattling);function CryptL7Rattling() {var _this;QuestL7CryptRattling_classCallCheck(this, CryptL7Rattling);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestL7CryptRattling_defineProperty(QuestL7CryptRattling_assertThisInitialized(_this), "loc",
    external_kolmafia_.Location.get("The Defiled Cranny"));QuestL7CryptRattling_defineProperty(QuestL7CryptRattling_assertThisInitialized(_this), "beatenUp",
    external_kolmafia_.Effect.get("Beaten Up"));QuestL7CryptRattling_defineProperty(QuestL7CryptRattling_assertThisInitialized(_this), "kramco",
    external_kolmafia_.Item.get("Kramco Sausage-o-Matic&trade;"));QuestL7CryptRattling_defineProperty(QuestL7CryptRattling_assertThisInitialized(_this), "runs",
    ["Gaunt ghuol", "gluttonous ghuol"].map(function (s) {return (
        external_kolmafia_.Monster.get(s));}));QuestL7CryptRattling_defineProperty(QuestL7CryptRattling_assertThisInitialized(_this), "toAbsorb", void 0);return _this;}QuestL7CryptRattling_createClass(CryptL7Rattling, [{ key: "level", value:



    function level() {
      return (0,external_kolmafia_.availableAmount)(this.cape) > 0 ? 7 : 16;
    } }, { key: "run", value:

    function run() {var _this2 = this;
      var outfit = new GreyOutfit();

      this.addRetroSword(outfit);

      if (this.getStatus() == CryptStatus.BOSS) {
        outfit.meatDropWeight = 5;
      } else {
        if (
        currentPredictions().get(this.loc) != null &&
        this.toAbsorb.includes(currentPredictions().get(this.loc)))
        {
          outfit.setPlusCombat();
        } else {
          outfit.setNoCombat();
        }
        outfit.umbrellaSetting = UmbrellaState.MONSTER_LEVEL;
        outfit.addWeight("ML", 4);
        outfit.addIgnored(this.kramco);
      }

      return {
        location: this.loc,
        outfit: outfit,
        freeRun: function freeRun(monster) {return _this2.runs.includes(monster);},
        run: function run() {
          _this2.adjustRetroCape();
          (0,external_kolmafia_.changeMcd)(10);

          var props = new Properties_PropertyManager();
          props.setChoice(523, 4);

          try {
            greyAdv(_this2.loc, outfit);
          } finally {
            props.resetAll();
          }

          (0,external_kolmafia_.changeMcd)(0);
        }
      };
    } }, { key: "getProperty", value:

    function getProperty() {
      return "cyrptCrannyEvilness";
    } }, { key: "cryptStatus", value:

    function cryptStatus() {
      if (!hasNonCombatSkillsReady(false)) {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.availableAmount)(this.cape) == 0 && (0,external_kolmafia_.haveEffect)(this.beatenUp) > 0) {
        return QuestStatus.NOT_READY;
      }

      if (!hasNonCombatSkillsReady()) {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "getId", value:

    function getId() {
      return "Council / Crypt / Rattling";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }]);return CryptL7Rattling;}(CryptL7Template);
;// CONCATENATED MODULE: ./src/quests/council/crypts/QuestL7CryptSprinters.ts
function QuestL7CryptSprinters_typeof(obj) {"@babel/helpers - typeof";return QuestL7CryptSprinters_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL7CryptSprinters_typeof(obj);}function QuestL7CryptSprinters_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL7CryptSprinters_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL7CryptSprinters_toPropertyKey(descriptor.key), descriptor);}}function QuestL7CryptSprinters_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL7CryptSprinters_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL7CryptSprinters_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL7CryptSprinters_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestL7CryptSprinters_setPrototypeOf(subClass, superClass);}function QuestL7CryptSprinters_setPrototypeOf(o, p) {QuestL7CryptSprinters_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestL7CryptSprinters_setPrototypeOf(o, p);}function QuestL7CryptSprinters_createSuper(Derived) {var hasNativeReflectConstruct = QuestL7CryptSprinters_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestL7CryptSprinters_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestL7CryptSprinters_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestL7CryptSprinters_possibleConstructorReturn(this, result);};}function QuestL7CryptSprinters_possibleConstructorReturn(self, call) {if (call && (QuestL7CryptSprinters_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestL7CryptSprinters_assertThisInitialized(self);}function QuestL7CryptSprinters_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestL7CryptSprinters_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestL7CryptSprinters_getPrototypeOf(o) {QuestL7CryptSprinters_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestL7CryptSprinters_getPrototypeOf(o);}function QuestL7CryptSprinters_defineProperty(obj, key, value) {key = QuestL7CryptSprinters_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL7CryptSprinters_toPropertyKey(arg) {var key = QuestL7CryptSprinters_toPrimitive(arg, "string");return QuestL7CryptSprinters_typeof(key) === "symbol" ? key : String(key);}function QuestL7CryptSprinters_toPrimitive(input, hint) {if (QuestL7CryptSprinters_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL7CryptSprinters_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}









var CryptL7Sprinters = /*#__PURE__*/function (_CryptL7Template) {QuestL7CryptSprinters_inherits(CryptL7Sprinters, _CryptL7Template);var _super = QuestL7CryptSprinters_createSuper(CryptL7Sprinters);function CryptL7Sprinters() {var _this;QuestL7CryptSprinters_classCallCheck(this, CryptL7Sprinters);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestL7CryptSprinters_defineProperty(QuestL7CryptSprinters_assertThisInitialized(_this), "loc",
    external_kolmafia_.Location.get("The Defiled Alcove"));QuestL7CryptSprinters_defineProperty(QuestL7CryptSprinters_assertThisInitialized(_this), "sprinter",
    external_kolmafia_.Monster.get("Modern zmobie"));QuestL7CryptSprinters_defineProperty(QuestL7CryptSprinters_assertThisInitialized(_this), "toAbsorb", void 0);return _this;}QuestL7CryptSprinters_createClass(CryptL7Sprinters, [{ key: "run", value:


    function run() {var _this2 = this;
      var outfit = new GreyOutfit();
      this.addRetroSword(outfit);

      if (this.getStatus() == CryptStatus.BOSS) {
        outfit.meatDropWeight = 5;
      } else if (
      currentPredictions().get(this.loc) == null ||
      !this.toAbsorb.includes(currentPredictions().get(this.loc)))
      {
        outfit.initWeight = 2;
      }

      return {
        location: this.loc,
        outfit: outfit,
        freeRun: function freeRun(monster) {return monster != _this2.sprinter;},
        run: function run() {
          _this2.adjustRetroCape();

          var props = new Properties_PropertyManager();
          props.setChoice(153, 4);

          try {
            greyAdv(_this2.loc, outfit);
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "getProperty", value:

    function getProperty() {
      return "cyrptAlcoveEvilness";
    } }, { key: "cryptStatus", value:

    function cryptStatus() {
      return QuestStatus.READY;
    } }, { key: "getId", value:

    function getId() {
      return "Council / Crypt / Sprinters";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }]);return CryptL7Sprinters;}(CryptL7Template);
;// CONCATENATED MODULE: ./src/quests/council/QuestL7Crypt.ts
function QuestL7Crypt_typeof(obj) {"@babel/helpers - typeof";return QuestL7Crypt_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL7Crypt_typeof(obj);}function QuestL7Crypt_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL7Crypt_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL7Crypt_toPropertyKey(descriptor.key), descriptor);}}function QuestL7Crypt_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL7Crypt_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL7Crypt_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL7Crypt_defineProperty(obj, key, value) {key = QuestL7Crypt_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL7Crypt_toPropertyKey(arg) {var key = QuestL7Crypt_toPrimitive(arg, "string");return QuestL7Crypt_typeof(key) === "symbol" ? key : String(key);}function QuestL7Crypt_toPrimitive(input, hint) {if (QuestL7Crypt_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL7Crypt_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}










var QuestL7Crypt = /*#__PURE__*/function () {function QuestL7Crypt() {QuestL7Crypt_classCallCheck(this, QuestL7Crypt);QuestL7Crypt_defineProperty(this, "children",
    [
    new CryptL7DirtyMan(),
    new CryptL7Eyes(),
    new CryptL7Rattling(),
    new CryptL7Sprinters()]);QuestL7Crypt_defineProperty(this, "chest",

    external_kolmafia_.Item.get("Chest of the Bonerdagon"));}QuestL7Crypt_createClass(QuestL7Crypt, [{ key: "getLocations", value:

    function getLocations() {
      return [external_kolmafia_.Location.get("Haert of the Cyrpt")];
    } }, { key: "getChildren", value:

    function getChildren() {
      return this.children;
    } }, { key: "level", value:

    function level() {
      return 7;
    } }, { key: "status", value:

    function status() {
      var status = (0,external_kolmafia_.getProperty)("questL07Cyrptic");

      if (status == "finished") {
        return QuestStatus.COMPLETED;
      }

      // If we're too poor to buy a sword, too lazy to do more checks
      if ((0,external_kolmafia_.myMeat)() < 300) {
        return QuestStatus.NOT_READY;
      }

      // If we're ready for boss
      if (
      this.children.filter(function (c) {return c.status() != QuestStatus.COMPLETED;}).length ==
      0)
      {
        return QuestStatus.READY;
      }
      // Equip sword and retrocape
      // Then we gotta handle each zone specially. Item drop, ML, init and eh

      return QuestStatus.NOT_READY;
    } }, { key: "getId", value:

    function getId() {
      return "Council / Crypt / Boss";
    } }, { key: "run", value:

    function run() {var _this = this;
      return {
        location: external_kolmafia_.Location.get("Haert of the Cyrpt"),
        run: function run() {
          var props = new Properties_PropertyManager();
          props.setChoice(527, 1);

          try {
            greyAdv("crypt.php?action=heart");
          } finally {
            props.resetAll();
          }

          (0,external_kolmafia_.council)();

          if (
          !GreySettings_GreySettings.greyPrepareLevelingResources &&
          (0,external_kolmafia_.availableAmount)(_this.chest) > 0 &&
          (0,external_kolmafia_.myMeat)() < 6000)
          {
            (0,external_kolmafia_.use)(_this.chest);
          }
        }
      };
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestL7Crypt;}();


var CryptStatus;(function (CryptStatus) {CryptStatus[CryptStatus["FIGHT"] = 0] = "FIGHT";CryptStatus[CryptStatus["BOSS"] = 1] = "BOSS";CryptStatus[CryptStatus["FINISHED"] = 2] = "FINISHED";})(CryptStatus || (CryptStatus = {}));
;// CONCATENATED MODULE: ./src/quests/council/mountain/QuestL8MountainBoss.ts
function QuestL8MountainBoss_typeof(obj) {"@babel/helpers - typeof";return QuestL8MountainBoss_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL8MountainBoss_typeof(obj);}function QuestL8MountainBoss_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL8MountainBoss_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL8MountainBoss_toPropertyKey(descriptor.key), descriptor);}}function QuestL8MountainBoss_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL8MountainBoss_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL8MountainBoss_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL8MountainBoss_defineProperty(obj, key, value) {key = QuestL8MountainBoss_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL8MountainBoss_toPropertyKey(arg) {var key = QuestL8MountainBoss_toPrimitive(arg, "string");return QuestL8MountainBoss_typeof(key) === "symbol" ? key : String(key);}function QuestL8MountainBoss_toPrimitive(input, hint) {if (QuestL8MountainBoss_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL8MountainBoss_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestL8MountainBoss = /*#__PURE__*/function () {function QuestL8MountainBoss() {QuestL8MountainBoss_classCallCheck(this, QuestL8MountainBoss);QuestL8MountainBoss_defineProperty(this, "peak",
    external_kolmafia_.Location.get("Mist-shrouded Peak"));}QuestL8MountainBoss_createClass(QuestL8MountainBoss, [{ key: "getId", value:

    function getId() {
      return "Council / Ice / Boss";
    } }, { key: "level", value:

    function level() {
      return 8;
    } }, { key: "status", value:

    function status() {
      var status = this.getStatus();

      if (status == MountainStatus.finished) {
        return QuestStatus.COMPLETED;
      }

      if (status < MountainStatus.UNLOCKED_PEAK) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit().addWeight("cold res", 100, 5, 5);

      return {
        location: this.peak,
        outfit: outfit,
        freeRun: function freeRun() {return (0,external_kolmafia_.myMeat)() > 5000;},
        run: function run() {
          greyAdv("place.php?whichplace=mclargehuge&action=cloudypeak2", outfit);

          if (_this.getStatus() == MountainStatus.DEFEATED_BOAR) {
            _this.talkTrapper();
            (0,external_kolmafia_.council)();
          }
        }
      };
    } }, { key: "talkTrapper", value:

    function talkTrapper() {
      (0,external_kolmafia_.visitUrl)("place.php?whichplace=mclargehuge&action=trappercabin");
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.peak];
    } }, { key: "getStatus", value:

    function getStatus() {
      return getQuestStatus("questL08Trapper");
    } }]);return QuestL8MountainBoss;}();
;// CONCATENATED MODULE: ./src/quests/council/mountain/QuestL8MountainGoats.ts
function QuestL8MountainGoats_typeof(obj) {"@babel/helpers - typeof";return QuestL8MountainGoats_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL8MountainGoats_typeof(obj);}function QuestL8MountainGoats_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL8MountainGoats_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL8MountainGoats_toPropertyKey(descriptor.key), descriptor);}}function QuestL8MountainGoats_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL8MountainGoats_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL8MountainGoats_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL8MountainGoats_defineProperty(obj, key, value) {key = QuestL8MountainGoats_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL8MountainGoats_toPropertyKey(arg) {var key = QuestL8MountainGoats_toPrimitive(arg, "string");return QuestL8MountainGoats_typeof(key) === "symbol" ? key : String(key);}function QuestL8MountainGoats_toPrimitive(input, hint) {if (QuestL8MountainGoats_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL8MountainGoats_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestL8MountainGoats = /*#__PURE__*/function () {function QuestL8MountainGoats() {QuestL8MountainGoats_classCallCheck(this, QuestL8MountainGoats);QuestL8MountainGoats_defineProperty(this, "goats",
    external_kolmafia_.Location.get("The Goatlet"));QuestL8MountainGoats_defineProperty(this, "cheese",
    external_kolmafia_.Item.get("Goat Cheese"));QuestL8MountainGoats_defineProperty(this, "dairy",
    external_kolmafia_.Monster.get("Dairy Goat"));QuestL8MountainGoats_defineProperty(this, "elementalSkill",
    external_kolmafia_.Skill.get("Secondary Fermentation"));QuestL8MountainGoats_defineProperty(this, "drunk",
    external_kolmafia_.Monster.get("Drunk Goat"));QuestL8MountainGoats_defineProperty(this, "sysSweep",
    external_kolmafia_.Skill.get("System Sweep"));}QuestL8MountainGoats_createClass(QuestL8MountainGoats, [{ key: "getId", value:

    function getId() {
      return "Council / Ice / Goats";
    } }, { key: "level", value:

    function level() {
      return 8;
    } }, { key: "status", value:

    function status() {
      var status = this.getStatus();

      if (status < MountainStatus.TRAPPER_DEMANDS) {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.haveSkill)(this.elementalSkill)) {
        if (status > MountainStatus.TRAPPER_DEMANDS) {
          return QuestStatus.COMPLETED;
        }

        // If we have our cheese but not the ores
        if ((0,external_kolmafia_.availableAmount)(this.cheese) >= 3 && this.getOreRemaining() > 0) {
          return QuestStatus.COMPLETED;
        }
      }

      if (!(0,external_kolmafia_.haveSkill)(this.sysSweep)) {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return (
        this.hasEverything() && this.getStatus() == MountainStatus.TRAPPER_DEMANDS);

    } }, { key: "free", value:

    function free() {
      return this.mustBeDone();
    } }, { key: "getOreRemaining", value:

    function getOreRemaining() {
      return 3 - (0,external_kolmafia_.availableAmount)(this.neededOre());
    } }, { key: "neededOre", value:

    function neededOre() {
      return external_kolmafia_.Item.get((0,external_kolmafia_.getProperty)("trapperOre") || "asbestos ore");
    } }, { key: "talkTrapper", value:

    function talkTrapper() {
      (0,external_kolmafia_.visitUrl)("place.php?whichplace=mclargehuge&action=trappercabin");
    } }, { key: "hasEverything", value:

    function hasEverything() {
      return (0,external_kolmafia_.availableAmount)(this.cheese) >= 3 && this.getOreRemaining() <= 0;
    } }, { key: "run", value:

    function run() {var _this = this;
      if (this.hasEverything()) {
        return {
          location: null,
          run: function run() {
            _this.talkTrapper();
          }
        };
      }

      var outfit = new GreyOutfit().setItemDrops();

      return {
        location: this.goats,
        outfit: outfit,
        orbs: (0,external_kolmafia_.haveSkill)(this.elementalSkill) ? null : [this.drunk],
        olfaction: (0,external_kolmafia_.availableAmount)(this.cheese) >= 3 ? null : [this.dairy],
        run: function run() {
          var settings = new AdventureSettings();

          if (!(0,external_kolmafia_.haveSkill)(_this.elementalSkill)) {
            settings.addNoBanish(_this.drunk);
          }

          if (
          (0,external_kolmafia_.availableAmount)(_this.cheese) < 3 &&
          _this.getStatus() <= MountainStatus.TRAPPER_DEMANDS)
          {
            settings.addNoBanish(_this.dairy);
          }

          greyAdv(_this.goats, outfit, settings);

          if (_this.hasEverything()) {
            _this.talkTrapper();
          }
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.goats];
    } }, { key: "getStatus", value:

    function getStatus() {
      return getQuestStatus("questL08Trapper");
    } }]);return QuestL8MountainGoats;}();
;// CONCATENATED MODULE: ./src/quests/council/mountain/QuestL8MountainNinja.ts
function QuestL8MountainNinja_typeof(obj) {"@babel/helpers - typeof";return QuestL8MountainNinja_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL8MountainNinja_typeof(obj);}function QuestL8MountainNinja_toConsumableArray(arr) {return QuestL8MountainNinja_arrayWithoutHoles(arr) || QuestL8MountainNinja_iterableToArray(arr) || QuestL8MountainNinja_unsupportedIterableToArray(arr) || QuestL8MountainNinja_nonIterableSpread();}function QuestL8MountainNinja_nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function QuestL8MountainNinja_iterableToArray(iter) {if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);}function QuestL8MountainNinja_arrayWithoutHoles(arr) {if (Array.isArray(arr)) return QuestL8MountainNinja_arrayLikeToArray(arr);}function QuestL8MountainNinja_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestL8MountainNinja_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestL8MountainNinja_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestL8MountainNinja_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestL8MountainNinja_arrayLikeToArray(o, minLen);}function QuestL8MountainNinja_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestL8MountainNinja_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL8MountainNinja_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL8MountainNinja_toPropertyKey(descriptor.key), descriptor);}}function QuestL8MountainNinja_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL8MountainNinja_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL8MountainNinja_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL8MountainNinja_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestL8MountainNinja_setPrototypeOf(subClass, superClass);}function QuestL8MountainNinja_setPrototypeOf(o, p) {QuestL8MountainNinja_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestL8MountainNinja_setPrototypeOf(o, p);}function QuestL8MountainNinja_createSuper(Derived) {var hasNativeReflectConstruct = QuestL8MountainNinja_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestL8MountainNinja_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestL8MountainNinja_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestL8MountainNinja_possibleConstructorReturn(this, result);};}function QuestL8MountainNinja_possibleConstructorReturn(self, call) {if (call && (QuestL8MountainNinja_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestL8MountainNinja_assertThisInitialized(self);}function QuestL8MountainNinja_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestL8MountainNinja_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestL8MountainNinja_getPrototypeOf(o) {QuestL8MountainNinja_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestL8MountainNinja_getPrototypeOf(o);}function QuestL8MountainNinja_defineProperty(obj, key, value) {key = QuestL8MountainNinja_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL8MountainNinja_toPropertyKey(arg) {var key = QuestL8MountainNinja_toPrimitive(arg, "string");return QuestL8MountainNinja_typeof(key) === "symbol" ? key : String(key);}function QuestL8MountainNinja_toPrimitive(input, hint) {if (QuestL8MountainNinja_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL8MountainNinja_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}














var QuestL8MountainNinja = /*#__PURE__*/function (_TaskInfo) {QuestL8MountainNinja_inherits(QuestL8MountainNinja, _TaskInfo);var _super = QuestL8MountainNinja_createSuper(QuestL8MountainNinja);function QuestL8MountainNinja() {var _this;QuestL8MountainNinja_classCallCheck(this, QuestL8MountainNinja);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestL8MountainNinja_defineProperty(QuestL8MountainNinja_assertThisInitialized(_this), "ninja",
    external_kolmafia_.Location.get("Lair of the Ninja Snowmen"));QuestL8MountainNinja_defineProperty(QuestL8MountainNinja_assertThisInitialized(_this), "assassin",
    external_kolmafia_.Monster.get("Ninja snowman assassin"));QuestL8MountainNinja_defineProperty(QuestL8MountainNinja_assertThisInitialized(_this), "canHitCombat", void 0);QuestL8MountainNinja_defineProperty(QuestL8MountainNinja_assertThisInitialized(_this), "outfit",

    ["Ninja rope", "Ninja Crampons", "Ninja Carabiner"].map(
    function (s) {return external_kolmafia_.Item.get(s);}));QuestL8MountainNinja_defineProperty(QuestL8MountainNinja_assertThisInitialized(_this), "paths", void 0);QuestL8MountainNinja_defineProperty(QuestL8MountainNinja_assertThisInitialized(_this), "willNeedRecalculate",


    false);return _this;}QuestL8MountainNinja_createClass(QuestL8MountainNinja, [{ key: "createPaths", value:

    function createPaths(assumeUnstarted) {
      this.paths = [];
      this.willNeedRecalculate =
      assumeUnstarted || getQuestStatus("questL11Shen") < 4;

      var itemsNeeded = assumeUnstarted ?
      this.outfit :
      this.outfit.filter(function (i) {return (0,external_kolmafia_.availableAmount)(i) == 0;});

      if (itemsNeeded.length == 0) {
        this.paths.push(new PossiblePath(0));
        return;
      }

      // Lets work on the assumpsion that the player will definitely hit +25 at some point
      // Encounter rate is [Combat] / 200
      // So +25 is 12.5%
      var combatRate = 25;

      var getTurnsToEncounter = function getTurnsToEncounter(turns) {
        return Math.min(11, Math.ceil(1 / (combatRate / 200 + turns * 0.015)));
      };

      var plan = [];

      for (var i = 0; i < itemsNeeded.length; i++) {
        var turns = getTurnsToEncounter(8 * (1 + i));

        // If we have spent less than 11 turns here, adjust the turns needed downwards
        // Shen will come here..
        if (i == 0 && (assumeUnstarted || this.ninja.turnsSpent < 11)) {
          turns = Math.min(
          11 - Math.max(assumeUnstarted ? 0 : this.ninja.turnsSpent, 6));

        }

        plan.push(turns);
        plan.push(itemsNeeded[i]);
      }var _iterator = QuestL8MountainNinja_createForOfIteratorHelper(

        getAllCombinations(plan)),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var combo = _step.value;
          if (combo.length != itemsNeeded.length) {
            continue;
          }

          var _plan = new PossiblePath(
          combo.filter(function (c) {return typeof c == "number";}).reduce(function (a, b) {return a + b;}, 0));var _iterator2 = QuestL8MountainNinja_createForOfIteratorHelper(


            combo),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var item = _step2.value;
              if (typeof item == "number") {
                continue;
              }

              _plan.addPull(item);
            }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}

          this.paths.push(_plan);
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "getId", value:

    function getId() {
      return "Council / Ice / Ninjas";
    } }, { key: "level", value:

    function level() {
      return 8;
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }, { key: "status", value:

    function status(path) {
      var status = this.getStatus();

      if (status > MountainStatus.GET_OUTFIT) {
        return QuestStatus.COMPLETED;
      }

      if (status < MountainStatus.GET_OUTFIT || path == null) {
        return QuestStatus.NOT_READY;
      }

      if (
      this.canHitCombat == null &&
      QuestL8MountainNinja_toConsumableArray(Object.keys((0,external_kolmafia_.myEffects)())).
      map(function (e) {return (0,external_kolmafia_.toEffect)(e);}).
      find(function (e) {return (0,external_kolmafia_.numericModifier)(e, "Combat Rate") != 0;}) == null)
      {
        (0,external_kolmafia_.maximize)("+combat -acc3 -tie", true);

        this.canHitCombat =
        (0,external_kolmafia_.numericModifier)("Generated:_spec", "Combat Rate") >= 25;
      } else if (this.canHitCombat === false) {
        // If we're running +25 combat with no effects, then yes
        this.canHitCombat =
        (0,external_kolmafia_.numericModifier)("Combat Rate") >= 25 &&
        QuestL8MountainNinja_toConsumableArray(Object.keys((0,external_kolmafia_.myEffects)())).
        map(function (e) {return (0,external_kolmafia_.toEffect)(e);}).
        find(function (e) {return (0,external_kolmafia_.numericModifier)(e, "Combat Rate") > 0;}) == null;
      }

      if (hasNonCombatSkillActive()) {
        return QuestStatus.NOT_READY;
      }

      var outfitNeeded = this.outfit.filter(function (i) {return (0,external_kolmafia_.availableAmount)(i) == 0;});

      if (outfitNeeded.length == 0) {
        return QuestStatus.READY;
      }

      var shenTime = getQuestStatus("questL11Shen") < 4;

      if (this.willNeedRecalculate != shenTime) {
        return QuestStatus.READY;
      }

      if (
      shenTime &&
      outfitNeeded.length <= path.canUse(ResourceCategory.PULL) &&
      !currentPredictions().has(this.ninja))
      {
        return QuestStatus.NOT_READY;
      }

      var qStatus = shenTime ? QuestStatus.FASTER_LATER : QuestStatus.READY;

      if (this.canHitCombat || (0,external_kolmafia_.numericModifier)("Combat Rate") >= 25) {
        return qStatus;
      }

      // If we've reached snowman time but don't have the skill
      if (!hasCombatSkillReady()) {
        if ((0,external_kolmafia_.haveSkill)(external_kolmafia_.Skill.get("Piezoelectric Honk"))) {
          return QuestStatus.FASTER_LATER;
        }

        return QuestStatus.NOT_READY;
      }

      return qStatus;
    } }, { key: "getStatus", value:

    function getStatus() {
      return getQuestStatus("questL08Trapper");
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      if (
      this.willNeedRecalculate &&
      getQuestStatus("questL11Shen") >= 4 &&
      path != null &&
      path.canUse(ResourceCategory.PULL))
      {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {
            _this2.willNeedRecalculate = false;
            AdventureFinder.recalculatePath();
          }
        };
      }

      var outfitNeeded = this.outfit.filter(function (i) {return (0,external_kolmafia_.availableAmount)(i) == 0;});

      // See if we can unlock peak yet
      if (outfitNeeded.length == 0 || path == null) {
        return {
          location: null,
          run: function run() {
            if ((0,external_kolmafia_.numericModifier)("Cold Resistance") < 5) {
              (0,external_kolmafia_.maximize)("cold res -tie", false);
            }

            (0,external_kolmafia_.visitUrl)("place.php?whichplace=mclargehuge&action=cloudypeak");
          }
        };
      }

      var shenTime = getQuestStatus("questL11Shen") < 4;

      if (
      outfitNeeded.length <= path.canUse(ResourceCategory.PULL) &&
      !shenTime)
      {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {
            var pulls = path.canUse(ResourceCategory.PULL);

            for (var i = 0; i < pulls; i++) {
              GreyPulls.tryPull(outfitNeeded[i]);
              path.addUsed(ResourceCategory.PULL);
            }
          }
        };
      }

      var outfit = new GreyOutfit().setPlusCombat();
      outfit.initWeight = 0.5;

      outfit.addDelayer(DelayCriteria().withForcedFights(null));

      return {
        location: this.ninja,
        outfit: outfit,
        freeRun: function freeRun(monster) {return monster != _this2.assassin;},
        run: function run() {
          restoreHPTo(70);

          if (DelayBurners.isTryingForDupeableGoblin()) {
            (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Grey Goose"));
          }

          greyAdv(_this2.ninja, outfit);
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.ninja];
    } }]);return QuestL8MountainNinja;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/mountain/QuestL8MountainOre.ts
function QuestL8MountainOre_typeof(obj) {"@babel/helpers - typeof";return QuestL8MountainOre_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL8MountainOre_typeof(obj);}function QuestL8MountainOre_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestL8MountainOre_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestL8MountainOre_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestL8MountainOre_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestL8MountainOre_arrayLikeToArray(o, minLen);}function QuestL8MountainOre_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestL8MountainOre_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL8MountainOre_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL8MountainOre_toPropertyKey(descriptor.key), descriptor);}}function QuestL8MountainOre_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL8MountainOre_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL8MountainOre_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL8MountainOre_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestL8MountainOre_setPrototypeOf(subClass, superClass);}function QuestL8MountainOre_setPrototypeOf(o, p) {QuestL8MountainOre_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestL8MountainOre_setPrototypeOf(o, p);}function QuestL8MountainOre_createSuper(Derived) {var hasNativeReflectConstruct = QuestL8MountainOre_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestL8MountainOre_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestL8MountainOre_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestL8MountainOre_possibleConstructorReturn(this, result);};}function QuestL8MountainOre_possibleConstructorReturn(self, call) {if (call && (QuestL8MountainOre_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestL8MountainOre_assertThisInitialized(self);}function QuestL8MountainOre_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestL8MountainOre_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestL8MountainOre_getPrototypeOf(o) {QuestL8MountainOre_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestL8MountainOre_getPrototypeOf(o);}function QuestL8MountainOre_defineProperty(obj, key, value) {key = QuestL8MountainOre_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL8MountainOre_toPropertyKey(arg) {var key = QuestL8MountainOre_toPrimitive(arg, "string");return QuestL8MountainOre_typeof(key) === "symbol" ? key : String(key);}function QuestL8MountainOre_toPrimitive(input, hint) {if (QuestL8MountainOre_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL8MountainOre_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}















var QuestL8MountainOre = /*#__PURE__*/function (_TaskInfo) {QuestL8MountainOre_inherits(QuestL8MountainOre, _TaskInfo);var _super = QuestL8MountainOre_createSuper(QuestL8MountainOre);function QuestL8MountainOre() {var _this;QuestL8MountainOre_classCallCheck(this, QuestL8MountainOre);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestL8MountainOre_defineProperty(QuestL8MountainOre_assertThisInitialized(_this), "mountainMan",
    external_kolmafia_.Monster.get("Mountain Man"));QuestL8MountainOre_defineProperty(QuestL8MountainOre_assertThisInitialized(_this), "goose",
    external_kolmafia_.Familiar.get("Grey Goose"));QuestL8MountainOre_defineProperty(QuestL8MountainOre_assertThisInitialized(_this), "nanovision",
    external_kolmafia_.Skill.get("Double Nanovision"));QuestL8MountainOre_defineProperty(QuestL8MountainOre_assertThisInitialized(_this), "wish",
    external_kolmafia_.Item.get("Pocket Wish"));QuestL8MountainOre_defineProperty(QuestL8MountainOre_assertThisInitialized(_this), "mines",
    external_kolmafia_.Location.get("Itznotyerzitz Mine"));QuestL8MountainOre_defineProperty(QuestL8MountainOre_assertThisInitialized(_this), "needRecalculate", void 0);QuestL8MountainOre_defineProperty(QuestL8MountainOre_assertThisInitialized(_this), "burglar",

    external_kolmafia_.Familiar.get("Cat Burglar"));QuestL8MountainOre_defineProperty(QuestL8MountainOre_assertThisInitialized(_this), "faxAndGooseDupe", void 0);QuestL8MountainOre_defineProperty(QuestL8MountainOre_assertThisInitialized(_this), "failsafeBackup", void 0);QuestL8MountainOre_defineProperty(QuestL8MountainOre_assertThisInitialized(_this), "paths",


    []);QuestL8MountainOre_defineProperty(QuestL8MountainOre_assertThisInitialized(_this), "asbestos",
    external_kolmafia_.Item.get("asbestos ore"));QuestL8MountainOre_defineProperty(QuestL8MountainOre_assertThisInitialized(_this), "linoleum",
    external_kolmafia_.Item.get("linoleum ore"));QuestL8MountainOre_defineProperty(QuestL8MountainOre_assertThisInitialized(_this), "chrome",
    external_kolmafia_.Item.get("chrome ore"));QuestL8MountainOre_defineProperty(QuestL8MountainOre_assertThisInitialized(_this), "trainset",
    external_kolmafia_.Item.get("model train set"));QuestL8MountainOre_defineProperty(QuestL8MountainOre_assertThisInitialized(_this), "cmc",
    external_kolmafia_.Item.get("Cold Medicine Cabinet"));return _this;}QuestL8MountainOre_createClass(QuestL8MountainOre, [{ key: "getId", value:

    function getId() {
      return "Council / Ice / Ore";
    } }, { key: "level", value:

    function level() {
      return 8;
    } }, { key: "getOreRemaining", value:

    function getOreRemaining() {
      return 3 - (0,external_kolmafia_.availableAmount)(this.neededOre());
    } }, { key: "neededOre", value:

    function neededOre() {
      return external_kolmafia_.Item.get((0,external_kolmafia_.getProperty)("trapperOre") || "linoleum ore");
    } }, { key: "talkTrapper", value:

    function talkTrapper() {
      (0,external_kolmafia_.visitUrl)("place.php?whichplace=mclargehuge&action=trappercabin");
    } }, { key: "canPull", value:

    function canPull() {
      return (
        (0,external_kolmafia_.pullsRemaining)() != 0 &&
        !(0,external_kolmafia_.getProperty)("_roninStoragePulls").
        split(",").
        includes((0,external_kolmafia_.toInt)(this.neededOre()).toString()));

    } }, { key: "isHeistReady", value:

    function isHeistReady() {
      return (
        (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("catBurglarBankHeists")) > 0 ||
        (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_catBurglarCharge")) >= 10);

    } }, { key: "hasHeistedAlready", value:

    function hasHeistedAlready() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_catBurglarHeistsComplete")) > 0;
    } }, { key: "hasFamiliarRecommendation", value:

    function hasFamiliarRecommendation() {
      if (!(0,external_kolmafia_.haveFamiliar)(this.burglar)) {
        return null;
      }

      if (this.isHeistReady() || this.hasHeistedAlready()) {
        return null;
      }

      return this.burglar;
    } }, { key: "willUseTrainset", value:

    function willUseTrainset() {
      return (
        isTrainsetInUse() ||
        (0,external_kolmafia_.getWorkshed)() == this.cmc &&
        (0,external_kolmafia_.itemAmount)(this.trainset) > 0 &&
        GreySettings_GreySettings.greySwitchWorkshed == "Model train set");

    } }, { key: "createPaths", value:

    function createPaths(assumeUnstarted) {
      if (this.willUseTrainset()) {
        this.paths = [new PossiblePath(0)];
        return;
      }

      this.paths = [];

      this.needRecalculate = this.getStatus() < MountainStatus.TRAPPER_DEMANDS;
      this.faxAndGooseDupe = new PossiblePath(1).
      add(ResourceCategory.YELLOW_RAY).
      addFax(this.mountainMan);
      this.failsafeBackup = new PossiblePath(1).add(ResourceCategory.COPIER);

      if (this.doDuping()) {
        this.paths.push(this.faxAndGooseDupe);
      }

      if (this.canBackup()) {
        this.paths.push(this.failsafeBackup);
      }

      var resourceTypes = [];
      var needOres = assumeUnstarted ? 3 : this.getOreRemaining();

      for (var i = 0; i < needOres; i++) {
        resourceTypes.push(ResourceCategory.CLOVER);
        resourceTypes.push(ResourceCategory.POLAR_VORTEX);
      }

      resourceTypes.push(ResourceCategory.FAXER);
      resourceTypes.push(ResourceCategory.YELLOW_RAY);
      resourceTypes.push(ResourceCategory.COPIER);
      resourceTypes.push(ResourceCategory.CAT_HEIST);
      resourceTypes.push(ResourceCategory.PULL);

      resourceTypes.push(ResourceCategory.DECK_OF_EVERY_CARD_CHEAT);

      var allCombinations = getAllCombinations(resourceTypes);var _iterator = QuestL8MountainOre_createForOfIteratorHelper(

        allCombinations),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var combo = _step.value;
          var oresExpected = combo.
          map(function (res) {return (
              res == ResourceCategory.YELLOW_RAY ?
              2 :
              res == ResourceCategory.PULL ||
              res == ResourceCategory.COPIER ||
              res == ResourceCategory.CLOVER ||
              res == ResourceCategory.CAT_HEIST ?
              1 :
              0);}).

          reduce(function (p, n) {return p + n;}, 0);

          // If this doesn't use a fax
          if (!combo.includes(ResourceCategory.FAXER)) {
            // Remove combinations that require a mountain man
            if (
            combo.includes(ResourceCategory.COPIER) ||
            combo.includes(ResourceCategory.POLAR_VORTEX) ||
            combo.includes(ResourceCategory.YELLOW_RAY))
            {
              continue;
            }

            // If the combo requires a cat heist, and a heist cannot be performed
            if (
            combo.includes(ResourceCategory.CAT_HEIST) && (
            assumeUnstarted ||
            needOres != 1 ||
            !this.isHeistReady() ||
            this.hasHeistedAlready() ||
            !this.isHeistable()))
            {
              continue;
            }
          }

          // If this combination wouldn't give enough ores
          if (oresExpected < needOres || oresExpected > needOres) {
            continue;
          }

          var advs = combo.filter(
          function (res) {return (
              res == ResourceCategory.CLOVER ||
              res == ResourceCategory.FAXER ||
              res == ResourceCategory.COPIER);}).
          length;

          var path = new PossiblePath(advs);
          var addedPolar = false;var _iterator3 = QuestL8MountainOre_createForOfIteratorHelper(

            combo),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var res = _step3.value;
              // If this is a polar and we already did a polar and doing a yellow ray, or this is something we're doing after the mountain man
              var doMaybe =
              combo.includes(ResourceCategory.YELLOW_RAY) &&
              combo.includes(ResourceCategory.POLAR_VORTEX) && (
              res == ResourceCategory.POLAR_VORTEX ?
              addedPolar :
              res != ResourceCategory.FAXER &&
              res != ResourceCategory.YELLOW_RAY) ?
              0.33 :
              1;

              if (res == ResourceCategory.PULL) {
                path.addConsumablePull(this.neededOre());
              } else if (res == ResourceCategory.FAXER) {
                path.addFax(this.mountainMan, doMaybe ? 0.33 : 1);
              } else {
                path.addMaybe(res, doMaybe ? 0.33 : 1);
                addedPolar = addedPolar || res == ResourceCategory.POLAR_VORTEX;
              }
            }} catch (err) {_iterator3.e(err);} finally {_iterator3.f();}

          this.paths.push(path);

          // If this is a fax, and we're not doing a heist or a copier
          if (
          combo.includes(ResourceCategory.FAXER) &&
          !combo.includes(ResourceCategory.COPIER) &&
          !combo.includes(ResourceCategory.CAT_HEIST))
          {
            var cargoShorts = path.clone();
            cargoShorts.advsSavedMin -= 1;
            cargoShorts.advsSavedMax -= 1;

            cargoShorts.resourcesNeeded.forEach(function (res) {
              if (res[0] == ResourceCategory.FAXER) {
                res[0] = ResourceCategory.CARGO_SHORTS;
              }
            });

            if (!cargoShorts.ignoreResources.includes("Cosplay Saber")) {
              cargoShorts.addIgnored("Cosplay Saber");
            }

            this.paths.push(cargoShorts);
          }
        }

        // Ignore cosplay saber for any path that requires a proper fight finishing blow
      } catch (err) {_iterator.e(err);} finally {_iterator.f();}var _iterator2 = QuestL8MountainOre_createForOfIteratorHelper(this.paths),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var _path = _step2.value;
          if (
          _path.canUse(ResourceCategory.CAT_HEIST) == 0 &&
          _path.canUse(ResourceCategory.COPIER) == 0)
          {
            continue;
          }

          _path.addIgnored("Cosplay Saber");
        }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "getStatus", value:

    function getStatus() {
      return getQuestStatus("questL08Trapper");
    } }, { key: "status", value:

    function status(path) {
      if (this.willUseTrainset()) {
        return QuestStatus.COMPLETED;
      }

      var status = this.getStatus();

      if (status < MountainStatus.TRAPPER_DEMANDS) {
        return QuestStatus.NOT_READY;
      }

      if (status > MountainStatus.TRAPPER_DEMANDS) {
        return QuestStatus.COMPLETED;
      }

      if (this.getOreRemaining() <= 0) {
        return QuestStatus.COMPLETED;
      }

      if (this.needRecalculate) {
        return QuestStatus.READY;
      }

      if (path == null) {
        return QuestStatus.READY;
      }

      if (path.canUse(ResourceCategory.CAT_HEIST) && !this.isHeistReady()) {
        return QuestStatus.NOT_READY;
      }

      if (path == this.faxAndGooseDupe && !this.doDuping()) {
        return QuestStatus.NOT_READY;
      }

      if (
      this.lastBackup() == this.mountainMan && (
      path.canUse(ResourceCategory.COPIER) ||
      path.canUse(ResourceCategory.CAT_HEIST)))
      {
        return QuestStatus.READY;
      }

      if (
      (0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("Brother Corsican's Blessing")) +
      (0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("A Girl Named Sue")) >
      0)
      {
        return QuestStatus.NOT_READY;
      }

      // If we haven't started this yet
      if (path.canUse(ResourceCategory.YELLOW_RAY)) {
        // If we have yellow ray active, or can't afford it
        if (!path.getResource(ResourceCategory.YELLOW_RAY).ready()) {
          return QuestStatus.NOT_READY;
        }

        // If we're doing a goose dupe
        if (this.doDuping()) {
          // If goose couldn't dupe
          if ((0,external_kolmafia_.familiarWeight)(this.goose) < 6) {
            return QuestStatus.NOT_READY;
          }
        } else if (!(0,external_kolmafia_.haveSkill)(this.nanovision)) {
          // If we don't have nanovision, and this will want to maybe do a backup, better delay.
          if (path.canUse(ResourceCategory.COPIER)) {
            return QuestStatus.NOT_READY;
          }
        }
      }

      return QuestStatus.READY;
    } }, { key: "mustBeDone", value:

    function mustBeDone(reallyMustBeDone) {
      if (this.canBackup() || this.needRecalculate) {
        return true;
      }

      if (this.getOreRemaining() < 3) {
        return true;
      }

      if ((0,external_kolmafia_.myLevel)() < 12) {
        return false;
      }

      if (this.isHeistReady() && this.isHeistable()) {
        return true;
      }

      if ((0,external_kolmafia_.myAdventures)() < 40) {
        return false;
      }

      if (reallyMustBeDone) {
        return false;
      }

      if (
      this.doDuping() &&
      (0,external_kolmafia_.familiarWeight)(this.goose) >= this.famWeightToDupe())
      {
        return true;
      }

      return true;
    } }, { key: "lastBackup", value:

    function lastBackup() {
      return (0,external_kolmafia_.getProperty)("lastCopyableMonster") == "" ?
      null :
      external_kolmafia_.Monster.get((0,external_kolmafia_.getProperty)("lastCopyableMonster"));
    } }, { key: "canBackup", value:

    function canBackup() {
      return this.hasBackups() && this.lastBackup() == this.mountainMan;
    } }, { key: "hasBackups", value:

    function hasBackups() {
      return getBackupsRemaining() > 0;
    } }, { key: "doPull", value:

    function doPull(path) {
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          GreyPulls.pullOre();

          path.addUsed(ResourceCategory.PULL);
        }
      };
    } }, { key: "doPackOfCardsCheat", value:

    function doPackOfCardsCheat(path) {
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          path.
          getResource(ResourceCategory.DECK_OF_EVERY_CARD_CHEAT).
          pickCard("Mine");
          path.addUsed(ResourceCategory.PULL);
        }
      };
    } }, { key: "doCopier", value:

    function doCopier(path) {
      var outfit = new GreyOutfit().setItemDrops();
      var loc = external_kolmafia_.Location.get("The Dire Warren");

      var resource = path.getResource(ResourceCategory.COPIER);

      resource.prepare(outfit);

      return {
        location: loc,
        outfit: outfit,
        run: function run() {
          greyAdv(
          loc,
          outfit,
          new AdventureSettings().setStartOfFightMacro(
          new Macro().if_(
          external_kolmafia_.Monster.get("Fluffy Bunny"),
          path.getResource(ResourceCategory.COPIER).macro())));




          path.addUsed(ResourceCategory.COPIER);
        }
      };
    } }, { key: "isHeistable", value:

    function isHeistable() {
      if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_catBurglarCharge")) < 11) {
        return false;
      }

      var foundOre = Object.keys((0,external_kolmafia_.heistTargets)()).find(
      function (k) {return k.toLowerCase() == "mountain man";});


      // Get out of the choice
      (0,external_kolmafia_.visitUrl)("main.php");

      return foundOre != null;
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      if (this.needRecalculate) {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {
            _this2.createPaths(false);
            AdventureFinder.recalculatePath();
          }
        };
      }

      if (
      this.getOreRemaining() < 3 &&
      path.canUse(ResourceCategory.CAT_HEIST) &&
      this.isHeistable())
      {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {
            path.
            getResource(ResourceCategory.CAT_HEIST).
            doHeist(_this2.neededOre());
          }
        };
      }

      if (
      path.canUse(ResourceCategory.FAXER) ||
      path.canUse(ResourceCategory.CARGO_SHORTS))
      {
        return this.doFaxers(path);
      }

      if (path.canUse(ResourceCategory.CLOVER)) {
        return this.doClover(path);
      }

      if (path.canUse(ResourceCategory.PULL) > 0) {
        return this.doPull(path);
      }

      if (path.canUse(ResourceCategory.COPIER)) {
        return this.doCopier(path);
      }

      if (path.canUse(ResourceCategory.DECK_OF_EVERY_CARD_CHEAT)) {
        return this.doPackOfCardsCheat(path);
      }

      throw "Not sure what we should be doing";
    } }, { key: "doClover", value:

    function doClover(path) {var _this3 = this;
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          while (path.canUse(ResourceCategory.CLOVER)) {
            (0,external_kolmafia_.use)(external_kolmafia_.Item.get("11-leaf clover"));
            greyAdv(_this3.mines);
            path.addUsed(ResourceCategory.CLOVER);
          }
        }
      };
    } }, { key: "doFaxers", value:

    function doFaxers(path) {var _this4 = this;
      var outfit = new GreyOutfit();
      outfit.addWeight("DA").addWeight("DR").addWeight("ML", -1);

      if (path.canUse(ResourceCategory.POLAR_VORTEX) > 0) {
        path.getResource(ResourceCategory.POLAR_VORTEX).prepare(outfit);
      }

      if (path.canUse(ResourceCategory.YELLOW_RAY)) {
        path.getResource(ResourceCategory.YELLOW_RAY).prepare(outfit);
      }

      return {
        location: null,
        outfit: outfit,
        familiar: path.canUse(ResourceCategory.CAT_HEIST) ? this.burglar : null,
        disableFamOverride: path.canUse(ResourceCategory.CAT_HEIST) > 0,
        run: function run() {
          if (_this4.doDuping()) {
            (0,external_kolmafia_.useFamiliar)(_this4.goose);
          } else if (
          path.canUse(ResourceCategory.CAT_HEIST) &&
          _this4.isHeistReady())
          {
            (0,external_kolmafia_.useFamiliar)(_this4.burglar);
          } else if (
          _this4.getOreRemaining() == 3 &&
          !path.canUse(ResourceCategory.PULL) &&
          !path.canUse(ResourceCategory.COPIER) &&
          !path.canUse(ResourceCategory.POLAR_VORTEX) &&
          !path.canUse(ResourceCategory.CLOVER))
          {
            throw "Something seems wrong, trying to call a faxer but we can probably only get 2 ores";
          }

          var macro = new Macro();

          var props = new Properties_PropertyManager();

          try {
            var yr = path.getResource(ResourceCategory.YELLOW_RAY);

            if (yr != null) {
              yr.prepare(null, props);
            }

            if (path.canUse(ResourceCategory.FAXER)) {
              path.getResource(ResourceCategory.FAXER).fax(_this4.mountainMan);
              path.addUsed(ResourceCategory.FAXER);
            } else if (path.canUse(ResourceCategory.CARGO_SHORTS)) {
              path.getResource(ResourceCategory.CARGO_SHORTS).pocket(565);
              path.addUsed(ResourceCategory.CARGO_SHORTS);
            } else {
              throw "No way to start a mountain man combat!";
            }

            if ((0,external_kolmafia_.currentRound)() == 0) {
              throw "I should be in combat!";
            }

            if (_this4.doDuping()) {
              macro = macro.skill(external_kolmafia_.Skill.get("Emit Matter Duplicating Drones"));
            } else if (path.canUse(ResourceCategory.POLAR_VORTEX)) {
              while (
              path.canUse(ResourceCategory.POLAR_VORTEX) &&
              _this4.getOreRemaining() > 2)
              {
                (0,external_kolmafia_.print)("Drop my ore dammit!", "red");
                path.getResource(ResourceCategory.POLAR_VORTEX).macro().submit();
                path.addUsed(ResourceCategory.POLAR_VORTEX);
              }

              if (_this4.getOreRemaining() > 2) {
                (0,external_kolmafia_.print)(
                "Drat. We're going to have to get the last ore another way.",
                "red");

              }
            }

            if (yr != null) {
              macro.step(yr.macro());
            }

            greyAdv(
            "main.php",
            outfit,
            new AdventureSettings().setStartOfFightMacro(macro));

          } finally {
            props.resetAll();
          }

          if ((0,external_kolmafia_.currentRound)() != 0 || (0,external_kolmafia_.handlingChoice)()) {
            throw "Expected to have fight finished!";
          }
        }
      };
    } }, { key: "doDuping", value:

    function doDuping() {
      return (0,external_kolmafia_.familiarWeight)(this.goose) >= this.famWeightToDupe();
    } }, { key: "famWeightToDupe", value:

    function famWeightToDupe() {
      if (this.neededOre() == this.asbestos) {
        return 6;
      } else if (this.neededOre() == this.linoleum) {
        return 8;
      } else if (this.neededOre() == this.chrome) {
        return 10;
      } else {
        throw "Unknown ore";
      }
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestL8MountainOre;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/QuestL8IcePeak.ts
function QuestL8IcePeak_typeof(obj) {"@babel/helpers - typeof";return QuestL8IcePeak_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL8IcePeak_typeof(obj);}function QuestL8IcePeak_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL8IcePeak_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL8IcePeak_toPropertyKey(descriptor.key), descriptor);}}function QuestL8IcePeak_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL8IcePeak_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL8IcePeak_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL8IcePeak_defineProperty(obj, key, value) {key = QuestL8IcePeak_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL8IcePeak_toPropertyKey(arg) {var key = QuestL8IcePeak_toPrimitive(arg, "string");return QuestL8IcePeak_typeof(key) === "symbol" ? key : String(key);}function QuestL8IcePeak_toPrimitive(input, hint) {if (QuestL8IcePeak_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL8IcePeak_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}








var QuestL8IcePeak = /*#__PURE__*/function () {


  function QuestL8IcePeak() {QuestL8IcePeak_classCallCheck(this, QuestL8IcePeak);QuestL8IcePeak_defineProperty(this, "children", []);
    this.children.push(new QuestL8MountainGoats());
    this.children.push(new QuestL8MountainOre());
    this.children.push(new QuestL8MountainNinja());
    this.children.push(new QuestL8MountainBoss());
  }QuestL8IcePeak_createClass(QuestL8IcePeak, [{ key: "getChildren", value:

    function getChildren() {
      return this.children;
    } }, { key: "level", value:

    function level() {
      return 8;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL08Trapper");

      if (status > 0) {
        return QuestStatus.COMPLETED;
      }

      if (status < 0) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return true;
    } }, { key: "free", value:

    function free() {
      return true;
    } }, { key: "getId", value:

    function getId() {
      return "Council / Ice / Trapper";
    } }, { key: "run", value:

    function run() {var _this = this;
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          _this.talkTrapper();
        }
      };
    } }, { key: "getStatus", value:

    function getStatus() {
      return getQuestStatus("questL08Trapper");
    } }, { key: "talkTrapper", value:

    function talkTrapper() {
      (0,external_kolmafia_.visitUrl)("place.php?whichplace=mclargehuge&action=trappercabin");
    } }]);return QuestL8IcePeak;}();


var MountainStatus;(function (MountainStatus) {MountainStatus[MountainStatus["started"] = 0] = "started";MountainStatus[MountainStatus["TRAPPER_DEMANDS"] = 1] = "TRAPPER_DEMANDS";MountainStatus[MountainStatus["GET_OUTFIT"] = 2] = "GET_OUTFIT";MountainStatus[MountainStatus["UNLOCKED_PEAK"] = 3] = "UNLOCKED_PEAK";MountainStatus[MountainStatus["FIGHTING_YETI"] = 4] = "FIGHTING_YETI";MountainStatus[MountainStatus["DEFEATED_BOAR"] = 5] = "DEFEATED_BOAR";MountainStatus[MountainStatus["finished"] = 100] = "finished";})(MountainStatus || (MountainStatus = {}));
;// CONCATENATED MODULE: ./src/quests/council/peaks/QuestL9MurderPeak.ts
function QuestL9MurderPeak_typeof(obj) {"@babel/helpers - typeof";return QuestL9MurderPeak_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL9MurderPeak_typeof(obj);}function QuestL9MurderPeak_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestL9MurderPeak_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestL9MurderPeak_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestL9MurderPeak_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestL9MurderPeak_arrayLikeToArray(o, minLen);}function QuestL9MurderPeak_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestL9MurderPeak_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL9MurderPeak_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL9MurderPeak_toPropertyKey(descriptor.key), descriptor);}}function QuestL9MurderPeak_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL9MurderPeak_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL9MurderPeak_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL9MurderPeak_defineProperty(obj, key, value) {key = QuestL9MurderPeak_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL9MurderPeak_toPropertyKey(arg) {var key = QuestL9MurderPeak_toPrimitive(arg, "string");return QuestL9MurderPeak_typeof(key) === "symbol" ? key : String(key);}function QuestL9MurderPeak_toPrimitive(input, hint) {if (QuestL9MurderPeak_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL9MurderPeak_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}








var MurderHandler = /*#__PURE__*/function () {function MurderHandler() {QuestL9MurderPeak_classCallCheck(this, MurderHandler);QuestL9MurderPeak_defineProperty(this, "crude",
    external_kolmafia_.Item.get("Bubblin' Crude"));QuestL9MurderPeak_defineProperty(this, "jar",
    external_kolmafia_.Item.get("Jar of Oil"));QuestL9MurderPeak_defineProperty(this, "rusty",
    external_kolmafia_.Item.get("Rusty Hedge Trimmers"));QuestL9MurderPeak_defineProperty(this, "loc",
    external_kolmafia_.Location.get("Twin Peak"));QuestL9MurderPeak_defineProperty(this, "trimmerMonsters",
    [
    "bearpig topiary animal",
    "elephant (meatcar?) topiary animal",
    "spider (duck?) topiary animal"].
    map(function (s) {return external_kolmafia_.Monster.get(s);}));QuestL9MurderPeak_defineProperty(this, "skill",
    external_kolmafia_.Skill.get("Conifer Polymers"));QuestL9MurderPeak_defineProperty(this, "hasRes",
    false);QuestL9MurderPeak_defineProperty(this, "resCheckIn",
    0);QuestL9MurderPeak_defineProperty(this, "orb",
    external_kolmafia_.Item.get("miniature crystal ball"));QuestL9MurderPeak_defineProperty(this, "canOfPaint",
    external_kolmafia_.Item.get("Can of black paint"));QuestL9MurderPeak_defineProperty(this, "paintEffect",
    external_kolmafia_.Effect.get("Red Door Syndrome"));}QuestL9MurderPeak_createClass(MurderHandler, [{ key: "getId", value:

    function getId() {
      return "Council / Peaks / TwinPeak";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }, { key: "level", value:

    function level() {
      return 7;
    } }, { key: "status", value:

    function status() {
      if (getQuestStatus("questL09Topping") < 1) {
        return QuestStatus.NOT_READY;
      }

      if (this.isComplete()) {
        return QuestStatus.COMPLETED;
      }

      var status = hasNonCombatSkillsReady() ?
      QuestStatus.READY :
      QuestStatus.FASTER_LATER;

      if (this.questNeedsJar()) {
        this.createJar();

        if (this.hasJar()) {
          return status;
        }
      }

      if (
      this.questNeedsFood() &&
      (0,external_kolmafia_.haveSkill)(external_kolmafia_.Skill.get("Gravitational Compression")))
      {
        return status;
      }

      if (this.questNeedsInit()) {
        return status;
      }

      if (this.questNeedsStenchRes()) {
        if (getQuestStatus("questL11Black") <= 2 || (0,external_kolmafia_.myMeat)() < 1200) {
          return QuestStatus.NOT_READY;
        }

        if (!this.hasRes && this.resCheckIn < (0,external_kolmafia_.turnsPlayed)()) {
          this.resCheckIn = (0,external_kolmafia_.turnsPlayed)() + 5;

          (0,external_kolmafia_.maximize)("stench res -tie", true);
          this.hasRes =
          (0,external_kolmafia_.numericModifier)("Generated:_spec", "Stench Resistance") >= (
          (0,external_kolmafia_.haveEffect)(this.paintEffect) ? 4 : 2);
        }

        if (this.hasRes) {
          return status;
        }
      }

      return QuestStatus.NOT_READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();

      if ((0,external_kolmafia_.availableAmount)(this.rusty) == 0) {
        outfit.setNoCombat();

        var preds = currentPredictions();

        if (
        !preds.has(this.loc) ||
        (0,external_kolmafia_.itemDrops)(preds.get(this.loc))[this.rusty.name] != null)
        {
          outfit.setItemDrops();
        }
      }

      this.createJar();

      if (this.questNeedsJar() && this.hasJar()) {

        // Empty
      } else if (this.questNeedsFood()) {outfit.addWeight("item drop", 100, 50, 50);
      } else if (this.questNeedsInit()) {
        outfit.addWeight("init", 100, 40, 40);
      } else if (this.questNeedsStenchRes()) {
        outfit.addWeight("stench res", 1000000, 4, 4);
      }

      return {
        location: this.loc,
        outfit: outfit,
        orbs: this.trimmerMonsters,
        run: function run() {
          var props = new Properties_PropertyManager();
          //cliExecute("retrocape vampire hold");
          /* if (getProperty("backupCameraMode") != "init") {
            cliExecute("backupcamera init");
          }*/

          props.setChoice(1056, 1);
          props.setChoice(604, 1);
          props.setChoice(607, 1);
          props.setChoice(608, 1);
          props.setChoice(609, 1);
          props.setChoice(610, 1);
          props.setChoice(616, 1);

          try {
            if (_this.questNeedsJar() && _this.hasJar()) {
              props.setChoice(606, 3);
            } else if (
            _this.questNeedsStenchRes() &&
            (0,external_kolmafia_.numericModifier)("Stench Resistance") >= (
            (0,external_kolmafia_.haveEffect)(_this.paintEffect) ? 4 : 2))
            {
              props.setChoice(606, 1);

              if (
              (0,external_kolmafia_.numericModifier)("Stench Resistance") < 4 &&
              (0,external_kolmafia_.haveEffect)(_this.paintEffect) == 0)
              {
                (0,external_kolmafia_.use)(_this.canOfPaint);
              }
            } else if (_this.questNeedsFood() && (0,external_kolmafia_.itemDropModifier)() >= 50) {
              props.setChoice(606, 2);
            } else if (
            _this.questNeedsInit() &&
            (0,external_kolmafia_.numericModifier)("initiative") >= 40)
            {
              props.setChoice(606, 4);
            } else {
              throw "Eh?? We're at murder peak, but we don't match the criteria for any of the choices. Jar? ".concat(_this.questNeedsJar(), ", ").concat(_this.hasJar(), ", Stench Res? ").concat(_this.questNeedsStenchRes(), ", ").concat((0,external_kolmafia_.numericModifier)(
              "Stench Resistance"), ", , food? ").concat(
              _this.questNeedsFood(), " ").concat((0,external_kolmafia_.itemDropModifier)(), ", Init? ").concat(_this.questNeedsInit(), " ").concat((0,external_kolmafia_.numericModifier)(
              "initiative"), ". Maybe you need stench res, but the script can't find it for you?");

            }

            if ((0,external_kolmafia_.availableAmount)(_this.rusty) > 0) {
              var predictions = (0,external_kolmafia_.getProperty)("crystalBallPredictions").split(
              "|");


              greyAdv(
              "inv_use.php?pwd=&which=3&whichitem=" +
              (0,external_kolmafia_.toInt)(_this.rusty) +
              "&ajax=1");


              if ((0,external_kolmafia_.availableAmount)(_this.orb) > 0) {
                (0,external_kolmafia_.visitUrl)("inventory.php?ponder=1", false);
                var newPredictions = (0,external_kolmafia_.getProperty)("crystalBallPredictions").
                split("|").
                map(function (s) {
                  if (
                  !s.startsWith((0,external_kolmafia_.turnsPlayed)() + ":Twin Peak:") ||
                  predictions.includes(s))
                  {
                    return s;
                  }

                  return (0,external_kolmafia_.turnsPlayed)() - 1 + s.substring(s.indexOf(":"));
                });

                (0,external_kolmafia_.setProperty)("crystalBallPredictions", newPredictions.join("|"));
              }
            } else {
              var settings = new AdventureSettings();var _iterator = QuestL9MurderPeak_createForOfIteratorHelper(

                _this.trimmerMonsters),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var monster = _step.value;
                  settings.addNoBanish(monster);
                }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

              greyAdv(_this.loc, outfit);
            }
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "isComplete", value:

    function isComplete() {
      return this.getMurderStatus() >= 15;
    } }, { key: "hasJar", value:

    function hasJar() {
      return (0,external_kolmafia_.availableAmount)(this.jar) > 0;
    } }, { key: "createJar", value:

    function createJar() {
      if (
      this.hasJar() ||
      !this.questNeedsJar() ||
      (0,external_kolmafia_.availableAmount)(this.crude) < 12)
      {
        return;
      }

      (0,external_kolmafia_.create)(this.jar);
    } }, { key: "getMurderStatus", value:

    function getMurderStatus() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("twinPeakProgress"));
    } }, { key: "questNeedsStenchRes", value:

    function questNeedsStenchRes() {
      return (this.getMurderStatus() & 1) == 0;
    } }, { key: "questNeedsFood", value:

    function questNeedsFood() {
      return (this.getMurderStatus() & 2) == 0;
    } }, { key: "questNeedsJar", value:

    function questNeedsJar() {
      return (this.getMurderStatus() & 4) == 0;
    } }, { key: "questNeedsInit", value:

    function questNeedsInit() {
      return this.getMurderStatus() == 7;
    } }]);return MurderHandler;}();
;// CONCATENATED MODULE: ./src/quests/council/peaks/QuestSmutOrcsCargoShorts.ts
function QuestSmutOrcsCargoShorts_typeof(obj) {"@babel/helpers - typeof";return QuestSmutOrcsCargoShorts_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestSmutOrcsCargoShorts_typeof(obj);}function QuestSmutOrcsCargoShorts_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestSmutOrcsCargoShorts_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestSmutOrcsCargoShorts_toPropertyKey(descriptor.key), descriptor);}}function QuestSmutOrcsCargoShorts_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestSmutOrcsCargoShorts_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestSmutOrcsCargoShorts_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestSmutOrcsCargoShorts_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestSmutOrcsCargoShorts_setPrototypeOf(subClass, superClass);}function QuestSmutOrcsCargoShorts_setPrototypeOf(o, p) {QuestSmutOrcsCargoShorts_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestSmutOrcsCargoShorts_setPrototypeOf(o, p);}function QuestSmutOrcsCargoShorts_createSuper(Derived) {var hasNativeReflectConstruct = QuestSmutOrcsCargoShorts_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestSmutOrcsCargoShorts_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestSmutOrcsCargoShorts_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestSmutOrcsCargoShorts_possibleConstructorReturn(this, result);};}function QuestSmutOrcsCargoShorts_possibleConstructorReturn(self, call) {if (call && (QuestSmutOrcsCargoShorts_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestSmutOrcsCargoShorts_assertThisInitialized(self);}function QuestSmutOrcsCargoShorts_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestSmutOrcsCargoShorts_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestSmutOrcsCargoShorts_getPrototypeOf(o) {QuestSmutOrcsCargoShorts_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestSmutOrcsCargoShorts_getPrototypeOf(o);}function QuestSmutOrcsCargoShorts_defineProperty(obj, key, value) {key = QuestSmutOrcsCargoShorts_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestSmutOrcsCargoShorts_toPropertyKey(arg) {var key = QuestSmutOrcsCargoShorts_toPrimitive(arg, "string");return QuestSmutOrcsCargoShorts_typeof(key) === "symbol" ? key : String(key);}function QuestSmutOrcsCargoShorts_toPrimitive(input, hint) {if (QuestSmutOrcsCargoShorts_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestSmutOrcsCargoShorts_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}








var QuestL9SmutOrcsCargoShorts = /*#__PURE__*/function (_TaskInfo) {QuestSmutOrcsCargoShorts_inherits(QuestL9SmutOrcsCargoShorts, _TaskInfo);var _super = QuestSmutOrcsCargoShorts_createSuper(QuestL9SmutOrcsCargoShorts);function QuestL9SmutOrcsCargoShorts() {var _this;QuestSmutOrcsCargoShorts_classCallCheck(this, QuestL9SmutOrcsCargoShorts);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestSmutOrcsCargoShorts_defineProperty(QuestSmutOrcsCargoShorts_assertThisInitialized(_this), "shorts",
    external_kolmafia_.Item.get("Cargo Cultist Shorts"));QuestSmutOrcsCargoShorts_defineProperty(QuestSmutOrcsCargoShorts_assertThisInitialized(_this), "paths", void 0);return _this;}QuestSmutOrcsCargoShorts_createClass(QuestL9SmutOrcsCargoShorts, [{ key: "createPaths", value:


    function createPaths(assumeUnstarted) {
      var pathShorts = new PossiblePath(-5).add(ResourceCategory.CARGO_SHORTS);
      var noShorts = new PossiblePath(0);

      if ((0,external_kolmafia_.availableAmount)(this.shorts) == 0) {
        this.paths = [noShorts];
        return;
      }

      this.paths = [noShorts, pathShorts];
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "getId", value:

    function getId() {
      return "Council / Peaks / CargoShortsSmut";
    } }, { key: "level", value:

    function level() {
      return 8;
    } }, { key: "status", value:

    function status(path) {
      if (path != null && !path.canUse(ResourceCategory.CARGO_SHORTS)) {
        return QuestStatus.COMPLETED;
      }

      var status = getQuestStatus("questL09Topping");

      if (status > 0) {
        return QuestStatus.COMPLETED;
      }

      if (status < 0 || (0,external_kolmafia_.myAdventures)() < 40) {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.familiarWeight)(external_kolmafia_.Familiar.get("Grey Goose")) < 6) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run(path) {
      return {
        location: null,
        familiar: external_kolmafia_.Familiar.get("Grey Goose"),
        disableFamOverride: true,
        mayFreeRun: false,
        run: function run() {
          path.getResource(ResourceCategory.CARGO_SHORTS).pocket(666);

          var macro = Macro.skill(
          external_kolmafia_.Skill.get("Emit Matter Duplicating Drones")).
          step(greyKillingBlow(new GreyOutfit()));
          (0,external_kolmafia_.print)("Macro: " + macro.toString());

          macro.submit();
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "mustBeDone", value:

    function mustBeDone(reallyMustBeDone) {
      if (!reallyMustBeDone && (0,external_kolmafia_.familiarWeight)(external_kolmafia_.Familiar.get("Grey Goose")) >= 6) {
        return true;
      }

      return false;
    } }, { key: "free", value:

    function free() {
      return true;
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestL9SmutOrcsCargoShorts;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/peaks/QuestL9SmutOrcs.ts
function QuestL9SmutOrcs_typeof(obj) {"@babel/helpers - typeof";return QuestL9SmutOrcs_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL9SmutOrcs_typeof(obj);}function QuestL9SmutOrcs_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestL9SmutOrcs_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestL9SmutOrcs_slicedToArray(arr, i) {return QuestL9SmutOrcs_arrayWithHoles(arr) || QuestL9SmutOrcs_iterableToArrayLimit(arr, i) || QuestL9SmutOrcs_unsupportedIterableToArray(arr, i) || QuestL9SmutOrcs_nonIterableRest();}function QuestL9SmutOrcs_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function QuestL9SmutOrcs_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestL9SmutOrcs_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestL9SmutOrcs_arrayLikeToArray(o, minLen);}function QuestL9SmutOrcs_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestL9SmutOrcs_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function QuestL9SmutOrcs_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function QuestL9SmutOrcs_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL9SmutOrcs_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL9SmutOrcs_toPropertyKey(descriptor.key), descriptor);}}function QuestL9SmutOrcs_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL9SmutOrcs_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL9SmutOrcs_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL9SmutOrcs_defineProperty(obj, key, value) {key = QuestL9SmutOrcs_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL9SmutOrcs_toPropertyKey(arg) {var key = QuestL9SmutOrcs_toPrimitive(arg, "string");return QuestL9SmutOrcs_typeof(key) === "symbol" ? key : String(key);}function QuestL9SmutOrcs_toPrimitive(input, hint) {if (QuestL9SmutOrcs_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL9SmutOrcs_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}









var SmutOrcs = /*#__PURE__*/function () {function SmutOrcs() {QuestL9SmutOrcs_classCallCheck(this, SmutOrcs);QuestL9SmutOrcs_defineProperty(this, "loc",
    external_kolmafia_.Location.get("The Smut Orc Logging Camp"));QuestL9SmutOrcs_defineProperty(this, "shorts",
    new QuestL9SmutOrcsCargoShorts());QuestL9SmutOrcs_defineProperty(this, "hoaReg",
    external_kolmafia_.Item.get("HOA regulation book"));QuestL9SmutOrcs_defineProperty(this, "spaceTrip",
    external_kolmafia_.Item.get("Space Trip safety headphones"));QuestL9SmutOrcs_defineProperty(this, "canOfPaint",
    external_kolmafia_.Item.get("Can of black paint"));QuestL9SmutOrcs_defineProperty(this, "paintRes",
    (0,external_kolmafia_.effectModifier)(this.canOfPaint, "Effect"));QuestL9SmutOrcs_defineProperty(this, "asdonMartin",
    external_kolmafia_.Item.get("Asdon Martin keyfob"));QuestL9SmutOrcs_defineProperty(this, "driveSafe",
    external_kolmafia_.Effect.get("Driving Safely"));QuestL9SmutOrcs_defineProperty(this, "lastColdCheck",
    0);QuestL9SmutOrcs_defineProperty(this, "hasEnoughCold",
    false);QuestL9SmutOrcs_defineProperty(this, "lastColdMaximize",
    "Cold Damage");QuestL9SmutOrcs_defineProperty(this, "smutSleazeSkill",
    external_kolmafia_.Skill.get("Procgen Ribaldry"));QuestL9SmutOrcs_defineProperty(this, "sleazeMonster",
    external_kolmafia_.Monster.get("Smut orc screwer"));QuestL9SmutOrcs_defineProperty(this, "damagingEquips",
    [
    "Muscle band",
    "Ant Hoe",
    "Ant Pick",
    "Ant Pitchfork",
    "Ant Rake",
    "Ant Sickle",
    "Tiny bowler"].
    map(function (s) {return external_kolmafia_.Item.get(s);}));QuestL9SmutOrcs_defineProperty(this, "plastered",
    external_kolmafia_.Monster.get("plastered frat orc"));QuestL9SmutOrcs_defineProperty(this, "noise",
    external_kolmafia_.Skill.get("Grey Noise"));QuestL9SmutOrcs_defineProperty(this, "trainset",
    external_kolmafia_.Item.get("model train set"));QuestL9SmutOrcs_defineProperty(this, "toAbsorb", void 0);}QuestL9SmutOrcs_createClass(SmutOrcs, [{ key: "level", value:


    function level() {
      return 9;
    } }, { key: "getChildren", value:

    function getChildren() {
      return [this.shorts];
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }, { key: "mustBeDone", value:

    function mustBeDone(reallyMustBeDone) {
      if (reallyMustBeDone) {
        return false;
      }

      return this.getReadyToBuild() > 0 || isGhostBustingTime(this.loc);
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questL09Topping");

      if (status > 0) {
        return QuestStatus.COMPLETED;
      }

      if (status < 0) {
        return QuestStatus.NOT_READY;
      }

      if (this.getReadyToBuild() > 0) {
        return QuestStatus.READY;
      }

      if (isGhostBustingTime(this.loc) && !this.isNCTime()) {
        return QuestStatus.NOT_READY;
      }

      if (
      (0,external_kolmafia_.myMp)() < 15 /*||
      !AbsorbsProvider.getAbsorbedMonsters().includes(this.plastered)*/)
      {
        return QuestStatus.NOT_READY;
      }

      if (!this.isNCTime()) {
        if (this.lastColdCheck < (0,external_kolmafia_.turnsPlayed)() - 5) {
          this.lastColdCheck = (0,external_kolmafia_.turnsPlayed)();

          var compare = [];

          (0,external_kolmafia_.maximize)("cold dmg 10 min -ML 70 min -tie", true);
          var melee = (0,external_kolmafia_.numericModifier)("Generated:_spec", "Cold Damage");
          compare.push(["cold dmg", melee]);

          if ((0,external_kolmafia_.haveSkill)(this.noise)) {
            (0,external_kolmafia_.maximize)("cold spell dmg 10 min -ML 70 min -tie", true);
            var spell = (0,external_kolmafia_.numericModifier)("Generated:_spec", "Cold Spell Damage");

            compare.push(["cold spell dmg", spell]);
          }

          // Sort from highest to lowest
          compare.sort(function (_ref, _ref2) {var _ref3 = QuestL9SmutOrcs_slicedToArray(_ref, 2),c1 = _ref3[1];var _ref4 = QuestL9SmutOrcs_slicedToArray(_ref2, 2),c2 = _ref4[1];return c2 - c1;});
          this.hasEnoughCold = compare[0][1] >= 5;
          this.lastColdMaximize = compare[0][0];
        }

        if (!this.hasEnoughCold) {
          return QuestStatus.NOT_READY;
        }
      }

      if ((0,external_kolmafia_.getWorkshed)() == this.trainset && this.toAbsorb.length == 0) {
        return QuestStatus.FASTER_LATER;
      }

      if (getQuestStatus("questL11Black") <= 1) {
        return QuestStatus.FASTER_LATER;
      }

      if ((0,external_kolmafia_.getProperty)("questL11Shen") != "finished") {

        //return QuestStatus.FASTER_LATER;
      }
      if (this.isNCTime() && (0,external_kolmafia_.myMeat)() <= 1000) {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "getId", value:

    function getId() {
      return "Council / Peaks / Orcs";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }, { key: "getFastenersHave", value:

    function getFastenersHave() {
      return ["Thick Caulk", "Long Hard Screw", "Messy Butt Joint"].reduce(
      function (s, v) {return s + (0,external_kolmafia_.itemAmount)(external_kolmafia_.Item.get(v));},
      0);

    } }, { key: "getLumberHave", value:

    function getLumberHave() {
      return [
      "Morningwood Plank",
      "Raging Hardwood Plank",
      "Weirdwood Plank"].
      reduce(function (s, v) {return s + (0,external_kolmafia_.itemAmount)(external_kolmafia_.Item.get(v));}, 0);
    } }, { key: "getChasmBuilt", value:

    function getChasmBuilt() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("chasmBridgeProgress"));
    } }, { key: "getChasmRemaining", value:

    function getChasmRemaining() {
      var remaining = 30 - this.getChasmBuilt();

      return remaining - this.getReadyToBuild();
    } }, { key: "getReadyToBuild", value:

    function getReadyToBuild() {
      return Math.min(this.getFastenersHave(), this.getLumberHave());
    } }, { key: "run", value:

    function run() {var _this = this;
      if (this.getReadyToBuild() > 0) {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {
            _this.tryBuild();
          }
        };
      }

      if (this.isNCTime()) {
        return this.tryNC();
      }

      return this.tryCombat();
    } }, { key: "tryCombat", value:

    function tryCombat() {var _this2 = this;
      // max -ml, max cold dmg, raise item drop finally
      var outfit = new GreyOutfit();
      outfit.addWeight("ML", -5);
      outfit.addWeight(this.lastColdMaximize, 100000, 5, 5);
      outfit.setItemDrops();

      if (
      this.getLumberHave() <= this.getFastenersHave() &&
      this.getChasmRemaining() > this.getLumberHave())
      {
        var quest = this.tryHatchet();

        if (quest != null) {
          return quest;
        }

        if ((0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("Logging Hatchet")) > 0) {
          outfit.addWeight(external_kolmafia_.Item.get("Logging Hatchet"), 100);
        }
      }

      if (
      this.getLumberHave() >= this.getFastenersHave() &&
      this.getChasmRemaining() > this.getFastenersHave())
      {
        if ((0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("Loadstone")) > 0) {
          outfit.addWeight(external_kolmafia_.Item.get("Loadstone"), 100);
        }
      }

      return {
        location: this.loc,
        outfit: outfit,
        mayFreeRun: false,
        orbs: (0,external_kolmafia_.haveSkill)(this.smutSleazeSkill) ? null : [this.sleazeMonster],
        run: function run() {
          var attack;

          if (_this2.lastColdMaximize.includes("cold dmg")) {
            attack = Macro.attack();
          } else {
            attack = Macro.skill("Grey Noise");
          }var _iterator = QuestL9SmutOrcs_createForOfIteratorHelper(

            _this2.damagingEquips),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var i = _step.value;
              if ((0,external_kolmafia_.equippedAmount)(i) > 0) {
                (0,external_kolmafia_.equip)(external_kolmafia_.Slot.get("familiar"), external_kolmafia_.Item.none);
              }
            }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

          greyAdv(
          _this2.loc,
          outfit,
          new AdventureSettings().setFinishingBlowMacro(attack.repeat()));

          _this2.tryBuild();
        }
      };
    } }, { key: "tryNC", value:

    function tryNC() {var _this3 = this;
      return {
        location: null,
        run: function run() {
          var props = new Properties_PropertyManager();
          var outfits = _this3.getBestBlechOutfit();
          var need = Math.min(14, _this3.getChasmRemaining());

          if (outfits[0][2] < need) {
            var mox = outfits.find(function (o) {return o[0] == 3;});
            var extraRes =
            ((0,external_kolmafia_.haveEffect)(_this3.paintRes) == 0 ? 1 : 0) + (
            (0,external_kolmafia_.getWorkshed)() == _this3.asdonMartin &&
            (0,external_kolmafia_.haveEffect)(_this3.driveSafe) == 0 &&
            (0,external_kolmafia_.getFuel)() >= 37 ?
            1 :
            0);

            if (
            extraRes > 0 && (
            mox == outfits[0] || mox[2] + extraRes > outfits[0][2]))
            {
              if ((0,external_kolmafia_.myMeat)() >= 1000 && (0,external_kolmafia_.haveEffect)(_this3.paintRes) == 0) {
                (0,external_kolmafia_.cliExecute)("retrieve " + _this3.canOfPaint);
                (0,external_kolmafia_.use)(_this3.canOfPaint);
              }

              if (
              (0,external_kolmafia_.getWorkshed)() == _this3.asdonMartin &&
              (0,external_kolmafia_.haveEffect)(_this3.driveSafe) == 0 &&
              (0,external_kolmafia_.getFuel)() >= 37)
              {
                (0,external_kolmafia_.cliExecute)("asdonmartin drive safely");
              }

              outfits = _this3.getBestBlechOutfit();
            }
          }

          var best = outfits[0];

          (0,external_kolmafia_.maximize)(best[1], false);

          try {
            props.setChoice(1345, best[0]);
            greyAdv(_this3.loc);
            _this3.tryBuild();
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "tryExtraRes", value:

    function tryExtraRes() {} }, { key: "isNCTime", value:

    function isNCTime() {
      var progress = (0,external_kolmafia_.getProperty)("smutOrcNoncombatProgress");

      if (progress == "") {
        return false;
      }

      return (0,external_kolmafia_.toInt)(progress) >= 15;
    } }, { key: "tryBuild", value:

    function tryBuild() {
      var box = external_kolmafia_.Item.get("Smut Orc Keepsake Box");

      if ((0,external_kolmafia_.itemAmount)(box) > 0) {
        (0,external_kolmafia_.use)(box, (0,external_kolmafia_.itemAmount)(box));
      }

      (0,external_kolmafia_.visitUrl)(
      "place.php?whichplace=orc_chasm&action=bridge" +
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("chasmBridgeProgress")));

    } }, { key: "tryHatchet", value:

    function tryHatchet() {
      if (!(0,external_kolmafia_.canadiaAvailable)()) {
        return;
      }

      if ((0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("Logging Hatchet")) > 0) {
        return;
      }

      var loc = external_kolmafia_.Location.get("Camp Logging Camp");

      if (
      loc.turnsSpent > 0 ||
      loc.combatQueue != "" ||
      loc.noncombatQueue != "")
      {
        return;
      }

      return {
        location: null,
        run: function run() {
          greyAdv(loc);
        }
      };
    }

    // getChildren(): QuestInfo[] {
    //   return [this.shorts];
    // }
  }, { key: "simMax", value:
    function simMax(ma) {
      var sim = (0,external_kolmafia_.maximize)(ma, 0, 0, true, true);
      var score = 0;var _iterator2 = QuestL9SmutOrcs_createForOfIteratorHelper(

        sim),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var e = _step2.value;
          score += e.score;
        }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}

      return score;
    } }, { key: "getBestBlechOutfit", value:

    function getBestBlechOutfit() {
      // Stolen from autoscend
      // floor(sqrt((mus+flat_weapon_damage)/15*(1+percent_weapon_damage/100)))
      var musMaximizer =
      "100muscle,100weapon damage,1000weapon damage percent +switch left-hand man";
      var mysMaximizer =
      "100mysticality,100spell damage,1000 spell damage percent +switch left-hand man";
      var moxMaximizer = "100moxie,1000sleaze resistance +switch left-hand man";

      this.simMax(musMaximizer);
      var musmus = (0,external_kolmafia_.numericModifier)("Generated:_spec", "Buffed Muscle");
      var musflat = (0,external_kolmafia_.numericModifier)("Generated:_spec", "Weapon Damage");
      var musperc = (0,external_kolmafia_.numericModifier)("Generated:_spec", "Weapon Damage Percent");
      var muscleScore = Math.floor(
      Math.sqrt((musmus + musflat) / 15 * (1 + musperc / 100)));


      this.simMax(mysMaximizer);
      var mysmys = (0,external_kolmafia_.numericModifier)("Generated:_spec", "Buffed Mysticality");
      var mysflat = (0,external_kolmafia_.numericModifier)("Generated:_spec", "Spell Damage");
      var mysperc = (0,external_kolmafia_.numericModifier)("Generated:_spec", "Spell Damage Percent");
      var mystScore = Math.floor(
      Math.sqrt((mysmys + mysflat) / 15 * (1 + mysperc / 100)));


      this.simMax(moxMaximizer);
      var moxmox = (0,external_kolmafia_.numericModifier)("Generated:_spec", "Buffed Moxie");
      var moxres = (0,external_kolmafia_.numericModifier)("Generated:_spec", "Sleaze Resistance");
      var moxScore = Math.floor(Math.sqrt(moxmox / 30 * (1 + moxres * 0.69)));

      (0,external_kolmafia_.print)("Mus Score: " + muscleScore, "blue");
      (0,external_kolmafia_.print)("Myst Score: " + mystScore, "blue");
      (0,external_kolmafia_.print)("Moxie Score: " + moxScore, "blue");

      var mus = [1, musMaximizer, muscleScore];
      var mys = [2, mysMaximizer, mystScore];
      var mox = [3, moxMaximizer, moxScore];

      return [mus, mys, mox].sort(function (m1, m2) {return m2[2] - m1[2];});
    } }]);return SmutOrcs;}();
;// CONCATENATED MODULE: ./src/quests/council/peaks/QuestL9AbooPeak.ts
function QuestL9AbooPeak_typeof(obj) {"@babel/helpers - typeof";return QuestL9AbooPeak_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL9AbooPeak_typeof(obj);}function QuestL9AbooPeak_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL9AbooPeak_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL9AbooPeak_toPropertyKey(descriptor.key), descriptor);}}function QuestL9AbooPeak_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL9AbooPeak_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL9AbooPeak_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL9AbooPeak_defineProperty(obj, key, value) {key = QuestL9AbooPeak_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL9AbooPeak_toPropertyKey(arg) {var key = QuestL9AbooPeak_toPrimitive(arg, "string");return QuestL9AbooPeak_typeof(key) === "symbol" ? key : String(key);}function QuestL9AbooPeak_toPrimitive(input, hint) {if (QuestL9AbooPeak_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL9AbooPeak_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var ABooHandler = /*#__PURE__*/function () {function ABooHandler() {QuestL9AbooPeak_classCallCheck(this, ABooHandler);QuestL9AbooPeak_defineProperty(this, "clue",
    external_kolmafia_.Item.get("A-Boo Clue"));QuestL9AbooPeak_defineProperty(this, "loc",
    external_kolmafia_.Location.get("A-Boo Peak"));QuestL9AbooPeak_defineProperty(this, "damageLevels",
    [13, 25, 50, 125, 250]);QuestL9AbooPeak_defineProperty(this, "canOfPaint",
    external_kolmafia_.Item.get("Can of black paint"));QuestL9AbooPeak_defineProperty(this, "asdonMartin",
    external_kolmafia_.Item.get("Asdon Martin keyfob"));QuestL9AbooPeak_defineProperty(this, "driveSafe",
    external_kolmafia_.Effect.get("Driving Safely"));QuestL9AbooPeak_defineProperty(this, "totItemItem",
    external_kolmafia_.Item.get("li'l ninja costume"));QuestL9AbooPeak_defineProperty(this, "tot",
    external_kolmafia_.Familiar.get("Trick-or-Treating Tot"));QuestL9AbooPeak_defineProperty(this, "toAbsorb", void 0);}QuestL9AbooPeak_createClass(ABooHandler, [{ key: "level", value:


    function level() {
      return 9;
    } }, { key: "getId", value:

    function getId() {
      return "Council / Peaks / AbooPeak";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }, { key: "run", value:

    function run() {
      if ((0,external_kolmafia_.availableAmount)(this.clue) > 0 && this.getProgress() > 0) {
        return this.runClue();
      }

      return this.runCombat();
    } }, { key: "runClue", value:

    function runClue() {var _this = this;
      var outfit = this.createOutfit();

      return {
        location: null,
        outfit: outfit,
        run: function run() {
          var props = new Properties_PropertyManager();

          if ((0,external_kolmafia_.haveEffect)((0,external_kolmafia_.effectModifier)(_this.canOfPaint, "Effect")) == 0) {
            (0,external_kolmafia_.cliExecute)("acquire 1 " + _this.canOfPaint.name);
            (0,external_kolmafia_.use)(_this.canOfPaint);
          }

          if (
          (0,external_kolmafia_.getWorkshed)() == _this.asdonMartin &&
          (0,external_kolmafia_.haveEffect)(_this.driveSafe) == 0 &&
          (0,external_kolmafia_.getFuel)() >= 37)
          {
            (0,external_kolmafia_.cliExecute)("asdonmartin drive safely");
          }

          try {
            props.setChoice(611, 1);
            (0,external_kolmafia_.use)(_this.clue);

            var settings = new AdventureSettings();
            var turn = 0;

            settings.setChoices({
              calledOutOfScopeChoiceBehavior: function calledOutOfScopeChoiceBehavior() {
                return false;
              },

              handleChoice: function handleChoice(choice) {
                if (choice != 611) {
                  return null;
                }

                var dmgTaken = _this.damageTaken(turn++);

                if (dmgTaken >= (0,external_kolmafia_.myHp)() || _this.getProgress() <= 0) {
                  return 2;
                }

                (0,external_kolmafia_.print)("Prediction a-boo damage of " + dmgTaken);

                return 1;
              }
            });

            var advs = (0,external_kolmafia_.turnsPlayed)();

            greyAdv(_this.loc, null, settings);

            if ((0,external_kolmafia_.lastChoice)() != 611 && (0,external_kolmafia_.turnsPlayed)() == advs) {
              (0,external_kolmafia_.print)(
              "I believe we hit a choice we did not expect, we expected 611");


              greyAdv(_this.loc, null, settings);
            }
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "damageTaken", value:

    function damageTaken(turn) {
      var dmg = this.damageLevels[turn];

      var sDmg = this.damageTakenByElement(dmg, external_kolmafia_.Element.get("spooky"));
      var cDmg = this.damageTakenByElement(dmg, external_kolmafia_.Element.get("cold"));

      return sDmg + cDmg;
    } }, { key: "turnsSurvived", value:

    function turnsSurvived() {
      var totalDamage = 2;
      var reducedBy = 0;

      for (var i = 0; i < this.damageLevels.length; i++) {
        if (this.getProgress() <= reducedBy) {
          return i;
        }

        totalDamage += this.damageTaken(i);

        if (totalDamage >= (0,external_kolmafia_.myHp)()) {
          return i;
        }

        reducedBy += (i + 1) * 2;
      }

      return 5;
    } }, { key: "wouldSurviveClue", value:

    function wouldSurviveClue() {
      var totalDamage = 2;
      var reducedBy = 0;

      for (var i = 0; i < this.damageLevels.length; i++) {
        if (this.getProgress() <= reducedBy) {
          return true;
        }

        totalDamage += this.damageTaken(i);

        if (totalDamage >= (0,external_kolmafia_.myHp)()) {
          return false;
        }

        reducedBy += (i + 1) * 2;
      }

      return true;
    } }, { key: "getElementalResist", value:

    function getElementalResist(level) {
      if (level > 4) {
        return 0.9 - 0.5 * Math.pow(0.05 / 0.06, level - 4);
      }

      return level * 0.1;
    } }, { key: "damageTakenByElement", value:

    function damageTakenByElement(base_damage, element) {
      if (base_damage < 0) {
        return 1;
      }

      var resist = (0,external_kolmafia_.elementalResistance)(element) / 100.0;

      var effective_base_damage = Math.max(30, base_damage);

      var damage = Math.max(
      1,
      Math.ceil(base_damage - effective_base_damage * resist));


      return damage;
    } }, { key: "createOutfit", value:

    function createOutfit() {
      var outfit = new GreyOutfit().
      addWeight("cold res", 40).
      addWeight("spooky res", 40).
      addWeight("ml", -10);
      outfit.hpWeight = 2;

      return outfit;
    } }, { key: "runCombat", value:

    function runCombat() {var _this2 = this;
      var outfit = this.createOutfit();
      var fam = null;

      if (this.toAbsorb.length == 0 && (0,external_kolmafia_.availableAmount)(this.totItemItem) > 0) {
        fam = this.tot;
        outfit.addWeight(this.totItemItem);
      }

      return {
        location: this.loc,
        outfit: outfit,
        mayFreeRun: false,
        familiar: fam,
        disableFamOverride: fam != null,
        run: function run() {
          if (
          (0,external_kolmafia_.myFamiliar)() == fam &&
          fam == _this2.tot &&
          (0,external_kolmafia_.equippedAmount)(_this2.totItemItem) == 0 &&
          (0,external_kolmafia_.availableAmount)(_this2.totItemItem) > 0)
          {
            (0,external_kolmafia_.equip)(_this2.totItemItem);
          }

          greyAdv(_this2.loc, outfit);
        }
      };
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return this.free() || this.canUseClue();
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }, { key: "free", value:

    function free() {
      return (
        (0,external_kolmafia_.toBoolean)((0,external_kolmafia_.getProperty)("booPeakLit")) &&
        (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("booPeakProgress")) == 0);

    } }, { key: "status", value:

    function status() {
      if (
      getQuestStatus("questL09Topping") < 1 ||
      getQuestStatus("questL11Black") < 2)
      {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.getProperty)("booPeakLit") == "true") {
        return QuestStatus.COMPLETED;
      }

      if (this.getProgress() <= 0) {
        return QuestStatus.READY;
      }

      if (this.canUseClue()) {
        return QuestStatus.READY;
      }

      if ((0,external_kolmafia_.myLevel)() >= 20) {
        return QuestStatus.READY;
      }

      // We always want to do this as late as we can
      return QuestStatus.FASTER_LATER;
    } }, { key: "canUseClue", value:

    function canUseClue() {
      return this.getProgress() > 0 && (0,external_kolmafia_.availableAmount)(this.clue) > 0;
    } }, { key: "getProgress", value:

    function getProgress() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("booPeakProgress"));
    } }]);return ABooHandler;}();
;// CONCATENATED MODULE: ./src/quests/council/peaks/QuestL9OilPeak.ts
function QuestL9OilPeak_typeof(obj) {"@babel/helpers - typeof";return QuestL9OilPeak_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL9OilPeak_typeof(obj);}function QuestL9OilPeak_slicedToArray(arr, i) {return QuestL9OilPeak_arrayWithHoles(arr) || QuestL9OilPeak_iterableToArrayLimit(arr, i) || QuestL9OilPeak_unsupportedIterableToArray(arr, i) || QuestL9OilPeak_nonIterableRest();}function QuestL9OilPeak_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function QuestL9OilPeak_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function QuestL9OilPeak_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function QuestL9OilPeak_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestL9OilPeak_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestL9OilPeak_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestL9OilPeak_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestL9OilPeak_arrayLikeToArray(o, minLen);}function QuestL9OilPeak_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestL9OilPeak_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL9OilPeak_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL9OilPeak_toPropertyKey(descriptor.key), descriptor);}}function QuestL9OilPeak_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL9OilPeak_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL9OilPeak_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL9OilPeak_defineProperty(obj, key, value) {key = QuestL9OilPeak_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL9OilPeak_toPropertyKey(arg) {var key = QuestL9OilPeak_toPrimitive(arg, "string");return QuestL9OilPeak_typeof(key) === "symbol" ? key : String(key);}function QuestL9OilPeak_toPrimitive(input, hint) {if (QuestL9OilPeak_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL9OilPeak_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}









var OilHandler = /*#__PURE__*/function () {function OilHandler() {QuestL9OilPeak_classCallCheck(this, OilHandler);QuestL9OilPeak_defineProperty(this, "loc",
    external_kolmafia_.Location.get("Oil Peak"));QuestL9OilPeak_defineProperty(this, "crude",
    external_kolmafia_.Item.get("Bubblin' Crude"));QuestL9OilPeak_defineProperty(this, "umbrella",
    external_kolmafia_.Item.get("Unbreakable Umbrella"));QuestL9OilPeak_defineProperty(this, "baron",
    external_kolmafia_.Monster.get("Oil Baron"));QuestL9OilPeak_defineProperty(this, "beatenUp",
    external_kolmafia_.Effect.get("Beaten Up"));}QuestL9OilPeak_createClass(OilHandler, [{ key: "getId", value:

    function getId() {
      return "Council / Peaks / OilPeak";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }, { key: "needsJar", value:

    function needsJar() {
      return (
        ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("twinPeakProgress")) & 4) == 0 &&
        (0,external_kolmafia_.availableAmount)(this.crude) < 12 &&
        (0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("Jar of Oil")) == 0);

    } }, { key: "level", value:

    function level() {
      return 17;
    } }, { key: "status", value:

    function status() {
      if (
      !this.needsJar() &&
      this.getStatus() <= 0 &&
      (0,external_kolmafia_.getProperty)("oilPeakLit") == "true")
      {
        return QuestStatus.COMPLETED;
      }

      if (getQuestStatus("questL09Topping") < 1) {
        return QuestStatus.NOT_READY;
      }

      if (this.needsAbsorb()) {
        if ((0,external_kolmafia_.familiarWeight)(external_kolmafia_.Familiar.get("Grey Goose")) < 6) {
          var effects = Object.keys((0,external_kolmafia_.myEffects)()).
          map(function (e) {return external_kolmafia_.Effect.get(e);}).
          reduce(function (p, e) {return (0,external_kolmafia_.numericModifier)(e, "Monster Level") + p;}, 0);

          if (effects != 0) {
            return QuestStatus.NOT_READY;
          }
        }
      }

      if ((0,external_kolmafia_.myHp)() < 90 || (0,external_kolmafia_.haveEffect)(this.beatenUp) > 0) {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "needsAbsorb", value:

    function needsAbsorb() {
      return (
        !GreySettings_GreySettings.isNerfMode() &&
        !GreyAbsorber_AbsorbsProvider.getReabsorbedMonsters().includes(this.baron));

    } }, { key: "isReady", value:

    function isReady() {
      return this.needsJar() || this.getStatus() > 0;
    } }, { key: "getStatus", value:

    function getStatus() {
      return (0,external_kolmafia_.toFloat)((0,external_kolmafia_.getProperty)("oilPeakProgress"));
    } }, { key: "doAbsorb", value:

    function doAbsorb() {var _this = this;
      var doneFirst =
      this.loc.turnsSpent > 0 ||
      this.loc.noncombatQueue.includes(
      "Pushin' Down on Me, Pushin' Down on You");


      var outfit = new GreyOutfit();

      return {
        location: this.loc,
        outfit: outfit,
        run: function run() {
          if (doneFirst) {
            (0,external_kolmafia_.print)("Now doing a special adventure for Oil Baron absorb!", "blue");

            if ((0,external_kolmafia_.currentMcd)() > 0) {
              (0,external_kolmafia_.changeMcd)(0);
            }

            var needed = 50;

            var maxResult = (0,external_kolmafia_.maximize)("ml ".concat(
            needed, " min ").concat(needed, " max -tie"),
            0,
            0,
            true,
            true);


            maxResult = maxResult.filter(
            function (res) {return (0,external_kolmafia_.toSlot)(res.item) != external_kolmafia_.Slot.none && res.score != 0;});


            var workingCombos = [];var _iterator = QuestL9OilPeak_createForOfIteratorHelper(

              getAllCombinations(maxResult)),_step;try {var _loop = function _loop() {var combo = _step.value;
                var baseML =
                external_kolmafia_.Slot.all().
                map(function (s) {return [s, (0,external_kolmafia_.equippedItem)(s)];}).
                filter(
                function (_ref) {var _ref2 = QuestL9OilPeak_slicedToArray(_ref, 2),s = _ref2[0],i = _ref2[1];return (
                    i != external_kolmafia_.Item.none &&
                    combo.find(
                    function (r) {return r.command.startsWith("equip " + s) == null;}));}).


                map(function (_ref3) {var _ref4 = QuestL9OilPeak_slicedToArray(_ref3, 2),i = _ref4[1];return (0,external_kolmafia_.numericModifier)(i, "Monster Level");}).
                reduce(function (l, r) {return l + r;}, 0) + 10;

                var addedML = combo.
                map(function (r) {return r.score;}).
                reduce(function (l, r) {return r + l;}, 0);

                if (baseML + addedML < needed) {return "continue";

                }

                workingCombos.push([addedML + baseML, combo.map(function (r) {return r.command;})]);
              };for (_iterator.s(); !(_step = _iterator.n()).done;) {var _ret = _loop();if (_ret === "continue") continue;}} catch (err) {_iterator.e(err);} finally {_iterator.f();}

            workingCombos.sort(function (c1, c2) {return c1[0] - c2[0];});

            if (workingCombos.length > 0 && needed > 0) {
              workingCombos[0][1].forEach(function (s) {return (0,external_kolmafia_.cliExecute)(s);});
            }

            var ml = function ml() {
              var level = (0,external_kolmafia_.numericModifier)("Monster Level");

              var state = getUmbrella();

              if (
              state == UmbrellaState.MONSTER_LEVEL &&
              (0,external_kolmafia_.equippedAmount)(_this.umbrella) > 0)
              {
                level *= 0.25;
              }

              return level;
            };

            if (ml() < 50) {
              (0,external_kolmafia_.changeMcd)(10);
            }

            if (ml() < 50) {
              throw "Unable to raise enough ML to get the oil baron, handle manually?";
            } else if (ml() >= 100) {
              throw "Too much ML on the oil baron, we want less than 100!";
            }
          }

          greyAdv(_this.loc);

          if ((0,external_kolmafia_.currentMcd)() > 0) {
            (0,external_kolmafia_.changeMcd)(0);
          }

          if (_this.needsAbsorb() && doneFirst) {
            throw "We spent a turn trying to grab the absorb for oil baron! This didn't work..";
          }
        }
      };
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return this.free();
    } }, { key: "free", value:

    function free() {
      return this.getPressureLeft() <= 0 && !(0,external_kolmafia_.toBoolean)((0,external_kolmafia_.getProperty)("oilPeakLit"));
    } }, { key: "getPressureLeft", value:

    function getPressureLeft() {
      return (0,external_kolmafia_.toFloat)((0,external_kolmafia_.getProperty)("oilPeakProgress"));
    } }, { key: "run", value:

    function run() {var _this2 = this;
      if (this.free()) {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {
            greyAdv(_this2.loc);
          }
        };
      }

      if (this.needsAbsorb()) {
        return this.doAbsorb();
      }

      var outfit = new GreyOutfit().setItemDrops();
      outfit.addWeight("ML", 2, null, 100);

      if ((0,external_kolmafia_.myMaxhp)() < 150) {
        outfit.addWeight("hp", 1);
      }

      outfit.umbrellaSetting = UmbrellaState.MONSTER_LEVEL;
      outfit.addExtra("-offhand");

      return {
        location: this.loc,
        outfit: outfit,
        mayFreeRun: false,
        run: function run() {
          if ((0,external_kolmafia_.numericModifier)("Monster Level") < 100) {
            (0,external_kolmafia_.changeMcd)(10);
          }

          if ((0,external_kolmafia_.myHp)() < Math.min(150, (0,external_kolmafia_.myMaxhp)() * 0.9)) {
            restoreHPTo(Math.min(150, (0,external_kolmafia_.myMaxhp)() * 0.9));
          }

          if (
          (0,external_kolmafia_.numericModifier)("Monster Level") < 100 &&
          (0,external_kolmafia_.availableAmount)(_this2.umbrella) > 0)
          {
            setUmbrella(UmbrellaState.MONSTER_LEVEL);
            (0,external_kolmafia_.equip)(external_kolmafia_.Item.get("Unbreakable Umbrella"));
          }

          greyAdv(_this2.loc, outfit);
          (0,external_kolmafia_.changeMcd)(0);
        }
      };
    } }]);return OilHandler;}();
;// CONCATENATED MODULE: ./src/quests/council/QuestL9OrcsAndPeaks.ts
function QuestL9OrcsAndPeaks_typeof(obj) {"@babel/helpers - typeof";return QuestL9OrcsAndPeaks_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL9OrcsAndPeaks_typeof(obj);}function QuestL9OrcsAndPeaks_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL9OrcsAndPeaks_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL9OrcsAndPeaks_toPropertyKey(descriptor.key), descriptor);}}function QuestL9OrcsAndPeaks_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL9OrcsAndPeaks_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL9OrcsAndPeaks_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL9OrcsAndPeaks_defineProperty(obj, key, value) {key = QuestL9OrcsAndPeaks_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL9OrcsAndPeaks_toPropertyKey(arg) {var key = QuestL9OrcsAndPeaks_toPrimitive(arg, "string");return QuestL9OrcsAndPeaks_typeof(key) === "symbol" ? key : String(key);}function QuestL9OrcsAndPeaks_toPrimitive(input, hint) {if (QuestL9OrcsAndPeaks_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL9OrcsAndPeaks_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}








var QuestL9Smut = /*#__PURE__*/function () {function QuestL9Smut() {QuestL9OrcsAndPeaks_classCallCheck(this, QuestL9Smut);QuestL9OrcsAndPeaks_defineProperty(this, "peaks",
    [
    new SmutOrcs(),
    new ABooHandler(),
    new MurderHandler(),
    new OilHandler()]);}QuestL9OrcsAndPeaks_createClass(QuestL9Smut, [{ key: "level", value:


    function level() {
      return 9;
    } }, { key: "getChildren", value:

    function getChildren() {
      return this.peaks;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "status", value:

    function status() {
      var status = this.getStatus();

      if (status == PeakStatus.finished) {
        return QuestStatus.COMPLETED;
      }

      if (
      status == PeakStatus.step1 ||
      status == PeakStatus.step3 ||
      (0,external_kolmafia_.getProperty)("booPeakLit") == "true" &&
      (0,external_kolmafia_.getProperty)("oilPeakLit") == "true" &&
      (0,external_kolmafia_.getProperty)("twinPeakProgress") == "15")
      {
        return QuestStatus.READY;
      }

      return QuestStatus.NOT_READY;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return true;
    } }, { key: "free", value:

    function free() {
      return true;
    } }, { key: "getStatus", value:

    function getStatus() {
      return PeakStatus[(0,external_kolmafia_.getProperty)("questL09Topping")];
    } }, { key: "getId", value:

    function getId() {
      return "Council / Peaks / Lord";
    } }, { key: "run", value:

    function run() {var _this = this;
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          _this.visitMiLord();
          (0,external_kolmafia_.council)();
        }
      };
    } }, { key: "visitMiLord", value:

    function visitMiLord() {
      (0,external_kolmafia_.visitUrl)("place.php?whichplace=highlands&action=highlands_dude");
    } }]);return QuestL9Smut;}();var


PeakStatus;(function (PeakStatus) {PeakStatus["unstarted"] = "unstarted";PeakStatus["started"] = "CHASM";PeakStatus["step1"] = "INTRODUCE_PEAKS";PeakStatus["step2"] = "BURN_MY_PEAKS";PeakStatus["step3"] = "BURNED_PEAKS_DOWN";PeakStatus["finished"] = "finished";})(PeakStatus || (PeakStatus = {}));
;// CONCATENATED MODULE: ./src/quests/council/QuestCouncil.ts
function QuestCouncil_typeof(obj) {"@babel/helpers - typeof";return QuestCouncil_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestCouncil_typeof(obj);}function QuestCouncil_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestCouncil_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestCouncil_toPropertyKey(descriptor.key), descriptor);}}function QuestCouncil_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestCouncil_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestCouncil_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestCouncil_defineProperty(obj, key, value) {key = QuestCouncil_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestCouncil_toPropertyKey(arg) {var key = QuestCouncil_toPrimitive(arg, "string");return QuestCouncil_typeof(key) === "symbol" ? key : String(key);}function QuestCouncil_toPrimitive(input, hint) {if (QuestCouncil_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestCouncil_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}

















var QuestCouncil = /*#__PURE__*/function () {


  function QuestCouncil() {QuestCouncil_classCallCheck(this, QuestCouncil);QuestCouncil_defineProperty(this, "quests", []);
    this.quests.push(new QuestL1Toot());
    this.quests.push(new QuestL2SpookyLarva());
    this.quests.push(new QuestL3Tavern());
    this.quests.push(new QuestL4Bats());
    this.quests.push(new QuestL5Goblin());
    this.quests.push(new QuestL6Friar());
    this.quests.push(new QuestL7Crypt());
    this.quests.push(new QuestL7CryptPull());
    this.quests.push(new QuestL8IcePeak());
    this.quests.push(new QuestL9Smut());
    this.quests.push(new QuestL10Beanstalk());
    this.quests.push(new QuestL11MacGruffin());
    this.quests.push(new QuestL12War());
    this.quests.push(new QuestL13());
  }QuestCouncil_createClass(QuestCouncil, [{ key: "getId", value:

    function getId() {
      return "Quests / Council";
    } }, { key: "level", value:

    function level() {
      return -1;
    } }, { key: "status", value:

    function status() {
      return QuestStatus.COMPLETED;
    } }, { key: "run", value:

    function run() {
      throw "Not implemented";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "getChildren", value:

    function getChildren() {
      return this.quests;
    } }]);return QuestCouncil;}();
;// CONCATENATED MODULE: ./src/utils/KmailUtils.ts















function getKmails() {var caller = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "GreyDay";
  var buffer = (0,external_kolmafia_.visitUrl)(
  "api.php?pwd&what=kmail&count=100&for=" + (0,external_kolmafia_.urlEncode)(caller));


  var kmails = JSON.parse(buffer);

  kmails.forEach(function (mail) {
    mail["delete"] = function () {
      var del =
      "messages.php?the_action=delete&box=Inbox&pwd&sel" + mail.id + "=on";

      return (0,external_kolmafia_.visitUrl)(del).includes("1 message deleted.");
    };
  });

  return kmails.filter(function (k) {return k.type == "normal";});
}

function isJunkKmail(kmail) {
  if (
  kmail.fromname == "Lady Spookyraven's Ghost" ||
  kmail.fromname == "The Loathing Postal Service" &&
  kmail.message.includes("telegram from Lady Spookyraven"))
  {
    return true;
  }

  if (
  (kmail.fromname.toLowerCase() == "cheesefax" ||
  kmail.fromname.toLowerCase() == "averagechat") &&
  kmail.message.includes("completed your relationship fortune test!"))
  {
    return true;
  }

  return false;
}

function deleteJunkKmails() {
  if (!GreySettings_GreySettings.greyDeleteKmails) {
    return;
  }

  getKmails().forEach(function (mail) {
    if (!isJunkKmail(mail)) {
      return;
    }

    (0,external_kolmafia_.print)("Deleting junk kmail from " + mail.fromname, "gray");

    var state = mail["delete"]();

    if (state) {
      return;
    }

    (0,external_kolmafia_.print)("Failed to delete kmail.", "red");
  });
}
;// CONCATENATED MODULE: ./src/quests/council/manor/QuestManorBathroom.ts
function QuestManorBathroom_typeof(obj) {"@babel/helpers - typeof";return QuestManorBathroom_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestManorBathroom_typeof(obj);}function QuestManorBathroom_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestManorBathroom_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestManorBathroom_toPropertyKey(descriptor.key), descriptor);}}function QuestManorBathroom_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestManorBathroom_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestManorBathroom_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestManorBathroom_defineProperty(obj, key, value) {key = QuestManorBathroom_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestManorBathroom_toPropertyKey(arg) {var key = QuestManorBathroom_toPrimitive(arg, "string");return QuestManorBathroom_typeof(key) === "symbol" ? key : String(key);}function QuestManorBathroom_toPrimitive(input, hint) {if (QuestManorBathroom_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestManorBathroom_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}








var ManorBathroom = /*#__PURE__*/function () {function ManorBathroom() {QuestManorBathroom_classCallCheck(this, ManorBathroom);QuestManorBathroom_defineProperty(this, "location",
    external_kolmafia_.Location.get("The Haunted Bathroom"));QuestManorBathroom_defineProperty(this, "item",
    external_kolmafia_.Item.get("Lady Spookyraven's powder puff"));QuestManorBathroom_defineProperty(this, "toAbsorb", void 0);}QuestManorBathroom_createClass(ManorBathroom, [{ key: "level", value:


    function level() {
      return 5;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questM21Dance");

      if (status < 1) {
        return QuestStatus.NOT_READY;
      }

      if (status > 1 || (0,external_kolmafia_.availableAmount)(this.item) > 0) {
        return QuestStatus.COMPLETED;
      }

      if (!hasNonCombatSkillsReady()) {
        return QuestStatus.FASTER_LATER;
      }

      if (this.hasDelay()) {
        if (DelayBurners.isDelayBurnerReady()) {
          return QuestStatus.READY;
        }

        if (DelayBurners.isDelayBurnerFeasible()) {
          return QuestStatus.FASTER_LATER;
        }
      }

      return QuestStatus.READY;
    } }, { key: "hasDelay", value:

    function hasDelay() {
      return this.location.turnsSpent < 5 && this.toAbsorb.length == 0;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();

      if (!this.hasDelay()) {
        outfit.setNoCombat();
      }

      if (this.toAbsorb.length == 0) {
        outfit.addDelayer(
        DelayCriteria().withForcedFights(this.hasDelay() ? null : false));

      }

      return {
        location: this.location,
        outfit: outfit,
        freeRun: function freeRun() {return true;},
        run: function run() {
          var props = new Properties_PropertyManager();
          props.setChoice(882, 1);
          props.setChoice(881, 1);

          if (DelayBurners.isTryingForDupeableGoblin()) {
            (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Grey Goose"));
          }

          try {
            greyAdv(_this.location, outfit);
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "getId", value:

    function getId() {
      return "Manor / Bathroom";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.location];
    } }]);return ManorBathroom;}();
;// CONCATENATED MODULE: ./src/quests/council/manor/QuestManorBedroom.ts
function QuestManorBedroom_typeof(obj) {"@babel/helpers - typeof";return QuestManorBedroom_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestManorBedroom_typeof(obj);}function QuestManorBedroom_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestManorBedroom_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestManorBedroom_toPropertyKey(descriptor.key), descriptor);}}function QuestManorBedroom_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestManorBedroom_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestManorBedroom_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestManorBedroom_defineProperty(obj, key, value) {key = QuestManorBedroom_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestManorBedroom_toPropertyKey(arg) {var key = QuestManorBedroom_toPrimitive(arg, "string");return QuestManorBedroom_typeof(key) === "symbol" ? key : String(key);}function QuestManorBedroom_toPrimitive(input, hint) {if (QuestManorBedroom_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestManorBedroom_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}








var ManorBedroom = /*#__PURE__*/function () {function ManorBedroom() {QuestManorBedroom_classCallCheck(this, ManorBedroom);QuestManorBedroom_defineProperty(this, "location",
    external_kolmafia_.Location.get("The Haunted Bedroom"));QuestManorBedroom_defineProperty(this, "item",
    external_kolmafia_.Item.get("Lady Spookyraven's finest gown"));QuestManorBedroom_defineProperty(this, "spectacles",
    external_kolmafia_.Item.get("Lord Spookyraven's spectacles"));QuestManorBedroom_defineProperty(this, "disposableCamera",
    external_kolmafia_.Item.get("disposable instant camera"));QuestManorBedroom_defineProperty(this, "dontLike",
    [
    "Animated Mahogany Nightstand",
    "Animated Rustic Nightstand",
    "Wardrob nightstand"].
    map(function (m) {return external_kolmafia_.Monster.get(m);}));QuestManorBedroom_defineProperty(this, "toAbsorb", void 0);QuestManorBedroom_defineProperty(this, "cameraMonster",

    external_kolmafia_.Monster.get("Animated ornate nightstand"));QuestManorBedroom_defineProperty(this, "dressMonster",
    external_kolmafia_.Monster.get("Elegant animated nightstand"));}QuestManorBedroom_createClass(ManorBedroom, [{ key: "needCamera", value:

    function needCamera() {
      return (
        (0,external_kolmafia_.availableAmount)(this.disposableCamera) == 0 &&
        (0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("photograph of a dog")) == 0 &&
        getQuestStatus("questL11Palindome") <= 1);

    } }, { key: "needGlasses", value:

    function needGlasses() {
      return (0,external_kolmafia_.availableAmount)(this.spectacles) == 0;
    } }, { key: "level", value:

    function level() {
      return 5;
    } }, { key: "needDress", value:

    function needDress() {
      return (
        getQuestStatus("questM21Dance") <= 2 && (0,external_kolmafia_.availableAmount)(this.item) == 0);

    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questM21Dance");

      if (status < 1) {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.availableAmount)(this.spectacles) > 0 && !this.needCamera()) {
        if (status > 1 || (0,external_kolmafia_.availableAmount)(this.item) > 0) {
          return QuestStatus.COMPLETED;
        }
      }

      if (this.hasDelay()) {
        if (DelayBurners.isDelayBurnerReady()) {
          return QuestStatus.READY;
        }

        if (DelayBurners.isDelayBurnerFeasible()) {
          return QuestStatus.FASTER_LATER;
        }
      }

      return QuestStatus.READY;
    } }, { key: "hasDelay", value:

    function hasDelay() {
      return (
        this.toAbsorb.length == 0 &&
        this.location.turnsSpent < 5 &&
        !this.needCamera() &&
        !this.needGlasses() &&
        this.needDress());

    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();

      var orbs = [];

      if (this.location.turnsSpent >= 5 && this.needDress()) {
        orbs.push(this.dressMonster);
      }

      if (this.needCamera() || this.needGlasses()) {
        orbs.push(this.cameraMonster);
      }

      return {
        location: this.location,
        outfit: outfit,
        orbs: orbs,
        mayFreeRun: true,
        freeRun: function freeRun(monster) {return !orbs.includes(monster);},
        run: function run() {
          var props = new Properties_PropertyManager();

          try {
            props.setChoice(876, 1);
            props.setChoice(877, 1);
            props.setChoice(879, 4); // Grab engorged sausages if we can
            props.setChoice(879, 2); // Otherwise just grab an item which is 50/50 but better than others
            props.setChoice(876, 1);

            if (_this.needDress()) {
              props.setChoice(880, 1);
            } else {
              props.setChoice(880, 2);
            }

            if ((0,external_kolmafia_.availableAmount)(_this.spectacles) == 0) {
              props.setChoice(878, 3);
            } else if (_this.needCamera()) {
              props.setChoice(878, 4);
            } else {
              props.setChoice(878, 1);
            }

            var settings = new AdventureSettings();

            _this.dontLike.forEach(function (m) {return settings.addBanish(m);});

            if (_this.hasDelay()) {
              var delay = DelayBurners.getReadyDelayBurner(
              DelayCriteria().withFreeFights(true));


              if (delay != null) {
                delay.doFightSetup();
              }
            }

            greyAdv(_this.location, outfit, settings);
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "getId", value:

    function getId() {
      return "Manor / Bedroom";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.location];
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return ManorBedroom;}();
;// CONCATENATED MODULE: ./src/quests/council/manor/QuestManorBillards.ts
function QuestManorBillards_typeof(obj) {"@babel/helpers - typeof";return QuestManorBillards_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestManorBillards_typeof(obj);}function QuestManorBillards_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestManorBillards_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestManorBillards_slicedToArray(arr, i) {return QuestManorBillards_arrayWithHoles(arr) || QuestManorBillards_iterableToArrayLimit(arr, i) || QuestManorBillards_unsupportedIterableToArray(arr, i) || QuestManorBillards_nonIterableRest();}function QuestManorBillards_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function QuestManorBillards_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestManorBillards_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestManorBillards_arrayLikeToArray(o, minLen);}function QuestManorBillards_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestManorBillards_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function QuestManorBillards_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function QuestManorBillards_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestManorBillards_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestManorBillards_toPropertyKey(descriptor.key), descriptor);}}function QuestManorBillards_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestManorBillards_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestManorBillards_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestManorBillards_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestManorBillards_setPrototypeOf(subClass, superClass);}function QuestManorBillards_setPrototypeOf(o, p) {QuestManorBillards_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestManorBillards_setPrototypeOf(o, p);}function QuestManorBillards_createSuper(Derived) {var hasNativeReflectConstruct = QuestManorBillards_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestManorBillards_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestManorBillards_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestManorBillards_possibleConstructorReturn(this, result);};}function QuestManorBillards_possibleConstructorReturn(self, call) {if (call && (QuestManorBillards_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestManorBillards_assertThisInitialized(self);}function QuestManorBillards_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestManorBillards_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestManorBillards_getPrototypeOf(o) {QuestManorBillards_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestManorBillards_getPrototypeOf(o);}function QuestManorBillards_defineProperty(obj, key, value) {key = QuestManorBillards_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestManorBillards_toPropertyKey(arg) {var key = QuestManorBillards_toPrimitive(arg, "string");return QuestManorBillards_typeof(key) === "symbol" ? key : String(key);}function QuestManorBillards_toPrimitive(input, hint) {if (QuestManorBillards_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestManorBillards_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}











var QuestManorBillards = /*#__PURE__*/function (_TaskInfo) {QuestManorBillards_inherits(QuestManorBillards, _TaskInfo);var _super = QuestManorBillards_createSuper(QuestManorBillards);














  function QuestManorBillards() {var _this;QuestManorBillards_classCallCheck(this, QuestManorBillards);
    _this = _super.call(this);QuestManorBillards_defineProperty(QuestManorBillards_assertThisInitialized(_this), "billards", external_kolmafia_.Location.get("The Haunted Billiards Room"));QuestManorBillards_defineProperty(QuestManorBillards_assertThisInitialized(_this), "chalk", external_kolmafia_.Item.get("Handful of hand chalk"));QuestManorBillards_defineProperty(QuestManorBillards_assertThisInitialized(_this), "chalkEffect", external_kolmafia_.Effect.get("Chalky Hand"));QuestManorBillards_defineProperty(QuestManorBillards_assertThisInitialized(_this), "key", external_kolmafia_.Item.get("[7302]Spookyraven library key"));QuestManorBillards_defineProperty(QuestManorBillards_assertThisInitialized(_this), "cue", external_kolmafia_.Item.get("pool cue"));QuestManorBillards_defineProperty(QuestManorBillards_assertThisInitialized(_this), "poolgeist", external_kolmafia_.Monster.get("pooltergeist"));QuestManorBillards_defineProperty(QuestManorBillards_assertThisInitialized(_this), "ghost", external_kolmafia_.Monster.get("Chalkdust wraith"));QuestManorBillards_defineProperty(QuestManorBillards_assertThisInitialized(_this), "hardening", external_kolmafia_.Skill.get("Subatomic Hardening"));QuestManorBillards_defineProperty(QuestManorBillards_assertThisInitialized(_this), "lefthandMan", external_kolmafia_.Familiar.get("Left-Hand Man"));QuestManorBillards_defineProperty(QuestManorBillards_assertThisInitialized(_this), "umbrella", external_kolmafia_.Item.get("Unbreakable Umbrella"));QuestManorBillards_defineProperty(QuestManorBillards_assertThisInitialized(_this), "toAbsorb", void 0);QuestManorBillards_defineProperty(QuestManorBillards_assertThisInitialized(_this), "elementalSkills", void 0);QuestManorBillards_defineProperty(QuestManorBillards_assertThisInitialized(_this), "paths", void 0);

    _this.elementalSkills = GreyAbsorber_AbsorbsProvider.loadAbsorbs().
    map(function (a) {return (
        a.skill == null ?
        null :
        [
        a.skill,
        external_kolmafia_.Element.all().
        map(function (e) {return (0,external_kolmafia_.numericModifier)(a.skill, e + " Damage");}).
        reduce(function (p, n) {return p + n;}, 0)]);}).


    filter(function (pair) {return pair != null;}).
    map(function (_ref) {var _ref2 = QuestManorBillards_slicedToArray(_ref, 1),p = _ref2[0];return p;});return _this;
  }QuestManorBillards_createClass(QuestManorBillards, [{ key: "createPaths", value:

    function createPaths(assumeUnstarted) {
      this.paths = [];

      var combos = [];
      var ncsNeeded = assumeUnstarted || (0,external_kolmafia_.availableAmount)(this.cue) == 0 ? 2 : 1;

      for (var t = 0; t < ncsNeeded; t++) {
        combos.push([null, 5]);
        combos.push([ResourceCategory.FORCE_NC, 1]);
      }var _iterator = QuestManorBillards_createForOfIteratorHelper(

        getAllCombinations(combos)),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var combination = _step.value;
          if (combination.length != ncsNeeded) {
            continue;
          }

          var path = new PossiblePath(
          combination.map(function (_ref3) {var _ref4 = QuestManorBillards_slicedToArray(_ref3, 2),t = _ref4[1];return t;}).reduce(function (p, v) {return p + v;}, 0));var _iterator2 = QuestManorBillards_createForOfIteratorHelper(


            combination),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var _step2$value = QuestManorBillards_slicedToArray(_step2.value, 1),res = _step2$value[0];
              if (res == null) {
                continue;
              }

              path.add(res);
            }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}

          this.paths.push(path);
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "getId", value:

    function getId() {
      return "Manor / Billards";
    } }, { key: "level", value:

    function level() {
      return 8;
    } }, { key: "attemptPrime", value:

    function attemptPrime(path) {
      if (!path.canUse(ResourceCategory.FORCE_NC)) {
        return false;
      }

      if ((0,external_kolmafia_.availableAmount)(this.chalk) == 0 && (0,external_kolmafia_.haveEffect)(this.chalkEffect) <= 1) {
        return false;
      }

      if (!(0,external_kolmafia_.haveSkill)(this.hardening) || this.toAbsorb.length > 0) {
        return false;
      }

      var lightsOut = (0,external_kolmafia_.totalTurnsPlayed)() % 37;

      if (lightsOut == 0 || lightsOut >= 34) {
        return false;
      }

      setPrimedResource(this, path, path.getResource(ResourceCategory.FORCE_NC));

      return true;
    } }, { key: "status", value:

    function status(path) {
      var status = getQuestStatus("questM20Necklace");

      if (status < 1) {
        return QuestStatus.NOT_READY;
      }

      if (status > 2 || (0,external_kolmafia_.availableAmount)(this.key) > 0) {
        return QuestStatus.COMPLETED;
      }

      if (path != null && path.canUse(ResourceCategory.FORCE_NC)) {
        if (path.getResource(ResourceCategory.FORCE_NC).primed()) {
          return QuestStatus.READY;
        }

        if (
        this.toAbsorb.length == 0 &&
        (0,external_kolmafia_.haveSkill)(this.hardening) && (
        (0,external_kolmafia_.availableAmount)(this.chalk) > 0 || (0,external_kolmafia_.haveEffect)(this.chalkEffect) > 1))
        {
          return QuestStatus.NOT_READY;
        }
      }

      if (!hasNonCombatSkillsReady(false)) {
        return QuestStatus.NOT_READY;
      }

      if (!hasNonCombatSkillsReady()) {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      var outfit = new GreyOutfit();
      var primed = path.getResource(ResourceCategory.FORCE_NC);

      if (primed != null && !primed.primed()) {
        primed = null;
      }

      var orbs = [];

      if (primed == null) {
        if (
        (0,external_kolmafia_.availableAmount)(this.cue) == 0 ||
        (0,external_kolmafia_.haveEffect)(this.chalkEffect) > 0 ||
        (0,external_kolmafia_.availableAmount)(this.chalk) > 0 ||
        (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("poolSkill")) >= 2)
        {
          outfit.setNoCombat().setNoCombat();
        }

        if (this.elementalSkills.find(function (s) {return (0,external_kolmafia_.haveSkill)(s);}) == null) {
          outfit.addWeight("elemental dmg", 10, 1, 1);
        }

        if (
        this.toAbsorb.includes(this.ghost) ||
        (0,external_kolmafia_.availableAmount)(this.chalk) == 0 && (0,external_kolmafia_.haveEffect)(this.chalkEffect) <= 1)
        {
          orbs.push(this.ghost);
        }

        if (!(0,external_kolmafia_.haveSkill)(this.hardening)) {
          orbs.push(this.poolgeist);
        }
      }

      // Don't waste equips on cue if we wouldn't have enough skill
      if (
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("poolSkill")) >= 2 ||
      (0,external_kolmafia_.availableAmount)(this.chalk) > 0 ||
      (0,external_kolmafia_.haveEffect)(this.chalkEffect) > 0)
      {
        outfit.addWeight(this.cue);
      }

      var mustHitGhost =
      this.toAbsorb.includes(this.ghost) ||
      (0,external_kolmafia_.haveEffect)(this.chalkEffect) + (0,external_kolmafia_.availableAmount)(this.chalk) == 0;

      var fam =
      primed == null &&
      !orbs.includes(currentPredictions().get(this.billards)) &&
      !mustHitGhost &&
      (0,external_kolmafia_.haveFamiliar)(this.lefthandMan) &&
      (0,external_kolmafia_.availableAmount)(this.cue) > 0 &&
      (0,external_kolmafia_.availableAmount)(this.umbrella) > 0 ?
      this.lefthandMan :
      null;

      if (fam != null) {
        outfit.addExtra("+switch " + this.lefthandMan);
        outfit.addWeight(this.umbrella);
      }

      return {
        outfit: outfit,
        location: this.billards,
        orbs: orbs,
        familiar: fam,
        disableFamOverride: fam != null,
        mayFreeRun: true,
        freeRun: function freeRun(monster) {return !orbs.includes(monster);},
        run: function run() {
          if (
          (0,external_kolmafia_.availableAmount)(_this2.cue) > 0 &&
          (0,external_kolmafia_.haveEffect)(_this2.chalkEffect) == 0 &&
          (0,external_kolmafia_.availableAmount)(_this2.chalk) > 0)
          {
            (0,external_kolmafia_.use)(_this2.chalk);
          }

          var settings = new AdventureSettings();

          if (
          (0,external_kolmafia_.availableAmount)(_this2.chalk) == 0 &&
          (0,external_kolmafia_.haveEffect)(_this2.chalkEffect) <= 1 &&
          !_this2.toAbsorb.includes(_this2.poolgeist))
          {
            settings.addBanish(_this2.poolgeist);
          }

          var props = new Properties_PropertyManager();
          var poolSkill =
          (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("poolSkill")) + (0,external_kolmafia_.numericModifier)("pool skill") + 10;

          try {
            props.setChoice(
            875,
            poolSkill >= 14 || (0,external_kolmafia_.haveEffect)(_this2.chalkEffect) == 0 ? 1 : 2);
            //Fight or train
            greyAdv(_this2.billards, outfit, settings);
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.billards];
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestManorBillards;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/manor/QuestManorGallery.ts
function QuestManorGallery_typeof(obj) {"@babel/helpers - typeof";return QuestManorGallery_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestManorGallery_typeof(obj);}function QuestManorGallery_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestManorGallery_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestManorGallery_toPropertyKey(descriptor.key), descriptor);}}function QuestManorGallery_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestManorGallery_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestManorGallery_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestManorGallery_defineProperty(obj, key, value) {key = QuestManorGallery_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestManorGallery_toPropertyKey(arg) {var key = QuestManorGallery_toPrimitive(arg, "string");return QuestManorGallery_typeof(key) === "symbol" ? key : String(key);}function QuestManorGallery_toPrimitive(input, hint) {if (QuestManorGallery_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestManorGallery_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}









var ManorGallery = /*#__PURE__*/function () {function ManorGallery() {QuestManorGallery_classCallCheck(this, ManorGallery);QuestManorGallery_defineProperty(this, "location",
    external_kolmafia_.Location.get("The Haunted Gallery"));QuestManorGallery_defineProperty(this, "item",
    external_kolmafia_.Item.get("Lady Spookyraven's dancing shoes"));QuestManorGallery_defineProperty(this, "sword",
    external_kolmafia_.Item.get("serpentine sword"));QuestManorGallery_defineProperty(this, "toAbsorb", void 0);}QuestManorGallery_createClass(ManorGallery, [{ key: "level", value:


    function level() {
      return 5;
    } }, { key: "status", value:

    function status() {
      var status = getQuestStatus("questM21Dance");

      if (
      status < 1 ||
      isGhostBustingTime(this.location) && shouldAvoidGhosts())
      {
        return QuestStatus.NOT_READY;
      }

      if (status > 1 || (0,external_kolmafia_.availableAmount)(this.item) > 0) {
        return QuestStatus.COMPLETED;
      }

      if (!hasNonCombatSkillsReady()) {
        return QuestStatus.FASTER_LATER;
      }

      if (this.hasDelay()) {
        if (DelayBurners.isDelayBurnerReady()) {
          return QuestStatus.READY;
        }

        if (DelayBurners.isDelayBurnerFeasible()) {
          return QuestStatus.FASTER_LATER;
        }
      }

      return QuestStatus.READY;
    } }, { key: "hasDelay", value:

    function hasDelay() {
      return this.location.turnsSpent < 5 && this.toAbsorb.length == 0;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = isGhostBustingTime(this.location) ?
      getGhostBustingOutfit() :
      new GreyOutfit();

      outfit.setNoCombat();

      if (this.toAbsorb.length == 0) {
        outfit.addDelayer(
        DelayCriteria().withForcedFights(this.hasDelay() ? null : false));

      }

      return {
        location: isGhostBustingTime(this.location) ? null : this.location,
        outfit: outfit,
        freeRun: function freeRun() {return true;},
        run: function run() {
          var props = new Properties_PropertyManager();
          var settings = new AdventureSettings();

          if (isGhostBustingTime(_this.location)) {
            settings.setStartOfFightMacro(getGhostBustingMacro());
          }

          if (DelayBurners.isTryingForDupeableGoblin()) {
            (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Grey Goose"));
          }

          /* if (availableAmount(this.sword) == 0) {
            props.setChoice(89, 2);
          } else*/{
            props.setChoice(89, 4);
          }

          props.setChoice(914, 1);

          if ((0,external_kolmafia_.getProperty)("louvreDesiredGoal") != "7") {
            props.setProperty("louvreDesiredGoal", "7");
          }

          try {
            greyAdv(_this.location, outfit, settings);
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "getId", value:

    function getId() {
      return "Manor / Gallery";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.location];
    } }, { key: "mustBeDone", value:

    function mustBeDone(reallyMustBeDone) {
      if (reallyMustBeDone) {
        return false;
      }

      return isGhostBustingTime(this.location);
    } }]);return ManorGallery;}();
;// CONCATENATED MODULE: ./src/quests/council/manor/QuestManorKitchen.ts
function QuestManorKitchen_typeof(obj) {"@babel/helpers - typeof";return QuestManorKitchen_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestManorKitchen_typeof(obj);}function QuestManorKitchen_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestManorKitchen_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestManorKitchen_toPropertyKey(descriptor.key), descriptor);}}function QuestManorKitchen_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestManorKitchen_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestManorKitchen_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestManorKitchen_defineProperty(obj, key, value) {key = QuestManorKitchen_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestManorKitchen_toPropertyKey(arg) {var key = QuestManorKitchen_toPrimitive(arg, "string");return QuestManorKitchen_typeof(key) === "symbol" ? key : String(key);}function QuestManorKitchen_toPrimitive(input, hint) {if (QuestManorKitchen_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestManorKitchen_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var QuestManorKitchen = /*#__PURE__*/function () {function QuestManorKitchen() {QuestManorKitchen_classCallCheck(this, QuestManorKitchen);QuestManorKitchen_defineProperty(this, "kitchen",
    external_kolmafia_.Location.get("The Haunted Kitchen"));QuestManorKitchen_defineProperty(this, "stenchResist",
    external_kolmafia_.Skill.get("Conifer Polymers"));QuestManorKitchen_defineProperty(this, "albinoBat",
    external_kolmafia_.Monster.get("Albino Bat"));QuestManorKitchen_defineProperty(this, "enoughRes",
    false);QuestManorKitchen_defineProperty(this, "lastResistTurnCheck",
    0);QuestManorKitchen_defineProperty(this, "canOfPaint",
    external_kolmafia_.Item.get("Can of black paint"));QuestManorKitchen_defineProperty(this, "asdonMartin",
    external_kolmafia_.Item.get("Asdon Martin keyfob"));QuestManorKitchen_defineProperty(this, "driveSafe",
    external_kolmafia_.Effect.get("Driving Safely"));QuestManorKitchen_defineProperty(this, "torso",
    external_kolmafia_.Skill.get("Torso Awareness"));QuestManorKitchen_defineProperty(this, "spoon",
    external_kolmafia_.Item.get("hewn moon-rune spoon"));QuestManorKitchen_defineProperty(this, "scaleShirt",
    external_kolmafia_.Item.get("blessed rustproof +2 gray dragon scale mail"));QuestManorKitchen_defineProperty(this, "telegram",
    external_kolmafia_.Item.get("Telegram from Lady Spookyraven"));QuestManorKitchen_defineProperty(this, "candleBuff",
    external_kolmafia_.Item.get("rainbow glitter candle"));QuestManorKitchen_defineProperty(this, "maydayEffect",
    external_kolmafia_.Effect.get("Ready to Survive"));}QuestManorKitchen_createClass(QuestManorKitchen, [{ key: "getId", value:

    function getId() {
      return "Manor / Kitchen";
    } }, { key: "level", value:

    function level() {
      return 4;
    } }, { key: "hasEnoughRes", value:

    function hasEnoughRes() {
      if (
      this.lastResistTurnCheck + (this.enoughRes ? 3 : 10) >
      (0,external_kolmafia_.totalTurnsPlayed)())
      {
        return this.enoughRes;
      }

      this.lastResistTurnCheck = (0,external_kolmafia_.totalTurnsPlayed)();

      (0,external_kolmafia_.maximize)("hot res 9 max, stench res 9 max -tie", true);
      var hotRes = (0,external_kolmafia_.numericModifier)("Generated:_spec", "Hot Resistance");
      var stenchRes = (0,external_kolmafia_.numericModifier)("Generated:_spec", "Stench Resistance");

      this.enoughRes = hotRes >= 9 && stenchRes >= 9;

      return this.enoughRes;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.availableAmount)(this.telegram) > 0) {
        (0,external_kolmafia_.use)(this.telegram);
      }

      // Each 3 resist in each element is another drawer searched.
      // 21 drawers searched.
      // Max of 9 total res
      var status = getQuestStatus("questM20Necklace");

      if (status > 0) {
        return QuestStatus.COMPLETED;
      }

      // If we haven't purchased our vacation pass yet, don't even think about it.
      if (status < 0) {
        return QuestStatus.NOT_READY;
      }

      if (
      !(0,external_kolmafia_.haveSkill)(this.torso) &&
      (0,external_kolmafia_.availableAmount)(this.scaleShirt) > 0 && (
      (0,external_kolmafia_.gnomadsAvailable)() ||
      (0,external_kolmafia_.availableAmount)(this.spoon) > 0 &&
      getMoonZone(GreySettings_GreySettings.greyTuneMoonSpoon) == "Gnomad" &&
      (0,external_kolmafia_.getProperty)("moonTuned") != "true"))
      {
        return QuestStatus.NOT_READY;
      }

      if (
      (getQuestStatus("questL11Black") <= 2 || (0,external_kolmafia_.myMeat)() < 1200) &&
      !this.hasEnoughRes())
      {

        //     return QuestStatus.FASTER_LATER;
      }
      if (
      (0,external_kolmafia_.haveEffect)((0,external_kolmafia_.effectModifier)(this.candleBuff, "Effect")) == 0 &&
      (0,external_kolmafia_.haveEffect)(this.maydayEffect) == 0 &&
      !(0,external_kolmafia_.haveSkill)(this.stenchResist) &&
      !GreyAbsorber_AbsorbsProvider.getReabsorbedMonsters().includes(this.albinoBat) &&
      (0,external_kolmafia_.myLevel)() < 12)
      {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();

      if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("manorDrawerCount")) < 20) {
        outfit.addWeight("hot res", 10, null, 9);
        outfit.addWeight("stench res", 10, null, 9);
      }

      return {
        outfit: outfit,
        location: this.kitchen,
        mayFreeRun: false,
        run: function run() {
          if (
          (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("manorDrawerCount")) < 20 &&
          !_this.hasEnoughRes())
          {
            if ((0,external_kolmafia_.availableAmount)(_this.candleBuff) > 0) {
              (0,external_kolmafia_.use)(_this.candleBuff);
            }

            if (
            (0,external_kolmafia_.haveEffect)((0,external_kolmafia_.effectModifier)(_this.canOfPaint, "Effect")) == 0 &&
            getQuestStatus("questL11Black") > 1)
            {
              (0,external_kolmafia_.cliExecute)("acquire 1 " + _this.canOfPaint.name);
              (0,external_kolmafia_.use)(_this.canOfPaint);
            }

            if (
            (0,external_kolmafia_.getWorkshed)() == _this.asdonMartin &&
            (0,external_kolmafia_.haveEffect)(_this.driveSafe) == 0 &&
            (0,external_kolmafia_.getFuel)() >= 37)
            {
              (0,external_kolmafia_.cliExecute)("asdonmartin drive safely");
            }
          }

          greyAdv(_this.kitchen, outfit);
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.kitchen];
    } }]);return QuestManorKitchen;}();
;// CONCATENATED MODULE: ./src/quests/council/manor/QuestManorLibrary.ts
function QuestManorLibrary_typeof(obj) {"@babel/helpers - typeof";return QuestManorLibrary_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestManorLibrary_typeof(obj);}function QuestManorLibrary_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestManorLibrary_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestManorLibrary_toPropertyKey(descriptor.key), descriptor);}}function QuestManorLibrary_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestManorLibrary_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestManorLibrary_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestManorLibrary_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestManorLibrary_setPrototypeOf(subClass, superClass);}function QuestManorLibrary_setPrototypeOf(o, p) {QuestManorLibrary_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestManorLibrary_setPrototypeOf(o, p);}function QuestManorLibrary_createSuper(Derived) {var hasNativeReflectConstruct = QuestManorLibrary_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestManorLibrary_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestManorLibrary_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestManorLibrary_possibleConstructorReturn(this, result);};}function QuestManorLibrary_possibleConstructorReturn(self, call) {if (call && (QuestManorLibrary_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestManorLibrary_assertThisInitialized(self);}function QuestManorLibrary_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestManorLibrary_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestManorLibrary_getPrototypeOf(o) {QuestManorLibrary_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestManorLibrary_getPrototypeOf(o);}function QuestManorLibrary_defineProperty(obj, key, value) {key = QuestManorLibrary_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestManorLibrary_toPropertyKey(arg) {var key = QuestManorLibrary_toPrimitive(arg, "string");return QuestManorLibrary_typeof(key) === "symbol" ? key : String(key);}function QuestManorLibrary_toPrimitive(input, hint) {if (QuestManorLibrary_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestManorLibrary_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}











var QuestManorLibrary = /*#__PURE__*/function (_TaskInfo) {QuestManorLibrary_inherits(QuestManorLibrary, _TaskInfo);var _super = QuestManorLibrary_createSuper(QuestManorLibrary);function QuestManorLibrary() {var _this;QuestManorLibrary_classCallCheck(this, QuestManorLibrary);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestManorLibrary_defineProperty(QuestManorLibrary_assertThisInitialized(_this), "library",
    external_kolmafia_.Location.get("The Haunted Library"));QuestManorLibrary_defineProperty(QuestManorLibrary_assertThisInitialized(_this), "killingJar",
    external_kolmafia_.Item.get("Killing Jar"));QuestManorLibrary_defineProperty(QuestManorLibrary_assertThisInitialized(_this), "key",
    external_kolmafia_.Item.get("[7302]Spookyraven library key"));QuestManorLibrary_defineProperty(QuestManorLibrary_assertThisInitialized(_this), "librarian",
    external_kolmafia_.Monster.get("Banshee Librarian"));QuestManorLibrary_defineProperty(QuestManorLibrary_assertThisInitialized(_this), "sweep",
    external_kolmafia_.Skill.get("System Sweep"));QuestManorLibrary_defineProperty(QuestManorLibrary_assertThisInitialized(_this), "nano",
    external_kolmafia_.Skill.get("Double Nanovision"));QuestManorLibrary_defineProperty(QuestManorLibrary_assertThisInitialized(_this), "desk",
    external_kolmafia_.Monster.get("Writing Desk"));QuestManorLibrary_defineProperty(QuestManorLibrary_assertThisInitialized(_this), "pathYR", void 0);QuestManorLibrary_defineProperty(QuestManorLibrary_assertThisInitialized(_this), "path", void 0);QuestManorLibrary_defineProperty(QuestManorLibrary_assertThisInitialized(_this), "paths",


    []);return _this;}QuestManorLibrary_createClass(QuestManorLibrary, [{ key: "createPaths", value:

    function createPaths(assumeUnstarted) {
      var wantJar =
      this.wantsGnomeKillingJar() &&
      (0,external_kolmafia_.availableAmount)(this.killingJar) == 0 &&
      getQuestStatus("questL11Desert") <= 0;
      var desksLeft =
      5 - (assumeUnstarted ? 0 : (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("writingDesksDefeated")));

      this.paths = [];
      this.path = new PossiblePath(desksLeft * 3, desksLeft * 4);
      this.pathYR = new PossiblePath(desksLeft * 2, desksLeft * 3).add(
      ResourceCategory.YELLOW_RAY);


      if (wantJar || assumeUnstarted) {
        this.paths.push(this.pathYR);
      }

      this.paths.push(this.path);
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "getId", value:

    function getId() {
      return "Manor / Library";
    } }, { key: "level", value:

    function level() {
      return 8;
    } }, { key: "getGnome", value:

    function getGnome() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("gnasirProgress"));
    } }, { key: "wantsGnomeKillingJar", value:

    function wantsGnomeKillingJar() {
      return (this.getGnome() & 4) != 4;
    } }, { key: "status", value:

    function status(path) {
      var status = getQuestStatus("questM20Necklace");

      if ((0,external_kolmafia_.availableAmount)(this.key) == 0) {
        return QuestStatus.NOT_READY;
      }

      if (status > 3) {
        return QuestStatus.COMPLETED;
      }

      if (getQuestStatus("questM21Dance") >= 0) {
        return QuestStatus.COMPLETED;
      }

      if (
      path != null &&
      path.canUse(ResourceCategory.YELLOW_RAY) > 0 &&
      !path.getResource(ResourceCategory.YELLOW_RAY).ready())
      {
        return QuestStatus.FASTER_LATER;
      }

      if (
      !(0,external_kolmafia_.haveSkill)(this.sweep) ||
      this.wantsKillingJar() && !(0,external_kolmafia_.haveSkill)(this.nano))
      {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "wantsKillingJar", value:

    function wantsKillingJar() {
      return (
        this.wantsGnomeKillingJar() &&
        (0,external_kolmafia_.availableAmount)(this.killingJar) == 0 &&
        getQuestStatus("questL11Desert") <= 0);

    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      var outfit = new GreyOutfit();
      var wantJar = this.wantsKillingJar();
      var banishLibrarian = !wantJar && !(0,external_kolmafia_.isBanished)(this.librarian);
      var resource = wantJar ?
      path.getResource(ResourceCategory.YELLOW_RAY) :
      null;

      if (resource != null && !resource.ready()) {
        resource = null;
      }

      if (wantJar) {
        if (resource != null) {
          resource.prepare(outfit);
        } else if (
        !path.canUse(ResourceCategory.YELLOW_RAY) && (
        !currentPredictions().has(this.library) ||
        currentPredictions().get(this.library) == this.librarian))
        {
          outfit.setItemDrops().setChampagneBottle();
        }
      }

      return {
        location: this.library,
        outfit: outfit,
        orbs: wantJar ? [this.librarian] : [],
        olfaction: [this.desk],
        freeRun: function freeRun(monster) {return (
            monster != _this2.desk && (!wantJar || monster != _this2.librarian));},
        run: function run() {
          var settings = new AdventureSettings();
          var props = new Properties_PropertyManager();

          settings.addBanish(external_kolmafia_.Monster.get("bookbat"));

          if (banishLibrarian) {
            settings.addBanish(_this2.librarian);
          } else if (resource != null) {
            resource.prepare(null, props);

            settings.setFinishingBlowMacro(
            Macro.if_(_this2.librarian, resource.macro()).skill(
            external_kolmafia_.Skill.get("Infinite Loop")));


          }

          props.setChoice(163, 3); // Rare adv that gives an item with 2k autosell, and worth 4-5k in mall
          props.setChoice(888, 4); // Skip
          props.setChoice(889, 5); // Skip

          try {
            greyAdv(_this2.library, outfit, settings);
          } finally {
            props.resetAll();
          }

          if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("writingDesksDefeated")) < 5) {
            return;
          }

          (0,external_kolmafia_.visitUrl)("place.php?whichplace=manor1&action=manor1_ladys");
          (0,external_kolmafia_.visitUrl)("place.php?whichplace=manor2&action=manor2_ladys");

          deleteJunkKmails();
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.library];
    } }]);return QuestManorLibrary;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/council/QuestManor.ts
function QuestManor_typeof(obj) {"@babel/helpers - typeof";return QuestManor_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestManor_typeof(obj);}function QuestManor_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestManor_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestManor_toPropertyKey(descriptor.key), descriptor);}}function QuestManor_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestManor_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestManor_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestManor_defineProperty(obj, key, value) {key = QuestManor_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestManor_toPropertyKey(arg) {var key = QuestManor_toPrimitive(arg, "string");return QuestManor_typeof(key) === "symbol" ? key : String(key);}function QuestManor_toPrimitive(input, hint) {if (QuestManor_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestManor_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}












var QuestManor = /*#__PURE__*/function () {function QuestManor() {QuestManor_classCallCheck(this, QuestManor);QuestManor_defineProperty(this, "quests",
    [
    new ManorBathroom(),
    new ManorBedroom(),
    new ManorGallery(),
    new QuestManorLibrary(),
    new QuestManorKitchen(),
    new QuestManorBillards()]);QuestManor_defineProperty(this, "puff",


    external_kolmafia_.Item.get("Lady Spookyraven's powder puff"));QuestManor_defineProperty(this, "gown",
    external_kolmafia_.Item.get("Lady Spookyraven's finest gown"));QuestManor_defineProperty(this, "shoes",
    external_kolmafia_.Item.get("Lady Spookyraven's dancing shoes"));QuestManor_defineProperty(this, "ballroom",
    external_kolmafia_.Location.get("The Haunted Ballroom"));}QuestManor_createClass(QuestManor, [{ key: "level", value:

    function level() {
      return 8;
    } }, { key: "getId", value:

    function getId() {
      return "Manor / Chat";
    } }, { key: "getManorStatus", value:

    function getManorStatus() {
      return getQuestStatus("questM20Necklace");
    } }, { key: "getDanceStatus", value:

    function getDanceStatus() {
      return getQuestStatus("questM21Dance");
    } }, { key: "status", value:

    function status() {
      var danceStatus = this.getDanceStatus();

      if (danceStatus == DanceStatus.finished) {
        return QuestStatus.COMPLETED;
      }

      if (getQuestStatus("questM20Necklace") < 4) {
        return QuestStatus.NOT_READY;
      }

      if (getQuestStatus("questM20Necklace") != 100) {
        return QuestStatus.READY;
      }

      if (danceStatus == DanceStatus.readyToDance) {
        return QuestStatus.READY;
      }

      if (
      (0,external_kolmafia_.availableAmount)(this.puff) +
      (0,external_kolmafia_.availableAmount)(this.gown) +
      (0,external_kolmafia_.availableAmount)(this.shoes) !=
      3)
      {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return true;
    } }, { key: "free", value:

    function free() {
      return true;
    } }, { key: "run", value:

    function run() {var _this = this;
      if (getQuestStatus("questM20Necklace") < 100) {
        return this.doUpstairs();
      }

      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          (0,external_kolmafia_.visitUrl)("place.php?whichplace=manor2&action=manor2_ladys");
          greyAdv(_this.ballroom);
          // visitUrl("place.php?whichplace=manor3&action=manor3_ladys");

          deleteJunkKmails();
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "getChildren", value:

    function getChildren() {
      return this.quests;
    } }, { key: "doUpstairs", value:

    function doUpstairs() {
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          (0,external_kolmafia_.print)("Lets chat up the old lady");
          (0,external_kolmafia_.visitUrl)("place.php?whichplace=manor1&action=manor1_ladys");
          (0,external_kolmafia_.visitUrl)("place.php?whichplace=manor2&action=manor2_ladys");

          deleteJunkKmails();
        }
      };
    } }]);return QuestManor;}();var


QuestManor_ManorStatus;(function (ManorStatus) {ManorStatus[ManorStatus["unstarted"] = -1] = "unstarted";ManorStatus[ManorStatus["DOING_KITCHEN"] = 0] = "DOING_KITCHEN";ManorStatus[ManorStatus["HAVE_POOL_KEY"] = 1] = "HAVE_POOL_KEY";ManorStatus[ManorStatus["HAVE_POOL_CUE"] = 2] = "HAVE_POOL_CUE";ManorStatus[ManorStatus["HAVE_LIBRARY_KEY"] = 3] = "HAVE_LIBRARY_KEY";ManorStatus[ManorStatus["HAVE_UPSTAIRS_KEY"] = 4] = "HAVE_UPSTAIRS_KEY";ManorStatus[ManorStatus["GOING_UPSTAIRS"] = 5] = "GOING_UPSTAIRS";ManorStatus[ManorStatus["finished"] = 100] = "finished";})(QuestManor_ManorStatus || (QuestManor_ManorStatus = {}));var










DanceStatus;(function (DanceStatus) {DanceStatus[DanceStatus["unstarted"] = -1] = "unstarted";DanceStatus[DanceStatus["started"] = 0] = "started";DanceStatus[DanceStatus["wantsToDance"] = 1] = "wantsToDance";DanceStatus[DanceStatus["hasAllThreeItems"] = 2] = "hasAllThreeItems";DanceStatus[DanceStatus["readyToDance"] = 3] = "readyToDance";DanceStatus[DanceStatus["finished"] = 100] = "finished";})(DanceStatus || (DanceStatus = {}));
;// CONCATENATED MODULE: ./src/quests/custom/QuestCar.ts
function QuestCar_typeof(obj) {"@babel/helpers - typeof";return QuestCar_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestCar_typeof(obj);}function QuestCar_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestCar_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestCar_toPropertyKey(descriptor.key), descriptor);}}function QuestCar_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestCar_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestCar_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestCar_defineProperty(obj, key, value) {key = QuestCar_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestCar_toPropertyKey(arg) {var key = QuestCar_toPrimitive(arg, "string");return QuestCar_typeof(key) === "symbol" ? key : String(key);}function QuestCar_toPrimitive(input, hint) {if (QuestCar_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestCar_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}




var QuestCar = /*#__PURE__*/function () {function QuestCar() {QuestCar_classCallCheck(this, QuestCar);QuestCar_defineProperty(this, "tinkersThingy",
    external_kolmafia_.Location.get("The Degrassi Knoll Garage"));QuestCar_defineProperty(this, "bitchCar",
    external_kolmafia_.Item.get("Bitchin' meatcar"));QuestCar_defineProperty(this, "toolbox",
    external_kolmafia_.Item.get("Gnollish toolbox"));QuestCar_defineProperty(this, "sweetRims",
    external_kolmafia_.Item.get("Sweet Rims"));QuestCar_defineProperty(this, "dopeWheels",
    external_kolmafia_.Item.get("Dope Wheels"));QuestCar_defineProperty(this, "bugbear",
    external_kolmafia_.Monster.get("Guard Bugbear"));}QuestCar_createClass(QuestCar, [{ key: "level", value:

    function level() {
      return (0,external_kolmafia_.knollAvailable)() ? 7 : 11;
    } }, { key: "tryMakeBitchCar", value:

    function tryMakeBitchCar() {
      if ((0,external_kolmafia_.availableAmount)(this.toolbox) > 0) {
        (0,external_kolmafia_.use)(this.toolbox, (0,external_kolmafia_.availableAmount)(this.toolbox));
      }

      if (
      (0,external_kolmafia_.availableAmount)(this.dopeWheels) + (0,external_kolmafia_.availableAmount)(this.sweetRims) ==
      0)
      {
        (0,external_kolmafia_.retrieveItem)(this.sweetRims);
      }

      (0,external_kolmafia_.create)(this.bitchCar);
    } }, { key: "hasBoat", value:

    function hasBoat() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastIslandUnlock")) == (0,external_kolmafia_.myAscensions)();
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastDesertUnlock")) == (0,external_kolmafia_.myAscensions)()) {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.myMeat)() < 700 || !(0,external_kolmafia_.knollAvailable)()) {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.knollAvailable)()) {
        return QuestStatus.READY;
      }

      /*if (
        myLevel() < 11 ||
        !GreySettings.isHippyMode() ||
        (this.hasBoat() && getQuestStatus("questL11Black") <= 1)
      ) {
        return QuestStatus.FASTER_LATER;
      }*/

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      //if (knollAvailable()) {
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          _this.tryMakeBitchCar();
        }
      };
      /*}
       let outfit = new GreyOutfit().setItemDrops();
       return {
        outfit: outfit,
        location: this.tinkersThingy,
        run: () => {
          greyAdv(
            this.tinkersThingy,
            outfit,
            new AdventureSettings().addBanish(this.bugbear)
          );
           this.tryMakeBitchCar();
        },
      };*/



    } }, { key: "getId", value:

    function getId() {
      return "Misc / MeatCar";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.tinkersThingy];
    } }]);return QuestCar;}();
;// CONCATENATED MODULE: ./src/quests/custom/QuestManorLights.ts
function QuestManorLights_typeof(obj) {"@babel/helpers - typeof";return QuestManorLights_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestManorLights_typeof(obj);}function QuestManorLights_slicedToArray(arr, i) {return QuestManorLights_arrayWithHoles(arr) || QuestManorLights_iterableToArrayLimit(arr, i) || QuestManorLights_unsupportedIterableToArray(arr, i) || QuestManorLights_nonIterableRest();}function QuestManorLights_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function QuestManorLights_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function QuestManorLights_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function QuestManorLights_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestManorLights_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestManorLights_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestManorLights_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestManorLights_arrayLikeToArray(o, minLen);}function QuestManorLights_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestManorLights_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestManorLights_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestManorLights_toPropertyKey(descriptor.key), descriptor);}}function QuestManorLights_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestManorLights_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestManorLights_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestManorLights_defineProperty(obj, key, value) {key = QuestManorLights_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestManorLights_toPropertyKey(arg) {var key = QuestManorLights_toPrimitive(arg, "string");return QuestManorLights_typeof(key) === "symbol" ? key : String(key);}function QuestManorLights_toPrimitive(input, hint) {if (QuestManorLights_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestManorLights_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var QuestManorLights = /*#__PURE__*/function () {


































  function QuestManorLights() {QuestManorLights_classCallCheck(this, QuestManorLights);QuestManorLights_defineProperty(this, "choices", [890, 891, 892, 893, 894, 895, 896, 897, 898, 899, 900, 901, 902, 903]);QuestManorLights_defineProperty(this, "elizibeth", [[external_kolmafia_.Location.get("The Haunted Storage Room"), 3], [external_kolmafia_.Location.get("The Haunted Laundry Room"), 3], [external_kolmafia_.Location.get("The Haunted Bathroom"), 3], [external_kolmafia_.Location.get("The Haunted Kitchen"), 4], [external_kolmafia_.Location.get("The Haunted Library"), 2], [external_kolmafia_.Location.get("The Haunted Ballroom"), 2], [external_kolmafia_.Location.get("The Haunted Gallery"), 4]]);QuestManorLights_defineProperty(this, "stephen", [[external_kolmafia_.Location.get("The Haunted Bedroom"), [1, 3, 1]], [external_kolmafia_.Location.get("The Haunted Nursery"), [1, 2, 2, 1, 1]], [external_kolmafia_.Location.get("The Haunted Conservatory"), [1, 2, 2]], [external_kolmafia_.Location.get("The Haunted Billiards Room"), [1, 2, 2]], [external_kolmafia_.Location.get("The Haunted Wine Cellar"), [1, 2, 2, 3]], [external_kolmafia_.Location.get("The Haunted Boiler Room"), [1, 2, 2]], [external_kolmafia_.Location.get("The Haunted Laboratory"), [1, 1, 3, 1, 1]]]);QuestManorLights_defineProperty(this, "elizabethRewards", [external_kolmafia_.Item.get("Elizabeth's Dollie"), external_kolmafia_.Item.get("Elizabeth's paintbrush")]);QuestManorLights_defineProperty(this, "stephsRewards", [external_kolmafia_.Item.get("Stephen's lab coat"), external_kolmafia_.Item.get("Stephen's secret formula")]);QuestManorLights_defineProperty(this, "goose", external_kolmafia_.Familiar.get("Grey Goose"));QuestManorLights_defineProperty(this, "teleportis", external_kolmafia_.Effect.get("Teleportitis"));QuestManorLights_defineProperty(this, "finishLights", (0,external_kolmafia_.toBoolean)((0,external_kolmafia_.getProperty)("greyFinishManorLights")));var _iterator = QuestManorLights_createForOfIteratorHelper(
      this.choices),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var choice = _step.value;
        var prop = "choiceAdventure" + choice;

        if ((0,external_kolmafia_.getProperty)(prop) != "") {
          continue;
        }

        // Make sure we don't halt on any of the NC
        (0,external_kolmafia_.setProperty)(prop, "1");
      }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
  }QuestManorLights_createClass(QuestManorLights, [{ key: "level", value:

    function level() {
      return 5;
    } }, { key: "isElizaReady", value:

    function isElizaReady() {
      return (0,external_kolmafia_.getProperty)("nextSpookyravenElizabethRoom") != "none";
    } }, { key: "isSteveReady", value:

    function isSteveReady() {
      return (0,external_kolmafia_.getProperty)("nextSpookyravenStephenRoom") != "none";
    } }, { key: "isElizaFight", value:

    function isElizaFight() {
      return (0,external_kolmafia_.getProperty)("nextSpookyravenElizabethRoom") == "The Haunted Gallery";
    } }, { key: "isSteveFight", value:

    function isSteveFight() {
      return (
        (0,external_kolmafia_.getProperty)("nextSpookyravenStephenRoom") == "The Haunted Laboratory");

    } }, { key: "getSteveLeft", value:

    function getSteveLeft() {
      var loc = external_kolmafia_.Location.get((0,external_kolmafia_.getProperty)("nextSpookyravenStephenRoom"));

      var index = this.stephen.findIndex(function (_ref) {var _ref2 = QuestManorLights_slicedToArray(_ref, 1),l = _ref2[0];return loc == l;});

      return index;
    } }, { key: "getElizaLeft", value:

    function getElizaLeft() {
      var loc = external_kolmafia_.Location.get((0,external_kolmafia_.getProperty)("nextSpookyravenElizabethRoom"));

      var index = this.elizibeth.findIndex(function (_ref3) {var _ref4 = QuestManorLights_slicedToArray(_ref3, 1),l = _ref4[0];return loc == l;});

      return index;
    } }, { key: "hasFamiliarRecommendation", value:

    function hasFamiliarRecommendation() {
      if (
      !this.isSteveFight() ||
      (0,external_kolmafia_.familiarWeight)(this.goose) >= 7 ||
      !this.finishLights)
      {
        return null;
      }

      return this.goose;
    } }, { key: "shouldDoSteve", value:

    function shouldDoSteve() {
      return (
        this.isSteveReady() && (
        !this.isSteveFight() || (0,external_kolmafia_.familiarWeight)(this.goose) >= 7));

    } }, { key: "getSteve", value:

    function getSteve() {
      var loc = external_kolmafia_.Location.get((0,external_kolmafia_.getProperty)("nextSpookyravenStephenRoom"));

      return this.stephen.find(function (s) {return s[0] == loc;});
    } }, { key: "getEliza", value:

    function getEliza() {
      var loc = external_kolmafia_.Location.get((0,external_kolmafia_.getProperty)("nextSpookyravenElizabethRoom"));

      return this.elizibeth.find(function (s) {return s[0] == loc;});
    } }, { key: "isTime", value:

    function isTime() {
      var last = this.getLastLightsOut();

      if (last >= (0,external_kolmafia_.totalTurnsPlayed)()) {
        return false;
      }

      return (0,external_kolmafia_.totalTurnsPlayed)() % 37 == 0;
    } }, { key: "getLastLightsOut", value:

    function getLastLightsOut() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastLightsOutTurn"));
    } }, { key: "status", value:

    function status() {
      if (!this.isTime() || (0,external_kolmafia_.haveEffect)(this.teleportis) > 0) {
        return QuestStatus.NOT_READY;
      }

      if (!this.isElizaReady() && !this.shouldDoSteve()) {
        return QuestStatus.COMPLETED;
      }

      if (this.isElizaFight() && this.isSteveFight() && !this.finishLights) {
        return QuestStatus.COMPLETED;
      }

      if (!this.mustBeDone()) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "getBoth", value:

    function getBoth() {
      return (
        (0,external_kolmafia_.getProperty)("nextSpookyravenStephenRoom") +
        (0,external_kolmafia_.getProperty)("nextSpookyravenElizabethRoom"));

    } }, { key: "doSteve", value:

    function doSteve() {var _this = this;
      var steve = this.getSteve();
      var fight = this.isSteveFight();
      var outfit = fight ?
      new GreyOutfit() :
      GreyOutfit.IGNORE_OUTFIT;

      if (this.isSteveFight()) {
        outfit.meatDropWeight = 2;
      }

      if ((0,external_kolmafia_.getProperty)("_juneCleaverFightsLeft") == "0") {
        if (fight) {
          outfit.addIgnored(external_kolmafia_.Item.get("June Cleaver"));
        } else {
          (0,external_kolmafia_.equip)(external_kolmafia_.Slot.get("weapon"), external_kolmafia_.Item.none);
        }
      }

      return {
        location: null,
        familiar: fight ? this.goose : null,
        outfit: outfit,
        run: function run() {
          var both = _this.getBoth();

          (0,external_kolmafia_.visitUrl)("adventure.php?snarfblat=" + (0,external_kolmafia_.toInt)(steve[0]));

          if (!(0,external_kolmafia_.handlingChoice)() && (0,external_kolmafia_.currentRound)() == 0) {
            return;
          }

          if (!(0,external_kolmafia_.handlingChoice)() || !_this.choices.includes((0,external_kolmafia_.lastChoice)())) {
            greyAdv(null);
            return;
          }var _iterator2 = QuestManorLights_createForOfIteratorHelper(

            steve[1]),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var i = _step2.value;
              var url =
              "choice.php?pwd=&whichchoice=" + (0,external_kolmafia_.lastChoice)() + "&option=" + i;

              (0,external_kolmafia_.visitUrl)(url);
            }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}

          if ((0,external_kolmafia_.currentRound)() != 0) {
            greyAdv(
            null,
            outfit,
            new AdventureSettings().setStartOfFightMacro(
            Macro.skill(external_kolmafia_.Skill.get("Emit Matter Duplicating Drones"))));


          }

          _this.printStatus();

          var both2 = _this.getBoth();

          if (both == both2) {
            throw "No progress was made in steve..";
          }
        }
      };
    } }, { key: "printStatus", value:

    function printStatus() {
      if (this.isSteveReady()) {
        (0,external_kolmafia_.print)(
        "Lights Out: Stephen rooms explored: " +
        this.getSteveLeft() +
        " / " +
        this.stephen.length,
        "blue");

      }

      if (this.isElizaReady()) {
        (0,external_kolmafia_.print)(
        "Lights Out: Elizabeth rooms explored: " +
        this.getElizaLeft() +
        " / " +
        this.elizibeth.length,
        "blue");

      }
    } }, { key: "run", value:

    function run() {
      if (this.shouldDoSteve() && (!this.isSteveFight() || this.finishLights)) {
        var steve = this.getSteve();

        if (canGreyAdventure(steve[0])) {
          return this.doSteve();
        }
      }

      if (this.isElizaReady() && (!this.isElizaFight() || this.finishLights)) {
        var eliza = this.getEliza();

        if (canGreyAdventure(eliza[0])) {
          return this.doEliza();
        }
      }

      return {
        location: null,
        run: function run() {
          throw "Neither steve or eliza were ready!";
        }
      };
    } }, { key: "doEliza", value:

    function doEliza() {var _this2 = this;
      var eliza = this.getEliza();
      var fight = this.isElizaFight();
      var outfit = !fight ? GreyOutfit.IGNORE_OUTFIT : new GreyOutfit();

      if ((0,external_kolmafia_.getProperty)("_juneCleaverFightsLeft") == "0") {
        if (fight) {
          outfit.addBonus("-equip june cleaver");
        } else {
          (0,external_kolmafia_.equip)(external_kolmafia_.Slot.get("weapon"), external_kolmafia_.Item.none);
        }
      }

      return {
        location: null,
        outfit: outfit,
        run: function run() {
          var both = _this2.getBoth();
          (0,external_kolmafia_.visitUrl)("adventure.php?snarfblat=" + (0,external_kolmafia_.toInt)(eliza[0]));

          if (!(0,external_kolmafia_.handlingChoice)() && (0,external_kolmafia_.currentRound)() == 0) {
            return;
          }

          if (!(0,external_kolmafia_.handlingChoice)() || !_this2.choices.includes((0,external_kolmafia_.lastChoice)())) {
            greyAdv(null);
            return;
          }

          var url =
          "choice.php?pwd=&whichchoice=" + (0,external_kolmafia_.lastChoice)() + "&option=" + eliza[1];

          (0,external_kolmafia_.visitUrl)(url);

          if ((0,external_kolmafia_.currentRound)() != 0) {
            greyAdv(null);
          }

          _this2.printStatus();

          var both2 = _this2.getBoth();

          if (both == both2) {
            throw "No progress was made in eliza..";
          }
        }
      };
    } }, { key: "getId", value:

    function getId() {
      return "Misc / ManorLights";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      if (!this.isTime()) {
        return false;
      }

      if (this.isElizaReady()) {
        var eliza = this.getEliza();

        if (canGreyAdventure(eliza[0])) {
          return true;
        }
      }

      if (this.shouldDoSteve()) {
        var steve = this.getSteve();

        if (canGreyAdventure(steve[0])) {
          return true;
        }
      }

      return false;
    } }, { key: "free", value:

    function free() {
      return (
        this.isSteveReady() && !this.isSteveFight() ||
        this.isElizaReady() && !this.isElizaFight());

    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestManorLights;}();
;// CONCATENATED MODULE: ./src/quests/absorbs/QuestMoonSignAbsorb.ts
function QuestMoonSignAbsorb_typeof(obj) {"@babel/helpers - typeof";return QuestMoonSignAbsorb_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestMoonSignAbsorb_typeof(obj);}function QuestMoonSignAbsorb_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestMoonSignAbsorb_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestMoonSignAbsorb_toPropertyKey(descriptor.key), descriptor);}}function QuestMoonSignAbsorb_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestMoonSignAbsorb_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestMoonSignAbsorb_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestMoonSignAbsorb_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestMoonSignAbsorb_setPrototypeOf(subClass, superClass);}function QuestMoonSignAbsorb_setPrototypeOf(o, p) {QuestMoonSignAbsorb_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestMoonSignAbsorb_setPrototypeOf(o, p);}function QuestMoonSignAbsorb_createSuper(Derived) {var hasNativeReflectConstruct = QuestMoonSignAbsorb_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestMoonSignAbsorb_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestMoonSignAbsorb_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestMoonSignAbsorb_possibleConstructorReturn(this, result);};}function QuestMoonSignAbsorb_possibleConstructorReturn(self, call) {if (call && (QuestMoonSignAbsorb_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestMoonSignAbsorb_assertThisInitialized(self);}function QuestMoonSignAbsorb_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestMoonSignAbsorb_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestMoonSignAbsorb_getPrototypeOf(o) {QuestMoonSignAbsorb_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestMoonSignAbsorb_getPrototypeOf(o);}function QuestMoonSignAbsorb_defineProperty(obj, key, value) {key = QuestMoonSignAbsorb_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestMoonSignAbsorb_toPropertyKey(arg) {var key = QuestMoonSignAbsorb_toPrimitive(arg, "string");return QuestMoonSignAbsorb_typeof(key) === "symbol" ? key : String(key);}function QuestMoonSignAbsorb_toPrimitive(input, hint) {if (QuestMoonSignAbsorb_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestMoonSignAbsorb_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}









var QuestMoonSignAbsorb = /*#__PURE__*/function (_TaskInfo) {QuestMoonSignAbsorb_inherits(QuestMoonSignAbsorb, _TaskInfo);var _super = QuestMoonSignAbsorb_createSuper(QuestMoonSignAbsorb);function QuestMoonSignAbsorb() {var _this;QuestMoonSignAbsorb_classCallCheck(this, QuestMoonSignAbsorb);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestMoonSignAbsorb_defineProperty(QuestMoonSignAbsorb_assertThisInitialized(_this), "spoon",



    external_kolmafia_.Item.get("hewn moon-rune spoon"));QuestMoonSignAbsorb_defineProperty(QuestMoonSignAbsorb_assertThisInitialized(_this), "goose",
    external_kolmafia_.Familiar.get("Grey Goose"));QuestMoonSignAbsorb_defineProperty(QuestMoonSignAbsorb_assertThisInitialized(_this), "paths", void 0);QuestMoonSignAbsorb_defineProperty(QuestMoonSignAbsorb_assertThisInitialized(_this), "monster", void 0);QuestMoonSignAbsorb_defineProperty(QuestMoonSignAbsorb_assertThisInitialized(_this), "location", void 0);QuestMoonSignAbsorb_defineProperty(QuestMoonSignAbsorb_assertThisInitialized(_this), "moonZone", void 0);return _this;}QuestMoonSignAbsorb_createClass(QuestMoonSignAbsorb, [{ key: "level", value:







    function level() {
      if (
      this.isInSign() &&
      GreySettings_GreySettings.canMoonSpoon() &&
      getMoonZone() != "Gnomad" &&
      getMoonZone(GreySettings_GreySettings.greyTuneMoonSpoon) == "Gnomad")
      {
        return 6;
      }

      return this.isInSign() ? 12 : 16;
    } }, { key: "getAbsorbs", value:

    function getAbsorbs() {
      return [this.monster];
    } }, { key: "status", value:

    function status(path) {
      if (path == null) {
        return QuestStatus.NOT_READY;
      }

      if (
      !GreySettings_GreySettings.canMoonSpoon() ||
      GreyAbsorber_AbsorbsProvider.getReabsorbedMonsters().includes(this.monster))
      {
        return QuestStatus.COMPLETED;
      }

      // If we're not in the moon sign
      if (!this.isInSign()) {
        // If we will be in the sign eventually
        if (this.willMoonTune(false)) {
          return QuestStatus.NOT_READY;
        }

        // If we will not be in the sign eventually and can't hit this monster
        if (!path.canUse(ResourceCategory.FAXER)) {
          return QuestStatus.COMPLETED;
        }
      } else if ((0,external_kolmafia_.getProperty)("moonTuned") == "true") {
        // If we've tuned to this sign, don't bother handling this like a quest
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.familiarWeight)(this.goose) < 6) {
        return QuestStatus.NOT_READY;
      }

      if (this.level() <= 6) {
        return QuestStatus.READY;
      }

      return QuestStatus.FASTER_LATER;
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      if (path != null && path.canUse(ResourceCategory.FAXER)) {
        var resource = path.getResource(ResourceCategory.FAXER);

        return {
          location: null,
          outfit: null,
          familiar: this.goose,
          disableFamOverride: true,
          run: function run() {
            resource.fax(_this2.monster);

            Macro.trySkill(external_kolmafia_.Skill.get("Re-Process Matter")).
            trySkillRepeat(external_kolmafia_.Skill.get("Infinite Loop")).
            submit();

            if ((0,external_kolmafia_.handlingChoice)() || (0,external_kolmafia_.currentRound)() != 0) {
              throw "We're supposed to be done with this fax fight!";
            }
          }
        };
      }

      return {
        location: this.location,
        orbs: [this.monster],
        freeRun: function freeRun(monster) {return monster != _this2.monster;},
        run: function run() {
          greyAdv(_this2.location);
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.location];
    } }, { key: "createPaths", value:

    function createPaths(assumeUnstarted) {
      if (this.isInSign() || this.willMoonTune(assumeUnstarted)) {
        this.paths = [new PossiblePath(3)];
        return;
      }

      if (GreySettings_GreySettings.isNerfMode()) {
        this.paths = null;
        return;
      }

      this.paths = [];
      var faxing = new PossiblePath(1);

      if (
      assumeUnstarted ||
      !GreyAbsorber_AbsorbsProvider.getReabsorbedMonsters().includes(this.monster))
      {
        faxing.addFax(this.monster);
      }

      this.paths.push(faxing, new PossiblePath(14));
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "isInSign", value:

    function isInSign() {
      if ((0,external_kolmafia_.knollAvailable)()) {
        return this.moonZone == "Knoll";
      }

      if ((0,external_kolmafia_.gnomadsAvailable)()) {
        return this.moonZone == "Gnomad";
      }

      if ((0,external_kolmafia_.canadiaAvailable)()) {
        return this.moonZone == "Canadia";
      }

      return false;
    } }, { key: "willMoonTune", value:

    function willMoonTune(assumeUnstarted) {
      if ((0,external_kolmafia_.availableAmount)(this.spoon) == 0) {
        return false;
      }

      if ((0,external_kolmafia_.getProperty)("moonTuned") == "true" && !assumeUnstarted) {
        return false;
      }

      return getMoonZone(GreySettings_GreySettings.greyTuneMoonSpoon) == this.moonZone;
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestMoonSignAbsorb;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/absorbs/QuestAbsorbCanadia.ts
function QuestAbsorbCanadia_typeof(obj) {"@babel/helpers - typeof";return QuestAbsorbCanadia_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestAbsorbCanadia_typeof(obj);}function QuestAbsorbCanadia_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestAbsorbCanadia_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestAbsorbCanadia_toPropertyKey(descriptor.key), descriptor);}}function QuestAbsorbCanadia_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestAbsorbCanadia_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestAbsorbCanadia_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestAbsorbCanadia_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestAbsorbCanadia_setPrototypeOf(subClass, superClass);}function QuestAbsorbCanadia_setPrototypeOf(o, p) {QuestAbsorbCanadia_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestAbsorbCanadia_setPrototypeOf(o, p);}function QuestAbsorbCanadia_createSuper(Derived) {var hasNativeReflectConstruct = QuestAbsorbCanadia_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestAbsorbCanadia_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestAbsorbCanadia_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestAbsorbCanadia_possibleConstructorReturn(this, result);};}function QuestAbsorbCanadia_possibleConstructorReturn(self, call) {if (call && (QuestAbsorbCanadia_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestAbsorbCanadia_assertThisInitialized(self);}function QuestAbsorbCanadia_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestAbsorbCanadia_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestAbsorbCanadia_getPrototypeOf(o) {QuestAbsorbCanadia_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestAbsorbCanadia_getPrototypeOf(o);}function QuestAbsorbCanadia_defineProperty(obj, key, value) {key = QuestAbsorbCanadia_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestAbsorbCanadia_toPropertyKey(arg) {var key = QuestAbsorbCanadia_toPrimitive(arg, "string");return QuestAbsorbCanadia_typeof(key) === "symbol" ? key : String(key);}function QuestAbsorbCanadia_toPrimitive(input, hint) {if (QuestAbsorbCanadia_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestAbsorbCanadia_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}




var QuestAbsorbCanadia = /*#__PURE__*/function (_QuestMoonSignAbsorb) {QuestAbsorbCanadia_inherits(QuestAbsorbCanadia, _QuestMoonSignAbsorb);var _super = QuestAbsorbCanadia_createSuper(QuestAbsorbCanadia);function QuestAbsorbCanadia() {var _this;QuestAbsorbCanadia_classCallCheck(this, QuestAbsorbCanadia);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestAbsorbCanadia_defineProperty(QuestAbsorbCanadia_assertThisInitialized(_this), "monster",
    external_kolmafia_.Monster.get("cloud of disembodied whiskers"));QuestAbsorbCanadia_defineProperty(QuestAbsorbCanadia_assertThisInitialized(_this), "location",
    external_kolmafia_.Location.get("Outskirts of Camp Logging Camp"));QuestAbsorbCanadia_defineProperty(QuestAbsorbCanadia_assertThisInitialized(_this), "moonZone",
    "Canadia");return _this;}QuestAbsorbCanadia_createClass(QuestAbsorbCanadia, [{ key: "getId", value:

    function getId() {
      return "Absorbs / Canadia";
    } }]);return QuestAbsorbCanadia;}(QuestMoonSignAbsorb);
;// CONCATENATED MODULE: ./src/quests/absorbs/QuestAbsorbStarMonster.ts
function QuestAbsorbStarMonster_typeof(obj) {"@babel/helpers - typeof";return QuestAbsorbStarMonster_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestAbsorbStarMonster_typeof(obj);}function QuestAbsorbStarMonster_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestAbsorbStarMonster_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestAbsorbStarMonster_toPropertyKey(descriptor.key), descriptor);}}function QuestAbsorbStarMonster_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestAbsorbStarMonster_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestAbsorbStarMonster_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestAbsorbStarMonster_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestAbsorbStarMonster_setPrototypeOf(subClass, superClass);}function QuestAbsorbStarMonster_setPrototypeOf(o, p) {QuestAbsorbStarMonster_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestAbsorbStarMonster_setPrototypeOf(o, p);}function QuestAbsorbStarMonster_createSuper(Derived) {var hasNativeReflectConstruct = QuestAbsorbStarMonster_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestAbsorbStarMonster_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestAbsorbStarMonster_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestAbsorbStarMonster_possibleConstructorReturn(this, result);};}function QuestAbsorbStarMonster_possibleConstructorReturn(self, call) {if (call && (QuestAbsorbStarMonster_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestAbsorbStarMonster_assertThisInitialized(self);}function QuestAbsorbStarMonster_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestAbsorbStarMonster_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestAbsorbStarMonster_getPrototypeOf(o) {QuestAbsorbStarMonster_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestAbsorbStarMonster_getPrototypeOf(o);}function QuestAbsorbStarMonster_defineProperty(obj, key, value) {key = QuestAbsorbStarMonster_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestAbsorbStarMonster_toPropertyKey(arg) {var key = QuestAbsorbStarMonster_toPrimitive(arg, "string");return QuestAbsorbStarMonster_typeof(key) === "symbol" ? key : String(key);}function QuestAbsorbStarMonster_toPrimitive(input, hint) {if (QuestAbsorbStarMonster_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestAbsorbStarMonster_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}








var QuestAbsorbStarMonster = /*#__PURE__*/function (_TaskInfo) {QuestAbsorbStarMonster_inherits(QuestAbsorbStarMonster, _TaskInfo);var _super = QuestAbsorbStarMonster_createSuper(QuestAbsorbStarMonster);function QuestAbsorbStarMonster() {var _this;QuestAbsorbStarMonster_classCallCheck(this, QuestAbsorbStarMonster);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestAbsorbStarMonster_defineProperty(QuestAbsorbStarMonster_assertThisInitialized(_this), "evenMonster",
    external_kolmafia_.Monster.get("One-Eyed Willie"));QuestAbsorbStarMonster_defineProperty(QuestAbsorbStarMonster_assertThisInitialized(_this), "oddMonster",
    external_kolmafia_.Monster.get("Little Man in the Canoe"));QuestAbsorbStarMonster_defineProperty(QuestAbsorbStarMonster_assertThisInitialized(_this), "familiar",
    external_kolmafia_.Familiar.get("Grey Goose"));QuestAbsorbStarMonster_defineProperty(QuestAbsorbStarMonster_assertThisInitialized(_this), "nanovision",
    external_kolmafia_.Skill.get("Double Nanovision"));QuestAbsorbStarMonster_defineProperty(QuestAbsorbStarMonster_assertThisInitialized(_this), "paths", void 0);return _this;}QuestAbsorbStarMonster_createClass(QuestAbsorbStarMonster, [{ key: "createPaths", value:


    function createPaths() {
      if (GreySettings_GreySettings.isNerfMode()) {
        return;
      }

      this.paths = [];
      this.paths.push(new PossiblePath(1).addFax(this.getMonster()));
      this.paths.push(new PossiblePath(20));
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "getMonster", value:

    function getMonster() {
      return (0,external_kolmafia_.myAscensions)() % 2 != 0 ? this.evenMonster : this.oddMonster;
    } }, { key: "getId", value:

    function getId() {
      return "Absorbs / Hole in Sky";
    } }, { key: "level", value:

    function level() {
      return 16;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "status", value:

    function status(path) {
      if (GreyAbsorber_AbsorbsProvider.getReabsorbedMonsters().includes(this.getMonster())) {
        return QuestStatus.COMPLETED;
      }

      if (path == null) {
        return QuestStatus.NOT_READY;
      }

      if (!path.canUse(ResourceCategory.FAXER)) {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.familiarWeight)(this.familiar) < 6) {
        return QuestStatus.NOT_READY;
      }

      if (
      !(0,external_kolmafia_.haveSkill)(this.nanovision) &&
      !GreySettings_GreySettings.shouldAvoidTowerRequirements())
      {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.FASTER_LATER;
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      var resource = path.getResource(ResourceCategory.FAXER);

      return {
        location: null,
        outfit: null,
        familiar: this.familiar,
        disableFamOverride: true,
        run: function run() {
          resource.fax(_this2.getMonster());

          var macro = Macro.trySkill(external_kolmafia_.Skill.get("Re-Process Matter"));

          if ((0,external_kolmafia_.haveSkill)(_this2.nanovision)) {
            macro.trySkillRepeat(_this2.nanovision);
          } else {
            macro.trySkillRepeat(external_kolmafia_.Skill.get("Infinite Loop"));
          }

          macro.submit();

          if ((0,external_kolmafia_.handlingChoice)() || (0,external_kolmafia_.currentRound)() != 0) {
            throw "We're supposed to be done with this fight!";
          }
        }
      };
    } }, { key: "getAbsorbs", value:

    function getAbsorbs() {
      return [this.getMonster()];
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestAbsorbStarMonster;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/absorbs/QuestAbsorbKnoll.ts
function QuestAbsorbKnoll_typeof(obj) {"@babel/helpers - typeof";return QuestAbsorbKnoll_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestAbsorbKnoll_typeof(obj);}function QuestAbsorbKnoll_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestAbsorbKnoll_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestAbsorbKnoll_toPropertyKey(descriptor.key), descriptor);}}function QuestAbsorbKnoll_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestAbsorbKnoll_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestAbsorbKnoll_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestAbsorbKnoll_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestAbsorbKnoll_setPrototypeOf(subClass, superClass);}function QuestAbsorbKnoll_setPrototypeOf(o, p) {QuestAbsorbKnoll_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestAbsorbKnoll_setPrototypeOf(o, p);}function QuestAbsorbKnoll_createSuper(Derived) {var hasNativeReflectConstruct = QuestAbsorbKnoll_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestAbsorbKnoll_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestAbsorbKnoll_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestAbsorbKnoll_possibleConstructorReturn(this, result);};}function QuestAbsorbKnoll_possibleConstructorReturn(self, call) {if (call && (QuestAbsorbKnoll_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestAbsorbKnoll_assertThisInitialized(self);}function QuestAbsorbKnoll_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestAbsorbKnoll_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestAbsorbKnoll_getPrototypeOf(o) {QuestAbsorbKnoll_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestAbsorbKnoll_getPrototypeOf(o);}function QuestAbsorbKnoll_defineProperty(obj, key, value) {key = QuestAbsorbKnoll_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestAbsorbKnoll_toPropertyKey(arg) {var key = QuestAbsorbKnoll_toPrimitive(arg, "string");return QuestAbsorbKnoll_typeof(key) === "symbol" ? key : String(key);}function QuestAbsorbKnoll_toPrimitive(input, hint) {if (QuestAbsorbKnoll_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestAbsorbKnoll_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}




var QuestAbsorbKnoll = /*#__PURE__*/function (_QuestMoonSignAbsorb) {QuestAbsorbKnoll_inherits(QuestAbsorbKnoll, _QuestMoonSignAbsorb);var _super = QuestAbsorbKnoll_createSuper(QuestAbsorbKnoll);function QuestAbsorbKnoll() {var _this;QuestAbsorbKnoll_classCallCheck(this, QuestAbsorbKnoll);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestAbsorbKnoll_defineProperty(QuestAbsorbKnoll_assertThisInitialized(_this), "location",
    external_kolmafia_.Location.get("The Bugbear Pen"));QuestAbsorbKnoll_defineProperty(QuestAbsorbKnoll_assertThisInitialized(_this), "monster",
    external_kolmafia_.Monster.get("Revolving Bugbear"));QuestAbsorbKnoll_defineProperty(QuestAbsorbKnoll_assertThisInitialized(_this), "moonZone",
    "Knoll");return _this;}QuestAbsorbKnoll_createClass(QuestAbsorbKnoll, [{ key: "getId", value:

    function getId() {
      return "Absorbs / Knoll";
    } }]);return QuestAbsorbKnoll;}(QuestMoonSignAbsorb);
;// CONCATENATED MODULE: ./src/quests/custom/goblin/QuestGoblinTortureHarem.ts
function QuestGoblinTortureHarem_typeof(obj) {"@babel/helpers - typeof";return QuestGoblinTortureHarem_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestGoblinTortureHarem_typeof(obj);}function QuestGoblinTortureHarem_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestGoblinTortureHarem_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestGoblinTortureHarem_toPropertyKey(descriptor.key), descriptor);}}function QuestGoblinTortureHarem_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestGoblinTortureHarem_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestGoblinTortureHarem_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestGoblinTortureHarem_defineProperty(obj, key, value) {key = QuestGoblinTortureHarem_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestGoblinTortureHarem_toPropertyKey(arg) {var key = QuestGoblinTortureHarem_toPrimitive(arg, "string");return QuestGoblinTortureHarem_typeof(key) === "symbol" ? key : String(key);}function QuestGoblinTortureHarem_toPrimitive(input, hint) {if (QuestGoblinTortureHarem_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestGoblinTortureHarem_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestGoblinTortureHarem = /*#__PURE__*/function () {function QuestGoblinTortureHarem() {QuestGoblinTortureHarem_classCallCheck(this, QuestGoblinTortureHarem);QuestGoblinTortureHarem_defineProperty(this, "harem",
    external_kolmafia_.Location.get("Cobb's Knob Harem"));QuestGoblinTortureHarem_defineProperty(this, "lab",
    external_kolmafia_.Location.get("Cobb's Knob Laboratory"));}QuestGoblinTortureHarem_createClass(QuestGoblinTortureHarem, [{ key: "getId", value:

    function getId() {
      return "GoblinLabs / LabUnlock";
    } }, { key: "level", value:

    function level() {
      return 5;
    } }, { key: "status", value:

    function status() {
      if (canGreyAdventure(this.lab)) {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.getProperty)("questL05Goblin") != "finished") {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit().setNoCombat();

      return {
        outfit: outfit,
        location: this.harem,
        run: function run() {
          greyAdv(_this.harem, outfit);
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.harem];
    } }]);return QuestGoblinTortureHarem;}();
;// CONCATENATED MODULE: ./src/quests/custom/goblin/QuestGoblinTortureLab.ts
function QuestGoblinTortureLab_typeof(obj) {"@babel/helpers - typeof";return QuestGoblinTortureLab_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestGoblinTortureLab_typeof(obj);}function QuestGoblinTortureLab_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestGoblinTortureLab_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestGoblinTortureLab_toPropertyKey(descriptor.key), descriptor);}}function QuestGoblinTortureLab_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestGoblinTortureLab_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestGoblinTortureLab_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestGoblinTortureLab_defineProperty(obj, key, value) {key = QuestGoblinTortureLab_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestGoblinTortureLab_toPropertyKey(arg) {var key = QuestGoblinTortureLab_toPrimitive(arg, "string");return QuestGoblinTortureLab_typeof(key) === "symbol" ? key : String(key);}function QuestGoblinTortureLab_toPrimitive(input, hint) {if (QuestGoblinTortureLab_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestGoblinTortureLab_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestGoblinTortureLab = /*#__PURE__*/function () {function QuestGoblinTortureLab() {QuestGoblinTortureLab_classCallCheck(this, QuestGoblinTortureLab);QuestGoblinTortureLab_defineProperty(this, "lab",
    external_kolmafia_.Location.get("Cobb's Knob Laboratory"));QuestGoblinTortureLab_defineProperty(this, "megL3",
    external_kolmafia_.Location.get("Menagerie Level 3"));}QuestGoblinTortureLab_createClass(QuestGoblinTortureLab, [{ key: "getLocations", value:

    function getLocations() {
      return [this.lab];
    } }, { key: "getId", value:

    function getId() {
      return "GoblinLabs / MegUnlock";
    } }, { key: "status", value:

    function status() {
      if (canGreyAdventure(this.megL3)) {
        return QuestStatus.COMPLETED;
      }

      if (
      !canGreyAdventure(this.lab) ||
      (0,external_kolmafia_.getProperty)("questL05Goblin") != "finished")
      {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit().setItemDrops();

      return {
        outfit: outfit,
        location: this.lab,
        run: function run() {
          greyAdv(_this.lab, outfit);
        }
      };
    } }, { key: "level", value:

    function level() {
      return 5;
    } }]);return QuestGoblinTortureLab;}();
;// CONCATENATED MODULE: ./src/quests/custom/QuestBugbearBakery.ts
function QuestBugbearBakery_typeof(obj) {"@babel/helpers - typeof";return QuestBugbearBakery_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestBugbearBakery_typeof(obj);}function QuestBugbearBakery_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestBugbearBakery_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestBugbearBakery_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestBugbearBakery_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestBugbearBakery_arrayLikeToArray(o, minLen);}function QuestBugbearBakery_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestBugbearBakery_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestBugbearBakery_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestBugbearBakery_toPropertyKey(descriptor.key), descriptor);}}function QuestBugbearBakery_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestBugbearBakery_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestBugbearBakery_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestBugbearBakery_defineProperty(obj, key, value) {key = QuestBugbearBakery_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestBugbearBakery_toPropertyKey(arg) {var key = QuestBugbearBakery_toPrimitive(arg, "string");return QuestBugbearBakery_typeof(key) === "symbol" ? key : String(key);}function QuestBugbearBakery_toPrimitive(input, hint) {if (QuestBugbearBakery_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestBugbearBakery_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}





var QuestBugbearBakery = /*#__PURE__*/function () {function QuestBugbearBakery() {QuestBugbearBakery_classCallCheck(this, QuestBugbearBakery);QuestBugbearBakery_defineProperty(this, "asdon",
    external_kolmafia_.Item.get("Asdon Martin keyfob"));QuestBugbearBakery_defineProperty(this, "garage",
    external_kolmafia_.Location.get("The Degrassi Knoll Garage"));QuestBugbearBakery_defineProperty(this, "guard",
    external_kolmafia_.Monster.get("Guard Bugbear"));QuestBugbearBakery_defineProperty(this, "nanovision",
    external_kolmafia_.Skill.get("Double Nanovision"));}QuestBugbearBakery_createClass(QuestBugbearBakery, [{ key: "getId", value:

    function getId() {
      return "Misc / BugbearBakery";
    } }, { key: "level", value:

    function level() {
      return 6;
    } }, { key: "status", value:

    function status() {
      if (
      (0,external_kolmafia_.outfitPieces)("Bugbear Costume").find(function (i) {return (0,external_kolmafia_.availableAmount)(i) == 0;}) ==
      null ||
      !(0,external_kolmafia_.knollAvailable)() ||
      (0,external_kolmafia_.getWorkshed)() != this.asdon)
      {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.myMeat)() < 200 || (0,external_kolmafia_.isBanished)(this.guard)) {
        return QuestStatus.NOT_READY;
      }

      if (!(0,external_kolmafia_.knollAvailable)() && !(0,external_kolmafia_.haveSkill)(this.nanovision)) {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      if ((0,external_kolmafia_.knollAvailable)()) {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {var _iterator = QuestBugbearBakery_createForOfIteratorHelper(
              (0,external_kolmafia_.outfitPieces)("Bugbear Costume")),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var item = _step.value;
                (0,external_kolmafia_.cliExecute)("acquire " + item.name);
              }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
          }
        };
      }

      var outfit = new GreyOutfit().setItemDrops();

      return {
        location: this.garage,
        outfit: outfit,
        run: function run() {
          greyAdv(
          _this.garage,
          outfit,
          new AdventureSettings().addNoBanish(_this.guard));

        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return (0,external_kolmafia_.knollAvailable)() ? [] : [this.garage];
    } }]);return QuestBugbearBakery;}();
;// CONCATENATED MODULE: ./src/quests/custom/QuestCustomPurchases.ts
function QuestCustomPurchases_typeof(obj) {"@babel/helpers - typeof";return QuestCustomPurchases_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestCustomPurchases_typeof(obj);}function QuestCustomPurchases_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestCustomPurchases_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestCustomPurchases_toPropertyKey(descriptor.key), descriptor);}}function QuestCustomPurchases_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestCustomPurchases_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestCustomPurchases_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestCustomPurchases_defineProperty(obj, key, value) {key = QuestCustomPurchases_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestCustomPurchases_toPropertyKey(arg) {var key = QuestCustomPurchases_toPrimitive(arg, "string");return QuestCustomPurchases_typeof(key) === "symbol" ? key : String(key);}function QuestCustomPurchases_toPrimitive(input, hint) {if (QuestCustomPurchases_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestCustomPurchases_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}





var QuestCustomPurchases = /*#__PURE__*/function () {function QuestCustomPurchases() {QuestCustomPurchases_classCallCheck(this, QuestCustomPurchases);QuestCustomPurchases_defineProperty(this, "popper",
    external_kolmafia_.Item.get("Porkpie-mounted popper"));QuestCustomPurchases_defineProperty(this, "silent",
    external_kolmafia_.Item.get("Silent Beret"));QuestCustomPurchases_defineProperty(this, "stealth",
    external_kolmafia_.Item.get("Xiblaxian stealth cowl"));QuestCustomPurchases_defineProperty(this, "firePlusCombat",
    external_kolmafia_.Item.get("sombrero-mounted sparkler"));QuestCustomPurchases_defineProperty(this, "pack",
    external_kolmafia_.Item.get("protonic accelerator pack"));}QuestCustomPurchases_createClass(QuestCustomPurchases, [{ key: "getId", value:

    function getId() {
      return "Misc / Purchases";
    } }, { key: "level", value:

    function level() {
      return 6;
    } }, { key: "status", value:

    function status() {
      if (
      (0,external_kolmafia_.getProperty)("_fireworksShopHatBought") == "true" ||
      !canUseFireworks())
      {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.myMeat)() <= 3000) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          runFireworks(function () {
            var toBuy = _this.popper;

            if (
            (0,external_kolmafia_.availableAmount)(_this.stealth) > 0 ||
            (0,external_kolmafia_.availableAmount)(_this.silent) > 0 ||
            (0,external_kolmafia_.availableAmount)(_this.pack) > 0)
            {
              toBuy = _this.firePlusCombat;
            }

            (0,external_kolmafia_.visitUrl)("clan_viplounge.php");
            (0,external_kolmafia_.visitUrl)("clan_viplounge.php?action=fwshop&whichfloor=2");
            (0,external_kolmafia_.print)("Now trying to buy " + toBuy);
            (0,external_kolmafia_.retrieveItem)(toBuy);
            //          buy(item);
          });
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }]);return QuestCustomPurchases;}();
;// CONCATENATED MODULE: ./src/quests/custom/QuestDungeonsOfDoom.ts
function QuestDungeonsOfDoom_typeof(obj) {"@babel/helpers - typeof";return QuestDungeonsOfDoom_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestDungeonsOfDoom_typeof(obj);}function QuestDungeonsOfDoom_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestDungeonsOfDoom_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestDungeonsOfDoom_toPropertyKey(descriptor.key), descriptor);}}function QuestDungeonsOfDoom_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestDungeonsOfDoom_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestDungeonsOfDoom_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestDungeonsOfDoom_defineProperty(obj, key, value) {key = QuestDungeonsOfDoom_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestDungeonsOfDoom_toPropertyKey(arg) {var key = QuestDungeonsOfDoom_toPrimitive(arg, "string");return QuestDungeonsOfDoom_typeof(key) === "symbol" ? key : String(key);}function QuestDungeonsOfDoom_toPrimitive(input, hint) {if (QuestDungeonsOfDoom_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestDungeonsOfDoom_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var QuestDungeonsOfDoom = /*#__PURE__*/function () {function QuestDungeonsOfDoom() {QuestDungeonsOfDoom_classCallCheck(this, QuestDungeonsOfDoom);QuestDungeonsOfDoom_defineProperty(this, "bend",
    external_kolmafia_.Location.get("The Enormous Greater-Than Sign"));QuestDungeonsOfDoom_defineProperty(this, "plusSign",
    external_kolmafia_.Item.get("plus sign"));QuestDungeonsOfDoom_defineProperty(this, "teleportis",
    external_kolmafia_.Effect.get("Teleportitis"));QuestDungeonsOfDoom_defineProperty(this, "beatenUp",
    external_kolmafia_.Effect.get("Beaten Up"));QuestDungeonsOfDoom_defineProperty(this, "curse1",
    external_kolmafia_.Effect.get("Once-Cursed"));QuestDungeonsOfDoom_defineProperty(this, "curse2",
    external_kolmafia_.Effect.get("Twice-Cursed"));QuestDungeonsOfDoom_defineProperty(this, "curse3",
    external_kolmafia_.Effect.get("Thrice-Cursed"));QuestDungeonsOfDoom_defineProperty(this, "train",
    external_kolmafia_.Item.get("Model Train Set"));}QuestDungeonsOfDoom_createClass(QuestDungeonsOfDoom, [{ key: "getId", value:

    function getId() {
      return "Misc / UnlockDungeonsOfDoom";
    } }, { key: "level", value:

    function level() {
      return 8;
    } }, { key: "isDoomUnlocked", value:

    function isDoomUnlocked() {
      return (
        (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastPlusSignUnlock")) == (0,external_kolmafia_.myAscensions)() &&
        (0,external_kolmafia_.availableAmount)(this.plusSign) == 0);

    } }, { key: "status", value:

    function status() {
      if (
      this.isDoomUnlocked() ||
      GreySettings_GreySettings.isNerfMode() && (0,external_kolmafia_.getWorkshed)() == this.train)
      {
        return QuestStatus.COMPLETED;
      }

      // Due to poison, we don't want to get into the rare state where we are double nerfed
      if ((0,external_kolmafia_.myMeat)() < 1300 || (0,external_kolmafia_.haveEffect)(this.beatenUp) > 0) {
        return QuestStatus.NOT_READY;
      }

      // If we have not purchased the 5k forged documents yet, or the tavern is not available yet
      if (
      ((0,external_kolmafia_.myMeat)() < 7000 && (0,external_kolmafia_.getProperty)("questL11Black") != "finished" ||
      (0,external_kolmafia_.getProperty)("questL02Larva") != "finished") &&
      (0,external_kolmafia_.availableAmount)(this.plusSign) > 0)
      {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.myLevel)() < 12 && (0,external_kolmafia_.availableAmount)(this.plusSign) == 0) {
        return QuestStatus.NOT_READY;
      }

      if (!hasNonCombatSkillsReady(false)) {
        return QuestStatus.NOT_READY;
      }

      if (
      (0,external_kolmafia_.haveEffect)(this.curse1) +
      (0,external_kolmafia_.haveEffect)(this.curse2) +
      (0,external_kolmafia_.haveEffect)(this.curse3) >
      0)
      {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.availableAmount)(this.plusSign) > 0 && (0,external_kolmafia_.myLevel)() < 16) {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit().setNoCombat();

      return {
        outfit: outfit,
        location: this.bend,
        freeRun: function freeRun() {return true;},
        run: function run() {
          if (
          (0,external_kolmafia_.availableAmount)(_this.plusSign) > 0 &&
          (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastPlusSignUnlock")) == (0,external_kolmafia_.myAscensions)())
          {
            (0,external_kolmafia_.use)(_this.plusSign);
            return;
          }

          var settings = new AdventureSettings();
          settings.setChoices({
            handleChoice: function handleChoice(choiceNo) {
              if (choiceNo == 3) {
                return 3;
              } else if (choiceNo == 451) {
                return (0,external_kolmafia_.availableAmount)(_this.plusSign) > 0 ? 5 : 3;
              }

              return null;
            },

            calledOutOfScopeChoiceBehavior: function calledOutOfScopeChoiceBehavior(choiceNo) {
              return false;
            }
          });

          greyAdv(_this.bend, outfit, settings);

          if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastPlusSignUnlock")) == (0,external_kolmafia_.myAscensions)()) {
            if ((0,external_kolmafia_.availableAmount)(_this.plusSign) == 0) {
              (0,external_kolmafia_.cliExecute)("refresh inventory");
            }

            (0,external_kolmafia_.use)(_this.plusSign);
          }
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.bend];
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return (
        (0,external_kolmafia_.haveEffect)(this.teleportis) > 0 && (0,external_kolmafia_.availableAmount)(this.plusSign) > 0);

    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return (
        (0,external_kolmafia_.availableAmount)(this.plusSign) == 0 && (0,external_kolmafia_.haveEffect)(this.teleportis) == 0);

    } }]);return QuestDungeonsOfDoom;}();
;// CONCATENATED MODULE: ./src/quests/custom/QuestFamiliarEquip.ts
function QuestFamiliarEquip_typeof(obj) {"@babel/helpers - typeof";return QuestFamiliarEquip_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestFamiliarEquip_typeof(obj);}function QuestFamiliarEquip_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestFamiliarEquip_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestFamiliarEquip_toPropertyKey(descriptor.key), descriptor);}}function QuestFamiliarEquip_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestFamiliarEquip_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestFamiliarEquip_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestFamiliarEquip_defineProperty(obj, key, value) {key = QuestFamiliarEquip_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestFamiliarEquip_toPropertyKey(arg) {var key = QuestFamiliarEquip_toPrimitive(arg, "string");return QuestFamiliarEquip_typeof(key) === "symbol" ? key : String(key);}function QuestFamiliarEquip_toPrimitive(input, hint) {if (QuestFamiliarEquip_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestFamiliarEquip_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}



var QuestFamiliarEquip = /*#__PURE__*/function () {function QuestFamiliarEquip() {QuestFamiliarEquip_classCallCheck(this, QuestFamiliarEquip);QuestFamiliarEquip_defineProperty(this, "familiar",
    external_kolmafia_.Familiar.get("Grey Goose"));QuestFamiliarEquip_defineProperty(this, "equip",
    external_kolmafia_.Item.get("Grey Down Vest"));}QuestFamiliarEquip_createClass(QuestFamiliarEquip, [{ key: "getId", value:

    function getId() {
      return "Misc / FamEquip";
    } }, { key: "level", value:

    function level() {
      return 1;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.availableAmount)(this.equip) > 0) {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.familiarWeight)(this.familiar) >= 6 || (0,external_kolmafia_.myMeat)() < 100) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      return {
        location: null,
        run: function run() {
          (0,external_kolmafia_.useFamiliar)(_this.familiar);
          (0,external_kolmafia_.maximize)("familiar experience +familiar weight -tie", false);
          (0,external_kolmafia_.visitUrl)("arena.php");

          while (
          (0,external_kolmafia_.availableAmount)(_this.equip) == 0 &&
          (0,external_kolmafia_.familiarWeight)(_this.familiar) < 6 &&
          (0,external_kolmafia_.myMeat)() >= 100)
          {
            var exp = _this.familiar.experience;
            (0,external_kolmafia_.cliExecute)("train turns 1");

            if (exp >= _this.familiar.experience) {
              throw "We attempted to train your familiar in the cake arena, but they gained no experience. Something is likely wrong. You may need to acquire a grey goose vest yourself.";
            }
          }
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestFamiliarEquip;}();
;// CONCATENATED MODULE: ./src/quests/custom/QuestFortuneExp.ts
function QuestFortuneExp_typeof(obj) {"@babel/helpers - typeof";return QuestFortuneExp_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestFortuneExp_typeof(obj);}function QuestFortuneExp_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestFortuneExp_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestFortuneExp_toPropertyKey(descriptor.key), descriptor);}}function QuestFortuneExp_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestFortuneExp_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestFortuneExp_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestFortuneExp_defineProperty(obj, key, value) {key = QuestFortuneExp_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestFortuneExp_toPropertyKey(arg) {var key = QuestFortuneExp_toPrimitive(arg, "string");return QuestFortuneExp_typeof(key) === "symbol" ? key : String(key);}function QuestFortuneExp_toPrimitive(input, hint) {if (QuestFortuneExp_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestFortuneExp_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}





var QuestFortuneExp = /*#__PURE__*/function () {function QuestFortuneExp() {QuestFortuneExp_classCallCheck(this, QuestFortuneExp);QuestFortuneExp_defineProperty(this, "fam",
    external_kolmafia_.Familiar.get("Grey Goose"));QuestFortuneExp_defineProperty(this, "equip",
    (0,external_kolmafia_.familiarEquipment)(this.fam));}QuestFortuneExp_createClass(QuestFortuneExp, [{ key: "getId", value:

    function getId() {
      return "Misc / FortuneExp";
    } }, { key: "level", value:

    function level() {
      return 5;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.getProperty)("_clanFortuneBuffUsed") == "true" || !canUseFortuneBuff()) {
        return QuestStatus.COMPLETED;
      }

      if (
      (0,external_kolmafia_.familiarWeight)(this.fam) > 2 ||
      (0,external_kolmafia_.availableAmount)(this.equip) == 0 ||
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastDesertUnlock")) != (0,external_kolmafia_.myAscensions)())
      {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          useFortuneBuff(function () {return (0,external_kolmafia_.cliExecute)("fortune buff familiar");});
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "free", value:

    function free() {
      return true;
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestFortuneExp;}();
;// CONCATENATED MODULE: ./src/quests/custom/QuestGetZapWand.ts
function QuestGetZapWand_typeof(obj) {"@babel/helpers - typeof";return QuestGetZapWand_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestGetZapWand_typeof(obj);}function QuestGetZapWand_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestGetZapWand_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestGetZapWand_toPropertyKey(descriptor.key), descriptor);}}function QuestGetZapWand_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestGetZapWand_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestGetZapWand_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestGetZapWand_defineProperty(obj, key, value) {key = QuestGetZapWand_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestGetZapWand_toPropertyKey(arg) {var key = QuestGetZapWand_toPrimitive(arg, "string");return QuestGetZapWand_typeof(key) === "symbol" ? key : String(key);}function QuestGetZapWand_toPrimitive(input, hint) {if (QuestGetZapWand_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestGetZapWand_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}








var QuestGetZapWand = /*#__PURE__*/function () {function QuestGetZapWand() {QuestGetZapWand_classCallCheck(this, QuestGetZapWand);QuestGetZapWand_defineProperty(this, "realDung",
    external_kolmafia_.Location.get("The Dungeons of Doom"));QuestGetZapWand_defineProperty(this, "deadMimic",
    external_kolmafia_.Item.get("dead mimic"));QuestGetZapWand_defineProperty(this, "plusSign",
    external_kolmafia_.Item.get("plus sign"));QuestGetZapWand_defineProperty(this, "toAbsorb", void 0);}QuestGetZapWand_createClass(QuestGetZapWand, [{ key: "getId", value:


    function getId() {
      return "Misc / GrabZapWand";
    } }, { key: "level", value:

    function level() {
      return 8;
    } }, { key: "shouldHaveWand", value:

    function shouldHaveWand() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastZapperWand")) == (0,external_kolmafia_.myAscensions)();
    } }, { key: "isDoomUnlocked", value:

    function isDoomUnlocked() {
      return (
        (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastPlusSignUnlock")) == (0,external_kolmafia_.myAscensions)() &&
        (0,external_kolmafia_.availableAmount)(this.plusSign) == 0);

    } }, { key: "getTimesZapped", value:

    function getTimesZapped() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_zapCount"));
    } }, { key: "status", value:

    function status() {
      if (
      !GreySettings_GreySettings.greyGrabZapWand ||
      this.shouldHaveWand() ||
      this.getWand() != null)
      {
        return QuestStatus.COMPLETED;
      }

      var meatOnHand = 6000;

      if (getQuestStatus("questL11Black") < 3) {
        meatOnHand += 3000;
      }

      if ((0,external_kolmafia_.myMeat)() < meatOnHand || !this.isDoomUnlocked()) {
        return QuestStatus.NOT_READY;
      }

      // Only be very requirement if we have the MP regen skill
      if (!hasNonCombatSkillsReady(this.toAbsorb.length == 0 ? true : false)) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "getWand", value:

    function getWand() {
      var wand = (0,external_kolmafia_.getZapWand)();

      return wand == external_kolmafia_.Item.none ? null : wand;
    } }, { key: "hasWandExploded", value:

    function hasWandExploded() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastZapperWandExplosionDay")) == (0,external_kolmafia_.myDaycount)();
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit().setNoCombat();

      return {
        outfit: outfit,
        location: this.realDung,
        freeRun: function freeRun() {return true;},
        run: function run() {
          var props = new Properties_PropertyManager();

          props.setChoice(25, 2);

          try {
            greyAdv(_this.realDung, outfit);
          } finally {
            props.resetAll();
          }

          if ((0,external_kolmafia_.availableAmount)(_this.deadMimic) > 0) {
            (0,external_kolmafia_.use)(_this.deadMimic);

            if (_this.getWand() == null) {
              (0,external_kolmafia_.print)(
              "Something has gone wrong. We used a dead mimic but didn't get a wand.");

            }
          }
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.realDung];
    } }]);return QuestGetZapWand;}();
;// CONCATENATED MODULE: ./src/quests/custom/QuestGrabBoatVacation.ts
function QuestGrabBoatVacation_typeof(obj) {"@babel/helpers - typeof";return QuestGrabBoatVacation_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestGrabBoatVacation_typeof(obj);}function QuestGrabBoatVacation_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestGrabBoatVacation_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestGrabBoatVacation_toPropertyKey(descriptor.key), descriptor);}}function QuestGrabBoatVacation_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestGrabBoatVacation_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestGrabBoatVacation_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestGrabBoatVacation_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestGrabBoatVacation_setPrototypeOf(subClass, superClass);}function QuestGrabBoatVacation_setPrototypeOf(o, p) {QuestGrabBoatVacation_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestGrabBoatVacation_setPrototypeOf(o, p);}function QuestGrabBoatVacation_createSuper(Derived) {var hasNativeReflectConstruct = QuestGrabBoatVacation_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestGrabBoatVacation_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestGrabBoatVacation_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestGrabBoatVacation_possibleConstructorReturn(this, result);};}function QuestGrabBoatVacation_possibleConstructorReturn(self, call) {if (call && (QuestGrabBoatVacation_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestGrabBoatVacation_assertThisInitialized(self);}function QuestGrabBoatVacation_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestGrabBoatVacation_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestGrabBoatVacation_getPrototypeOf(o) {QuestGrabBoatVacation_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestGrabBoatVacation_getPrototypeOf(o);}function QuestGrabBoatVacation_defineProperty(obj, key, value) {key = QuestGrabBoatVacation_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestGrabBoatVacation_toPropertyKey(arg) {var key = QuestGrabBoatVacation_toPrimitive(arg, "string");return QuestGrabBoatVacation_typeof(key) === "symbol" ? key : String(key);}function QuestGrabBoatVacation_toPrimitive(input, hint) {if (QuestGrabBoatVacation_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestGrabBoatVacation_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}









var QuestGrabBoatVacation = /*#__PURE__*/function (_TaskInfo) {QuestGrabBoatVacation_inherits(QuestGrabBoatVacation, _TaskInfo);var _super = QuestGrabBoatVacation_createSuper(QuestGrabBoatVacation);function QuestGrabBoatVacation() {var _this;QuestGrabBoatVacation_classCallCheck(this, QuestGrabBoatVacation);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestGrabBoatVacation_defineProperty(QuestGrabBoatVacation_assertThisInitialized(_this), "junkKey",
    external_kolmafia_.Item.get("funky junk key"));QuestGrabBoatVacation_defineProperty(QuestGrabBoatVacation_assertThisInitialized(_this), "boatParts",
    [
    "old claw-foot bathtub",
    "old clothesline pole",
    "antique cigar sign"].
    map(function (s) {return external_kolmafia_.Item.get(s);}));QuestGrabBoatVacation_defineProperty(QuestGrabBoatVacation_assertThisInitialized(_this), "nanovision",
    external_kolmafia_.Skill.get("Double Nanovision"));QuestGrabBoatVacation_defineProperty(QuestGrabBoatVacation_assertThisInitialized(_this), "paths", void 0);QuestGrabBoatVacation_defineProperty(QuestGrabBoatVacation_assertThisInitialized(_this), "scrip",

    external_kolmafia_.Item.get("Shore Inc. Ship Trip Scrip"));return _this;}QuestGrabBoatVacation_createClass(QuestGrabBoatVacation, [{ key: "createPaths", value:

    function createPaths() {
      this.paths = [new PossiblePath(9)];

      if ((0,external_kolmafia_.storageAmount)(this.scrip) > 0) {
        this.paths.push(new PossiblePath(6).addPull(this.scrip));
      }
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "getId", value:

    function getId() {
      return "Boat / Vacation";
    } }, { key: "level", value:

    function level() {
      return 6;
    } }, { key: "hasDesertAccess", value:

    function hasDesertAccess() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastDesertUnlock")) == (0,external_kolmafia_.myAscensions)();
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.getProperty)("questM19Hippy") == "unstarted") {
        return QuestStatus.READY;
      }

      if (this.hasBoat()) {
        return QuestStatus.COMPLETED;
      }

      if (!this.hasDesertAccess()) {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.myMeat)() < 2000) {
        return QuestStatus.NOT_READY;
      }

      if (
      !GreySettings_GreySettings.isHippyMode() &&
      (0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("Brother Corsican's Blessing")) +
      (0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("A Girl Named Sue")) >
      0)
      {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.myAdventures)() < ((0,external_kolmafia_.myLevel)() < 11 ? 35 : 20)) {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "doHippyJunk", value:

    function doHippyJunk() {
      return {
        location: null,
        run: function run() {
          (0,external_kolmafia_.visitUrl)("place.php?whichplace=woods&action=woods_smokesignals");
          (0,external_kolmafia_.runChoice)(1);
          (0,external_kolmafia_.runChoice)(2);
        }
      };
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      if ((0,external_kolmafia_.getProperty)("questM19Hippy") == "unstarted") {
        return this.doHippyJunk();
      }

      return {
        location: null,
        run: function run() {
          if (path.canUse(ResourceCategory.PULL)) {
            GreyPulls.tryPull(_this2.scrip);
          }

          var scriptAvailable = (0,external_kolmafia_.availableAmount)(_this2.scrip);

          var props = new Properties_PropertyManager();
          props.setChoice(793, 1);

          try {
            for (var i = 0; i < 3 - scriptAvailable; i++) {
              greyAdv(external_kolmafia_.Location.get("The Shore, Inc. Travel Agency"));
            }
          } finally {
            props.resetAll();
          }

          var planks = external_kolmafia_.Item.get("Dingy Planks");

          if ((0,external_kolmafia_.availableAmount)(planks) == 0) {
            (0,external_kolmafia_.retrieveItem)(planks);
          }

          (0,external_kolmafia_.cliExecute)("make dinghy plans");
          (0,external_kolmafia_.use)(external_kolmafia_.Item.get("Dinghy plans"));

          if (!_this2.hasBoat()) {
            throw "We should've had a boat!";
          }
        }
      };
    } }, { key: "mustBeDone", value:

    function mustBeDone(reallyMustBeDone) {
      if (!GreySettings_GreySettings.isHippyMode() || reallyMustBeDone) {
        return false;
      }

      if ((0,external_kolmafia_.myLevel)() == 11) {
        return true;
      }

      return false;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "hasBoat", value:

    function hasBoat() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastIslandUnlock")) == (0,external_kolmafia_.myAscensions)();
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestGrabBoatVacation;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/custom/QuestInitialPulls.ts
function QuestInitialPulls_typeof(obj) {"@babel/helpers - typeof";return QuestInitialPulls_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestInitialPulls_typeof(obj);}function QuestInitialPulls_toConsumableArray(arr) {return QuestInitialPulls_arrayWithoutHoles(arr) || QuestInitialPulls_iterableToArray(arr) || QuestInitialPulls_unsupportedIterableToArray(arr) || QuestInitialPulls_nonIterableSpread();}function QuestInitialPulls_nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function QuestInitialPulls_iterableToArray(iter) {if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);}function QuestInitialPulls_arrayWithoutHoles(arr) {if (Array.isArray(arr)) return QuestInitialPulls_arrayLikeToArray(arr);}function QuestInitialPulls_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestInitialPulls_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestInitialPulls_slicedToArray(arr, i) {return QuestInitialPulls_arrayWithHoles(arr) || QuestInitialPulls_iterableToArrayLimit(arr, i) || QuestInitialPulls_unsupportedIterableToArray(arr, i) || QuestInitialPulls_nonIterableRest();}function QuestInitialPulls_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function QuestInitialPulls_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestInitialPulls_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestInitialPulls_arrayLikeToArray(o, minLen);}function QuestInitialPulls_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestInitialPulls_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function QuestInitialPulls_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function QuestInitialPulls_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestInitialPulls_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestInitialPulls_toPropertyKey(descriptor.key), descriptor);}}function QuestInitialPulls_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestInitialPulls_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestInitialPulls_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestInitialPulls_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestInitialPulls_setPrototypeOf(subClass, superClass);}function QuestInitialPulls_setPrototypeOf(o, p) {QuestInitialPulls_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestInitialPulls_setPrototypeOf(o, p);}function QuestInitialPulls_createSuper(Derived) {var hasNativeReflectConstruct = QuestInitialPulls_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestInitialPulls_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestInitialPulls_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestInitialPulls_possibleConstructorReturn(this, result);};}function QuestInitialPulls_possibleConstructorReturn(self, call) {if (call && (QuestInitialPulls_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestInitialPulls_assertThisInitialized(self);}function QuestInitialPulls_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestInitialPulls_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestInitialPulls_getPrototypeOf(o) {QuestInitialPulls_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestInitialPulls_getPrototypeOf(o);}function QuestInitialPulls_defineProperty(obj, key, value) {key = QuestInitialPulls_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestInitialPulls_toPropertyKey(arg) {var key = QuestInitialPulls_toPrimitive(arg, "string");return QuestInitialPulls_typeof(key) === "symbol" ? key : String(key);}function QuestInitialPulls_toPrimitive(input, hint) {if (QuestInitialPulls_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestInitialPulls_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}









var QuestInitialPulls = /*#__PURE__*/function (_TaskInfo) {QuestInitialPulls_inherits(QuestInitialPulls, _TaskInfo);var _super = QuestInitialPulls_createSuper(QuestInitialPulls);function QuestInitialPulls() {var _this;QuestInitialPulls_classCallCheck(this, QuestInitialPulls);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestInitialPulls_defineProperty(QuestInitialPulls_assertThisInitialized(_this), "requiredPulls",
    [
    [external_kolmafia_.Item.get("Yule Hatchet"), -150],
    [external_kolmafia_.Item.get("Teacher's Pen"), -70]]);QuestInitialPulls_defineProperty(QuestInitialPulls_assertThisInitialized(_this), "possiblePulls",

    [
    [external_kolmafia_.Item.get("Giant Yellow Hat"), -35],
    [external_kolmafia_.Item.get("Mafia Thumb Ring"), -30],
    [external_kolmafia_.Item.get("Portable cassette player"), -15],
    [external_kolmafia_.Item.get("Pantsgiving"), -10]]);QuestInitialPulls_defineProperty(QuestInitialPulls_assertThisInitialized(_this), "paths", void 0);QuestInitialPulls_defineProperty(QuestInitialPulls_assertThisInitialized(_this), "freeRunners",


    [
    "Greatest American Pants",
    "navel ring of navel gazing"].
    map(function (s) {return external_kolmafia_.Item.get(s);}));QuestInitialPulls_defineProperty(QuestInitialPulls_assertThisInitialized(_this), "donePulls", void 0);return _this;}QuestInitialPulls_createClass(QuestInitialPulls, [{ key: "createPaths", value:


    function createPaths(assumeUnstarted) {
      var mlItem = ["HOA regulation book", "Space Trip safety headphones"].
      map(function (s) {return external_kolmafia_.Item.get(s);}).
      filter(function (i) {return (0,external_kolmafia_.availableAmount)(i) + (0,external_kolmafia_.storageAmount)(i) > 0;});

      if (
      mlItem.length > 0 && (
      assumeUnstarted || mlItem.find(function (i) {return (0,external_kolmafia_.availableAmount)(i) > 0;}) == null))
      {
        this.requiredPulls.push([mlItem[0], -30]);
      }

      var freeRunner = this.freeRunners.find(
      function (i) {return (0,external_kolmafia_.availableAmount)(i) + (0,external_kolmafia_.storageAmount)(i) > 0;});


      this.paths = [];
      this.paths.push(new PossiblePath(0));

      // If we're not assuming we're unstarted, then filter all the pulls we already have
      if (!assumeUnstarted) {
        this.requiredPulls = this.requiredPulls.filter(
        function (_ref) {var _ref2 = QuestInitialPulls_slicedToArray(_ref, 1),i = _ref2[0];return (0,external_kolmafia_.availableAmount)(i) == 0;});

        this.possiblePulls = this.possiblePulls.filter(
        function (_ref3) {var _ref4 = QuestInitialPulls_slicedToArray(_ref3, 1),i = _ref4[0];return (
            (0,external_kolmafia_.availableAmount)(i) == 0 && (
            (0,external_kolmafia_.historicalPrice)(i) < 50000 || (0,external_kolmafia_.storageAmount)(i) > 0));});

      }

      if (freeRunner != null && (0,external_kolmafia_.availableAmount)(freeRunner) == 0) {
        this.possiblePulls.push([freeRunner, -20]);
      }

      this.paths.push(this.getTotals(this.requiredPulls));

      // Need to make this better.. Its a real laugh.
      var _iterator = QuestInitialPulls_createForOfIteratorHelper(getAllCombinations(this.possiblePulls)),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var combination = _step.value;
          this.paths.push(this.getTotals([].concat(QuestInitialPulls_toConsumableArray(this.requiredPulls), QuestInitialPulls_toConsumableArray(combination))));
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
    } }, { key: "getId", value:

    function getId() {
      return "Misc / Initial Pulls";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "getTotals", value:

    function getTotals(items) {var _this2 = this;
      /*items = items.filter(
        ([i]) => storageAmount(i) > 0 || historicalPrice(i) < 50000
      );*/

      var advs = items.map(function (_ref5) {var _ref6 = QuestInitialPulls_slicedToArray(_ref5, 2),amount = _ref6[1];return amount;}).reduce(function (p, n) {return p + n;}, 0);

      if (
      items.find(function (_ref7) {var _ref8 = QuestInitialPulls_slicedToArray(_ref7, 1),item = _ref8[0];return item == external_kolmafia_.Item.get("Mafia Thumb Ring");}) != null &&
      items.find(function (_ref9) {var _ref10 = QuestInitialPulls_slicedToArray(_ref9, 1),item = _ref10[0];return _this2.freeRunners.includes(item);}))
      {
        // If we're using mafia ring and we plan to do free runs, mafia won't trigger as much..
        advs -= 20;
      }

      var path = new PossiblePath(advs);

      items.forEach(function (_ref11) {var _ref12 = QuestInitialPulls_slicedToArray(_ref11, 1),i = _ref12[0];return path.addPull(i);});

      return path;
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "level", value:

    function level() {
      return 1;
    } }, { key: "status", value:

    function status(path) {
      if (
      (0,external_kolmafia_.pullsRemaining)() <= 0 ||
      GreySettings_GreySettings.isHardcoreMode() ||
      path != null && !path.canUse(ResourceCategory.PULL))
      {
        return QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run(path) {
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          (0,external_kolmafia_.useFamiliar)(external_kolmafia_.Familiar.get("Grey Goose")); // Force it to be leveled up if we happen to have short order cook
          var pulled = (0,external_kolmafia_.pullsRemaining)();var _iterator2 = QuestInitialPulls_createForOfIteratorHelper(

            path.pulls),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var item = _step2.value;
              if (hasPulled(item)) {
                continue;
              }

              GreyPulls.tryPull(item, 25000);
            }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}

          var pulledAfter = (0,external_kolmafia_.pullsRemaining)();
          var pulledDiff = pulled - pulledAfter;

          var failedPulls = path.pulls.filter(function (i) {return (0,external_kolmafia_.itemAmount)(i) == 0;});

          if (failedPulls.length > 0) {
            throw "Failed to pull the items " + failedPulls.join(", ");
          }

          if (path.canUse(ResourceCategory.PULL) != pulledDiff) {
            throw "Expected to use ".concat(path.canUse(
            ResourceCategory.PULL), ", but we used ").concat(
            pulledDiff, ". Throwing error to avoid infinite looping this task");
          }
        }
      };
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return true;
    } }, { key: "free", value:

    function free() {
      return true;
    } }]);return QuestInitialPulls;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/custom/QuestInitialStart.ts
function QuestInitialStart_typeof(obj) {"@babel/helpers - typeof";return QuestInitialStart_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestInitialStart_typeof(obj);}function QuestInitialStart_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestInitialStart_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestInitialStart_slicedToArray(arr, i) {return QuestInitialStart_arrayWithHoles(arr) || QuestInitialStart_iterableToArrayLimit(arr, i) || QuestInitialStart_unsupportedIterableToArray(arr, i) || QuestInitialStart_nonIterableRest();}function QuestInitialStart_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function QuestInitialStart_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestInitialStart_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestInitialStart_arrayLikeToArray(o, minLen);}function QuestInitialStart_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestInitialStart_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function QuestInitialStart_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function QuestInitialStart_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestInitialStart_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestInitialStart_toPropertyKey(descriptor.key), descriptor);}}function QuestInitialStart_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestInitialStart_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestInitialStart_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestInitialStart_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestInitialStart_setPrototypeOf(subClass, superClass);}function QuestInitialStart_setPrototypeOf(o, p) {QuestInitialStart_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestInitialStart_setPrototypeOf(o, p);}function QuestInitialStart_createSuper(Derived) {var hasNativeReflectConstruct = QuestInitialStart_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestInitialStart_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestInitialStart_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestInitialStart_possibleConstructorReturn(this, result);};}function QuestInitialStart_possibleConstructorReturn(self, call) {if (call && (QuestInitialStart_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestInitialStart_assertThisInitialized(self);}function QuestInitialStart_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestInitialStart_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestInitialStart_getPrototypeOf(o) {QuestInitialStart_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestInitialStart_getPrototypeOf(o);}function QuestInitialStart_defineProperty(obj, key, value) {key = QuestInitialStart_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestInitialStart_toPropertyKey(arg) {var key = QuestInitialStart_toPrimitive(arg, "string");return QuestInitialStart_typeof(key) === "symbol" ? key : String(key);}function QuestInitialStart_toPrimitive(input, hint) {if (QuestInitialStart_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestInitialStart_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}









var QuestInitialStart = /*#__PURE__*/function (_TaskInfo) {QuestInitialStart_inherits(QuestInitialStart, _TaskInfo);var _super = QuestInitialStart_createSuper(QuestInitialStart);function QuestInitialStart() {var _this;QuestInitialStart_classCallCheck(this, QuestInitialStart);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestInitialStart_defineProperty(QuestInitialStart_assertThisInitialized(_this), "familiar",
    external_kolmafia_.Familiar.get("Grey Goose"));QuestInitialStart_defineProperty(QuestInitialStart_assertThisInitialized(_this), "equip",
    external_kolmafia_.Item.get("Grey Down Vest"));QuestInitialStart_defineProperty(QuestInitialStart_assertThisInitialized(_this), "desiredLevel", void 0);QuestInitialStart_defineProperty(QuestInitialStart_assertThisInitialized(_this), "weightRequired", void 0);QuestInitialStart_defineProperty(QuestInitialStart_assertThisInitialized(_this), "spaceBlanket",


    external_kolmafia_.Item.get("Space Blanket"));QuestInitialStart_defineProperty(QuestInitialStart_assertThisInitialized(_this), "mayday",
    external_kolmafia_.Item.get("MayDay supply package"));QuestInitialStart_defineProperty(QuestInitialStart_assertThisInitialized(_this), "saber",
    external_kolmafia_.Item.get("Fourth of May Cosplay Saber"));QuestInitialStart_defineProperty(QuestInitialStart_assertThisInitialized(_this), "flimsyScraps",
    external_kolmafia_.Item.get("Flimsy hardwood scraps"));QuestInitialStart_defineProperty(QuestInitialStart_assertThisInitialized(_this), "birchBattery",
    external_kolmafia_.Item.get("Birch battery"));QuestInitialStart_defineProperty(QuestInitialStart_assertThisInitialized(_this), "mummingTrunk",
    external_kolmafia_.Item.get("mumming trunk"));QuestInitialStart_defineProperty(QuestInitialStart_assertThisInitialized(_this), "paths", void 0);return _this;}QuestInitialStart_createClass(QuestInitialStart, [{ key: "createPaths", value:


    function createPaths(assumeUnstarted) {
      this.paths = [];
      this.paths.push(new PossiblePath(0));
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "level", value:

    function level() {
      return 1;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return true;
    } }, { key: "free", value:

    function free() {
      return true;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.availableAmount)(this.mayday) > 0) {
        return QuestStatus.READY;
      }

      if (
      (0,external_kolmafia_.getProperty)("hasMaydayContract") == "true" &&
      (0,external_kolmafia_.getProperty)("_maydayDropped") == "false")
      {
        return QuestStatus.NOT_READY;
      }

      if (
      (0,external_kolmafia_.availableAmount)(this.saber) > 0 &&
      (0,external_kolmafia_.getProperty)("_saberMod") == "0" &&
      GreySettings_GreySettings.greyCosplaySaber != "")
      {
        return QuestStatus.READY;
      }

      if ((0,external_kolmafia_.getProperty)("breakfastCompleted") == "false") {
        if ((0,external_kolmafia_.myMeat)() >= 900) {
          return QuestStatus.READY;
        }

        return QuestStatus.NOT_READY;
      }

      return QuestStatus.COMPLETED;
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          if (!(0,external_kolmafia_.hippyStoneBroken)() && (0,external_kolmafia_.toBoolean)((0,external_kolmafia_.getProperty)("greyEnablePvP"))) {
            (0,external_kolmafia_.print)("Enabling pvp as defined by 'greyEnablePvP'", "blue");
            (0,external_kolmafia_.visitUrl)("peevpee.php?action=smashstone&pwd&confirm=on", true);
            (0,external_kolmafia_.visitUrl)("peevpee.php?place=fight");
          }

          if (
          (0,external_kolmafia_.getProperty)("backupCameraReverserEnabled") != "true" &&
          (0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("Backup Camera")) > 0)
          {
            (0,external_kolmafia_.print)("Now reversing the backup camera..", "blue");
            (0,external_kolmafia_.cliExecute)("backupcamera reverser on");
          }

          if (
          (0,external_kolmafia_.availableAmount)(_this2.saber) > 0 &&
          (0,external_kolmafia_.getProperty)("_saberMod") == "0" &&
          GreySettings_GreySettings.greyCosplaySaber != "")
          {
            (0,external_kolmafia_.cliExecute)("saber " + GreySettings_GreySettings.greyCosplaySaber);
          }

          if (
          (0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("S.I.T. Course Completion Certificate")) >
          0 &&
          !(0,external_kolmafia_.toBoolean)((0,external_kolmafia_.getProperty)("_sitCourseCompleted")))
          {
            try {
              (0,external_kolmafia_.visitUrl)("inv_use.php?pwd&which=99&whichitem=11116");
            } catch (e) {}

            (0,external_kolmafia_.runChoice)(2);
          }

          if (
          (0,external_kolmafia_.getProperty)("telegraphOfficeAvailable") == "true" &&
          (0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("Your cowboy boots")) == 0)
          {
            (0,external_kolmafia_.visitUrl)("place.php?whichplace=town_right&action=townright_ltt");
            (0,external_kolmafia_.runChoice)(8);
          }

          var clipFams = GreySettings_GreySettings.greyClipArt.split(",").
          filter(function (s) {return s.length != 0;}).
          map(function (s) {return external_kolmafia_.Familiar.get(s);}).
          map(function (f) {return [f, (0,external_kolmafia_.familiarEquipment)(f)];}).
          filter(function (_ref) {var _ref2 = QuestInitialStart_slicedToArray(_ref, 2),f = _ref2[0],e = _ref2[1];return (0,external_kolmafia_.availableAmount)(e) == 0 && (0,external_kolmafia_.haveFamiliar)(f);});

          var clipArt = external_kolmafia_.Skill.get("Summon Clip Art");
          var jacks = external_kolmafia_.Item.get("box of familiar jacks");var _iterator = QuestInitialStart_createForOfIteratorHelper(

            clipFams),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var _step$value = QuestInitialStart_slicedToArray(_step.value, 2),fam = _step$value[0],item = _step$value[1];
              if (!(0,external_kolmafia_.haveSkill)(clipArt) || clipArt.dailylimit <= 0) {
                break;
              }

              if ((0,external_kolmafia_.availableAmount)(item) > 0) {
                continue;
              }

              (0,external_kolmafia_.print)("Using the familiar ".concat(
              fam.toString(), " to acquire fam equip ").concat(item, " from Summon Clip Art"),
              "blue");


              if ((0,external_kolmafia_.availableAmount)(jacks) == 0) {
                (0,external_kolmafia_.cliExecute)("acquire box of familiar jacks");
              }

              (0,external_kolmafia_.useFamiliar)(fam);
              (0,external_kolmafia_.use)(jacks);
            }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

          if (
          GreySettings_GreySettings.greyUseMummery &&
          (0,external_kolmafia_.getProperty)("_mummeryUses") == "" &&
          (0,external_kolmafia_.availableAmount)(_this2.mummingTrunk) > 0)
          {
            (0,external_kolmafia_.useFamiliar)(_this2.familiar);

            if ((0,external_kolmafia_.myFamiliar)() == _this2.familiar) {
              (0,external_kolmafia_.cliExecute)("mummery mp");
            } else {
              (0,external_kolmafia_.print)("Unable to apply mp regen on goose", "Red");
            }
          }

          if (
          (0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("SongBoom&trade; BoomBox")) > 0 &&
          (0,external_kolmafia_.getProperty)("_boomBoxSongsLeft") == "11")
          {
            (0,external_kolmafia_.cliExecute)("boombox meat");
          }

          if ((0,external_kolmafia_.availableAmount)(_this2.mayday) > 0) {
            (0,external_kolmafia_.use)(_this2.mayday);

            if ((0,external_kolmafia_.availableAmount)(_this2.spaceBlanket) > 0) {
              (0,external_kolmafia_.autosell)(_this2.spaceBlanket, 1);
            }
          }

          if ((0,external_kolmafia_.getProperty)("breakfastCompleted") == "false" && (0,external_kolmafia_.myMeat)() >= 900) {
            var breakfastScript = (0,external_kolmafia_.getProperty)("breakfastScript");
            var props = new Properties_PropertyManager();
            props.setProperty("grabCloversSoftcore", "true");
            props.setProperty("grabCloversHardcore", "true");

            doFortuneTeller();

            try {
              if (breakfastScript == "") {
                breakfastScript = "breakfast";
              }

              (0,external_kolmafia_.cliExecute)(breakfastScript);

              var clover = external_kolmafia_.Item.get("11-leaf Clover");

              if ((0,external_kolmafia_.availableAmount)(clover) == 0) {
                (0,external_kolmafia_.print)(
                "Don't see any clovers available, maybe mafia hiccuped? Trying breakfast again..",
                "gray");

                (0,external_kolmafia_.cliExecute)(breakfastScript);
              }
            } finally {
              props.resetAll();
            }

            deleteJunkKmails();
          }

          if (
          (0,external_kolmafia_.availableAmount)(_this2.flimsyScraps) > 0 &&
          (0,external_kolmafia_.availableAmount)(_this2.birchBattery) == 0)
          {
            (0,external_kolmafia_.cliExecute)("acquire " + _this2.birchBattery.name);
          }

          if ((0,external_kolmafia_.getProperty)("breakfastCompleted") == "false") {
            throw "Failed to complete breakfast! Did you set something that doesn't call breakfast, to `breakfastScript`?";
          }
        }
      };
    } }, { key: "getId", value:

    function getId() {
      return "Misc / InitialStart";
    } }]);return QuestInitialStart;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/custom/QuestJuneCleaver.ts
function QuestJuneCleaver_typeof(obj) {"@babel/helpers - typeof";return QuestJuneCleaver_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestJuneCleaver_typeof(obj);}function QuestJuneCleaver_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestJuneCleaver_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestJuneCleaver_toPropertyKey(descriptor.key), descriptor);}}function QuestJuneCleaver_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestJuneCleaver_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestJuneCleaver_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestJuneCleaver_defineProperty(obj, key, value) {key = QuestJuneCleaver_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestJuneCleaver_toPropertyKey(arg) {var key = QuestJuneCleaver_toPrimitive(arg, "string");return QuestJuneCleaver_typeof(key) === "symbol" ? key : String(key);}function QuestJuneCleaver_toPrimitive(input, hint) {if (QuestJuneCleaver_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestJuneCleaver_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestJuneCleaver = /*#__PURE__*/function () {function QuestJuneCleaver() {QuestJuneCleaver_classCallCheck(this, QuestJuneCleaver);QuestJuneCleaver_defineProperty(this, "warren",
    external_kolmafia_.Location.get("The Dire Warren"));QuestJuneCleaver_defineProperty(this, "cleaver",
    external_kolmafia_.Item.get("June Cleaver"));QuestJuneCleaver_defineProperty(this, "teleportis",
    external_kolmafia_.Effect.get("Teleportitis"));QuestJuneCleaver_defineProperty(this, "icyPeak",
    external_kolmafia_.Location.get("The Icy Peak"));QuestJuneCleaver_defineProperty(this, "palindom",
    external_kolmafia_.Location.get("Inside the Palindome"));QuestJuneCleaver_defineProperty(this, "ultraRares",
    [
    "Battlefield (No Uniform)",
    "Inside the Palindome",
    "The Dungeons of Doom",
    "Menagerie Level 1",
    "Cobb's Knob Treasury",
    "Pandamonium Slums",
    "A Mob of Zeppelin Protesters",
    "The Icy Peak",
    "The Sleazy Back Alley",
    "The Haunted Billiards Room",
    "The VERY Unquiet Garves",
    "The Spooky Forest"].
    map(function (s) {return external_kolmafia_.Location.get(s);}));QuestJuneCleaver_defineProperty(this, "goose",
    external_kolmafia_.Familiar.get("Grey Goose"));QuestJuneCleaver_defineProperty(this, "talisman",
    external_kolmafia_.Item.get("Talisman o' Namsilat"));}QuestJuneCleaver_createClass(QuestJuneCleaver, [{ key: "getId", value:

    function getId() {
      return "Misc / JuneCleaver";
    } }, { key: "level", value:

    function level() {
      return 3;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return true;
    } }, { key: "free", value:

    function free() {
      return true;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.availableAmount)(this.cleaver) == 0) {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.haveEffect)(this.teleportis) > 0) {
        return QuestStatus.NOT_READY;
      }

      var fightsLeft = (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_juneCleaverFightsLeft"));

      if (fightsLeft > 0) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      // We fish for zones with URs in them, on the chance it lets us. Unlikely hey.
      var loc = this.ultraRares.find(
      function (l) {return (
          canGreyAdventure(l) && (
          l != _this.icyPeak || (0,external_kolmafia_.numericModifier)("Cold Resistance") >= 5));});


      if (loc == null) {
        loc = this.warren;
      }

      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          (0,external_kolmafia_.maximize)("+equip " + _this.cleaver.name + " -tie", false);

          if ((0,external_kolmafia_.equippedAmount)(_this.cleaver) == 0) {
            throw "Something went wrong. Expected to be holding the june cleaver";
          }

          if (loc == _this.palindom && (0,external_kolmafia_.equippedAmount)(_this.talisman) == 0) {
            (0,external_kolmafia_.equip)(external_kolmafia_.Slot.get("acc3"), _this.talisman);
          }

          // We're using the grey goose if it has enough fam weight to dupe, incase we hit an UR
          if (
          (0,external_kolmafia_.myFamiliar)() != _this.goose &&
          (0,external_kolmafia_.familiarWeight)(_this.goose) >= 6 &&
          _this.ultraRares.includes(loc))
          {
            (0,external_kolmafia_.useFamiliar)(_this.goose);
          }

          var turn = (0,external_kolmafia_.turnsPlayed)();

          greyAdv(loc);

          if (turn != (0,external_kolmafia_.turnsPlayed)()) {
            throw "Something went wrong, expected to hit a june cleaver NC but instead spent a turn.";
          }
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }]);return QuestJuneCleaver;}();
;// CONCATENATED MODULE: ./src/quests/custom/QuestMoonSign.ts
function QuestMoonSign_typeof(obj) {"@babel/helpers - typeof";return QuestMoonSign_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestMoonSign_typeof(obj);}function QuestMoonSign_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestMoonSign_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestMoonSign_toPropertyKey(descriptor.key), descriptor);}}function QuestMoonSign_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestMoonSign_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestMoonSign_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestMoonSign_defineProperty(obj, key, value) {key = QuestMoonSign_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestMoonSign_toPropertyKey(arg) {var key = QuestMoonSign_toPrimitive(arg, "string");return QuestMoonSign_typeof(key) === "symbol" ? key : String(key);}function QuestMoonSign_toPrimitive(input, hint) {if (QuestMoonSign_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestMoonSign_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestMoonSign = /*#__PURE__*/function () {function QuestMoonSign() {QuestMoonSign_classCallCheck(this, QuestMoonSign);QuestMoonSign_defineProperty(this, "spoon",
    external_kolmafia_.Item.get("hewn moon-rune spoon"));QuestMoonSign_defineProperty(this, "asdon",
    external_kolmafia_.Item.get("Asdon Martin keyfob"));QuestMoonSign_defineProperty(this, "knollAbsorb",
    external_kolmafia_.Monster.get("revolving bugbear"));QuestMoonSign_defineProperty(this, "gnomeAbsorb",
    external_kolmafia_.Monster.get("vicious gnauga"));QuestMoonSign_defineProperty(this, "canadiaAbsorb",
    external_kolmafia_.Monster.get("Cloud of disembodied whiskers"));QuestMoonSign_defineProperty(this, "gnomeSkills",
    [
    "Powers of Observatiogn",
    "Torso Awareness",
    "Gnefarious Pickpocketing "].
    map(function (s) {return external_kolmafia_.Skill.get(s);}));}QuestMoonSign_createClass(QuestMoonSign, [{ key: "getId", value:

    function getId() {
      return "Misc / Moonsign";
    } }, { key: "level", value:

    function level() {
      return 8;
    } }, { key: "free", value:

    function free() {
      return true;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return true;
    } }, { key: "status", value:

    function status() {
      if (
      (0,external_kolmafia_.getProperty)("moonTuned") != "false" ||
      (0,external_kolmafia_.availableAmount)(this.spoon) == 0)
      {
        return QuestStatus.COMPLETED;
      }

      if (
      moonSigns.find(
      function (s) {var _GreySettings$greyTun;return s.toLowerCase() == ((_GreySettings$greyTun = GreySettings_GreySettings.greyTuneMoonSpoon) === null || _GreySettings$greyTun === void 0 ? void 0 : _GreySettings$greyTun.toLowerCase());}) ==
      null)
      {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.knollAvailable)() && this.isKnollDone()) {
        return QuestStatus.READY;
      }

      if ((0,external_kolmafia_.gnomadsAvailable)() && this.isGnomesDone()) {
        return QuestStatus.READY;
      }

      if ((0,external_kolmafia_.canadiaAvailable)() && this.isCanadaDone()) {
        return QuestStatus.READY;
      }

      return QuestStatus.NOT_READY;
    } }, { key: "run", value:

    function run() {
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          /*let confirm = userConfirm("Ready to change moon signs?");
           if (!confirm) {
            throw "User wasn't ready";
          }*/


          (0,external_kolmafia_.cliExecute)("spoon " + GreySettings_GreySettings.greyTuneMoonSpoon);

          if ((0,external_kolmafia_.getProperty)("moonTuned") != "true") {
            throw "Something went wrong when trying to moon spoon tune!";
          }

          (0,external_kolmafia_.cliExecute)("refresh all");
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "isKnollDone", value:

    function isKnollDone() {
      // We can get costume from here
      if ((0,external_kolmafia_.getWorkshed)() == this.asdon && !(0,external_kolmafia_.haveOutfit)("Bugbear Costume")) {
        return false;
      }

      if ((0,external_kolmafia_.getProperty)("questM01Untinker") != "finished") {
        return false;
      }

      // We can make car from here
      if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastDesertUnlock")) != (0,external_kolmafia_.myAscensions)()) {
        return false;
      }

      if (!GreyAbsorber_AbsorbsProvider.getReabsorbedMonsters().includes(this.knollAbsorb)) {
        return false;
      }

      return true;
    } }, { key: "isGnomesDone", value:

    function isGnomesDone() {
      if (this.gnomeSkills.find(function (s) {return !(0,external_kolmafia_.haveSkill)(s);}) != null) {
        return false;
      }

      if (!GreyAbsorber_AbsorbsProvider.getReabsorbedMonsters().includes(this.gnomeAbsorb)) {
        return false;
      }

      return true;
    } }, { key: "isCanadaDone", value:

    function isCanadaDone() {
      if (!GreyAbsorber_AbsorbsProvider.getReabsorbedMonsters().includes(this.canadiaAbsorb)) {
        return false;
      }

      return true;
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestMoonSign;}();
;// CONCATENATED MODULE: ./src/quests/custom/QuestNpcStuff.ts
function QuestNpcStuff_typeof(obj) {"@babel/helpers - typeof";return QuestNpcStuff_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestNpcStuff_typeof(obj);}function QuestNpcStuff_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestNpcStuff_setPrototypeOf(subClass, superClass);}function QuestNpcStuff_setPrototypeOf(o, p) {QuestNpcStuff_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestNpcStuff_setPrototypeOf(o, p);}function QuestNpcStuff_createSuper(Derived) {var hasNativeReflectConstruct = QuestNpcStuff_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestNpcStuff_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestNpcStuff_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestNpcStuff_possibleConstructorReturn(this, result);};}function QuestNpcStuff_possibleConstructorReturn(self, call) {if (call && (QuestNpcStuff_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestNpcStuff_assertThisInitialized(self);}function QuestNpcStuff_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestNpcStuff_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestNpcStuff_getPrototypeOf(o) {QuestNpcStuff_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestNpcStuff_getPrototypeOf(o);}function QuestNpcStuff_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestNpcStuff_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestNpcStuff_toPropertyKey(descriptor.key), descriptor);}}function QuestNpcStuff_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestNpcStuff_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestNpcStuff_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestNpcStuff_defineProperty(obj, key, value) {key = QuestNpcStuff_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestNpcStuff_toPropertyKey(arg) {var key = QuestNpcStuff_toPrimitive(arg, "string");return QuestNpcStuff_typeof(key) === "symbol" ? key : String(key);}function QuestNpcStuff_toPrimitive(input, hint) {if (QuestNpcStuff_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestNpcStuff_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}









var QuestNPCStuff = /*#__PURE__*/function () {function QuestNPCStuff() {QuestNpcStuff_classCallCheck(this, QuestNPCStuff);QuestNpcStuff_defineProperty(this, "children",
    [
    new QuestMeatSmith(),
    new QuestArtist(),
    new QuestGnomeTrainer(),
    new QuestMadBaker(),
    new QuestUntinker(),
    new QuestDruggie(),
    new QuestKnollMayor(),
    new QuestDoctor()]);}QuestNpcStuff_createClass(QuestNPCStuff, [{ key: "getId", value:


    function getId() {
      return "NPC / Parent";
    } }, { key: "level", value:

    function level() {
      return -1;
    } }, { key: "status", value:

    function status() {
      return QuestStatus.COMPLETED;
    } }, { key: "run", value:

    function run() {
      throw new Error("Method not implemented.");
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "getChildren", value:

    function getChildren() {
      return this.children;
    } }]);return QuestNPCStuff;}();var


QuestDoctor = /*#__PURE__*/function () {function QuestDoctor() {QuestNpcStuff_classCallCheck(this, QuestDoctor);}QuestNpcStuff_createClass(QuestDoctor, [{ key: "getId", value:
    function getId() {
      return "NPC / Doctor";
    } }, { key: "level", value:

    function level() {
      return 1;
    } }, { key: "free", value:

    function free() {
      return true;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return true;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.getProperty)("questM24Doc") != "unstarted") {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastCouncilVisit")) < 1) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          (0,external_kolmafia_.visitUrl)("shop.php?whichshop=doc&action=talk");
          (0,external_kolmafia_.runChoice)(1);
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }]);return QuestDoctor;}();var


QuestKnollMayor = /*#__PURE__*/function () {function QuestKnollMayor() {QuestNpcStuff_classCallCheck(this, QuestKnollMayor);QuestNpcStuff_defineProperty(this, "spoon",
    external_kolmafia_.Item.get("hewn moon-rune spoon"));}QuestNpcStuff_createClass(QuestKnollMayor, [{ key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "getId", value:

    function getId() {
      return "NPC / Knoll Mayor";
    } }, { key: "level", value:

    function level() {
      return 2;
    } }, { key: "free", value:

    function free() {
      return true;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return true;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.getProperty)("questM03Bugbear") != "unstarted") {
        return QuestStatus.COMPLETED;
      }

      if (!(0,external_kolmafia_.knollAvailable)()) {
        if (
        (0,external_kolmafia_.availableAmount)(this.spoon) > 0 &&
        (0,external_kolmafia_.getProperty)("moonTuned") == "false" &&
        getMoonZone(GreySettings_GreySettings.greyTuneMoonSpoon) == "Knoll")
        {
          return QuestStatus.NOT_READY;
        }

        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.getProperty)("questL02Larva") == "unstarted") {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {
      return {
        outfit: GreyOutfit.IGNORE_OUTFIT,
        location: null,
        run: function run() {
          (0,external_kolmafia_.visitUrl)("place.php?whichplace=knoll_friendly&action=dk_mayor");
        }
      };
    } }]);return QuestKnollMayor;}();var


QuestDruggie = /*#__PURE__*/function () {function QuestDruggie() {QuestNpcStuff_classCallCheck(this, QuestDruggie);}QuestNpcStuff_createClass(QuestDruggie, [{ key: "getId", value:
    function getId() {
      return "NPC / Druggie";
    } }, { key: "level", value:

    function level() {
      return 5;
    } }, { key: "free", value:

    function free() {
      return true;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return true;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastGoofballBuy")) == (0,external_kolmafia_.myAscensions)()) {
        return QuestStatus.COMPLETED;
      }

      if (getQuestStatus("questL03Rat") < 0) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          (0,external_kolmafia_.visitUrl)("place.php?whichplace=woods");
          (0,external_kolmafia_.visitUrl)("tavern.php?place=susguy&action=buygoofballs", true);
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }]);return QuestDruggie;}();var


QuestGnomeTrainer = /*#__PURE__*/function (_TaskInfo) {QuestNpcStuff_inherits(QuestGnomeTrainer, _TaskInfo);var _super = QuestNpcStuff_createSuper(QuestGnomeTrainer);function QuestGnomeTrainer() {var _this;QuestNpcStuff_classCallCheck(this, QuestGnomeTrainer);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestNpcStuff_defineProperty(QuestNpcStuff_assertThisInitialized(_this), "skills",
    [
    "Torso Awareness",
    "Powers of Observatiogn",
    "Gnefarious Pickpocketing"].
    map(function (s) {return external_kolmafia_.Skill.get(s);}));QuestNpcStuff_defineProperty(QuestNpcStuff_assertThisInitialized(_this), "letter",
    external_kolmafia_.Item.get("Letter for Melvign the Gnome"));QuestNpcStuff_defineProperty(QuestNpcStuff_assertThisInitialized(_this), "shirt",
    external_kolmafia_.Item.get('"Remember the Trees" Shirt'));QuestNpcStuff_defineProperty(QuestNpcStuff_assertThisInitialized(_this), "torso",
    external_kolmafia_.Skill.get("Torso Awareness"));QuestNpcStuff_defineProperty(QuestNpcStuff_assertThisInitialized(_this), "spoon",
    external_kolmafia_.Item.get("hewn moon-rune spoon"));QuestNpcStuff_defineProperty(QuestNpcStuff_assertThisInitialized(_this), "paths", void 0);return _this;}QuestNpcStuff_createClass(QuestGnomeTrainer, [{ key: "createPaths", value:


    function createPaths(assumeUnstarted) {
      this.paths = [];

      if (!assumeUnstarted && (0,external_kolmafia_.availableAmount)(this.shirt) > 0) {
        this.paths.push(new PossiblePath(0));
        return;
      }

      // If we're not in gnomes
      if (
      getMoonZone() != "Gnomad" &&
      !GreySettings_GreySettings.willBeAccessible("Gnomad", assumeUnstarted))
      {
        // If we won't be in gnomes
        this.paths.push(new PossiblePath(0));
        return;
      }

      this.paths.push(
      new PossiblePath(0).addPull(this.shirt),
      new PossiblePath(10));

    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "getId", value:

    function getId() {
      return "NPC / GnomeSkills";
    } }, { key: "level", value:

    function level() {
      return 1;
    } }, { key: "free", value:

    function free() {
      return true;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return true;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "status", value:

    function status(path) {
      if ((0,external_kolmafia_.availableAmount)(this.letter) > 0 && !(0,external_kolmafia_.haveSkill)(this.torso)) {
        return QuestStatus.READY;
      }

      if (
      path == null ||
      (0,external_kolmafia_.haveSkill)(this.torso) && path.canUse(ResourceCategory.PULL))
      {
        return QuestStatus.READY;
      }

      if (
      getQuestStatus("questL13Final") >= 0 ||
      this.getSkillLacking() == null)
      {
        return QuestStatus.COMPLETED;
      }

      if (!(0,external_kolmafia_.gnomadsAvailable)()) {
        return QuestStatus.NOT_READY;
      }

      var meat = 7500 + ((0,external_kolmafia_.haveSkill)(this.torso) ? 5000 : 0);

      if ((0,external_kolmafia_.myMeat)() < meat) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "getSkillLacking", value:

    function getSkillLacking() {
      return this.skills.find(function (s) {return !(0,external_kolmafia_.haveSkill)(s);});
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      if ((0,external_kolmafia_.availableAmount)(this.letter) > 0 && !(0,external_kolmafia_.haveSkill)(this.torso)) {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {
            (0,external_kolmafia_.use)(_this2.letter);
          }
        };
      }

      if ((0,external_kolmafia_.haveSkill)(this.torso) && path.canUse(ResourceCategory.PULL)) {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {
            GreyPulls.tryPull(_this2.shirt);
          }
        };
      }

      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          var skill = _this2.getSkillLacking();

          (0,external_kolmafia_.visitUrl)("gnomes.php?action=trainskill&whichskill=" + (0,external_kolmafia_.toInt)(skill));

          if ((0,external_kolmafia_.haveSkill)(_this2.torso) && path.canUse(ResourceCategory.PULL)) {
            GreyPulls.tryPull(_this2.shirt);
          }

          if (skill == _this2.torso) {
            AdventureFinder.recalculatePath();
          }
        }
      };
    } }]);return QuestGnomeTrainer;}(TaskInfo);var


QuestArtist = /*#__PURE__*/function () {function QuestArtist() {QuestNpcStuff_classCallCheck(this, QuestArtist);QuestNpcStuff_defineProperty(this, "paintbrush",
    external_kolmafia_.Item.get("Pretentious Paintbrush"));QuestNpcStuff_defineProperty(this, "palette",
    external_kolmafia_.Item.get("Pretentious Palette"));QuestNpcStuff_defineProperty(this, "pail",
    external_kolmafia_.Item.get("Pail of Pretentious Paint"));}QuestNpcStuff_createClass(QuestArtist, [{ key: "level", value:

    function level() {
      return 1;
    } }, { key: "getId", value:

    function getId() {
      return "NPC / Painter";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "free", value:

    function free() {
      return true;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return true;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.getProperty)("questM02Artist") == "finished") {
        return QuestStatus.COMPLETED;
      }

      // Don't start it since it's not a free turn
      // User has to start it.
      if ((0,external_kolmafia_.getProperty)("questM02Artist") == "unstarted") {
        return QuestStatus.COMPLETED;
      }

      if (this.hasAllItems()) {
        return QuestStatus.READY;
      }

      return QuestStatus.NOT_READY;
    } }, { key: "startQuest", value:

    function startQuest() {
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          (0,external_kolmafia_.visitUrl)(
          "place.php?whichplace=town_wrong&action=townwrong_artist_noquest");

          (0,external_kolmafia_.visitUrl)(
          "place.php?whichplace=town_wrong&action=townwrong_artist_noquest&getquest=1");

          (0,external_kolmafia_.visitUrl)(
          "place.php?whichplace=town_wrong&action=townwrong_artist_quest");

        }
      };
    } }, { key: "turnInQuest", value:

    function turnInQuest() {
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          (0,external_kolmafia_.visitUrl)(
          "place.php?whichplace=town_wrong&action=townwrong_artist_quest");

        }
      };
    } }, { key: "run", value:

    function run() {
      if (this.hasAllItems()) {
        return this.turnInQuest();
      }

      return this.startQuest();
    } }, { key: "hasAllItems", value:

    function hasAllItems() {
      return (
        (0,external_kolmafia_.availableAmount)(this.paintbrush) > 0 &&
        (0,external_kolmafia_.availableAmount)(this.pail) > 0 &&
        (0,external_kolmafia_.availableAmount)(this.palette) > 0);

    } }]);return QuestArtist;}();var


QuestMadBaker = /*#__PURE__*/function () {function QuestMadBaker() {QuestNpcStuff_classCallCheck(this, QuestMadBaker);}QuestNpcStuff_createClass(QuestMadBaker, [{ key: "level", value:
    function level() {
      return 1;
    } }, { key: "getId", value:

    function getId() {
      return "NPC / Baker";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "free", value:

    function free() {
      return true;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return true;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.getProperty)("questM25Armorer") != "unstarted") {
        return QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }, { key: "turnInPie", value:

    function turnInPie() {
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          (0,external_kolmafia_.visitUrl)("shop.php?whichshop=armory");
          (0,external_kolmafia_.visitUrl)("choice.php?whichchoice=" + (0,external_kolmafia_.lastChoice)() + "&option=2&pwd=");
        }
      };
    } }, { key: "startQuest", value:

    function startQuest() {
      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          (0,external_kolmafia_.visitUrl)("shop.php?whichshop=armory");
          (0,external_kolmafia_.visitUrl)("shop.php?whichshop=armory&action=talk");
          (0,external_kolmafia_.visitUrl)("choice.php?pwd=&whichchoice=1065&option=1");

          if ((0,external_kolmafia_.getProperty)("choiceAdventure1061") == "0") {
            (0,external_kolmafia_.setProperty)("choiceAdventure1061", "1");
          }
        }
      };
    } }, { key: "run", value:

    function run() {
      if ((0,external_kolmafia_.getProperty)("questM25Armorer") == "unstarted") {
        return this.startQuest();
      }

      return this.turnInPie();
    } }]);return QuestMadBaker;}();var


QuestUntinker = /*#__PURE__*/function () {function QuestUntinker() {QuestNpcStuff_classCallCheck(this, QuestUntinker);QuestNpcStuff_defineProperty(this, "item",
    external_kolmafia_.Item.get("Rusty screwdriver"));}QuestNpcStuff_createClass(QuestUntinker, [{ key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "getId", value:

    function getId() {
      return "NPC / Untinkerer";
    } }, { key: "level", value:

    function level() {
      return 4;
    } }, { key: "free", value:

    function free() {
      return true;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return true;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.getProperty)("questM01Untinker") == "finished") {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastCouncilVisit")) < 4) {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.getProperty)("questM01Untinker") == "unstarted") {
        return QuestStatus.READY;
      }

      if ((0,external_kolmafia_.availableAmount)(this.item) == 0 && !(0,external_kolmafia_.knollAvailable)()) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {
      if ((0,external_kolmafia_.getProperty)("questM01Untinker") == "unstarted") {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {
            (0,external_kolmafia_.visitUrl)(
            "place.php?whichplace=forestvillage&preaction=screwquest&action=fv_untinker_quest");

            (0,external_kolmafia_.setProperty)("questM01Untinker", "started");
          }
        };
      }

      if ((0,external_kolmafia_.knollAvailable)() && (0,external_kolmafia_.availableAmount)(this.item) == 0) {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {
            (0,external_kolmafia_.visitUrl)("place.php?whichplace=knoll_friendly&action=dk_innabox");
          }
        };
      }

      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          (0,external_kolmafia_.visitUrl)("place.php?whichplace=forestvillage&action=fv_untinker");
        }
      };
    } }]);return QuestUntinker;}();var


QuestMeatSmith = /*#__PURE__*/function () {function QuestMeatSmith() {QuestNpcStuff_classCallCheck(this, QuestMeatSmith);}QuestNpcStuff_createClass(QuestMeatSmith, [{ key: "getId", value:
    function getId() {
      return "NPC / Meatsmith";
    } }, { key: "level", value:

    function level() {
      return 1;
    } }, { key: "free", value:

    function free() {
      return true;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return true;
    } }, { key: "run", value:

    function run() {
      if ((0,external_kolmafia_.getProperty)("questM23Meatsmith") == "unstarted") {
        return {
          location: null,
          outfit: GreyOutfit.IGNORE_OUTFIT,
          run: function run() {
            (0,external_kolmafia_.visitUrl)("shop.php?whichshop=meatsmith");
            (0,external_kolmafia_.visitUrl)("shop.php?whichshop=meatsmith&action=talk");
            (0,external_kolmafia_.visitUrl)("choice.php?whichchoice=1059&option=1&pwd=");
          }
        };
      }

      return {
        location: null,
        outfit: GreyOutfit.IGNORE_OUTFIT,
        run: function run() {
          (0,external_kolmafia_.visitUrl)("shop.php?whichshop=meatsmith");
          (0,external_kolmafia_.visitUrl)("choice.php?whichchoice=" + (0,external_kolmafia_.lastChoice)() + "&option=2&pwd=");
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.getProperty)("questM23Meatsmith") != "unstarted") {
        return QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }]);return QuestMeatSmith;}();
;// CONCATENATED MODULE: ./src/quests/custom/QuestPowerLeveling.ts
function QuestPowerLeveling_typeof(obj) {"@babel/helpers - typeof";return QuestPowerLeveling_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestPowerLeveling_typeof(obj);}function QuestPowerLeveling_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestPowerLeveling_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestPowerLeveling_toPropertyKey(descriptor.key), descriptor);}}function QuestPowerLeveling_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestPowerLeveling_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestPowerLeveling_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestPowerLeveling_defineProperty(obj, key, value) {key = QuestPowerLeveling_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestPowerLeveling_toPropertyKey(arg) {var key = QuestPowerLeveling_toPrimitive(arg, "string");return QuestPowerLeveling_typeof(key) === "symbol" ? key : String(key);}function QuestPowerLeveling_toPrimitive(input, hint) {if (QuestPowerLeveling_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestPowerLeveling_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}







var QuestPowerLeveling = /*#__PURE__*/function () {







  function QuestPowerLeveling(desiredLevel) {QuestPowerLeveling_classCallCheck(this, QuestPowerLeveling);QuestPowerLeveling_defineProperty(this, "property", "greyYouLastPowerLeveled");QuestPowerLeveling_defineProperty(this, "familiar", external_kolmafia_.Familiar.get("Grey Goose"));QuestPowerLeveling_defineProperty(this, "equip", external_kolmafia_.Item.get("Grey Down Vest"));QuestPowerLeveling_defineProperty(this, "skill", external_kolmafia_.Skill.get("Infinite Loop"));QuestPowerLeveling_defineProperty(this, "desiredLevel", void 0);QuestPowerLeveling_defineProperty(this, "weightRequired", void 0);
    this.desiredLevel = desiredLevel;

    this.weightRequired = this.getWeightNeededToReachLevel(desiredLevel);

    if (this.weightRequired > 20) {
      throw (
        "You want to reach level " +
        desiredLevel +
        " but to do that, the goose would have to weigh " +
        this.weightRequired +
        "...");

    }

    var expNeeded = this.weightRequired ^ 2;

    if ((0,external_kolmafia_.familiarWeight)(this.familiar) <= 1) {
      expNeeded -= 81; // Short order cook
    } else {
      expNeeded -= this.familiar.experience;
    }

    var turns = expNeeded / 5; // Expect to gain 5 exp per arena fight

    if (turns > 20) {
      throw (
        "Sorry, I can't let you do this. That'd burn more than 20 turns to a total of est " +
        turns);

    }
  }QuestPowerLeveling_createClass(QuestPowerLeveling, [{ key: "mustBeDone", value:

    function mustBeDone() {
      return (0,external_kolmafia_.myLevel)() < 5 && (0,external_kolmafia_.myMeat)() >= 100;
    } }, { key: "getWeightNeededToReachLevel", value:

    function getWeightNeededToReachLevel(level) {
      var statsNeeded = this.getStatsRequired(level);

      return 5 + Math.ceil((0,external_kolmafia_.squareRoot)(statsNeeded));
    } }, { key: "getStatsRequired", value:

    function getStatsRequired(level) {
      return (level - 1 ^ 2) + 4 ^ 2;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "level", value:

    function level() {
      return 1;
    } }, { key: "status", value:

    function status() {
      if (
      (0,external_kolmafia_.myLevel)() >= this.desiredLevel ||
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)(this.property)) == (0,external_kolmafia_.myAscensions)())
      {
        return QuestStatus.COMPLETED;
      }

      if (!(0,external_kolmafia_.haveSkill)(this.skill)) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      return {
        outfit: new GreyOutfit("familiar experience +familiar weight -tie"),
        location: null,
        run: function run() {
          (0,external_kolmafia_.useFamiliar)(_this.familiar);
          (0,external_kolmafia_.maximize)("familiar experience", false);

          var weightNeeded = _this.getWeightNeededToReachLevel(
          _this.desiredLevel);


          (0,external_kolmafia_.visitUrl)("arena.php");

          while (
          (0,external_kolmafia_.familiarWeight)(_this.familiar) < weightNeeded &&
          (0,external_kolmafia_.myAdventures)() > 20 &&
          (0,external_kolmafia_.myMeat)() >= 100)
          {
            if (
            (0,external_kolmafia_.equippedAmount)(_this.equip) == 0 &&
            (0,external_kolmafia_.availableAmount)(_this.equip) > 0)
            {
              (0,external_kolmafia_.equip)(_this.equip);
            }

            (0,external_kolmafia_.cliExecute)("train turns 1");
          }

          (0,external_kolmafia_.setProperty)(_this.property, (0,external_kolmafia_.myAscensions)() + "");

          if ((0,external_kolmafia_.familiarWeight)(_this.familiar) < weightNeeded) {
            throw (
              "Oh god! You are a disappointment Mr Goose! You only weigh " +
              (0,external_kolmafia_.familiarWeight)(_this.familiar) +
              " of the " +
              weightNeeded +
              " we wanted!");

            return;
          }

          if ((0,external_kolmafia_.myLevel)() < 4) {
            (0,external_kolmafia_.print)("Now we just need to travel somewhere to burn this exp");

            (0,external_kolmafia_.maximize)(new GreyOutfit().createString(), false);
            greyAdv(
            external_kolmafia_.Location.get("The Dire Warren"),
            null,
            new AdventureSettings().setFinishingBlowMacro(
            Macro.trySkill(external_kolmafia_.Skill.get("Convert Matter to Pomade")).step(
            greyKillingBlow(new GreyOutfit()))));



          }
          // Eh, just burn it in knob as delay.
          // TODO
        }
      };
    } }, { key: "getId", value:

    function getId() {
      return "Misc / PowerLeveling";
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestPowerLeveling;}();
;// CONCATENATED MODULE: ./src/quests/skills/QuestLocketInfiniteLoop.ts
function QuestLocketInfiniteLoop_typeof(obj) {"@babel/helpers - typeof";return QuestLocketInfiniteLoop_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestLocketInfiniteLoop_typeof(obj);}function QuestLocketInfiniteLoop_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestLocketInfiniteLoop_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestLocketInfiniteLoop_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestLocketInfiniteLoop_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestLocketInfiniteLoop_arrayLikeToArray(o, minLen);}function QuestLocketInfiniteLoop_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestLocketInfiniteLoop_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestLocketInfiniteLoop_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestLocketInfiniteLoop_toPropertyKey(descriptor.key), descriptor);}}function QuestLocketInfiniteLoop_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestLocketInfiniteLoop_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestLocketInfiniteLoop_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestLocketInfiniteLoop_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestLocketInfiniteLoop_setPrototypeOf(subClass, superClass);}function QuestLocketInfiniteLoop_setPrototypeOf(o, p) {QuestLocketInfiniteLoop_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestLocketInfiniteLoop_setPrototypeOf(o, p);}function QuestLocketInfiniteLoop_createSuper(Derived) {var hasNativeReflectConstruct = QuestLocketInfiniteLoop_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestLocketInfiniteLoop_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestLocketInfiniteLoop_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestLocketInfiniteLoop_possibleConstructorReturn(this, result);};}function QuestLocketInfiniteLoop_possibleConstructorReturn(self, call) {if (call && (QuestLocketInfiniteLoop_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestLocketInfiniteLoop_assertThisInitialized(self);}function QuestLocketInfiniteLoop_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestLocketInfiniteLoop_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestLocketInfiniteLoop_getPrototypeOf(o) {QuestLocketInfiniteLoop_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestLocketInfiniteLoop_getPrototypeOf(o);}function QuestLocketInfiniteLoop_defineProperty(obj, key, value) {key = QuestLocketInfiniteLoop_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestLocketInfiniteLoop_toPropertyKey(arg) {var key = QuestLocketInfiniteLoop_toPrimitive(arg, "string");return QuestLocketInfiniteLoop_typeof(key) === "symbol" ? key : String(key);}function QuestLocketInfiniteLoop_toPrimitive(input, hint) {if (QuestLocketInfiniteLoop_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestLocketInfiniteLoop_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}









var QuestLocketInfiniteLoop = /*#__PURE__*/function (_TaskInfo) {QuestLocketInfiniteLoop_inherits(QuestLocketInfiniteLoop, _TaskInfo);var _super = QuestLocketInfiniteLoop_createSuper(QuestLocketInfiniteLoop);function QuestLocketInfiniteLoop() {var _this;QuestLocketInfiniteLoop_classCallCheck(this, QuestLocketInfiniteLoop);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestLocketInfiniteLoop_defineProperty(QuestLocketInfiniteLoop_assertThisInitialized(_this), "monster",
    external_kolmafia_.Monster.get("Pygmy witch lawyer"));QuestLocketInfiniteLoop_defineProperty(QuestLocketInfiniteLoop_assertThisInitialized(_this), "skill",
    external_kolmafia_.Skill.get("Infinite Loop"));QuestLocketInfiniteLoop_defineProperty(QuestLocketInfiniteLoop_assertThisInitialized(_this), "instantKill",
    external_kolmafia_.Item.get("Flame orb"));QuestLocketInfiniteLoop_defineProperty(QuestLocketInfiniteLoop_assertThisInitialized(_this), "wish",
    external_kolmafia_.Item.get("Pocket Wish"));QuestLocketInfiniteLoop_defineProperty(QuestLocketInfiniteLoop_assertThisInitialized(_this), "pantsgiving",
    external_kolmafia_.Item.get("Pantsgiving"));QuestLocketInfiniteLoop_defineProperty(QuestLocketInfiniteLoop_assertThisInitialized(_this), "doctorsBag",
    external_kolmafia_.Item.get("Lil' Doctor&trade; bag"));QuestLocketInfiniteLoop_defineProperty(QuestLocketInfiniteLoop_assertThisInitialized(_this), "cape",
    external_kolmafia_.Item.get("Unwrapped knock-off retro superhero cape"));QuestLocketInfiniteLoop_defineProperty(QuestLocketInfiniteLoop_assertThisInitialized(_this), "paths", void 0);return _this;}QuestLocketInfiniteLoop_createClass(QuestLocketInfiniteLoop, [{ key: "level", value:


    function level() {
      return 1;
    } }, { key: "createPaths", value:

    function createPaths(assumeUnstarted) {var _this2 = this;
      this.paths = [];

      var create = function create() {
        var res = [new PossiblePath(1).addFax(_this2.monster)];

        if (getResourcesLeft("Wish") == 0) {
          res.push(new PossiblePath(1).addConsumablePull(_this2.wish));
        }

        return res;
      };

      if (
      (0,external_kolmafia_.availableAmount)(this.pantsgiving) + (0,external_kolmafia_.availableAmount)(this.doctorsBag) ==
      0)
      {var _iterator = QuestLocketInfiniteLoop_createForOfIteratorHelper(
          create()),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var path = _step.value;
            path.add(ResourceCategory.YELLOW_RAY).addIgnored("Cosplay Saber");

            this.paths.push(path);
          }} catch (err) {_iterator.e(err);} finally {_iterator.f();}var _iterator2 = QuestLocketInfiniteLoop_createForOfIteratorHelper(

          create()),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var _path = _step2.value;
            _path.addConsumablePull(this.instantKill);

            this.paths.push(_path);
          }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}
      } else {var _iterator3 = QuestLocketInfiniteLoop_createForOfIteratorHelper(
          create()),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var _path2 = _step3.value;
            this.paths.push(_path2);
          }} catch (err) {_iterator3.e(err);} finally {_iterator3.f();}
      }
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "status", value:

    function status(path) {
      if ((0,external_kolmafia_.getProperty)("questM05Toot") != "finished") {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.haveSkill)(this.skill)) {
        return QuestStatus.COMPLETED;
      }

      if (path == null) {
        return QuestStatus.NOT_READY;
      }

      if (
      path.canUse(ResourceCategory.YELLOW_RAY) &&
      !path.getResource(ResourceCategory.YELLOW_RAY).ready())
      {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return true;
    } }, { key: "run", value:

    function run(path) {var _this3 = this;
      var outfit = new GreyOutfit();
      outfit.addWeight("init", 10);
      outfit.addWeight("ML", -1);
      outfit.hpRegenWeight = 1;
      outfit.mpRegenWeight = 1;

      if ((0,external_kolmafia_.availableAmount)(this.cape) > 0) {
        outfit.addWeight(this.cape);
      }

      if ((0,external_kolmafia_.availableAmount)(this.doctorsBag) > 0) {
        outfit.addWeight(this.doctorsBag);
      } else if ((0,external_kolmafia_.availableAmount)(this.pantsgiving) > 0) {
        outfit.addWeight(this.pantsgiving);
      } else if (path.canUse(ResourceCategory.YELLOW_RAY)) {
        path.getResource(ResourceCategory.YELLOW_RAY).prepare(outfit);
      }

      return {
        location: null,
        outfit: outfit,
        run: function run() {
          if ((0,external_kolmafia_.equippedAmount)(_this3.cape) > 0) {
            (0,external_kolmafia_.cliExecute)("retrocape heck hold"); // Make sure we try a stunner
          } else if ((0,external_kolmafia_.numericModifier)("Initiative") <= 40) {
            throw "Initiative is 40 or less, aborting to be safe as we can't be sure you'd get the jump.";
          }

          var props = new Properties_PropertyManager();
          var macro;
          var faxResource = path.getResource(ResourceCategory.FAXER);

          if (path.canUse(ResourceCategory.PULL)) {
            GreyPulls.tryPull(_this3.wish, 51000);

            if ((0,external_kolmafia_.itemAmount)(_this3.wish) == 0) {
              throw "Expected to have pulled a wish!";
            }

            GreyPulls.tryPull(_this3.instantKill, 10000);

            if ((0,external_kolmafia_.itemAmount)(_this3.instantKill) == 0) {
              throw "Expected to have pulled an instant kill source!";
            }

            path.addUsed(ResourceCategory.PULL);
            path.addUsed(ResourceCategory.PULL);
            faxResource = ResourceTypes_getResources().find(function (r) {return r.resource == "Wish";});
          }

          if ((0,external_kolmafia_.equippedAmount)(_this3.doctorsBag) > 0) {
            macro = Macro.skill(external_kolmafia_.Skill.get("Chest X-Ray"));
          } else if ((0,external_kolmafia_.equippedAmount)(_this3.pantsgiving) > 0) {
            macro = Macro.skill(external_kolmafia_.Skill.get("Talk about politics"));
          } else {
            var yrResource = path.getResource(ResourceCategory.YELLOW_RAY);

            if (faxResource != null) {
              yrResource.prepare(null, props);
              macro = yrResource.macro();
            } else {
              macro = Macro.item(_this3.instantKill);
            }
          }

          faxResource.fax(_this3.monster);

          macro.submit();

          if ((0,external_kolmafia_.handlingChoice)() || (0,external_kolmafia_.currentRound)() != 0) {
            throw "We're supposed to be done with this infinite loop fight!";
          }

          if (!(0,external_kolmafia_.haveSkill)(_this3.skill)) {
            throw "Expected to have Infinite Loop skill!";
          }

          if (
          path.canUse(ResourceCategory.YELLOW_RAY) && (
          (0,external_kolmafia_.equippedAmount)(_this3.doctorsBag) > 0 ||
          (0,external_kolmafia_.equippedAmount)(_this3.pantsgiving) > 0))
          {
            (0,external_kolmafia_.print)(
            "The following error about a YR not being used can be ignored, this is because the script found an alternative.",
            "blue");

          }
        }
      };
    } }, { key: "getId", value:

    function getId() {
      return "CombatLocket / InfiniteLoop";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestLocketInfiniteLoop;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/skills/QuestMPRegen.ts
function QuestMPRegen_typeof(obj) {"@babel/helpers - typeof";return QuestMPRegen_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestMPRegen_typeof(obj);}function QuestMPRegen_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestMPRegen_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestMPRegen_toPropertyKey(descriptor.key), descriptor);}}function QuestMPRegen_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestMPRegen_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestMPRegen_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestMPRegen_defineProperty(obj, key, value) {key = QuestMPRegen_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestMPRegen_toPropertyKey(arg) {var key = QuestMPRegen_toPrimitive(arg, "string");return QuestMPRegen_typeof(key) === "symbol" ? key : String(key);}function QuestMPRegen_toPrimitive(input, hint) {if (QuestMPRegen_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestMPRegen_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}








var QuestMPRegen = /*#__PURE__*/function () {function QuestMPRegen() {QuestMPRegen_classCallCheck(this, QuestMPRegen);QuestMPRegen_defineProperty(this, "realDung",
    external_kolmafia_.Location.get("The Dungeons of Doom"));QuestMPRegen_defineProperty(this, "none",
    external_kolmafia_.Item.none);QuestMPRegen_defineProperty(this, "deadMimic",
    external_kolmafia_.Item.get("dead mimic"));QuestMPRegen_defineProperty(this, "skill",
    external_kolmafia_.Skill.get("Hivemindedness"));QuestMPRegen_defineProperty(this, "plusSign",
    external_kolmafia_.Item.get("plus sign"));QuestMPRegen_defineProperty(this, "mindflayer",
    external_kolmafia_.Monster.get("Mind flayer"));}QuestMPRegen_createClass(QuestMPRegen, [{ key: "getId", value:

    function getId() {
      return "Skills / MPRegen";
    } }, { key: "level", value:

    function level() {
      return 8;
    } }, { key: "shouldHaveWand", value:

    function shouldHaveWand() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastZapperWand")) == (0,external_kolmafia_.myAscensions)();
    } }, { key: "getTimesZapped", value:

    function getTimesZapped() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_zapCount"));
    } }, { key: "isDoomUnlocked", value:

    function isDoomUnlocked() {
      return (
        (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastPlusSignUnlock")) == (0,external_kolmafia_.myAscensions)() &&
        (0,external_kolmafia_.availableAmount)(this.plusSign) == 0);

    } }, { key: "getWand", value:

    function getWand() {
      var wand = (0,external_kolmafia_.getZapWand)();

      if (wand == this.none) {
        return null;
      }

      return wand;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.haveSkill)(this.skill)) {
        return QuestStatus.COMPLETED;
      }

      if (!this.isDoomUnlocked()) {
        return QuestStatus.NOT_READY;
      }

      if (this.getWand() == null) {
        if ((0,external_kolmafia_.myMeat)() < 6000 || getQuestStatus("questL11Black") < 3) {
          return QuestStatus.NOT_READY;
        }

        if (!hasNonCombatSkillsReady()) {
          return QuestStatus.FASTER_LATER;
        }
      }

      return QuestStatus.READY;
    } }, { key: "hasWandExploded", value:

    function hasWandExploded() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastZapperWandExplosionDay")) == (0,external_kolmafia_.myDaycount)();
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();
      var seekingWand =
      GreySettings_GreySettings.greyGrabZapWand &&
      this.getWand() == null &&
      (0,external_kolmafia_.myMeat)() >= 5000;

      if (seekingWand) {
        outfit.setNoCombat();
      } else {
        outfit.plusCombatWeight = 1;
      }

      return {
        outfit: outfit,
        location: this.realDung,
        orbs: [this.mindflayer],
        run: function run() {
          var props = new Properties_PropertyManager();

          props.setChoice(25, seekingWand ? 2 : 3);

          try {
            greyAdv(_this.realDung, outfit);
          } finally {
            props.resetAll();
          }

          if ((0,external_kolmafia_.availableAmount)(_this.deadMimic) > 0) {
            (0,external_kolmafia_.use)(_this.deadMimic);

            if (_this.getWand() == null) {
              (0,external_kolmafia_.print)(
              "Something has gone wrong. We used a dead mimic but didn't get a wand.");

            }
          }
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.realDung];
    } }]);return QuestMPRegen;}();
;// CONCATENATED MODULE: ./src/quests/skills/QuestSkillAbstract.ts
function QuestSkillAbstract_typeof(obj) {"@babel/helpers - typeof";return QuestSkillAbstract_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestSkillAbstract_typeof(obj);}function QuestSkillAbstract_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestSkillAbstract_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestSkillAbstract_toPropertyKey(descriptor.key), descriptor);}}function QuestSkillAbstract_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestSkillAbstract_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestSkillAbstract_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestSkillAbstract_defineProperty(obj, key, value) {key = QuestSkillAbstract_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestSkillAbstract_toPropertyKey(arg) {var key = QuestSkillAbstract_toPrimitive(arg, "string");return QuestSkillAbstract_typeof(key) === "symbol" ? key : String(key);}function QuestSkillAbstract_toPrimitive(input, hint) {if (QuestSkillAbstract_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestSkillAbstract_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestSkillAbstract = /*#__PURE__*/function () {







  function QuestSkillAbstract(
  level,
  location,
  monster,
  skill,
  questName,
  valid)
  {QuestSkillAbstract_classCallCheck(this, QuestSkillAbstract);QuestSkillAbstract_defineProperty(this, "requiredLevel", void 0);QuestSkillAbstract_defineProperty(this, "location", void 0);QuestSkillAbstract_defineProperty(this, "monster", void 0);QuestSkillAbstract_defineProperty(this, "skill", void 0);QuestSkillAbstract_defineProperty(this, "questName", void 0);QuestSkillAbstract_defineProperty(this, "valid", void 0);
    this.requiredLevel = level;
    this.location = location;
    this.monster = monster;
    this.skill = skill;
    this.questName = questName;
    this.valid = valid;
  }QuestSkillAbstract_createClass(QuestSkillAbstract, [{ key: "getId", value:

    function getId() {
      return this.questName;
    } }, { key: "level", value:

    function level() {
      return this.requiredLevel;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.haveSkill)(this.skill)) {
        return QuestStatus.COMPLETED;
      }

      if (!canGreyAdventure(this.location)) {
        return QuestStatus.NOT_READY;
      }

      if (this.valid != null && !this.valid()) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();

      if (this.location.combatPercent < 100) {
        outfit.setPlusCombat();
      }

      return {
        location: this.location,
        outfit: outfit,
        orbs: [this.monster],
        run: function run() {
          var settings = new AdventureSettings();
          settings.addNoBanish(_this.monster);

          greyAdv(_this.location, outfit, settings);
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.location];
    } }]);return QuestSkillAbstract;}();
;// CONCATENATED MODULE: ./src/quests/skills/QuestSkillColdDamage.ts
function QuestSkillColdDamage_typeof(obj) {"@babel/helpers - typeof";return QuestSkillColdDamage_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestSkillColdDamage_typeof(obj);}function QuestSkillColdDamage_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestSkillColdDamage_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestSkillColdDamage_toPropertyKey(descriptor.key), descriptor);}}function QuestSkillColdDamage_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestSkillColdDamage_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestSkillColdDamage_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestSkillColdDamage_defineProperty(obj, key, value) {key = QuestSkillColdDamage_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestSkillColdDamage_toPropertyKey(arg) {var key = QuestSkillColdDamage_toPrimitive(arg, "string");return QuestSkillColdDamage_typeof(key) === "symbol" ? key : String(key);}function QuestSkillColdDamage_toPrimitive(input, hint) {if (QuestSkillColdDamage_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestSkillColdDamage_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestSkillColdDamage15 = /*#__PURE__*/function () {function QuestSkillColdDamage15() {QuestSkillColdDamage_classCallCheck(this, QuestSkillColdDamage15);QuestSkillColdDamage_defineProperty(this, "skill",
    external_kolmafia_.Skill.get("Snow-Cooling System"));QuestSkillColdDamage_defineProperty(this, "monster",
    external_kolmafia_.Monster.get("Snow Queen"));QuestSkillColdDamage_defineProperty(this, "location",
    external_kolmafia_.Location.get("The Icy Peak"));}QuestSkillColdDamage_createClass(QuestSkillColdDamage15, [{ key: "getId", value:

    function getId() {
      return "Skills / ColdDamage15";
    } }, { key: "level", value:

    function level() {
      return 10;
    } }, { key: "status", value:

    function status() {
      if (
      (0,external_kolmafia_.haveSkill)(this.skill) ||
      getQuestStatus("questL09Topping") > 0 ||
      !GreySettings_GreySettings.isHardcoreMode())
      {
        return QuestStatus.COMPLETED;
      }

      if (
      (0,external_kolmafia_.getProperty)("questL08Trapper") != "finished" ||
      !canGreyAdventure(this.location))
      {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      return {
        location: this.location,
        orbs: [this.monster],
        run: function run() {
          var settings = new AdventureSettings().addNoBanish(_this.monster);

          greyAdv(_this.location, null, settings);
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.location];
    } }]);return QuestSkillColdDamage15;}();


var QuestSkillColdDamage10 = /*#__PURE__*/function () {function QuestSkillColdDamage10() {QuestSkillColdDamage_classCallCheck(this, QuestSkillColdDamage10);QuestSkillColdDamage_defineProperty(this, "skill",
    external_kolmafia_.Skill.get("Cooling Tubules"));QuestSkillColdDamage_defineProperty(this, "monster",
    external_kolmafia_.Monster.get("Ninja Snowman Weaponmaster"));QuestSkillColdDamage_defineProperty(this, "location",
    external_kolmafia_.Location.get("Lair of the Ninja Snowmen"));}QuestSkillColdDamage_createClass(QuestSkillColdDamage10, [{ key: "getId", value:

    function getId() {
      return "Skills / ColdDamage10";
    } }, { key: "level", value:

    function level() {
      return 10;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.haveSkill)(this.skill) || getQuestStatus("questL09Topping") > 0) {
        return QuestStatus.COMPLETED;
      }

      if (
      getQuestStatus("questL08Trapper") < 3 ||
      !canGreyAdventure(this.location) ||
      !GreySettings_GreySettings.isHardcoreMode())
      {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this2 = this;
      return {
        location: this.location,
        run: function run() {
          var settings = new AdventureSettings().addNoBanish(_this2.monster);

          greyAdv(_this2.location, null, settings);
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.location];
    } }]);return QuestSkillColdDamage10;}();
;// CONCATENATED MODULE: ./src/quests/skills/QuestSkillConiferPolymers.ts
function QuestSkillConiferPolymers_typeof(obj) {"@babel/helpers - typeof";return QuestSkillConiferPolymers_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestSkillConiferPolymers_typeof(obj);}function QuestSkillConiferPolymers_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestSkillConiferPolymers_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestSkillConiferPolymers_toPropertyKey(descriptor.key), descriptor);}}function QuestSkillConiferPolymers_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestSkillConiferPolymers_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestSkillConiferPolymers_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestSkillConiferPolymers_defineProperty(obj, key, value) {key = QuestSkillConiferPolymers_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestSkillConiferPolymers_toPropertyKey(arg) {var key = QuestSkillConiferPolymers_toPrimitive(arg, "string");return QuestSkillConiferPolymers_typeof(key) === "symbol" ? key : String(key);}function QuestSkillConiferPolymers_toPrimitive(input, hint) {if (QuestSkillConiferPolymers_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestSkillConiferPolymers_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestSkillConiferPolymers = /*#__PURE__*/function () {function QuestSkillConiferPolymers() {QuestSkillConiferPolymers_classCallCheck(this, QuestSkillConiferPolymers);QuestSkillConiferPolymers_defineProperty(this, "location",
    external_kolmafia_.Location.get("The Bat Hole Entrance"));QuestSkillConiferPolymers_defineProperty(this, "monster",
    external_kolmafia_.Monster.get("Pine Bat"));QuestSkillConiferPolymers_defineProperty(this, "skill",
    external_kolmafia_.Skill.get("Conifer Polymers"));QuestSkillConiferPolymers_defineProperty(this, "hasRes",
    false);QuestSkillConiferPolymers_defineProperty(this, "nextCheck",
    0);}QuestSkillConiferPolymers_createClass(QuestSkillConiferPolymers, [{ key: "getId", value:

    function getId() {
      return "Skills / Conifer Polymers";
    } }, { key: "level", value:

    function level() {
      return 7;
    } }, { key: "status", value:

    function status() {
      if (this.hasRes || (0,external_kolmafia_.haveSkill)(this.skill)) {
        return QuestStatus.COMPLETED;
      }

      if (getQuestStatus("questM20Necklace") > 0) {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.turnsPlayed)() >= this.nextCheck) {
        this.nextCheck = (0,external_kolmafia_.turnsPlayed)() + 5;
        (0,external_kolmafia_.maximize)("stench res -tie", true);
        this.hasRes =
        (0,external_kolmafia_.numericModifier)("Generated:_spec", "Stench Resistance") >= 4;
      }

      if (getQuestStatus("questL09Topping") < 1) {
        return QuestStatus.NOT_READY;
      }

      if (!canGreyAdventure(this.location)) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();

      if (this.location.combatPercent < 100) {
        outfit.setPlusCombat();
      }

      return {
        location: this.location,
        outfit: outfit,
        orbs: [this.monster],
        run: function run() {
          var settings = new AdventureSettings();
          settings.addNoBanish(_this.monster);

          greyAdv(_this.location, outfit, settings);
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.location];
    } }]);return QuestSkillConiferPolymers;}();
;// CONCATENATED MODULE: ./src/quests/skills/QuestSkillDoubleNanovision.ts
function QuestSkillDoubleNanovision_typeof(obj) {"@babel/helpers - typeof";return QuestSkillDoubleNanovision_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestSkillDoubleNanovision_typeof(obj);}function QuestSkillDoubleNanovision_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestSkillDoubleNanovision_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestSkillDoubleNanovision_toPropertyKey(descriptor.key), descriptor);}}function QuestSkillDoubleNanovision_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestSkillDoubleNanovision_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestSkillDoubleNanovision_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestSkillDoubleNanovision_defineProperty(obj, key, value) {key = QuestSkillDoubleNanovision_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestSkillDoubleNanovision_toPropertyKey(arg) {var key = QuestSkillDoubleNanovision_toPrimitive(arg, "string");return QuestSkillDoubleNanovision_typeof(key) === "symbol" ? key : String(key);}function QuestSkillDoubleNanovision_toPrimitive(input, hint) {if (QuestSkillDoubleNanovision_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestSkillDoubleNanovision_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}




var QuestSkillDoubleNanovision = /*#__PURE__*/function () {function QuestSkillDoubleNanovision() {QuestSkillDoubleNanovision_classCallCheck(this, QuestSkillDoubleNanovision);QuestSkillDoubleNanovision_defineProperty(this, "bowling",
    external_kolmafia_.Location.get("The Hidden Bowling Alley"));QuestSkillDoubleNanovision_defineProperty(this, "skill",
    external_kolmafia_.Skill.get("Double Nanovision"));QuestSkillDoubleNanovision_defineProperty(this, "ball",
    external_kolmafia_.Item.get("Bowling Ball"));QuestSkillDoubleNanovision_defineProperty(this, "drunk",
    external_kolmafia_.Monster.get("Drunk pygmy"));}QuestSkillDoubleNanovision_createClass(QuestSkillDoubleNanovision, [{ key: "getId", value:

    function getId() {
      return "Skills / DoubleNanovision";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.haveSkill)(this.skill)) {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.getProperty)("questL11Spare") != "finished") {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.isBanished)(this.drunk)) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      return {
        location: this.bowling,
        orbs: [this.drunk],
        run: function run() {
          if ((0,external_kolmafia_.itemAmount)(_this.ball) > 0) {
            (0,external_kolmafia_.putCloset)(_this.ball, (0,external_kolmafia_.itemAmount)(_this.ball));
          }

          greyAdv(_this.bowling);
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.bowling];
    } }]);return QuestSkillDoubleNanovision;}();
;// CONCATENATED MODULE: ./src/quests/skills/QuestSkillSystemSweep.ts
function QuestSkillSystemSweep_typeof(obj) {"@babel/helpers - typeof";return QuestSkillSystemSweep_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestSkillSystemSweep_typeof(obj);}function QuestSkillSystemSweep_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestSkillSystemSweep_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestSkillSystemSweep_toPropertyKey(descriptor.key), descriptor);}}function QuestSkillSystemSweep_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestSkillSystemSweep_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestSkillSystemSweep_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestSkillSystemSweep_defineProperty(obj, key, value) {key = QuestSkillSystemSweep_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestSkillSystemSweep_toPropertyKey(arg) {var key = QuestSkillSystemSweep_toPrimitive(arg, "string");return QuestSkillSystemSweep_typeof(key) === "symbol" ? key : String(key);}function QuestSkillSystemSweep_toPrimitive(input, hint) {if (QuestSkillSystemSweep_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestSkillSystemSweep_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}





var QuestSkillSystemSweep = /*#__PURE__*/function () {function QuestSkillSystemSweep() {QuestSkillSystemSweep_classCallCheck(this, QuestSkillSystemSweep);QuestSkillSystemSweep_defineProperty(this, "park",
    external_kolmafia_.Location.get("The Hidden Park"));QuestSkillSystemSweep_defineProperty(this, "skill",
    external_kolmafia_.Skill.get("System Sweep"));QuestSkillSystemSweep_defineProperty(this, "sword",
    external_kolmafia_.Item.get("Antique Machete"));QuestSkillSystemSweep_defineProperty(this, "nanovision",
    external_kolmafia_.Skill.get("Double Nanovision"));QuestSkillSystemSweep_defineProperty(this, "book",
    external_kolmafia_.Item.get("Book of matches"));QuestSkillSystemSweep_defineProperty(this, "monster",
    external_kolmafia_.Monster.get("pygmy janitor"));}QuestSkillSystemSweep_createClass(QuestSkillSystemSweep, [{ key: "getId", value:
    function getId() {
      return "Skills / System Sweep";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.haveSkill)(this.skill)) {
        return QuestStatus.COMPLETED;
      }

      if (!this.hasRelocated() || (0,external_kolmafia_.availableAmount)(this.sword) == 0) {
        return QuestStatus.NOT_READY;
      }

      if (!(0,external_kolmafia_.haveSkill)(this.nanovision) && this.wantBook()) {
        return QuestStatus.FASTER_LATER;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();
      outfit.setPlusCombat().setItemDrops();

      return {
        location: this.park,
        outfit: outfit,
        orbs: [this.monster],
        run: function run() {
          greyAdv(_this.park, outfit);
        }
      };
    } }, { key: "hasRelocated", value:

    function hasRelocated() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("relocatePygmyJanitor")) == (0,external_kolmafia_.myAscensions)();
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "wantBook", value:

    function wantBook() {
      if (
      (0,external_kolmafia_.availableAmount)(this.book) > 0 ||
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("hiddenTavernUnlock")) == (0,external_kolmafia_.myAscensions)() ||
      (0,external_kolmafia_.getProperty)("questL11Spare") == "finished")
      {
        return false;
      }

      return true;
    } }]);return QuestSkillSystemSweep;}();
;// CONCATENATED MODULE: ./src/quests/skills/QuestSkillRegistry.ts
function QuestSkillRegistry_typeof(obj) {"@babel/helpers - typeof";return QuestSkillRegistry_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestSkillRegistry_typeof(obj);}function QuestSkillRegistry_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestSkillRegistry_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestSkillRegistry_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestSkillRegistry_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestSkillRegistry_arrayLikeToArray(o, minLen);}function QuestSkillRegistry_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestSkillRegistry_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestSkillRegistry_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestSkillRegistry_toPropertyKey(descriptor.key), descriptor);}}function QuestSkillRegistry_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestSkillRegistry_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestSkillRegistry_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestSkillRegistry_defineProperty(obj, key, value) {key = QuestSkillRegistry_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestSkillRegistry_toPropertyKey(arg) {var key = QuestSkillRegistry_toPrimitive(arg, "string");return QuestSkillRegistry_typeof(key) === "symbol" ? key : String(key);}function QuestSkillRegistry_toPrimitive(input, hint) {if (QuestSkillRegistry_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestSkillRegistry_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}











var QuestSkillRegistry = /*#__PURE__*/function () {


  function QuestSkillRegistry() {QuestSkillRegistry_classCallCheck(this, QuestSkillRegistry);QuestSkillRegistry_defineProperty(this, "children", []);
    /*
    | "Skills / MPRegen"
    | "Skills / HPRegen"
    | "Skills / ScalingItem"
    | "Skills / ScalingDR"
    | "Skills / InfiniteLoop"
    | "Skills / Shroud"
    | "Skills / Hoonk"
    | "Skills / PhaseShift"
    | "Skills / ConiferPolymers";
    */

    this.addSkill("Skills / Phase Shift");
    this.addSkill(
    "Skills / Photonic Shroud",
    function () {return getQuestStatus("questL11Black") > 1;});

    this.addSkill(
    "Skills / Piezoelectric Honk",
    function () {return getQuestStatus("questL11Palindome") > 4;});

    this.addSkill(
    "Skills / ScalingItem",
    null,
    external_kolmafia_.Skill.get("Gravitational Compression"));

    this.addSkill(
    "Skills / HPRegen",
    null,
    external_kolmafia_.Skill.get("Fluid Dynamics Simulation"));

    this.addSkill(
    "Skills / ScalingDR",
    function () {return getQuestStatus("questM20Necklace") > 2;},
    external_kolmafia_.Skill.get("Subatomic Hardening"));

    this.addSkill("Skills / ScalingMeat", null, external_kolmafia_.Skill.get("Ponzi Apparatus"));

    this.children.push(new QuestMPRegen());
    this.children.push(new QuestSkillSystemSweep());
    this.children.push(
    new QuestSkillAbstract(
    11,
    external_kolmafia_.Location.get("The Hidden Park"),
    external_kolmafia_.Monster.get("pygmy witch lawyer"),
    external_kolmafia_.Skill.get("Infinite Loop"),
    "Skills / Infinite Loop",
    function () {return (
        (0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("Antique Machete")) > 0 &&
        (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("relocatePygmyJanitor")) == (0,external_kolmafia_.myAscensions)());}));


    this.children.push(new QuestSkillColdDamage15());
    this.children.push(new QuestSkillColdDamage10());
    this.children.push(new QuestSkillDoubleNanovision());
    this.children.push(new QuestSkillConiferPolymers());
  }QuestSkillRegistry_createClass(QuestSkillRegistry, [{ key: "addSkill", value:

    function addSkill(questType, valid, skill) {
      if (skill == null) {
        skill = external_kolmafia_.Skill.get(
        questType.substring(questType.lastIndexOf("/") + 1).trim());

      }

      if (skill == external_kolmafia_.Skill.none) {
        throw "There's no skill found for " + questType;
      }

      if ((0,external_kolmafia_.haveSkill)(skill)) {
        return;
      }

      var location;
      var monster;var _iterator = QuestSkillRegistry_createForOfIteratorHelper(

        GreyAbsorber_AbsorbsProvider.loadAbsorbs()),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var absorb = _step.value;
          if (absorb.skill != skill) {
            continue;
          }

          var locs = getLocations(absorb.monster);

          if (locs.length != 1) {
            throw (
              "Expected to find only one location, instead received multiple when trying to handle " +
              questType);

          }

          location = locs[0];
          monster = absorb.monster;
          break;
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

      if (location == null) {
        throw (
          "No location / monster found for the skill " +
          skill.name +
          " and type " +
          questType);

      }

      var level = Math.max(5, Math.sqrt(location.recommendedStat) * 1.35);

      this.children.push(
      new QuestSkillAbstract(level, location, monster, skill, questType, valid));

    } }, { key: "getId", value:

    function getId() {
      return "Skills / Parent";
    } }, { key: "level", value:

    function level() {
      return -1;
    } }, { key: "status", value:

    function status() {
      return QuestStatus.COMPLETED;
    } }, { key: "run", value:

    function run() {
      throw new Error("Method not implemented.");
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "getChildren", value:

    function getChildren() {
      return this.children;
    } }]);return QuestSkillRegistry;}();
;// CONCATENATED MODULE: ./src/quests/absorbs/QuestAbsorbGnomads.ts
function QuestAbsorbGnomads_typeof(obj) {"@babel/helpers - typeof";return QuestAbsorbGnomads_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestAbsorbGnomads_typeof(obj);}function QuestAbsorbGnomads_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestAbsorbGnomads_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestAbsorbGnomads_toPropertyKey(descriptor.key), descriptor);}}function QuestAbsorbGnomads_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestAbsorbGnomads_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestAbsorbGnomads_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestAbsorbGnomads_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestAbsorbGnomads_setPrototypeOf(subClass, superClass);}function QuestAbsorbGnomads_setPrototypeOf(o, p) {QuestAbsorbGnomads_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestAbsorbGnomads_setPrototypeOf(o, p);}function QuestAbsorbGnomads_createSuper(Derived) {var hasNativeReflectConstruct = QuestAbsorbGnomads_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestAbsorbGnomads_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestAbsorbGnomads_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestAbsorbGnomads_possibleConstructorReturn(this, result);};}function QuestAbsorbGnomads_possibleConstructorReturn(self, call) {if (call && (QuestAbsorbGnomads_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestAbsorbGnomads_assertThisInitialized(self);}function QuestAbsorbGnomads_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestAbsorbGnomads_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestAbsorbGnomads_getPrototypeOf(o) {QuestAbsorbGnomads_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestAbsorbGnomads_getPrototypeOf(o);}function QuestAbsorbGnomads_defineProperty(obj, key, value) {key = QuestAbsorbGnomads_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestAbsorbGnomads_toPropertyKey(arg) {var key = QuestAbsorbGnomads_toPrimitive(arg, "string");return QuestAbsorbGnomads_typeof(key) === "symbol" ? key : String(key);}function QuestAbsorbGnomads_toPrimitive(input, hint) {if (QuestAbsorbGnomads_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestAbsorbGnomads_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}




var QuestAbsorbGnomads = /*#__PURE__*/function (_QuestMoonSignAbsorb) {QuestAbsorbGnomads_inherits(QuestAbsorbGnomads, _QuestMoonSignAbsorb);var _super = QuestAbsorbGnomads_createSuper(QuestAbsorbGnomads);function QuestAbsorbGnomads() {var _this;QuestAbsorbGnomads_classCallCheck(this, QuestAbsorbGnomads);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestAbsorbGnomads_defineProperty(QuestAbsorbGnomads_assertThisInitialized(_this), "location",
    external_kolmafia_.Location.get("Thugnderdome"));QuestAbsorbGnomads_defineProperty(QuestAbsorbGnomads_assertThisInitialized(_this), "monster",
    external_kolmafia_.Monster.get("Vicious gnauga"));QuestAbsorbGnomads_defineProperty(QuestAbsorbGnomads_assertThisInitialized(_this), "moonZone",
    "Gnomad");return _this;}QuestAbsorbGnomads_createClass(QuestAbsorbGnomads, [{ key: "getId", value:

    function getId() {
      return "Absorbs / Gnomads";
    } }]);return QuestAbsorbGnomads;}(QuestMoonSignAbsorb);
;// CONCATENATED MODULE: ./src/quests/absorbs/QuestL11PalinAbsorbs.ts
function QuestL11PalinAbsorbs_typeof(obj) {"@babel/helpers - typeof";return QuestL11PalinAbsorbs_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestL11PalinAbsorbs_typeof(obj);}function QuestL11PalinAbsorbs_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestL11PalinAbsorbs_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestL11PalinAbsorbs_toPropertyKey(descriptor.key), descriptor);}}function QuestL11PalinAbsorbs_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestL11PalinAbsorbs_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestL11PalinAbsorbs_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestL11PalinAbsorbs_defineProperty(obj, key, value) {key = QuestL11PalinAbsorbs_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestL11PalinAbsorbs_toPropertyKey(arg) {var key = QuestL11PalinAbsorbs_toPrimitive(arg, "string");return QuestL11PalinAbsorbs_typeof(key) === "symbol" ? key : String(key);}function QuestL11PalinAbsorbs_toPrimitive(input, hint) {if (QuestL11PalinAbsorbs_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestL11PalinAbsorbs_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}








var QuestL11PalinAbsorbs = /*#__PURE__*/function () {function QuestL11PalinAbsorbs() {QuestL11PalinAbsorbs_classCallCheck(this, QuestL11PalinAbsorbs);QuestL11PalinAbsorbs_defineProperty(this, "talisman",
    external_kolmafia_.Item.get("Talisman o' Namsilat"));QuestL11PalinAbsorbs_defineProperty(this, "palindome",
    external_kolmafia_.Location.get("Inside the Palindome"));QuestL11PalinAbsorbs_defineProperty(this, "toAbsorb", void 0);QuestL11PalinAbsorbs_defineProperty(this, "goose",

    external_kolmafia_.Familiar.get("Grey Goose"));}QuestL11PalinAbsorbs_createClass(QuestL11PalinAbsorbs, [{ key: "getId", value:

    function getId() {
      return "Absorbs / Palin";
    } }, { key: "level", value:

    function level() {
      return 11;
    } }, { key: "status", value:

    function status() {
      if (
      GreySettings_GreySettings.greySkipPalindome ||
      getAbsorbedAdventuresRemaining() <= 0)
      {
        return QuestStatus.COMPLETED;
      }

      var status = getQuestStatus("questL11Palindome");

      if (status < 100 || (0,external_kolmafia_.familiarWeight)(this.goose) < 6) {
        return QuestStatus.NOT_READY;
      }

      if (this.toAbsorb.length == 0) {
        return QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();
      outfit.addWeight(this.talisman);

      return {
        location: this.palindome,
        outfit: outfit,
        run: function run() {
          var props = new Properties_PropertyManager();
          props.setChoice(127, 1);
          props.setChoice(126, 1);
          props.setChoice(180, 2);
          props.setChoice(2, 2);

          try {
            greyAdv(_this.palindome, outfit);
          } finally {
            props.resetAll();
          }
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.palindome];
    } }]);return QuestL11PalinAbsorbs;}();
;// CONCATENATED MODULE: ./src/quests/absorbs/QuestAbsorbIrateMariachi.ts
function QuestAbsorbIrateMariachi_typeof(obj) {"@babel/helpers - typeof";return QuestAbsorbIrateMariachi_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestAbsorbIrateMariachi_typeof(obj);}function QuestAbsorbIrateMariachi_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestAbsorbIrateMariachi_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestAbsorbIrateMariachi_toPropertyKey(descriptor.key), descriptor);}}function QuestAbsorbIrateMariachi_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestAbsorbIrateMariachi_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestAbsorbIrateMariachi_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestAbsorbIrateMariachi_inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });Object.defineProperty(subClass, "prototype", { writable: false });if (superClass) QuestAbsorbIrateMariachi_setPrototypeOf(subClass, superClass);}function QuestAbsorbIrateMariachi_setPrototypeOf(o, p) {QuestAbsorbIrateMariachi_setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return QuestAbsorbIrateMariachi_setPrototypeOf(o, p);}function QuestAbsorbIrateMariachi_createSuper(Derived) {var hasNativeReflectConstruct = QuestAbsorbIrateMariachi_isNativeReflectConstruct();return function _createSuperInternal() {var Super = QuestAbsorbIrateMariachi_getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = QuestAbsorbIrateMariachi_getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return QuestAbsorbIrateMariachi_possibleConstructorReturn(this, result);};}function QuestAbsorbIrateMariachi_possibleConstructorReturn(self, call) {if (call && (QuestAbsorbIrateMariachi_typeof(call) === "object" || typeof call === "function")) {return call;} else if (call !== void 0) {throw new TypeError("Derived constructors may only return object or undefined");}return QuestAbsorbIrateMariachi_assertThisInitialized(self);}function QuestAbsorbIrateMariachi_assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function QuestAbsorbIrateMariachi_isNativeReflectConstruct() {if (typeof Reflect === "undefined" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === "function") return true;try {Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));return true;} catch (e) {return false;}}function QuestAbsorbIrateMariachi_getPrototypeOf(o) {QuestAbsorbIrateMariachi_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return QuestAbsorbIrateMariachi_getPrototypeOf(o);}function QuestAbsorbIrateMariachi_defineProperty(obj, key, value) {key = QuestAbsorbIrateMariachi_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestAbsorbIrateMariachi_toPropertyKey(arg) {var key = QuestAbsorbIrateMariachi_toPrimitive(arg, "string");return QuestAbsorbIrateMariachi_typeof(key) === "symbol" ? key : String(key);}function QuestAbsorbIrateMariachi_toPrimitive(input, hint) {if (QuestAbsorbIrateMariachi_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestAbsorbIrateMariachi_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}











var QuestAbsorbIrateMariachi = /*#__PURE__*/function (_TaskInfo) {QuestAbsorbIrateMariachi_inherits(QuestAbsorbIrateMariachi, _TaskInfo);var _super = QuestAbsorbIrateMariachi_createSuper(QuestAbsorbIrateMariachi);function QuestAbsorbIrateMariachi() {var _this;QuestAbsorbIrateMariachi_classCallCheck(this, QuestAbsorbIrateMariachi);for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}_this = _super.call.apply(_super, [this].concat(args));QuestAbsorbIrateMariachi_defineProperty(QuestAbsorbIrateMariachi_assertThisInitialized(_this), "irateMariachi",
    external_kolmafia_.Monster.get("Irate Mariachi"));QuestAbsorbIrateMariachi_defineProperty(QuestAbsorbIrateMariachi_assertThisInitialized(_this), "familiar",
    external_kolmafia_.Familiar.get("Grey Goose"));QuestAbsorbIrateMariachi_defineProperty(QuestAbsorbIrateMariachi_assertThisInitialized(_this), "avoid",
    new PossiblePath(10));QuestAbsorbIrateMariachi_defineProperty(QuestAbsorbIrateMariachi_assertThisInitialized(_this), "manual",
    new PossiblePath(0));QuestAbsorbIrateMariachi_defineProperty(QuestAbsorbIrateMariachi_assertThisInitialized(_this), "paths", void 0);QuestAbsorbIrateMariachi_defineProperty(QuestAbsorbIrateMariachi_assertThisInitialized(_this), "combatSkill",

    external_kolmafia_.Skill.get("Piezoelectric Honk"));QuestAbsorbIrateMariachi_defineProperty(QuestAbsorbIrateMariachi_assertThisInitialized(_this), "ncItems",
    [
    "Silent beret",
    "Xiblaxian stealth cowl",
    "protonic accelerator pack"].
    map(function (s) {return external_kolmafia_.Item.get(s);}));QuestAbsorbIrateMariachi_defineProperty(QuestAbsorbIrateMariachi_assertThisInitialized(_this), "combatHat",
    external_kolmafia_.Item.get("sombrero-mounted sparkler"));QuestAbsorbIrateMariachi_defineProperty(QuestAbsorbIrateMariachi_assertThisInitialized(_this), "player",
    external_kolmafia_.Item.get("portable cassette player"));QuestAbsorbIrateMariachi_defineProperty(QuestAbsorbIrateMariachi_assertThisInitialized(_this), "thermal",
    external_kolmafia_.Item.get("thermal blanket"));QuestAbsorbIrateMariachi_defineProperty(QuestAbsorbIrateMariachi_assertThisInitialized(_this), "shirt",
    external_kolmafia_.Item.get("&quot;Remember the Trees&quot; Shirt"));QuestAbsorbIrateMariachi_defineProperty(QuestAbsorbIrateMariachi_assertThisInitialized(_this), "loc",
    external_kolmafia_.Location.get("South of The Border"));QuestAbsorbIrateMariachi_defineProperty(QuestAbsorbIrateMariachi_assertThisInitialized(_this), "ball",
    external_kolmafia_.Item.get("miniature crystal ball"));QuestAbsorbIrateMariachi_defineProperty(QuestAbsorbIrateMariachi_assertThisInitialized(_this), "toAbsorb", void 0);return _this;}QuestAbsorbIrateMariachi_createClass(QuestAbsorbIrateMariachi, [{ key: "createPaths", value:


    function createPaths(assumeUnstarted) {
      this.paths = [];
      this.paths.push(new PossiblePath(1).addFax(this.irateMariachi));
      this.paths.push(this.avoid);

      if (
      this.getExpectedTurns(this.getPossibleCombats(false, assumeUnstarted)) <
      10)
      {
        this.paths.push(this.manual);
      }
    } }, { key: "getExpectedTurns", value:

    function getExpectedTurns(combatRate) {
      // Base combat rate is 50
      var monsters = 5;
      var hasOrb = (0,external_kolmafia_.availableAmount)(this.ball) > 0;

      // We're starting off by assuming we have no banishes, cos I'm lazy
      var turns = monsters;

      if (hasOrb) {
        turns /= 2;
      }

      // Now we add the combat rate. Default is 50/50 chance
      // So 50 is 200% turns
      // 75 is 133% turns
      // 100 is 100% turns
      var turnsMult = 100 / (50 + combatRate);

      return Math.ceil(turns * turnsMult);
    } }, { key: "getPossibleCombats", value:

    function getPossibleCombats(
    usingWhatWeHaveNow,
    assumeUnstarted)
    {
      var combat = 10; // Start off with skill

      if (
      !usingWhatWeHaveNow &&
      !(0,external_kolmafia_.toBoolean)((0,external_kolmafia_.getProperty)("_fireworksShopHatBought")))
      {
        if (this.ncItems.find(function (i) {return (0,external_kolmafia_.availableAmount)(i) > 0;}) != null) {
          combat += 5; // We buy the hat
        }
      } else if ((0,external_kolmafia_.availableAmount)(this.combatHat) > 0) {
        combat += 5;
      }

      if (
      (0,external_kolmafia_.availableAmount)(this.thermal) > 0 ||
      !usingWhatWeHaveNow && (0,external_kolmafia_.toBoolean)((0,external_kolmafia_.getProperty)("hasMaydayContract")))
      {
        combat += 5; // Cape
      }

      if (
      usingWhatWeHaveNow ?
      (0,external_kolmafia_.availableAmount)(this.shirt) > 0 :
      !GreySettings_GreySettings.isHardcoreMode() && (
      (0,external_kolmafia_.gnomadsAvailable)() ||
      GreySettings_GreySettings.willBeAccessible("Gnomad", assumeUnstarted)))
      {
        combat += 5; // Shirt
      }

      if (
      usingWhatWeHaveNow ?
      (0,external_kolmafia_.availableAmount)(this.player) > 0 :
      !GreySettings_GreySettings.isHardcoreMode())
      {
        combat += 5; // Portable cassette player
      }

      if (combat > 25) {
        return 25 + Math.round((combat - 25) / 5);
      }

      return combat;
    } }, { key: "getPossiblePaths", value:

    function getPossiblePaths() {
      return this.paths;
    } }, { key: "getId", value:

    function getId() {
      return "Absorbs / Irate Mariachi";
    } }, { key: "level", value:

    function level() {
      return 18;
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.loc];
    } }, { key: "status", value:

    function status(path) {
      if (
      GreySettings_GreySettings.isNerfMode() ||
      GreyAbsorber_AbsorbsProvider.getReabsorbedMonsters().includes(this.irateMariachi) ||
      path == this.avoid)
      {
        return QuestStatus.COMPLETED;
      }

      if (path == null) {
        return QuestStatus.NOT_READY;
      }

      if ((0,external_kolmafia_.familiarWeight)(this.familiar) < 6) {
        return QuestStatus.NOT_READY;
      }

      if (path == this.manual) {
        if (!(0,external_kolmafia_.haveSkill)(this.combatSkill)) {
          return QuestStatus.NOT_READY;
        }

        if (hasNonCombatSkillActive()) {
          return QuestStatus.NOT_READY;
        }

        if ((0,external_kolmafia_.availableAmount)(this.ball) > 0) {
          var mon = currentPredictions().get(this.loc);

          if (mon != null && !this.toAbsorb.includes(mon)) {
            return QuestStatus.NOT_READY;
          }
        }

        var turns = this.getExpectedTurns(this.getPossibleCombats(true, false));

        if (turns > 8) {
          return QuestStatus.NOT_READY;
        }

        return QuestStatus.READY;
      }

      return QuestStatus.FASTER_LATER;
    } }, { key: "run", value:

    function run(path) {var _this2 = this;
      if (path == this.manual) {
        var outfit = new GreyOutfit().setPlusCombat().setPlusCombat();

        return {
          location: this.loc,
          outfit: outfit,
          freeRun: function freeRun(monster) {return monster != _this2.irateMariachi;},
          run: function run() {
            greyAdv(_this2.loc, outfit);
          }
        };
      }

      return this.runFax(path);
    } }, { key: "runFax", value:

    function runFax(path) {var _this3 = this;
      var resource = path.getResource(ResourceCategory.FAXER);

      return {
        location: null,
        outfit: null,
        familiar: this.familiar,
        disableFamOverride: true,
        run: function run() {
          resource.fax(_this3.irateMariachi);

          greyAdv(null);

          if ((0,external_kolmafia_.handlingChoice)() || (0,external_kolmafia_.currentRound)() != 0) {
            throw "We're supposed to be done with this fight!";
          }
        }
      };
    } }, { key: "getAbsorbs", value:

    function getAbsorbs() {
      return [this.irateMariachi];
    } }]);return QuestAbsorbIrateMariachi;}(TaskInfo);
;// CONCATENATED MODULE: ./src/quests/custom/QuestShortOrderCookLevel.ts
function QuestShortOrderCookLevel_typeof(obj) {"@babel/helpers - typeof";return QuestShortOrderCookLevel_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestShortOrderCookLevel_typeof(obj);}function QuestShortOrderCookLevel_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestShortOrderCookLevel_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestShortOrderCookLevel_toPropertyKey(descriptor.key), descriptor);}}function QuestShortOrderCookLevel_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestShortOrderCookLevel_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestShortOrderCookLevel_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestShortOrderCookLevel_defineProperty(obj, key, value) {key = QuestShortOrderCookLevel_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestShortOrderCookLevel_toPropertyKey(arg) {var key = QuestShortOrderCookLevel_toPrimitive(arg, "string");return QuestShortOrderCookLevel_typeof(key) === "symbol" ? key : String(key);}function QuestShortOrderCookLevel_toPrimitive(input, hint) {if (QuestShortOrderCookLevel_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestShortOrderCookLevel_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestShortOrderExpLevel = /*#__PURE__*/function () {function QuestShortOrderExpLevel() {QuestShortOrderCookLevel_classCallCheck(this, QuestShortOrderExpLevel);QuestShortOrderCookLevel_defineProperty(this, "cook",
    external_kolmafia_.Familiar.get("Shorter-Order Cook"));QuestShortOrderCookLevel_defineProperty(this, "goose",
    external_kolmafia_.Familiar.get("Grey Goose"));QuestShortOrderCookLevel_defineProperty(this, "warren",
    external_kolmafia_.Location.get("The Dire Warren"));QuestShortOrderCookLevel_defineProperty(this, "latte",
    external_kolmafia_.Item.get("latte lovers member's mug"));}QuestShortOrderCookLevel_createClass(QuestShortOrderExpLevel, [{ key: "getId", value:

    function getId() {
      return "Misc / Short Cook Goose";
    } }, { key: "level", value:

    function level() {
      return 1;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.getProperty)("questM05Toot") != "finished") {
        return QuestStatus.NOT_READY;
      }

      if (!(0,external_kolmafia_.haveFamiliar)(this.cook) || (0,external_kolmafia_.myLevel)() > 7) {
        return QuestStatus.COMPLETED;
      }

      if ((0,external_kolmafia_.familiarWeight)(this.goose) < 9) {
        return this.goose.experience <= 0 ?
        QuestStatus.NOT_READY :
        QuestStatus.COMPLETED;
      }

      return QuestStatus.READY;
    } }, { key: "mustBeDone", value:

    function mustBeDone(reallyMustBeDone) {
      return !reallyMustBeDone;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit();

      if ((0,external_kolmafia_.availableAmount)(this.latte) > 0 && !(0,external_kolmafia_.toBoolean)("_latteDrinkUsed")) {
        outfit.addWeight(this.latte);
      }

      outfit.famExpWeight += 5;

      return {
        location: null,
        familiar: this.goose,
        disableFamOverride: true,
        outfit: outfit,
        run: function run() {
          (0,external_kolmafia_.useFamiliar)(_this.goose);
          var macro = Macro.skill(external_kolmafia_.Skill.get("Convert Matter to Pomade"));

          if ((0,external_kolmafia_.equippedAmount)(_this.latte) > 0 && !(0,external_kolmafia_.toBoolean)("_latteDrinkUsed")) {
            macro.trySkill(external_kolmafia_.Skill.get("Gulp Latte"));
          }

          macro.attack().attack();

          greyAdv(
          _this.warren,
          outfit,
          new AdventureSettings().setFinishingBlowMacro(macro));

        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return false;
    } }]);return QuestShortOrderExpLevel;}();
;// CONCATENATED MODULE: ./src/quests/custom/QuestTotPirate.ts
function QuestTotPirate_typeof(obj) {"@babel/helpers - typeof";return QuestTotPirate_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestTotPirate_typeof(obj);}function QuestTotPirate_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestTotPirate_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestTotPirate_toPropertyKey(descriptor.key), descriptor);}}function QuestTotPirate_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestTotPirate_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestTotPirate_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestTotPirate_defineProperty(obj, key, value) {key = QuestTotPirate_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestTotPirate_toPropertyKey(arg) {var key = QuestTotPirate_toPrimitive(arg, "string");return QuestTotPirate_typeof(key) === "symbol" ? key : String(key);}function QuestTotPirate_toPrimitive(input, hint) {if (QuestTotPirate_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestTotPirate_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






var QuestTotPirate = /*#__PURE__*/function () {function QuestTotPirate() {QuestTotPirate_classCallCheck(this, QuestTotPirate);QuestTotPirate_defineProperty(this, "familiar",
    external_kolmafia_.Familiar.get("Trick-or-Treating Tot"));QuestTotPirate_defineProperty(this, "item",
    external_kolmafia_.Item.get("li'l pirate costume"));QuestTotPirate_defineProperty(this, "pirate",
    external_kolmafia_.Location.get("The Obligatory Pirate's Cove"));}QuestTotPirate_createClass(QuestTotPirate, [{ key: "getId", value:

    function getId() {
      return "Misc / Tot Pirate";
    } }, { key: "level", value:

    function level() {
      return 7;
    } }, { key: "status", value:

    function status() {
      if ((0,external_kolmafia_.getProperty)("warProgress") != "unstarted") {
        return QuestStatus.COMPLETED;
      }

      if (!(0,external_kolmafia_.haveFamiliar)(this.familiar) || (0,external_kolmafia_.availableAmount)(this.item) > 0) {
        return QuestStatus.COMPLETED;
      }

      if (!this.isIslandUnlocked() || hasNonCombatSkillActive()) {
        return QuestStatus.NOT_READY;
      }

      return QuestStatus.READY;
    } }, { key: "run", value:

    function run() {var _this = this;
      var outfit = new GreyOutfit().setPlusCombat();

      return {
        outfit: outfit,
        location: this.pirate,
        run: function run() {
          greyAdv(_this.pirate);

          if (
          (0,external_kolmafia_.lastMonster)().phylum == external_kolmafia_.Phylum.get("pirate") &&
          (0,external_kolmafia_.availableAmount)(_this.item) == 0)
          {
            throw (
              "Oh dear, we fought a pirate and expected to drop " +
              _this.item +
              " but that didn't happen.");

          }
        }
      };
    } }, { key: "getLocations", value:

    function getLocations() {
      return [this.pirate];
    } }, { key: "mustBeDone", value:

    function mustBeDone() {
      return (0,external_kolmafia_.myLevel)() == 11 && this.isIslandUnlocked();
    } }, { key: "canAcceptPrimes", value:

    function canAcceptPrimes() {
      return true;
    } }, { key: "isIslandUnlocked", value:

    function isIslandUnlocked() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastIslandUnlock")) >= (0,external_kolmafia_.myAscensions)();
    } }]);return QuestTotPirate;}();
;// CONCATENATED MODULE: ./src/quests/QuestsCustom.ts
function QuestsCustom_typeof(obj) {"@babel/helpers - typeof";return QuestsCustom_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestsCustom_typeof(obj);}function QuestsCustom_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestsCustom_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestsCustom_toPropertyKey(descriptor.key), descriptor);}}function QuestsCustom_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestsCustom_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestsCustom_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestsCustom_defineProperty(obj, key, value) {key = QuestsCustom_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestsCustom_toPropertyKey(arg) {var key = QuestsCustom_toPrimitive(arg, "string");return QuestsCustom_typeof(key) === "symbol" ? key : String(key);}function QuestsCustom_toPrimitive(input, hint) {if (QuestsCustom_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestsCustom_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}





























var QuestsCustom = /*#__PURE__*/function () {
  // This is a wrapper class around some of our custom routing goals. Like combat locket or so.



  function QuestsCustom() {QuestsCustom_classCallCheck(this, QuestsCustom);QuestsCustom_defineProperty(this, "quests", []);
    this.quests.push(new QuestInitialStart());
    this.quests.push(new QuestInitialPulls());
    this.quests.push(new QuestLocketInfiniteLoop());
    //this.quests.push(new QuestLocketSystemSweep());
    this.quests.push(new QuestGoblinTortureHarem());
    this.quests.push(new QuestGoblinTortureLab());
    this.quests.push(new QuestDungeonsOfDoom());
    this.quests.push(new QuestGetZapWand());
    this.quests.push(new QuestNPCStuff());
    this.quests.push(new QuestCustomPurchases());
    this.quests.push(new QuestGrabBoatVacation());
    this.quests.push(new QuestSkillRegistry());
    this.quests.push(new QuestFamiliarEquip());
    this.quests.push(new QuestFortuneExp());
    this.quests.push(new QuestPowerLeveling(4));
    this.quests.push(new QuestBugbearBakery());
    this.quests.push(new QuestAbsorbStarMonster());
    this.quests.push(new QuestMoonSign());
    this.quests.push(new QuestAbsorbCanadia());
    this.quests.push(new QuestAbsorbKnoll());
    this.quests.push(new QuestAbsorbGnomads());
    this.quests.push(new QuestL11PalinAbsorbs());
    this.quests.push(new QuestAbsorbIrateMariachi());
    this.quests.push(new QuestJuneCleaver());
    this.quests.push(new QuestTrapGhost());
    this.quests.push(new QuestShortOrderExpLevel());
    this.quests.push(new QuestTotPirate());
  }QuestsCustom_createClass(QuestsCustom, [{ key: "level", value:

    function level() {
      return -1;
    } }, { key: "status", value:

    function status() {
      return QuestStatus.COMPLETED;
    } }, { key: "run", value:

    function run() {
      throw new Error("Method not implemented.");
    } }, { key: "getId", value:

    function getId() {
      return "Misc / Custom";
    } }, { key: "getLocations", value:

    function getLocations() {
      return [];
    } }, { key: "getChildren", value:

    function getChildren() {
      return this.quests;
    } }]);return QuestsCustom;}();
;// CONCATENATED MODULE: ./src/quests/QuestTypes.ts
function QuestTypes_toConsumableArray(arr) {return QuestTypes_arrayWithoutHoles(arr) || QuestTypes_iterableToArray(arr) || QuestTypes_unsupportedIterableToArray(arr) || QuestTypes_nonIterableSpread();}function QuestTypes_nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function QuestTypes_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestTypes_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestTypes_arrayLikeToArray(o, minLen);}function QuestTypes_iterableToArray(iter) {if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);}function QuestTypes_arrayWithoutHoles(arr) {if (Array.isArray(arr)) return QuestTypes_arrayLikeToArray(arr);}function QuestTypes_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}var QuestToot = ["Council / Toot"];
var QuestLarva = ["Council / Larva"];
var QuestTavern = ["Council / Tavern"];
var QuestBats = [
"Council / Bats / Sonars",
"Council / Bats / UnlockLeft",
"Council / Bats / UnlockRight",
"Council / Bats / UnlockBoss",
"Council / Bats / Boss"];

var QuestGoblins = [
"Council / Goblins / Outskirts",
"Council / Goblins / HaremOutfit",
"Council / Goblins / King"];

var QuestFriars = [
"Council / Friars / Heart",
"Council / Friars / Elbow",
"Council / Friars / Neck",
"Council / Friars / TurnIn"];

var QuestCrypt = [
"Council / Crypt / Sprinters",
"Council / Crypt / Gravy Boat Pull",
"Council / Crypt / Eyes",
"Council / Crypt / Rattling",
"Council / Crypt / DirtyMan",
"Council / Crypt / Boss"];

var QuestIcePeak = [
"Council / Ice / Trapper",
"Council / Ice / Goats",
"Council / Ice / Ore",
"Council / Ice / Ninjas",
"Council / Ice / Boss"];

var QuestTriplePeaks = [
"Council / Peaks / Orcs",
"Council / Peaks / CargoShortsSmut",
"Council / Peaks / AbooPeak",
"Council / Peaks / TwinPeak",
"Council / Peaks / OilPeak",
"Council / Peaks / Lord"];

var QuestBeanStalk = [
"Council / Beanstalk / EnchantedBean",
"Council / Beanstalk / Ship",
"Council / Beanstalk / Basement",
"Council / Beanstalk / Ground",
"Council / Beanstalk / Top"];


var QuestPalin = [
"Council / MacGruffin / Palin / Book",
"Council / MacGruffin / Palin / WetStew",
"Council / MacGruffin / Palin / Boss"];

var QuestPyamid = [
"Council / MacGruffin / Pyramid / Top",
"Council / MacGruffin / Pyramid / Middle",
"Council / MacGruffin / Pyramid / Wheel",
"Council / MacGruffin / Pyramid / EdUndying"];

var QuestRon = [
"Council / MacGruffin / Ron / Crowd",
"Council / MacGruffin / Ron / Zepp",
"Council / MacGruffin / Ron / Parent"];

var QuestShen = [
"Council / MacGruffin / Shen / Meet",
"Council / MacGruffin / Shen / Bats",
"Council / MacGruffin / Shen / TurnIn",
"Council / MacGruffin / Shen / Ninjas",
"Council / MacGruffin / Shen / Giants"];

var QuestTemple = [
"Council / MacGruffin / Temple / Unlock",
"Council / MacGruffin / Temple / GrabWool",
"Council / MacGruffin / Temple / Nostril",
"Council / MacGruffin / Temple / HiddenCity"];

var QuestHiddenCity = [
"Council / MacGruffin / HiddenCity / Vines",
"Council / MacGruffin / HiddenCity / Accountants",
"Council / MacGruffin / HiddenCity / Curses",
"Council / MacGruffin / HiddenCity / Doctor",
"Council / MacGruffin / HiddenCity / Bowling",
"Council / MacGruffin / HiddenCity / BookOfMatches",
"Council / MacGruffin / HiddenCity / HiddenPark",
"Council / MacGruffin / HiddenCity / Boss"];

var QuestBlack = ["Council / MacGruffin / Black"];
var QuestDesert = [
"Council / MacGruffin / Desert / Parent",
"Council / MacGruffin / Desert / Explore",
"Council / MacGruffin / Desert / StoneRose",
"Council / MacGruffin / Desert / Gnome",
"Council / MacGruffin / Desert / Compass",
"Council / MacGruffin / Desert / WormRide"];

var QuestManorMacGruffin = [
"Council / MacGruffin / Manor / Ballroom",
"Council / MacGruffin / Manor / Recipe",
"Council / MacGruffin / Manor / Soda",
"Council / MacGruffin / Manor / Wine",
"Council / MacGruffin / Manor / Bomb",
"Council / MacGruffin / Manor / Boss"];

var QuestMacGruffin = [
"Council / MacGruffin / Vacation",
"Council / MacGruffin / Shore"].concat(
QuestPalin,
QuestPyamid,
QuestDesert,
QuestRon,
QuestShen,
QuestTemple,
QuestHiddenCity,
QuestBlack,
QuestManorMacGruffin);

var QuestIslandWarGremlins = [
"Council / War / Gremlins / Burning Barrel",
"Council / War / Gremlins / Rusted Car",
"Council / War / Gremlins / Old Tires",
"Council / War / Gremlins / Abandoned Refrigerator"];

var QuestIslandWar = [
"Council / War / Parent",
"Council / War / Frat Outfit",
"Council / War / Start",
"Council / War / Gremlins",
"Council / War / Lobsters",
"Council / War / Flyers",
"Council / War / Battlefield",
"Council / War / Filthworms",
"Council / War / Nuns",
"Council / War / Boss"].concat(
QuestIslandWarGremlins);

var QuestKeys = [
"Council / Tower / Keys / Heroes",
"Council / Tower / Keys / Heroes / DailyDungeon",
"Council / Tower / Keys / Heroes / DailyDungeon + Malware",
"Council / Tower / Keys / Heroes / FantasyBandit",
"Council / Tower / Keys / Heroes / Buy and Zap Keys",
"Council / Tower / Keys / Heroes / DeckOfCards",
"Council / Tower / Keys / Digital",
"Council / Tower / Keys / HoleInSkyUnlock",
"Council / Tower / Keys / Star",
"Council / Tower / Keys / Skeleton"];

var QuestTower = [
"Council / Tower / Contests",
"Council / Tower / Maze",
"Council / Tower / KeyDoor",
"Council / Tower / WallOfSkin",
"Council / Tower / WallOfMeat",
"Council / Tower / WallOfBones",
"Council / Tower / Shadow",
"Council / Tower / Mirror",
"Council / Tower / NaughtyBoss",
"Council / Tower / Parent"].concat(
QuestKeys);

var QuestTypes_QuestManor = [
"Manor / Chat",
"Manor / Kitchen",
"Manor / Billards",
"Manor / Library",
"Manor / Bathroom",
"Manor / Gallery",
"Manor / Bedroom"];

var QuestSkills = [
"Skills / Parent",
"Skills / MPRegen",
"Skills / HPRegen",
"Skills / ScalingItem",
"Skills / ScalingMeat",
"Skills / ScalingDR",
"Skills / Infinite Loop",
"Skills / Photonic Shroud",
"Skills / Piezoelectric Honk",
"Skills / Phase Shift",
"Skills / Conifer Polymers",
"Skills / System Sweep",
"Skills / ColdDamage15",
"Skills / ColdDamage10",
"Skills / DoubleNanovision"];

var QuestMisc = [
"Misc / Custom",
"Misc / Initial Pulls",
"Misc / FamEquip",
"Misc / MeatCar",
"Misc / ManorLights",
"Misc / UnlockDungeonsOfDoom",
"Misc / GrabZapWand",
"Misc / InitialStart",
"Misc / PowerLeveling",
"Misc / FortuneExp",
"Misc / Purchases",
"Misc / FriarExp",
"Misc / BugbearBakery",
"Misc / Moonsign",
"Misc / JuneCleaver",
"Misc / Ghost Buster",
"Misc / Short Cook Goose",
"Misc / Latte / Fam Exp",
"Misc / Latte / Plus Combat",
"Misc / Tot Pirate"];

var QuestCombatLocket = ["CombatLocket / InfiniteLoop"];
var QuestIslandUnlock = ["Boat / Vacation"];
var QuestTypes_QuestCouncil = [
"Quests / Council"].concat(
QuestToot,
QuestLarva,
QuestTavern,
QuestBats,
QuestGoblins,
QuestFriars,
QuestCrypt,
QuestIcePeak,
QuestTriplePeaks,
QuestBeanStalk, QuestTypes_toConsumableArray(
QuestMacGruffin), QuestTypes_toConsumableArray(
QuestIslandWar), QuestTypes_toConsumableArray(
QuestTower));

var QuestNPCs = [
"NPC / Parent",
"NPC / Meatsmith",
"NPC / GnomeSkills",
"NPC / Untinkerer",
"NPC / Baker",
"NPC / Druggie",
"NPC / Knoll Mayor",
"NPC / Doctor",
"NPC / Painter"];

var QuestGoblinsExperiments = [
"GoblinLabs / LabUnlock",
"GoblinLabs / MegUnlock"];

var QuestAbsorbs = [
"Absorbs / Hole in Sky",
"Absorbs / Canadia",
"Absorbs / Knoll",
"Absorbs / Gnomads",
"Absorbs / Palin",
"Absorbs / Irate Mariachi"];

var QuestLevels = [
"Level / 1",
"Level / 2",
"Level / 3",
"Level / 4",
"Level / 5",
"Level / 6",
"Level / 7",
"Level / 8",
"Level / 9",
"Level / 10",
"Level / 11",
"Level / 12",
"Level / 13"];

var QuestTypeArray = [].concat(QuestTypes_toConsumableArray(
QuestTypes_QuestCouncil),
QuestMisc,
QuestGoblinsExperiments,
QuestTypes_QuestManor,
QuestNPCs,
QuestSkills,
QuestCombatLocket,
QuestIslandUnlock,
QuestAbsorbs,
QuestLevels);
;// CONCATENATED MODULE: ./src/quests/QuestRegistry.ts
function QuestRegistry_typeof(obj) {"@babel/helpers - typeof";return QuestRegistry_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, QuestRegistry_typeof(obj);}function QuestRegistry_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = QuestRegistry_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function QuestRegistry_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return QuestRegistry_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return QuestRegistry_arrayLikeToArray(o, minLen);}function QuestRegistry_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function QuestRegistry_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function QuestRegistry_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, QuestRegistry_toPropertyKey(descriptor.key), descriptor);}}function QuestRegistry_createClass(Constructor, protoProps, staticProps) {if (protoProps) QuestRegistry_defineProperties(Constructor.prototype, protoProps);if (staticProps) QuestRegistry_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function QuestRegistry_defineProperty(obj, key, value) {key = QuestRegistry_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function QuestRegistry_toPropertyKey(arg) {var key = QuestRegistry_toPrimitive(arg, "string");return QuestRegistry_typeof(key) === "symbol" ? key : String(key);}function QuestRegistry_toPrimitive(input, hint) {if (QuestRegistry_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (QuestRegistry_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}




















// We get one non-combat at goblin basement from jellyfish
// Another non-combat at Black panther
// Goblin only has one -combat to speak of, and its not really worth much?
// Black is Car > Desert > Forest
var order = [
{ id: "Quests / Council" },

{ id: "Council / Toot" },
{ id: "Misc / Initial Pulls" },
{ id: "Misc / InitialStart" },
{ id: "Misc / PowerLeveling" },
{ id: "Misc / FortuneExp" },
{ id: "Misc / Ghost Buster" },

{ id: "CombatLocket / InfiniteLoop" },
{ id: "Misc / FamEquip" },
{ id: "Misc / JuneCleaver" },

{ id: "NPC / Meatsmith" },
{ id: "NPC / GnomeSkills" },
{ id: "NPC / Painter" }, // Takes up to 3 advs so meh, not quest relevant either. Only supported if user starts it
{ id: "NPC / Untinkerer" },
{ id: "NPC / Baker" },
{ id: "NPC / Druggie" },
{ id: "NPC / Knoll Mayor" },
{ id: "NPC / Doctor" },
{ id: "Misc / Purchases" },
{ id: "Misc / FriarExp" },
{ id: "Misc / Moonsign" },
// These just make the absorbs prioritized higher
{
  id: "Absorbs / Knoll",
  testValid: function testValid() {return (0,external_kolmafia_.knollAvailable)() && GreySettings_GreySettings.greyTuneMoonSpoon != null;}
},
{
  id: "Absorbs / Canadia",
  testValid: function testValid() {return (
      (0,external_kolmafia_.canadiaAvailable)() && GreySettings_GreySettings.greyTuneMoonSpoon != null);}
},
{
  id: "Absorbs / Gnomads",
  testValid: function testValid() {return (
      (0,external_kolmafia_.gnomadsAvailable)() && GreySettings_GreySettings.greyTuneMoonSpoon != null);}
},

// We might want system sweep after all! This needs to be cleaned
{ id: "Council / MacGruffin / HiddenCity / HiddenPark" },

{ id: "Skills / Infinite Loop" },
{ id: "Skills / System Sweep" },
{ id: "Skills / Phase Shift" },
{ id: "Skills / HPRegen" },
{ id: "Skills / ScalingItem" },
{ id: "Skills / ScalingMeat" },
{ id: "Skills / DoubleNanovision" },
{ id: "Misc / Short Cook Goose" },

{ id: "Skills / ScalingDR" },
{ id: "Skills / Conifer Polymers" },

// Vines are free kills, why not prioritize them to unlock zones
{ id: "Council / MacGruffin / HiddenCity / Vines" },

{ id: "Misc / ManorLights" },
{ id: "Misc / UnlockDungeonsOfDoom" },
{ id: "Skills / MPRegen" },

// We do this early so we can grab our hippy outfit asap
{ id: "Boat / Vacation" },

// Always try to buy access to the shore, 8-9 adventures spent trying to farm stuff up?
{ id: "Council / MacGruffin / Shore" },
{ id: "Misc / MeatCar" },
{ id: "Misc / BugbearBakery" },

// Get goblin done early so we can grab our first -combat skill
{ id: "Council / Goblins / Outskirts" },
{ id: "Council / Goblins / HaremOutfit" },

{ id: "GoblinLabs / LabUnlock" },
{ id: "GoblinLabs / MegUnlock" },

{ id: "Council / MacGruffin / Vacation" },

{ id: "Council / Larva" },

{ id: "Council / Ice / Ore" },

// Get this done early so we can start flyering
{ id: "Council / War / Frat Outfit" },
{ id: "Council / War / Start" },
{ id: "Council / War / Flyers" },

// OMG who cares about your stupid war
{
  id: "Council / War / Filthworms"
},

// We get +3 hot resist from raging bull
// +3 stench resist from pine bat
// And the other two skills are manor located
{ id: "Manor / Chat" },
{ id: "Manor / Kitchen" },
{ id: "Manor / Billards" },
{ id: "Manor / Bathroom" },
{ id: "Manor / Gallery" },
{ id: "Manor / Bedroom" },

// Do the king cos he's lonely, also has 2k meat
{ id: "Council / Goblins / King" },

// Register these here, because we want to burn their backups in delay zones
{
  id: "Council / Tower / Keys / Heroes / FantasyBandit",
  towerDelayed: true
},
{ id: "Council / War / Lobsters" },

// Get friars done early so we can grab stuff from hell
{ id: "Council / Friars / Heart" },
{ id: "Council / Friars / Elbow" },
{ id: "Council / Friars / Neck" },
{ id: "Council / Friars / TurnIn" },

{ id: "Misc / Latte / Fam Exp" },
{ id: "Misc / Latte / Plus Combat" },

// If we have the skill, then this doesn't need prioritizing as such
{
  id: "Council / MacGruffin / Black"
},

{ id: "Skills / Photonic Shroud" },
{ id: "Misc / GrabZapWand" },
{ id: "Misc / Tot Pirate" },

// Meh
{ id: "Council / MacGruffin / HiddenCity / Boss" },
{ id: "Council / MacGruffin / Temple / Unlock" },
{ id: "Council / MacGruffin / Temple / GrabWool" },
{ id: "Council / MacGruffin / Temple / Nostril" },
{ id: "Council / MacGruffin / Temple / HiddenCity" },

// Now we do our bowling, we prioritize this because of special code that has the bowling ball with combat turns = 0
// We also prioritize it for double nanovision
{ id: "Council / MacGruffin / HiddenCity / BookOfMatches" },
{ id: "Council / MacGruffin / HiddenCity / Bowling" },

// Do library after we should have system sweep stuff
{ id: "Manor / Library" },

// Crypt does give us meat hmm
{ id: "Council / Crypt / Gravy Boat Pull" },
{ id: "Council / Crypt / Sprinters" },
{ id: "Council / Crypt / Eyes" },

{ id: "Council / Bats / Sonars" },
{ id: "Council / Bats / UnlockLeft" },
{ id: "Council / Bats / Boss" },

// We've unlocked the left way, just do shen and hopefully we unlock right without actually burning extra turns
{ id: "Council / MacGruffin / Shen / Meet" },
{ id: "Council / MacGruffin / Shen / Bats" },
{ id: "Council / MacGruffin / Shen / TurnIn" },

// Unlock ninja tower
{ id: "Council / Ice / Trapper" },
{ id: "Council / Ice / Goats" },

// Ninja power!
{ id: "Council / MacGruffin / Shen / Ninjas" },

// Try unlock right bats if not unlocked
{ id: "Council / Bats / UnlockRight" },

// Hunt for enchanted beans
{ id: "Council / Beanstalk / EnchantedBean" },
{ id: "Council / Beanstalk / Ship" },
{ id: "Council / Beanstalk / Basement" },
{ id: "Council / Beanstalk / Ground" },
// We're now trying to do the top stuff yay
{ id: "Council / Beanstalk / Top" },

// If we still haven't unlocked from doing our top castle, lets try unlock our hole in sky
{ id: "Council / Tower / Keys / HoleInSkyUnlock" },
// Oh wow, hole in sky unlocked but still no boss. Lets just do it manually.
{ id: "Council / MacGruffin / Shen / Giants" },
{ id: "Council / Tower / Keys / Star", towerDelayed: true },

{ id: "Council / MacGruffin / Ron / Crowd" },
{ id: "Council / MacGruffin / Ron / Zepp" },

// Palin needs Ron and Shen done
{ id: "Council / MacGruffin / Palin / Book" },
{ id: "Council / MacGruffin / Palin / WetStew" },
{ id: "Council / MacGruffin / Palin / Boss" },
{ id: "Skills / Piezoelectric Honk" },

// Ninja needs +combat, so delay it until we've finished Shen and grabbed our +combat skill from Palin
{ id: "Council / Ice / Ninjas" },
// We earn a cold damage skill, so may as well. We also get meats
{ id: "Council / Ice / Boss" },

// Given we earn nothing but meat, delays for days
{ id: "Council / Bats / UnlockBoss" },

// We do shaman first to potentially grab extra accountant stuff
{ id: "Council / MacGruffin / HiddenCity / Curses" },

{ id: "Council / MacGruffin / HiddenCity / Accountants" },

// Meh
{ id: "Council / MacGruffin / HiddenCity / Doctor" },

// Nothing interesting from desert and pyramid yawn
{ id: "Council / MacGruffin / Desert / Compass" },

{ id: "Council / MacGruffin / Desert / WormRide" },
{ id: "Council / MacGruffin / Desert / Gnome" },
{
  id: "Council / MacGruffin / Desert / StoneRose"
},
{
  id: "Council / MacGruffin / Desert / Explore"
},

// Unlock cellar
{ id: "Council / MacGruffin / Manor / Ballroom" },
{ id: "Council / MacGruffin / Manor / Recipe" },
{ id: "Council / MacGruffin / Manor / Soda" },
{ id: "Council / MacGruffin / Manor / Wine" },
{ id: "Council / MacGruffin / Manor / Bomb" },
{ id: "Council / MacGruffin / Manor / Boss" },

// Nothing special from the top of the pyramid, but burn some turns here anyways
{ id: "Council / MacGruffin / Pyramid / Top" },

// Alright, unlock the control room and the undying man. And keep going until you have enough rats
{ id: "Council / MacGruffin / Pyramid / Middle" },
{ id: "Council / MacGruffin / Pyramid / Wheel" },

// Given we earn nothing from crypt..
{ id: "Council / Crypt / Rattling" },
{ id: "Council / Crypt / DirtyMan" },
{ id: "Council / Crypt / Boss" },

{ id: "Skills / ColdDamage15" },
{ id: "Skills / ColdDamage10" },

// Given that we earn nothing from peaks, just delay it until we should've hit our max +cold damage
{ id: "Council / Peaks / CargoShortsSmut" },
{ id: "Council / Peaks / Orcs" },
{ id: "Council / Peaks / OilPeak" },
{ id: "Council / Peaks / TwinPeak" },
{ id: "Council / Peaks / AbooPeak" },
{ id: "Council / Peaks / Lord" },

{ id: "Council / War / Gremlins" },
{ id: "Council / War / Gremlins / Burning Barrel" },
{ id: "Council / War / Gremlins / Abandoned Refrigerator" },
{ id: "Council / War / Gremlins / Old Tires" },
{ id: "Council / War / Gremlins / Rusted Car" },

{ id: "Council / War / Boss" },

// Tavern needs Larva done
{ id: "Council / Tavern" },

{ id: "Council / War / Battlefield" },

{ id: "Council / MacGruffin / Pyramid / EdUndying" },

// Alright, this run is just about over kids. Lets finish it.
{ id: "Council / Tower / Contests", towerDelayed: true },
{ id: "Council / Tower / Maze", towerDelayed: true },

{
  id: "Council / Tower / Keys / Heroes / Buy and Zap Keys",
  towerDelayed: true
},
{
  id: "Council / Tower / Keys / Heroes / DailyDungeon",
  towerDelayed: true
},
{
  id: "Council / Tower / Keys / Heroes / DailyDungeon + Malware",
  towerDelayed: true
},
{
  id: "Council / Tower / Keys / Heroes / DeckOfCards",
  towerDelayed: true
},
{ id: "Council / Tower / Keys / Skeleton", towerDelayed: true },

{ id: "Council / War / Nuns" },

// By the time we hit this, we should 100% have our keys
{ id: "Council / Tower / KeyDoor", towerDelayed: true },

{ id: "Council / Tower / WallOfSkin", towerDelayed: true },

{ id: "Council / Tower / WallOfMeat", towerDelayed: true },

{ id: "Council / Tower / WallOfBones", towerDelayed: true },

{ id: "Council / Tower / Shadow", towerDelayed: true },
{ id: "Council / Tower / Mirror", towerDelayed: true },
{ id: "Council / Tower / NaughtyBoss", towerDelayed: true },

{ id: "Absorbs / Hole in Sky" },
{ id: "Absorbs / Canadia" },
{ id: "Absorbs / Knoll" },
{ id: "Absorbs / Gnomads" },
{ id: "Absorbs / Palin" },
{ id: "Absorbs / Irate Mariachi" },
{ id: "Council / Tower / Keys / Heroes", towerDelayed: true },
{ id: "Council / Tower / Keys / Digital" }];


var QuestRegistry = /*#__PURE__*/function () {


  function QuestRegistry() {QuestRegistry_classCallCheck(this, QuestRegistry);QuestRegistry_defineProperty(this, "map", new Map());
    this.addInfo(new QuestCouncil());
    this.addInfo(new QuestCar());
    this.addInfo(new QuestManorLights());
    this.addInfo(new QuestsCustom());
    this.addInfo(new QuestManor());

    var ordered = this.getQuestOrder();var _iterator = QuestRegistry_createForOfIteratorHelper(

      this.map.keys()),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var type = _step.value;
        if (ordered.includes(type)) {
          continue;
        }

        if (this.map.get(type).level() == -1) {
          continue;
        }

        (0,external_kolmafia_.print)(
        "DEBUG: Quests registry priority order does not contain: " + type,
        "gray");

      }} catch (err) {_iterator.e(err);} finally {_iterator.f();}var _iterator2 = QuestRegistry_createForOfIteratorHelper(

      QuestTypeArray),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var _type = _step2.value;
        if (this.map.has(_type) || !GreySettings_GreySettings.greyDebug) {
          continue;
        }

        if (_type.includes("Council / Tower / Keys / Heroes /")) {
          continue;
        }

        if (
        GreySettings_GreySettings.shouldAvoidTowerRequirements() &&
        !GreySettings_GreySettings.greyReachedTower &&
        QuestRegistry.isTowerDelayed(_type))
        {
          continue;
        }

        (0,external_kolmafia_.print)(
        "ERROR! No quest registered for the quest id '" + _type + "'",
        "red");

      }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}
  }QuestRegistry_createClass(QuestRegistry, [{ key: "addInfo", value:

    function addInfo(questInfo) {
      var id = questInfo.getId();

      if (id == null) {
        throw "Null quest id found!";
      }

      if (this.map.has(id)) {
        throw "Map already contains the quest '" + id + "'";
      }

      if (
      GreySettings_GreySettings.shouldAvoidTowerRequirements() &&
      !GreySettings_GreySettings.greyReachedTower &&
      QuestRegistry.isTowerDelayed(questInfo.getId()))
      {
        return;
      }

      this.map.set(id, questInfo);
      // TODO Add to map

      if (questInfo.getChildren != null) {var _iterator3 = QuestRegistry_createForOfIteratorHelper(
          questInfo.getChildren()),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var child = _step3.value;
            this.addInfo(child);
          }} catch (err) {_iterator3.e(err);} finally {_iterator3.f();}
      }
    } }, { key: "getQuestOrder", value:

    function getQuestOrder() {
      var ordered = [].concat(order).
      filter(function (order) {return order.testValid == null || order.testValid();}).
      map(function (order) {return order.id;});

      return ordered.filter(function (q, index) {return ordered.indexOf(q) == index;});
    } }, { key: "getQuestsInOrder", value:

    function getQuestsInOrder() {
      var quests = [];var _iterator4 = QuestRegistry_createForOfIteratorHelper(

        this.getQuestOrder()),_step4;try {for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {var questType = _step4.value;
          var info = this.map.get(questType);

          if (info == null) {
            continue;
          }

          quests.push(info);
        }} catch (err) {_iterator4.e(err);} finally {_iterator4.f();}

      return quests;
    } }], [{ key: "isTowerDelayed", value:

    function isTowerDelayed(questType) {
      return (
        order.find(function (q) {return q.id == questType && q.towerDelayed == true;}) != null);

    } }]);return QuestRegistry;}();
;// CONCATENATED MODULE: ./src/GreyChooser.ts
function GreyChooser_typeof(obj) {"@babel/helpers - typeof";return GreyChooser_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, GreyChooser_typeof(obj);}function GreyChooser_toConsumableArray(arr) {return GreyChooser_arrayWithoutHoles(arr) || GreyChooser_iterableToArray(arr) || GreyChooser_unsupportedIterableToArray(arr) || GreyChooser_nonIterableSpread();}function GreyChooser_nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function GreyChooser_iterableToArray(iter) {if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);}function GreyChooser_arrayWithoutHoles(arr) {if (Array.isArray(arr)) return GreyChooser_arrayLikeToArray(arr);}function GreyChooser_slicedToArray(arr, i) {return GreyChooser_arrayWithHoles(arr) || GreyChooser_iterableToArrayLimit(arr, i) || GreyChooser_unsupportedIterableToArray(arr, i) || GreyChooser_nonIterableRest();}function GreyChooser_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function GreyChooser_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function GreyChooser_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function GreyChooser_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = GreyChooser_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function GreyChooser_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return GreyChooser_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return GreyChooser_arrayLikeToArray(o, minLen);}function GreyChooser_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function GreyChooser_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function GreyChooser_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, GreyChooser_toPropertyKey(descriptor.key), descriptor);}}function GreyChooser_createClass(Constructor, protoProps, staticProps) {if (protoProps) GreyChooser_defineProperties(Constructor.prototype, protoProps);if (staticProps) GreyChooser_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function GreyChooser_defineProperty(obj, key, value) {key = GreyChooser_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function GreyChooser_toPropertyKey(arg) {var key = GreyChooser_toPrimitive(arg, "string");return GreyChooser_typeof(key) === "symbol" ? key : String(key);}function GreyChooser_toPrimitive(input, hint) {if (GreyChooser_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (GreyChooser_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}













var OrbStatus;(function (OrbStatus) {OrbStatus[OrbStatus["READY"] = 0] = "READY";OrbStatus[OrbStatus["NOT_SET"] = 1] = "NOT_SET";OrbStatus[OrbStatus["IGNORED"] = 2] = "IGNORED";OrbStatus[OrbStatus["NEEDS_RESET"] = 3] = "NEEDS_RESET";})(OrbStatus || (OrbStatus = {}));






var ConsiderPriority;











// When we'd hit an absorb that's useless to us
(function (ConsiderPriority) {ConsiderPriority[ConsiderPriority["INSISTS_ON_BEING_DONE"] = 0] = "INSISTS_ON_BEING_DONE";ConsiderPriority[ConsiderPriority["MUST_BE_DONE"] = 1] = "MUST_BE_DONE";ConsiderPriority[ConsiderPriority["ORB_ABSORB"] = 2] = "ORB_ABSORB";ConsiderPriority[ConsiderPriority["ORB_ABSORB_OTHER"] = 3] = "ORB_ABSORB_OTHER";ConsiderPriority[ConsiderPriority["ORB_OTHER"] = 4] = "ORB_OTHER";ConsiderPriority[ConsiderPriority["RANDOM_ABSORB"] = 5] = "RANDOM_ABSORB";ConsiderPriority[ConsiderPriority["RANDOM_COMBAT_ABSORB"] = 6] = "RANDOM_COMBAT_ABSORB";ConsiderPriority[ConsiderPriority["NOTHING_SPECIAL"] = 7] = "NOTHING_SPECIAL";ConsiderPriority[ConsiderPriority["BAD_COMBAT_RATE"] = 8] = "BAD_COMBAT_RATE";ConsiderPriority[ConsiderPriority["BAD_PREDICTION"] = 9] = "BAD_PREDICTION";ConsiderPriority[ConsiderPriority["BAD_ABSORB"] = 10] = "BAD_ABSORB";ConsiderPriority[ConsiderPriority["BAD_ABSORB_PREDICTION"] = 11] = "BAD_ABSORB_PREDICTION";})(ConsiderPriority || (ConsiderPriority = {}));













var crystalBall = external_kolmafia_.Item.get("miniature crystal ball");

var AdventureFinder = /*#__PURE__*/function () {











  function AdventureFinder() {GreyChooser_classCallCheck(this, AdventureFinder);GreyChooser_defineProperty(this, "registry", new QuestRegistry());GreyChooser_defineProperty(this, "defeated", void 0);GreyChooser_defineProperty(this, "allQuests", void 0);GreyChooser_defineProperty(this, "viableQuests", void 0);GreyChooser_defineProperty(this, "absorbs", new GreyAbsorber_AbsorbsProvider());GreyChooser_defineProperty(this, "goose", external_kolmafia_.Familiar.get("Grey Goose"));GreyChooser_defineProperty(this, "questLocations", void 0);GreyChooser_defineProperty(this, "possibleAdventures", void 0);GreyChooser_defineProperty(this, "path", void 0);
    AdventureFinder.instance = this;
  }GreyChooser_createClass(AdventureFinder, [{ key: "calculatePath", value:









    function calculatePath() {
      var simmedPath = new TaskManager_FigureOutPath().getPaths(this.getAllRawQuests());

      if (simmedPath == null) {
        if (this.path != null) {
          (0,external_kolmafia_.print)("Failed to calculate a path.. Staying on current path..", "gray");
        }

        return;
      }

      this.path = simmedPath;
      this.path.printInfo();
    } }, { key: "getAllRawQuests", value:

    function getAllRawQuests() {
      return this.registry.getQuestsInOrder();
    } }, { key: "setPossibleAdventures", value:

    function setPossibleAdventures() {var _this = this;
      this.possibleAdventures = [];var _iterator = GreyChooser_createForOfIteratorHelper(

        this.viableQuests),_step;try {var _loop = function _loop() {var _step$value = GreyChooser_slicedToArray(_step.value, 2),quest = _step$value[0],path = _step$value[1];
          var adventure = quest.run(path);
          var details;

          if (quest.getAbsorbs != null) {
            var absorbs = quest.getAbsorbs();

            if (absorbs.length > 0) {
              details = _this.absorbs.getAdventuresByAbsorbs(
              _this.defeated,
              absorbs,
              true);

            }
          }

          if (details == null && adventure.location != null) {
            details = _this.absorbs.getAdventuresInLocation(
            false,
            _this.defeated,
            adventure.location,
            true);

          }

          if (
          (details != null || adventure.olfaction != null) &&
          adventure.orbs == null)
          {
            adventure.orbs = [];
          }

          if (adventure.olfaction != null) {var _iterator3 = GreyChooser_createForOfIteratorHelper(
              adventure.olfaction),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var m = _step3.value;
                if (adventure.orbs.includes(m)) {
                  continue;
                }

                adventure.orbs.push(m);
              }} catch (err) {_iterator3.e(err);} finally {_iterator3.f();}
          }

          if (details != null) {var _iterator4 = GreyChooser_createForOfIteratorHelper(
              details.monsters),_step4;try {for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {var _m = _step4.value;
                if (adventure.orbs.includes(_m)) {
                  continue;
                }

                adventure.orbs.push(_m);
              }} catch (err) {_iterator4.e(err);} finally {_iterator4.f();}
          }

          var noDisruptiveResources =
          path == null ||
          [
          ResourceCategory.FAXER,
          ResourceCategory.COPIER,
          ResourceCategory.OLFACT_COPIER,
          ResourceCategory.CARGO_SHORTS].
          find(function (r) {return path.resourceUsed.includes(r) || path.canUse(r);}) == null;
          var canFreeRun =
          noDisruptiveResources &&
          adventure.mayFreeRun !== false &&
          adventure.forcedFight == null;

          var adv = {
            quest: quest,
            path: path,
            locationInfo: details,
            adventure: adventure,
            orbStatus: OrbStatus.IGNORED,
            status: quest.status(path),
            considerPriority:
            quest.mustBeDone != null && quest.mustBeDone() ?
            quest.mustBeDone(true) ?
            ConsiderPriority.INSISTS_ON_BEING_DONE :
            ConsiderPriority.MUST_BE_DONE :
            null,
            mayFreeRun: canFreeRun,
            freeRun: function freeRun(monster, settings) {
              // Never run from a boss, or a free fight
              if (
              !canFreeRun ||
              monster.boss ||
              !monster.copyable ||
              monster.attributes.includes("FREE") ||
              monster.name.startsWith("void ") &&
              (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_voidFreeFights")) <= 5 ||
              monster.name == "_voteMonster" &&
              (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_voteFreeFights")) <= 5)
              {
                return false;
              }

              // Never run from something we're trying to hit with orb, or oflact
              if (
              adventure.orbs != null && adventure.orbs.includes(monster) ||
              adventure.olfaction != null &&
              adventure.olfaction.includes(monster))
              {
                return false;
              }

              // Never run from something we're deliberately not banishing
              if (
              settings != null &&
              settings.dontBanishThese != null &&
              settings.dontBanishThese.includes(monster))
              {
                return false;
              }

              // Always run from something we're deliberately banishing
              if (
              settings != null &&
              settings.banishThese != null &&
              settings.banishThese.includes(monster))
              {
                return true;
              }

              // If the adventure hasn't decided to free run or not, never free run
              if (adventure.freeRun == null) {
                return false;
              }

              // If the adventure says not to free run, don't
              if (!adventure.freeRun(monster, settings)) {
                return false;
              }

              return _this.shouldFreeRun(monster);
            }
          };

          _this.possibleAdventures.push(adv);
        };for (_iterator.s(); !(_step = _iterator.n()).done;) {_loop();}} catch (err) {_iterator.e(err);} finally {_iterator.f();}

      var nonQuests = this.absorbs.getExtraAdventures(
      (0,external_kolmafia_.myAdventures)() >= 25,
      this.defeated,
      true);


      nonQuests.sort(function (_ref, _ref2) {var _ref3 = GreyChooser_slicedToArray(_ref, 2),a1 = _ref3[1];var _ref4 = GreyChooser_slicedToArray(_ref2, 2),a2 = _ref4[1];return a2.weight - a1.weight;});var _iterator2 = GreyChooser_createForOfIteratorHelper(

        nonQuests),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var _step2$value = GreyChooser_slicedToArray(_step2.value, 2),loc = _step2$value[0],details = _step2$value[1];
          if (
          this.questLocations.includes(loc) ||
          !canGreyAdventure(loc) ||
          GreyChooser_toConsumableArray(details.skills.keys()).find(function (s) {return (
              _this.absorbs.getMustHaveSkills().has(s.skill));}) ==
          null &&
          details.expectedTurnsProfit < 0)
          {
            continue;
          }

          if (loc == external_kolmafia_.Location.get("Oil Peak")) {
            continue;
          }

          var adv = {
            quest: null,
            path: null,
            locationInfo: details,
            adventure: this.getNonQuest(loc, details),
            orbStatus: OrbStatus.IGNORED,
            status: QuestStatus.READY,
            considerPriority: null,
            mayFreeRun: true,
            freeRun: function freeRun(monster) {
              return _this.shouldFreeRun(monster);
            }
          };

          this.possibleAdventures.push(adv);
        }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}

      this.adjustAdventures();
    } }, { key: "shouldFreeRun", value:

    function shouldFreeRun(monster) {
      // Never run from a boss, or a free fight
      if (
      monster.boss ||
      !monster.copyable ||
      monster.attributes.includes("FREE"))
      {
        return false;
      }

      var absorb = GreyAbsorber_AbsorbsProvider.getAbsorb(monster);

      // If we absorb nothing from this, free run
      if (absorb == null) {
        return true;
      }

      // If we get adventures from this
      if (absorb.adventures > 0) {
        // Only free run if we can't absorb
        return (
          getAbsorbedAdventuresRemaining() <= 0 ||
          this.defeated.get(monster) == Reabsorbed.REABSORBED);

      }

      if (this.defeated.has(monster)) {
        return true;
      }

      if (absorb.skill != null && this.absorbs.shouldGrabSkill(absorb.skill)) {
        return false;
      }

      // Free run if we've taken the absorb
      return absorb.hp + absorb.mp + ((0,external_kolmafia_.myLevel)() < 10 ? absorb.mox : 0) == 0;
    } }, { key: "adjustAdventures", value:

    function adjustAdventures() {var _this2 = this;
      var absorbTime = this.hasEnoughGooseWeight();

      if ((0,external_kolmafia_.availableAmount)(crystalBall) > 0) {
        var preds = currentPredictions();

        var advsWithPredictions = this.possibleAdventures.filter(
        function (a) {return (
            a.adventure.orbs != null &&
            a.adventure.orbs.length > 0 &&
            preds.has(a.adventure.location));});


        // If we have no adventures that like their predictions
        // And an adventure that dislikes their prediction..
        if (
        advsWithPredictions.find(function (a) {return (
            a.adventure.orbs.includes(preds.get(a.adventure.location)));}) ==
        null &&
        advsWithPredictions.find(
        function (a) {return !a.adventure.orbs.includes(preds.get(a.adventure.location));}) !=
        null)
        {
          doToasterGaze();
          preds = currentPredictions();
        }var _iterator5 = GreyChooser_createForOfIteratorHelper(

          this.possibleAdventures),_step5;try {var _loop2 = function _loop2() {var adv = _step5.value;
            if (
            adv.adventure.location == null ||
            adv.adventure.orbs == null ||
            adv.adventure.orbs.length == 0)
            {return "continue";

            }

            if (
            adv.adventure.forcedFight != null &&
            adv.adventure.forcedFight[0] == 0)
            {return "continue";

            }

            var appear = (0,external_kolmafia_.appearanceRates)(adv.adventure.location);
            var couldAppear = adv.adventure.orbs.filter(
            function (m) {return appear[m.name] > 0;});


            if (couldAppear.length == 0) {return "continue";

            }

            var prediction = preds.get(adv.adventure.location);

            if (prediction == null) {
              adv.orbStatus = OrbStatus.NOT_SET;
            } else if (adv.adventure.orbs.includes(prediction)) {
              adv.orbStatus = OrbStatus.READY;
              adv.mayFreeRun = false;

              var absorb = _this2.absorbs.getAbsorb(prediction);
              var advAbsorb =
              absorb != null &&
              absorb.adventures > 0 &&
              getAbsorbedAdventuresRemaining() > 0;
              var defeat = _this2.defeated.get(prediction);

              if (
              advAbsorb && (
              defeat == null ||
              defeat == Reabsorbed.NOT_REABSORBED && absorbTime))
              {
                if (defeat == Reabsorbed.NOT_REABSORBED || absorbTime) {
                  adv.considerPriority = ConsiderPriority.ORB_ABSORB;
                } else {
                  adv.considerPriority = ConsiderPriority.BAD_ABSORB_PREDICTION;
                }
              } else if (
              absorb != null &&
              absorb.skill != null &&
              _this2.absorbs.shouldGrabSkill(absorb.skill) &&
              defeat == null)
              {
                adv.considerPriority = ConsiderPriority.ORB_ABSORB_OTHER;
              } else {
                adv.considerPriority = ConsiderPriority.ORB_OTHER;
              }
            } else {
              adv.orbStatus = OrbStatus.NEEDS_RESET;
            }
          };for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {var _ret = _loop2();if (_ret === "continue") continue;}} catch (err) {_iterator5.e(err);} finally {_iterator5.f();}
      }

      var hasBlessing =
      (0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("Brother Corsican's Blessing")) +
      (0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("A Girl Named Sue")) >
      0;var _iterator6 = GreyChooser_createForOfIteratorHelper(

        this.possibleAdventures),_step6;try {for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {var adv = _step6.value;
          if (adv.considerPriority != null) {
            continue;
          }

          var wantsAbsorb =
          adv.locationInfo != null && (
          adv.locationInfo.turnsToGain > 0 ||
          GreyChooser_toConsumableArray(adv.locationInfo.skills).find(
          function (_ref5) {var _ref6 = GreyChooser_slicedToArray(_ref5, 1),a = _ref6[0];return (
              !(0,external_kolmafia_.haveSkill)(a.skill) && _this2.absorbs.shouldGrabSkill(a.skill));}) !=
          null);

          // If we might hit an absorb we can't reabsorb
          if (
          adv.locationInfo != null &&
          adv.locationInfo.reabsorb &&
          !absorbTime)
          {
            adv.considerPriority = ConsiderPriority.BAD_ABSORB;
            continue;
          }

          if (adv.orbStatus == OrbStatus.NEEDS_RESET) {
            adv.considerPriority = ConsiderPriority.BAD_PREDICTION;
            continue;
          }

          var outfit = adv.adventure.outfit;

          // If we want to run -/+ combat but we're running the opposite
          if (
          outfit != null &&
          outfit != GreyOutfit.IGNORE_OUTFIT && (
          outfit.minusCombatWeight > 0 && hasCombatSkillActive() ||
          outfit.plusCombatWeight > 0 &&
          adv.quest != null &&
          hasNonCombatSkillActive()))
          {
            adv.considerPriority = ConsiderPriority.BAD_COMBAT_RATE;
            continue;
          }

          if (wantsAbsorb) {
            if (adv.adventure.location == null) {
              adv.considerPriority = ConsiderPriority.RANDOM_ABSORB;
              continue;
            }

            // We should run combat if combat percent is below 100
            // Or our outfit exists and wants to run combat
            // And the location isn't black forest, or if it is, we don't have the skill
            var shouldRunCombat =
            adv.adventure.location.combatPercent < 100 &&
            adv.adventure.outfit == null ||
            adv.adventure.outfit != null &&
            adv.adventure.outfit != GreyOutfit.IGNORE_OUTFIT &&
            adv.adventure.outfit.plusCombatWeight > 0;

            if (shouldRunCombat && hasNonCombatSkillActive()) {
              adv.considerPriority = ConsiderPriority.RANDOM_COMBAT_ABSORB;
            } else {
              adv.considerPriority = ConsiderPriority.RANDOM_ABSORB;
            }

            continue;
          }

          adv.considerPriority = ConsiderPriority.NOTHING_SPECIAL;
        }} catch (err) {_iterator6.e(err);} finally {_iterator6.f();}var _iterator7 = GreyChooser_createForOfIteratorHelper(

        this.possibleAdventures),_step7;try {for (_iterator7.s(); !(_step7 = _iterator7.n()).done;) {var _adv = _step7.value;
          _adv.status = this.getModifiedStatus(
          _adv.status,
          _adv.adventure,
          hasBlessing);

        }} catch (err) {_iterator7.e(err);} finally {_iterator7.f();}
    } }, { key: "getNonQuest", value:

    function getNonQuest(loc, adv) {
      var outfit = new GreyOutfit();

      if (loc.combatPercent < 100) {
        outfit.setPlusCombat();
      }

      var settings = new AdventureSettings();
      settings.nonquest = true;
      adv.monsters.forEach(function (m) {return settings.addNoBanish(m);});

      return {
        outfit: outfit,
        location: loc,
        orbs: adv.monsters,
        run: function run() {
          // We don't want it casting +combat skills
          greyAdv(loc, null, settings);
        }
      };
    } }, { key: "doAllQuests", value:

    function doAllQuests() {var _this3 = this;
      this.allQuests = [];

      var tryAdd = function tryAdd(q, path) {
        if (q.level() < 0) {
          return;
        }
        _this3.allQuests.push([q, path]);
      };

      this.path.thisPath.forEach(function (_ref7) {var _ref8 = GreyChooser_slicedToArray(_ref7, 2),quest = _ref8[0],path = _ref8[1];
        tryAdd(quest, path);
      });
    } }, { key: "getDoableQuests", value:

    function getDoableQuests() {var allQuests = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;
      var quests = [];

      var tryAdd = function tryAdd(q, path) {
        if (!allQuests && q.level() > (0,external_kolmafia_.myLevel)() || q.level() < 0) {
          return;
        }

        if (
        !allQuests &&
        q.level() != 1 &&
        q.level() * ((0,external_kolmafia_.haveSkill)(external_kolmafia_.Skill.get("Infinite Loop")) ? 1 : 6) >
        (0,external_kolmafia_.myBasestat)(external_kolmafia_.Stat.get("Moxie")))
        {
          return;
        }

        var status = q.status(path);

        if (
        !allQuests && (
        status == QuestStatus.COMPLETED || status == QuestStatus.NOT_READY))
        {
          return;
        }

        quests.push([q, path]);
      };

      this.allQuests.forEach(function (_ref9) {var _ref10 = GreyChooser_slicedToArray(_ref9, 2),quest = _ref10[0],path = _ref10[1];
        tryAdd(quest, path);
      });

      return quests;
    } }, { key: "start", value:

    function start() {var allQuests = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;
      this.setPreAbsorbs();

      if (this.path.isRecalculateNeeded()) {
        this.calculatePath();
        this.setPreAbsorbs();
      }

      this.doAllQuests();
      this.viableQuests = this.getDoableQuests(allQuests);
      this.setAbsorbs();
      this.defeated = this.absorbs.getAbsorbedMonstersFromInstance();
      this.setQuestLocations(allQuests);
      this.setPossibleAdventures();
    } }, { key: "setPreAbsorbs", value:

    function setPreAbsorbs() {
      var defeated = this.absorbs.getAbsorbedMonstersFromInstance();var _iterator8 = GreyChooser_createForOfIteratorHelper(

        this.path.thisPath),_step8;try {for (_iterator8.s(); !(_step8 = _iterator8.n()).done;) {var _step8$value = GreyChooser_slicedToArray(_step8.value, 1),quest = _step8$value[0];
          quest.toAbsorb = [];var _iterator9 = GreyChooser_createForOfIteratorHelper(

            quest.getLocations()),_step9;try {for (_iterator9.s(); !(_step9 = _iterator9.n()).done;) {var _quest$toAbsorb;var loc = _step9.value;
              var result = this.absorbs.getAdventuresInLocation(
              false,
              defeated,
              loc);


              if (result == null) {
                continue;
              }

              (_quest$toAbsorb = quest.toAbsorb).push.apply(_quest$toAbsorb, GreyChooser_toConsumableArray(result.monsters));
            }} catch (err) {_iterator9.e(err);} finally {_iterator9.f();}
        }} catch (err) {_iterator8.e(err);} finally {_iterator8.f();}
    } }, { key: "setAbsorbs", value:

    function setAbsorbs() {
      var defeated = this.absorbs.getAbsorbedMonstersFromInstance();var _iterator10 = GreyChooser_createForOfIteratorHelper(

        this.path.thisPath),_step10;try {for (_iterator10.s(); !(_step10 = _iterator10.n()).done;) {var _step10$value = GreyChooser_slicedToArray(_step10.value, 2),quest = _step10$value[0],path = _step10$value[1];
          try {
            if (
            quest.status(path) == QuestStatus.NOT_READY ||
            quest.status(path) == QuestStatus.COMPLETED)
            {
              continue;
            }

            var run = quest.run(path);

            if (run.location == null) {
              continue;
            }

            var result = this.absorbs.getAdventuresInLocation(
            false,
            defeated,
            run.location);


            quest.toAbsorb =
            result == null ?
            [] :
            result.monsters.filter(function (m) {return defeated.get(m) == null;});
          } catch (e) {
            (0,external_kolmafia_.print)("Errored while trying to set absorbs on " + quest.getId());
            throw e;
          }
        }} catch (err) {_iterator10.e(err);} finally {_iterator10.f();}
    } }, { key: "setQuestLocations", value:

    function setQuestLocations(allQuests) {
      this.questLocations = [];var _iterator11 = GreyChooser_createForOfIteratorHelper(

        this.path.thisPath),_step11;try {for (_iterator11.s(); !(_step11 = _iterator11.n()).done;) {var _this$questLocations;var _step11$value = GreyChooser_slicedToArray(_step11.value, 2),quest = _step11$value[0],path = _step11$value[1];
          if (!allQuests && quest.status(path) == QuestStatus.COMPLETED) {
            continue;
          }

          (_this$questLocations = this.questLocations).push.apply(_this$questLocations, GreyChooser_toConsumableArray(quest.getLocations()));
        }} catch (err) {_iterator11.e(err);} finally {_iterator11.f();}
    } }, { key: "hasEnoughGooseWeight", value:

    function hasEnoughGooseWeight() {
      return (0,external_kolmafia_.familiarWeight)(this.goose) >= 6;
    } }, { key: "getModifiedStatus", value:

    function getModifiedStatus(
    status,
    runned,
    hasBlessing)
    {
      if (status != QuestStatus.READY) {
        return status;
      }

      if ((0,external_kolmafia_.getProperty)("autumnatonQuestLocation") != "") {
        var loc = external_kolmafia_.Location.get((0,external_kolmafia_.getProperty)("autumnatonQuestLocation"));

        if (runned.location == loc) {
          status = QuestStatus.FASTER_LATER;
        }
      }

      var outfit = runned.outfit;

      if (outfit != null) {
        if (outfit.minusCombatWeight > 0 && hasBlessing) {
          status = QuestStatus.FASTER_LATER;
        } else if ((0,external_kolmafia_.myMp)() < 50) {
          if (outfit.minusCombatWeight > 0 && !hasNonCombatSkillActive()) {
            status = QuestStatus.FASTER_LATER;
          } else if (
          outfit.plusCombatWeight > 0 &&
          (0,external_kolmafia_.haveSkill)(external_kolmafia_.Skill.get("Piezoelectric Honk")) &&
          !hasCombatSkillActive())
          {
            status = QuestStatus.FASTER_LATER;
          }
        }
      }

      return status;
    } }, { key: "getRecommendedFamiliars", value:

    function getRecommendedFamiliars() {
      return this.path.thisPath.
      map(function (_ref11) {var _ref12 = GreyChooser_slicedToArray(_ref11, 2),q = _ref12[0],path = _ref12[1];
        if (q.hasFamiliarRecommendation == null) {
          return null;
        }

        var fam = q.hasFamiliarRecommendation();

        if (fam == null) {
          return null;
        }

        var status = q.status(path);

        if (status == QuestStatus.COMPLETED) {
          return null;
        }

        return fam;
      }).
      filter(function (f) {return f != null;});
    } }, { key: "getQuestColor", value:

    function getQuestColor(status) {
      switch (status) {
        case QuestStatus.COMPLETED:
          return "green";
        case QuestStatus.FASTER_LATER:
          return "gray";
        case QuestStatus.NOT_READY:
          return "red";
        case QuestStatus.READY:
          return "green";}

    } }, { key: "printStatus", value:

    function printStatus(quests) {var _iterator12 = GreyChooser_createForOfIteratorHelper(
        quests),_step12;try {for (_iterator12.s(); !(_step12 = _iterator12.n()).done;) {var adv = _step12.value;
          var status = adv.status;
          var id =
          adv.quest == null ?
          "Non-Quest / " + adv.adventure.location :
          adv.quest.getId();

          var line =
          "<u>" +
          id +
          "</u>: " +
          doColor(QuestStatus[status], this.getQuestColor(status)) +
          " - " +
          ConsiderPriority[adv.considerPriority];

          (0,external_kolmafia_.printHtml)(line, true);
        }} catch (err) {_iterator12.e(err);} finally {_iterator12.f();}
    } }, { key: "findPrimedVisit", value:

    function findPrimedVisit() {
      var primed = getPrimedResource();

      if (primed == null) {
        return null;
      }

      if (!primed.resource.primed()) {
        resetPrimedResource();
        return null;
      }

      var status = primed.quest.status(primed.path);

      if (status != QuestStatus.READY && status != QuestStatus.FASTER_LATER) {
        throw (
          "Expected a quest status of ready or faster later on " +
          primed.quest.getId() +
          " which was primed for a resource " +
          primed.resource.name);

      }

      var adv = primed.quest.run(primed.path);
      var run = adv.run;

      adv.run = function () {
        run();
        primed.resource.unprime();
        resetPrimedResource();
      };

      var toReturn = {
        quest: primed.quest,
        path: primed.path,
        locationInfo: null,
        adventure: adv,
        status: status,
        orbStatus: OrbStatus.IGNORED,
        considerPriority: ConsiderPriority.INSISTS_ON_BEING_DONE,
        mayFreeRun: false,
        freeRun: function freeRun() {return false;}
      };

      return toReturn;
    }

    // Try setup something so we can prime this visit
  }, { key: "tryPrime", value: function tryPrime(adventure) {
      if (adventure.quest == null) {
        return;
      }

      // If this quest has an opinion on being primed
      if (adventure.quest.canAcceptPrimes != null) {
        // If this quest doesn't want to be primed
        if (!adventure.quest.canAcceptPrimes(adventure.quest)) {
          return;
        }
      } else {
        // Quest has no opinion on being primed, so decide it for ourselves
        // If this quest is one that is an absorb potential, or will be using a crystal ball
        if (
        adventure.orbStatus == OrbStatus.READY ||
        adventure.orbStatus == OrbStatus.NOT_SET)
        {
          return;
        }

        // We don't want to prime on something that might demand to be done later
        if (adventure.quest.mustBeDone != null) {
          return;
        }

        // If this quest is something that wants a prime itself
        if (adventure.quest.attemptPrime != null) {
          return;
        }
      }

      // We don't want to prime on something that would be potentially messy with outfit
      var outfit = adventure.adventure.outfit;

      if (
      outfit != null && (
      outfit == GreyOutfit.IGNORE_OUTFIT ||
      //outfit.plusCombatWeight > 0 ||
      //  outfit.minusCombatWeight > 0 ||
      outfit.extra.find(function (e) {return e.startsWith("+equip");}) != null))
      {
        return;
      }

      // So! This adventure is one we can prime on!
      var _iterator13 = GreyChooser_createForOfIteratorHelper(
        this.path.thisPath),_step13;try {for (_iterator13.s(); !(_step13 = _iterator13.n()).done;) {var _step13$value = GreyChooser_slicedToArray(_step13.value, 2),quest = _step13$value[0],path = _step13$value[1];
          if (quest == null || path == null) {
            continue;
          }

          if (quest.attemptPrime == null) {
            continue;
          }

          var status = quest.status(path);

          if (status == QuestStatus.COMPLETED) {
            continue;
          }

          var hasPrimed = quest.attemptPrime(path);

          // If this did not want to prime a resource
          if (!hasPrimed) {
            if (getPrimedResource() != null) {
              throw (
                quest.getId() +
                " claimed it didn't want to prime, but primed anyways");

            }
            continue;
          }

          var primed = getPrimedResource();

          if (primed == null) {
            throw (
              quest.getId() +
              " claimed to have prepared a primed resource, but nothing was set.");

          }

          (0,external_kolmafia_.print)(
          "This quest will attempt to prime " +
          ResourceCategory[primed.resource.type] +
          " (" +
          primed.resource.name +
          ") on this adventure as requested by " +
          primed.quest.getId(),
          "blue");

          return;
        }} catch (err) {_iterator13.e(err);} finally {_iterator13.f();}
    } }, { key: "findGoodVisit", value:

    function findGoodVisit() {
      var adv = this.findPrimedVisit();

      if (adv != null) {
        return adv;
      }

      var abortNotEnoughAdventures =
      (0,external_kolmafia_.myAdventures)() <= GreySettings_GreySettings.adventuresBeforeAbort;
      var generateAdventuresOrAbort =
      (0,external_kolmafia_.myAdventures)() <= GreySettings_GreySettings.adventuresGenerateIfPossibleOrAbort;

      if (abortNotEnoughAdventures) {
        (0,external_kolmafia_.print)(
        "We don't have enough adventures to feel comfortable, aborting..",
        "red");

        return;
      }

      var toNum = function toNum(status) {return (
          status == OrbStatus.IGNORED ? OrbStatus.NOT_SET : status);};
      var compareFreeRuns = (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_navelRunaways")) > 0;
      var levelingGoose = (0,external_kolmafia_.familiarWeight)(this.goose) >= 6;
      var prioritize = [
      "Council / War / Start",
      "Council / War / Frat Outfit",
      "Skills / MPRegen",
      "Skills / ScalingItem",
      "Council / MacGruffin / Black",
      "Council / War / Filthworms"];

      var prioritize2 = ["Manor / Kitchen"];
      // If we're using CMC and have consults remaining
      var sortIndoorLocations =
      GreySettings_GreySettings.greySwitchWorkshed != "" &&
      (0,external_kolmafia_.getWorkshed)() == external_kolmafia_.Item.get("Cold Medicine Cabinet") &&
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_coldMedicineConsults")) < 5;
      // If indoor locations now would be wasted
      var avoidIndoors =
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_nextColdMedicineConsult")) - (0,external_kolmafia_.totalTurnsPlayed)() >= 10;
      var prioritizeIndoors =
      !avoidIndoors &&
      (0,external_kolmafia_.getProperty)("lastCombatEnvironments").
      split("").
      filter(function (s) {return s == "i";}).length > 4;

      var pullsAdv = this.possibleAdventures.find(
      function (p) {return p.quest != null && p.quest.getId() == "Misc / Initial Pulls";});


      if (pullsAdv != null) {
        return pullsAdv;
      }

      this.possibleAdventures.sort(function (a1, a2) {var _a1$quest, _a2$quest, _a1$quest2, _a2$quest2;
        if (a1.considerPriority != a2.considerPriority) {
          return a1.considerPriority - a2.considerPriority;
        }

        if (toNum(a1.orbStatus) != toNum(a2.orbStatus)) {
          return a1.orbStatus - a2.orbStatus;
        }

        var p1 = prioritize.indexOf((_a1$quest = a1.quest) === null || _a1$quest === void 0 ? void 0 : _a1$quest.getId());
        var p2 = prioritize.indexOf((_a2$quest = a2.quest) === null || _a2$quest === void 0 ? void 0 : _a2$quest.getId());

        // Where the lower the index, the less we prioritize it
        if (p1 != p2) {
          return p2 - p1;
        }

        var banished1 =
        a1.adventure.location != null ?
        Object.keys((0,external_kolmafia_.getLocationMonsters)(a1.adventure.location)).filter(
        function (m) {return (0,external_kolmafia_.isBanished)(external_kolmafia_.Monster.get(m));}).
        length :
        0;
        var banished2 =
        a2.adventure.location != null ?
        Object.keys((0,external_kolmafia_.getLocationMonsters)(a2.adventure.location)).filter(
        function (m) {return (0,external_kolmafia_.isBanished)(external_kolmafia_.Monster.get(m));}).
        length :
        0;

        // If we've done banishes in one location..
        if (banished1 != banished2) {
          // We want the location with the most banishes to be prioritized
          return banished2 - banished1;
        }

        // If we're prioritizing indoors vs outdoors for w/e reason
        if (
        sortIndoorLocations &&
        a1.adventure.location != null &&
        a2.adventure.location != null)
        {
          var e1 = a1.adventure.location.environment;
          var e2 = a1.adventure.location.environment;

          if (e1 != e2 && (e1 == "indoor" || e2 == "indoor")) {
            // If we want to avoid indoors, then indoor locations are given a bad score
            if (avoidIndoors) {
              return e1 == "indoor" ? 1 : -1;
              // If we want to prioritize indoors, then indoor locations are given a good score
            } else if (prioritizeIndoors) {
              return e1 == "indoor" ? -1 : 1;
            }
          }
        }

        if (a1.quest == null != (a2.quest == null)) {
          return a1.quest == null ? 1 : -1;
        }

        if (a1.status != a2.status) {
          return a1.status - a2.status;
        }

        p1 = prioritize2.includes((_a1$quest2 = a1.quest) === null || _a1$quest2 === void 0 ? void 0 : _a1$quest2.getId()) ? -1 : 1;
        p2 = prioritize2.includes((_a2$quest2 = a2.quest) === null || _a2$quest2 === void 0 ? void 0 : _a2$quest2.getId()) ? -1 : 1;

        if (p1 != p2) {
          return p1 - p2;
        }

        if (a1.adventure.location == null != (a2.adventure.location == null)) {
          return a1.adventure.location == null ? -1 : 1;
        }

        if (compareFreeRuns && a1.mayFreeRun != a2.mayFreeRun) {
          // If we're trying to level our goose, we want to prioritize places we're not allowed to free run in

          if (levelingGoose) {
            return a1.mayFreeRun ? 1 : -1;
          }

          return a1.mayFreeRun ? -1 : 1;
        }

        return 0;
      });

      var mustBeDone = this.possibleAdventures.
      filter(
      function (adv) {return (
          adv.quest != null &&
          adv.quest.mustBeDone != null &&
          adv.quest.mustBeDone(false));}).

      map(function (a) {return [a, a.quest.free != null && a.quest.free() ? 0 : 1];});

      if (mustBeDone.length > 0) {
        mustBeDone.sort(function (_ref13, _ref14) {var _ref15 = GreyChooser_slicedToArray(_ref13, 2),m1 = _ref15[1];var _ref16 = GreyChooser_slicedToArray(_ref14, 2),m2 = _ref16[1];
          return m1 - m2;
        });

        if (
        mustBeDone.length > 1 &&
        mustBeDone[0][1] > 0 &&
        mustBeDone.find(function (_ref17) {var _ref18 = GreyChooser_slicedToArray(_ref17, 1),a = _ref18[0];return a.quest.mustBeDone(true);}) != null)
        {
          mustBeDone = mustBeDone.filter(function (_ref19) {var _ref20 = GreyChooser_slicedToArray(_ref19, 1),a = _ref20[0];return a.quest.mustBeDone(true);});
        }

        if (
        mustBeDone[0][1] > 0 &&
        mustBeDone.filter(function (_ref21) {var _ref22 = GreyChooser_slicedToArray(_ref21, 2),m = _ref22[1];return m > 0;}).length > 1)
        {
          (0,external_kolmafia_.print)(
          "Multiple quests demand to be done! " +
          mustBeDone.
          filter(function (_ref23) {var _ref24 = GreyChooser_slicedToArray(_ref23, 2),m = _ref24[1];return m > 0;}).
          map(function (a) {return a[0].quest.getId();}).
          join(", "),
          "red");

          (0,external_kolmafia_.print)("This is not a real error, but not that great either.", "red");
        }

        if (mustBeDone.length > 0) {
          return mustBeDone[0][0];
        }
      }

      if (generateAdventuresOrAbort && !this.hasEnoughGooseWeight()) {
        (0,external_kolmafia_.print)(
        "We need more adventures but we're not ready for a reabsorb..",
        "red");

        return;
      }

      if (this.possibleAdventures.length > 0) {
        var _adv2 = this.possibleAdventures[0];

        // If we don't want to go here.. Then consider our user friendly fam trainer!
        if (
        _adv2.considerPriority >= ConsiderPriority.BAD_ABSORB &&
        (0,external_kolmafia_.myMeat)() >= 1000 &&
        (0,external_kolmafia_.myAdventures)() >= 20)
        {
          return new EmergencyTrainer();
        }

        return this.possibleAdventures[0];
      }

      (0,external_kolmafia_.print)(
      "Failed to find any quests that are willing to run, and failed to find any non-quest locations willing to run.",
      "red");

      return null;
    } }], [{ key: "getPath", value: function getPath() {return AdventureFinder.instance.path;} }, { key: "recalculatePath", value: function recalculatePath() {AdventureFinder.instance.calculatePath();} }]);return AdventureFinder;}();GreyChooser_defineProperty(AdventureFinder, "instance", void 0);var


EmergencyTrainer = /*#__PURE__*/GreyChooser_createClass(function EmergencyTrainer() {GreyChooser_classCallCheck(this, EmergencyTrainer);GreyChooser_defineProperty(this, "locationInfo",
  null);GreyChooser_defineProperty(this, "adventure",
  {
    location: null,
    run: function run() {
      (0,external_kolmafia_.print)(
      "Oh gosh! Grey Goose underperforming? No worries! Emergency trainer is on the case! We're going to slam them into the cake arena, and they'll come out looking for a fight!",
      "blue");

      var fam = external_kolmafia_.Familiar.get("Grey Goose");
      (0,external_kolmafia_.useFamiliar)(fam);

      var chow = external_kolmafia_.Item.get("Ghost Dog Chow");

      if (
      (0,external_kolmafia_.itemAmount)(chow) > 0 &&
      (0,external_kolmafia_.historicalPrice)(chow) * 2 < GreySettings_GreySettings.greyValueOfAdventure)
      {
        (0,external_kolmafia_.print)("Oh gosh! Ghost Dog Chow is on the menu!", "blue");

        while ((0,external_kolmafia_.familiarWeight)(fam) < 6 && (0,external_kolmafia_.itemAmount)(chow) > 0) {
          (0,external_kolmafia_.use)(chow);
        }

        if ((0,external_kolmafia_.familiarWeight)(fam) >= 6) {
          return;
        }

        (0,external_kolmafia_.print)("Unfortunately Ghost Dog Chow wasn't enough!", "blue");
      }

      (0,external_kolmafia_.maximize)("familiar experience +familiar weight -tie", false);
      (0,external_kolmafia_.visitUrl)("arena.php");

      var turnsSpent = 0;

      while ((0,external_kolmafia_.familiarWeight)(fam) < 6) {
        if (turnsSpent >= 10) {
          throw "Spent 10 turns training grey goose, but no progress was made.";
        }

        var exp = fam.experience;

        turnsSpent++;
        (0,external_kolmafia_.cliExecute)("train turns 1");

        if (exp == fam.experience) {
          throw "Expected goose to have gained exp, it didn't.";
        }
      }
    }
  });GreyChooser_defineProperty(this, "path",
  null);GreyChooser_defineProperty(this, "quest",
  null);GreyChooser_defineProperty(this, "status",
  QuestStatus.READY);GreyChooser_defineProperty(this, "orbStatus",
  OrbStatus.IGNORED);GreyChooser_defineProperty(this, "considerPriority",
  ConsiderPriority.MUST_BE_DONE);GreyChooser_defineProperty(this, "mayFreeRun",
  false);GreyChooser_defineProperty(this, "freeRun",
  function () {return false;});});
;// CONCATENATED MODULE: ./src/tasks/TaskBoomboxSwitch.ts
function TaskBoomboxSwitch_typeof(obj) {"@babel/helpers - typeof";return TaskBoomboxSwitch_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, TaskBoomboxSwitch_typeof(obj);}function TaskBoomboxSwitch_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function TaskBoomboxSwitch_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, TaskBoomboxSwitch_toPropertyKey(descriptor.key), descriptor);}}function TaskBoomboxSwitch_createClass(Constructor, protoProps, staticProps) {if (protoProps) TaskBoomboxSwitch_defineProperties(Constructor.prototype, protoProps);if (staticProps) TaskBoomboxSwitch_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function TaskBoomboxSwitch_defineProperty(obj, key, value) {key = TaskBoomboxSwitch_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function TaskBoomboxSwitch_toPropertyKey(arg) {var key = TaskBoomboxSwitch_toPrimitive(arg, "string");return TaskBoomboxSwitch_typeof(key) === "symbol" ? key : String(key);}function TaskBoomboxSwitch_toPrimitive(input, hint) {if (TaskBoomboxSwitch_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (TaskBoomboxSwitch_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}


var TaskBoomboxSwitch = /*#__PURE__*/function () {function TaskBoomboxSwitch() {TaskBoomboxSwitch_classCallCheck(this, TaskBoomboxSwitch);TaskBoomboxSwitch_defineProperty(this, "boombox",
    external_kolmafia_.Item.get("SongBoom&trade; BoomBox"));TaskBoomboxSwitch_defineProperty(this, "canSkip",
    false);TaskBoomboxSwitch_defineProperty(this, "noneItem",
    external_kolmafia_.Item.none);TaskBoomboxSwitch_defineProperty(this, "skill",
    external_kolmafia_.Skill.get("Hivemindedness"));}TaskBoomboxSwitch_createClass(TaskBoomboxSwitch, [{ key: "isForgedRequired", value:

    function isForgedRequired() {
      return (0,external_kolmafia_.getProperty)("questL11Black") != "finished";
    } }, { key: "isZapWandRequired", value:

    function isZapWandRequired() {
      return (0,external_kolmafia_.getZapWand)() == this.noneItem;
    } }, { key: "getSongChangesLeft", value:

    function getSongChangesLeft() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_boomBoxSongsLeft"));
    } }, { key: "isMeatSong", value:

    function isMeatSong() {
      return (0,external_kolmafia_.getProperty)("boomBoxSong") == "Total Eclipse of Your Meat";
    } }, { key: "run", value:

    function run() {
      if (this.canSkip) {
        return;
      }

      // If we don't have the mp regen skill and we might run out of meat..
      if (!(0,external_kolmafia_.haveSkill)(this.skill) && (0,external_kolmafia_.myMeat)() < 15000) {
        return;
      }

      if ((0,external_kolmafia_.availableAmount)(this.boombox) == 0 || this.getSongChangesLeft() < 10) {
        this.canSkip = true;
        return;
      }

      if (this.getSongChangesLeft() < 11 && !this.isMeatSong()) {
        this.canSkip = true;
        return;
      }

      if (
      (0,external_kolmafia_.getProperty)("sidequestNunsCompleted") == "none" &&
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("hippiesDefeated")) >= 192)
      {
        return;
      }

      var requiredMeat =
      1000 + (
      this.isForgedRequired() ? 6000 : 0) + (
      this.isZapWandRequired() ? 5000 : 0);

      // If we have enough meat, switch to seasoning.
      if ((0,external_kolmafia_.myMeat)() < requiredMeat) {
        return;
      }

      (0,external_kolmafia_.cliExecute)("boombox food");
      this.canSkip = true;
    } }]);return TaskBoomboxSwitch;}();
;// CONCATENATED MODULE: ./src/tasks/TaskCouncil.ts
function TaskCouncil_typeof(obj) {"@babel/helpers - typeof";return TaskCouncil_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, TaskCouncil_typeof(obj);}function TaskCouncil_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function TaskCouncil_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, TaskCouncil_toPropertyKey(descriptor.key), descriptor);}}function TaskCouncil_createClass(Constructor, protoProps, staticProps) {if (protoProps) TaskCouncil_defineProperties(Constructor.prototype, protoProps);if (staticProps) TaskCouncil_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function TaskCouncil_defineProperty(obj, key, value) {key = TaskCouncil_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function TaskCouncil_toPropertyKey(arg) {var key = TaskCouncil_toPrimitive(arg, "string");return TaskCouncil_typeof(key) === "symbol" ? key : String(key);}function TaskCouncil_toPrimitive(input, hint) {if (TaskCouncil_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (TaskCouncil_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}


var TaskCouncil = /*#__PURE__*/function () {function TaskCouncil() {TaskCouncil_classCallCheck(this, TaskCouncil);TaskCouncil_defineProperty(this, "lastLevelVisited",
    (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastCouncilVisit")));}TaskCouncil_createClass(TaskCouncil, [{ key: "run", value:

    function run() {
      this.lastLevelVisited = Math.min(
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastCouncilVisit")),
      this.lastLevelVisited);


      if (this.lastLevelVisited >= (0,external_kolmafia_.myLevel)()) {
        return;
      }

      (0,external_kolmafia_.council)();
      this.lastLevelVisited = (0,external_kolmafia_.myLevel)();
      (0,external_kolmafia_.cliExecute)("refresh inventory");
    } }]);return TaskCouncil;}();
;// CONCATENATED MODULE: ./src/tasks/TaskEater.ts
function TaskEater_typeof(obj) {"@babel/helpers - typeof";return TaskEater_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, TaskEater_typeof(obj);}function TaskEater_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = TaskEater_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function TaskEater_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return TaskEater_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return TaskEater_arrayLikeToArray(o, minLen);}function TaskEater_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function TaskEater_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function TaskEater_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, TaskEater_toPropertyKey(descriptor.key), descriptor);}}function TaskEater_createClass(Constructor, protoProps, staticProps) {if (protoProps) TaskEater_defineProperties(Constructor.prototype, protoProps);if (staticProps) TaskEater_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function TaskEater_defineProperty(obj, key, value) {key = TaskEater_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function TaskEater_toPropertyKey(arg) {var key = TaskEater_toPrimitive(arg, "string");return TaskEater_typeof(key) === "symbol" ? key : String(key);}function TaskEater_toPrimitive(input, hint) {if (TaskEater_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (TaskEater_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}



var TaskEater = /*#__PURE__*/function () {















  function TaskEater() {TaskEater_classCallCheck(this, TaskEater);TaskEater_defineProperty(this, "prop", "_greyEatenToday");TaskEater_defineProperty(this, "npcFoods", ["Hot buttered roll", "Ketchup", "Catsup", "cup of lukewarm tea", "Fortune Cookie", "Pickled Egg"].map(function (s) {return external_kolmafia_.Item.get(s);}));TaskEater_defineProperty(this, "keepOnHand", ["Bunch of square grapes", "Boxed Wine"].map(function (s) {return external_kolmafia_.Item.get(s);}));TaskEater_defineProperty(this, "blackberry", external_kolmafia_.Item.get("Blackberry"));TaskEater_defineProperty(this, "seasoning", external_kolmafia_.Item.get("Special Seasoning"));
    if ((0,external_kolmafia_.getProperty)(this.prop) == "") {
      var dontEat = [];
      // Goat cheese quest
      dontEat.push(external_kolmafia_.Item.get("Goat Cheese"));

      // Are you sure you want to eat this bla bla
      // Suppress that annoying "pvp stone no brokey??"
      dontEat.push(external_kolmafia_.Item.get("Can of Red Minotaur"));
      dontEat.push(external_kolmafia_.Item.get("Watered-down Red Minotaur"));

      // Palin quest items
      dontEat.push(external_kolmafia_.Item.get("Stunt Nuts"));
      dontEat.push(external_kolmafia_.Item.get("Wet Stew"));

      // Azeal booze quest items
      dontEat.push(external_kolmafia_.Item.get("Giant marshmallow"));
      dontEat.push(external_kolmafia_.Item.get("Booze-soaked cherry"));
      dontEat.push(external_kolmafia_.Item.get("Sponge cake"));
      dontEat.push(external_kolmafia_.Item.get("Gin-soaked blotter paper"));

      // Protesters quest item
      dontEat.push(external_kolmafia_.Item.get("Unnamed cocktail"));
      dontEat.push(external_kolmafia_.Item.get("Flamin' Whatshisname"));

      // Insufficient level
      dontEat.push(external_kolmafia_.Item.get("Pie man was not meant to eat"));

      // Robortender driveby
      if ((0,external_kolmafia_.haveFamiliar)(external_kolmafia_.Familiar.get("Robortender"))) {
        dontEat.push(external_kolmafia_.Item.get("Grapefruit"));
      }

      (0,external_kolmafia_.setProperty)(this.prop, dontEat.map(function (s) {return (0,external_kolmafia_.toInt)(s);}).join(","));
    }
  }TaskEater_createClass(TaskEater, [{ key: "doAlwaysAvailable", value:

    function doAlwaysAvailable(eaten) {
      if ((0,external_kolmafia_.myMeat)() < 2000) {
        return;
      }

      var pants = external_kolmafia_.Item.get("Designer Sweatpants");var _iterator = TaskEater_createForOfIteratorHelper(

        this.npcFoods),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var item = _step.value;
          var id = (0,external_kolmafia_.toInt)(item).toString();

          if (eaten.includes(id)) {
            continue;
          }

          if ((0,external_kolmafia_.availableAmount)(pants) > 0 && (0,external_kolmafia_.equippedAmount)(pants) == 0) {
            (0,external_kolmafia_.equip)(pants);
          }

          (0,external_kolmafia_.cliExecute)("acquire 1 " + item.name);
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
    } }, { key: "doTavern", value:

    function doTavern() {
      if ((0,external_kolmafia_.getProperty)("questL03Rat") != "finished" || (0,external_kolmafia_.myMeat)() < 2000) {
        return;
      }
    } }, { key: "doChez", value:

    function doChez(eaten) {
      if (!(0,external_kolmafia_.canadiaAvailable)() || (0,external_kolmafia_.myMeat)() < 2000) {
        return;
      }

      var daily = (0,external_kolmafia_.toInt)(external_kolmafia_.Item.get((0,external_kolmafia_.getProperty)("_dailySpecial"))).toString();

      if (eaten.includes(daily)) {
        return;
      }

      eaten.push(daily);

      for (var _i = 0, _arr = ["-1", "-2", "-3", daily]; _i < _arr.length; _i++) {var itemId = _arr[_i];
        (0,external_kolmafia_.visitUrl)("cafe.php?cafeid=1&pwd=&action=CONSUME!&whichitem=" + itemId);
      }
    } }, { key: "doGnomes", value:

    function doGnomes(eaten) {
      if (!(0,external_kolmafia_.gnomadsAvailable)() || (0,external_kolmafia_.myMeat)() < 2000) {
        return;
      }

      var daily = (0,external_kolmafia_.toInt)(external_kolmafia_.Item.get((0,external_kolmafia_.getProperty)("_dailySpecial"))).toString();

      if (eaten.includes(daily)) {
        return;
      }

      eaten.push(daily);

      for (var _i2 = 0, _arr2 = ["-1", "-2", "-3", daily]; _i2 < _arr2.length; _i2++) {var itemId = _arr2[_i2];
        (0,external_kolmafia_.visitUrl)("cafe.php?cafeid=2&pwd=&action=CONSUME!&whichitem=" + itemId);
      }
    } }, { key: "run", value:

    function run() {
      if ((0,external_kolmafia_.pullsRemaining)() == -1) {
        return;
      }

      var eaten = (0,external_kolmafia_.getProperty)(this.prop).split(",");

      this.doAlwaysAvailable(eaten);
      this.doChez(eaten);
      this.doGnomes(eaten);

      for (var _i3 = 0, _Object$keys = Object.keys((0,external_kolmafia_.getInventory)()); _i3 < _Object$keys.length; _i3++) {var i = _Object$keys[_i3];
        var item = external_kolmafia_.Item.get(i);

        if (item.fullness == 0 && item.inebriety == 0 && item.spleen == 0) {
          continue;
        }

        if ((0,external_kolmafia_.availableAmount)(item) <= 1 && this.keepOnHand.includes(item)) {
          continue;
        }

        if (item.levelreq > (0,external_kolmafia_.myLevel)() || !item.tradeable || item.quest) {
          continue;
        }

        if (eaten.includes((0,external_kolmafia_.toInt)(item) + "") || (0,external_kolmafia_.historicalPrice)(item) > 4000) {
          continue;
        }

        if (item == this.blackberry && getQuestStatus("questL11Black") <= 1) {
          continue;
        }

        if (item.fullness > 0) {
          if ((0,external_kolmafia_.itemAmount)(this.seasoning) > 0) {
            (0,external_kolmafia_.putCloset)((0,external_kolmafia_.itemAmount)(this.seasoning), this.seasoning);
          }

          (0,external_kolmafia_.visitUrl)("inv_eat.php?pwd&which=1&whichitem=".concat((0,external_kolmafia_.toInt)(item)), true);
        } else if (item.inebriety > 0) {
          (0,external_kolmafia_.visitUrl)("inv_booze.php?pwd&which=1&&whichitem=".concat((0,external_kolmafia_.toInt)(item)), true);
        } else if (item.spleen > 0) {
          (0,external_kolmafia_.visitUrl)("inv_spleen.php?pwd&which=1&&whichitem=".concat((0,external_kolmafia_.toInt)(item)), true);
        }

        eaten.push((0,external_kolmafia_.toInt)(item).toString());
      }

      (0,external_kolmafia_.setProperty)(this.prop, eaten.join(","));
    } }, { key: "tryMakeCraftables", value:

    function tryMakeCraftables() {} }]);return TaskEater;}();
;// CONCATENATED MODULE: ./src/tasks/TaskEquipDistillery.ts
function TaskEquipDistillery_typeof(obj) {"@babel/helpers - typeof";return TaskEquipDistillery_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, TaskEquipDistillery_typeof(obj);}function TaskEquipDistillery_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function TaskEquipDistillery_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, TaskEquipDistillery_toPropertyKey(descriptor.key), descriptor);}}function TaskEquipDistillery_createClass(Constructor, protoProps, staticProps) {if (protoProps) TaskEquipDistillery_defineProperties(Constructor.prototype, protoProps);if (staticProps) TaskEquipDistillery_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function TaskEquipDistillery_defineProperty(obj, key, value) {key = TaskEquipDistillery_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function TaskEquipDistillery_toPropertyKey(arg) {var key = TaskEquipDistillery_toPrimitive(arg, "string");return TaskEquipDistillery_typeof(key) === "symbol" ? key : String(key);}function TaskEquipDistillery_toPrimitive(input, hint) {if (TaskEquipDistillery_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (TaskEquipDistillery_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}


var TaskEquipDistillery = /*#__PURE__*/function () {function TaskEquipDistillery() {TaskEquipDistillery_classCallCheck(this, TaskEquipDistillery);TaskEquipDistillery_defineProperty(this, "gelcube",
    external_kolmafia_.Familiar.get("Gelatinous Cubeling"));TaskEquipDistillery_defineProperty(this, "distill",
    external_kolmafia_.Item.get("Tiny stillsuit"));TaskEquipDistillery_defineProperty(this, "lastChecked",
    0);}TaskEquipDistillery_createClass(TaskEquipDistillery, [{ key: "run", value:

    function run() {
      if ((0,external_kolmafia_.itemAmount)(this.distill) == 0) {
        return;
      }

      if (!(0,external_kolmafia_.haveFamiliar)(this.gelcube) || (0,external_kolmafia_.myFamiliar)() == this.gelcube) {
        return;
      }

      if (this.lastChecked == (0,external_kolmafia_.totalTurnsPlayed)()) {
        return;
      }

      this.lastChecked = (0,external_kolmafia_.totalTurnsPlayed)();

      (0,external_kolmafia_.visitUrl)("familiar.php?action=equip&pwd=&whichfam=171&whichitem=10932");
    } }]);return TaskEquipDistillery;}();
;// CONCATENATED MODULE: ./src/tasks/TaskFuelAsdon.ts
function TaskFuelAsdon_typeof(obj) {"@babel/helpers - typeof";return TaskFuelAsdon_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, TaskFuelAsdon_typeof(obj);}function TaskFuelAsdon_slicedToArray(arr, i) {return TaskFuelAsdon_arrayWithHoles(arr) || TaskFuelAsdon_iterableToArrayLimit(arr, i) || TaskFuelAsdon_unsupportedIterableToArray(arr, i) || TaskFuelAsdon_nonIterableRest();}function TaskFuelAsdon_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function TaskFuelAsdon_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return TaskFuelAsdon_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return TaskFuelAsdon_arrayLikeToArray(o, minLen);}function TaskFuelAsdon_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function TaskFuelAsdon_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function TaskFuelAsdon_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function TaskFuelAsdon_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function TaskFuelAsdon_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, TaskFuelAsdon_toPropertyKey(descriptor.key), descriptor);}}function TaskFuelAsdon_createClass(Constructor, protoProps, staticProps) {if (protoProps) TaskFuelAsdon_defineProperties(Constructor.prototype, protoProps);if (staticProps) TaskFuelAsdon_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function TaskFuelAsdon_defineProperty(obj, key, value) {key = TaskFuelAsdon_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function TaskFuelAsdon_toPropertyKey(arg) {var key = TaskFuelAsdon_toPrimitive(arg, "string");return TaskFuelAsdon_typeof(key) === "symbol" ? key : String(key);}function TaskFuelAsdon_toPrimitive(input, hint) {if (TaskFuelAsdon_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (TaskFuelAsdon_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}



var TaskFuelAsdon = /*#__PURE__*/function () {function TaskFuelAsdon() {TaskFuelAsdon_classCallCheck(this, TaskFuelAsdon);TaskFuelAsdon_defineProperty(this, "sodaBread",
    external_kolmafia_.Item.get("Loaf of Soda Bread"));TaskFuelAsdon_defineProperty(this, "eachFuelWorth",
    24);TaskFuelAsdon_defineProperty(this, "invalidFuels",
    []);TaskFuelAsdon_defineProperty(this, "asdonMartin",
    external_kolmafia_.Item.get("Asdon Martin keyfob"));TaskFuelAsdon_defineProperty(this, "flower",
    external_kolmafia_.Item.get("All-purpose flower"));TaskFuelAsdon_defineProperty(this, "dough",
    external_kolmafia_.Item.get("Wad of Dough"));}TaskFuelAsdon_createClass(TaskFuelAsdon, [{ key: "run", value:

    function run() {
      if (
      (0,external_kolmafia_.myMeat)() < 8000 ||
      (0,external_kolmafia_.getWorkshed)() != this.asdonMartin ||
      getQuestStatus("questL11Black") < 2)
      {
        return;
      }

      if ((0,external_kolmafia_.getFuel)() >= 150) {
        return;
      }

      if (!this.canMakeBread()) {
        return;
      }

      while ((0,external_kolmafia_.myMeat)() > 4500 && (0,external_kolmafia_.getFuel)() < 50) {
        // Each soda bread is worth 5-7 so lets always keep 50 / 6 = 9ish on hand
        var toUse = Math.ceil((50 - (0,external_kolmafia_.getFuel)()) / 6);
        this.acquireBread(toUse);

        (0,external_kolmafia_.cliExecute)("asdonmartin fuel " + toUse + " " + this.sodaBread);
      }
    } }, { key: "acquireBread", value:

    function acquireBread(amount) {
      if ((0,external_kolmafia_.haveOutfit)("bugbear costume")) {
        return;
      }

      while ((0,external_kolmafia_.myMeat)() > 2000 && (0,external_kolmafia_.availableAmount)(this.dough) < amount) {
        (0,external_kolmafia_.buy)(this.flower);
        (0,external_kolmafia_.use)(this.flower);
      }
    } }, { key: "canMakeBread", value:

    function canMakeBread() {
      return (
        (0,external_kolmafia_.haveOutfit)("Bugbear Costume") ||
        (0,external_kolmafia_.myAscensions)() > 10 &&
        (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastDesertUnlock")) == (0,external_kolmafia_.myAscensions)() &&
        (0,external_kolmafia_.myMeat)() > 2000);

    } }, { key: "getAvailableItems", value:

    function getAvailableItems() {
      // Returns <Item, Amount, Each Fuel Worth in Mall>
      var items = [];

      for (var _i = 0, _Object$entries = Object.entries((0,external_kolmafia_.getInventory)()); _i < _Object$entries.length; _i++) {var _Object$entries$_i = TaskFuelAsdon_slicedToArray(_Object$entries[_i], 2),itemName = _Object$entries$_i[0],amount = _Object$entries$_i[1];
        var item = external_kolmafia_.Item.get(itemName);

        if (this.invalidFuels.includes(item)) {
          continue;
        }

        if (item.fullness == 0 && item.inebriety == 0) {
          this.invalidFuels.push(item);
          continue;
        }

        if (item.quest || !item.tradeable || item.gift) {
          this.invalidFuels.push(item);
          continue;
        }

        var histPrice = (0,external_kolmafia_.historicalPrice)(item);

        if (histPrice <= 10) {
          continue;
        }

        if (!item.adventures.match(/^[0-9]+(-[0-9]+)?$/)) {
          this.invalidFuels.push(item);
          continue;
        }

        // Make sure we don't consume something great
        if (
        item.quality != "crappy" &&
        item.quality != "decent" &&
        item.quality != "good")
        {
          histPrice = Math.max(histPrice, (0,external_kolmafia_.mallPrice)(item));
        }

        var advs = (0,external_kolmafia_.toInt)(item.adventures.split("-")[0]);
        var costPerFuel = histPrice / advs;

        // If the fuel would cost more than soda bread..
        if (costPerFuel > this.eachFuelWorth) {
          this.invalidFuels.push(item);
          continue;
        }

        items.push([item, amount, costPerFuel]);
      }

      return items;
    } }]);return TaskFuelAsdon;}();
;// CONCATENATED MODULE: ./src/tasks/TaskJuneCleaver.ts
function TaskJuneCleaver_typeof(obj) {"@babel/helpers - typeof";return TaskJuneCleaver_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, TaskJuneCleaver_typeof(obj);}function TaskJuneCleaver_slicedToArray(arr, i) {return TaskJuneCleaver_arrayWithHoles(arr) || TaskJuneCleaver_iterableToArrayLimit(arr, i) || TaskJuneCleaver_unsupportedIterableToArray(arr, i) || TaskJuneCleaver_nonIterableRest();}function TaskJuneCleaver_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function TaskJuneCleaver_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function TaskJuneCleaver_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function TaskJuneCleaver_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = TaskJuneCleaver_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function TaskJuneCleaver_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return TaskJuneCleaver_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return TaskJuneCleaver_arrayLikeToArray(o, minLen);}function TaskJuneCleaver_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function TaskJuneCleaver_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function TaskJuneCleaver_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, TaskJuneCleaver_toPropertyKey(descriptor.key), descriptor);}}function TaskJuneCleaver_createClass(Constructor, protoProps, staticProps) {if (protoProps) TaskJuneCleaver_defineProperties(Constructor.prototype, protoProps);if (staticProps) TaskJuneCleaver_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function TaskJuneCleaver_defineProperty(obj, key, value) {key = TaskJuneCleaver_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function TaskJuneCleaver_toPropertyKey(arg) {var key = TaskJuneCleaver_toPrimitive(arg, "string");return TaskJuneCleaver_typeof(key) === "symbol" ? key : String(key);}function TaskJuneCleaver_toPrimitive(input, hint) {if (TaskJuneCleaver_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (TaskJuneCleaver_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}
var


CleaverChoices;(function (CleaverChoices) {CleaverChoices[CleaverChoices["AUNTS_NOT_ANTS"] = 1468] = "AUNTS_NOT_ANTS";CleaverChoices[CleaverChoices["BATH_TIME"] = 1473] = "BATH_TIME";CleaverChoices[CleaverChoices["BEWARE_OF_ALIGATOR"] = 1469] = "BEWARE_OF_ALIGATOR";CleaverChoices[CleaverChoices["DELICIOUS_SPROUTS"] = 1474] = "DELICIOUS_SPROUTS";CleaverChoices[CleaverChoices["HYPNOTIC_MASTER"] = 1475] = "HYPNOTIC_MASTER";CleaverChoices[CleaverChoices["LOST_AND_FOUND"] = 1471] = "LOST_AND_FOUND";CleaverChoices[CleaverChoices["POETIC_JUSTICE"] = 1467] = "POETIC_JUSTICE";CleaverChoices[CleaverChoices["SUMMER_DAYS"] = 1472] = "SUMMER_DAYS";CleaverChoices[CleaverChoices["TEACHERS_PET"] = 1470] = "TEACHERS_PET";})(CleaverChoices || (CleaverChoices = {}));











var TaskJuneCleaver = /*#__PURE__*/function () {function TaskJuneCleaver() {TaskJuneCleaver_classCallCheck(this, TaskJuneCleaver);TaskJuneCleaver_defineProperty(this, "teachersPen",
    external_kolmafia_.Item.get("Teacher's Pen"));TaskJuneCleaver_defineProperty(this, "eatenProp",
    "_greyEatenToday");TaskJuneCleaver_defineProperty(this, "fireTrout",
    external_kolmafia_.Item.get("fire-roasted lake trout"));TaskJuneCleaver_defineProperty(this, "cosplay",

    (0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("Fourth of May Cosplay Saber")) > 0);}TaskJuneCleaver_createClass(TaskJuneCleaver, [{ key: "run", value:

    function run() {
      var wantsKitchen =
      !this.cosplay &&
      getQuestStatus("questM20Necklace") == 0 &&
      (0,external_kolmafia_.myLevel)() >= 4;
      var peakProgress = (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("booPeakProgress"));
      var wantsBooPeak =
      !this.cosplay && peakProgress > 0 && peakProgress < 100;

      var choices = new Map();

      choices.set(CleaverChoices.AUNTS_NOT_ANTS, 1); // moxie stats

      choices.set(CleaverChoices.BATH_TIME, 3); // +3 hot res, 50 init

      if (wantsBooPeak) {
        choices.set(CleaverChoices.BATH_TIME, 2); // +2 spooky, stench, sleaze res. +15 DR
      }

      choices.set(CleaverChoices.BEWARE_OF_ALIGATOR, 3); // 1500 meat
      choices.set(CleaverChoices.DELICIOUS_SPROUTS, 2); // Guilty Sprouts
      choices.set(CleaverChoices.HYPNOTIC_MASTER, 1); // Mother's Necklace
      choices.set(CleaverChoices.LOST_AND_FOUND, 1); // Savings bond +50 meat
      choices.set(CleaverChoices.POETIC_JUSTICE, 3); // +5 advs, +5 beaten up
      choices.set(CleaverChoices.SUMMER_DAYS, 2); // Fire roasted trout
      choices.set(CleaverChoices.TEACHERS_PET, 2); // Teacher's Pen

      if (
      (0,external_kolmafia_.availableAmount)(this.fireTrout) > 0 ||
      (0,external_kolmafia_.getProperty)(this.eatenProp).
      split(",").
      includes((0,external_kolmafia_.toInt)(this.fireTrout).toString()))
      {
        choices.set(CleaverChoices.SUMMER_DAYS, 1); // -5 combat potion
      }

      var hasSkips = (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_juneCleaverSkips")) < 5;

      if (hasSkips) {
        choices.set(CleaverChoices.AUNTS_NOT_ANTS, 4);

        // If we don't want to do the kitchen..
        // This generally works pretty well for the +init boost tbh
        if (!wantsKitchen) {
          choices.set(CleaverChoices.BATH_TIME, 4);
        }

        choices.set(CleaverChoices.DELICIOUS_SPROUTS, 4);
        choices.set(CleaverChoices.HYPNOTIC_MASTER, 4);
        choices.set(CleaverChoices.SUMMER_DAYS, 4);

        if ((0,external_kolmafia_.availableAmount)(this.teachersPen) > 1) {
          choices.set(CleaverChoices.TEACHERS_PET, 4);
        }
      }var _iterator = TaskJuneCleaver_createForOfIteratorHelper(

        choices),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var _step$value = TaskJuneCleaver_slicedToArray(_step.value, 2),choice = _step$value[0],value = _step$value[1];
          (0,external_kolmafia_.setProperty)("choiceAdventure" + choice, value.toString());
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
    } }]);return TaskJuneCleaver;}();
;// CONCATENATED MODULE: ./src/tasks/TaskLatteFiller.ts
function TaskLatteFiller_typeof(obj) {"@babel/helpers - typeof";return TaskLatteFiller_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, TaskLatteFiller_typeof(obj);}function TaskLatteFiller_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function TaskLatteFiller_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, TaskLatteFiller_toPropertyKey(descriptor.key), descriptor);}}function TaskLatteFiller_createClass(Constructor, protoProps, staticProps) {if (protoProps) TaskLatteFiller_defineProperties(Constructor.prototype, protoProps);if (staticProps) TaskLatteFiller_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function TaskLatteFiller_defineProperty(obj, key, value) {key = TaskLatteFiller_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function TaskLatteFiller_toPropertyKey(arg) {var key = TaskLatteFiller_toPrimitive(arg, "string");return TaskLatteFiller_typeof(key) === "symbol" ? key : String(key);}function TaskLatteFiller_toPrimitive(input, hint) {if (TaskLatteFiller_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (TaskLatteFiller_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}



var TaskLatteFiller = /*#__PURE__*/function () {function TaskLatteFiller() {TaskLatteFiller_classCallCheck(this, TaskLatteFiller);TaskLatteFiller_defineProperty(this, "skipLatte",
    (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_latteRefillsUsed")) > 0);TaskLatteFiller_defineProperty(this, "latte",
    external_kolmafia_.Item.get("Latte lovers member's mug"));TaskLatteFiller_defineProperty(this, "ghostBuster",
    external_kolmafia_.Item.get("Protonic accelerator pack"));}TaskLatteFiller_createClass(TaskLatteFiller, [{ key: "run", value:

    function run() {
      if (this.skipLatte) {
        return;
      }

      if ((0,external_kolmafia_.availableAmount)(this.latte) == 0) {
        this.skipLatte = true;
        return;
      }

      var firstFlavor =
      (0,external_kolmafia_.availableAmount)(this.ghostBuster) > 0 ?
      LatteFlavor.PLUS_COMBAT :
      LatteFlavor.FAMILIAR_WEIGHT;

      var flavors = [
      firstFlavor,
      LatteFlavor.MEAT_DROP,
      LatteFlavor.FAM_EXP];


      var currentFlavors = getCurrentLatteFlavors();

      if (flavors.filter(function (f) {return !currentFlavors.includes(f);}).length == 0) {
        this.skipLatte = true;
        return;
      }

      var notUnlocked = flavors.filter(function (f) {return !hasUnlockedLatteFlavor(f);});

      if (notUnlocked.length > 0) {
        return;
      }

      if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_latteRefillsUsed")) > 0) {
        throw "latte was refilled but we don't remember that!";
      }

      (0,external_kolmafia_.cliExecute)("latte refill " + flavors.join(" "));
      (0,external_kolmafia_.visitUrl)("main.php");
    } }]);return TaskLatteFiller;}();
;// CONCATENATED MODULE: ./src/tasks/TaskSellCrap.ts
function TaskSellCrap_typeof(obj) {"@babel/helpers - typeof";return TaskSellCrap_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, TaskSellCrap_typeof(obj);}function TaskSellCrap_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = TaskSellCrap_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function TaskSellCrap_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return TaskSellCrap_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return TaskSellCrap_arrayLikeToArray(o, minLen);}function TaskSellCrap_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function TaskSellCrap_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function TaskSellCrap_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, TaskSellCrap_toPropertyKey(descriptor.key), descriptor);}}function TaskSellCrap_createClass(Constructor, protoProps, staticProps) {if (protoProps) TaskSellCrap_defineProperties(Constructor.prototype, protoProps);if (staticProps) TaskSellCrap_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function TaskSellCrap_defineProperty(obj, key, value) {key = TaskSellCrap_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function TaskSellCrap_toPropertyKey(arg) {var key = TaskSellCrap_toPrimitive(arg, "string");return TaskSellCrap_typeof(key) === "symbol" ? key : String(key);}function TaskSellCrap_toPrimitive(input, hint) {if (TaskSellCrap_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (TaskSellCrap_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}


var TaskSellCrap = /*#__PURE__*/function () {function TaskSellCrap() {TaskSellCrap_classCallCheck(this, TaskSellCrap);TaskSellCrap_defineProperty(this, "autosells",
    ["dense meat stack", "meat stack"].map(function (s) {return (
        external_kolmafia_.Item.get(s));}));TaskSellCrap_defineProperty(this, "junk",

    [
    "adder bladder",
    "loose teeth",
    "skeleton bone",
    "bottle of whiskey",
    "cranberries",
    "spiked femur",
    "batgut",
    "bat wing",
    "bone flute",
    "bottle of rum",
    "bottle of tequila",
    "spooky stick",
    "tequila grenade",
    "ancient frozen dinner",
    "accidental cider",
    "bottle of gin",
    "imp ale",
    "hot wing",
    "hellion cube",
    "hot katana blade",
    "ice-cold Willer",
    "lihc eye",
    "snifter of thoroughly aged brandy",
    "wussiness potion",
    "ancient pills",
    "Fat stacks of cash"].
    map(function (s) {return external_kolmafia_.Item.get(s);}));TaskSellCrap_defineProperty(this, "autouse",
    [
    "Ancient Vinyl Coin Purse",
    "Black Pension Check",
    "CSA Discount Card",
    "Fat Wallet",
    "Gathered Meat-Clip",
    "Old Leather Wallet",
    "Penultimate Fantasy Chest",
    "Pixellated Moneybag",
    "Old Coin Purse",
    "Shiny Stones",
    "Briefcase"].
    map(function (s) {return external_kolmafia_.Item.get(s);}));TaskSellCrap_defineProperty(this, "teachersPen",
    external_kolmafia_.Item.get("Teacher's Pen"));}TaskSellCrap_createClass(TaskSellCrap, [{ key: "run", value:

    function run() {
      var count = (0,external_kolmafia_.availableAmount)(this.teachersPen);

      if (count > 1) {
        if (
        count > 2 &&
        (0,external_kolmafia_.itemAmount)(this.teachersPen) > 0 &&
        (0,external_kolmafia_.pullsRemaining)() >= 0)
        {
          (0,external_kolmafia_.print)(
          "Selling a Teacher's Pen because Irrat is too lazy to handle too much accessories with +fam exp");

          (0,external_kolmafia_.autosell)(this.teachersPen, 1);
        }
      }

      if ((0,external_kolmafia_.myMeat)() > 15000) {
        return;
      }var _iterator = TaskSellCrap_createForOfIteratorHelper(

        this.autosells),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var i = _step.value;
          if ((0,external_kolmafia_.itemAmount)(i) == 0) {
            continue;
          }

          (0,external_kolmafia_.autosell)((0,external_kolmafia_.itemAmount)(i), i);
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}var _iterator2 = TaskSellCrap_createForOfIteratorHelper(

        this.autouse),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var _i = _step2.value;
          if ((0,external_kolmafia_.itemAmount)(_i) == 0) {
            continue;
          }

          (0,external_kolmafia_.use)((0,external_kolmafia_.itemAmount)(_i), _i);
        }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}var _iterator3 = TaskSellCrap_createForOfIteratorHelper(

        this.junk),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var _i2 = _step3.value;
          if ((0,external_kolmafia_.itemAmount)(_i2) <= 1) {
            continue;
          }

          (0,external_kolmafia_.autosell)((0,external_kolmafia_.itemAmount)(_i2) - 1, _i2);
        }} catch (err) {_iterator3.e(err);} finally {_iterator3.f();}
    } }]);return TaskSellCrap;}();
;// CONCATENATED MODULE: ./src/tasks/TaskMedicineCabinet.ts
function TaskMedicineCabinet_typeof(obj) {"@babel/helpers - typeof";return TaskMedicineCabinet_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, TaskMedicineCabinet_typeof(obj);}function TaskMedicineCabinet_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function TaskMedicineCabinet_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, TaskMedicineCabinet_toPropertyKey(descriptor.key), descriptor);}}function TaskMedicineCabinet_createClass(Constructor, protoProps, staticProps) {if (protoProps) TaskMedicineCabinet_defineProperties(Constructor.prototype, protoProps);if (staticProps) TaskMedicineCabinet_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function TaskMedicineCabinet_defineProperty(obj, key, value) {key = TaskMedicineCabinet_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function TaskMedicineCabinet_toPropertyKey(arg) {var key = TaskMedicineCabinet_toPrimitive(arg, "string");return TaskMedicineCabinet_typeof(key) === "symbol" ? key : String(key);}function TaskMedicineCabinet_toPrimitive(input, hint) {if (TaskMedicineCabinet_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (TaskMedicineCabinet_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}



var TaskColdMedicineCabinet = /*#__PURE__*/function () {function TaskColdMedicineCabinet() {TaskMedicineCabinet_classCallCheck(this, TaskColdMedicineCabinet);TaskMedicineCabinet_defineProperty(this, "lastChecked",
    "_lastCheckedCabinet");TaskMedicineCabinet_defineProperty(this, "hat",
    external_kolmafia_.Item.get("Ice Crown"));TaskMedicineCabinet_defineProperty(this, "pants",
    external_kolmafia_.Item.get("frozen jeans"));TaskMedicineCabinet_defineProperty(this, "cabinet",
    external_kolmafia_.Item.get("Cold medicine cabinet"));TaskMedicineCabinet_defineProperty(this, "triedSwitch",
    false);}TaskMedicineCabinet_createClass(TaskColdMedicineCabinet, [{ key: "getConsults", value:

    function getConsults() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_coldMedicineConsults"));
    } }, { key: "hasConsults", value:

    function hasConsults() {
      return this.getConsults() < 5;
    } }, { key: "getNextConsult", value:

    function getNextConsult() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_nextColdMedicineConsult")) - (0,external_kolmafia_.totalTurnsPlayed)();
    } }, { key: "isConsultReady", value:

    function isConsultReady() {
      return this.hasConsults() && this.getNextConsult() <= 0;
    } }, { key: "isIndoors", value:

    function isIndoors() {
      return (
        (0,external_kolmafia_.getProperty)("lastCombatEnvironments").
        split("").
        filter(function (s) {return s == "i";}).length > 10);

    } }, { key: "isUnderground", value:

    function isUnderground() {
      return (
        (0,external_kolmafia_.getProperty)("lastCombatEnvironments").
        split("").
        filter(function (s) {return s == "u";}).length > 10);

    } }, { key: "getLastChecked", value:

    function getLastChecked() {
      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)(this.lastChecked));
    } }, { key: "shouldCheck", value:

    function shouldCheck() {
      return this.getLastChecked() + 2 <= (0,external_kolmafia_.totalTurnsPlayed)();
    } }, { key: "check", value:

    function check() {
      var page = (0,external_kolmafia_.visitUrl)("campground.php?action=workshed");

      (0,external_kolmafia_.setProperty)(this.lastChecked, (0,external_kolmafia_.totalTurnsPlayed)().toString());

      if (!(0,external_kolmafia_.handlingChoice)()) {
        return;
      }

      if ((0,external_kolmafia_.lastChoice)() != 1455) {
        throw "Unexpected situation";
      }

      if (GreySettings_GreySettings.isHardcoreMode() && (0,external_kolmafia_.availableAmount)(this.pants) == 0) {
        (0,external_kolmafia_.runChoice)(1);
      } else if (
      page.includes("Extrovermectin&trade;") ||
      page.includes("Breathitin&trade;"))
      {
        (0,external_kolmafia_.runChoice)(5);
      } else {
        (0,external_kolmafia_.visitUrl)("main.php");
      }
    } }, { key: "run", value:

    function run() {
      if (
      (0,external_kolmafia_.getWorkshed)() == external_kolmafia_.Item.none &&
      GreySettings_GreySettings.greyDefaultWorkshed != "" &&
      (0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get(GreySettings_GreySettings.greyDefaultWorkshed)) > 0)
      {
        (0,external_kolmafia_.use)(external_kolmafia_.Item.get(GreySettings_GreySettings.greyDefaultWorkshed));
      }

      if ((0,external_kolmafia_.getWorkshed)() != this.cabinet) {
        return;
      }

      this.trySwitch();

      if (!this.isConsultReady()) {
        return;
      }

      if (!this.shouldCheck()) {
        return;
      }

      // If we would not get extro
      if (!this.isIndoors()) {
        // If we don't care about breathitin
        if (GreySettings_GreySettings.greySwitchWorkshed == "") {
          return;
        }

        // If we wouldn't get breathitin
        if (!this.isUnderground()) {
          return;
        }

        // If we haven't spent enough turns to get desperate to grab breathitin
        if ((0,external_kolmafia_.turnsPlayed)() < this.getConsults() * 75) {
          return;
        }
      }

      this.check();

      this.trySwitch();
    } }, { key: "trySwitch", value:

    function trySwitch() {
      if (!this.hasConsults()) {
        if (!this.triedSwitch && GreySettings_GreySettings.greySwitchWorkshed != "") {
          this.triedSwitch = true;

          var item = (0,external_kolmafia_.toItem)(GreySettings_GreySettings.greySwitchWorkshed);

          if (!item.usable) {
            (0,external_kolmafia_.print)(
            "An item was set in greySwitchWorkshed but is not usable",
            "red");

            return;
          }

          if ((0,external_kolmafia_.availableAmount)(item) == 0) {
            (0,external_kolmafia_.print)(
            "An item was set in greySwitchWorkshed but is not available, will skip",
            "red");

            return;
          }

          (0,external_kolmafia_.use)(item);

          if ((0,external_kolmafia_.getWorkshed)() == this.cabinet) {
            throw (
              "Failed to switch workshed to " +
              item +
              ", are you sure it's a workshed item?");

          }

          (0,external_kolmafia_.print)("Now using " + (0,external_kolmafia_.getWorkshed)() + " as the workshed!", "blue");
        }
        return;
      }
    } }]);return TaskColdMedicineCabinet;}();
;// CONCATENATED MODULE: ./src/tasks/TaskAutumnaton.ts
function TaskAutumnaton_typeof(obj) {"@babel/helpers - typeof";return TaskAutumnaton_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, TaskAutumnaton_typeof(obj);}function TaskAutumnaton_slicedToArray(arr, i) {return TaskAutumnaton_arrayWithHoles(arr) || TaskAutumnaton_iterableToArrayLimit(arr, i) || TaskAutumnaton_unsupportedIterableToArray(arr, i) || TaskAutumnaton_nonIterableRest();}function TaskAutumnaton_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function TaskAutumnaton_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function TaskAutumnaton_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function TaskAutumnaton_toConsumableArray(arr) {return TaskAutumnaton_arrayWithoutHoles(arr) || TaskAutumnaton_iterableToArray(arr) || TaskAutumnaton_unsupportedIterableToArray(arr) || TaskAutumnaton_nonIterableSpread();}function TaskAutumnaton_nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function TaskAutumnaton_iterableToArray(iter) {if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);}function TaskAutumnaton_arrayWithoutHoles(arr) {if (Array.isArray(arr)) return TaskAutumnaton_arrayLikeToArray(arr);}function TaskAutumnaton_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = TaskAutumnaton_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function TaskAutumnaton_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return TaskAutumnaton_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return TaskAutumnaton_arrayLikeToArray(o, minLen);}function TaskAutumnaton_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function TaskAutumnaton_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function TaskAutumnaton_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, TaskAutumnaton_toPropertyKey(descriptor.key), descriptor);}}function TaskAutumnaton_createClass(Constructor, protoProps, staticProps) {if (protoProps) TaskAutumnaton_defineProperties(Constructor.prototype, protoProps);if (staticProps) TaskAutumnaton_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function TaskAutumnaton_defineProperty(obj, key, value) {key = TaskAutumnaton_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function TaskAutumnaton_toPropertyKey(arg) {var key = TaskAutumnaton_toPrimitive(arg, "string");return TaskAutumnaton_typeof(key) === "symbol" ? key : String(key);}function TaskAutumnaton_toPrimitive(input, hint) {if (TaskAutumnaton_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (TaskAutumnaton_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}



var leaf = external_kolmafia_.Item.get("Autumn Leaf");
var debrisShield = external_kolmafia_.Item.get("Autumn Debris Shield");
var leafPendant = external_kolmafia_.Item.get("Autumn Leaf Pendant");
var ale = external_kolmafia_.Item.get("AutumnFest Ale");
var donut = external_kolmafia_.Item.get("Autumn-Spice Donut");
var breeze = external_kolmafia_.Item.get("Autumn Breeze");
var sweater = external_kolmafia_.Item.get("Autumn Sweater-weather sweater");
var dollar = external_kolmafia_.Item.get("Autumn Dollar");
var wisdom = external_kolmafia_.Item.get("Autumn Years Wisdom");







var TaskAutumnaton = /*#__PURE__*/function () {




  function TaskAutumnaton() {TaskAutumnaton_classCallCheck(this, TaskAutumnaton);TaskAutumnaton_defineProperty(this, "item", external_kolmafia_.Item.get("Autumn-aton"));TaskAutumnaton_defineProperty(this, "skipFor", 0);TaskAutumnaton_defineProperty(this, "toGrab", void 0);
    this.createItems();
  }TaskAutumnaton_createClass(TaskAutumnaton, [{ key: "getExpectedFallbotProfits", value:

    function getExpectedFallbotProfits(loc) {
      var map = new Map();var _iterator = TaskAutumnaton_createForOfIteratorHelper(

        Object.entries(
        (0,external_kolmafia_.appearanceRates)(loc)).
        map(
        function (_ref3) {var _ref4 = TaskAutumnaton_slicedToArray(_ref3, 2),monster = _ref4[0],rate = _ref4[1];return [external_kolmafia_.Monster.get(monster), rate];})),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;)
        {var _step$value = TaskAutumnaton_slicedToArray(_step.value, 2),monster = _step$value[0],encounterRate = _step$value[1];
          if (encounterRate <= 0) {
            continue;
          }var _iterator3 = TaskAutumnaton_createForOfIteratorHelper(

            (0,external_kolmafia_.itemDropsArray)(monster)),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var _step3$value = _step3.value,drop = _step3$value.drop,rate = _step3$value.rate,type = _step3$value.type;
              if (type != "" || drop.quest || !drop.tradeable) {
                continue;
              }

              map.set(drop, (map.get(drop) || 0) + rate);
            }} catch (err) {_iterator3.e(err);} finally {_iterator3.f();}
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

      var expectedItems = getItemsPerExpedition();
      var totalItemDrop = TaskAutumnaton_toConsumableArray(map.values()).reduce(function (p, n) {return p + n;}, 0);
      var multiBy = expectedItems * 100 / totalItemDrop;var _iterator2 = TaskAutumnaton_createForOfIteratorHelper(

        map),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var _step2$value = TaskAutumnaton_slicedToArray(_step2.value, 2),_drop = _step2$value[0],_rate = _step2$value[1];
          map.set(_drop, _rate * multiBy);
        }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}

      var outcome = getAutumnOutcome(loc);

      var expectedProfit =
      (outcome != null ? (0,external_kolmafia_.historicalPrice)(outcome[1]) : 0) +
      TaskAutumnaton_toConsumableArray(map.entries()).
      map(function (_ref) {var _ref2 = TaskAutumnaton_slicedToArray(_ref, 2),i = _ref2[0],rate = _ref2[1];return 0.01 * (0,external_kolmafia_.historicalPrice)(i) * rate;}).
      reduce(function (p, n) {return p + n;}, 0);

      return Math.round(expectedProfit);
    } }, { key: "selectLocation", value:

    function selectLocation(locs) {var _this = this;
      var weights = new Map([
      ["time taken", (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_autumnatonQuests")) == 0 ? 800 : 1000], // We always want it to return asap except the first quest isn't as important
      ["extra item", 900], // We want extra items
      ["extra seasonal item", 10], // This is more profit!
      ["item drop%", 3], // Eh, sure
      ["stats", 1]]);


      var selections = [];var _iterator4 = TaskAutumnaton_createForOfIteratorHelper(

        locs),_step4;try {var _loop = function _loop() {var _step4$value = _step4.value,location = _step4$value.location,item = _step4$value.item,upgrade = _step4$value.upgrade;
          var score = _this.getExpectedFallbotProfits(location) / 2500; // Turn 5k expected profit into a score of 2

          var toGrab = _this.toGrab.filter(
          function (t) {return (
              t.loc == location && (
              t.viable == null || t.viable()) &&
              (0,external_kolmafia_.availableAmount)(t.item) < t.amount && (
              t.allowLongExpeditions == true ||
              (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_autumnatonQuests")) <= 7));});


          if (toGrab.length > 0) {
            score +=
            1 +
            _this.toGrab.length -
            toGrab.
            map(function (t) {return _this.toGrab.indexOf(t);}).
            reduce(function (p1, p2) {return Math.min(p1, p2);}, 999);

            score += _this.toGrab.reduce(
            function (r1, r2) {var _r2$weightedScore;return r1 + ((_r2$weightedScore = r2.weightedScore) !== null && _r2$weightedScore !== void 0 ? _r2$weightedScore : 0);},
            0);

          }

          // Add scores for stuff we want
          if (!getAutumnUpgrades().includes(upgrade)) {
            var stat = getAutumnStat(upgrade);

            if (weights.has(stat)) {
              score += weights.get(stat);
            }
          }

          if (score <= 0) {return "continue";

          }

          var reason = toGrab.length > 0 ? "grab " + toGrab[0].item : "";

          if (getAutumnUpgraded(upgrade) == 0) {
            if (reason.length > 0) {
              reason += " and ";
            }

            reason +=
            "get upgrade " +
            _this.getEnumByEnumValue(AutumnUpgrades, upgrade) +
            " (" +
            upgrade +
            ") which upgrades stat '" +
            getAutumnStat(upgrade) +
            "'";
          }

          selections.push({ location: location, score: score, reason: reason });
        };for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {var _ret = _loop();if (_ret === "continue") continue;}} catch (err) {_iterator4.e(err);} finally {_iterator4.f();}

      if (selections.length == 0) {
        return null;
      }

      selections.sort(function (s1, s2) {return s2.score - s1.score;});

      return selections[0];
    } }, { key: "getEnumByEnumValue", value:

    function getEnumByEnumValue(myEnum, enumValue) {
      var keys = Object.keys(myEnum).filter(function (x) {return myEnum[x] == enumValue;});

      return keys.length > 0 ? keys[0] : null;
    } }, { key: "run", value:

    function run() {
      if (this.item == null || (0,external_kolmafia_.availableAmount)(this.item) == 0) {
        return;
      }

      if (this.skipFor-- > 0) {
        return;
      }

      var outcomes = getAutumnatonLocations();

      if ((0,external_kolmafia_.availableChoiceOptions)()[1] != null) {
        (0,external_kolmafia_.print)("Beep Boop, now upgrading autumn-aton", "blue");
        (0,external_kolmafia_.print)("Autumn-aton upgrade will: " + (0,external_kolmafia_.availableChoiceOptions)()[1], "blue");
        (0,external_kolmafia_.visitUrl)("choice.php?option=1&pwd&whichchoice=1483");
      }

      var bestChoice = this.selectLocation(outcomes);

      if (bestChoice == null) {
        this.skipFor = 2;
        (0,external_kolmafia_.visitUrl)("main.php");
        return;
      }

      if (!(0,external_kolmafia_.handlingChoice)()) {
        throw "Expected to be handling the aton choice";
      }

      if ((0,external_kolmafia_.lastChoice)() != 1483) {
        throw "Expected to be in aton choice";
      }

      (0,external_kolmafia_.print)("Sending Autumn-aton on a glorious quest to ".concat(
      bestChoice.reason, " from ").concat(bestChoice.location),
      "blue");


      (0,external_kolmafia_.visitUrl)(
      "choice.php?option=2&pwd&whichchoice=1483&heythereprogrammer=" +
      (0,external_kolmafia_.toInt)(bestChoice.location));


      if ((0,external_kolmafia_.handlingChoice)()) {
        throw "Unexpectedly still handling a choice!";
      }
    } }, { key: "createItems", value:

    function createItems() {
      this.toGrab = [];

      this.toGrab.push({
        weightedScore: 1000,
        loc: external_kolmafia_.Location.get("Sonofa Beach"),
        item: external_kolmafia_.Item.get("barrel of gunpowder"),
        amount: 5,
        allowLongExpeditions: true,
        viable: function viable() {return (
            (0,external_kolmafia_.getProperty)("sidequestLighthouseCompleted") == "none" &&
            getItemsPerExpedition() >= 5);}
      });

      this.toGrab.push({
        loc: external_kolmafia_.Location.get("The Smut Orc Logging Camp"),
        item: external_kolmafia_.Item.get("Raging hardwood plank"),
        amount: 10,
        viable: function viable() {return (
            getQuestStatus("questL09Topping") == 0 &&
            (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("chasmBridgeProgress")) < 30);}
      });

      this.toGrab.push({
        loc: external_kolmafia_.Location.get("The Copperhead Club"),
        item: external_kolmafia_.Item.get("Crappy Waiter Disguise"),
        amount: 5,
        viable: function viable() {return getQuestStatus("questL11Shen") < 5;}
      });

      this.toGrab.push({
        loc: external_kolmafia_.Location.get("A Mob Of Zeppelin Protesters"),
        item: external_kolmafia_.Item.get("cigarette lighter"),
        amount: 10,
        viable: function viable() {return getQuestStatus("questL11Ron") <= 1;}
      });

      this.toGrab.push({
        loc: external_kolmafia_.Location.get("The Penultimate Fantasy Airship"),
        item: external_kolmafia_.Item.get("Mohawk Wig"),
        amount: 1,
        viable: function viable() {return getQuestStatus("questL10Garbage") < 9;}
      });

      this.toGrab.push({
        loc: external_kolmafia_.Location.get("The Penultimate Fantasy Airship"),
        item: external_kolmafia_.Item.get("Amulet of Extreme Plot Significance"),
        amount: 1,
        viable: function viable() {return getQuestStatus("questL10Garbage") < 6;}
      });

      this.toGrab.push({
        loc: external_kolmafia_.Location.get("The Beanbat Chamber"),
        item: external_kolmafia_.Item.get("Enchanted Bean"),
        amount: 1,
        viable: function viable() {return getQuestStatus("questL10Garbage") <= 0;}
      });

      /* this.toGrab.push({
        loc: Location.get("The Goatlet"),
        item: Item.get("Goat Cheese"),
        amount: 3,
        viable: () => getQuestStatus("questL08Trapper") <= 1,
      });*/

      this.toGrab.push({
        loc: external_kolmafia_.Location.get("The Hidden Bowling Alley"),
        item: external_kolmafia_.Item.get("bowling ball"),
        amount: 5,
        viable: function viable() {return (
            (0,external_kolmafia_.getProperty)("questL11Spare") != "finished" &&
            (0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("bowling ball")) -
            (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("hiddenBowlingAlleyProgress")) >
            5);}
      });

      // If we want a drum machine, have turned in stone rose, yet have not turned in drum machine..
      this.toGrab.push({
        loc: external_kolmafia_.Location.get("The Oasis"),
        item: external_kolmafia_.Item.get("Drum Machine"),
        amount: 1,
        viable: function viable() {return (
            ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("gnasirProgress")) & 1) == 1 &&
            ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("gnasirProgress")) & 16) != 16);}
      });

      this.toGrab.push({
        loc: external_kolmafia_.Location.get("Guano Junction"),
        item: external_kolmafia_.Item.get("sonar-in-a-biscuit"),
        amount: 1,
        viable: function viable() {return getQuestStatus("questL04Bat") <= 2;}
      });

      // Harem
      // Gauno Junction - Bat sonar
      // Infernal Rackets Backstage / laugh floor
      // Oil peak?
      // Sonofa Beach
      // Black Forest
      // Castle in clouds basement - WAND
      // Castle in clouds ground - Maybe +combat weapon
      // Dungeons of Doom - Ring of +combat
      // The greater than sign - Mehhh
      // Goatlet - Goat Cheese
      // Haunted Billiards - Hand of chalk, meh
      // Haunted library - Killing jar
      // Janitor - Book of matches
      // Bowling Balls
      // Surgeon outfit?
      // Misc locations for when we can't tower break, like key locs?
      // Middle chamber - tomb ratchets?
      // Red zeppelin - Glark cables
      // Crypt - Evil eyes
      // Twin Peak - Hedge trimmers
      // Whitey's grove - White page? lol
    } }]);return TaskAutumnaton;}();











// autumnatonUpgrades=leftleg1,periscope,radardish,rightleg1
var AutumnUpgrades;








// More stats
(function (AutumnUpgrades) {AutumnUpgrades["LEFT_ARM"] = "leftarm1";AutumnUpgrades["LEFT_LEG"] = "leftleg1";AutumnUpgrades["RIGHT_ARM"] = "rightarm1";AutumnUpgrades["RIGHT_LEG"] = "rightleg1";AutumnUpgrades["ENERGY_HAT"] = "base_blackhat";AutumnUpgrades["COLLECTION_PROW"] = "cowcatcher";AutumnUpgrades["VISION_EXTENDER"] = "periscope";AutumnUpgrades["RADAR"] = "radardish";AutumnUpgrades["EXHAUST"] = "dualexhaust";})(AutumnUpgrades || (AutumnUpgrades = {}));








function getAutumnStat(upgrade) {
  switch (upgrade) {
    case AutumnUpgrades.LEFT_ARM:
    case AutumnUpgrades.RIGHT_ARM:
      return "extra item";
    case AutumnUpgrades.LEFT_LEG:
    case AutumnUpgrades.RIGHT_LEG:
      return "time taken";
    case AutumnUpgrades.ENERGY_HAT:
    case AutumnUpgrades.EXHAUST:
      return "stats";
    case AutumnUpgrades.VISION_EXTENDER:
      return "item drop%";
    case AutumnUpgrades.COLLECTION_PROW:
      return "extra seasonal item";

      throw "Unknown Autumn upgrade '" + upgrade + "'";}

}

function getItemsPerExpedition() {
  return (
    3 + getAutumnUpgraded(AutumnUpgrades.LEFT_ARM, AutumnUpgrades.RIGHT_ARM));

}

function getExpeditionTime() {
  // It goes 11 > 11 > 22 > 33
  var questsDone = toInt(getProperty("_autumnatonQuests"));

  // With 1 upgrade, it takes 0 turns. At 2, it takes -11 turns
  questsDone -= getAutumnUpgraded(
  AutumnUpgrades.LEFT_LEG,
  AutumnUpgrades.RIGHT_LEG);


  // We demand a min of 1 quests, for 11 turns
  return 11 * Math.max(1, questsDone);
}

function getAutumnUpgraded() {for (var _len = arguments.length, upgrades = new Array(_len), _key = 0; _key < _len; _key++) {upgrades[_key] = arguments[_key];}
  return getAutumnUpgrades().filter(function (u) {return upgrades.includes(u);}).length;
}







function getAutumnatonLocations() {
  var validLocs = [];

  var page = (0,external_kolmafia_.visitUrl)("inv_use.php?pwd&whichitem=10954");
  var match;

  while ((match = page.match(/<option {2}value="(\d+)">/)) != null) {
    page = page.replace(match[0], "");
    var loc = (0,external_kolmafia_.toLocation)((0,external_kolmafia_.toInt)(match[1]));
    var outcome = getAutumnOutcome(loc);

    if (outcome == null) {
      continue;
    }

    validLocs.push({ location: loc, upgrade: outcome[0], item: outcome[1] });
  }

  return validLocs;
}

function getAutumnUpgrades() {
  return (0,external_kolmafia_.getProperty)("autumnatonUpgrades").
  split(",").
  filter(function (s) {return s.length > 0;});
}

function getAutumnOutcome(location) {
  if (location.environment == "outdoor") {
    if (location.difficultyLevel == "low") {
      return [AutumnUpgrades.ENERGY_HAT, leaf];
    } else if (location.difficultyLevel == "mid") {
      return [AutumnUpgrades.RIGHT_ARM, debrisShield];
    } else if (location.difficultyLevel == "high") {
      return [AutumnUpgrades.VISION_EXTENDER, leafPendant];
    }
  } else if (location.environment == "indoor") {
    if (location.difficultyLevel == "low") {
      return [AutumnUpgrades.LEFT_ARM, ale];
    } else if (location.difficultyLevel == "mid") {
      return [AutumnUpgrades.RIGHT_LEG, donut];
    } else if (location.difficultyLevel == "high") {
      return [AutumnUpgrades.RADAR, breeze];
    }
  } else if (location.environment == "underground") {
    if (location.difficultyLevel == "low") {
      return [AutumnUpgrades.LEFT_LEG, sweater];
    } else if (location.difficultyLevel == "mid") {
      return [AutumnUpgrades.COLLECTION_PROW, dollar];
    } else if (location.difficultyLevel == "high") {
      return [AutumnUpgrades.EXHAUST, wisdom];
    }
  }

  return null;
}
;// CONCATENATED MODULE: ./src/tasks/TaskTrainset.ts
function TaskTrainset_typeof(obj) {"@babel/helpers - typeof";return TaskTrainset_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, TaskTrainset_typeof(obj);}function TaskTrainset_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function TaskTrainset_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, TaskTrainset_toPropertyKey(descriptor.key), descriptor);}}function TaskTrainset_createClass(Constructor, protoProps, staticProps) {if (protoProps) TaskTrainset_defineProperties(Constructor.prototype, protoProps);if (staticProps) TaskTrainset_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function TaskTrainset_defineProperty(obj, key, value) {key = TaskTrainset_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function TaskTrainset_toPropertyKey(arg) {var key = TaskTrainset_toPrimitive(arg, "string");return TaskTrainset_typeof(key) === "symbol" ? key : String(key);}function TaskTrainset_toPrimitive(input, hint) {if (TaskTrainset_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (TaskTrainset_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}





var TaskTrainset = /*#__PURE__*/function () {function TaskTrainset() {TaskTrainset_classCallCheck(this, TaskTrainset);TaskTrainset_defineProperty(this, "mpSkill",
    external_kolmafia_.Skill.get("Hivemindedness"));}TaskTrainset_createClass(TaskTrainset, [{ key: "run", value:

    function run() {
      if (
      !isTrainsetConfigurable() ||
      (0,external_kolmafia_.getProperty)("questL13Final") != "unstarted")
      {
        return;
      }

      var desired = this.getDesiredPieces();
      var current = getTrainsetConfiguration();

      // If the current and desired trainset configurations are the same
      if (
      desired.length == current.length &&
      desired.find(function (d, ind) {return d != current[ind];}) == null)
      {
        return;
      }

      setTrainsetConfiguration(desired);
    } }, { key: "getDesiredPieces", value:

    function getDesiredPieces() {
      var pieces = [];

      // 1
      pieces.push(TrainsetPiece.DOUBLE_NEXT_STATION);

      // 2
      // If we do not have the MP skill, and we are not using mumming trunk
      if (
      !(0,external_kolmafia_.haveSkill)(this.mpSkill) && (
      !GreySettings_GreySettings.greyUseMummery ||
      (0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("mumming trunk")) == 0))
      {
        pieces.push(TrainsetPiece.EFFECT_MP);
      }

      // 3
      // Always double our meat if we have less than 5k
      if ((0,external_kolmafia_.myMeat)() < 5000) {
        pieces.push(TrainsetPiece.GAIN_MEAT);
      }

      // 4
      if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("chasmBridgeProgress")) < 30) {
        pieces.push(TrainsetPiece.SMUT_BRIDGE_OR_STATS);
      }

      // Add the meat piece here if it wasn't added before
      if (!pieces.includes(TrainsetPiece.GAIN_MEAT)) {
        pieces.push(TrainsetPiece.GAIN_MEAT);
      }

      // 5
      pieces.push(TrainsetPiece.DROP_LAST_FOOD_OR_RANDOM);
      // 6
      pieces.push(TrainsetPiece.RANDOM_BOOZE);

      // 7
      if (
      getQuestStatus("questL08Trapper") == 1 &&
      (0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get((0,external_kolmafia_.getProperty)("trapperOre"))) < 3)
      {
        pieces.push(TrainsetPiece.ORE);
      }

      // 8
      pieces.push(TrainsetPiece.CANDY);

      // And the extras

      if (!pieces.includes(TrainsetPiece.EFFECT_MP) && !(0,external_kolmafia_.haveSkill)(this.mpSkill)) {
        pieces.push(TrainsetPiece.EFFECT_MP);
      }

      // If kitchen isn't done.
      if (getQuestStatus("questM20Necklace") == 0) {
        pieces.push(TrainsetPiece.STENCH_RES_SPOOKY_DMG);
        pieces.push(TrainsetPiece.HOT_RES_COLD_DMG);
      }

      // If icy peak or aboo peak is up
      var booPeak =
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("booPeakProgress")) > 0 &&
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("booPeakProgress")) < 100;
      var icyPeak =
      getQuestStatus("questL08Trapper") >= 3 &&
      getQuestStatus("questL08Trapper") < 100;
      var protesters =
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("zeppelinProtestors")) > 0 &&
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("zeppelinProtestors")) < 80;

      if (booPeak || icyPeak) {
        pieces.push(TrainsetPiece.COLD_RES_STENCH_DMG);
      }

      if (booPeak || protesters) {
        pieces.push(TrainsetPiece.SPOOKY_RES_SLEAZE_DMG);
      }

      for (var _i = 0, _arr = [
        TrainsetPiece.BUFF_FOOD_DROP,
        TrainsetPiece.HOT_RES_COLD_DMG,
        TrainsetPiece.STENCH_RES_SPOOKY_DMG,
        TrainsetPiece.SPOOKY_RES_SLEAZE_DMG,
        TrainsetPiece.SLEAZE_RES_HOT_DMG,
        TrainsetPiece.COLD_RES_STENCH_DMG]; _i < _arr.length; _i++)
      {var leftover = _arr[_i];
        if (pieces.length >= 8) {
          break;
        }

        if (pieces.includes(leftover)) {
          continue;
        }

        pieces.push(leftover);
      }

      while (pieces.length > 8) {
        pieces.pop();
      }

      return pieces;
    } }]);return TaskTrainset;}();
;// CONCATENATED MODULE: ./src/utils/GreyFamiliars.ts
function GreyFamiliars_slicedToArray(arr, i) {return GreyFamiliars_arrayWithHoles(arr) || GreyFamiliars_iterableToArrayLimit(arr, i) || GreyFamiliars_unsupportedIterableToArray(arr, i) || GreyFamiliars_nonIterableRest();}function GreyFamiliars_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function GreyFamiliars_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return GreyFamiliars_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return GreyFamiliars_arrayLikeToArray(o, minLen);}function GreyFamiliars_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function GreyFamiliars_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function GreyFamiliars_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}


// Map<Familiar, If it still valid>
// So the value is if this familiar is still worth running
var familiarsToUse = [];
var familiarsNotToLevel = [
external_kolmafia_.Familiar.get("Cat Burglar"),
external_kolmafia_.Familiar.get("Gelatinous Cubeling")];

var familiarsToLevel = [external_kolmafia_.Familiar.get("Reagnimated Gnome")];

function shouldLevelFamiliar(fam) {
  return (
    !familiarsNotToLevel.includes(fam) && (
    familiarsToLevel.includes(fam) ||
    familiarsToUse.find(function (_ref) {var _ref2 = GreyFamiliars_slicedToArray(_ref, 1),f = _ref2[0];return f == fam;}) == null));

}

function add(familiar, func) {
  familiarsToUse.push([familiar, func]);
}

function lessThan(familiar, propertyName, value) {
  add(external_kolmafia_.Familiar.get(familiar), function () {return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)(propertyName)) < value;});
}

function alwaysValid(familiar) {
  add(external_kolmafia_.Familiar.get(familiar), function () {return true;});
}

function canLevel(familiar, fullLevel) {
  var fam = external_kolmafia_.Familiar.get(familiar);

  if (!familiarsToLevel.includes(fam)) {
    familiarsToLevel.push(fam);
  }

  add(fam, function () {return (0,external_kolmafia_.familiarWeight)(fam) < (fullLevel ? 20 : 15);});
}

function addLevelers(fullLevel) {
  add(
  external_kolmafia_.Familiar.get("Robortender"),
  function () {return (
      (0,external_kolmafia_.familiarWeight)(external_kolmafia_.Familiar.get("Robortender")) < (fullLevel ? 20 : 15) &&
      (0,external_kolmafia_.getProperty)("_roboDrinks").includes("drive-by shooting"));});

  canLevel("Pocket Professor", fullLevel);
  canLevel("Jumpsuited Hound Dog", fullLevel);
  add(
  external_kolmafia_.Familiar.get("Hobo Monkey"),
  function () {return (
      (0,external_kolmafia_.familiarWeight)(external_kolmafia_.Familiar.get("Hobo Monkey")) < (fullLevel ? 20 : 15) &&
      !(0,external_kolmafia_.haveFamiliar)(external_kolmafia_.Familiar.get("Robortender")));});

  canLevel("Stomping Boots", fullLevel);
  canLevel("Frumious Bandersnatch", fullLevel);
}

lessThan("Grimstone Golem", "_grimstoneMaskDrops", 1);
lessThan("Angry Jung Man", "_jungDrops", 1);
lessThan("Grim Brother", "_grimFairyTaleDrops", 5);
lessThan("Adventurous Spelunker", "_spelunkingTalesDrops", 1);
lessThan("Unconscious Collective", "_dreamJarDrops", 5);
lessThan("Astral badger", "_astralDrops", 5);
lessThan("Baby Sandworm", "_aguaDrops", 5);
lessThan("Blavious Kloop", "_kloopDrops", 5);
lessThan("Bloovian Groose", "_grooseDrops", 5);
lessThan("Fist Turkey", "_turkeyBooze", 5);
lessThan("Golden Monkey", "_powderedGoldDrops", 5);
lessThan("Green Pixie", "_absintheDrops", 5);
lessThan("Li'l Xenomorph", "_transponderDrops", 5);
lessThan("Llama Lama", "_gongDrops", 5);
lessThan("Ms. Puck Man", "_powerPillDrops", 5);
lessThan("Puck Man", "_powerPillDrops", 5);
lessThan("Rogue Program", "_tokenDrops", 5);
lessThan("Machine Elf", "_snowglobeDrops", 1);

alwaysValid("Reagnimated Gnome");
alwaysValid("Temporal Riftlet");

addLevelers(false);

lessThan("Mini-Hipster", "_hipsterAdv", 7);
lessThan("Artistic Goth Kid", "_hipsterAdv", 7);

alwaysValid("Cookbookbat");
alwaysValid("Obtuse Angel");
alwaysValid("XO Skeleton");

addLevelers(true);

// Crappy
lessThan("Galloping Grill", "_hotAshesDrops", 5);
lessThan("Cotton Candy Carnie", "_carnieCandyDrops", 10);
lessThan("Miniature Sword & Martini Guy", "_miniMartiniDrops", 10);
lessThan("Melodramedary", "camelSpit", 100);

var gnome = external_kolmafia_.Familiar.get("Reagnimated Gnome");
var gnomeKnee = external_kolmafia_.Item.get("gnomish housemaid's kgnee");

function getFamiliarsToUse() {
  var famsToUse = [];

  if (GreySettings_GreySettings.greyUseFamiliars.length > 0) {
    GreySettings_GreySettings.greyUseFamiliars.split(",").
    map(function (f) {return (0,external_kolmafia_.toFamiliar)(f);}).
    forEach(function (fam) {
      if (!(0,external_kolmafia_.haveFamiliar)(fam)) {
        return;
      }

      var toUse = familiarsToUse.filter(function (_ref3) {var _ref4 = GreyFamiliars_slicedToArray(_ref3, 1),f = _ref4[0];return f == fam;});

      if (toUse.length > 0 && toUse.find(function (_ref5) {var _ref6 = GreyFamiliars_slicedToArray(_ref5, 2),canUse = _ref6[1];return canUse();}) == null) {
        return;
      }

      famsToUse.push(fam);
    });
  } else {
    familiarsToUse.
    filter(function (_ref7) {var _ref8 = GreyFamiliars_slicedToArray(_ref7, 2),f = _ref8[0],canUse = _ref8[1];return (0,external_kolmafia_.haveFamiliar)(f) && canUse();}).
    forEach(function (_ref9) {var _ref10 = GreyFamiliars_slicedToArray(_ref9, 1),f = _ref10[0];
      if (famsToUse.includes(f)) {
        return;
      }

      famsToUse.push(f);
    });
  }

  // TODO Make sure this only runs when we're actually running
  if (famsToUse.includes(gnome) && (0,external_kolmafia_.availableAmount)(gnomeKnee) == 0) {
    (0,external_kolmafia_.useFamiliar)(gnome);

    (0,external_kolmafia_.visitUrl)("arena.php");
    (0,external_kolmafia_.runChoice)(4);

    if ((0,external_kolmafia_.availableAmount)(gnomeKnee) == 0) {
      throw "Expected to have " + gnomeKnee;
    }
  }

  return famsToUse;
}
;// CONCATENATED MODULE: ./src/GreyAdventurer.ts
function GreyAdventurer_typeof(obj) {"@babel/helpers - typeof";return GreyAdventurer_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, GreyAdventurer_typeof(obj);}function GreyAdventurer_toConsumableArray(arr) {return GreyAdventurer_arrayWithoutHoles(arr) || GreyAdventurer_iterableToArray(arr) || GreyAdventurer_unsupportedIterableToArray(arr) || GreyAdventurer_nonIterableSpread();}function GreyAdventurer_nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function GreyAdventurer_iterableToArray(iter) {if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);}function GreyAdventurer_arrayWithoutHoles(arr) {if (Array.isArray(arr)) return GreyAdventurer_arrayLikeToArray(arr);}function GreyAdventurer_slicedToArray(arr, i) {return GreyAdventurer_arrayWithHoles(arr) || GreyAdventurer_iterableToArrayLimit(arr, i) || GreyAdventurer_unsupportedIterableToArray(arr, i) || GreyAdventurer_nonIterableRest();}function GreyAdventurer_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function GreyAdventurer_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function GreyAdventurer_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function GreyAdventurer_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = GreyAdventurer_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function GreyAdventurer_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return GreyAdventurer_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return GreyAdventurer_arrayLikeToArray(o, minLen);}function GreyAdventurer_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function GreyAdventurer_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function GreyAdventurer_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, GreyAdventurer_toPropertyKey(descriptor.key), descriptor);}}function GreyAdventurer_createClass(Constructor, protoProps, staticProps) {if (protoProps) GreyAdventurer_defineProperties(Constructor.prototype, protoProps);if (staticProps) GreyAdventurer_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function GreyAdventurer_defineProperty(obj, key, value) {key = GreyAdventurer_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function GreyAdventurer_toPropertyKey(arg) {var key = GreyAdventurer_toPrimitive(arg, "string");return GreyAdventurer_typeof(key) === "symbol" ? key : String(key);}function GreyAdventurer_toPrimitive(input, hint) {if (GreyAdventurer_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (GreyAdventurer_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}


























var GreyAdventurer_GreyAdventurer = /*#__PURE__*/function () {function GreyAdventurer() {GreyAdventurer_classCallCheck(this, GreyAdventurer);GreyAdventurer_defineProperty(this, "goose",
    external_kolmafia_.Familiar.get("Grey Goose"));GreyAdventurer_defineProperty(this, "adventureFinder",
    new AdventureFinder());GreyAdventurer_defineProperty(this, "goTime", void 0);GreyAdventurer_defineProperty(this, "tasks",

    [
    new TaskEater(),
    new TaskSellCrap(),
    new TaskColdMedicineCabinet(),
    new TaskCouncil(),
    new TaskLatteFiller(),
    new TaskMaintainStatus(),
    new TaskFuelAsdon(),
    new TaskJuneCleaver(),
    new TaskBoomboxSwitch(),
    new TaskEquipDistillery(),
    new TaskAutumnaton(),
    new TaskTrainset()
    //new TaskBountyHunter(),
    ]);GreyAdventurer_defineProperty(this, "freeRunners",

    [
    "Greatest American Pants",
    "navel ring of navel gazing"].
    map(function (s) {return external_kolmafia_.Item.get(s);}));GreyAdventurer_defineProperty(this, "lastTasksComplete",
    -1);GreyAdventurer_defineProperty(this, "gnome",
    external_kolmafia_.Familiar.get("Reagnimated Gnome"));GreyAdventurer_defineProperty(this, "gnomeKnee",
    external_kolmafia_.Item.get("gnomish housemaid's kgnee"));}GreyAdventurer_createClass(GreyAdventurer, [{ key: "runTurn", value:

    function runTurn(goTime) {
      this.goTime = goTime;

      if (goTime) {var _iterator = GreyAdventurer_createForOfIteratorHelper(
          this.tasks),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var task = _step.value;
            task.run();
          }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
      }

      this.adventureFinder.start();

      var goodAdventure = this.adventureFinder.findGoodVisit();

      this.adventureFinder.printStatus(this.adventureFinder.possibleAdventures);

      if (goodAdventure == null) {
        if (getQuestStatus("questL13Final") > 11) {
          (0,external_kolmafia_.print)("You've defeated the NS and saved the day!", "blue");

          if ((0,external_kolmafia_.myAdventures)() > 40) {
            (0,external_kolmafia_.print)(
            "Caution! Burn your adventures! You have more than 40 adventures! Breaking the prism will reset them to 40!",
            "red");

          } else {
            (0,external_kolmafia_.print)(
            "Break the prism and become that class you were always meant to be!",
            "blue");

          }
        } else {
          (0,external_kolmafia_.print)("Failed, should have printed an error..", "gray");
        }

        return false;
      }

      var snapshot = createResourcesSnapshot(goodAdventure.path);

      if (getPrimedResource() == null) {
        this.adventureFinder.tryPrime(goodAdventure);
      }

      this.printMessage(goodAdventure);

      if (shouldGreydayStop()) {
        return false;
      }

      this.runAdventure(goodAdventure);

      var changed =
      goodAdventure.path == null ?
      getResourcesChanged(snapshot) :
      goodAdventure.path.detectResourceUsage(snapshot);

      if (this.isMismatch(snapshot, changed)) {
        return false;
      }

      if (getPrimedResource() != null && getPrimedResource().resource.primed()) {
        (0,external_kolmafia_.print)(
        "Successfully primed for quest " + getPrimedResource().quest.getId(),
        "blue");

      }

      return true;
    } }, { key: "isMismatch", value:

    function isMismatch(
    snapshotBeforeRun,
    changedBy)
    {
      var expected = new Map();var _iterator2 = GreyAdventurer_createForOfIteratorHelper(

        ResourceIds),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var resourceId = _step2.value;
          expected.set(resourceId, snapshotBeforeRun.resourceMap.get(resourceId));
        }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}var _iterator3 = GreyAdventurer_createForOfIteratorHelper(

        changedBy.resources),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var _resource$resourcesUs;var resource = _step3.value;
          expected.set(
          resource.resource,
          expected.get(resource.resource) - ((_resource$resourcesUs = resource.resourcesUsed) !== null && _resource$resourcesUs !== void 0 ? _resource$resourcesUs : 1));

        }

        // Resource ID
        // What it was before we used resources
        // How much the snapshot said changed
        // What it should be after we used resources
        // What it currently is
      } catch (err) {_iterator3.e(err);} finally {_iterator3.f();}var mismatch =
      new Map();var _iterator4 = GreyAdventurer_createForOfIteratorHelper(

        ResourceIds),_step4;try {for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {var id = _step4.value;
          if (expected.get(id) == getResourcesLeft(id)) {
            continue;
          }

          // If we actually gained resources, probs clovers..
          if (snapshotBeforeRun.resourceMap.get(id) < getResourcesLeft(id)) {
            continue;
          }

          if (id == "Yellow Ray") {
            continue;
          } else if (id == "Pull" && getResourcesLeft(id) > 50) {
            continue;
          }

          mismatch.set(id, [
          snapshotBeforeRun.resourceMap.get(id),
          changedBy.resourceMap.get(id),
          expected.get(id),
          getResourcesLeft(id)]);

        }} catch (err) {_iterator4.e(err);} finally {_iterator4.f();}

      if (mismatch.size == 0) {
        return false;
      }

      (0,external_kolmafia_.print)("Mismatch in resources used, aborting to be safe.", "red");

      (0,external_kolmafia_.print)("These resources were allowed to be used: ".concat(
      snapshotBeforeRun.resources.map(
      function (r) {var _r$resourcesUsed;return (
          r.name +
          " (" +
          ResourceCategory[r.type] +
          ", uses " + ((_r$resourcesUsed =
          r.resourcesUsed) !== null && _r$resourcesUsed !== void 0 ? _r$resourcesUsed : 1) +
          ")");})),

      "red");

      (0,external_kolmafia_.print)("These resources were marked as used: ".concat(
      changedBy.resources.map(
      function (r) {var _r$resourcesUsed2;return (
          r.name +
          " (" +
          ResourceCategory[r.type] +
          ", uses " + ((_r$resourcesUsed2 =
          r.resourcesUsed) !== null && _r$resourcesUsed2 !== void 0 ? _r$resourcesUsed2 : 1) +
          ")");})),

      "red");


      mismatch.forEach(
      function (_ref, resourceId) {var _ref2 = GreyAdventurer_slicedToArray(_ref, 4),beforeUsage = _ref2[0],changedBy = _ref2[1],shouldBe = _ref2[2],actualResource = _ref2[3];
        (0,external_kolmafia_.print)("".concat(
        resourceId, " was ").concat(beforeUsage, " and calculated to be ").concat(shouldBe, ", expected to have changed by ").concat(changedBy, ". Is now ").concat(actualResource),
        "red");

      });


      return true;
    } }, { key: "printMessage", value:

    function printMessage(goodAdventure) {
      var plan = [];

      if (goodAdventure.quest != null) {
        plan.push("Quest");
      }

      if (goodAdventure.locationInfo != null) {
        if (goodAdventure.locationInfo.turnsToGain > 0) {
          plan.push(
          "Absorb Adventures (Expect " +
          goodAdventure.locationInfo.expectedTurnsProfit +
          " profit of total " +
          goodAdventure.locationInfo.turnsToGain +
          " possible)");

        }

        if (goodAdventure.locationInfo.skills.size > 0) {
          var skills = [];

          goodAdventure.locationInfo.skills.forEach(function (v, k) {
            skills.push(k.skill.name + " (" + v + ")");
          });

          plan.push("Grab Skills: " + skills.join(", "));
        }

        if (goodAdventure.locationInfo.monsters != null) {
          var monsters = [];

          var absorbed = this.adventureFinder.defeated;
          var advsLeft = getAbsorbedAdventuresRemaining();

          goodAdventure.locationInfo.monsters.
          map(function (m) {
            var absorb = GreyAbsorber_AbsorbsProvider.getAbsorb(m);

            if (absorb == null) {
              return m.name;
            }

            if (absorb.skill != null) {
              return m.name + " (Skill)";
            }

            if (advsLeft <= 0 || (absorb.adventures || 0) <= 0) {
              return m.name;
            }

            if (absorbed.get(m) == Reabsorbed.REABSORBED) {
              return m.name;
            }

            return (
              m.name + " (Absorbs x " + (!absorbed.has(m) ? "2" : "1") + ")");

          }).
          forEach(function (m) {return monsters.push(m);});

          plan.push("Fight: " + monsters.join(", "));
        }
      }

      var prefix;

      if (goodAdventure.quest != null) {
        prefix =
        goodAdventure.quest.getId() + " @ " + goodAdventure.adventure.location;
      } else {
        prefix = "Non-Quest @ " + goodAdventure.adventure.location;
      }

      var completed = 0;
      var notReady = 0;
      var inProgress = 0;var _iterator5 = GreyAdventurer_createForOfIteratorHelper(

        this.adventureFinder.allQuests),_step5;try {for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {var _step5$value = GreyAdventurer_slicedToArray(_step5.value, 2),quest = _step5$value[0],path = _step5$value[1];
          var status = quest.status(path);

          if (status == QuestStatus.COMPLETED) {
            completed++;
          } else if (status == QuestStatus.NOT_READY) {
            notReady++;
          } else {
            inProgress++;
          }
        }} catch (err) {_iterator5.e(err);} finally {_iterator5.f();}

      var changed =
      this.lastTasksComplete >= 0 ? completed - this.lastTasksComplete : 0;
      this.lastTasksComplete = completed;

      (0,external_kolmafia_.print)(
      "Adventures Left to Absorb: " + getAbsorbedAdventuresRemaining(),
      "gray");

      (0,external_kolmafia_.printHtml)(
      "<font color='blue'>Tasks Complete: " +
      completed + (
      changed > 0 ? "<font color='green'> (+" + changed + ")</font>" : "") +
      " / " +
      this.adventureFinder.allQuests.length +
      "</font>");


      (0,external_kolmafia_.printHtml)(
      "<u>" +
      doColor(prefix, "blue") +
      ", Goals:</u> " +
      doColor(plan.map(function (s) {return "<u>" + s + "</u>";}).join(", "), "gray") +
      " Consideration: " +
      ConsiderPriority[goodAdventure.considerPriority],
      true);

    } }, { key: "doOutfitPrep", value:

    function doOutfitPrep(adventure) {var _this = this;
      var toRun = adventure.adventure;
      var outfit = toRun.outfit;

      if (toRun.location == external_kolmafia_.Location.get("Inside the Palindome")) {
        outfit.addWeight(external_kolmafia_.Item.get("Talisman o' Namsilat"));
      } else if (toRun.location == external_kolmafia_.Location.get("The Icy Peak")) {
        outfit.addWeight("cold res", 5, 5);
      }

      var doOrb = false;

      if (
      adventure.orbStatus != OrbStatus.IGNORED &&
      adventure.orbStatus != OrbStatus.NEEDS_RESET &&
      adventure.considerPriority != ConsiderPriority.BAD_ABSORB)
      {
        doOrb = true;

        if (
        adventure.orbStatus == OrbStatus.NOT_SET &&
        adventure.quest == null && (
        toRun.location == null || toRun.location.combatQueue.length > 3))
        {
          outfit.addWeight(external_kolmafia_.Item.get("Kramco Sausage-o-Matic&trade;"), 20);
        }
      }

      var wantToAbsorb =
      adventure.locationInfo != null &&
      adventure.locationInfo.turnsToGain > 0 && (
      !doOrb ||
      adventure.considerPriority != ConsiderPriority.ORB_OTHER &&
      adventure.considerPriority != ConsiderPriority.ORB_ABSORB_OTHER);
      var gooseReplaceable =
      !wantToAbsorb && this.adventureFinder.hasEnoughGooseWeight();
      var canDoMagGlass =
      this.adventureFinder.hasEnoughGooseWeight() &&
      outfit.minusCombatWeight == 0 &&
      outfit.itemDropWeight < 1 &&
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("cursedMagnifyingGlassCount")) < 13 &&
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_voidFreeFights")) < 5;
      var reallyLovesMagGlass =
      (0,external_kolmafia_.getProperty)("autumnatonQuestLocation") == "" &&
      (0,external_kolmafia_.getProperty)("sidequestLighthouseCompleted") == "none" &&
      (0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("barrel of gunpowder")) < 5;

      if (canDoMagGlass) {
        var bonus = 10;

        if (reallyLovesMagGlass) {

          //  bonus = 100;
        }
        outfit.addWeight(external_kolmafia_.Item.get("cursed magnifying glass"), bonus);
      } else if (
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("cursedMagnifyingGlassCount")) == 13 &&
      outfit.minusCombatWeight < 0)
      {
        outfit.addWeight(external_kolmafia_.Item.get("cursed magnifying glass"), -50);
      } else if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_voidFreeFights")) >= 5) {
        outfit.addWeight(external_kolmafia_.Item.get("cursed magnifying glass"), -30);
      }

      if (adventure.considerPriority == ConsiderPriority.ORB_ABSORB) {
        outfit.addIgnored(external_kolmafia_.Item.get("Carnivorous potted plant"));
      }

      if ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("scrapbookCharges")) < 100) {
        var _bonus = 2;

        if (GreySettings_GreySettings.greyPrepareLevelingResources) {
          _bonus = 6;

          if (canDoMagGlass) {

            //bonus = 11;
          }}

        outfit.addWeight(external_kolmafia_.Item.get("familiar scrapbook"), _bonus);
      }

      var sweat = (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("sweat"));

      if (sweat < 100 && outfit.itemDropWeight < 1) {
        outfit.addWeight(external_kolmafia_.Item.get("designer sweatpants"), sweat < 5 ? 16 : 8);
      }

      outfit.addWeight(external_kolmafia_.Item.get("june cleaver"), 1);

      var powerLevelGoose = false;
      // We want cat burglar to always be charged first
      var prioritize = [
      external_kolmafia_.Familiar.get("Cat Burglar"),
      external_kolmafia_.Familiar.get("Gelatinous Cubeling")];


      var familiar = this.goose;

      if (
      toRun.familiar != null && (
      toRun.disableFamOverride == true || !wantToAbsorb))
      {
        familiar = toRun.familiar;
      } else if (gooseReplaceable) {
        var replaceWith = [];

        // If we don't expect to be doing absorbs in the future..
        if (
        GreySettings_GreySettings.greyPrepareLevelingResources &&
        (0,external_kolmafia_.familiarWeight)(this.goose) < 20 &&
        getAbsorbedAdventuresRemaining() < 0)
        {
          replaceWith.push(this.goose);
          powerLevelGoose = true;
        }

        var recced = this.adventureFinder.getRecommendedFamiliars();

        // If fam wants to be charged, add it to the list
        var _iterator6 = GreyAdventurer_createForOfIteratorHelper(prioritize),_step6;try {for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {var fam = _step6.value;
            if (!recced.includes(fam)) {
              continue;
            }

            replaceWith.push(fam);
          }

          // Add every other fam, exclude burglar.
        } catch (err) {_iterator6.e(err);} finally {_iterator6.f();}replaceWith.push.apply(replaceWith, GreyAdventurer_toConsumableArray(recced.filter(function (f) {return !replaceWith.includes(f);})));
        replaceWith.push.apply(replaceWith, GreyAdventurer_toConsumableArray(getFamiliarsToUse()));

        replaceWith.push(this.goose);

        familiar = replaceWith.filter(
        function (f) {return (0,external_kolmafia_.haveFamiliar)(f) && (!doOrb || f != _this.gnome);})[
        0];
      }

      if (
      doOrb ||
      toRun.familiar == null && gooseReplaceable ||
      familiar == external_kolmafia_.Familiar.get("Melodramedary"))
      {
        outfit.addWeight(external_kolmafia_.Item.get("june cleaver"), 10);
      }

      if (familiar == this.gnome) {
        outfit.addWeight(this.gnomeKnee);
      }

      if (
      adventure.mayFreeRun && (
      familiar != this.goose || (0,external_kolmafia_.familiarWeight)(this.goose) >= 6))
      {
        var item = this.freeRunners.find(function (i) {return (0,external_kolmafia_.availableAmount)(i) > 0;});

        if (item != null) {
          outfit.addWeight(item, 12);
        }
      }

      var locationToSet = toRun.location;

      if (locationToSet == null) {
        locationToSet = external_kolmafia_.Location.get("Noob Cave");
      }

      (0,external_kolmafia_.setLocation)(locationToSet);

      if ((0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("Unbreakable Umbrella")) > 0) {
        setUmbrella(outfit.getUmbrella());
      }

      (0,external_kolmafia_.useFamiliar)(familiar);

      if (!shouldLevelFamiliar(familiar)) {
        outfit.famExpWeight = 0;
      } else if (
      familiar != this.goose ||
      (0,external_kolmafia_.familiarWeight)(this.goose) >= 6 &&
      !powerLevelGoose &&
      adventure.considerPriority != ConsiderPriority.ORB_ABSORB)
      {
        outfit.famExpWeight =
        adventure.considerPriority == ConsiderPriority.RANDOM_ABSORB ? 3 : 1;
      }

      if (shouldGreydayStop()) {
        return;
      }

      var primed = getPrimedResource();

      if (primed != null) {
        primed.resource.prepare(outfit);
      }

      var maximizeResult = (0,external_kolmafia_.maximize)(
      outfit.createString() +
      " " + (
      doOrb ? "+99999 bonus" : "-equip") +
      " miniature crystal ball",
      false);


      if (!maximizeResult) {
        throw "Failed to maximize. Either fix, or report to the script author";
      }

      if (shouldGreydayStop()) {
        return;
      }

      if (primed != null) {
        primed.resource.prepare(null);
      }

      var closet = external_kolmafia_.Item.get("Funky junk key");

      if ((0,external_kolmafia_.itemAmount)(closet) > 0) {
        (0,external_kolmafia_.putCloset)(closet, (0,external_kolmafia_.itemAmount)(closet));
      }
    } }, { key: "runAdventure", value:

    function runAdventure(adventure) {
      var toRun = adventure.adventure;

      if (toRun.outfit != GreyOutfit.IGNORE_OUTFIT) {
        if (toRun.outfit == null) {
          toRun.outfit = new GreyOutfit();
        }

        this.doOutfitPrep(adventure);

        if (shouldGreydayStop()) {
          return;
        }
      } else if (toRun.outfit == null) {
        toRun.outfit = new GreyOutfit();
      }

      if (this.goTime) {
        var turn = (0,external_kolmafia_.turnsPlayed)();

        try {
          var choices = handledChoices.join(",");

          GreyAdventurer.currentAdventure = adventure;
          toRun.run();

          var afterChoices = handledChoices.join(",");

          if (
          choices != afterChoices &&
          (0,external_kolmafia_.getProperty)("greyIgnoreErrors") != "true")
          {
            throw (
              "Expected handled choices to be the same after the adenture was run! Previously: " +
              choices +
              ", now: " +
              afterChoices +
              ". To ignore this, set 'greyIgnoreErrors' to 'true'");

          }
        } finally {
          GreyAdventurer.currentAdventure = null;

          if (GreySettings_GreySettings.greyDebug) {
            var name = "grey_turns_played_".concat((0,external_kolmafia_.myAscensions)(), ".txt");

            var buffer = (0,external_kolmafia_.fileToBuffer)(name);

            if (buffer == "") {
              buffer =
              "# Turns Played\tQuest ID\tLocation\tTurns Taken\tFamiliar";
            }

            var id = adventure.quest ? adventure.quest.getId() : "Non-Quest";

            toRun.location;

            buffer += "\n".concat((0,external_kolmafia_.turnsPlayed)(), "\t").concat(id, "\t").concat(toRun.location, "\t").concat(
            (0,external_kolmafia_.turnsPlayed)() - turn, "\t").concat(
            (0,external_kolmafia_.myFamiliar)());

            (0,external_kolmafia_.bufferToFile)(buffer.toString(), name);
          }
        }
      } else {
        (0,external_kolmafia_.print)("Sim run()!");
      }
    } }]);return GreyAdventurer;}();GreyAdventurer_defineProperty(GreyAdventurer_GreyAdventurer, "currentAdventure", void 0);


function castNoCombatSkills() {
  if (
  (0,external_kolmafia_.haveSkill)(external_kolmafia_.Skill.get("Phase Shift")) &&
  (0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("Shifted Phase")) == 0 &&
  restoreMPTo(50))
  {
    (0,external_kolmafia_.useSkill)(external_kolmafia_.Skill.get("Phase Shift"));
  }

  if (
  (0,external_kolmafia_.haveSkill)(external_kolmafia_.Skill.get("Photonic Shroud")) &&
  (0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("Darkened Photons")) == 0 &&
  restoreMPTo(50))
  {
    (0,external_kolmafia_.useSkill)(external_kolmafia_.Skill.get("Photonic Shroud"));
  }

  restoreMPTo(20);

  if ((0,external_kolmafia_.myMp)() < 20) {
    throw "Expected at least 20 mp";
  }
}

function castCombatSkill() {
  if (
  (0,external_kolmafia_.haveSkill)(external_kolmafia_.Skill.get("Piezoelectric Honk")) &&
  (0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("Hooooooooonk!")) == 0 &&
  restoreMPTo(50))
  {
    (0,external_kolmafia_.useSkill)(external_kolmafia_.Skill.get("Piezoelectric Honk"));
  }

  restoreMPTo(20);

  if ((0,external_kolmafia_.myMp)() < 20) {
    throw "Expected at least 20 mp";
  }
}

var skillPhaseShift = external_kolmafia_.Skill.get("Phase Shift");
var skillPhotonicShroud = external_kolmafia_.Skill.get("Photonic Shroud");
var skillHonk = external_kolmafia_.Skill.get("Piezoelectric Honk");

function hasNonCombatSkillsReady() {var wantBoth = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;
  var s1 = (0,external_kolmafia_.haveSkill)(skillPhaseShift);
  var s2 = (0,external_kolmafia_.haveSkill)(skillPhotonicShroud);

  var s1e = (0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("Shifted Phase")) > 0;
  var s2e = (0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("Darkened Photons")) > 0;

  if (wantBoth) {
    return (
      s1 &&
      s2 &&
      (s1e ? 0 : 50) + (s2e ? 0 : 40) + 20 <= (0,external_kolmafia_.myMp)() + (0,external_kolmafia_.myMeat)() / 200);

  }

  return s1e || s2e || (s1 || s2) && (0,external_kolmafia_.myMp)() + (0,external_kolmafia_.myMeat)() / 200 >= 60;
}

function hasCombatSkillReady() {
  return (
    hasCombatSkillActive() ||
    (0,external_kolmafia_.haveSkill)(skillHonk) && (0,external_kolmafia_.myMp)() + (0,external_kolmafia_.myMeat)() / 200 >= 50);

}

function hasBanisherSkill() {
  return haveSkill(Skill.get("System Sweep"));
}

function hasCombatSkillActive() {
  return (0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("Hooooooooonk!")) > 0;
}

function hasNonCombatSkillActive() {
  return (
    (0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("Shifted Phase")) > 0 ||
    (0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("Darkened Photons")) > 0);

}
;// CONCATENATED MODULE: ./src/utils/RandomChoiceHandler.ts


function getBackupChoices() {
  var backupChoices = [];

  var choices = function choices(choiceNumber) {for (var _len = arguments.length, choices = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {choices[_key - 1] = arguments[_key];}
    for (var _i = 0, _choices = choices; _i < _choices.length; _i++) {var choice = _choices[_i];
      backupChoices.push([choiceNumber, choice]);
    }
  };

  // Sleazy back alley
  choices(112, 1);
  choices(110, 4);
  choices(109, 1);
  choices(108, 4);
  choices(31, 2);

  // Skeleton Office
  choices(1060, 4, 1);

  // Madness Bakery
  choices(1061, 1, 4);

  // Overgrown lot
  choices(1062, 5, 3);

  // Deep Machine
  choices(1119, 6);

  // NEP
  choices(1322, 6);
  choices(1324, 5);

  // Manor pantry
  choices(888, 4);
  choices(889, 5);
  choices(114, 2);
  choices(115, 1);
  choices(116, 4);
  choices(117, 1);

  // Manor library
  choices(163, 3);

  // Manor billards
  choices(875, 1, 3);

  // Manor gallery
  choices(91, 2);
  choices(89, 4);

  // Manor bathroom
  choices(90, 3);
  choices(106, 3);
  choices(107, 4);
  choices(105, 2);
  choices(402, 3);
  choices(882, 1);

  // Manor bedroom
  choices(876, 1);
  choices(877, 1);
  choices(878, 4);
  choices(879, 4, 2);
  choices(880, 1, 2);

  // Manor babies
  choices(884, 1);
  choices(885, 1);
  choices(886, 1);

  // Palin
  choices(180, 2);
  choices(127, 1);
  choices(126, 1);

  // Airship
  choices(178, 2);
  choices(182, 4, 1);
  choices(669, 1, 4);
  choices(670, 1, 5);
  choices(671, 1);
  choices(672, 3);
  choices(673, 3);
  choices(674, 3);
  choices(677, 2, 1);
  choices(678, 1);
  choices(1026, 2);
  choices(1431, 1);
  choices(676, 1);
  choices(675, 1);

  // Knob Goblin
  choices(76, 3);
  choices(111, 3);
  choices(113, 1, 2);
  choices(118, 2);
  choices(120, 4);
  choices(522, 2);

  // Crypts
  choices(153, 4);
  choices(157, 4);
  choices(155, 4, 5);
  choices(523, 4);
  choices(527, 2);

  // Distant woods
  // The NC
  choices(502, 2);
  choices(505, 2);

  choices(46, 3);
  choices(47, 2);
  choices(73, 2);
  choices(74, 2);
  choices(75, 2);
  choices(511, 2);
  choices(512, 2);
  choices(579, 2);
  choices(581, 3);
  choices(582, 1);
  choices(584, 4);
  choices(794, 1);
  choices(795, 1);
  choices(796, 2);
  choices(798, 1);
  choices(923, 1);
  choices(924, 1);

  // Hidden city
  choices(785, 6);
  choices(783, 6);
  choices(781, 6);
  choices(787, 6);
  choices(791, 6);
  choices(788, 1);
  choices(786, 1);
  choices(789, 6);
  choices(784, 1);
  choices(780, 6);
  choices(787, 1, 6);
  choices(685, 1, 6);
  choices(783, 1, 6);
  choices(781, 1, 6);

  // Smut orcs
  choices(1345, 3);

  // Daily dungeon
  choices(692, 3, 8);
  choices(693, 2, 3);
  choices(690, 2);
  choices(691, 2);
  choices(689, 1);

  // Mountains
  choices(25, 3);
  choices(297, 3);
  choices(451, 1);

  // Mountain Peak
  choices(15, 3);
  choices(16, 3);
  choices(17, 3);
  choices(575, 3);
  choices(18, 3);
  choices(19, 3);
  choices(20, 3);
  choices(556, 2);

  // Protesters
  choices(856, 2);
  choices(857, 2);
  choices(858, 2);

  // Desert
  choices(4, 3);
  choices(929, 6);

  // Desert vacation
  choices(793, 4);

  // Island
  choices(22, 3);
  choices(23, 3);
  choices(24, 2);
  choices(72, 2);
  choices(138, 4);
  choices(136, 3);
  choices(137, 3);
  choices(181, 2);
  choices(1433, 3, 1, 2);
  choices(1434, 2, 3, 1);

  // Island war
  choices(147, 3);
  choices(148, 1);
  choices(149, 2);

  choices(139, 3);
  choices(140, 3);
  choices(141, 2);
  choices(142, 3, 2);
  choices(143, 3);
  choices(144, 3);
  choices(145, 2);
  choices(146, 3, 2);

  // Signed zones
  choices(5, 2);

  choices(696, 1, 2);
  choices(697, 1, 2);
  choices(698, 1, 2);

  // Manor lights
  for (var _i2 = 0, _arr = [
    890, 891, 892, 893, 894, 895, 896, 897, 898, 899, 900, 901, 902, 903]; _i2 < _arr.length; _i2++)
  {var choiceNo = _arr[_i2];
    choices(choiceNo, 1, 2, 3);
  }

  // Lil Doctor Bag, turn it off today if we have all upgrades. Otherwise accept.
  choices(1340, (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("doctorBagUpgrades")) >= 5 ? 3 : 1);
  choices(1341, 1);

  // Haunted dog
  choices(1108, 1); // Food
  choices(1106, 3); //Dog chow
  choices(1107, (0,external_kolmafia_.myMeat)() < 6000 ? 3 : 1); // Meat or tennis ball

  // Gingerbread city
  choices(1215, 1); // Set the clock forward

  return backupChoices;
}
;// CONCATENATED MODULE: ./src/utils/GreyLocations.ts
function GreyLocations_typeof(obj) {"@babel/helpers - typeof";return GreyLocations_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, GreyLocations_typeof(obj);}function GreyLocations_slicedToArray(arr, i) {return GreyLocations_arrayWithHoles(arr) || GreyLocations_iterableToArrayLimit(arr, i) || GreyLocations_unsupportedIterableToArray(arr, i) || GreyLocations_nonIterableRest();}function GreyLocations_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function GreyLocations_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function GreyLocations_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function GreyLocations_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = GreyLocations_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function GreyLocations_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return GreyLocations_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return GreyLocations_arrayLikeToArray(o, minLen);}function GreyLocations_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function GreyLocations_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function GreyLocations_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, GreyLocations_toPropertyKey(descriptor.key), descriptor);}}function GreyLocations_createClass(Constructor, protoProps, staticProps) {if (protoProps) GreyLocations_defineProperties(Constructor.prototype, protoProps);if (staticProps) GreyLocations_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function GreyLocations_defineProperty(obj, key, value) {key = GreyLocations_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function GreyLocations_toPropertyKey(arg) {var key = GreyLocations_toPrimitive(arg, "string");return GreyLocations_typeof(key) === "symbol" ? key : String(key);}function GreyLocations_toPrimitive(input, hint) {if (GreyLocations_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (GreyLocations_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}

















var primedResource;

function runPrimedResource() {
  if (getPrimedResource() == null || getPrimedResource().resource.primed()) {
    return;
  }

  getPrimedResource().resource.attemptPrime();
}

function getPrimedResource() {
  return primedResource;
}

function resetPrimedResource() {
  if (getPrimedResource() == null) {
    return;
  }

  if (getPrimedResource().resource.primed()) {
    throw "Can't reset a resource that's been primed";
  }

  primedResource = null;
}

function setPrimedResource(
quest,
path,
resource)
{
  if (getPrimedResource() != null) {
    throw (
      "A resource " +
      getPrimedResource().quest.getId() +
      " has already been set to be primed. Said resource primed? " +
      getPrimedResource().resource.primed());

  }

  if (resource.primed == null) {
    throw "This resource isn't one that can be primed";
  }

  if (resource.primed()) {
    throw "This resource ".concat(resource.name, " is already primed. For now, either use the primed resource or run \"greyday unprime\" to ignore that");
  }

  if (quest.status(path) == QuestStatus.COMPLETED) {
    throw "The quest " + quest.getId() + " claims to be completed";
  }

  primedResource = {
    quest: quest,
    path: path,
    resource: resource
  };
}

var AdventureSettings = /*#__PURE__*/function () {function AdventureSettings() {GreyLocations_classCallCheck(this, AdventureSettings);GreyLocations_defineProperty(this, "startOfFightMacro", void 0);GreyLocations_defineProperty(this, "duringFightMacro", void 0);GreyLocations_defineProperty(this, "finishingBlowMacro", void 0);GreyLocations_defineProperty(this, "choices", void 0);GreyLocations_defineProperty(this, "dontBanishThese", void 0);GreyLocations_defineProperty(this, "banishThese", void 0);GreyLocations_defineProperty(this, "nonquest",






    false);}GreyLocations_createClass(AdventureSettings, [{ key: "addBanishes", value:

    function addBanishes(monsters) {var _iterator = GreyLocations_createForOfIteratorHelper(
        monsters),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var monster = _step.value;
          this.addBanish(monster);
        }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

      return this;
    } }, { key: "addBanish", value:

    function addBanish(monster) {
      if (this.dontBanishThese != null) {
        throw "Already declared banish everything but";
      }

      if (this.banishThese == null) {
        this.banishThese = [];
      }

      this.banishThese.push(monster);

      return this;
    } }, { key: "addNoBanishes", value:

    function addNoBanishes(monsters) {var _iterator2 = GreyLocations_createForOfIteratorHelper(
        monsters),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var monster = _step2.value;
          this.addNoBanish(monster);
        }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}

      return this;
    } }, { key: "addNoBanish", value:

    function addNoBanish(monster) {
      if (this.banishThese != null) {
        throw "Already declared banish only X";
      }

      if (this.dontBanishThese == null) {
        this.dontBanishThese = [];
      }

      this.dontBanishThese.push(monster);

      return this;
    } }, { key: "setBanishAnything", value:

    function setBanishAnything() {
      if (this.dontBanishThese != null || this.banishThese != null) {
        throw "Already declared some banishing";
      }

      if (this.dontBanishThese == null) {
        this.dontBanishThese = [];
      }

      return this;
    } }, { key: "setChoices", value:

    function setChoices(choices) {
      this.choices = choices;

      return this;
    } }, { key: "setStartOfFightMacro", value:

    function setStartOfFightMacro(startOfFightMacro) {
      this.startOfFightMacro = startOfFightMacro;

      return this;
    } }, { key: "setDuringFightMacro", value:

    function setDuringFightMacro(duringFightMacro) {
      this.duringFightMacro = duringFightMacro;

      return this;
    } }, { key: "setFinishingBlowMacro", value:

    function setFinishingBlowMacro(finishingBlowMacro) {
      this.finishingBlowMacro = finishingBlowMacro;

      return this;
    } }]);return AdventureSettings;}();


var backupChoices = getBackupChoices();
var freeRunners = [
"navel ring of navel gazing",
"Greatest American Pants"].
map(function (s) {return external_kolmafia_.Item.get(s);});

function greyAdv(
location,
outfit,
settings)
{
  if (outfit == null) {
    outfit = new GreyOutfit();
  }

  if (settings == null) {
    settings = new AdventureSettings();
  }

  var macro;

  var createMacro = function createMacro() {
    if (settings.startOfFightMacro == null) {
      macro = new Macro();
    } else {
      macro = settings.startOfFightMacro;
    }

    if (settings.duringFightMacro == null) {
      macro.step(greyDuringFightMacro(settings));
    } else {
      macro.
      step(settings.duringFightMacro).
      step(greyDuringFightMacro(settings));
    }

    if (settings.finishingBlowMacro == null) {
      if (
      freeRunners.find(function (i) {return (0,external_kolmafia_.equippedAmount)(i) > 0;}) != null &&
      GreyAdventurer_GreyAdventurer.currentAdventure != null &&
      GreyAdventurer_GreyAdventurer.currentAdventure.freeRun != null &&
      GreyAdventurer_GreyAdventurer.currentAdventure.freeRun((0,external_kolmafia_.lastMonster)(), settings))
      {
        macro.runaway();
      }

      runPrimedResource();

      macro.step(greyKillingBlow(outfit));
    } else {
      macro.step(settings.finishingBlowMacro);
    }
  };

  var choicesRun = [];

  var runChoice = function runChoice() {
    var choiceToPick;

    if (Object.keys((0,external_kolmafia_.availableChoiceOptions)()).length == 0) {
      (0,external_kolmafia_.visitUrl)("choice.php");
    }

    if ((0,external_kolmafia_.lastChoice)() == 904) {
      (0,external_kolmafia_.cliExecute)("choice-goal");
      return "";
    }

    var juneCleaver = (0,external_kolmafia_.lastChoice)() >= 1467 && (0,external_kolmafia_.lastChoice)() <= 1475;

    if (juneCleaver) {
      choiceToPick = (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("choiceAdventure" + (0,external_kolmafia_.lastChoice)()));
    } else if (settings.choices != null) {
      if (settings.choices.calledOutOfScopeChoiceBehavior((0,external_kolmafia_.lastChoice)())) {
        return;
      }

      choiceToPick = settings.choices.handleChoice((0,external_kolmafia_.lastChoice)());
    }

    if (choiceToPick == null) {
      loop: for (var _i = 0, _arr = [handledChoices, backupChoices]; _i < _arr.length; _i++) {var choices = _arr[_i];var _iterator3 = GreyLocations_createForOfIteratorHelper(
          choices),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var _step3$value = GreyLocations_slicedToArray(_step3.value, 2),choiceNumber = _step3$value[0],choiceValue = _step3$value[1];
            if (choiceNumber != (0,external_kolmafia_.lastChoice)()) {
              continue;
            }

            if ((0,external_kolmafia_.availableChoiceOptions)()[choiceValue] == null) {
              continue;
            }

            choiceToPick = choiceValue;
            break loop;
          }} catch (err) {_iterator3.e(err);} finally {_iterator3.f();}
      }
    }

    if (choiceToPick == null) {
      (0,external_kolmafia_.print)("Oh god", "red");
      throw "No idea what to do! Handle the choice manually? Report this issue! Reported to be in choice ".concat((0,external_kolmafia_.lastChoice)(), " with choice options ").concat((0,external_kolmafia_.toJson)(
      (0,external_kolmafia_.availableChoiceOptions)()), ", handling choice: ").concat(
      (0,external_kolmafia_.handlingChoice)(), ", fight follows: ").concat((0,external_kolmafia_.fightFollowsChoice)());
    }

    if (choicesRun.filter(function (c) {return c == (0,external_kolmafia_.lastChoice)();}).length > 6) {
      throw "Detected we're looping in a choice, you will need to manually resolve the choice and should report this issue.";
    }

    choicesRun.push((0,external_kolmafia_.lastChoice)());

    var url =
    "choice.php?pwd=&whichchoice=" + (0,external_kolmafia_.lastChoice)() + "&option=" + choiceToPick;

    (0,external_kolmafia_.print)("Visited " + url);
    return (0,external_kolmafia_.visitUrl)(url);
  };

  var runCombat = function runCombat() {
    if (macro == null) {
      createMacro();
    }

    (0,external_kolmafia_.print)(macro.toString());
    return macro.submit();
  };

  if ((0,external_kolmafia_.currentRound)() == 0 && !(0,external_kolmafia_.handlingChoice)()) {var _lastMonster, _lastMonster$attribut;
    if (outfit.plusCombatWeight > 0) {
      castCombatSkill();
    } else if (outfit.minusCombatWeight > 0) {
      castNoCombatSkills();
    }

    if (typeof location == "string") {
      (0,external_kolmafia_.visitUrl)(location);
    } else if (location != null) {
      (0,external_kolmafia_.visitUrl)("adventure.php?snarfblat=" + (0,external_kolmafia_.toInt)(location));
    }

    if (
    (0,external_kolmafia_.toBoolean)((0,external_kolmafia_.getProperty)("stopForUltraRare")) && (_lastMonster =
    (0,external_kolmafia_.lastMonster)()) !== null && _lastMonster !== void 0 && (_lastMonster$attribut = _lastMonster.attributes) !== null && _lastMonster$attribut !== void 0 && _lastMonster$attribut.includes("ULTRARARE"))
    {
      throw "Ultrarare encounter?";
    }
  }

  while (
  (0,external_kolmafia_.currentRound)() != 0 ||
  (0,external_kolmafia_.handlingChoice)() ||
  (0,external_kolmafia_.fightFollowsChoice)() ||
  (0,external_kolmafia_.choiceFollowsFight)())
  {
    var page = "";

    if ((0,external_kolmafia_.currentRound)() != 0) {
      page = runCombat();

      if ((0,external_kolmafia_.currentRound)() != 0) {
        throw "Didn't expect to still be in combat! Maybe health is too low that we aborted to be safe?";
      }
    } else if ((0,external_kolmafia_.handlingChoice)() || (0,external_kolmafia_.fightFollowsChoice)()) {
      page = runChoice();
    }

    if (page != null) {
      var match = page.match(/<!-- autumnback -->(\d+)/);

      match;

      if (match != null) {
        (0,external_kolmafia_.print)(
        "Autumn-aton will be back from '" +
        (0,external_kolmafia_.getProperty)("autumnatonQuestLocation") +
        "' in " +
        match[1] +
        " adventures..",
        "gray");

      }

      if ((0,external_kolmafia_.choiceFollowsFight)()) {
        (0,external_kolmafia_.visitUrl)("main.php");
      }
    }
  }
}

var cachedLocations = new Map();

function getLocations(monster) {
  if (cachedLocations.has(monster)) {
    return cachedLocations.get(monster);
  }

  var locations = [];var _iterator4 = GreyLocations_createForOfIteratorHelper(

    external_kolmafia_.Location.all()),_step4;try {for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {var l = _step4.value;
      var monsters = Object.keys((0,external_kolmafia_.getLocationMonsters)(l)).map(function (k) {return (
          external_kolmafia_.Monster.get(k));});


      if (!monsters.includes(monster)) {
        continue;
      }

      locations.push(l);
    }} catch (err) {_iterator4.e(err);} finally {_iterator4.f();}

  cachedLocations.set(monster, locations);

  return locations;
}
;// CONCATENATED MODULE: ./src/utils/GreyUtils.ts
function GreyUtils_slicedToArray(arr, i) {return GreyUtils_arrayWithHoles(arr) || GreyUtils_iterableToArrayLimit(arr, i) || GreyUtils_unsupportedIterableToArray(arr, i) || GreyUtils_nonIterableRest();}function GreyUtils_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function GreyUtils_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function GreyUtils_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function GreyUtils_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = GreyUtils_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function GreyUtils_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return GreyUtils_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return GreyUtils_arrayLikeToArray(o, minLen);}function GreyUtils_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}


var Worksheds = [
"",
"Model train set",
"cold medicine cabinet",
"diabolic pizza cube",
"Asdon Martin keyfob",
"portable Mayo Clinic",
"Little Geneticist DNA-Splicing Lab"];




var UmbrellaState;(function (UmbrellaState) {UmbrellaState["MONSTER_LEVEL"] = "broken";UmbrellaState["DAMAGE_REDUCTION_SHIELD"] = "forward";UmbrellaState["ITEM_DROPS"] = "bucket";UmbrellaState["WEAPON_DAMAGE"] = "pitchfork";UmbrellaState["SPELL_DAMAGE"] = "twirling";UmbrellaState["MINUS_COMBAT"] = "cocoon";})(UmbrellaState || (UmbrellaState = {}));








function GreyUtils_centerText(text, color) {
  return "<div style=\"text-align: center;\"".concat(
  color ? " color='" + color + "'" : "", "><p style=\"margin: 0; padding: 0;\">").concat(
  text, "</p></div>");
}

var umbrella = external_kolmafia_.Item.get("Unbreakable Umbrella");
var lefthand = external_kolmafia_.Familiar.get("Left-Hand Man");

function getUmbrella() {
  if ((0,external_kolmafia_.availableAmount)(umbrella) == 0) {
    return null;
  }
  var prop = (0,external_kolmafia_.getProperty)("umbrellaState");

  for (var _i = 0, _Object$values = Object.values(UmbrellaState); _i < _Object$values.length; _i++) {var state = _Object$values[_i];
    if (!prop.includes(state)) {
      return;
    }

    return state;
  }

  return null;
}

function setUmbrella(setting) {
  if (
  (0,external_kolmafia_.availableAmount)(umbrella) == 0 ||
  (0,external_kolmafia_.getProperty)("umbrellaState").includes(setting))
  {
    return;
  }

  if (
  (0,external_kolmafia_.familiarEquippedEquipment)(lefthand) == umbrella &&
  (0,external_kolmafia_.myFamiliar)() != lefthand)
  {
    (0,external_kolmafia_.retrieveItem)(umbrella);
  }

  (0,external_kolmafia_.cliExecute)("umbrella " + setting);
}

function canCombatLocket(monster) {
  var foughtToday = getProperty("_locketMonstersFought").
  split(",").
  map(function (s) {return toMonster(toInt(s));});

  if (foughtToday.length >= 3 || foughtToday.includes(monster)) {
    return false;
  }

  var monsters = Object.keys(getLocketMonsters()).map(function (s) {return (
      toMonster(s));});


  if (!monsters.includes(monster)) {
    return false;
  }

  return true;
}

function getBackupsRemaining() {
  return 11 - (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_backUpUses"));
}

function doColor(text, color) {
  return "<font color='".concat(color, "'>").concat(text, "</font>");
}

function getEncounters(
location)

{var encounters = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
  var spl = (0,external_kolmafia_.sessionLogs)(1)[0].split("\n");
  var reg = /^\[(\d+)\] (.*?)\r?$/;
  var matches = [];
  var turn;
  var doing = false;var _iterator = GreyUtils_createForOfIteratorHelper(

    spl),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var s = _step.value;
      if (s.startsWith("[")) {
        var match = s.match(reg);

        if (match == null) {
          continue;
        }

        turn = (0,external_kolmafia_.toInt)(match[1]);

        if (location != null) {
          doing = match[2] == location;
        }
      } else if (s.startsWith("Encounter: ")) {
        if (turn == null) {
          continue;
        }

        var name = s.substring(s.indexOf(": ") + 2).replace("\r", "");

        if (!doing && (encounters == null || !encounters.includes(name))) {
          continue;
        }

        // TODO Really need to parse encounters without hardcoding this
        if (
        name == "Adjust your Parka" ||
        name == "Configure Your Unbreakable Umbrella" ||
        name == "Direct Autumn-Aton")
        {
          continue;
        }

        matches.push([name, turn]);
      }
    }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

  return matches;
}

var ballProp = function ballProp() {return (
    (0,external_kolmafia_.getProperty)("crystalBallPredictions").
    split("|").
    map(function (element) {return element.split(":");}).
    map(
    function (_ref) {var _ref2 = GreyUtils_slicedToArray(_ref, 3),turncount = _ref2[0],location = _ref2[1],monster = _ref2[2];return (
        [parseInt(turncount), (0,external_kolmafia_.toLocation)(location), (0,external_kolmafia_.toMonster)(monster)]);}));};






var lastToasterGaze = 0;
var lastPonder = 0;
var GreyUtils_crystalBall = external_kolmafia_.Item.get("miniature crystal ball");
var teleportis = external_kolmafia_.Effect.get("Teleportitis");

function doToasterGaze() {
  if (
  (0,external_kolmafia_.availableAmount)(GreyUtils_crystalBall) == 0 ||
  (0,external_kolmafia_.turnsPlayed)() == lastToasterGaze ||
  (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("lastDesertUnlock")) < (0,external_kolmafia_.myAscensions)() ||
  (0,external_kolmafia_.haveEffect)(teleportis) > 0 ||
  getPrimedResource() != null && getPrimedResource().resource.primed())
  {
    return;
  }

  if (ballProp().find(function (_ref3) {var _ref4 = GreyUtils_slicedToArray(_ref3, 1),turn = _ref4[0];return turn + 1 < (0,external_kolmafia_.turnsPlayed)();}) == null) {
    return;
  }

  if ((0,external_kolmafia_.equippedAmount)(external_kolmafia_.Item.get("June Cleaver")) > 0) {
    (0,external_kolmafia_.equip)(external_kolmafia_.Item.none, external_kolmafia_.Slot.get("weapon"));
  }

  (0,external_kolmafia_.print)(
  "As if infected, your legs bring you to the beach where you feel compelled to toastergaze. A light slap brings you out of it, Gausie lectures you on the dangers of toast. But that's not right, you can see a mountain of toast in their displaycase..",
  "blue");

  greyAdv("adventure.php?snarfblat=355");
  lastToasterGaze = (0,external_kolmafia_.turnsPlayed)();
  lastPonder = (0,external_kolmafia_.turnsPlayed)();
  (0,external_kolmafia_.visitUrl)("inventory.php?ponder=1", false);
}

/**
 * Returns a map of locations, and the monsters predicted.
 *
 * The boolean is a "Should we show fights that will still be valid if we waste a turn elsewhere"
 */
function currentPredictions() {
  if ((0,external_kolmafia_.availableAmount)(GreyUtils_crystalBall) == 0) {
    return new Map();
  }

  var predictions = ballProp();

  if (lastPonder != (0,external_kolmafia_.turnsPlayed)()) {
    var expectedExpire =
    predictions.find(
    function (_ref5) {var _ref6 = GreyUtils_slicedToArray(_ref5, 2),turn = _ref6[0],loc = _ref6[1];return (
        turn + 1 < (0,external_kolmafia_.turnsPlayed)() &&
        loc != (0,external_kolmafia_.toLocation)((0,external_kolmafia_.getProperty)("lastAdventure")));}) !=
    null;

    if (expectedExpire) {
      lastPonder = (0,external_kolmafia_.turnsPlayed)();

      (0,external_kolmafia_.visitUrl)("inventory.php?ponder=1", false);

      predictions = ballProp();
    }
  }

  return new Map(
  predictions.map(function (_ref7) {var _ref8 = GreyUtils_slicedToArray(_ref7, 3),location = _ref8[1],monster = _ref8[2];return [location, monster];}));

}

function getAllCombinations(
valuesArray)

{var uniquesOnly = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;
  var combi = [];
  var temp = [];
  var slent = Math.pow(2, valuesArray.length);
  var uniques = [];
  var added = [];

  valuesArray.forEach(function (v, index) {
    if (valuesArray.indexOf(v) != index) {
      return;
    }

    uniques.push(v);
  });

  for (var i = 0; i < slent; i++) {
    temp = [];

    for (var j = 0; j < valuesArray.length; j++) {
      if (!(i & Math.pow(2, j))) {
        continue;
      }

      temp.push(valuesArray[j]);
    }

    if (temp.length == 0) {
      continue;
    }

    // If we don't want the same arrays but in different orders
    if (uniquesOnly) {
      var id = temp.
      map(function (t) {return uniques.findIndex(function (v) {return v === t;});}).
      sort().
      join(",");

      if (added.includes(id)) {
        continue;
      } else {
        added.push(id);
      }
    }

    combi.push(temp);
  }

  combi.sort(function (a, b) {return a.length - b.length;});

  return combi;
}

function hasPulled(item) {
  return (0,external_kolmafia_.getProperty)("_roninStoragePulls").
  split(",").
  includes((0,external_kolmafia_.toInt)(item).toString());
}

function canGreyAdventure(location) {
  if (
  location.zone == "Pandamonium" &&
  (0,external_kolmafia_.getProperty)("questL06Friar") != "finished")
  {
    return false;
  }

  return (0,external_kolmafia_.canAdventure)(location);
}

/**
 * Returns the list of effects from helmet in order of when you'd acquire them
 */
function getDaylightShavingsBuffs() {
  var lastBeardBuff = toInt(getProperty("lastBeardBuff"));

  if (lastBeardBuff > 0) {
    lastBeardBuff -= 2665;
  }

  lastBeardBuff = (toInt(myClass()) % 6 + lastBeardBuff) % 11;

  var effects = [];

  for (var i = 0; i < 11; i++) {
    var num = 2666 + (lastBeardBuff + i) % 11;
    var effect = toEffect(toInt(num));

    effects.push(effect);
  }

  return effects;
}

function isDaylightShavingBuffReady() {
  return getDaylightShavingsBuffs().find(function (e) {return haveEffect(e) > 1;}) == null;
}
;// CONCATENATED MODULE: ./src/utils/GreySettings.ts
function GreySettings_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function GreySettings_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, GreySettings_toPropertyKey(descriptor.key), descriptor);}}function GreySettings_createClass(Constructor, protoProps, staticProps) {if (protoProps) GreySettings_defineProperties(Constructor.prototype, protoProps);if (staticProps) GreySettings_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function GreySettings_defineProperty(obj, key, value) {key = GreySettings_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function GreySettings_toPropertyKey(arg) {var key = GreySettings_toPrimitive(arg, "string");return GreySettings_typeof(key) === "symbol" ? key : String(key);}function GreySettings_toPrimitive(input, hint) {if (GreySettings_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (GreySettings_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}function GreySettings_typeof(obj) {"@babel/helpers - typeof";return GreySettings_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, GreySettings_typeof(obj);}function GreySettings_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = GreySettings_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function GreySettings_toConsumableArray(arr) {return GreySettings_arrayWithoutHoles(arr) || GreySettings_iterableToArray(arr) || GreySettings_unsupportedIterableToArray(arr) || GreySettings_nonIterableSpread();}function GreySettings_nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function GreySettings_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return GreySettings_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return GreySettings_arrayLikeToArray(o, minLen);}function GreySettings_iterableToArray(iter) {if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);}function GreySettings_arrayWithoutHoles(arr) {if (Array.isArray(arr)) return GreySettings_arrayLikeToArray(arr);}function GreySettings_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}





















function GreySettings_getGreySettings() {
  var isBoolean = function isBoolean(str) {return str == "true" || str == "false";};
  var triBoolean = ["Best Judgement", "Always", "Never"];
  var isTriBoolean = function isTriBoolean(str) {return (
      triBoolean.includes(str));};

  var towerBreak = {
    name: "Break at Tower",
    property: "greyBreakAtTower",
    description:
    "Should the script halt when it reaches the tower? False by default. Useful as continuing after breaking ronin takes less turns. This will change the behavior of the script to skip some zones.",
    valid: isBoolean,
    "default": true
  };

  var moonTune = {
    name: "Tune Moon Spoon",
    property: "greyTuneMoonSpoon",
    description:
    "If set, will use the rune moon spoon (if owned) to change moon signs to the requested moon sign when done with tasks in the current moon sign.",
    valid: function valid(value) {return (
        moonSigns.find(function (s) {return s.toLowerCase() == value.toLowerCase();}) != null);},
    viableSettings: [
    ["Don't Tune", ""]].concat(GreySettings_toConsumableArray(
    moonSigns.map(function (sign) {return [getMoonZone(sign) + " - " + sign, sign];}))),




    "default": null
  };

  var manorLights = {
    name: "Finish Manor Lights",
    property: "greyFinishManorLights",
    description:
    "The script will do the hidden manor lights quest, but should it fight Elizabeth & Stephen at the end? (Garbo does fight Stephen for meat)",
    valid: isBoolean,
    "default": false
  };

  var pvpEnable = {
    name: "Enable PvP",
    property: "greyEnablePvP",
    description:
    "Should the script enable PvP at the start of the run? This doesn't actually make much difference vs enabling it later as there's no pvp generation, unless you have robortender.",
    valid: isBoolean,
    "default": false
  };

  for (var _i = 0, _arr = ["greyDailyMalware"]; _i < _arr.length; _i++) {var str = _arr[_i];
    if (!(0,external_kolmafia_.propertyExists)(str)) {
      continue;
    }

    var val = (0,external_kolmafia_.getProperty)(str);

    if (triBoolean.includes(val)) {
      continue;
    }

    if (val == "true") {
      (0,external_kolmafia_.setProperty)(str, "Always");
    } else if (val == "false") {
      (0,external_kolmafia_.setProperty)(str, "Never");
    } else {
      (0,external_kolmafia_.setProperty)(str, "Best Judgement");
    }
  }

  var dailyMalware = {
    name: "Daily Malware",
    property: "greyDailyMalware",
    description:
    "If we do daily dungeon, how should we treat daily malware? Set to 'Always' 'Never' or 'Best Judgement'",
    valid: isTriBoolean,
    viableSettings: triBoolean,
    "default": "Best Judgement"
  };

  var dailyDungeon = {
    name: "Daily Dungeon",
    property: "greyDailyDungeon",
    description:
    "Should the script always do daily dungeon, even when there is no need to? Eg, tower break. Useful in conjunction with greyDailyMalware",
    valid: isBoolean,
    "default": true
  };

  var levelingResources = {
    name: "Prepare Leveling Resources",
    property: "greyPrepareLevelingResources",
    description:
    "If this is set to true, script will attempt to prepare resources that are useful for power leveling. Namely familiar scrapbook and raise goose weight.",
    valid: isBoolean,
    "default": true
  };

  var skipPalindome = {
    name: "Skip Palindome",
    property: "greySkipPalindome",
    description:
    "If set to true, will not complete palindome. This is only useful if you intend to burn turns on UR farming, and you're recommended to save at least 80 turns minumum to resume the script. To resume, this will need to be set to false.",
    valid: isBoolean,
    "default": false
  };

  var deleteKmails = {
    name: "Delete Kmails",

    property: "greyDeleteKmails",
    description:
    "When true, will delete kmails from spooky lady and fortune teller",
    valid: isBoolean,
    "default": true
  };

  var useMummery = {
    name: "Use Mummery",

    property: "greyUseMummery",
    description:
    "If set to true, will set grey goose to use MP restoring. This is enabled by default as there isn't really a reason not to.",
    valid: isBoolean,
    "default": true,
    viable: (0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("mumming trunk")) > 0
  };

  var defaultAdvValue =
  Math.round((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("valueOfAdventure")) * 0.7 / 100) * 100;

  var grayAdventureValue = {
    name: "Value of GYou Adventure",

    property: "greyValueOfAdventure",
    description:
    "Used to determine how to prioritize resources, a fax for example is worth 20k. If it saves 3 turns and each turn is worth 10k, then it's obviously worth using the fax to save those 3 turns. Default value is based off roughly 70% of pref valueOfAdventure.",
    valid: function valid(value) {return /\d+/.test(value);},
    "default": defaultAdvValue
  };

  var greySavePulls = {
    name: "Allowed Pulls",

    property: "greyPullsLimit",
    description:
    "How many pulls the script can use, if this is too low then you're going to have a bad time. 20 means the script can use up to 20 pulls, leaving 0 remaining.",
    valid: function valid(value) {return /\d+/.test(value);},
    "default": 20
  };

  var greyVoteMonster = {
    name: "Use Voting Booth",
    property: "greyVotingBooth",
    description:
    "If you own the voting booth, what buffs should GreyDay pick up? If none are selected, will not use. You may be better off picking this after ascending, eg: SC has familiar exp. Hot Res is only useful in Haunted Kitchen, and will save 3-4 turns at most. Muscle is best used after prism, moxie will deal more damage in gyou",
    "default": "",
    valid: function valid() {return true;},
    viableSettings: [
    ["Muscle +25%", "1"],
    ["Moxie +25%", "3"],
    ["Hot Resist (+3)", "4"]],

    tags: { maxTags: 2 }
  };

  var greyDefaultWorkshed = {
    name: "Default Workshed",
    property: "greyDefaultWorkshed",
    description:
    "What should Greyday set your empty workshed to at the start of the day?",
    valid: function valid(value) {return (
        value == "" ||
        Worksheds.find(function (s) {return s.toLowerCase() == value.toLowerCase();}) != null);},
    viableSettings: GreySettings_toConsumableArray(
    Worksheds.map(function (w) {return [w == "" ? "Don't Set" : w, w];})),




    "default": ""
  };
  var greySwitchWorkshed = {
    name: "Switch Workshed to",
    property: "greySwitchWorkshed",
    description:
    "Applicable only if you're starting your run with Cold Medicine Cabinet, if set to the name of a workshed item, will switch to that workshed after all 5 CMC uses are expended. Requires the item to be in inventory",
    valid: function valid(value) {return (
        value == "" ||
        Worksheds.find(function (s) {return s.toLowerCase() == value.toLowerCase();}) != null);},
    viableSettings: GreySettings_toConsumableArray(
    Worksheds.map(function (w) {return [w == "" ? "Don't Switch" : w, w];})),




    "default": ""
  };

  var greyClipArt = {
    name: "Clipart Targets",
    property: "greyClipArt",
    description:
    "A comma seperated list of familiar names you'd like Greyday to summon and use Familiar Jacks on if you have Tome of Clip Art",
    valid: function valid(value) {var _iterator = GreySettings_createForOfIteratorHelper(
        value.split(",").map(function (s) {return s.trim();})),_step;try {var _loop = function _loop() {var s = _step.value;
          if (s.length == 0) {return "continue";

          }

          var fam = external_kolmafia_.Familiar.all().find(
          function (f) {return f.toString().toLowerCase() == s.toLowerCase();});


          if (fam != null) {return "continue";

          }return { v:

            false };
        };for (_iterator.s(); !(_step = _iterator.n()).done;) {var _ret = _loop();if (_ret === "continue") continue;if (GreySettings_typeof(_ret) === "object") return _ret.v;}} catch (err) {_iterator.e(err);} finally {_iterator.f();}

      return true;
    },
    "default": "Grey Goose",
    viableSettings: external_kolmafia_.Familiar.all().
    filter(function (f) {return (0,external_kolmafia_.haveFamiliar)(f);}).
    map(function (f) {return f.toString();}),
    tags: { maxTags: 3 }
  };

  var greyCosplaySaber = {
    name: "Cosplay Saber",
    property: "greyCosplaySaber",
    description:
    "What upgrade should GreyDay place on the Cosplay Saber if you own it?",
    valid: function valid(value) {return value.length == 0 || /^\d+$/.test(value);},
    "default": "resistance",
    viableSettings: [
    ["Don't Modify", ""],
    ["15-20 MP Regen", "mp"],
    ["+20 Monster Level", "ml"],
    ["+3 elemental resistance", "resistance"],
    ["+10 Familiar Weight", "familiar"]]

  };

  var viableClans = [
  ["Don't use VIP Invitation", ""]].concat(GreySettings_toConsumableArray(
  GreySettings_toConsumableArray(getAvailableClans().values()).map(function (s) {return [s, s];})));


  var greyVIPClan = {
    name: "VIP Clan to use",
    property: "greyVIPClan",
    description:
    "The name of the clan we will use to execute Fax Requests, and switch to for other VIP functions if they are not available in our current clan. Set to empty (Or in relay, 'Don't use VIP Invitation') to disable all VIP usage, even the yellow rockets.. Best support for 'Bonus Adventures From Hell' and 'The Average Clan'",
    valid: function valid(value) {return (
        value.length == 0 ||
        (0,external_kolmafia_.getClanName)().toLowerCase() == value.toLowerCase() ||
        GreySettings_toConsumableArray(getAvailableClans().values()).find(
        function (s) {return s.toLowerCase() == value.toLowerCase();}) !=
        null);},
    "default": "Bonus Adventures From Hell",
    viableSettings: viableClans
  };

  var greyFortuneTeller = {
    name: "Use Fortune Teller",
    property: "greyFortuneTeller",
    description:
    "If the script should use fortune teller if possible. Will grab: Prank Item, then Potion, then Psychic Equipment",
    valid: isBoolean,
    "default": true
  };

  var greyGrabZapWand = {
    name: "Grab Zap Wand",
    property: "greyGrabZapWand",
    description:
    "Should the script grab the zap wand? This generally adds another 5-6 turns to the run. You'll need this if you don't have enough key sources",
    valid: isBoolean,
    "default": false
  };

  var prioritizeLocket = {
    name: "Combat Lover's Locket weight",
    property: "greyLocketWeight",
    description:
    "Set this to a value higher than 0 to add weight to maximizer if you want Greyday to wear the locket more often, this is only useful if you're trying to locket everything",
    valid: function valid(s) {return /$\d+^/.test(s);},
    "default": 0
  };

  var grabMeatSkill = {
    name: "Pick up the Meat Skill",
    property: "greyMeatSkill",
    description:
    "Should GreyDay grab Financial Spreadsheets? +40% meat from monsters, doesn't effect the run itself. Convenient means it'll grab the skill if it's an orb prediction or current fight, but not care about it.",
    valid: function valid(s) {return (
        ["Yes", "No", "Convenient"].find(
        function (a) {return a.toLowerCase() == s.toLowerCase();}) !=
        null);},
    viableSettings: [
    ["Yes", "Yes"],
    ["No", "No"],
    ["Only if Convenient", "Convenient"]],

    "default": "Yes"
  };

  var greyUseFamiliar = {
    name: "Familiars to use",
    property: "greyUseFamiliars",
    description:
    "Comma seperated list of familiars in order of priority to use. Best used with only a few fams at most, does support drop fams",
    valid: function valid(s) {return (
        ["Yes", "No", "Convenient"].find(
        function (a) {return a.toLowerCase() == s.toLowerCase();}) !=
        null);},
    viableSettings: [
    ["Yes", "Yes"],
    ["No", "No"],
    ["Only if Convenient", "Convenient"]],

    "default": "Yes"
  };

  return [
  // Booleans
  towerBreak,
  manorLights,
  pvpEnable,
  dailyDungeon,
  levelingResources,
  deleteKmails,
  greyFortuneTeller,
  greyGrabZapWand,
  skipPalindome,
  // Dropdowns
  useMummery,
  greyVIPClan,
  moonTune,
  grabMeatSkill,
  greyDefaultWorkshed,
  greySwitchWorkshed,
  greyCosplaySaber,
  dailyMalware,
  // Voting Booth
  greyVoteMonster,
  // Inputs
  greySavePulls,
  grayAdventureValue,
  greyClipArt,
  prioritizeLocket].
  map(function (s) {
    s.setting = "main";

    return s;
  });
}

var moonSigns = [
"Mongoose",
"Wallaby",
"Vole",
"Platypus",
"Opossum",
"Marmot",
"Wombat",
"Blender",
"Packrat"];















function getMoonZone() {var sign = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : (0,external_kolmafia_.mySign)();
  var index = moonSigns.findIndex(
  function (s) {return s.toLowerCase() == (sign === null || sign === void 0 ? void 0 : sign.toLowerCase());});


  if (index < 0) {
    return null;
  } else if (index <= 2) {
    return "Knoll";
  } else if (index <= 5) {
    return "Canadia";
  }

  return "Gnomad";
}

var spoon = external_kolmafia_.Item.get("hewn moon-rune spoon");

var GreySettings_GreySettings = /*#__PURE__*/function () {function GreySettings() {GreySettings_classCallCheck(this, GreySettings);}GreySettings_createClass(GreySettings, null, [{ key: "isHardcoreMode", value:



































    function isHardcoreMode() {
      return this.hardcoreMode || (0,external_kolmafia_.inHardcore)();
    } }, { key: "willBeAccessible", value:

    function willBeAccessible(
    moonzone)

    {var assumeUnstarted = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
      return (
        (assumeUnstarted || (0,external_kolmafia_.getProperty)("moonTuned") != "true") &&
        (0,external_kolmafia_.availableAmount)(spoon) > 0 &&
        this.greyTuneMoonSpoon != null &&
        getMoonZone(this.greyTuneMoonSpoon) == moonzone);

    } }, { key: "canMoonSpoon", value:

    function canMoonSpoon() {
      return (
        (0,external_kolmafia_.getProperty)("moonTuned") == "false" &&
        (0,external_kolmafia_.availableAmount)(spoon) > 0 &&
        this.greyTuneMoonSpoon != null &&
        this.greyTuneMoonSpoon.toLowerCase() != (0,external_kolmafia_.mySign)().toLowerCase());

    }

    /**
     * If we aim to collect a hippy outfit
     */ }, { key: "isHippyMode", value:
    function isHippyMode() {
      return this.greyHippyMode || this.isHardcoreMode();
    } }, { key: "shouldAvoidTowerRequirements", value:

    function shouldAvoidTowerRequirements() {
      return !GreySettings.isHardcoreMode() && this.greyBreakAtTower;
    } }, { key: "isNerfMode", value:

    function isNerfMode() {
      return true;
    } }, { key: "loadSettings", value:

    function loadSettings() {var _iterator2 = GreySettings_createForOfIteratorHelper(
        GreySettings_getGreySettings()),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var setting = _step2.value;
          var prop = (0,external_kolmafia_.getProperty)(setting.property);

          if (prop == "") {
            prop = setting["default"];
          } else if (typeof setting["default"] == "boolean") {
            prop = (0,external_kolmafia_.toBoolean)(prop);
          } else if (typeof setting["default"] == "number") {
            prop = (0,external_kolmafia_.toInt)(prop);
          }

          GreySettings[setting.property] = prop;
        }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}

      if (this.isHardcoreMode()) {
        GreySettings.greyBreakAtTower = false;
      }
    } }]);return GreySettings;}();GreySettings_defineProperty(GreySettings_GreySettings, "hardcoreMode", false);GreySettings_defineProperty(GreySettings_GreySettings, "speedRunMode", false);GreySettings_defineProperty(GreySettings_GreySettings, "adventuresBeforeAbort", 8);GreySettings_defineProperty(GreySettings_GreySettings, "adventuresGenerateIfPossibleOrAbort", 12);GreySettings_defineProperty(GreySettings_GreySettings, "usefulSkillsWeight", 6);GreySettings_defineProperty(GreySettings_GreySettings, "handySkillsWeight", 0.5);GreySettings_defineProperty(GreySettings_GreySettings, "greyBreakAtTower", void 0);GreySettings_defineProperty(GreySettings_GreySettings, "greyReachedTower", (0,external_kolmafia_.toBoolean)((0,external_kolmafia_.getProperty)("_greyReachedTower")));GreySettings_defineProperty(GreySettings_GreySettings, "greyDailyDungeon", void 0);GreySettings_defineProperty(GreySettings_GreySettings, "greyDailyMalware", void 0);GreySettings_defineProperty(GreySettings_GreySettings, "greyPrepareLevelingResources", void 0);GreySettings_defineProperty(GreySettings_GreySettings, "greyFantasyBandits", void 0);GreySettings_defineProperty(GreySettings_GreySettings, "greyTuneMoonSpoon", void 0);GreySettings_defineProperty(GreySettings_GreySettings, "greyDebug", (0,external_kolmafia_.toBoolean)((0,external_kolmafia_.getProperty)("greyDebug") || "false"));GreySettings_defineProperty(GreySettings_GreySettings, "greySkipPalindome", void 0);GreySettings_defineProperty(GreySettings_GreySettings, "greyPullsLimit", 20);GreySettings_defineProperty(GreySettings_GreySettings, "greyValueOfAdventure", void 0);GreySettings_defineProperty(GreySettings_GreySettings, "greyUseMummery", void 0);GreySettings_defineProperty(GreySettings_GreySettings, "greyVotingBooth", void 0);GreySettings_defineProperty(GreySettings_GreySettings, "greyBountyHunting", void 0);GreySettings_defineProperty(GreySettings_GreySettings, "greyDefaultWorkshed", void 0);GreySettings_defineProperty(GreySettings_GreySettings, "greySwitchWorkshed", void 0);GreySettings_defineProperty(GreySettings_GreySettings, "greyClipArt", void 0);GreySettings_defineProperty(GreySettings_GreySettings, "greyVIPClan", void 0);GreySettings_defineProperty(GreySettings_GreySettings, "greyFortuneTeller", void 0);GreySettings_defineProperty(GreySettings_GreySettings, "greyDeleteKmails", void 0);GreySettings_defineProperty(GreySettings_GreySettings, "greyHippyMode", false);GreySettings_defineProperty(GreySettings_GreySettings, "greyGrabZapWand", void 0);GreySettings_defineProperty(GreySettings_GreySettings, "greyLocketWeight", void 0);GreySettings_defineProperty(GreySettings_GreySettings, "greyCosplaySaber", void 0);GreySettings_defineProperty(GreySettings_GreySettings, "greyMeatSkill", void 0);GreySettings_defineProperty(GreySettings_GreySettings, "greyUseFamiliars", "");
;// CONCATENATED MODULE: ./src/utils/GreyClan.ts
function GreyClan_typeof(obj) {"@babel/helpers - typeof";return GreyClan_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, GreyClan_typeof(obj);}function GreyClan_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = GreyClan_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function GreyClan_slicedToArray(arr, i) {return GreyClan_arrayWithHoles(arr) || GreyClan_iterableToArrayLimit(arr, i) || GreyClan_unsupportedIterableToArray(arr, i) || GreyClan_nonIterableRest();}function GreyClan_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function GreyClan_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function GreyClan_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function GreyClan_toConsumableArray(arr) {return GreyClan_arrayWithoutHoles(arr) || GreyClan_iterableToArray(arr) || GreyClan_unsupportedIterableToArray(arr) || GreyClan_nonIterableSpread();}function GreyClan_nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function GreyClan_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return GreyClan_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return GreyClan_arrayLikeToArray(o, minLen);}function GreyClan_iterableToArray(iter) {if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);}function GreyClan_arrayWithoutHoles(arr) {if (Array.isArray(arr)) return GreyClan_arrayLikeToArray(arr);}function GreyClan_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function GreyClan_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function GreyClan_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, GreyClan_toPropertyKey(descriptor.key), descriptor);}}function GreyClan_createClass(Constructor, protoProps, staticProps) {if (protoProps) GreyClan_defineProperties(Constructor.prototype, protoProps);if (staticProps) GreyClan_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function GreyClan_defineProperty(obj, key, value) {key = GreyClan_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function GreyClan_toPropertyKey(arg) {var key = GreyClan_toPrimitive(arg, "string");return GreyClan_typeof(key) === "symbol" ? key : String(key);}function GreyClan_toPrimitive(input, hint) {if (GreyClan_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (GreyClan_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}


var vipInvitation = external_kolmafia_.Item.get("Clan VIP Lounge key");
var fireworks = external_kolmafia_.Item.get("Clan Underground fireworks shop");
var fortune = external_kolmafia_.Item.get("Clan Carnival Game");
var faxMachine = external_kolmafia_.Item.get("deluxe fax machine");
var faxOnline = (0,external_kolmafia_.isOnline)("CheeseFax");
var fortuneTellers = new Map([
[82072, "AverageChat"],
[90485, "CheeseFax"]]);


var availableClans;var

ClanSwitcher = /*#__PURE__*/function () {function ClanSwitcher() {GreyClan_classCallCheck(this, ClanSwitcher);GreyClan_defineProperty(this, "origClan",
    (0,external_kolmafia_.getClanId)());}GreyClan_createClass(ClanSwitcher, [{ key: "joinClan", value:

    function joinClan(id) {
      if ((0,external_kolmafia_.getClanId)() == id) {
        return true;
      }

      var page = (0,external_kolmafia_.visitUrl)(
      "showclan.php?recruiter=1&whichclan=" +
      id +
      "&pwd&whichclan=" +
      id +
      "&action=joinclan&apply=Apply+to+this+Clan&confirm=on");


      var success = page.includes("clanhalltop.gif");

      if (success) {
        (0,external_kolmafia_.print)("Switched to clan " + (0,external_kolmafia_.getClanName)(), "gray");
      } else {
        (0,external_kolmafia_.print)("Failed to switch clans! Unable to switch to clan ID " + id, "red");
      }

      return success;
    } }, { key: "restoreClan", value:

    function restoreClan() {
      if (this.origClan == (0,external_kolmafia_.getClanId)()) {
        return;
      }

      this.joinClan(this.origClan);
    } }]);return ClanSwitcher;}();


function getDefaultClan() {
  if (GreySettings_GreySettings.greyVIPClan.trim().length == 0) {
    return null;
  }

  if (GreySettings_GreySettings.greyVIPClan.trim().toLowerCase() == (0,external_kolmafia_.getClanName)()) {
    return (0,external_kolmafia_.getClanId)();
  }

  var clanInfo = GreyClan_toConsumableArray(getAvailableClans()).find(
  function (_ref) {var _ref2 = GreyClan_slicedToArray(_ref, 2),v = _ref2[1];return v.toLowerCase() == GreySettings_GreySettings.greyVIPClan.toLowerCase();});


  if (clanInfo == null) {
    return null;
  }

  return (0,external_kolmafia_.toInt)(clanInfo[0]);
}

function runInClan(clanId, func) {
  if (!GreyClan_hasWhitelistToCurrentClan() && (0,external_kolmafia_.getClanId)() != clanId) {
    throw "Attempted to switch clans, but we don't have WL to our current clan!";
  }

  var switcher = new ClanSwitcher();

  try {
    var result = switcher.joinClan(clanId);

    if (!result) {
      return;
    }

    func();
  } finally {
    switcher.restoreClan();
  }
}

function loadWhitelists() {
  var prop = "clansWhitelisted";
  var dayChecked = "clansWhitelistedChecked";
  availableClans = new Map();

  if (
  !(0,external_kolmafia_.propertyExists)(prop) ||
  (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)(dayChecked)) != (0,external_kolmafia_.gamedayToInt)())
  {
    var page;

    // Wait until we can fetch the page without errors
    while (
    (0,external_kolmafia_.currentRound)() != 0 ||
    (0,external_kolmafia_.handlingChoice)() ||
    (0,external_kolmafia_.choiceFollowsFight)() ||
    (0,external_kolmafia_.fightFollowsChoice)() ||
    !(page = (0,external_kolmafia_.visitUrl)("clan_signup.php?place=managewhitelists")).includes(
    "Here you can view the clans that you're currently whitelisted in"))

    {}

    var match;

    while (
    (match = page.match(
    /option +value=(\d+)>([^<>]*)<\/option>(?!.*name=whichclan>)/)) !=
    null)
    {
      page = page.replace(match[0], "");

      availableClans.set((0,external_kolmafia_.toInt)(match[1]), match[2]);
    }

    (0,external_kolmafia_.setProperty)(
    prop,
    (0,external_kolmafia_.toJson)(GreyClan_toConsumableArray(availableClans).map(function (_ref3) {var _ref4 = GreyClan_slicedToArray(_ref3, 2),k = _ref4[0],v = _ref4[1];return [k.toString(), v];})));

    (0,external_kolmafia_.setProperty)(dayChecked, (0,external_kolmafia_.gamedayToInt)().toString());
  } else {
    var data = (0,external_kolmafia_.getProperty)(prop);

    availableClans = new Map(
    JSON.parse(data).map(function (_ref5) {var _ref6 = GreyClan_slicedToArray(_ref5, 2),k = _ref6[0],v = _ref6[1];return [(0,external_kolmafia_.toInt)(k), v];}));

  }

  return availableClans;
}

function getAvailableClans() {
  if (availableClans != null) {
    return availableClans;
  }

  return loadWhitelists();
}

function getFax(monster) {
  if (isVIPDisabled()) {
    throw "VIP was disabled, but function fax was still called";
  }

  var faxbot = "CheeseFax";

  if (!canAccessClan(getDefaultClan()) || !(0,external_kolmafia_.isOnline)(faxbot)) {
    throw "Cannot access fax machine, clan accessible? ".concat(canAccessClan(
    getDefaultClan()), ". ").concat(
    faxbot, " online? ").concat((0,external_kolmafia_.isOnline)(faxbot));
  }

  runInClan(getDefaultClan(), function () {
    if (!canUseFaxMachine()) {
      throw "Expected to be find fax machine in the clan " + (0,external_kolmafia_.getClanName)();
    }

    (0,external_kolmafia_.print)("Now trying to fax " + monster.name, "blue");

    var hasReceivedFax = function hasReceivedFax() {
      if ((0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("photocopied monster")) == 0) {
        (0,external_kolmafia_.cliExecute)("fax receive");
      }

      if (
      (0,external_kolmafia_.getProperty)("photocopyMonster").toLowerCase() ==
      monster.name.toLowerCase())
      {
        return true;
      }

      (0,external_kolmafia_.cliExecute)("fax send");
      return false;
    };

    if (!hasReceivedFax()) {
      for (var i = 0; i <= 6; i++) {
        // We might have missed it or overrode it
        if (i % 3 == 0) {
          (0,external_kolmafia_.chatPrivate)(faxbot, monster.name);
        }

        (0,external_kolmafia_.wait)(10 + i);

        if (hasReceivedFax()) {
          return;
        }
      }
    }

    if (!hasReceivedFax()) {
      throw new Error(
      "Failed to acquire photocopied " +
      monster +
      ", assuming " +
      faxbot +
      " is online you probably just missed the fax. Try running the script again.");

    }
  });
}

function runFireworks(request) {
  runInClan(getClanToUse(fireworks), function () {
    if (!canUseFireworks()) {
      throw "Expected to be find fireworks shop in the clan " + (0,external_kolmafia_.getClanName)();
    }

    request();
  });
}

function doFortuneTeller() {
  if (isVIPDisabled() || !GreySettings_GreySettings.greyFortuneTeller) {
    return;
  }

  var consultsUsed = function consultsUsed() {return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_clanFortuneConsultUses"));};

  if (consultsUsed() >= 3) {
    return;
  }

  var bot = fortuneTellers.get((0,external_kolmafia_.getClanId)());
  var fortuneClan = (0,external_kolmafia_.getClanId)();

  if (!(typeof bot == "string") || !(0,external_kolmafia_.isOnline)(bot)) {
    bot = null;
  }

  if (bot == null) {
    if (!GreyClan_hasWhitelistToCurrentClan()) {
      (0,external_kolmafia_.print)(
      "Oh dear, we don't have whitelist to current clan. Skipping fortune telling",
      "red");

      return;
    }var _iterator = GreyClan_createForOfIteratorHelper(

      fortuneTellers),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var _step$value = GreyClan_slicedToArray(_step.value, 2),clanId = _step$value[0],botName = _step$value[1];
        if (!canAccessClan(clanId) || !(0,external_kolmafia_.isOnline)(botName)) {
          continue;
        }

        bot = botName;
        fortuneClan = clanId;
        break;
      }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
  }

  if (bot == null) {
    (0,external_kolmafia_.print)(
    "Unfortunately we do not have access to any Fortune Telling as the bots are either offline or you do not have a whitelist to the clans",
    "red");

    return;
  }

  (0,external_kolmafia_.print)("Now performing hocus pocus with the Fortune Teller", "blue");

  runInClan(fortuneClan, function () {
    if ((0,external_kolmafia_.getClanLounge)()[fortune.name] == null) {
      throw "Expected to be find fortune teller in the clan " + (0,external_kolmafia_.getClanName)();
    }

    var failed = 0;

    while (consultsUsed() < 3) {
      // We want the first result to be compatible
      // The second result is incompatible, as its worth more
      // The last result is compatible, as it has nicer equips

      var consultString =
      consultsUsed() == 1 ? "a b c" : "pizza batman thick";

      var consults = consultsUsed();
      (0,external_kolmafia_.cliExecute)("fortune " + bot + " " + consultString);

      if (consults == consultsUsed() && failed++ > 3) {
        (0,external_kolmafia_.print)(
        "Going to ask " +
        bot +
        " for a fax so they join " +
        (0,external_kolmafia_.getClanName)() +
        "...",
        "gray");


        (0,external_kolmafia_.chatPrivate)(bot, "fax mountain man");
        (0,external_kolmafia_.waitq)(10);
        failed = -2;
      }

      if (consultsUsed() < 3) {
        (0,external_kolmafia_.waitq)(4);
      }
    }
  });

  (0,external_kolmafia_.print)("Done with fortune telling.", "blue");
}

function GreyClan_hasVIPInvitation() {
  return (0,external_kolmafia_.availableAmount)(vipInvitation) > 0;
}

function canAccessClan(clanId) {
  if (clanId == null) {
    return false;
  }

  clanId = (0,external_kolmafia_.toInt)(clanId);

  return (
    clanId == (0,external_kolmafia_.getClanId)() ||
    GreyClan_hasWhitelistToCurrentClan() && getAvailableClans().has(clanId));

}

function GreyClan_hasWhitelistToCurrentClan() {
  return (0,external_kolmafia_.getClanId)() < 0 || getAvailableClans().has((0,external_kolmafia_.getClanId)());
}

function canUseFireworks() {
  return GreyClan_hasVIPInvitation() && canUse(fireworks);
}

function canUseFortuneBuff() {
  return GreyClan_hasVIPInvitation() && canUse(fortune);
}

function useFortuneBuff(func) {
  runInClan(getClanToUse(fortune), func);
}

function canUseFaxMachine() {
  return (
    GreyClan_hasVIPInvitation() &&
    !isVIPDisabled() &&
    canUse(faxMachine) &&
    canAccessClan(getDefaultClan()) &&
    faxOnline);

}

function canUse(vipItem) {
  return getClanToUse(vipItem) != null;
}

function getClanToUse(vipItem) {
  if ((0,external_kolmafia_.getClanLounge)()[vipItem.name] != null) {
    return (0,external_kolmafia_.getClanId)();
  }

  if (canAccessClan(getDefaultClan()) && getDefaultClan() != (0,external_kolmafia_.getClanId)()) {
    return getDefaultClan();
  }

  return null;
}

function isVIPDisabled() {
  return !GreyClan_hasVIPInvitation() || GreySettings_GreySettings.greyVIPClan.length == 0;
}
;// CONCATENATED MODULE: ./src/typings/ResourceTypes.ts
function ResourceTypes_createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = ResourceTypes_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it["return"] != null) it["return"]();} finally {if (didErr) throw err;}} };}function ResourceTypes_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return ResourceTypes_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return ResourceTypes_arrayLikeToArray(o, minLen);}function ResourceTypes_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}function ResourceTypes_typeof(obj) {"@babel/helpers - typeof";return ResourceTypes_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {return typeof obj;} : function (obj) {return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;}, ResourceTypes_typeof(obj);}function ResourceTypes_defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, ResourceTypes_toPropertyKey(descriptor.key), descriptor);}}function ResourceTypes_createClass(Constructor, protoProps, staticProps) {if (protoProps) ResourceTypes_defineProperties(Constructor.prototype, protoProps);if (staticProps) ResourceTypes_defineProperties(Constructor, staticProps);Object.defineProperty(Constructor, "prototype", { writable: false });return Constructor;}function ResourceTypes_classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function ResourceTypes_defineProperty(obj, key, value) {key = ResourceTypes_toPropertyKey(key);if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}function ResourceTypes_toPropertyKey(arg) {var key = ResourceTypes_toPrimitive(arg, "string");return ResourceTypes_typeof(key) === "symbol" ? key : String(key);}function ResourceTypes_toPrimitive(input, hint) {if (ResourceTypes_typeof(input) !== "object" || input === null) return input;var prim = input[Symbol.toPrimitive];if (prim !== undefined) {var res = prim.call(input, hint || "default");if (ResourceTypes_typeof(res) !== "object") return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return (hint === "string" ? String : Number)(input);}






// We should use the category only to determine if a quest is asking for a resource type, but doesn't tell us if it supports a certain resource or not. Aka not implemented.
var ResourceCategory;(function (ResourceCategory) {ResourceCategory[ResourceCategory["COPIER"] = 0] = "COPIER";ResourceCategory[ResourceCategory["OLFACT_COPIER"] = 1] = "OLFACT_COPIER";ResourceCategory[ResourceCategory["FAXER"] = 2] = "FAXER";ResourceCategory[ResourceCategory["CARGO_SHORTS"] = 3] = "CARGO_SHORTS";ResourceCategory[ResourceCategory["BANISHER"] = 4] = "BANISHER";ResourceCategory[ResourceCategory["YELLOW_RAY"] = 5] = "YELLOW_RAY";ResourceCategory[ResourceCategory["PULL"] = 6] = "PULL";ResourceCategory[ResourceCategory["ZAP"] = 7] = "ZAP";ResourceCategory[ResourceCategory["CLOVER"] = 8] = "CLOVER";ResourceCategory[ResourceCategory["POLAR_VORTEX"] = 9] = "POLAR_VORTEX";ResourceCategory[ResourceCategory["HUGS_AND_KISSES"] = 10] = "HUGS_AND_KISSES";ResourceCategory[ResourceCategory["FIRE_EXTINGUSHER_ZONE"] = 11] = "FIRE_EXTINGUSHER_ZONE";ResourceCategory[ResourceCategory["GLOVE_REPLACE"] = 12] = "GLOVE_REPLACE";ResourceCategory[ResourceCategory["DECK_OF_EVERY_CARD"] = 13] = "DECK_OF_EVERY_CARD";ResourceCategory[ResourceCategory["DECK_OF_EVERY_CARD_CHEAT"] = 14] = "DECK_OF_EVERY_CARD_CHEAT";ResourceCategory[ResourceCategory["CAT_HEIST"] = 15] = "CAT_HEIST";ResourceCategory[ResourceCategory["HOT_TUB"] = 16] = "HOT_TUB";ResourceCategory[ResourceCategory["FORCE_NC"] = 17] = "FORCE_NC";ResourceCategory[ResourceCategory["FORCE_FIGHT"] = 18] = "FORCE_FIGHT";ResourceCategory[ResourceCategory["PILL_KEEPER"] = 19] = "PILL_KEEPER";ResourceCategory[ResourceCategory["WANDERERS"] = 20] = "WANDERERS";})(ResourceCategory || (ResourceCategory = {}));























var ResourceIds = [
"Backup Camera",
"Cosplay Saber",
"Bowling Ball",
"Asdon",
"Combat Locket",
"Fax Machine",
"Wish",
"Cargo Shorts",
"Powerful Glove",
"Fire Extingusher",
"Yellow Ray",
"Pull",
"Clover",
"Deck of Every Card",
"Zap Wand",
"Cat Burglar Heist",
"Hot Tub",
"Chateau Painting",
"Parka: Force NC",
"Pillkeeper",
"Portscan",
"Hugs and Kisses",
"Autumn-aton",
"Digitize",
"Romantic Arrow"];


var PillkeeperPill;(function (PillkeeperPill) {PillkeeperPill["YELLOW_RAY"] = "explode";PillkeeperPill["DOUBLE_POTION"] = "extend";PillkeeperPill["FORCE_NC"] = "noncombat";PillkeeperPill["ALL_RES"] = "element";PillkeeperPill["DOUBLE_STATS"] = "stat";PillkeeperPill["FAM_WEIGHT"] = "familiar";PillkeeperPill["LUCKY"] = "lucky";PillkeeperPill["RANDOM_ADVENTURE"] = "random";})(PillkeeperPill || (PillkeeperPill = {}));








































function getResourceSettings() {
  return getResourceValues().map(function (res) {
    var def = ResourceValues[res.name];

    var setting = {
      name: res.name,
      setting: "values",
      property: "greyValue_" + res.name,
      description: res.description,
      valid: function valid(s) {return /^-?\d+$/.test(s);},
      "default": def
    };

    return setting;
  });
}

function getResourceValues() {
  var embezzler = {
    name: "Embezzler",
    description:
    "How much meat you expect to gain from embezzlers in garbo (This is basically how much a copier is worth using garbo)"
  };

  var cloverValue = {
    name: "Clover",
    description: "How much meat you could sell an 11-leaf clover for"
  };

  var parkaNC = {
    name: "ParkaNC",
    description: "How much meat each forced non-combat using Parka is worth"
  };

  var forcedDrop = {
    name: "ForcedDrop",
    description: "How much meat you could earn from each forced drop"
  };

  var pillkeeper = {
    name: "Pillkeeper",
    description: "How much meat you'd earn from the free pillkeeper use"
  };

  var pull = {
    name: "Pull",
    description: "How much each pull is worth to the player in meat"
  };

  var cosplay = {
    name: "CosplaySaber",
    description:
    "How much meat each cosplay saber use is worth, normally calculated by pills remaining. Set to 0 to let Greyday calculate this.",
    dynamic: true
  };

  var shorts = {
    name: "CargoShorts",
    description: "How much meat an item from Cargo Shorts is worth"
  };

  var deckOfCards = {
    name: "DeckOfCards",
    description:
    "With 15 uses, a cheat using 5, how much each use is worth in meat"
  };

  var zap = {
    name: "ZapWand",
    description: "How much each zap is worth in meat"
  };

  var burglar = {
    name: "CatBurglarHeist",
    description: "How much a cat burglar heist is worth in meat"
  };

  var chateauPainting = {
    name: "ChateauPainting",
    description:
    "How much Chateau Painting is worth in meat, not sure why this is an option given it'll only consider the painting if it's a fax it wants"
  };

  var hotTub = {
    name: "HotTub",
    description: "How much each hot tub usage is worth to you"
  };

  return [
  embezzler,
  cloverValue,
  parkaNC,
  pillkeeper,
  forcedDrop,
  pull,
  cosplay,
  shorts,
  deckOfCards,
  zap,
  burglar,
  chateauPainting,
  hotTub];

}var

ResourceValues = /*#__PURE__*/ResourceTypes_createClass(function ResourceValues() {ResourceTypes_classCallCheck(this, ResourceValues);});ResourceTypes_defineProperty(ResourceValues, "EmbezzlerValue",
19000);ResourceTypes_defineProperty(ResourceValues, "CloverValue",
22000);ResourceTypes_defineProperty(ResourceValues, "ForcedDropValue",
4000);ResourceTypes_defineProperty(ResourceValues, "PillkeeperValue",
70000);ResourceTypes_defineProperty(ResourceValues, "ParkaNCValue",
0);ResourceTypes_defineProperty(ResourceValues, "PullValue",
0);ResourceTypes_defineProperty(ResourceValues, "CosplaySaberValue",


0);ResourceTypes_defineProperty(ResourceValues, "CargoShortsValue",
30000);ResourceTypes_defineProperty(ResourceValues, "DeckOfCardsValue",
2000);ResourceTypes_defineProperty(ResourceValues, "ZapWandValue",
15000);ResourceTypes_defineProperty(ResourceValues, "CatBurglarHeistValue",
-500);ResourceTypes_defineProperty(ResourceValues, "ChateauPaintingValue",
5000);ResourceTypes_defineProperty(ResourceValues, "HotTubValue",
0);(function () {


  if (
  ["Distention Pill", "Dog Hair Pill"].
  map(function (s) {return external_kolmafia_.Item.get(s);}).
  map(function (i) {return (0,external_kolmafia_.itemAmount)(i) + (0,external_kolmafia_.closetAmount)(i) + (0,external_kolmafia_.storageAmount)(i);}).
  reduce(function (p1, p2) {return Math.min(p1, p2);}) > 60)
  {
    ResourceValues.CosplaySaberValue = -100;
  } else if ((0,external_kolmafia_.modifierEval)("G") >= 4) {
    ResourceValues.CosplaySaberValue = 3000;
  } else {
    ResourceValues.CosplaySaberValue = 0;
  }var _iterator = ResourceTypes_createForOfIteratorHelper(

    getResourceValues()),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var setting = _step.value;
      if (ResourceValues[setting.name + "Value"] == null) {
        (0,external_kolmafia_.print)("Can't find resource value " + setting.name, "red");
        continue;
      }

      ResourceValues[setting.name] = ResourceValues[setting.name + "Value"];

      var prop = "greyValue_" + setting.name;

      if (!(0,external_kolmafia_.propertyExists)(prop)) {
        continue;
      }

      var val = (0,external_kolmafia_.getProperty)(prop);

      if (!/^\d+$/.test(val)) {
        continue;
      }

      if (val == "0" && setting.name == "CosplaySaber") {
        continue;
      }

      ResourceValues[setting.name + "Value"] = (0,external_kolmafia_.toInt)(val);
    }} catch (err) {_iterator.e(err);} finally {_iterator.f();}})();



var glove = external_kolmafia_.Item.get("Powerful Glove");

var gloveReplace = {
  type: ResourceCategory.GLOVE_REPLACE,
  resource: "Powerful Glove",
  name: "Powerful Glove: Replace",
  worthInAftercore: ResourceValues.EmbezzlerValue,
  resourcesUsed: 10,
  prepare: function prepare(outfit) {return (
      outfit != null ? outfit.addWeight(glove) : null);},
  macro: function macro() {return Macro.skill(external_kolmafia_.Skill.get("CHEAT CODE: Replace Enemy"));}
};

var clover = {
  type: ResourceCategory.CLOVER,
  resource: "Clover",
  worthInAftercore: ResourceValues.CloverValue, // How much we could sell a clover for
  prepare: function prepare() {}
};

var xoFam = external_kolmafia_.Familiar.get("XO Skeleton");

var hugsAndKisses = {
  type: ResourceCategory.HUGS_AND_KISSES,
  resource: "Hugs and Kisses",
  worthInAftercore: ResourceValues.ForcedDropValue,
  familiar: xoFam,
  prepare: function prepare() {return null;},
  macro: function macro() {
    var skill = external_kolmafia_.Skill.get("Hugs and Kisses!");
    return Macro.while_("!pastround 15 && hasskill ".concat(
    (0,external_kolmafia_.toInt)(
    skill), " && !match While your foe shudders from having a bunch of their life drained away"),

    Macro.skill(skill));

  }
};

var extingusher = external_kolmafia_.Item.get("industrial fire extinguisher");

var extingusherPolar = {
  type: ResourceCategory.POLAR_VORTEX,
  resource: "Fire Extingusher",
  name: "Fire Extingusher: Polar Vortex",
  resourcesUsed: 10,
  worthInAftercore: ResourceValues.ForcedDropValue, // Tattered paper cost and assume free run
  prepare: function prepare(outfit) {return (
      outfit != null ? outfit.addWeight(extingusher) : null);},
  macro: function macro() {return Macro.skill(external_kolmafia_.Skill.get("Fire Extinguisher: Polar Vortex"));}
};

var extingusherZoneSpecific = {
  type: ResourceCategory.FIRE_EXTINGUSHER_ZONE,
  resource: "Fire Extingusher",
  name: "Fire Extingusher: Spray Down Zone",
  resourcesUsed: 20,
  worthInAftercore: ResourceValues.ForcedDropValue * 2, // Tattered paper cost x 2
  prepare: function prepare(outfit) {return (
      outfit != null ?
      outfit.addWeight(extingusher).addExtra("-equip smoke ball") :
      null);},
  macro: function macro() {return Macro.skill(external_kolmafia_.Skill.get("Fire Extinguisher: Zone Specific"));}
};

var pull = {
  type: ResourceCategory.PULL,
  resource: "Pull",
  worthInAftercore: ResourceValues.PullValue, // This doesn't cost us anything to use
  prepare: function prepare() {}
};

var pillkeeper = external_kolmafia_.Item.get("Eight Days a Week Pill Keeper");

var pillkeeperNC = {
  type: ResourceCategory.FORCE_NC,
  resource: "Pillkeeper",
  worthInAftercore: ResourceValues.PillkeeperValue, // Lets just value it at a frost flower?
  prepare: function prepare(outfit, props) {
    if (props != null) {
      (0,external_kolmafia_.cliExecute)("pillkeeper " + PillkeeperPill.FORCE_NC);
    }
  },
  ready: function ready() {return true;}
};

var sourceTerminal = (0,external_kolmafia_.getCampground)()["Source terminal"] > 0;
var portscanProp = "_portscanPrimed";

var portscan = {
  type: ResourceCategory.FORCE_FIGHT,
  resource: "Portscan",
  worthInAftercore: 0,
  prepare: function prepare(outfit) {
    if (
    outfit != null ||
    (
    (0,external_kolmafia_.getProperty)("sourceTerminalEducate1") +
    (0,external_kolmafia_.getProperty)("sourceTerminalEducate2")).
    includes("portscan.edu"))
    {
      return;
    }

    (0,external_kolmafia_.cliExecute)("terminal educate portscan.edu");
    (0,external_kolmafia_.visitUrl)("main.php");
  },
  primed: function primed() {return (0,external_kolmafia_.toBoolean)((0,external_kolmafia_.getProperty)(portscanProp) || "false");},
  unprime: function unprime() {return (0,external_kolmafia_.setProperty)(portscanProp, "false");},
  attemptPrime: function attemptPrime() {
    if ((0,external_kolmafia_.currentRound)() == 0) {
      return false;
    }

    var skill = external_kolmafia_.Skill.get("Portscan");

    if (!(0,external_kolmafia_.haveSkill)(skill) || (0,external_kolmafia_.myMp)() < (0,external_kolmafia_.mpCost)(skill)) {
      return false;
    }

    var prop = "_sourceTerminalPortscanUses";
    var scans = (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)(prop));

    Macro.skill(skill).submit();

    if (scans != (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)(prop))) {
      (0,external_kolmafia_.setProperty)(portscanProp, "true");
      return true;
    }

    (0,external_kolmafia_.print)("Failed to portscan for some reason..");
    return false;
  }
};

var parka = external_kolmafia_.Item.get("Jurassic Parka");
var torso = external_kolmafia_.Skill.get("Torso Awareness");
var parkaProp = "_parkaPrimed";

var ncParka = {
  type: ResourceCategory.FORCE_NC,
  resource: "Parka: Force NC",
  worthInAftercore: ResourceValues.ParkaNCValue,
  //available: () => haveSkill(torso) && availableAmount(parka) > 0,
  prepare: function prepare(outfit) {
    if (outfit != null) {
      outfit.addWeight(parka);
    } else {
      (0,external_kolmafia_.cliExecute)("parka spikolodon");
    }
  },
  primed: function primed() {return (0,external_kolmafia_.toBoolean)((0,external_kolmafia_.getProperty)(parkaProp) || "false");},
  unprime: function unprime() {return (0,external_kolmafia_.setProperty)(parkaProp, "false");},
  attemptPrime: function attemptPrime() {
    if ((0,external_kolmafia_.currentRound)() == 0) {
      return false;
    }

    var skill = external_kolmafia_.Skill.get("Launch spikolodon spikes");

    if (!(0,external_kolmafia_.haveSkill)(skill) || (0,external_kolmafia_.myMp)() < (0,external_kolmafia_.mpCost)(skill)) {
      return false;
    }

    var prop = "_spikolodonSpikeUses";
    var spikes = (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)(prop));

    Macro.skill(skill).submit();

    if (spikes != (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)(prop))) {
      (0,external_kolmafia_.setProperty)(parkaProp, "true");
      return true;
    }

    (0,external_kolmafia_.print)("Failed to launch spikolodon spikes for some reason..", "red");
    return false;
  }
};

var digitizer = {
  type: ResourceCategory.WANDERERS,
  resource: "Digitize",
  name: "Source Terminal: Digitize",
  worthInAftercore: ResourceValues.EmbezzlerValue * 3,
  prepare: function prepare(outfit) {
    if (outfit == null) {
      return;
    }

    if (
    (
    (0,external_kolmafia_.getProperty)("sourceTerminalEducate1") +
    (0,external_kolmafia_.getProperty)("sourceTerminalEducate2")).
    includes("digitize.edu"))
    {
      return;
    }

    (0,external_kolmafia_.cliExecute)("terminal educate digitize.edu");
    (0,external_kolmafia_.visitUrl)("main.php");
  },
  macro: function macro() {return Macro.skill("Digitize");}
};

var renimatedReanimator = external_kolmafia_.Familiar.get("Reanimated Reanimator");
var obtuseAngel = external_kolmafia_.Familiar.get("Obtuse Angel");

var reanimatedWanderer = {
  type: ResourceCategory.WANDERERS,
  resource: "Romantic Arrow",
  name: "Reanimated Reanimator: Wanderer Copier",
  worthInAftercore: ResourceValues.EmbezzlerValue * 3,
  familiar: renimatedReanimator,
  prepare: function prepare() {return null;},
  macro: function macro() {return Macro.skill(external_kolmafia_.Skill.get("Wink At"));},
  available: function available() {return (0,external_kolmafia_.haveFamiliar)(renimatedReanimator);}
};

var obtuseAngelWanderer = {
  type: ResourceCategory.WANDERERS,
  resource: "Romantic Arrow",
  name: "Obtuse Angel: Wanderer Copier",
  worthInAftercore: ResourceValues.EmbezzlerValue * 3,
  familiar: obtuseAngel,
  prepare: function prepare() {return null;},
  macro: function macro() {return Macro.skill(external_kolmafia_.Skill.get("Fire a badly romantic arrow"));},
  available: function available() {return (
      !(0,external_kolmafia_.haveFamiliar)(renimatedReanimator) && (0,external_kolmafia_.haveFamiliar)(obtuseAngel));}
};

var yellowParka = {
  type: ResourceCategory.YELLOW_RAY,
  resource: "Yellow Ray",
  name: "Parka: Yellow Ray",
  available: function available() {return (0,external_kolmafia_.availableAmount)(parka) > 0 && (0,external_kolmafia_.haveSkill)(torso);},
  freeTurn: true,
  resourcesUsed: 100,
  worthInAftercore: 0,
  prepare: function prepare(outfit, props) {
    if (outfit != null) {
      outfit.addWeight(parka);
    }

    if (props != null) {
      (0,external_kolmafia_.cliExecute)("parka dilophosaur");
    }
  },
  macro: function macro() {
    return Macro.skill(external_kolmafia_.Skill.get("Spit jurassic acid"));
  },
  ready: function ready() {return (0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("Everything Looks Yellow")) == 0;}
};

var rocket = external_kolmafia_.Item.get("Yellow Rocket");

var yellowRocket = {
  type: ResourceCategory.YELLOW_RAY,
  resource: "Yellow Ray",
  name: "Yellow Rocket",
  worthInAftercore: 250, // Cost of a yellow rocket
  resourcesUsed: 75,
  available: function available() {return canUseFireworks();},
  prepare: function prepare() {
    if ((0,external_kolmafia_.itemAmount)(rocket) == 0) {
      (0,external_kolmafia_.cliExecute)("acquire yellow rocket");
    }

    if ((0,external_kolmafia_.itemAmount)(rocket) == 0) {
      throw "Unable to acquire a yellow rocket";
    }
  },
  macro: function macro() {return Macro.item(external_kolmafia_.Item.get("Yellow Rocket"));},
  ready: function ready() {return (
      (0,external_kolmafia_.myMeat)() > 300 && (0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("Everything Looks Yellow")) == 0);}
};

var retrocape = external_kolmafia_.Item.get("unwrapped knock-off retro superhero cape");

var retroRay = {
  type: ResourceCategory.YELLOW_RAY,
  resource: "Yellow Ray",
  name: "Retrocape: Yellow Ray",
  worthInAftercore: 0,
  available: function available() {return (0,external_kolmafia_.availableAmount)(retrocape) > 0;},
  resourcesUsed: 100,
  prepare: function prepare(outfit, props) {
    if (outfit != null) {
      outfit.addWeight(retrocape);
    }

    if (props != null) {
      (0,external_kolmafia_.cliExecute)("retrocape heck kiss");
    }
  },
  macro: function macro() {return Macro.skill(external_kolmafia_.Skill.get("Unleash the Devil's Kiss"));},
  ready: function ready() {return (0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("Everything Looks Yellow")) == 0;}
};

var cosplaySaber = external_kolmafia_.Item.get("Fourth of May Cosplay Saber");

var cosplayYellowRay = {
  type: ResourceCategory.YELLOW_RAY,
  resource: "Cosplay Saber",
  name: "Cosplay Saber: YR",
  freeTurn: true,
  worthInAftercore: ResourceValues.CosplaySaberValue,
  prepare: function prepare(outfit, props) {
    if (outfit != null) {
      outfit.addWeight(cosplaySaber);
    }
    if (props != null) {
      props.setChoiceProperty(1387, 3);
    }
  },
  macro: function macro() {return Macro.skill(external_kolmafia_.Skill.get("Use The Force"));},
  ready: function ready() {return true;}
};

var backupCamera = external_kolmafia_.Item.get("Backup Camera");

var backupCopier = {
  type: ResourceCategory.COPIER,
  resource: "Backup Camera",
  worthInAftercore: ResourceValues.EmbezzlerValue, // Embezzler
  prepare: function prepare(outfit) {return (
      outfit != null ? outfit.addWeight(backupCamera) : null);},
  macro: function macro() {return Macro.skill(external_kolmafia_.Skill.get("Back-Up to your Last Enemy"));}
};

var cosplayCopier = {
  type: ResourceCategory.OLFACT_COPIER,
  resource: "Cosplay Saber",
  name: "Cosplay Saber: Friends",
  worthInAftercore: ResourceValues.CosplaySaberValue,
  prepare: function prepare(outfit, props) {
    if (outfit != null) {
      outfit.addWeight(cosplaySaber);
    }
    if (props != null) {
      props.setChoiceProperty(1387, 2);
    }
  },
  macro: function macro() {return Macro.skill(external_kolmafia_.Skill.get("Use The Force"));}
};

var cargoShorts = {
  type: ResourceCategory.CARGO_SHORTS,
  resource: "Cargo Shorts",
  freeTurn: true,
  worthInAftercore: ResourceValues.CargoShortsValue, // Some sellable item
  prepare: function prepare() {},
  pocket: function (_pocket) {function pocket(_x) {return _pocket.apply(this, arguments);}pocket.toString = function () {return _pocket.toString();};return pocket;}(function (pocket) {
    (0,external_kolmafia_.visitUrl)("inventory.php?action=pocket");
    (0,external_kolmafia_.visitUrl)("choice.php?whichchoice=1420&option=1&pocket=" + pocket + "&pwd=");
  })
};

var ResourceTypes_faxMachine = {
  type: ResourceCategory.FAXER,
  resource: "Fax Machine",
  worthInAftercore: ResourceValues.EmbezzlerValue, // Embezzler
  prepare: function prepare() {},
  available: function available() {return canUseFaxMachine();},
  fax: function fax(monster) {
    if ((0,external_kolmafia_.getProperty)("_photocopyUsed") != "false") {
      throw "The fax was already used!";
    }

    getFax(monster);

    (0,external_kolmafia_.visitUrl)("inv_use.php?which=3&whichitem=4873&pwd");
  }
};

var combatLocket = {
  type: ResourceCategory.FAXER,
  resource: "Combat Locket",
  worthInAftercore: ResourceValues.EmbezzlerValue, // Embezzler
  prepare: function prepare() {},
  fax: function fax(monster) {
    (0,external_kolmafia_.visitUrl)("inventory.php?reminisce=1", false);
    (0,external_kolmafia_.visitUrl)("choice.php?pwd=&whichchoice=1463&option=1&mid=" + (0,external_kolmafia_.toInt)(monster));
  }
};

var wish = external_kolmafia_.Item.get("Pocket Wish");
var genieBottle = external_kolmafia_.Item.get("Genie Bottle");

var wishFaxer = {
  type: ResourceCategory.FAXER,
  resource: "Wish",
  worthInAftercore: 50000, // Sell
  prepare: function prepare() {},
  fax: function fax(monster) {
    if (
    (0,external_kolmafia_.availableAmount)(genieBottle) > 0 &&
    (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_genieWishesUsed")) < 3)
    {
      (0,external_kolmafia_.visitUrl)("inv_use.php?pwd=&which=99&whichitem=9529");
    } else if ((0,external_kolmafia_.availableAmount)(wish) == 0) {
      throw "Not enough pocket wishes!";
    } else {
      (0,external_kolmafia_.visitUrl)("inv_use.php?pwd=&which=99&whichitem=9537");
    }

    (0,external_kolmafia_.visitUrl)("choice.php?forceoption=0");

    try {
      (0,external_kolmafia_.visitUrl)(
      "choice.php?pwd=&option=1&whichchoice=1267&wish=" +
      (0,external_kolmafia_.urlEncode)("to fight " + monster.name),
      true,
      true);

    } catch (e) {
      (0,external_kolmafia_.print)(e);
    }

    (0,external_kolmafia_.visitUrl)("choice.php");

    if ((0,external_kolmafia_.currentRound)() == 0) {
      throw "Failed to wish in a monster";
    }
  }
};

var cosplayBanisher = {
  type: ResourceCategory.BANISHER,
  resource: "Cosplay Saber",
  name: "Cosplay Saber: Banish",
  worthInAftercore: ResourceValues.CosplaySaberValue, // Garbo has some use of it, but if you have an oflaction like its basically worth grimace pill/2 free fights
  prepare: function prepare(outfit, props) {
    if (outfit != null) {
      outfit.addWeight(cosplaySaber);
    }
    if (outfit != null) {
      props.setChoiceProperty(1387, 1);
    }
  },
  macro: function macro() {return Macro.skill(external_kolmafia_.Skill.get("Use The Force"));}
};

var bowlingBall = {
  type: ResourceCategory.BANISHER,
  resource: "Bowling Ball",
  worthInAftercore: 0, // This doesn't cost us anything to use
  prepare: function prepare() {},
  macro: function macro() {return Macro.skill(external_kolmafia_.Skill.get("Bowl a Curveball"));}
};

var asdon = {
  type: ResourceCategory.BANISHER,
  resource: "Asdon",
  worthInAftercore: 900, // The rough price to fuel up the asdon
  prepare: function prepare() {}
};

var deckOfEveryCard = {
  type: ResourceCategory.DECK_OF_EVERY_CARD,
  resource: "Deck of Every Card",
  worthInAftercore: ResourceValues.DeckOfCardsValue,
  prepare: function prepare() {},
  pickCard: function pickCard(card) {
    if (card != null) {
      throw "You're not running a Pack of Cards Cheat, why provide a card name?";
    }

    (0,external_kolmafia_.cliExecute)("play random");
  }
};

var deckOfEveryCardCheat = {
  type: ResourceCategory.DECK_OF_EVERY_CARD_CHEAT,
  resource: "Deck of Every Card",
  name: "Deck of Every Card: Cheat",
  worthInAftercore: ResourceValues.DeckOfCardsValue * 10, // Worth 20k, 20k and 10k (Blue mana x2, then misc)
  resourcesUsed: 5,
  prepare: function prepare() {},
  pickCard: function pickCard(card) {return (0,external_kolmafia_.cliExecute)("cheat ".concat(card));}
};

var zappable = {
  type: ResourceCategory.ZAP,
  resource: "Zap Wand",
  worthInAftercore: ResourceValues.ZapWandValue,
  prepare: function prepare() {}
};

var catHeist = {
  type: ResourceCategory.CAT_HEIST,
  resource: "Cat Burglar Heist",
  worthInAftercore: ResourceValues.CatBurglarHeistValue,
  prepare: function prepare() {},
  doHeist: function doHeist(item) {
    if (
    (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("catBurglarBankHeists")) == 0 &&
    (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_catBurglarCharge")) <
    10 * ((0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_catBurglarHeistsComplete")) + 1))
    {
      throw "Unable to heist, no heists available!";
    }

    var heistResult = (0,external_kolmafia_.heist)(item);

    if (!heistResult) {
      throw "Failed to perform a cat burglar heist";
    }
  }
};

var chateauPainting = {
  type: ResourceCategory.FAXER,
  resource: "Chateau Painting",
  worthInAftercore: ResourceValues.ChateauPaintingValue,
  prepare: function prepare() {},
  fax: function fax(monster) {
    if ((0,external_kolmafia_.toMonster)((0,external_kolmafia_.getProperty)("chateauMonster")) != monster) {
      throw "Unexpected monster attempted to fax!";
    }
  }
};

var hottub = {
  type: ResourceCategory.HOT_TUB,
  resource: "Hot Tub",
  worthInAftercore: ResourceValues.HotTubValue,
  prepare: function prepare() {}
};

var allResources = [
gloveReplace,
clover,
extingusherPolar,
extingusherZoneSpecific,
pull,
yellowRocket,
yellowParka,
portscan,
ncParka,
cosplayYellowRay,
// pillkeeperNC,
backupCopier,
cosplayCopier,
cargoShorts,
ResourceTypes_faxMachine,
combatLocket,
wishFaxer,
cosplayBanisher,
bowlingBall,
asdon,
deckOfEveryCard,
deckOfEveryCardCheat,
zappable,
catHeist,
hottub,
retroRay,
chateauPainting,
hugsAndKisses,
digitizer,
reanimatedWanderer,
obtuseAngelWanderer].

map(function (r) {var _r$name;
  r.name = (_r$name = r.name) !== null && _r$name !== void 0 ? _r$name : r.resource;

  return r;
}).
sort(function (r1, r2) {return r1.worthInAftercore - r2.worthInAftercore;});

function ResourceTypes_getResources()

{var includingUnavailable = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;
  if (includingUnavailable) {
    return allResources;
  }

  return allResources.filter(function (r) {return r.available == null || r.available();});
}

/**
 * If this resource is something that changes with turns used
 */
function isTurnCounter(resource) {
  return (
    resource == "Bowling Ball" ||
    resource == "Yellow Ray" ||
    resource == "Autumn-aton");

}

function getResourcesLeft(
resourceType)

{var assumeUnused = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
  switch (resourceType) {
    case "Asdon":
      return 0;
    case "Hugs and Kisses":
      if (!(0,external_kolmafia_.haveFamiliar)(xoFam)) {
        return 0;
      }

      return 11 - (assumeUnused ? 0 : (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_xoHugsUsed")));
    case "Yellow Ray":
      var played =
      (0,external_kolmafia_.turnsPlayed)() + (0,external_kolmafia_.haveEffect)(external_kolmafia_.Effect.get("Everything Looks Yellow"));

      return 650 - (assumeUnused ? 0 : played);
    case "Pull":
      if (GreySettings_GreySettings.isHardcoreMode()) {
        return 0;
      }

      if (!assumeUnused && (0,external_kolmafia_.pullsRemaining)() == -1) {
        return 1000;
      }

      // Clamp
      var pullsSetting = Math.max(0, Math.min(GreySettings_GreySettings.greyPullsLimit, 20));

      if (assumeUnused) {
        return pullsSetting;
      }

      var pullsUsed = (0,external_kolmafia_.getProperty)("_greyPulls").
      split(",").
      filter(function (s) {return s.length > 0;}).length;

      pullsSetting -= pullsUsed;

      return Math.max(0, Math.min(pullsSetting, (0,external_kolmafia_.pullsRemaining)()));
    case "Backup Camera":
      return (0,external_kolmafia_.availableAmount)(backupCamera) > 0 ?
      11 - (assumeUnused ? 0 : (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_backUpUses"))) :
      0;
    case "Combat Locket":
      return (0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("Combat Lover's Locket")) > 0 ?
      3 - (
      assumeUnused ?
      0 :
      (0,external_kolmafia_.getProperty)("_locketMonstersFought").
      split(",").
      filter(function (s) {return s.length > 0;}).length) :
      0;
    case "Cargo Shorts":
      if ((0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("Cargo Cultist Shorts")) == 0) {
        return 0;
      }

      if (!assumeUnused && (0,external_kolmafia_.toBoolean)((0,external_kolmafia_.getProperty)("_cargoPocketEmptied"))) {
        return 0;
      }

      return 1;
    case "Powerful Glove":
      return (0,external_kolmafia_.availableAmount)(glove) > 0 ?
      100 - (
      assumeUnused ?
      0 :
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_powerfulGloveBatteryPowerUsed"))) :
      0;
    case "Fire Extingusher":
      return (0,external_kolmafia_.availableAmount)(extingusher) > 0 ?
      assumeUnused ?
      100 :
      (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_fireExtinguisherCharge")) :
      0;
    case "Clover":
      if (assumeUnused) {
        return 3;
      }

      var purchased = (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_cloversPurchased"));

      // If we've purchased 2, then we have 1 left to purchase along with item amount
      return (0,external_kolmafia_.itemAmount)(external_kolmafia_.Item.get("11-leaf clover")) + (3 - purchased);
    case "Deck of Every Card":
      return (0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("Deck of Every Card")) > 0 ?
      15 - (assumeUnused ? 0 : (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_deckCardsDrawn"))) :
      0;
    case "Zap Wand":
      if (!GreySettings_GreySettings.greyGrabZapWand) {
        return 0;
      }

      var zaps = (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_zapCount"));

      // Blew up
      if (!assumeUnused && zaps < 0) {
        return 0;
      }

      return Math.max(0, 2 - (assumeUnused ? 0 : zaps));
    case "Cosplay Saber":
      return (0,external_kolmafia_.availableAmount)(cosplaySaber) > 0 ?
      5 - (assumeUnused ? 0 : (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_saberForceUses"))) :
      0;
    case "Bowling Ball":
      return 0;
    case "Wish":
      var haveBottle = (0,external_kolmafia_.availableAmount)(external_kolmafia_.Item.get("Genie Bottle")) > 0;

      if (!haveBottle) {
        return 0;
      }

      if (assumeUnused) {
        return 3;
      }

      var fightsRemaining = 3 - (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_genieFightsUsed"));
      var wishesAvailable = Math.max(
      (0,external_kolmafia_.itemAmount)(wish),
      3 - (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_genieWishesUsed")));


      return Math.min(fightsRemaining, wishesAvailable);
    case "Fax Machine":
      if (!canUseFaxMachine()) {
        return 0;
      }

      return assumeUnused || (0,external_kolmafia_.getProperty)("_photocopyUsed") == "false" ? 1 : 0;
    case "Cat Burglar Heist":
      return (0,external_kolmafia_.haveFamiliar)(external_kolmafia_.Familiar.get("Cat Burglar")) ?
      assumeUnused ?
      1 :
      1 - (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_catBurglarHeistsComplete")) :
      0;
    case "Hot Tub":
      if (isVIPDisabled()) {
        return 0;
      }

      return 5 - (assumeUnused ? 0 : (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_hotTubSoaks")));
    case "Chateau Painting":
      if (!(0,external_kolmafia_.toBoolean)((0,external_kolmafia_.getProperty)("chateauAvailable"))) {
        return 0;
      }

      return assumeUnused || !(0,external_kolmafia_.toBoolean)((0,external_kolmafia_.getProperty)("_chateauMonsterFought")) ?
      1 :
      0;
    case "Parka: Force NC":
      if (!(0,external_kolmafia_.haveSkill)(torso) || (0,external_kolmafia_.availableAmount)(parka) == 0) {
        return 0;
      }

      if (assumeUnused) {
        return 5;
      }

      var spikesRemaining = 5 - (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_spikolodonSpikeUses"));

      // Don't count a primed resource as used yet!
      if ((0,external_kolmafia_.toBoolean)((0,external_kolmafia_.getProperty)(parkaProp))) {
        spikesRemaining++;
      }

      return spikesRemaining;
    case "Pillkeeper":
      if ((0,external_kolmafia_.availableAmount)(pillkeeper) == 0) {
        return 0;
      }

      return assumeUnused || !(0,external_kolmafia_.toBoolean)((0,external_kolmafia_.getProperty)("_freePillKeeperUsed")) ?
      1 :
      0;
    case "Portscan":
      if (
      !sourceTerminal ||
      !(0,external_kolmafia_.getProperty)("sourceTerminalEducateKnown").includes("portscan.edu"))
      {
        return 0;
      }

      if (assumeUnused) {
        return 3;
      }

      var scansRemaining =
      3 - (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_sourceTerminalPortscanUses"));

      // If resource is primed, don't count this resource as done yet!
      if ((0,external_kolmafia_.toBoolean)((0,external_kolmafia_.getProperty)(portscanProp))) {
        scansRemaining++;
      }

      return scansRemaining;
    case "Autumn-aton":
      return 0;
    case "Digitize":
      if (
      !sourceTerminal ||
      !(0,external_kolmafia_.getProperty)("sourceTerminalEducateKnown").includes("digitize.edu"))
      {
        return 0;
      }

      if (assumeUnused) {
        return 3;
      }

      return 3 - (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_sourceTerminalDigitizeMonsterCount"));
    case "Romantic Arrow":
      if (!(0,external_kolmafia_.haveFamiliar)(renimatedReanimator) || !(0,external_kolmafia_.haveFamiliar)(obtuseAngel)) {
        return 0;
      }

      if (assumeUnused) {
        return 1;
      }

      return (0,external_kolmafia_.toInt)((0,external_kolmafia_.getProperty)("_badlyRomanticArrows"));
    default:
      throw "No idea what the resource " + resourceType + " is.";}

}
// EXTERNAL MODULE: ./node_modules/mafia-shared-relay/dist/index.js
var dist = __webpack_require__(762);
;// CONCATENATED MODULE: ./src/relay/relay_greyday.ts
function relay_greyday_slicedToArray(arr, i) {return relay_greyday_arrayWithHoles(arr) || relay_greyday_iterableToArrayLimit(arr, i) || relay_greyday_unsupportedIterableToArray(arr, i) || relay_greyday_nonIterableRest();}function relay_greyday_nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function relay_greyday_iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function relay_greyday_arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function relay_greyday_toConsumableArray(arr) {return relay_greyday_arrayWithoutHoles(arr) || relay_greyday_iterableToArray(arr) || relay_greyday_unsupportedIterableToArray(arr) || relay_greyday_nonIterableSpread();}function relay_greyday_nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function relay_greyday_unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return relay_greyday_arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return relay_greyday_arrayLikeToArray(o, minLen);}function relay_greyday_iterableToArray(iter) {if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);}function relay_greyday_arrayWithoutHoles(arr) {if (Array.isArray(arr)) return relay_greyday_arrayLikeToArray(arr);}function relay_greyday_arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}




function getRelayPages() {
  var mainSettings = [
  {
    type: "interrupt",
    name: "Interrupt Greyday",
    notification: "Greyday has been interrupted!",
    actions: [
    { preference: "greyday_interrupt", value: "true" }]

  }];

  var valuesSettings = [];

  // load user perferences into json object to pass to react
  for (var _i = 0, _arr = [].concat(relay_greyday_toConsumableArray(getResourceSettings()), relay_greyday_toConsumableArray(GreySettings_getGreySettings())); _i < _arr.length; _i++) {var setting = _arr[_i];
    if (setting.viable == false) {
      continue;
    }

    var dropdowns = void 0;
    var type = void 0;

    if (setting.viableSettings != null) {
      if (typeof setting.viableSettings[0] == "string") {
        dropdowns = setting.viableSettings.map(function (s) {
          return { display: s, value: s };
        });
      } else {
        dropdowns = setting.viableSettings.map(
        function (_ref) {var _ref2 = relay_greyday_slicedToArray(_ref, 2),display = _ref2[0],value = _ref2[1];
          return {
            display: display,
            value: value
          };
        });

      }

      if (setting.tags != null) {
        type = "tags";
      } else {
        type = "dropdown";
      }
    } else if (typeof setting["default"] == "boolean") {
      type = "boolean";
    } else {
      type = "string";
    }

    var prop = {
      type: type,
      name: setting.name,
      placeholderText: null,
      preference: setting.property,
      description: setting.description,
      "default": setting["default"] == null ? "" : setting["default"].toString(),
      validate:
      typeof setting["default"] == "number" ? "(s) => /^-?\\d+$/.test(s)" : null,
      invalidReason: "This is not a proper number!"
    };

    if (dropdowns != null) {
      prop.dropdown = dropdowns;
    }

    if (setting.tags != null) {
      prop.maxTags = setting.tags.maxTags;
    }

    if (setting.setting == "main") {
      mainSettings.push(prop);
    } else {
      valuesSettings.push(prop);
    }
  }

  return [
  { page: "Main", components: mainSettings },
  { page: "Values", components: valuesSettings }];

}

function relay_greyday_main() {
  if ((0,dist.handleApiRequest)()) {
    return;
  }

  (0,external_kolmafia_.write)((0,dist.generateHTML)(getRelayPages()));
}
})();

var __webpack_export_target__ = exports;
for(var i in __webpack_exports__) __webpack_export_target__[i] = __webpack_exports__[i];
if(__webpack_exports__.__esModule) Object.defineProperty(__webpack_export_target__, "__esModule", { value: true });
/******/ })()
;